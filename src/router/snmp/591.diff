diff -urpN net-snmp-5.8/.appveyor.yml net-snmp-5.9.1/.appveyor.yml
--- net-snmp-5.8/.appveyor.yml	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/.appveyor.yml	2021-05-26 05:19:35.000000000 +0700
@@ -1,20 +1,28 @@
 image:
-  - Visual Studio 2017
+  - Visual Studio 2019
 
 environment:
   CYG_MIRROR: http://mirrors.kernel.org/sourceware/cygwin/
   matrix:
     - BUILD: MSVCDYNAMIC64
     - BUILD: MSVCSTATIC64
+    - BUILD: INSTALLER
+    - BUILD: MinGW32
+    - BUILD: MSYS2
     - BUILD: MinGW64
     - BUILD: Cygwin32
     - BUILD: Cygwin64
 
-matrix:
-  allow_failures:
-  - BUILD: MINGW64
+artifacts:
+  - path: installer
 
 clone_depth: 5
 
+install:
+  - 'call "ci\openssl.bat"'
+
 build_script:
   - 'call "ci\build.bat"'
+
+test_script:
+  - 'call "ci\test.bat"'
diff -urpN net-snmp-5.8/.cirrus.yml net-snmp-5.9.1/.cirrus.yml
--- net-snmp-5.8/.cirrus.yml	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/.cirrus.yml	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,12 @@
+env:
+  CIRRUS_CLONE_DEPTH: 5
+
+freebsd_instance:
+  image: freebsd-12-0-release-amd64
+  image: freebsd-11-2-release-amd64
+  image: freebsd-11-1-release-amd64
+  image: freebsd-10-4-release-amd64
+
+task:
+  install_script: ci/before.sh
+  script: ci/build.sh
diff -urpN net-snmp-5.8/.gitignore net-snmp-5.9.1/.gitignore
--- net-snmp-5.8/.gitignore	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/.gitignore	2021-05-26 05:19:35.000000000 +0700
@@ -1,4 +1,3 @@
-*~
 *.bak
 *.bs
 *.ft
@@ -14,6 +13,7 @@
 *.pdb
 *.rej
 *.swp
+*~
 .libs/
 agent/*.exe
 agent/mibgroup/agent_module_dot_conf.h
@@ -75,7 +75,6 @@ Makefile
 man/*.[1358]
 man/default_store.3.h
 man/manaliases
-mibs/.index
 mk/
 module_tmp_header.h
 net-snmp-5*
@@ -83,6 +82,8 @@ net-snmp-6*
 net-snmp-config
 net-snmp-config-x
 net-snmp-create-v3-user
+netsnmp-agent.pc
+netsnmp.pc
 NEWS.new*
 perl/*.json
 perl/*.yml
diff -urpN net-snmp-5.8/.travis.yml net-snmp-5.9.1/.travis.yml
--- net-snmp-5.8/.travis.yml	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/.travis.yml	2021-05-26 05:19:35.000000000 +0700
@@ -4,12 +4,193 @@ os:
   - linux
   - osx
 
+# See also https://docs.travis-ci.com/user/reference/osx/
+osx_image:
+  - xcode12
+  - xcode11.6
+  - xcode11.5
+  - xcode11.4
+  - xcode11.3
+  - xcode11.2
+  - xcode11.1
+  - xcode11
+  # Apparently when building with Xcode 10, the internal crypto code is
+  # selected. The SNMPv3 tests fail when built with the internal crypto code
+  # (snmpd reports "security service 3 error parsing ScopedPDU").
+  # - xcode10.3
+  # - xcode10.2
+  # - xcode10.1
+  # - xcode10
+  - xcode9.4
+  - xcode9.3
+  - xcode9.2
+  - xcode9.1
+  - xcode9
+  - xcode8.3
+  - xcode8
+  - xcode7.3
+
 env:
-  - env: MODE=regular
-  - env: MODE=disable-set
-  - env: MODE=mini
-  - env: MODE=minimalist
-  - env: MODE=read-only
+  - MODE=regular
+  - MODE=disable-set
+  - MODE=mini
+  - MODE=minimalist
+  - MODE=read-only
+
+jobs:
+  exclude:
+    - osx_image: xcode11.6
+      env: MODE=disable-set
+    - osx_image: xcode11.6
+      env: MODE=mini
+    - osx_image: xcode11.6
+      env: MODE=minimalist
+    - osx_image: xcode11.6
+      env: MODE=read-only
+    - osx_image: xcode11.5
+      env: MODE=disable-set
+    - osx_image: xcode11.5
+      env: MODE=mini
+    - osx_image: xcode11.5
+      env: MODE=minimalist
+    - osx_image: xcode11.5
+      env: MODE=read-only
+    - osx_image: xcode11.4
+      env: MODE=disable-set
+    - osx_image: xcode11.4
+      env: MODE=mini
+    - osx_image: xcode11.4
+      env: MODE=minimalist
+    - osx_image: xcode11.4
+      env: MODE=read-only
+    - osx_image: xcode11.3
+      env: MODE=disable-set
+    - osx_image: xcode11.3
+      env: MODE=mini
+    - osx_image: xcode11.3
+      env: MODE=minimalist
+    - osx_image: xcode11.3
+      env: MODE=read-only
+    - osx_image: xcode11.2
+      env: MODE=disable-set
+    - osx_image: xcode11.2
+      env: MODE=mini
+    - osx_image: xcode11.2
+      env: MODE=minimalist
+    - osx_image: xcode11.2
+      env: MODE=read-only
+    - osx_image: xcode11.1
+      env: MODE=disable-set
+    - osx_image: xcode11.1
+      env: MODE=mini
+    - osx_image: xcode11.1
+      env: MODE=minimalist
+    - osx_image: xcode11.1
+      env: MODE=read-only
+    - osx_image: xcode11
+      env: MODE=disable-set
+    - osx_image: xcode11
+      env: MODE=mini
+    - osx_image: xcode11
+      env: MODE=minimalist
+    - osx_image: xcode11
+      env: MODE=read-only
+    - osx_image: xcode10.3
+      env: MODE=disable-set
+    - osx_image: xcode10.3
+      env: MODE=mini
+    - osx_image: xcode10.3
+      env: MODE=minimalist
+    - osx_image: xcode10.3
+      env: MODE=read-only
+    - osx_image: xcode10.2
+      env: MODE=disable-set
+    - osx_image: xcode10.2
+      env: MODE=mini
+    - osx_image: xcode10.2
+      env: MODE=minimalist
+    - osx_image: xcode10.2
+      env: MODE=read-only
+    - osx_image: xcode10.1
+      env: MODE=disable-set
+    - osx_image: xcode10.1
+      env: MODE=mini
+    - osx_image: xcode10.1
+      env: MODE=minimalist
+    - osx_image: xcode10.1
+      env: MODE=read-only
+    - osx_image: xcode10
+      env: MODE=disable-set
+    - osx_image: xcode10
+      env: MODE=mini
+    - osx_image: xcode10
+      env: MODE=minimalist
+    - osx_image: xcode10
+      env: MODE=read-only
+    - osx_image: xcode9.4
+      env: MODE=disable-set
+    - osx_image: xcode9.4
+      env: MODE=mini
+    - osx_image: xcode9.4
+      env: MODE=minimalist
+    - osx_image: xcode9.4
+      env: MODE=read-only
+    - osx_image: xcode9.3
+      env: MODE=disable-set
+    - osx_image: xcode9.3
+      env: MODE=mini
+    - osx_image: xcode9.3
+      env: MODE=minimalist
+    - osx_image: xcode9.3
+      env: MODE=read-only
+    - osx_image: xcode9.2
+      env: MODE=disable-set
+    - osx_image: xcode9.2
+      env: MODE=mini
+    - osx_image: xcode9.2
+      env: MODE=minimalist
+    - osx_image: xcode9.2
+      env: MODE=read-only
+    - osx_image: xcode9.1
+      env: MODE=disable-set
+    - osx_image: xcode9.1
+      env: MODE=mini
+    - osx_image: xcode9.1
+      env: MODE=minimalist
+    - osx_image: xcode9.1
+      env: MODE=read-only
+    - osx_image: xcode9
+      env: MODE=disable-set
+    - osx_image: xcode9
+      env: MODE=mini
+    - osx_image: xcode9
+      env: MODE=minimalist
+    - osx_image: xcode9
+      env: MODE=read-only
+    - osx_image: xcode8.3
+      env: MODE=disable-set
+    - osx_image: xcode8.3
+      env: MODE=mini
+    - osx_image: xcode8.3
+      env: MODE=minimalist
+    - osx_image: xcode8.3
+      env: MODE=read-only
+    - osx_image: xcode8
+      env: MODE=disable-set
+    - osx_image: xcode8
+      env: MODE=mini
+    - osx_image: xcode8
+      env: MODE=minimalist
+    - osx_image: xcode8
+      env: MODE=read-only
+    - osx_image: xcode7.3
+      env: MODE=disable-set
+    - osx_image: xcode7.3
+      env: MODE=mini
+    - osx_image: xcode7.3
+      env: MODE=minimalist
+    - osx_image: xcode7.3
+      env: MODE=read-only
 
 addons:
   apt:
@@ -19,21 +200,18 @@ addons:
       - libatm-dev
       - libperl-dev
       - libsensors4-dev
-      - libssh-dev
+      - libssh2-1-dev
       - libssl-dev
       - make
       - perl-modules
       - pkg-config
       - python-dev
       - python-setuptools
+      - python3-dev
+      - python3-setuptools
 
 sudo: required
 
-before_script:
-  # Add an IPv6 config - see the corresponding Travis issue
-  # https://github.com/travis-ci/travis-ci/issues/8361
-  - 'if [ "${TRAVIS_OS_NAME}" == "linux" ]; then sudo sh -c ''echo 0 > /proc/sys/net/ipv6/conf/all/disable_ipv6; printf "\n::1 localhost ipv6-localhost ipv6-loopback\n" >>/etc/hosts; cat /etc/hosts''; fi'
-  # Upgrade openssl such that Net-SNMP can be built with Blumenthal AES support.
-  - 'if [ "${TRAVIS_OS_NAME}" == "osx" ]; then brew upgrade openssl >/dev/null 2>&1; fi'
+before_script: ci/before.sh
 
 script: ci/build.sh
diff -urpN net-snmp-5.8/CHANGES net-snmp-5.9.1/CHANGES
--- net-snmp-5.8/CHANGES	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/CHANGES	2021-05-26 05:19:35.000000000 +0700
@@ -3,6 +3,67 @@ that have been applied in released versi
 a summary of the major changes, and the ChangeLog file for a comprehensive
 listing of all changes made to the code.
 
+*5.9.1*:
+    General: Many bug fixes
+
+*5.9*
+    snmplib:
+      - Add IPv6 support to DTLSUDP transport
+      - use new netsnmp_sockaddr_storage in netsnmp_addr_pair
+      - add base_transport ptr for tunneled transports
+      - Add support for OpenSSL 1.1.1
+      - Dtls: overhaul of debug
+      - Remove inline versions of container funcs
+
+    snmpd:
+      - Use ETHTOOL_GLINKSETTINGS when available Newer Linux kernels
+	support ETHTOOL_GLINKSETTINGS. Use it when available instead of the
+	older and deprecated ETHTOOL_GSET. This patch avoids that the Linux
+	kernel reports the following kernel warning: warning: 'snmpd' uses
+	legacy ethtool link settings API, link modes are only partially
+	reported See also https://sourceforge.net/p/net-snmp/patches/1387/.
+	[bvanassche: reworked this patch significantly]
+      - Reduce the time needed to execute "pass" scripts on BSD systems See
+	also https://github.com/net-snmp/net-snmp/issues/8.
+      - [BUG 2926]: Make it possible to set agentXPingInterval for a
+	subagent - register agentXPingInterval for the subagent list
+	handler, before it was registered for snmp - added agentxTimeout to
+	the subagent list handler. It's now possible to set for snmpd and
+	the subagent. See 'man snmpd.conf' - added agentxRetries to the
+	subagent list handler. See 'man snmpd.conf'. It's never used in the
+	subagent, but it's now following the documentation Signed-off-by:
+	Anders Wallin <wallinux@gmail.com>
+
+    snmptrap:
+      - BUG: 2899: Patch from Drew Roedersheimer to set library
+	engineboots/time values before sending
+
+    snmptrapd:
+      - Add support for the latest libmysqlclient version
+
+    libsnmp:
+      - Scan MIB directories in alphabetical order This guarantees that
+	e.g. mibs/RFC1213-MIB.txt is read before mibs/SNMPv2-MIB.txt. The
+	order in which these MIBs is read matters because both define
+	sysLocation but with different attributes.
+
+    unspecified:
+      - [BUG 2930]: Fix a Solaris hrSWInst crash Avoid that snmpd crashes
+	on Solaris when querying software packages with an empty CATEGORY
+	field. See also https://sourceforge.net/p/net-snmp/bugs/2930/. See
+	also https://sourceforge.net/p/net-snmp/patches/1390/.
+
+    FreeBSD:
+      - Fix first byte of IF-MIB::ifPhysAddress   Don't write past the
+	interface name, and use temporary copy instead. This fixes the
+	first byte of ifPhysAddress always being 0 on FreeBSD. See also
+	https://sourceforge.net/p/net-snmp/code/merge-requests/20/. [
+	bvanassche: edited patch title / added test for malloc() result /
+	reduced number of free(if_name) calls ]
+
+    Win32:
+      - BUG: 2779541 Fixed handle leak in pass_persist.
+
 *5.8*
     snmplib:
       - [BUG 3444939]: BUG: 1796886: snmplib: Avoid that
diff -urpN net-snmp-5.8/ChangeLog net-snmp-5.9.1/ChangeLog
--- net-snmp-5.8/ChangeLog	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/ChangeLog	2021-05-26 05:19:35.000000000 +0700
@@ -2,6 +2,7425 @@
 
 ----------------------------------------------------------------------
 
+Changes: V5.9.1.rc1 -> V5.9.1
+
+commit 2eed7fe490bb6735a6c94b0cf03d9ff5d7884087
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Tue May 25 14:49:51 2021 -0700
+
+    remove the RC flag
+
+commit d9d7b9b63b7b5c7be1b6de675b94f3f0ef7596ae
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Tue May 25 14:49:10 2021 -0700
+
+    Version number update: 5.9.1
+
+----------------------------------------------------------------------
+
+Changes: V5.9.1.pre1 -> V5.9.1.rc1
+
+commit 05617ca6fd1d8355663de48280ade58d49050d33
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Wed Apr 28 14:15:15 2021 -0700
+
+    Release Candidate for V5-9-patches
+
+commit c371b1d7aa174871367b2a5de23431cf7348f1a4
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Wed Apr 28 14:15:13 2021 -0700
+
+    Version number update: 5.9.1.rc1
+
+commit 5ceb3ebc2fe138d35a498f402254335baffecee5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 15 10:30:04 2021 -0700
+
+    ci/build.sh: Disable parallel compilation for minimalist mode
+
+commit f69daae8a958daa8b50e8767da216ef9570b2e6c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 15 10:45:39 2021 -0700
+
+    Run 'make distdepend'
+
+commit 9f1d8188bae2990b42f8aef1c4f65dd18c1c1924
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 15 09:29:30 2021 -0700
+
+    Makefile.rules: Retain only -D and -I options when regenerating dependencies
+    
+    The 'makedepend' command accepts the cc -D and -I options but not the other
+    options that may occur in $(CPPFLAGS) (-f, -g, -O, -pipe, ...).
+
+commit 9ea3d8b93c9bb7da7fea13ee6c92356a6b82a5fb
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 14 20:03:15 2021 -0700
+
+    Makefile.in: Make sure that 'sedscript' is built before subdirectories
+    
+    This is a follow-up for commit 855e1c28dad5 ("Makefile.in, agent/Makefile.in:
+    Fix parallel compilation").
+
+commit 4fba346d04c26154098b917ad8769515e3766061
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 14 17:50:59 2021 -0700
+
+    Windows: Unbreak the build
+    
+    Fixes: d6fac610cdea ("Fix the crash of snmpd when snmptrapd terminates the TCP connection.")
+
+commit 93ea661906fb25657a63cfd757ef7a04c4dd0b33
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 14 16:12:43 2021 -0700
+
+    snmpd, FreeBSD 13: Make sure that filesystem statistics are up to date
+    
+    Make snmpd report the current statistics instead of statistics cached at
+    mount time by the operating system.
+    
+    Fixes: https://github.com/net-snmp/net-snmp/issues/282
+
+commit bd5bc2df5d39a5c730a86f1c452b69f35841fdba
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 14 09:51:18 2021 -0700
+
+    ci/build.sh: Enable parallel compilation
+
+commit 855e1c28dad53d6263c6c0c302438d2dc3128cc5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 14 09:35:24 2021 -0700
+
+    Makefile.in, agent/Makefile.in: Fix parallel compilation
+    
+    See also https://github.com/net-snmp/net-snmp/issues/283 .
+
+commit ec9068cd270677860e5832bee791a40ec33e08b2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 13 08:59:13 2021 -0700
+
+    ci/openssl.bat: Bump the OpenSSL version
+
+commit 021d10edbf0c4b7754b994ad0e0ffb090f6dac32
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 13 08:59:13 2021 -0700
+
+    ci/openssl.bat: Bump the OpenSSL version
+
+commit 6a77db5c7dc4e31afb6bca93c5394f224c55a179
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 12 21:41:15 2021 -0700
+
+    UCD-SNMP-MIB: Let configure detect whether or not getmntinfo() is available
+
+
+----------------------------------------------------------------------
+
+Changes: V5.9 -> V5.9.1.pre1
+
+commit f9312b44b71ddd247a98c6aff3e986d027e7eaa4
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Mon Apr 5 16:31:47 2021 -0700
+
+    version update for 5.9.1.pre1
+
+commit 3080795082e347504a3cd290f840b6b024d729df
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Mon Apr 5 16:30:09 2021 -0700
+
+    fix comment to C
+
+commit 0b886fc4d842f0f434606c4d35e610341cb650f7
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Mon Apr 5 15:38:35 2021 -0700
+
+    Version number update: 5.9.1.pre1
+
+commit b5429f6d8556f05100eadec681680df215a2d9e8
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Mon Apr 5 15:38:24 2021 -0700
+
+    version update for 5.9.1.pre1
+
+commit f36a9c4a747863d0c258a7a816381c9f15781f3c
+Author: Tobias Deiminger <tobias.deiminger@rohde-schwarz.com>
+Date:   Wed Oct 7 08:36:40 2020 +0200
+
+    Fix regex for "-l" discovery in setup.py
+    
+    This prevents setup.py from discovering wrong library link options (-l, -L)
+    in the middle of a word, like "inux-gnu" from "-L/usr/lib/x86_64-linux-gnu".
+    
+    For net-snmp-config output as follows (real world example from Ubuntu 18.04):
+    "-Wl,-Bsymbolic-functions -Wl,-z,relro -Wl,-z,now -L/usr/lib/x86_64-linux-gnu -lnetsnmp -lcrypto -lm"
+    the former regex "-l(\S+)" would match to
+    ['inux-gnu', 'netsnmp', 'crypto', 'm']
+    which obviously results in a ld error "cannot find -linux-gnu".
+    
+    Now we capture a string only, if "-l" is at the beginning of a string,
+    or if "-l" is preceeded by any number of whitespace characters.
+
+commit c2db3407dd4dd1a288042b06967a35712004e093
+Author: Ferenc Wágner <wferi@debian.org>
+Date:   Mon Mar 15 18:00:48 2021 +0100
+
+    Enable systemd socket activation for UDP sockets
+    
+    Like it was possible for UNIX and TCP sockets beforehand.
+
+commit a9cf25db7e3e969dbcd9bda9a16457db6fc7210f
+Author: Josef Řídký <jridky@redhat.com>
+Date:   Mon Mar 15 09:23:41 2021 +0100
+
+    net-snmp-cert: Use sha512 as default option for generating certificates.
+    
+    Fixes: https://github.com/net-snmp/net-snmp/issues/231
+    
+    [ bvanassche: edited commit message ]
+
+commit eb1b11bb7f3ac3281dc6e92d94e8fa749cac44e0
+Author: Josef Řídký <jridky@redhat.com>
+Date:   Fri Mar 12 10:15:30 2021 +0100
+
+    Prevent parsing IP address twice (#199)
+    
+    This fixes issue, that is caused by parsing IP address twice.
+    First as IPv4 and as IPv6 at second, even thow the address was
+    properly parsed as a valid IPv4 address.
+
+commit dce7b17e7ce7b12954a8c799265d3001922bb0a1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Mar 3 20:24:05 2021 -0800
+
+    ci/build.bat: Fix the Cygwin build
+
+commit dc58ed9990a1736b9b500a5e16e7517f93d194f4
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Mar 3 19:10:25 2021 -0800
+
+    net-snmp-create-v3-user: Print the version number once
+    
+    Print the version number once instead of keeping to print the version number
+    forever in an endless loop.
+    
+    Fixes: https://sourceforge.net/p/net-snmp/bugs/2778/
+
+commit afa2034ca57b7986e91272b56274cebff5d8d69f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 27 21:25:44 2021 -0800
+
+    ci/openssl.bat: Bump the OpenSSL version
+
+commit 8c301c1e06004aa4095f956bff5f399104e71127
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 27 19:46:13 2021 -0800
+
+    IF-MIB: Do not scan for PCI devices if no PCI bus is available
+    
+    Fixes: https://github.com/net-snmp/net-snmp/issues/271
+
+commit 385d555606ee31a23d5ed711a7ffba45f4197d50
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Feb 15 08:44:13 2021 -0800
+
+    Perl: Only use $prefix on Unix systems
+    
+    This patch reworks commit f64e0111ad10 ("Perl: Set the $prefix variable on
+    Windows").
+
+commit f64e0111ad10b948aeadd386063a69ba5fc7fc7b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 13 20:04:29 2021 -0800
+
+    Perl: Set the $prefix variable on Windows
+    
+    Fixes: https://github.com/net-snmp/net-snmp/issues/261
+
+commit 428a486d92ca631d83f5bfc42c319f630b152bea
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 13 19:19:19 2021 -0800
+
+    Python: Use netsnmp_memdup() instead of open-coding it
+
+commit 6ad61e6628ecf1bde987c78de37674c4886a16b9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 13 19:35:57 2021 -0800
+
+    Python: Do not report "error: set: adding variable/value to PDU" when clearing an OCTETSTR
+    
+    Fixes: https://github.com/net-snmp/net-snmp/issues/265
+
+commit ddd338fab038bf0ea25426d43518f4f24ac20853
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 13 19:19:01 2021 -0800
+
+    python/netsnmp/tests/test.py: Add a test for setting an OCTETSTR
+
+commit f03582450d1eabae6df66b1fde5699a8e2a97b81
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 13 11:02:37 2021 -0800
+
+    snmplib: Add more comments in netsnmp_random()
+
+commit b754da08461bd062632924fb773cb6f7c8c348d7
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 13 09:24:12 2021 -0800
+
+    Enable the compiler flag -Wtype-limits
+
+commit b71b52f03398f2c42f100dd960009b824e6c306b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 13 09:22:54 2021 -0800
+
+    Fix the -Wtype-limits compiler warnings
+
+commit a29685e5a35ff4a88b396e7952e59b53b9c24ebd
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 13 08:29:48 2021 -0800
+
+    configure: Only display the message "Checking for developer gcc flags" in developer mode
+
+commit 0dcebaf3d4b142638cd86de725ef23372495005f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Feb 12 20:55:42 2021 -0800
+
+    python/netsnmp/tests/test.py: Also perform a full MIB walk
+
+commit 8d8d8439d5d211ec1782d609e0ad67180c975d7b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Feb 12 19:49:18 2021 -0800
+
+    HOST-RESOURCES-MIB: Add JFFS2 support
+    
+    Fixes: https://github.com/net-snmp/net-snmp/issues/268
+
+commit d468c8ad86c86ceb1807ccd51408594526940137
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Feb 12 19:35:44 2021 -0800
+
+    HOST-RESOURCES-MIB: Simplify the code for recognizing "other" filesystems
+
+commit 02bc1baf0d4f6031085e107a9cddc05dfbd74db2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jan 10 16:58:09 2021 -0800
+
+    snmpd: Exclude the /dev/kmem code if configured with --without-kmem-usage
+    
+    This is a follow-up for 9e933893751f ("snmpd: Exclude the /dev/kmem code if
+    configured with --without-kmem-usage").
+    
+    Fixes: https://github.com/net-snmp/net-snmp/issues/251
+
+commit 4d92f40112dd768d89a9f0a20cf743b18d951e45
+Author: Filip Jensen <vivamudhoney@yahoo.es>
+Date:   Tue Jan 5 16:57:43 2021 +0100
+
+    Fix compilation when feature NETSNMP_FEATURE_REMOVE_LOGGING_STDIO is used
+
+commit e3601420c8fce713924038901f824e57e6855e72
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jan 4 13:01:47 2021 -0800
+
+    Revert "Read intermediate certificates from PEM files"
+    
+    This reverts commit 916110b15f28f8ae04598ad637ac26e4585ff385 and thereby
+    removes support for intermediate certificates from the v5.9 branch.
+
+commit 2b93ee55d1b9b32c86c3f725c59b8fd17912ae18
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jan 4 13:01:42 2021 -0800
+
+    Revert "libsnmp: Fix a NULL pointer dereference in an error path"
+    
+    This reverts commit 99a72177c7c69c5ca1a5ecb68f5f2db7d971e97a.
+
+commit baef04f9c6fe0eb3ac74dd4d26a19264eeaf7fa1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jan 4 10:00:33 2021 -0800
+
+    testing/fulltests/unit-tests/T105trap_parse_clib: Add this test
+    
+    Add a reproducer for the bug fixed by the previous patch.
+
+commit 92f0fe9e0dc3cf7ab6e8cc94d7962df83d0ddbec
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jan 4 12:21:59 2021 -0800
+
+    libsnmp: Fix asn_parse_nlength()
+    
+    Handle length zero correctly.
+    
+    Fixes: https://github.com/net-snmp/net-snmp/issues/253
+    Fixes: a9850f4445cf ("asn parse: add NULL checks, check length lengths")
+
+commit 1bf7c9c81d988e7945a34bea666ca3428c1ac127
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jan 4 12:17:58 2021 -0800
+
+    libsnmp: Simplify _asn_short_err()
+    
+    Since snprintf() always '\0'-terminates the string it produces explicit
+    '\0'-termination is not necessary.
+
+commit 34c3b4ee104a1239c7bff7f6c80ca8b05b3bf17a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jan 4 12:13:26 2021 -0800
+
+    libsnmp: Add SNMPv1 trap support in snmp_pdu_type()
+    
+    This change only affects error messages and debug messages.
+    
+    Fixes: 00ef569e00d1 ("Fix 5.5.x branch structure (part 2)")
+
+commit 9e933893751fb5b1b68c6efb844ef5d4b3a905e0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jan 3 13:42:59 2021 -0800
+
+    snmpd: Exclude the /dev/kmem code if configured with --without-kmem-usage
+    
+    See also https://github.com/net-snmp/net-snmp/issues/251 .
+
+commit 99a72177c7c69c5ca1a5ecb68f5f2db7d971e97a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Dec 30 13:03:30 2020 -0800
+
+    libsnmp: Fix a NULL pointer dereference in an error path
+    
+    This issue was detected by Coverity.
+    
+    Fixes: 916110b15f28 ("Read intermediate certificates from PEM files")
+
+commit 916110b15f28f8ae04598ad637ac26e4585ff385
+Author: minfrin <minfrin@users.noreply.github.com>
+Date:   Wed Dec 30 17:48:39 2020 +0000
+
+    Read intermediate certificates from PEM files
+    
+    This patch lifts the restriction that a PEM file can only contain
+    one certificate. This brings net-snmp in line with the behaviour
+    of other applications that use PEM files.
+    
+    Multiple certificates are read from each file, and the offset of
+    each certificate is added to the index for efficient retrieval.
+    
+    The first certificate in the chain is eligible to be either an
+    identity certificate or a remote certificate. Intermediate
+    certificates are ignored for this purpose, maintaining existing
+    behaviour with respect to peerCert and remoteCert.
+    
+    Trusted CA certificates are still required to be listed one per
+    file, this restriction will be lifted in a separate patch.
+    
+    [ bvanassche: modified this patch such that the size of struct
+      netsnmp_cert_common_s does not change ]
+
+commit e96087f1aa70583fe3142a2919fc3a69e62c53bb
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Dec 30 10:52:30 2020 -0800
+
+    TLSTM-MIB: Remove an unused member variable
+
+commit 951fd2d9b07e29455ff0251b0f44ed76d935ff00
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Dec 29 15:22:42 2020 -0800
+
+    snmpd: Restore SNMPD_CALLBACK_SEND_TRAP[12] behavior
+    
+    Instead of only invoking the SNMPD_CALLBACK_SEND_TRAP[12] callbacks if one
+    or more sessions with the corresponding SNMP version exist, invoke these
+    callbacks unconditionally.
+    
+    Fixes: f770e0f74932 ("skip send_trap callbacks if no sessions for version")
+    Fixes: https://github.com/net-snmp/net-snmp/issues/247
+
+commit 22f0630371231787f59522f4a3c4d1bb04594c66
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Dec 26 16:19:37 2020 -0800
+
+    ci: Overwrite /etc/hosts
+    
+    Overwrite /etc/hosts instead of using the /etc/hosts file provided by the
+    CI service. This should fix sporadic OS/X test failures.
+
+commit b3dd620161703a6ade14b5afe0e8f6fd63685a81
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Dec 26 16:07:34 2020 -0800
+
+    libsnmp, UDP: Only display VRF debug messages if relevant
+    
+    Only display a VRF debug message if a VRF interface has been specified.
+    
+    Fixes: 02de400544de ("libsnmp: Set Linux VRF iface on Trap sink IP addresses")
+
+commit ac06c5844105473e211decdf825af75dc7cd8b7c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Dec 25 17:19:35 2020 -0800
+
+    Perl: Rework the authentication / privacy algorithm lookup code
+    
+    Use the tables defined in snmplib/scapi.c instead of duplicating these tables.
+
+commit 6ea6935621a05c845e6829b18c833cdb9c7baa55
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Dec 25 17:19:45 2020 -0800
+
+    libsnmp: Constify the authentication and privacy data structures
+    
+    Prevent that scapi users modify data structures that should not be modified.
+    This patch modifies the Net-SNMP API but not the ABI.
+
+commit 92012951687cb18c8e58fede015e4bc0a9222e73
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Dec 26 09:25:33 2020 -0800
+
+    libsnmp: Export sc_find_auth_alg_byoid() and sc_find_auth_alg_bytype()
+    
+    Fix two typos in include/net-snmp/library/scapi.h.
+    
+    Fixes: 329a9d3c9d63 ("revamp auth/priv protocol constants handling")
+
+commit 4da46332f324eb5f18513d0e7e1368e529b29aef
+Author: minfrin <minfrin@users.noreply.github.com>
+Date:   Tue Dec 22 12:03:22 2020 +0000
+
+    Add support for intermediate certificates
+    
+    After constructing a certificate chain, pass the chain to openssl so the chain
+    is taken into account while negoiating SSL. Required to support certificates
+    generated by a PKI, or by a CA like Let's Encrypt.
+    
+    Fixes: https://github.com/net-snmp/net-snmp/issues/241
+    Fixes: https://github.com/net-snmp/net-snmp/issues/242
+    
+    [ bvanassche: slightly edited commit message ]
+
+commit 969226ea501b92e1a2ed427bc1a46f18ef2890b7
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Dec 18 10:25:20 2020 -0800
+
+    libsnmp, _cert_get_extension(): Consolidate error paths
+    
+    This patch does not change any functionality.
+
+commit bb30f8ee0075750fd3648a6bf3fab543f46152ed
+Author: minfrin <minfrin@users.noreply.github.com>
+Date:   Thu Dec 17 12:25:24 2020 +0000
+
+    libsnmp, SSL: Increase extension buffer size to prevent a crash
+    
+    Make sure enough space is allocated for extensions longer than 512 bytes. Fix
+    the error message when the extension is too long to clearly differentiate the
+    error from the out of memory case. Fix a crash when the extension is too long.
+    
+    [ bvanassche: edited patch description / fixed an off-by-one error / undid a
+      code formatting change ]
+
+commit 4c5d2ceae4d4a8b77db48fc8fff77e14943ff4d3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Dec 16 19:36:55 2020 -0800
+
+    libsnmp: Handle certificate loading errors gracefully
+    
+    Instead of crashing (SIGSEGV), skip certificates if loading fails.
+    
+    Reported-by: https://github.com/minfrin
+    Fixes: https://github.com/net-snmp/net-snmp/issues/233
+
+commit 9d001c34196df47526260441af35a509a325e41f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Dec 16 19:32:58 2020 -0800
+
+    libsnmp: Fix spelling in an error message
+    
+    Reported-by: https://github.com/minfrin
+
+commit bcc654e704f4794a9b10b8abf6e01f509402a6d3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Dec 13 12:06:45 2020 -0800
+
+    Darwin, ARM: Fix the 64-bit build
+    
+    See also the following two commits:
+    * 632b143b0005 ("memory_darwin: Suppress a compiler warning")
+    * 8ae78da391d5 ("Use vm_region_64 on 64-bit arch; cache memory for longer")
+
+commit f82634a1ca4a24601cd966abe4062c35e376c9ab
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Dec 13 09:58:28 2020 -0800
+
+    perl: Rework the authentication and privacy code
+    
+    Switch to a table-based approach. This patch does not change any functionality.
+
+commit cf125fee113ef9e361af51b916166990b5abeda2
+Author: garnier-quentin <garnier.quentin@gmail.com>
+Date:   Tue Dec 8 16:10:46 2020 +0100
+
+    perl: Add support for strong SHA authentication
+    
+    [ bvanassche: edited commit message, combined three patches into one and left
+      out whitespace-only changes ]
+
+commit a7c8c26c48c954a19bca5fdc6ba285396610d7aa
+Author: Mitchell Blank Jr <mitch@bodyfour.com>
+Date:   Sun Dec 13 03:23:02 2020 +0000
+
+    Fix compiler warnings generated by configure scripts
+    
+    Specifically, this is meant to reduce risk of issues with Xcode 12
+    which has made -Werror,-Wimplicit-function-declaration a default.
+    
+    Normally this doesn't bite "real" code since such a warning would be
+    visible for a long time with most compilers.  However, inside of
+    configure scripts these sorts of warnings just end up in config.log
+    and usually get ignored.  Now that they produce errors it means that
+    configure tests that *should* pass suddenly fail, causing very
+    strange failures later on.
+    
+    This can be as simple as calling "exit(0);" inside of a test C
+    program without doing "#include <stdlib.h>" first!
+    
+    I also fixed an implicit-int-return warning since that is another
+    C behavior that was deprecated long ago and future compilers might
+    consider that an error.
+    
+    [ bvanassche: reran autoconf ]
+
+commit cc3e0505f58d2c5d03be7a0b4c70afd01f7deb3c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Dec 12 18:41:45 2020 -0800
+
+    Windows: Yet another Visual Studio 2005 build fix
+    
+    Microsoft Visual Studio 2013 and before do not support __func__. Hence
+    use __FUNCTION__ instead of __func__ when building with Visual Studio.
+    
+    Reported-by: Christophe Cassignol
+    Fixes: 6066c6e21991 ("libsnmp, snmpv3_packet_build(): Avoid triggering a buffer overflow")
+    Fixes: 20725d58ca76 ("DTLSUDP transport: Check length of from address")
+
+commit 7137ee0b94ff5eab0682e5a63d5e9d6eb2b6fea9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Dec 12 18:20:46 2020 -0800
+
+    ci/openssl.bat: Bump the OpenSSL version
+
+commit 3617459d1d204f3e595c794a2642bd9536c86245
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Dec 12 14:38:28 2020 -0800
+
+    Windows: Fix Visual Studio 2005 build
+    
+    Reported-by: Christophe Cassignol
+    Fixes: 193062739789 ("Net-SNMP headers: Move in_addr_t definition into <net-snmp/net-snmp-config.h>")
+
+commit 64bbd86fc13517c5021096acfbb23577bbd0f8a8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Nov 30 19:41:27 2020 -0800
+
+    Python: Handle hex strings correctly
+    
+    See also https://github.com/net-snmp/net-snmp/issues/216 .
+
+commit c744be5ffed64f992a843e858a3cd2c1fe80f12f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Dec 1 20:19:17 2020 -0800
+
+    Python: Introduce build_python_varbind()
+    
+    This patch does not change any functionality.
+
+commit d519f4cf41c6b94661259409942fcdea46cf384d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Dec 1 19:27:55 2020 -0800
+
+    Python: Merge netsnmp_get() and netsnmp_getnext() into a single function
+    
+    This patch does not change any functionality.
+
+commit 281e6fc9454a785d9a4487d35146724dadcfbf62
+Author: Johnnyxy <Johnnyxy@github.com>
+Date:   Thu Nov 19 17:43:13 2020 -0800
+
+    Win32, MSVC: Use <stdint.h> if it is available
+    
+    See also https://github.com/net-snmp/net-snmp/issues/213 .
+
+commit a54c03aa0564e3aeb53712228522c2ba9b0f971f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Nov 18 21:05:13 2020 -0800
+
+    net-snmp-create-v3-user: Fix multiple shellcheck warnings
+
+commit 09a0c9005fb72102bf4f4499b28282f823e3e526
+Author: Josef Ridky <jridky@redhat.com>
+Date:   Wed Nov 18 20:54:34 2020 -0800
+
+    net-snmp-create-v3-user: Handle empty passphrases correctly
+    
+    See also https://github.com/net-snmp/net-snmp/issues/86.
+    
+    Fixes: e5ad10de8e17 ("Quote provided encryption key in createUser line")
+    Reported-by: Chris Cheney
+
+commit ebe677ea1be61df6589a28a5b6306fe55f5784b2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Nov 18 19:36:17 2020 -0800
+
+    CHANGES: snmpd: Fix OID handling in header_simple_table()
+    
+    Process GETNEXT for OIDs like 1.3.6.1.4.1.2021.9.1.1.4294967295 correctly.
+    Additionally, handle *length == 0 correctly.
+    
+    See also https://github.com/net-snmp/net-snmp/issues/210 .
+
+commit a8cb3591a924aeda1fd777f555da31ad8a627722
+Author: Josef Ridky <jridky@redhat.com>
+Date:   Mon Nov 9 19:42:32 2020 -0800
+
+    IP-MIB: Improve handling of IPv6 support having been disabled intentionally
+    
+    See also https://github.com/net-snmp/net-snmp/issues/190
+    [ bvanassche: modified variable names and source code comment ]
+
+commit 325b0df837197fd8f9af23eee838daae3ff80753
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Nov 6 20:45:07 2020 -0800
+
+    snmpd: Use sigprocmask() instead of sighold() and sigrelse()
+    
+    The latter two functions are obsolete, hence use sigprocmask() instead.
+
+commit 5a18e300bd085c6ba5967d7b00cc3f57fe83f665
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Oct 8 20:12:44 2020 -0700
+
+    HOST-RESOURCES-MIB: Add support for f2fs
+    
+    See also https://github.com/net-snmp/net-snmp/issues/111 .
+
+commit b1569c31514bf76fceb93f80c8b844101ee55e3a
+Author: Pavel Trushkin <pavel@dcmsys.com>
+Date:   Wed Sep 2 12:58:03 2020 +0300
+
+    fix the similar leak in SNMP::NODE::FETCH
+
+commit 581698a162b47b08f8571c7e1b8991df0764e5d3
+Author: Pavel Trushkin <pavel@dcmsys.com>
+Date:   Wed Sep 2 12:47:07 2020 +0300
+
+    fix resource leaks in the SNMP::Session destructor and SNMP::NODE::FETCH
+
+commit 5adc5bbcec46eacf654ed92ed2431d0965076fa9
+Author: Guillem Jover <gjover@sipwise.com>
+Date:   Fri Apr 22 15:45:07 2016 +0200
+
+    Perl, agent: Make the perl agent code more tolerant of perl types
+    
+    The code is currently very strict, and does not accept several internal
+    perl representations for integer scalars.
+    
+    First we should use SvPOK instead of SvPOKp to accept anything that
+    looks like a string. And then we should also accept floating point
+    numbers because they might store integer or unsigned values.
+
+commit d59ae433af8b6d9051d149ca2a745fc845e7c82d
+Author: Guillem Jover <gjover@sipwise.com>
+Date:   Fri Apr 22 15:45:07 2016 +0200
+
+    Perl, agent: Print the perl scalar flags on type mismatch in setValue
+    
+    This makes it easier to debug why a type mismatch happened, as we can
+    see how the type is represented internally by perl.
+
+commit 4d686f50d165f6b2b8fc79c9ae8f0a5702644fd8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Sep 27 19:24:19 2020 -0700
+
+    ci/openssl.bat: Bump the OpenSSL version
+
+commit b65fc0f848142543314329ca286fb90fc5f87773
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Sep 27 14:06:46 2020 -0700
+
+    configure: Update config.guess to the latest version
+    
+    Update config.guess to commit 4aa554d72b2a ("config.guess: Don't use
+    'ldd --version' to determine the presence of musl libc") from
+    https://git.savannah.gnu.org/gitweb/?p=config.git to fix compatibility
+    with the aarch64 architecture. See also
+    https://github.com/net-snmp/net-snmp/issues/188.
+
+commit 62f024175a73c9b669f9bd8c7e75a65017622f3a
+Author: urs-k <71150165+urs-k@users.noreply.github.com>
+Date:   Wed Sep 16 08:54:57 2020 +0200
+
+    snmpd: Fix a memory leak in ipAddressPrefixTable_data_access.c
+    
+    See also https://github.com/net-snmp/net-snmp/pull/183.
+    
+    [ bvanassche: adjusted commit message and reindented code ]
+
+commit b30e5b6c682e7095d61401461d9305dbfe99e914
+Author: Magnus Fromreide <magfr@lysator.liu.se>
+Date:   Fri Aug 14 00:39:34 2020 +0200
+
+    Do not require privacy in T0222
+
+commit d1578077f41f232831b9b68fea2cc75f39569fe2
+Author: Magnus Fromreide <magfr@lysator.liu.se>
+Date:   Mon Sep 7 08:25:42 2020 +0200
+
+    Correct the name of the V5-9-patches branch
+
+commit 8fabe044e316f9ecda53148d9afeaf5e5854bb1a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Sep 6 14:21:52 2020 -0700
+
+    agent/mibgroup/util_funcs: Use posix_spawn() if fork() is not available
+    
+    This patch restores pass_persist support for operating systems that do
+    not support fork(), e.g. uClinux. The pass_persist support added by this
+    patch is much more useful than the implementation removed by commit
+    e55d56212b72 ("snmpd: Remove the uClinux code from get_exec_pipes()").
+    The new implementation uses anonymous pipes while the old implementation
+    used named pipes with hardcoded paths (/flash/cp_%d and /flash/pc_%d).
+
+commit 537ae2f0b64f067d354db34a742a28260aa21aa1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Sep 6 14:29:53 2020 -0700
+
+    agent/mibgroup/util_funcs: Use dup2() instead of dup()
+    
+    This patch makes the code easier to read but does not change any
+    functionality.
+
+commit e34f0793b641998eb4f9bedb4f7929bb0e3051b8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Sep 6 15:13:58 2020 -0700
+
+    libsnmp: Allocate the module import list on the heap
+    
+    Since that list occupies 8 KiB, allocate it on the heap instead of on the
+    stack.
+
+commit ed4c8e85cb44e84ada5b8d2ff58e903de7ede737
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Sep 6 15:12:48 2020 -0700
+
+    libsnmp: Rework parse_imports()
+    
+    Do not cast pointers passed to free(). Reduce the number of return
+    statements in this function to one. Surround multiline statements with
+    braces.
+
+commit 52d4a465dcd92db004c34c1ad6a86fe36726e61b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Sep 4 13:44:51 2020 -0700
+
+    Darwin: Fix 'make install'
+    
+    Only attempt to install header files that exist under
+    include/net-snmp/system/
+    
+    See also https://github.com/net-snmp/net-snmp/issues/181 .
+    
+    Fixes: f01c45c53cdc ("Darwin: Unify system header files")
+
+commit 687b8c894f0de93b12f16ab9d5d9635adea39a6f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Sep 4 15:11:22 2020 -0600
+
+    OpenBSD: Fix a build error and a compiler warning
+
+commit ee7c66cf856dcda14f6d1d1503b80c0535509bc3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Sep 4 13:32:54 2020 -0700
+
+    OpenBSD: Do not use the linker flag -no-undefined
+    
+    This patch fixes a linker error on OpenBSD.
+    
+    See also https://github.com/net-snmp/net-snmp/issues/178 .
+
+commit 893b9baa6ae81a877e76842c29a637eeb2cbd0e2
+Author: Guido Jäkel <g.jaekel@dnb.de>
+Date:   Thu Sep 3 17:03:33 2020 +0200
+
+    libsnmp: Increase MAX_IMPORTS
+    
+    Today, I stepped into an well-known old issue
+    (https://sourceforge.net/p/net-snmp/mailman/message/16927159/) using MIBs
+    for a CISCO device.
+    
+    [bvanassche: edited commit message]
+
+commit 6093d4aee5cc81b8121458864d7e25fa7f46a7ba
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Aug 31 20:46:21 2020 -0700
+
+    libsnmp: Handle malloc() failure correctly in snmp_parse_oid()
+    
+    See also https://github.com/net-snmp/net-snmp/issues/177 .
+
+commit 205c69a652d742d4914a4332ecc8915b52217719
+Author: mark123499 <32741576+mark123499@users.noreply.github.com>
+Date:   Thu Aug 27 15:19:11 2020 +0900
+
+    snmpd: avoid container double free in error cases
+    
+    Fixes: ad653fb4618d ("new data access files")
+    [ bvanassche: Added "Fixes" tag ]
+
+commit 5b8bf5d4130761c3374f9ad618e8a76bb75eb634
+Author: Yuwei Ba <i@xiaoba.me>
+Date:   Fri Aug 21 15:06:10 2020 +0800
+
+    snmpd: support MemAvailable on Linux
+    
+    See also https://github.com/net-snmp/net-snmp/pull/167 .
+    
+    [bvanassche: modified the behavior of this patch]
+
+commit 410ddeff0b65937afd4bca6c7bfccc078fb5467d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Aug 28 20:28:04 2020 -0700
+
+    snmpd: Reindent agent/mibgroup/hardware/memory/hw_mem.c
+    
+    Source code formatting in this file is weird. Reformat this source
+    file with the help of the command mentioned in the CodingStyle file.
+
+commit f73dbd3998755fe141ba724445b0cb74df1939f4
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Aug 26 13:00:27 2020 -0700
+
+    libsnmp: Use snprintf() instead of sprintf() in print_tree_node()
+    
+    This patch suppresses certain static analyzer complaints. See also
+    https://github.com/net-snmp/net-snmp/issues/173 .
+
+commit b14ff16eee753b29ef7659b34a67af89acee22f7
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Aug 14 09:30:06 2018 -0700
+
+    snmplib, IPv6: Fix MSVC build
+    
+    Fixes: 4916ce007362 ("Fix Solaris compiler warnings")
+    Reported-by: Gisle Vanem <gvanem@yahoo.no>
+
+commit c13b4349fad05caaa97e69924c020cb02139a367
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Aug 26 07:58:03 2020 -0700
+
+    Solaris: Fix a compiler warning
+
+commit 7f5b50d5c51572f59d4b8c799cc6a676b0f1340f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jun 24 10:46:44 2018 -0700
+
+    Fix Solaris compiler warnings
+    
+    This patch does not change any functionality.
+
+commit adf7fda1f6b7123494875e8cd19b7445427b28ad
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Aug 24 19:40:48 2020 -0700
+
+    snmpd, snmptrapd: Fix a bug in an error path of parse_cmd()
+    
+    Fixes: 11e119c802e5 ("snmpd, util_funcs: Introduce the parse_cmd() function")
+
+commit ec28fff5c0dede00767b50cebe8959369e6d7035
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Aug 24 15:07:02 2020 -0700
+
+    libsnmp: Fix handling of the minus character in mib configuration directives
+    
+    Change one occurrence of 'confmibdir' into 'confmibs'. It seems like the
+    original code is the result of a copy/paste error. See also
+    https://github.com/net-snmp/net-snmp/issues/170.
+    
+    Fixes: 4253c5431631 ("make mibs, mibdirs and mibfiles handling consistent")
+
+commit f43a7213badf0b4014bb744021199fb2a127efff
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Aug 24 06:58:04 2020 -0700
+
+    snmpd, snmptrapd: Let configure check whether getdtablesize() is available
+    
+    This patch fixes the Net-SNMP build for termux.
+    
+    See also https://github.com/net-snmp/net-snmp/issues/155.
+
+commit 6bf543981b59f0048c640203b620c49db4c97d09
+Merge: 29a707be5 7266ff58d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 22 15:15:53 2020 -0700
+
+    Merge branch 'V5-8-patches' into V5-9-patches
+    
+    * V5-8-patches:
+      Windows: Unbreak the MSVC build of agent/mibgroup/agent/extend.c
+
+commit 29a707be54d1df5b90ac1a5bc72ae919b015e63d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 22 15:09:55 2020 -0700
+
+    dist/svnup: Remove this script because is no longer needed
+
+commit b04033209dc4ab9bdb4dffaf09b553438ac41797
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 22 10:46:01 2020 -0700
+
+    dist/net-snmp.spec: Improve the Net-SNMP RPM spec file
+    
+    Use the local Net-SNMP source code archive instead of downloading it from
+    SourceForge. Only prefix the version number with %{epoch}: on RHEL / Fedora
+    systems. Package the pkg-config files (.pc). Fix multiple rpmbuild warnings.
+
+commit 582b77e038ec63592a0a3e8b6bed069481e5776f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 22 10:34:41 2020 -0700
+
+    Makefile.in: Add 'rpm' make target
+
+commit efd048bc43bd99b756a984a16e735395cac22e4a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 22 10:16:06 2020 -0700
+
+    agent/mibgroup/versiontag: Switch from CVS to git
+    
+    Instead of instructing the user to copy the Net-SNMP source files into a
+    subdirectory, create the tar archive from the source files administered
+    by git.
+
+commit d5f6910373df6a8d501c402d29e038574d1e0975
+Author: Craig Small <csmall@debian.org>
+Date:   Sat Aug 22 08:57:28 2020 -0700
+
+    Makefile.rules: Install the pkgconfig files as data files
+    
+    See also https://github.com/net-snmp/net-snmp/issues/168 .
+    
+    Fixes: 6e1329bde834 ("NEWS: Add pkg-config support for building applications and sub-agents")
+    
+    [bvanassche: Added patch description]
+
+commit 7266ff58d0a289ecff74492c39d60ed42da2e437
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 15 19:22:01 2020 -0700
+
+    Windows: Unbreak the MSVC build of agent/mibgroup/agent/extend.c
+    
+    Fixes: 2703c379582f ("EXTEND MIB: Fix two recently introduced compiler warnings")
+
+commit 5561bd1a35396fc36697a246bbb0ad391d5fc3e5
+Merge: 8827eaf2b dc09b72c3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Aug 21 07:37:33 2020 -0700
+
+    Merge branch 'V5-8-patches' into V5-9-patches
+    
+    * V5-8-patches:
+      UCD-SNMP proxy: Fix OID substitution
+      UCD-SNMP proxy: Document struct simple_proxy members
+      UCD-SNMP proxy: Remove an unused member from struct simple_proxy
+
+commit dc09b72c32129e68c85d540e3dee64d4e9450910
+Merge: 5287a8e10 b6f37de20
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Aug 21 07:32:59 2020 -0700
+
+    Merge branch 'V5-7-patches' into V5-8-patches
+    
+    * V5-7-patches:
+      UCD-SNMP proxy: Fix OID substitution
+      UCD-SNMP proxy: Document struct simple_proxy members
+      UCD-SNMP proxy: Remove an unused member from struct simple_proxy
+
+commit b6f37de20c46258aa081137cae2e670adce98254
+Author: Josef Ridky <jridky@redhat.com>
+Date:   Fri Aug 21 07:27:16 2020 -0700
+
+    UCD-SNMP proxy: Fix OID substitution
+    
+    See also https://github.com/net-snmp/net-snmp/issues/165.
+    
+    This patch reverts commit 4eb12f0efedd ("we actually want to use the base
+    OID as the starting point, not the reg OID").
+    
+    [bvanassche: Added commit message]
+
+commit 11ee42c1f03fc0c779dacd2e852e44ba457f9457
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Aug 21 07:18:40 2020 -0700
+
+    UCD-SNMP proxy: Document struct simple_proxy members
+
+commit e11dc1d9d3566cb1acbeb6bed9481ac3434b7b33
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Aug 21 07:19:22 2020 -0700
+
+    UCD-SNMP proxy: Remove an unused member from struct simple_proxy
+    
+    This change does not affect the Net-SNMP ABI since the proxy.h header
+    file is a private header file.
+
+commit 8827eaf2b93901987cb846b3255a99634833ab91
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 16 17:04:25 2020 -0700
+
+    agent/mibgroup/ucd-snmp/pass_persist: Let configure check for waitpid()
+
+commit f0b4b2c73059e3f9357d9a76472c45a80ed037a9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 16 16:58:16 2020 -0700
+
+    agent/mibgroup/ucd-snmp/pass_persist: Simplify write_persist_pipe()
+    
+    Do not ignore SIGPIPE since snmpd and snmptrapd already do this.
+
+commit 9b33b399633e1fcea7e88d8b1a3aa774f03220c8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 16 16:46:59 2020 -0700
+
+    agent/mibgroup/ucd-snmp/pass_persist: Simplify init_persist_pipes()
+    
+    No functionality is changed.
+
+commit c8eb12eaad9f5d18702545a0eb51a9e64266efb3
+Author: Magnus Fromreide <magfr@lysator.liu.se>
+Date:   Sun Aug 16 16:44:37 2020 -0700
+
+    agent/mibgroup/ucd-snmp/pass_persist: Reduce the size of struct persist_pipe_type
+    
+    Remove the fOut and fdIn members because these are not used.
+    
+    [bvanassche: Added a patch description]
+
+commit ffb91a5d41719cad5b687f70fed0b80cde5c535f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 16 20:27:32 2020 -0700
+
+    agent/mibgroup/util_funcs: Split get_exec_pipes() in multiple functions
+    
+    No functionality has been changed.
+
+commit 80fed0e33eb2130d962d81375aee3f1bea2ec51c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 16 20:09:13 2020 -0700
+
+    agent/mibgroup/util_funcs: Add a debug statement
+
+commit 08864f1d3d0ba33a77e004285154223a8fd7a915
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 16 20:18:12 2020 -0700
+
+    agent/mibgroup/util_funcs: Fix two recently introduced compiler warnings
+    
+    Fixes: 11e119c802e5 ("snmpd, util_funcs: Introduce the parse_cmd() function")
+    Fixes: 9b1288216457 ("snmpd, util_funcs: Declare the first argument of get_exec_pipes() const")
+
+commit 1b37bd3b9577d123ca1f7c60cc83a0836d7bd669
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 16 08:33:19 2020 -0700
+
+    apps/snmpnetstat: Reindent source files
+    
+    Indentation of the source files in the apps/snmpnetstat directory
+    does not follow the Net-SNMP coding style. Hence reindent these files
+    using the command mentioned in the CodingStyle file.
+
+commit 1ee70571e0cae37f155f59d4382bc7109138cf09
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 15 17:29:25 2020 -0700
+
+    apps/snmpnetstat: Stop using obsolete signal functions
+    
+    This was reported by Rosen Penev. See also
+    https://github.com/net-snmp/net-snmp/pull/162.
+
+commit 9bee0e4bba190e9af3acf3f054f5a222bee3d7c3
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Tue Nov 6 08:28:02 2018 -0800
+
+    routex.c now uses the sockaddr_size feature
+
+commit d7fa60b251059d3954c745477917fcefe7c7453c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Sep 23 14:34:49 2018 -0700
+
+    MinGW32, apps/snmpnetstat: Fix compiler warnings about format specifier mismatches
+
+commit 99fedfe1238a7cc1bae4d44f49314a58a3649f73
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jun 23 18:19:41 2018 -0700
+
+    apps: Use getnameinfo() instead of netsnmp_gethostbyaddr() where appropriate
+
+commit ef99ca519c780508f4c358200dc05c2227023215
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jun 23 19:23:25 2018 -0700
+
+    apps/snmpnetstat: Modify the argument types of inet6print() and inet6name()
+    
+    This patch does not change any functionality.
+
+commit dc08763e4616c31fd91bd7b2e38dceb716ab7fa0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jun 23 19:05:33 2018 -0700
+
+    apps/snmpnetstat: Optimize the 127.0.0.1 comparison in inetname()
+    
+    This patch does not change any functionality.
+
+commit 475f0db2f2ff5dd66f02438ba9dd7b279738c1b1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jun 23 18:50:44 2018 -0700
+
+    apps/snmpnetstat: Constify several function arguments
+
+commit 8f9acef689867b5a25d6cf0d15e02d863f53759c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jun 23 18:51:25 2018 -0700
+
+    apps/snmpnetstat: Use inet_ntoa() instead of open-coding it
+
+commit 152de25d75f5419be296dcf5f98b1ae3ffaf9608
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 15 19:22:01 2020 -0700
+
+    Windows: Unbreak the MSVC build of agent/mibgroup/agent/extend.c
+    
+    Fixes: 2703c379582f ("EXTEND MIB: Fix two recently introduced compiler warnings")
+
+commit 11e119c802e54b108b6783e0834849c3926aaf6c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 9 18:24:20 2020 -0700
+
+    snmpd, util_funcs: Introduce the parse_cmd() function
+    
+    This patch does not change any functionality.
+
+commit 9b1288216457083eaa58b258d2c4726de31abd25
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 9 18:12:12 2020 -0700
+
+    snmpd, util_funcs: Declare the first argument of get_exec_pipes() const
+    
+    This patch does not change any functionality.
+
+commit e55d56212b7260bf2b6f71d3ddd86ab7b27363ff
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Aug 14 16:04:38 2020 -0700
+
+    snmpd: Remove the uClinux code from get_exec_pipes()
+    
+    get_exec_pipes() is only used to open persistent pipes. So it is essential
+    to use fork(). Using vfork() in the implementation of get_exec_pipes() is
+    wrong because vfork() blocks the caller until the child process has
+    finished. Since the uClinux implementation of get_exec_pipes() uses
+    vfork(), remove the uClinux code from get_exec_pipes().
+
+commit 26c1d4f2e58ce967c12a085784c86f9dd6ced862
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 8 10:54:57 2020 -0700
+
+    snmpd: Call fclose() after fdopen() but not close()
+    
+    From https://pubs.opengroup.org/onlinepubs/9699919799/functions/fclose.html:
+    "The fclose() function shall perform the equivalent of a close() on the file
+    descriptor that is associated with the stream pointed to by stream."
+    
+    Hence call fclose() but not close() if fdopen() succeeded.
+    
+    See also https://github.com/net-snmp/net-snmp/issues/157 .
+    
+    Fixes: fd9a42d142d8 ("- (pass-persist.c pass-persist.h): moved to pass_persist.[ch].")
+    Fixes: a36188e50dcc ("Patch #760417 from Bob Rowlands/Sun for fixing Bug #751920")
+
+commit 51c40b7ad54dd77f0313e09c56a4b1ef761e6ab5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 2 17:32:25 2020 -0700
+
+    TLSTM-MIB: Fix a Coverity use-after-free complaint
+
+commit 99e31c39e5cfe649617fcc8f6bb9dec31b7de82f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 2 16:55:19 2020 -0700
+
+    Handle MIB registration failures instead of ignoring these
+    
+    This patch suppresses multiple Coverity 'use after free' complaints.
+
+commit 02aee733f8d094749bd1fa4cf23fd53e6eff3f14
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 1 17:18:38 2020 -0700
+
+    libsnmp: Pass 0xff as second argument to memset() instead of '\xff'
+    
+    This patch suppresses the following Coverity warning:
+    
+    Memset fill truncated (NO_EFFECT)
+    bad_memset: Argument 4294967295 in memset loses precision in
+    memset(mask.__in6_u.__u6_addr8, 4294967295, j).
+
+commit cd95f3065030e291122e4325f5ea69d3b2e9c619
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 1 17:15:37 2020 -0700
+
+    IF-MIB: Fix source code indentation
+    
+    This was detected by Coverity.
+
+commit 19d75e01fc72b6e03992207d68bd6649950c70b8
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Fri Aug 14 15:13:51 2020 -0700
+
+    change active branches to 5.9 and master
+
+commit 0e6790c62ed89cc00bd0203a1bcd2b837fe3526e
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Fri Aug 14 15:12:03 2020 -0700
+
+    added a file to force-push a branch
+
+
+----------------------------------------------------------------------
+
+Changes: V5.9.rc2 -> V5.9
+
+commit f68a967f6f3aa999f906cd986ffb83f36d37e98b
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Fri Aug 14 14:31:32 2020 -0700
+
+    v5-4 is no longer in release either
+
+commit a93761876be67802598338bc92473d7df529b00e
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Fri Aug 14 14:31:16 2020 -0700
+
+    remove release from dist/release
+
+commit b7f01b1134c7a8ed578f8ab9ebecafc85ab2a757
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Fri Aug 14 14:30:46 2020 -0700
+
+    Version number update: 5.9
+
+commit b65b426f1a056b39286b57f8ad855c77e6dffe2e
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Thu Aug 6 14:07:23 2020 -0700
+
+    changelog
+
+----------------------------------------------------------------------
+
+Changes: V5.8.1.rc1 -> V5.9.rc2
+
+commit d8dc063e6c41b870b84430e92ab0f5183f014e22
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Tue Aug 4 17:21:16 2020 -0700
+
+    autoconf
+
+commit 7ba8a81fe24a60744ef7570f06c40de6cd4e4729
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Tue Aug 4 17:20:53 2020 -0700
+
+    Fix variable check to include an x prefix for safety
+
+commit bbd53ed4a42929d0c93645e069b466daa4f0fbce
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Tue Aug 4 17:20:43 2020 -0700
+
+    network pcre detection
+
+commit 8f371058e274f8a3cf1b293648b8eebc1086a2c9
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Tue Aug 4 17:20:07 2020 -0700
+
+    fix libwrap reference not including previous value
+
+commit bbd6adc7794d450910aded191c94836a12614da1
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Fri Jul 31 07:47:40 2020 -0700
+
+    Version number update: 5.9.rc2
+
+commit 2703c379582f17076e625606e9fbd63feb6533f4
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jul 24 08:35:44 2020 -0700
+
+    EXTEND MIB: Fix two recently introduced compiler warnings
+    
+    See also commit 77f6c60f57db ("make the extend mib read-only by default").
+
+----------------------------------------------------------------------
+
+Changes: V5.8.1.pre2 -> V5.8.1.rc1
+
+commit 0ee30b8ad6646c6bdd96ee67c82641ed50ce6519
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Thu Jul 23 17:05:50 2020 -0700
+
+    Release Candidate for V5-8-patches
+
+commit f2ce116c5ff3e6dddb4186905bb277c38025b047
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Thu Jul 23 17:05:47 2020 -0700
+
+    Version number update: 5.8.1.rc1
+
+commit 77f6c60f57dba0aaea5d8ef1dd94bcd0c8e6d205
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Thu Jul 23 16:17:27 2020 -0700
+
+    make the extend mib read-only by default
+
+commit 4097a311e952d3b5c12610102bb4cc2fe72b56e5
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Thu Jul 23 15:46:12 2020 -0700
+
+    Revert "snmpd: Disable NET-SNMP-EXTEND-MIB support by default"
+    
+    This reverts commit c2b96ee744392243782094432f657ded4e985a07.
+
+commit b13410f5b35fd281b9e93113aaa47f9f5c418974
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 22 09:26:29 2020 -0700
+
+    snmpd, snmptrapd: Disallow to change the user / group after it has been set
+    
+    This patch causes the -u and -g arguments to take precedence over the
+    agentuser and agentgroup keywords.
+
+commit 53922d2d8873c460d526b8bba9a285c5b98c9e1f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 22 09:22:30 2020 -0700
+
+    snmpd, snmptrapd: Introduce the netsnmp_set_agent_{user,group}_id() functions
+    
+    This patch does not change any functionality.
+
+commit ba7740a2188184ce2beb36dd1e81b88ced390294
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Jul 21 07:36:43 2020 -0700
+
+    snmpd, snmptrapd: Reduce code duplication
+    
+    Consolidate and rename the two copies of the functions that parse user
+    and group IDs.
+
+commit 42e97a741dbc71ce4ab2671fc057b8488638d3b8
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Thu Jul 16 08:01:44 2020 -0700
+
+    Use more appropriate accept/block terminology
+
+commit e772b8017d7e235437a45622bf8aa05f3ef3d084
+Author: Robert Story <rstory@freesnmp.com>
+Date:   Mon Jul 13 12:45:22 2020 -0400
+
+    fix issue #99: read stored ifXTable config at startup
+
+commit c2b96ee744392243782094432f657ded4e985a07
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jul 11 09:42:55 2020 -0700
+
+    snmpd: Disable NET-SNMP-EXTEND-MIB support by default
+    
+    Since it is possible to abuse this MIB for privilege escalation attacks,
+    disable it by default. Notes:
+    - It is still possible to enable this MIB via the --with-mib-modules
+      configure option.
+    - Another MIB that provides similar functionality, namely
+      ucd-snmp/extensible, is disabled by default.
+    - The security risk of ucd-snmp/pass and ucd-snmp/pass_persist is lower
+      since these modules only introduce a security risk if the invoked
+      scripts are exploitable.
+
+commit 6fd7499ccaafdf244a74306972562b2091cb91b1
+Author: fisabelle <fisabelle@broadsoft.com>
+Date:   Thu Jul 9 15:49:35 2020 -0400
+
+    Issue#147: Net-SNMP not responding when proxy requests times out
+
+commit 5a464044f95339f979f6b2fdfa756a08d519b78e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jul 5 14:09:56 2020 -0700
+
+    Stop using config_arch_require()
+    
+    Stop using config_arch_require() since the effect of this macro is confusing.
+    As an example, #define freebsd4 freebsd4 occurs in a header file that is
+    included indirectly when building on FreeBSD 12. However, the following test
+    in config_modules_agent does not recognize the expansion of freebsd4 into
+    freebsd4:
+    
+        # target_os may have been changed to a #define of 1...
+        if test "x$archtest" = "x1" -o "x$target_os" = "x$archtest" -o "x$PARTIALTARGETOS" = "x$archtest"; then
+
+commit dec4eaa0626ef2447d41ea1af125809bfb86fbe8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jul 5 12:53:25 2020 -0700
+
+    FreeBSD: Fix the sysctl() configure test
+    
+    This patch fixes the following compiler warnings:
+    
+    conftest.c:406:1: warning: type specifier missing, defaults to 'int' [-Wimplicit-int]
+    main() {
+    ^
+    conftest.c:415:41: warning: incompatible pointer to integer conversion passing 'void *' to parameter of type 'size_t' (aka 'unsigned long') [-Wint-conversion]
+      sysctl(mib, 2, &boottime, &len, NULL, NULL);
+                                            ^~~~
+    /usr/include/sys/_null.h:34:14: note: expanded from macro 'NULL'
+                    ^~~~~~~~~~~
+    /usr/include/sys/sysctl.h:1062:70: note: passing argument to parameter here
+    int     sysctl(const int *, u_int, void *, size_t *, const void *, size_t);
+                                                                             ^
+    conftest.c:417:5: warning: implicitly declaring library function 'exit' with type 'void (int) __attribute__((noreturn))' [-Wimplicit-function-declaration]
+        exit(0);
+        ^
+    conftest.c:417:5: note: include the header <stdlib.h> or explicitly provide a declaration for 'exit'
+    3 warnings generated.
+
+commit 72afad88ad58653687383b81b73299b5fdd6e8c4
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jul 4 14:30:58 2020 -0700
+
+    ci/net-snmp-configure: Improve FreeBSD support
+    
+    Make freebsd_pkg_version() accept multiple package names. Rename
+    the opensshver variable into libssh2ver.
+
+commit 18edbbfa20689f5b4d38390b9be7006d98f67195
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jul 3 18:44:44 2020 -0700
+
+    ci: .travis.yml: Comment out Xcode 10.x
+
+commit ec9667c508cec45fc1e8e87fbd3f3687161926a1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jul 3 14:49:17 2020 -0700
+
+    ci/net-snmp-configure: Disable Python modules for Darwin 10 or older
+    
+    Building Python modules fails with older versions of Xcode, hence do not
+    build Python modules for older versions of Xcode.
+
+commit b3532cd6111eed67eaf83c540b05a175bc8f1fc1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jul 3 14:17:40 2020 -0700
+
+    ci/net-snmp-configure: Only include snmp-usm-dh-objects-mib if openssl/dh.h is available
+
+commit 9945a3c8928d9358c7d8c5b4e8ec7b6250835f13
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Fri Jul 3 15:46:48 2020 -0700
+
+    minor wording fixes
+
+commit c76c17abc03e5519ab75f2b7e951df40ae7a1ddd
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Fri Jul 3 15:45:51 2020 -0700
+
+    removed the way out of date thank you list, and referred to the git log
+
+commit 1b54c6b895ba8311644427a958e43229853a853d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jul 3 10:05:44 2020 -0700
+
+    ci: Reduce the number of combinations built by Travis
+
+commit f01c45c53cdc931faf68fb33389928a29f1297f9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Jun 30 16:53:05 2020 -0700
+
+    Darwin: Unify system header files
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2504/ .
+
+commit 9e892736ff0b04c5af5775d09155e392c76f7aae
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Thu Jul 2 22:18:50 2020 +0200
+
+    parse: remove a forgotten debug message
+
+commit 51113450e8e653cf8261a8d09dc204a45c10b61a
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Thu Jul 2 22:16:21 2020 +0200
+
+    snmpwalk/snmpbulkwalk: flush stdout buffers before bailing out on stderr
+
+commit 2e927ad46cce5eeaeb346d638e46d409e8220a79
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Thu Jul 2 22:08:22 2020 +0200
+
+    IANA updates for IANAifTypeMIB and IANA-ADDRESS-FAMILY-NUMBERS-MIB
+
+commit 30238618812171bed934fe8fac629ad6ae22c75e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Jul 2 11:18:00 2020 -0700
+
+    testing: Skip tests T055 and T056 on OS/X
+    
+    These tests fail when building with Xcode 12, so skip these tests.
+
+commit 043b61801987d70cb5aa01280950afde1d5b061e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 1 11:05:41 2020 -0700
+
+    Darwin: Only include mibII/{ipAddr,var_route} if struct in_ifaddr is available
+    
+    This patch fixes the following build error for Xcode 12 and later:
+    
+    libtool: compile:  gcc -I../../include -I. -I../../agent -I../../agent/mibgroup -I../../snmplib -I/usr/local/opt/openssl@1.1/include -D_GNU_SOURCE -D_ALL_SOURCE -D_THREAD_SAFE -D__EXTENSIONS__ -DNETSNMP_ENABLE_IPV6 -fno-strict-aliasing -DNETSNMP_REMOVE_U64 -Udarwin19 -Ddarwin19=darwin19 -Wall -Wextra -Wstrict-prototypes -Wwrite-strings -Wcast-qual -Wno-missing-field-initializers -Wno-sign-compare -Wno-unused-parameter -Wno-type-limits -Wno-deprecated-declarations -c mibII/ipAddr.c  -fno-common -DPIC -o mibII/.libs/ipAddr.o
+    1480mibII/ipAddr.c:206:29: error: variable has incomplete type 'struct in_ifaddr'
+    1481    static struct in_ifaddr in_ifaddr, lowin_ifaddr;
+    1482                            ^
+
+commit af3e76ce47f84bc37f8a20718d4e63aa8491d0f4
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 1 19:31:41 2020 -0700
+
+    ucd-snmp/extensible.h: Add config_require(ucd-snmp/pass)
+    
+    Since this module calls pass_compare(), add a dependency on ucd-snmp/pass.
+    This patch fixes the following runtime error on Darwin:
+    
+    dyld: Symbol not found: _pass_compare
+      Referenced from: /Users/travis/build/bvanassche/net-snmp/agent/.libs/libnetsnmpmibs.40.dylib
+      Expected in: flat namespace
+     in /Users/travis/build/bvanassche/net-snmp/agent/.libs/libnetsnmpmibs.40.dylib
+
+commit ebf93f489b42bbeeebd7b3e3bb8726cb8175fa2e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 1 19:29:38 2020 -0700
+
+    UCD-SNMP: Remove two superfluous casts
+
+commit 9d123ce7407d8f46136bdbcab31205f95f997422
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 1 10:24:22 2020 -0700
+
+    ci/net-snmp-configure: Only build Python modules if Python3 is available
+
+commit c06e6ce53f85746a414cd79b1a9c4e66cdc31bf8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Jun 30 19:15:49 2020 -0700
+
+    Darwin: Detect <crt_externs.h>, _NSGetArgv() and _NSGetExecutablePath()
+
+commit 300ae4c59c4e60eaf679af69f3e17150c8cbf5ce
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Jun 30 16:58:52 2020 -0700
+
+    ci: Test more Darwin versions
+
+commit 31a2c8065db102c876937ff64ee90c60b516d945
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jun 29 12:35:02 2020 -0700
+
+    libsnmp: Change several constants from unsigned char into unsigned int
+    
+    The C language requires that the operands of a bitwise or expression
+    are promoted before the bitwise OR happens. From the C standard:
+    "The following may be used in an expression wherever an int or unsigned int
+    may be used:
+    - An object or expression with an integer type (other than int or unsigned
+      int) whose integer conversion rank is less than or equal to the rank of
+      int and unsigned int.
+    - A bit-field of type _Bool , int, signed int, or unsigned int.
+    
+    If an int can represent all values of the original type (as restricted by
+    the width, for a bit-field), the value is converted to an int; otherwise,
+    it is converted to an unsigned int. These are called the integer promotions.
+    All other types are unchanged by the integer promotions."
+    
+    In other words, the result of a bitwise OR of two unsigned char operands
+    has type 'int' instead of unsigned int. Hence change the type of constants
+    in header files from unsigned char into unsigned int.
+    
+    See also https://github.com/net-snmp/net-snmp/issues/142.
+
+commit 3df7a6ac1e0c652839446ebb53ff6f8cc14f7084
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jun 29 12:41:31 2020 -0700
+
+    agent/mibgroup/agentx/master_admin.c: Fix indentation
+    
+    This patch fixes the following clang compiler warning:
+    
+    mibgroup/agentx/master_admin.c:449:2: warning: misleading indentation; statement is not part of the previous 'if' [-Wmisleading-indentation]
+            if (pdu->contextName != NULL)
+            ^
+    mibgroup/agentx/master_admin.c:434:5: note: previous statement is here
+        if (!var || snmp_oid_compare(var->name, var->name_length,
+        ^
+
+commit 9963ec1be6c595205773b4177b5931ca550b1f79
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jun 28 19:44:39 2020 -0700
+
+    Introduce usm_build_user()
+    
+    This patch does not change any functionality.
+
+commit 2abda404ae805b1c369b0e68a2e489b3996f0ba0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jun 28 15:23:52 2020 -0700
+
+    testing/fulltests/default/T0222snmpv3bulkget_simple: Remove the IF-MIB::ifEntry test
+
+commit 24a8b092cce342d62a477394c60f572e49a90197
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jun 28 14:36:10 2020 -0700
+
+    Add test T0222snmpv3bulkget_simple
+    
+    See also https://github.com/net-snmp/net-snmp/issues/141.
+
+commit a0932b73ea0851308ca3e797caa600192cc3508a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jun 27 19:49:03 2020 -0700
+
+    CHANGES: Bump libsnmp version from 35.0.1 to 40.0.0
+    
+    Several functions and one data structure have been removed from header
+    file include/net-snmp/library/snmpusm.h. Hence bump the libsnmp version
+    number. For the previous libsnmp version bump, see also 1b3ef39cb7a3
+    ("version update for 5.8.1.pre1").
+
+commit 576788a0a9400da517ddb8ceb33a742f552a1408
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Jun 25 20:57:05 2020 -0700
+
+    libsnmp: Remove usm_clone_usmStateReference() from the public interface
+    
+    Since this function is only used inside the USM implementation, remove
+    its declaration from the public interface.
+
+commit 46f755fe4e6c2a919eebae0c55495f5f1207d06c
+Author: Ramin Moussavi <lordrasmus@gmail.com>
+Date:   Tue Jun 9 13:42:50 2020 +0200
+
+    pingCtlTable: Move two more global variable definitions from .h to .c
+
+commit 611149a879ef581454ffdd8637633197607750ff
+Author: Jonas Bülow <jonas.bulow@gmail.com>
+Date:   Mon Jun 1 10:09:53 2020 +0200
+
+    libsnmp: Remove an obsolete keyword from a header file
+    
+    This allows compilation using C++17 where the register keyword is obsoleted.
+    
+    Also, the register keyword is in general never necessary.
+    
+    [ bvanassche: edited commit message ]
+
+commit 327079a4ae20e2d4766fe549a6e4e57fbe947bcd
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 26 06:38:53 2020 -0700
+
+    HOST-MIB, hr_filesys: Also monitor tmpfs
+    
+    See also https://sourceforge.net/p/net-snmp/feature-requests/165/,
+    https://bugs.debian.org/685877 and
+    https://gitlab.alpinelinux.org/alpine/aports/issues/932.
+    
+    Fixes: 2dfdd7cb73ec ("Better file system types") # v5.7
+    Reported-by: Craig Small <csmall@dropbear.xyz>
+
+commit 22e1371bb1fd4a502fc1065fb5aa6b6df8a6d0d2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 26 07:19:07 2020 -0700
+
+    HOST-MIB, hr_filesys: Convert recursion into iteration
+
+commit 9238c0df6044f399f33e51c3bea89ee321b2882d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 26 07:34:51 2020 -0700
+
+    HOST-MIB, fsys: Remove definitions that have been commented out
+
+commit a3ef7905e83320f834ef335d121948d6e7d58ff8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri May 15 07:13:37 2020 -0700
+
+    MIB-II: Declare local symbols static
+
+commit 93a9f7f32612aa041e150b0d897ba3cdfda6e1db
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri May 15 07:10:20 2020 -0700
+
+    MinGW64, MIB-II: Fix a linker error
+    
+    Fix the following linker error:
+    
+    ld.exe: ./.libs/libnetsnmpmibs.a(var_route.o):var_route.c:(.bss+0x8): multiple definition of `create_flag'; ./.libs/libnetsnmpmibs.a(at_iphlpapi.o):at_iphlpapi.c:(.bss+0x8): first defined here
+
+commit 68a8dcd937ca9d69764f20e495b1723d818d12b7
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 14 20:28:53 2020 -0700
+
+    ci/net-snmp-run-python-tests: Use Python3 interpreter
+
+commit c01c5544bf02a139a3d103eead3c92378e75f737
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 14 20:26:28 2020 -0700
+
+    python: Define PY_SSIZE_T_CLEAN
+    
+    See also https://docs.python.org/3/c-api/arg.html .
+
+commit e4a4f0abca261bb62ea97c275223cf604b23288d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 14 19:28:43 2020 -0700
+
+    python: Improve Python3 port
+    
+    See also https://github.com/net-snmp/net-snmp/issues/80.
+    
+    [ bvanassche: Removed commented out code and fixed compiler warnings ]
+
+commit 6a8ede044a269f2c10a6463e96d03709bb974151
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri May 8 19:32:52 2020 -0700
+
+    Python: Fix compiler warnings
+
+commit 5de21610ff249d456c42530d0b8179bf1420a0e0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri May 8 19:10:48 2020 -0700
+
+    perl/SNMP/t/bulkwalk.t: Improve the reliability of this test
+    
+    Use ok($a, $b) instead of ok($a eq $b) to make error reporting more
+    informative. Unbless $list[3] before iterating over it to make this
+    test passs on DragonFly BSD. In the loop that looks for the loop
+    network adapter, check whether the index of that adapter is numeric
+    instead of comparing it with one.
+
+commit 8bdae3bf48b3e80e148c2b20dc0f284119dc4548
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri May 8 21:41:52 2020 +0000
+
+    perl/SNMP/t/bulkwalk.t: Make this test easier to debug
+
+commit 57936ba304d18e6c23f31b242ff6d0a95e846c4f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri May 8 19:33:10 2020 -0700
+
+    libsnmp: Declare the arguments of netsnmp_transport_create_config() const
+
+commit 78beea8ef011702c026fdb3b32f118edcd2d6de4
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 5 08:25:55 2020 -0700
+
+    configure: Do not use -Wl,-no-undefined if -fsanitize= has been specified
+    
+    Apparently these two compiler flags are incompatible. This patch should
+    fix the following build failure:
+    
+    https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=22010
+
+commit 2d6ccd92f16a0ea2cf03ff26bdbdc46f0c93e4f8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 5 07:49:58 2020 -0700
+
+    configure: Ignore the krb5_config -flto=auto flag
+    
+    -flto=auto is incompatible with clang, hence ignore that compiler flag.
+
+commit fd2f267370435996eca54be70525f592fec3f0d8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon May 4 17:32:30 2020 -0700
+
+    libsnmp: Declare decode_keychange() input arguments const
+
+commit 998a1686cbc202d2a5f3b4bc3933719cb13aaebd
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon May 4 15:11:59 2020 -0700
+
+    snmpd: Fix a buffer overflow triggered by processing "getnext"
+    
+    This patch fixes the following Valgrind complaint:
+    
+    Invalid write of size 8
+       at 0x4864DD4: netsnmp_scalar_helper_handler (scalar.c:225)
+       by 0x4872008: netsnmp_call_handler (agent_handler.c:546)
+       by 0x4872369: netsnmp_call_next_handler (agent_handler.c:660)
+       by 0x48655B6: netsnmp_serialize_helper_handler (serialize.c:86)
+       by 0x4872008: netsnmp_call_handler (agent_handler.c:546)
+       by 0x487219C: netsnmp_call_handlers (agent_handler.c:631)
+       by 0x4881D52: handle_var_requests (snmp_agent.c:3012)
+       by 0x488245A: handle_getnext_loop (snmp_agent.c:3502)
+       by 0x4882D97: handle_pdu (snmp_agent.c:3849)
+       by 0x4882F03: netsnmp_handle_request (snmp_agent.c:3685)
+       by 0x48835AB: handle_snmp_packet (snmp_agent.c:2294)
+       by 0x4C53CA7: _sess_process_packet_handle_pdu (snmp_api.c:5809)
+       by 0x4C5409F: _sess_process_packet (snmp_api.c:5858)
+       by 0x4C5443C: _sess_read (snmp_api.c:6115)
+       by 0x4C55009: snmp_sess_read2 (snmp_api.c:6387)
+       by 0x4C55046: snmp_read2 (snmp_api.c:5907)
+       by 0x403E43: receive (snmpd.c:1311)
+       by 0x405765: main (snmpd.c:1089)
+     Address 0x63a0908 is 0 bytes after a block of size 72 alloc'd
+       at 0x483877F: malloc (in /usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)
+       by 0x4C5002E: snmp_duplicate_objid (snmp_api.c:7844)
+       by 0x4872992: netsnmp_handler_registration_dup (agent_handler.c:844)
+       by 0x487575C: netsnmp_subtree_deepcopy (agent_registry.c:524)
+       by 0x4875B61: netsnmp_subtree_split (agent_registry.c:660)
+       by 0x487666F: netsnmp_subtree_load (agent_registry.c:940)
+       by 0x48766A4: netsnmp_subtree_load (agent_registry.c:947)
+       by 0x48766A4: netsnmp_subtree_load (agent_registry.c:947)
+       by 0x48766A4: netsnmp_subtree_load (agent_registry.c:947)
+       by 0x48770A4: netsnmp_register_mib (agent_registry.c:1214)
+       by 0x4872655: netsnmp_register_handler (agent_handler.c:318)
+       by 0x48656AB: netsnmp_register_serialize (serialize.c:56)
+       by 0x4864F07: netsnmp_register_scalar (scalar.c:98)
+       by 0x48712FC: netsnmp_register_watched_scalar2 (watcher.c:211)
+       by 0x49822AC: _register_extend (extend.c:221)
+       by 0x4982870: extend_parse_config (extend.c:576)
+       by 0x4C65EAD: run_config_handler (read_config.c:541)
+       by 0x4C66D19: read_config (read_config.c:960)
+       by 0x4C67422: read_config_with_type_when (read_config.c:481)
+       by 0x4C6770A: read_configs_optional (read_config.c:1018)
+       by 0x4C6809D: read_configs (read_config.c:1049)
+       by 0x4C55418: init_snmp (snmp_api.c:907)
+       by 0x405013: main (snmpd.c:911)
+
+commit 836cd352bb43f3e1483a0e4937c5f05f6eab1eb9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon May 4 08:35:45 2020 -0700
+
+    libsnmp, snmpd: Handle PDU cloning failures
+
+commit 644a9aa6f4816f5739161c674b793a28d99f69c3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon May 4 10:53:54 2020 -0700
+
+    libsnmp: Declare USM input parameters const
+
+commit a9219e3ecee5ce0cafdcbfaee50ac70ef290fc5b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon May 4 09:13:00 2020 -0700
+
+    libsnmp: Declare the usm_get_user() arguments const
+
+commit 7d27dd105f2633f4dfa3e3ee0a7689e5a5752b13
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon May 4 07:49:33 2020 -0700
+
+    libsnmp, snmpd: Fix two potential buffer overflows
+    
+    Both bugs were introduced before 2001.
+    
+    See also https://github.com/net-snmp/net-snmp/issues/110 .
+
+commit 6c4fe0e446d3da50ed5ca8bd79f8949f0b803ddd
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon May 4 07:45:56 2020 -0700
+
+    libsnmp: Declare a build_oid_noalloc() input argument const
+
+commit a5495798fa1e18f819a5e54f06deefe5fb798942
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun May 3 20:14:59 2020 -0700
+
+    snmpd: Remove a dead assignment
+    
+    Additionally, remove an explicit \0-termination because snprintf() is
+    required to do \0-termination (see also
+    https://pubs.opengroup.org/onlinepubs/9699919799/functions/fprintf.html).
+    
+    This patch fixes the following Coverity complaint:
+    CID 144418 (#1 of 1): Unused value (UNUSED_VALUE)
+    assigned_pointer: Assigning value from cur + snprintf(cur, ep - cur, " %i %i \"%s\" %s %i %i", curr_struct->timeout, curr_struct->retryCount, curr_struct->tagListData, curr_struct->paramsData, curr_struct->storageType, curr_struct->rowStatus) to cur here, but that stored value is overwritten before it can be used.
+
+commit 5ab2436f775bcd1de1ed86fd5a39d55b4f30ea4f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun May 3 19:52:23 2020 -0700
+
+    agent/mibgroup/agent/extend.c: Remove dead code
+    
+    This patch fixes the following Coverity complaint:
+    
+    arith_non_null: The result of pointer arithmetic compatability_entries + idx is never null.
+    dead_error_condition: The condition exten must be true.
+    
+    Fixes: 436bfa49439f ("Backwards-compatability implementation of the UCD-SNMP-MIB::extTable (if the ucd-snmp/extensible module isn't configured in).")
+
+commit 559b8f5f9fdc66cf7612a31ff1a52825546f4f60
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun May 3 16:02:24 2020 -0700
+
+    AIX: Also define aix4 on AIX5 and AIX6
+    
+    This patch allows to simplify the test defined(aix4) || defined(aix5) ||
+    defined(aix6) into defined(aix4).
+
+commit aebf5909df24692e1a03327ba2e49581a8574aa8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun May 3 16:23:44 2020 -0700
+
+    configure: Improve the MIT crypto API check
+
+commit fc7002ecced1329b62238f6278576b11846da173
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun May 3 14:26:17 2020 -0700
+
+    AIX: Fix one build error and also a compiler warning
+    
+    n_name is a #define on AIX and hence using 'n_name' as a variable name
+    triggers a compiler error.
+
+commit ee7eed065f652ccfc58cade8aef5848073cce7bf
+Author: Bart Van Assche <bart@localhost>
+Date:   Sat May 2 17:21:41 2020 -0700
+
+    kFreeBSD: Fix the build
+    
+    See also https://github.com/net-snmp/net-snmp/issues/103.
+
+commit f44565fc195698e8b79fdd905c17217f0e493196
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun May 3 11:21:10 2020 -0700
+
+    Suppress recently introduced compiler warnings about close() not being declared
+
+commit cb9b87d9b6e2b925065bf9cf700f9c44e5462d93
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 2 08:44:10 2020 -0700
+
+    Always use -Wl,-no-undefined when linking a shared library
+    
+    Undefined symbols in a Net-SNMP shared library indicate a bug. Make sure
+    that this is detected at link time instead of at run time.
+
+commit 1fe4c024aa8e7d1e493039c3e1ca91dd06ffc5be
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 2 09:26:37 2020 -0700
+
+    configure: Add -lkrb5 to LNETSNMPLIBS instead of LIBS
+    
+    Only the Net-SNMP library needs to be linked with the Kerberos libraries.
+    Link with libk5crypto if necessary.
+
+commit dfa82c4810b68181cb70fef07a7e8000beb98262
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 2 07:13:29 2020 -0700
+
+    FreeBSD: Use the freebsd3 macro instead of __FreeBSD__
+    
+    Use the 'freebsd3' macro to guard code that is FreeBSD-specific. This will
+    make it easier to fix the build for kFreeBSD. Note: the freebsd3 macro is
+    defined if the FreeBSD version is >= 3.
+
+commit 7c562f9b61397d8174b41c13244d2c69d729e13b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 2 08:24:40 2020 -0700
+
+    perl/SNMP/t/notify.t: Make this test more robust
+
+commit 15737583d5271f398a38b2f11f900fbd73a7025b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 2 08:17:40 2020 -0700
+
+    UCD-SNMP-MIB: Move an include directive and a few constants into proc.c
+
+commit 05c6c29c2c458261605fee8d3a8d59c97bba2878
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 2 08:10:29 2020 -0700
+
+    ci/net-snmp-configure: Build without MySQL support
+
+commit ca585bbbae9e4831a6e622bfb9356689187bea70
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 30 07:38:35 2020 -0700
+
+    ci/net-snmp-run-tests: Fix the test that verifies whether Perl modules have been enabled
+
+commit b323fe9f83ff070244f00363d5493b9528e4300d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 30 10:09:07 2020 -0700
+
+    perl/SNMP/t/bulkwalk.t: Improve the robustness of this test
+    
+    Instead of only examining the network interface that occurs first in the
+    interfaces table, examine all network interfaces.
+
+commit d589ab4eab9aa5f21290ae9e20fb4f8d0c75f105
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 30 17:01:20 2020 -0700
+
+    perl/TrapReceiver/t/1.t: Use ok() instead of print()
+
+commit 93c22da673e88a72d59e1d6e66a8d4836f9c6828
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 30 11:52:16 2020 -0700
+
+    perl/ASN/test.pl: Convert to the Perl Test framework
+
+commit 6c9f36b09b8a6486eb09f7496e5a73df18905a2f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 27 17:14:58 2020 -0700
+
+    perl/MakefileSubs.pm: Define the MinGW compiler flags correctly
+
+commit e227abee97c3d43c53e5082c94892fc904780ffd
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 30 07:17:30 2020 -0700
+
+    perl/MakefileSubs.pm: Remove -Iinclude/net-snmp from the Windows flags
+    
+    Remove include/net-snmp from the include path because it is not used.
+
+commit 9f176cbee62338b2fb19de6165c4ae4f8799c822
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 30 07:20:10 2020 -0700
+
+    agent/snmp_perl.c: Remove an obsolete definition
+    
+    _WIN32_WINNT is either defined by the configure script (MinGW, Cygwin) or
+    by win32/Configure (MSVC).
+
+commit bbd745acaf022524b9ae686953ea010d98c68ec5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 30 08:02:39 2020 -0700
+
+    configure: Simplify the size_t format specifier check
+    
+    Assume that Unix compilers are ANSI C compliant and use the 'z' format
+    specifier on Unix. Only check for the underlying type of size_t on
+    MinGW. Remove the unused NETSNMP_PRI32 format specifier.
+
+commit 108cce420ee10857d0d9407f0f5b45b6e7c0fc48
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 18:36:45 2020 -0700
+
+    ci/build.bat: Check whether make perl_test succeeded for the MSVC build
+
+commit 93fe38cf5f7cdf339df48d94caff140c91e50ac7
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 14:35:34 2020 -0700
+
+    perl/SNMP/Makefile.PL: Simplify GetTestInfo()
+
+commit 50eeb76544810cf8fbcde94a2696519ba3e8acf3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 12:01:36 2020 -0700
+
+    perl/SNMP/t/dump-session.t: Call snmptest_cleanup() after the test has finished
+
+commit e69984355cfd0d4bedd4077367f3a3c89de72109
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 11:04:22 2020 -0700
+
+    perl/SNMP/t/startagent.pl: Improve kill_by_pid_file robustness
+
+commit 905ab798cf6a419bafa68d29f6b262a21d3a382f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 12:13:10 2020 -0700
+
+    perl/SNMP/t/startagent.pl: Make starting processes faster
+
+commit e2349372287809b518dc76e16b4e0602dffeca21
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 09:51:04 2020 -0700
+
+    perl/default_store/test.pl: Convert to the Perl Test framework
+
+commit 498b243e35d105d72ee205e42d17fd4505f99b25
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 10:51:20 2020 -0700
+
+    Perl tests: Use $mibdir instead of ../../mibs
+
+commit b16a0e0d917bf2cbd32e5dc95b73d7e5407533a9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 15:18:44 2020 -0700
+
+    perl/SNMP/t/startagent.pl: Split this Perl script
+
+commit f253df86c4560d762cc22f8234cd879d9b143b1e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 08:20:38 2020 -0700
+
+    Perl tests: Enable 'use strict' and 'use warnings'
+
+commit 917b0f281c31ab152528e6dc4e5c2ab5027d5353
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 09:53:24 2020 -0700
+
+    Perl tests: do not modify @INC
+
+commit dc43e75282c7b5de51463964571e5f6b633c582f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 12:50:30 2020 -0700
+
+    ci/perl.bat: Suppress two uninteresting Visual Studio compiler warnings
+
+commit bc2a9a7fedf8a99073a4e5cb4872124101abd3d8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 10:24:41 2020 -0700
+
+    win32/Makefile.in: Tell the Perl DynaLoader where to find netsnmp.dll
+
+commit 5bacc9af2baa5a5a02b0e3ffc6abf963adff6a71
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 13:30:38 2020 -0700
+
+    snmpd: Do not open /dev/kmem on Linux even if libelf-devel has been installed
+    
+    See also f1647e3db242 ("snmpd: Do not open /dev/kmem on Linux")
+
+commit 59e8b5b28db8bed05d68c4d508a89932437e9cb6
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 11:46:50 2020 -0700
+
+    snmpd: Make init_kmem() report "success" if /dev/kmem is not opened
+    
+    Fixes: f1647e3db242 ("snmpd: Do not open /dev/kmem on Linux")
+
+commit 595751cdf7b74083631b2ffd335be45f0b691a88
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 29 07:38:50 2020 -0700
+
+    ci/build.bat: Unbreak the MSVCSTATIC64 build
+    
+    This patch fixes the following error that is triggered by the win32/Configure script:
+    
+    Can't locate ExtUtils/Embed.pm in @INC (you may need to install the ExtUtils::Embed module) (@INC contains: /usr/lib/perl5/site_perl /usr/share/perl5/site_perl /usr/lib/perl5/vendor_perl /usr/share/perl5/vendor_perl /usr/lib/perl5/core_perl /usr/share/perl5/core_perl) at Configure line 9.
+
+commit d84f0c6e160951318a35e72fe76ef2e0ffd91044
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 28 20:42:46 2020 -0700
+
+    Windows, MSVC: Fix Perl module compilation
+    
+    This patch fixes the following error message:
+    
+    default_store.c: loadable library and perl binaries are mismatched (got handshake key 0000000010500080, needed 0000000010A00080)
+    
+    See also https://github.com/net-snmp/net-snmp/issues/104.
+
+commit 42aa220a7d3d686eb91bfd354c9b5094afbe6d97
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 28 15:55:59 2020 -0700
+
+    ci/build.bat, MSVC: Run Perl tests
+
+commit a4a8a70dbef581a30c3ba814de39b514f76072f8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 28 15:40:59 2020 -0700
+
+    Perl: Use $Config{path_sep} instead of ';' for Windows
+
+commit 4990ca1af1d16a3e3144d455cb1e41108f00b691
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 28 14:50:44 2020 -0700
+
+    win32/Makefile.in: Set PERL5LIB before running tests
+    
+    This is necessary to let the Perl interpreter find the Net-SNMP Perl modules.
+
+commit 0e33f5025a483e4d724b6e417e8ef6b0788819e9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 28 18:14:17 2020 -0700
+
+    testing/RUNFULLTESTS: Fix the --with-perl-modules test
+
+commit e621ae3038c82f92666c37da9c0e2ceb09df93f0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 28 13:58:30 2020 -0700
+
+    testing/RUNFULLTESTS: Fix PERL5LIB
+    
+    Fixes 5a86cfb005db ("testing: Unbreak RUNFULLTESTS").
+
+commit 61822884421eae193ca9fd1f55da488000480789
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 28 13:53:12 2020 -0700
+
+    ci/build.bat: Fix a comment
+
+commit 467c5ee95ba804275e719a4848d2d46f18a9eee1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 25 15:54:06 2020 -0700
+
+    ci, .appveyor.yml: Switch to Visual Studio 2019 image
+
+commit f7ae854c12c35c2561979873e53d217da688e809
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 28 13:09:14 2020 -0700
+
+    win32/dist/build-binary.pl: Remove the dependency on File::Which
+    
+    File::Which is a CPAN module and hence is not present in the core Perl
+    distribution.
+    
+    Fixes: ed630cf540f6 ("win32/dist/build-binary.pl: Search %PATH% for tar.exe and gzip.exe")
+
+commit 4f61570bca1d765bfdb11c6010c887cbe3176f29
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 28 13:33:44 2020 -0700
+
+    ci/build.sh: Install MSYS Perl MakeMaker and Test-Harness
+
+commit 62fb93df0641b4beed3db28d594ca1f87ec63b0c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 27 21:50:53 2020 -0700
+
+    ci/AppVeyor: Reduce build time
+    
+    Only download and build Perl when building with the Visual Studio
+    compiler and for dynamic builds. Otherwise use the Perl interpreter that
+    is included with the development environment (MinGW or Cygwin).
+
+commit 8df783a81996f03e2927fe0f56182ab0250e317e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 27 13:06:09 2020 -0700
+
+    ci/build.bat: Fail if win32/Configure fails
+
+commit aea52476b536d85f42a31d05a2bb5bcefe484823
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 27 12:45:17 2020 -0700
+
+    win32/Makefile.in: Set NET-SNMP-PATH
+
+commit bb8923f55329276debe86f787e3a0edd537c308f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 27 15:17:40 2020 -0700
+
+    perl/SNMP/Makefile.PL: Use NET-SNMP-PATH if it has been set
+    
+    Additionally, ignore the unused NETSNMP_PREFIX environment variable.
+
+commit 4d614474f9157809d8a5ab8c265246e5b2e56374
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 27 13:22:39 2020 -0700
+
+    perl/MakefileSubs.pm: Restore support for the -NET-SNMP-PATH option
+    
+    Fixes: 273cd3379613 ("perl Makefiles: MinGW / MSYS fixes")
+
+commit 93299804393dd777ec1a188807bb4f664475eac0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 27 17:29:35 2020 -0700
+
+    perl/Makefile.PL: Simplify this file
+
+commit 5135d509ed8bb1ac69b50f5980d97b237efb4f29
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 27 11:27:54 2020 -0700
+
+    ci/perl.bat: Make this batch file compatible with Windows tar
+
+commit 04adea6a0f33286e9b884f498989d26fbf28e896
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 27 11:18:04 2020 -0700
+
+    ci/perl.bat: Bump Perl version
+
+commit 0be093688013b90896f2db3204bb20e790d70149
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 27 08:23:16 2020 -0700
+
+    configure: Report supported authentication and encryption modes correctly
+    
+    Commit 9e49de2e03b1 ("NEWS: snmplib: AES-192/AES-256 compatibility with SNMP
+    Research / CISCO") removed SHA-128 and SHA-192 support and added support for
+    SHA-224, SHA-256, SHA-384 and SHA-512. Commit 329a9d3c9d63 ("revamp auth/priv
+    protocol constants handling") added support for several AES encryption modes.
+    Make the configure script report which modes are supported.
+
+commit 05739bdb63ef192bf9e9130fbc9b560baa8852ec
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Apr 24 10:16:07 2020 -0700
+
+    CHANGES: Windows, MSVC: snmpd: Switch from mibII/interfaces to if-mib/ifTable
+    
+    Provide IF-MIB::ifTable and IF-MIB::ifXTable through the agent instead of
+    MIB-II::ifTable. This matches the default behavior of the Linux SNMP agent.
+    
+    From the IF-MIB: "This MIB is an updated version of MIB-II's ifTable".
+
+commit 0c880d6f7a2bcb4a4a6f93c4dc577f9bc22c6e6a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 26 12:04:20 2020 -0700
+
+    Windows, include/net-snmp/types.h: Fix socklen_t type definition
+
+commit f1647e3db24241f0c42449506aee4b406a37b1b5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 26 11:10:46 2020 -0700
+
+    snmpd: Do not open /dev/kmem on Linux
+    
+    The Net-SNMP agent only uses /dev/kmem to access kernel data structures on
+    BSD systems. Hence do not open /dev/kmem on Linux. A side effect of this
+    patch is that it enables cross-compilation from Linux to MinGW. /dev/kmem
+    exists on Linux but the code in agent/kernel.c that is surrounded with
+     #ifdef HAVE_KMEM / #endif does not build with the MinGW compiler.
+
+commit 9ee2a5ccf50098f8e7371051e878b169b1e58cc3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 26 11:36:40 2020 -0700
+
+    agent/mibgroup/host/hr_disk.c: #include <unistd.h>
+    
+    Fixes: e91559e38d23 ("Net-SNMP include files: Minimize #include directives")
+
+commit b7f44bbdbe484bd03b438595e7c6b58eda005897
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 26 09:33:51 2020 -0700
+
+    Cygwin, MIB-II: Fix a few compiler warnings
+
+commit 8e9dfcc27b6cdb538ec4a4d5596641a88dd8a2d9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 26 08:04:46 2020 -0700
+
+    Cygwin, IF-MIB: Temporarily disable the iphlpapi implementation
+    
+    Making the iphlpapi implementation compatible with Cygwin requires more
+    work. Hence temporarily disable the iphlpapi implementation for Cygwin.
+
+commit dcec69ba971388d1da74acd1ca514e1c14ed8fa2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 25 19:39:21 2020 -0700
+
+    Windows, IF-MIB: Minimize #include directives
+    
+    This prevents a conflict on Cygwin between the Cygwin socket header files
+    and the Winsock header files.
+
+commit e91559e38d230934c9b10fe0f0a51394e008dda9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 25 19:30:45 2020 -0700
+
+    Net-SNMP include files: Minimize #include directives
+    
+    Move several #include directives from Net-SNMP include files into .c files.
+
+commit 6945b208a74aabe9acebdae7e4642038ab8e1c96
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 25 11:58:48 2020 -0700
+
+    include/net-snmp/system/cygwin.h: Simplify this file
+
+commit 8c686545d71894d1ba5b7eef846d559dae9fe06e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 25 15:53:06 2020 -0700
+
+    ci, .travis.yml: Use OS/X 10.14
+
+commit 193062739789a63affe09d2eb80affd57157b233
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 25 10:18:39 2020 -0700
+
+    Net-SNMP headers: Move in_addr_t definition into <net-snmp/net-snmp-config.h>
+    
+    This allows to remove #include <netinet/in.h> from <net-snmp/types.h>.
+    That change allows to include <net-snmp/net-snmp-config.h> from source
+    files that include Winsock header files. Cygwin BSD socket header files
+    conflict with Winsock header files.
+    
+    See also commit a7f53c44a53d ("move include for in_addr_t to net-snmp/
+    types.h, where in_addr_t is defined for systems w/out netinet/in.h").
+
+commit b3d2d0896a67be6f8fbbd2f025e077ba293a52a5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 25 10:14:18 2020 -0700
+
+    Net-SNMP headers: Only include <sys/time.h> if necessary
+    
+    Minimizing #include directives reduces the build time.
+
+commit e981bcbab5034ccd9cf8445d4ba60d1420b23b3d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 25 07:59:04 2020 -0700
+
+    IF-MIB: Unbreak the MinGW32 build
+    
+    Fixes: c33140b0110c ("Win32, IF-MIB: Implement interface table support")
+
+commit 72405d2efb5874f48b6871ac0197d86d0e4f109c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 25 08:51:21 2020 -0700
+
+    apps/Makefile.in: Make this Makefile again compatible with non-GNU make implementations
+    
+    'ifneq' is a GNU extension. Instead of using 'ifneq', use a mechanism that is
+    compatible with GNU make.
+    
+    Fixes: 71f46f7126b4 ("apps: Only build snmpps and snmptop if a curses library is available")
+
+commit 5c209f9a6fe444b13d7c39eac12f5390e5e5fcb4
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Apr 24 21:46:40 2020 -0700
+
+    Darwin: Add support for Darwin versions 18..21
+    
+    See also https://github.com/net-snmp/net-snmp/issues/101.
+
+commit c33140b0110cead76039da6d985878ea9d05b2fd
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 23 18:10:39 2020 -0700
+
+    Win32, IF-MIB: Implement interface table support
+    
+    On Windows Vista, Windows 2008 and later the ifOperStatus information is
+    more accurate than on older Windows versions.
+
+commit 026348ef082d3bda5f2b394002b1d770d71ccec3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Apr 24 16:42:34 2020 -0700
+
+    Windows: Increase _WIN32_WINNT to 0xffff
+    
+    Instead of restricting the Windows features to a certain version of the
+    Windows API, enable all Windows API functionality.
+
+commit d560f542c0853fdfef2bf9cdf0365ac75dfdf40b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 22 19:27:26 2020 -0700
+
+    MIBs: Remove the NETSNMP_INCLUDE_IFTABLE_REWRITES and NETSNMP_ACCESS_INTERFACE_NOARCH macros
+    
+    Switch all platforms to the rewritten ifTable implementation. Instead of defining
+    NETSNMP_ACCESS_INTERFACE_NOARCH if no data access implementation is available, use
+    the "unsup" dummy implementation.
+
+commit e86230436ea0d3126a4525a98ff7dde60cd448b1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 21 09:48:31 2020 -0700
+
+    Windows, IF-MIB: Switch to the rewritten ifTable implementation
+    
+    Since the IF-MIB is not yet implemented on Windows, all switching to the rewritten
+    ifTable implementation involves is to provide a dummy implementation of the data
+    access functions.
+
+commit d15cae3cb7e2eb5a1cfea8832d530fb81c317858
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 21 10:13:27 2020 -0700
+
+    IF-MIB: Fix the build for the case !defined(HAVE_PCRE_H) && !defined(HAVE_REGEX_H)
+
+commit 4803af75945291ee7ad270d93425781e9e79f3f1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 21 15:04:39 2020 -0700
+
+    ci/openssl.bat: Bump the OpenSSL version
+
+commit 71f46f7126b4f5cf1858d16be633a0d7a2002e6d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 21 08:34:44 2020 -0700
+
+    apps: Only build snmpps and snmptop if a curses library is available
+    
+    Additionally, only search for curses header files if a curses library is available.
+
+commit 435ddb821bdae5950829d225d1c087784214d41c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Apr 21 07:53:15 2020 -0700
+
+    configure: Skip pcre.h check if --without-pcre has been specified
+    
+    Fixes: 213941dfbee6 ("CHANGES: agent: PATCH 3525595: from dhubler: Add support for finding processes via regex")
+
+commit 2f1c4d06bc49da5fc4a0fb7be373a8c6f9d3d4a6
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 20 14:40:13 2020 -0700
+
+    ci, FreeBSD: Improve the code that detects the OpenSSL version
+
+commit b59e896245d001ebc13c415c86fb8c203b639f07
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 20 13:44:31 2020 -0700
+
+    ci, MinGW: Build HOST-MIB
+
+commit 90ea93b038ea0f70a78f315d89f68d34615c1902
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jun 23 09:18:12 2018 -0700
+
+    tests: Rename SUCCESS() and FAILED()
+    
+    This is necessary to avoid conflicts with constants with the same
+    name in the Windows header files.
+
+commit c083ccbe9b365a06b7192be1d1b6a31695c677d1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 20 21:18:33 2020 -0700
+
+    MinGW, T008asn1_clib.c: Fix compiler warnings
+
+commit f78d56a80e89aaa36a6da2b7318c9e012badfef9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 20 21:13:13 2020 -0700
+
+    MinGW: Fix multiple compiler warnings
+
+commit c55a1421da1bed9acdbc08381744238aeca897c6
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 20 13:20:18 2020 -0700
+
+    agent/mibgroup/utilities/execute.c: Only define tokenize_exec_command() if necessary
+
+commit 1ff5be497f7ef551c26bf320aab995ece596cca9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 20 20:00:31 2020 -0700
+
+    MinGW, MIB-II: Fix a linker error
+
+commit fbb0e883abf2e3b2b021aabdc4e9ae56bba35ced
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 20 12:58:03 2020 -0700
+
+    MinGW: Fix agent/mibgroup/host/hr_system.c build
+
+commit 3074aa18898b0461bc06b61041382d9622e83cf7
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 20 12:52:30 2020 -0700
+
+    agent/mibgroup/host/data_access/swrun_null: Fix a compiler warning
+
+commit 3c9e5f2608eebacd31c4e08eabe11dbb183ee685
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 20 10:32:43 2020 -0700
+
+    MinGW: Fix cross-compilation
+    
+    Fix building for MinGW on a non-MinGW system (--host=x86_64-w64-mingw32). Add
+    LT_LANG([Windows Resource]). Use @RC@ instead of windres such that the proper
+    cross-compilation prefix is used in front of the windres executable.
+
+commit fda7c07b0ec3ab1384646548edd79e62138b71eb
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 20 11:19:08 2020 -0700
+
+    testing/fulltests/unit-tests/T008asn1_clib: Fix MinGW build
+
+commit 44fd72624285fd52337c97577d92b94333b8dadb
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 20 11:18:41 2020 -0700
+
+    apps/snmpping: Fix MinGW build
+
+commit 319f4d717fb9ab2ef0f7696d4afb348ed34054ae
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 18 20:16:52 2020 -0700
+
+    HOST-MIB: Reorder function definitions
+    
+    Reorder the function definitions in hw_fsys.c such that the forward function
+    declarations can be removed.
+
+commit 5732d8b3debdb149ea5f12d85b2804b41b98d22e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 18 19:54:49 2020 -0700
+
+    HOST-MIB: Declare _fsys_cache and _fsys_container static
+    
+    Neither _fsys_cache nor _fsys_container is used outside the source file these
+    variables are declared in. Hence declare these variables static.
+
+commit 3300c1f03e5899dc4301c39c104ff3cfbd840a79
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 18 18:46:09 2020 -0700
+
+    testing: Make the tests pass for --enable-minimalist and --enable-mini-agent
+
+commit 228cba5710b2213cf4bb5c2d60d56608f2497831
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 18 11:10:29 2020 -0700
+
+    testing: Add a test for "extend OID"
+    
+    See also https://github.com/net-snmp/net-snmp/issues/97 .
+
+commit 633b8214eeb6558519efdb18a5fea1e53b7f2ba3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 12 19:28:13 2020 -0700
+
+    libsnmp: Only define strcasecmp() and strncasecmp() if necessary
+
+commit ea4e62bf9242a2c4792bc60eb3fff0b97fa76060
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 12 04:12:43 2020 +0000
+
+    testing/fulltests/support/myip: Suppress Perl error messages
+    
+    Suppress the following error message:
+    
+    Constant subroutine main::AF_INET6 redefined at /System/Library/Perl/5.18/Exporter.pm line 66.
+     at (eval 1) line 2.
+    Prototype mismatch: sub main::AF_INET6 () vs none at /System/Library/Perl/5.18/Exporter.pm line 66.
+     at (eval 1) line 2.
+    usage:   sin_sv = sockaddr_in6(port,iaddr)) at ../support/myip line 39.
+
+commit cc2eece940c5e8508d635a1620eb1cddf25fd136
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 11 20:32:03 2020 -0700
+
+    ci/openssl.bat: Bump the OpenSSL version
+
+commit 5f1986c79e8b9d3d8574fc73001d6e193bed7c79
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 11 20:11:35 2020 -0700
+
+    HOST-MIB: Log statfs() failures once
+    
+    See also https://github.com/net-snmp/net-snmp/issues/94.
+
+commit c94fdd4084fdefafaebcd3421f1c0fa644cda928
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 11 20:10:58 2020 -0700
+
+    HOST-MIB: Do not assume that statfs() returns meaningful values if it fails
+
+commit e1b57bd02670818a44966ba4aad2a6d7ce9839b5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 11 19:56:31 2020 -0700
+
+    libsnmp: Suppress a clang warning about debug_indent()
+    
+    Suppress the following clang warning:
+    
+    snmp_debug.c:91:19: warning: adding 'unsigned long' to a string does not append\
+     to the string [-Wstring-plus-int]
+        return SPACES + sizeof(SPACES) - 1 - debugindent;
+               ~~~~~~~^~~~~~~~~~~~~~~~
+    snmp_debug.c:91:19: note: use array indexing to silence this warning
+        return SPACES + sizeof(SPACES) - 1 - debugindent;
+                      ^
+               &      [               ]
+
+commit 23fe19d9b63df63446c4f39ae1c9a60cd9c198d0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 11 17:15:55 2020 -0700
+
+    testing/fulltests/support/myip: Make this work with older Perl versions
+    
+    Older Perl versions have Socket6 and Socket modules. Newer Perl versions
+    support the Socket module but not Socket6. Make the myip script work with
+    all Perl versions.
+
+commit bf4964241391b197e1ce2afca225b684f94f7451
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 12 01:54:58 2020 +0000
+
+    IF-MIB: Fix regexec() argument types
+    
+    Fixes: e6795b2d67b4 ("IF-MIB: Add regex support for include_ifmib_iface_prefix")
+
+commit 9180ccb8772f7cd3317afcb6db676c8bdeedbcb9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 11 18:31:27 2020 -0700
+
+    NetBSD: Fix compilation of snmplib/snmpksm.c
+
+commit 6d722dcf108055c24e783cb367cb6985f11bd850
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 11 11:33:21 2020 -0700
+
+    Regenerate the configure script
+    
+    Fixes: e65031b76367 ("CHANGES: building: Remove extra argument to NETSNMP_SEARCH_LIBS to make libnl-3 end up in the right group of libraries")
+
+commit e65031b76367696234f7f0e7ecb2d0379e094457
+Author: Magnus Fromreide <magfr@lysator.liu.se>
+Date:   Tue Apr 7 05:41:14 2020 +0200
+
+    CHANGES: building: Remove extra argument to NETSNMP_SEARCH_LIBS to make libnl-3 end up in the right group of libraries
+
+commit b04dd9585aee57615edc2f973ac3b43a3c758812
+Author: Magnus Fromreide <magfr@lysator.liu.se>
+Date:   Mon Apr 6 02:46:12 2020 +0200
+
+    CHANGES: net-snmp-config: Allow nine or more files in --compile-subagent
+
+commit b078c7eac1d98c340d3682341ae7d0ceb3504f12
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 4 19:40:02 2020 -0700
+
+    Revert "swinst_apt: Use dpkg for modified date"
+    
+    The reasons for the revert are:
+    - The modified_date_t change that I made is wrong.
+    - Apparently not all Debian systems support ${db-fsys:Last-Modified}. From
+      the dpkg man page: "It contains the timestamp in seconds of the last time
+      the package filesystem entries were modified (since dpkg 1.19.3)."
+
+commit 001cbbc32a8be87041ddb7a80a3642550691ecfb
+Author: Craig Small <csmall@dropbear.xyz>
+Date:   Sat Apr 4 12:00:43 2020 +1100
+
+    swinst_apt: Use dpkg for modified date
+    
+    Instead of trawling through dpkg's files, let dpkg-query tell us
+    when the package was last modified. It means if the directory
+    changes or any other internal changes happen, this will still
+    keep working.
+    
+    db-sys:Last-Modified field has been in since dpkg-query 1.19.3
+    which means it works for Debian stable (Buster) onwards.
+    
+    References: https://bugs.debian.org/905668
+    
+    [ bvanassche: reworked an unsafe cast ]
+
+commit d6551405ddcbdc003302d991cc550270c701d9db
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Mar 31 20:51:48 2020 -0700
+
+    ci: Move the mariadb installation code from .travis.yml into ci/before.sh
+    
+    Additionally, display /etc/hosts on all operating systems.
+
+commit 49485cd90f9e978d2e68678f9efdff0a645a34d2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Mar 27 21:54:02 2020 -0700
+
+    testing/fulltests/support/clib_build: Fix a recently introduced bug
+    
+    Prevent that linking the regression tests fails as follows on Ubuntu:
+    /usr/bin/ld: cannot find -lnetsnmpmibs
+    /usr/bin/ld: cannot find -lnetsnmpagent
+    collect2: error: ld returned 1 exit status
+    
+    Fixes: 9db9d55f9511 ("testing: Add a unit test for run_exec_command()")
+
+commit e6795b2d67b45dddcb4deb99e9af51f7659d5a0c
+Author: lbw <lbw@telstra.com>
+Date:   Sat Mar 21 17:03:21 2020 +1100
+
+    IF-MIB: Add regex support for include_ifmib_iface_prefix
+    
+    [ bvanassche: consolidated error paths ]
+
+commit b49ff2207661c48bad46bb312f6f0627ffbbb825
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Mar 22 21:33:00 2020 -0700
+
+    testing/fulltests/unit-tests/T024run_exec_command_clib.c, Darwin: Fix executable paths
+
+commit 418dd7012dd45612b6506d6519e128ec823918d5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Mar 22 21:29:04 2020 -0700
+
+    agent/netsnmp_close_fds.c, Darwin: Suppress two compiler warnings
+
+commit 5459b69c4bc0f228f2e329b5913320a8d5acccc9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Mar 22 20:51:32 2020 -0700
+
+    ci: .travis.yml: Add Python 3 packages
+
+commit f0bca593510e3776c6aca1c44556ae04e7a1109b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Mar 22 15:34:04 2020 -0700
+
+    agent/mibgroup/utilities/execute.c: Handle errors instead of ignoring these
+
+commit 166a236be4f76796db0a49917415b790eec9ef89
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Mar 22 15:30:33 2020 -0700
+
+    agent/mibgroup/utilities/execute.c: Fix tokenize_exec_command()
+    
+    Do not discard the 100th argument. Fix a buffer overflow.
+
+commit 85a536c06f4de67fbb4f0382d4137be4b97b7ff3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Mar 22 15:41:55 2020 -0700
+
+    agent/mibgroup/utilities/execute.c: Remove the setPerrorstatus() macro
+
+commit 6a666952e58c69225a2c681cc2059de7a782c4ee
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Mar 22 15:28:16 2020 -0700
+
+    agent/mibgroup/utilities/execute.c: Declare input arguments const
+
+commit f8f6cb8e7513f38c782bf96a285e2f81cfeb98f1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Mar 22 15:26:12 2020 -0700
+
+    agent/mibgroup/utilities/execute.c: Convert tabs into spaces
+
+commit 9db9d55f95116300c282aa48dd329764773af59b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Mar 22 16:22:36 2020 -0700
+
+    testing: Add a unit test for run_exec_command()
+
+commit a524e99cb6524353883c72721f6df5b470740408
+Author: Igor Ryzhov <iryzhov@nfware.com>
+Date:   Fri Mar 20 16:45:41 2020 +0300
+
+    mib2c: fix size_t format specifier in mfd generated code
+    
+    Signed-off-by: Igor Ryzhov <iryzhov@nfware.com>
+
+commit 6141634d652cbd5a9e20982c88b95984d093099b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Mar 21 20:52:37 2020 -0700
+
+    libsnmp: Fix a potential buffer overflow in netsnmp_tlstmAddr_restore_common()
+    
+    This patch fixes the following Coverity complaint:
+    
+    CID 344591 (#1 of 1): Out-of-bounds access (OVERRUN)
+    5. overrun-buffer-arg: Overrunning array fingerprint of 256 bytes by passing
+    it to a function which accesses it at byte offset 256 using argument fp_len
+    (which evaluates to 256).
+
+commit 3d5eab844a70367d2ea00a93ad37206ec7b91793
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Mar 21 20:48:08 2020 -0700
+
+    libsnmp: Document the is_labelchar() argument range
+    
+    This patch suppresses the following Coverity complaint:
+    
+    CID 344592 (#1 of 1): Improper use of negative value (NEGATIVE_RETURNS)
+    32. negative_returns: ch_next = netsnmp_getc(fp) is passed to a parameter
+    that cannot be negative.
+
+commit 3f9aa163160e96b877f975519415ce3277d5da0a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Mar 21 20:44:16 2020 -0700
+
+    snmplib/sd-daemon.c: Check LISTEN_FDS before using it
+    
+    This patch fixes the following Coverity complaint:
+    
+    CID 344596 (#1 of 1): Untrusted loop bound (TAINTED_SCALAR)
+    15. tainted_data: Using tainted variable 3 + (int)l as a loop boundary.
+
+commit b67afb81eb0f7ad89496cd3e672654bfd8c55d0e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Mar 21 20:03:13 2020 -0700
+
+    snmpd: UCD-SNMP proxy: Fix a crash triggered by a wrong passphrase
+    
+    See also https://github.com/net-snmp/net-snmp/issues/82 .
+
+commit b83b0ddcf8fa27108b198bbb0fe247e18d2dae4f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Mar 21 20:01:18 2020 -0700
+
+    libsnmp: Improve snmp_async_send() and snmp_sess_async_send() documentation
+
+commit 2e517c5d60fcf9f96d2ad8045e7aec9b60dec041
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Mar 21 13:59:27 2020 -0700
+
+    Python: Port to Python 3
+    
+    Make the configure script look for the 'python3' interpreter instead of
+    'python'. Make all Python source code compatible with Python 2.7 and
+    Python 3. Make python/netsnmp/client_intf.c compatibly with Python 2.7
+    and Python 3.
+
+commit 7fd595cbdf0fe855aafaf54fcc39e8b3b2f96c08
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Mar 21 14:24:16 2020 -0700
+
+    python/netsnmp/client_intf.c: Improve coding style conformance
+    
+    Limit source code to 80 columns, move the body of if-statements to a
+    separate line and leave a blank line after declarations.
+
+commit 9619aa41d5cf353ec1d9b94d3ed4b4a61a51bc34
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Mar 21 14:54:46 2020 -0700
+
+    python/netsnmp/client_intf.c: Add more comments
+
+commit dfd0b638dd5ce9cabcc65afbd589a3177749fac3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Mar 21 15:10:14 2020 -0700
+
+    python/netsnmp/client_intf.c: Change the return type of py_netsnmp_attr_long() from long long into long
+    
+    The type 'long' is big enough to fit all possible return values.
+
+commit 3fb925a5a93ab2326b588899d81e0e412e0f321b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Mar 21 15:08:16 2020 -0700
+
+    python/netsnmp/client_intf.c: Fix the netsnmp_create_session_tunneled() return value
+
+commit d9577374329fa4516ba0220bc8ff68c3f316b430
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Mar 21 13:35:10 2020 -0700
+
+    Python: Reorder function definitions
+    
+    Reorder function definitions such that the forward declarations can be
+    removed.
+
+commit df1c17d2a0d1ba2a3130c9fdd2bd4c03dba4a947
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Mar 20 20:36:21 2020 -0700
+
+    Perl: Complain about attempts to send a TRAP with an unsupported SNMP version
+
+commit 883b354d4be90c13166bc11eb8ac65880f51e57d
+Author: Peter Valdemar Mørch <peter@morch.com>
+Date:   Wed Sep 25 18:13:36 2019 +0200
+
+    Perl: Allow informs to be sent with SNMP v2(c).
+    
+    Before informs required SNMP v3. But informs actually work just fine
+    with v2c too too.
+
+commit dfe3c8bdff9bceb796fc9425ef21676a99138d33
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Mar 18 21:54:28 2020 -0700
+
+    ci/openssl.bat: Bump the OpenSSL version
+
+commit 62eea843bf46162db557e7f39f87958de2fee26a
+Author: Igor Ryzhov <iryzhov@nfware.com>
+Date:   Wed Mar 18 22:24:27 2020 +0300
+
+    mib2c: use struct counter64 instead of U64 in generated code
+    
+    The U64 typedef was replaced with struct counter64 in net-snmp
+    code because of the conflicts with Perl headers. But mib2c still
+    generates the code with U64.
+    
+    Signed-off-by: Igor Ryzhov <iryzhov@nfware.com>
+    [ bvanassche: Adjusted indentation of source code comments ]
+
+commit 1a8b31c175e69e0e0a8ef6b7068aff6c45980eea
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Mar 15 21:55:36 2020 -0700
+
+    CHANGES: configure: Assume that memcmp() works
+    
+    From the autoconf documentation: "Macro: AC_FUNC_MEMCMP. If the memcmp
+    function is not available, or does not work on 8-bit data (like the one
+    on SunOS 4.1.3), or fails when comparing 16 bytes or more and with at
+    least one buffer not starting on a 4-byte boundary (such as the one on
+    NeXT x86 OpenStep), require an AC_LIBOBJ replacement for `memcmp`.
+    
+    This macro is obsolescent, as current systems have a working memcmp.
+    New programs need not use this macro."
+    
+    Hence remove the AC_FUNC_MEMCMP invocation.
+    
+    See also https://github.com/net-snmp/net-snmp/issues/81.
+
+commit 8c02e747d35d1df12c3482895879caf38e448c44
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Wed Mar 11 20:38:50 2020 +0100
+
+    fsys_mrtent: add glusterfs as a recognized filesystem type.
+            Thanks to Josef Ricky.
+
+commit 3bc8e2de4e54b7c5f72f0c4d1b753d0c32ae9805
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Wed Mar 11 20:26:27 2020 +0100
+
+    snmplib/parse: change the tclist (TEXTUAL-CONVENTION) data structure
+    to be dynamically allocated.
+
+commit ddb3a0b1f8b8cf2734f9c2cc4e434c79370b2cb5
+Author: Mukesh Jain <mukesh.jain@newnet.com>
+Date:   Tue Mar 3 03:47:49 2020 +0530
+
+    snmpd: Fix a memory leak in handle_agentx_packet()
+    
+    Fix a memory leak when contextName is used in the PDU. The memory for
+    contextName is assigned to community and is hence lost. This patch
+    fixes the following Valgrind complaint:
+    
+    at 0x4C29EA3: malloc (vg_replace_malloc.c:309)
+    by 0x653F294: snmp_clone_mem (in /usr/lib64/libnetsnmp.so.31.0.2)
+    by 0x653F3E7: ??? (in /usr/lib64/libnetsnmp.so.31.0.2)
+    by 0x653F90D: snmp_clone_pdu (in /usr/lib64/libnetsnmp.so.31.0.2)
+    by 0x60E3837: handle_agentx_packet (in /usr/lib64/libnetsnmpagent.so.31.0.2)
+    by 0x6567ED0: ??? (in /usr/lib64/libnetsnmp.so.31.0.2)
+    by 0x6568F40: _sess_read (in /usr/lib64/libnetsnmp.so.31.0.2)
+    by 0x65698A8: snmp_sess_read2 (in /usr/lib64/libnetsnmp.so.31.0.2)
+    by 0x65698FA: snmp_read2 (in /usr/lib64/libnetsnmp.so.31.0.2)
+    by 0x656993B: snmp_read (in /usr/lib64/libnetsnmp.so.31.0.2)
+    by 0x60DF30A: agent_check_and_process (in /usr/lib64/libnetsnmpagent.so.31.0.2)
+    
+    See also https://github.com/net-snmp/net-snmp/pull/78.
+    See also https://github.com/net-snmp/net-snmp/issues/58.
+    
+    [ bvanassche: modified commit message and patch ]
+
+commit 67fde288efa0d07df2dbd5dcc3d39b937b69b176
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Mon Mar 2 21:18:52 2020 +0100
+
+    Support for NetBSD 9.0
+
+commit a49aa9c132cd38a9170de19b454dc27a67c2683c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Feb 28 20:26:34 2020 -0800
+
+    ci: Skip the DTLS and TLS tests
+    
+    Since the DTLS and TLS code is broken, skip the corresponding tests.
+
+commit b900b83258aa8b92895b9f988b02a1b086420322
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Feb 28 20:14:54 2020 -0800
+
+    libsnmp: Fix cert:map:secname fingerprint selection
+    
+    See also https://github.com/net-snmp/net-snmp/issues/75.
+    
+    Fixes: f51321751caf ("lots of new cert functionality")
+
+commit a7c4831997a1deaf8a6a285babea28877bae15a8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Feb 25 21:15:19 2020 -0800
+
+    libsnmp: Surround MAKE_ENTRY() definition with do { } while (0)
+
+commit eecd4d23b166a49ba4840264a4763ae5f9caad0e
+Author: Gisle Vanem <gvanem@yahoo.no>
+Date:   Tue Feb 25 20:50:55 2020 +0100
+
+    libsnmp: Surround multiple macros with do { } while (0)
+    
+    This patch suppresses the following clang warning:
+    
+    empty expression statement has no effect; remove unnecessary ';' to silence this warning
+    
+    See also https://github.com/net-snmp/net-snmp/pull/76.
+    
+    [ bvanassche : combined three patches into one ]
+
+commit e1d9a6181dd46dc14101665c38a3c875d8b6f303
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 22 14:44:18 2020 -0800
+
+    configure: Upgrade libtool and automake
+    
+    The parts of the configure script generated by libtool and aclocal come from
+    libtool v2.4 (released on 2010-09-21) and automake v1.11 (released on
+    2009-05-16). Upgrade libtool to v2.4.6 and automake to v1.11.6.
+
+commit db50cd646a49cf18c91c63a0737eb7a704e69099
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 22 08:13:06 2020 -0800
+
+    CHANGES: Remove dmalloc and efence support
+    
+    Tools like dmalloc and efence were important to root cause memory corruption
+    issues until about 2005, when Valgrind became available. Remove support for
+    dmalloc and efence since tools like Valgrind and compiler sanitizers are
+    superior compared to dmalloc and efence. For more information about Valgrind
+    and the compiler sanitizers, see also:
+    * http://valgrind.org/
+    * https://en.wikipedia.org/wiki/AddressSanitizer
+    * https://gcc.gnu.org/onlinedocs/gcc/Instrumentation-Options.html
+
+commit f4ae8cf7d808ba54761d6ba8bd593c7a6669b9c3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jan 14 18:39:45 2019 -0800
+
+    configure: Re-enable shared library support for FreeBSD 10 and later
+    
+    See also
+    https://lists.freebsd.org/pipermail/freebsd-current/2013-March/040460.html .
+    See also commit 7d66a35cd6bf ("configure: Enable shared library support for
+    FreeBSD 10 and later") # v5.8.1.pre1.
+    Fixes: 84355f7122da ("configure: Regenerate with autoconf v2.69").
+
+commit 10823f0194e167b2e7860acd4f96d14380ae36b3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 22 07:55:55 2020 -0800
+
+    configure: Add exp() library to LMIBLIBS instead of LIBS
+    
+    This change allows the ceil() test to add -lm to LNETSNMPLIBS.
+    
+    This patch is a follow-up for commit d63e35a3a384 ("configure: Add -lm to
+    LNETSNMPLIBS if ceil() exists in libm").
+    
+    See also https://github.com/net-snmp/net-snmp/issues/72.
+
+commit 21e318b418f206cd3acc22f3ff7a58b864f287f0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Feb 21 20:33:07 2020 -0800
+
+    dist/autoconf-version: Bump to v2.69
+    
+    Fixes: 9a2753282c6a ("new autoconf")
+
+commit d63e35a3a384c9f917bc4ab117d9239af2f01fc4
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Feb 21 19:42:11 2020 -0800
+
+    configure: Add -lm to LNETSNMPLIBS if ceil() exists in libm
+    
+    See also https://github.com/net-snmp/net-snmp/issues/72.
+    
+    Reported-by: Stuart Henderson
+    Fixes: 7497e2eade8a ("check if libm is needed for ceil function") # v5.8.pre2
+
+commit f0f9279ad18ff03542e6dae156b6633628d36762
+Author: Stuart Henderson <stu@spacehopper.org>
+Date:   Fri Feb 21 14:59:21 2020 +0000
+
+    TCP-MIB, UDP-MIB: Fix these tables for OpenBSD >= 5.6
+    
+    OpenBSD changed from CIRCLEQ to TAILQ for inpt_queue in OpenBSD 5.6
+    (November 2014), the version of Net-SNMP in ports has been carrying this
+    patch since then.
+    
+    [ bvanassche: modified patch title ]
+
+commit bd276c697ae51cb7744b6731477f67203430cdbf
+Author: Stuart Henderson <sthen@users.noreply.github.com>
+Date:   Fri Feb 21 14:56:05 2020 +0000
+
+    snmpps: Avoid null pointer dereference for SNMP_NOSUCHOBJECT
+    
+    Handle SNMP_NOSUCHOBJECT as well as SNMP_NOSUCHINSTANCE. If snmpps/snmptop
+    are pointed at an agent which doesn't provide the required objects, before
+    this change it tries to dereference a null pointer when setting the
+    variables (noticed against OpenBSD snmpd which only implements part of
+    hrSWRunPerf and misses CPU/Mem).
+    
+    [ bvanassche: modified patch description ]
+
+commit 9a2753282c6a8dc09ed5dc4bc01683e8ba1f4850
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Thu Feb 20 14:23:41 2020 -0800
+
+    new autoconf
+
+----------------------------------------------------------------------
+
+Changes: V5.8.1.pre1 -> V5.8.1.pre2
+
+commit 8436b3bbf944b87873e31c3c81694f03635082bf
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Tue Feb 18 15:41:04 2020 -0800
+
+    Version number update: 5.8.1.pre2
+
+commit 473734ac3302210b4bf4175e20657029d55439e5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 8 09:36:58 2020 -0800
+
+    perl: Use netsnmp_memdup() where appropriate
+
+commit dac831d3220e2ff9013955a314aada6c1c88fef5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Feb 7 20:13:06 2020 -0800
+
+    perl: Allow empty strings in notifications
+    
+    Adding a string of length zero is not necessarily an error. In fact, treating
+    it as such, prevents us from sending the empty string as an otherwise valid
+    OCTET STRING in traps/notifications.
+    
+    This is a modified version of a patch provided by Peter Valdemar Mørch
+    <peter@morch.com>.
+
+commit 6725c4f7219fca50b7e455bcf2efc5bdfe7e9469
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Feb 7 20:06:52 2020 -0800
+
+    perl: Only call netsnmp_malloc() if necessary
+    
+    Change the netsnmp_malloc() call into a netsnmp_memdup() call and only call
+    that function if len > 0.
+    
+    This is a modified version of a patch provided by Peter Valdemar Mørch
+    <peter@morch.com>.
+
+commit db95f59860c0d06e3aa591e71a278630dc3f48ee
+Author: Alexander Dahl <post@lespocky.de>
+Date:   Wed Feb 5 01:49:37 2020 +0100
+
+    Add unit test for int8_t input to snmp_set_var_value()
+    
+    This new test fails on 32bit arm, e.g. on Raspberry Pi, but not on x86
+    or x86_64. See output of a failing test:
+    
+        Testing snmp_set_var_value() ................................ 1/?
+        not ok 3 - 128 =?= -128
+        not ok 5 - 233 =?= -23
+        not ok 7 - 255 =?= -1
+        Testing snmp_set_var_value() ................................ Failed 3/13 subtests
+    
+    Reason is type "char" can be signed or unsigned, but
+    snmp_set_var_value() implicitly assumes "char" is always signed.
+    
+    [ bvanassche: reformatted unit test source code ]
+
+commit a3a4e65b5d4fdd37520d75e74d5f0f57501326a4
+Author: Alexander Dahl <ada@thorsis.com>
+Date:   Tue Feb 4 15:34:29 2020 +0100
+
+    libsnmp: Cast signed char to signed int when setting value
+    
+    We have an INT8 in a MIB, an Integer32(-128..127) to be more specific.
+    In a custom software we call 'snmp_pdu_add_variable()' with
+    type == ASN_INTEGER and len == 1. Deeper down the code path, we come to
+    'snmp_set_var_value()' and this part:
+    
+            else if (vars->val_len == sizeof(char)) {
+                if (ASN_INTEGER == vars->type) {
+                    const char      *val_char
+                        = (const char *) value;
+                    *(vars->val.integer) = (long) *val_char;
+                } else {
+                        const u_char    *val_uchar
+                        = (const u_char *) value;
+                    *(vars->val.integer) = (unsigned long) *val_uchar;
+                }
+    
+    Obviously the intent is to cast depending on whether the integer is
+    supposed to be signed or not, but although he jumps to the right code
+    path here, the result in vars->val.integer is wrong then. It does not
+    work with type 'char' like above.
+    
+    We got values looking unsigned added to our pdu which we set to our
+    net-snmp server then and got them back unsigned on SNMP get requests
+    later, for example we fed an int8_t with value -32 we read back 224.
+    
+    So this patch explicitly uses type 'signed char' which works for us.
+    
+    Compiler is gcc 4.7 and we're cross-compiling for
+    arm-v5te-linux-gnueabi on Linux.
+    
+    Fixes: 8e7458661b0eeb72d787a69cb915c16b151beee1
+    Signed-off-by: Alexander Dahl <ada@thorsis.com>
+
+commit dd6cb372db7c1d7ca606c0d13c48f20148da8038
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 1 11:21:47 2020 -0800
+
+    FreeBSD, HOST-RESOURCES-MIB: Fix two compiler warnings
+    
+    Fix the following compiler warnings:
+    
+    hardware/cpu/cpu_sysctl.c:204:20: warning: unused variable 'mem_mib' [-Wunused-variable]
+        int            mem_mib[] = { CTL_VM, NETSNMP_VM_STATS };
+                       ^
+    hardware/cpu/cpu_sysctl.c:205:20: warning: unused variable 'mem_size' [-Wunused-variable]
+        size_t         mem_size  = sizeof(NETSNMP_VM_STATS_TYPE);
+                       ^
+    
+    Fixes: 2bbad43c53ff ("Patch for cpu_sysctl for FreeBSD 12")
+
+commit d4d09af41f6e794271e62a986f2216357f8f11ef
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 1 11:33:47 2020 -0800
+
+    FreeBSD, HOST-RESOURCES-MIB: Move a misplaced comment
+
+commit 5846564f5be46e0e362be894d4cb57be383c5b3d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 1 10:28:48 2020 -0800
+
+    FreeBSD, HOST-MIB: Fix a memory leak in swrun_kinfo.c
+    
+    See also:
+    * https://sourceforge.net/p/net-snmp/bugs/2717/.
+    * https://sourceforge.net/p/net-snmp/patches/1341/.
+    * https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=219072.
+
+commit 7229e320abd63512ba7e9d69adaa5f44553c6566
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Feb 1 10:11:34 2020 -0800
+
+    HOST-MIB: Remove a superfluous include directive
+    
+    The only source file from which _ftime() is called is snmplib/gettimeofday.c.
+    Hence do not include <sys/timeb.h> from the host MIB implementation.
+
+commit 0ded321a1588b7e1281f505c2f6266aa979168c6
+Author: Thomas Abraham <tabraham@suse.com>
+Date:   Tue Jan 7 11:20:39 2020 -0500
+
+    Recognize NSS pools and NSS volumes (Open Enterprise Server)
+
+commit bd92f4d6fec0dd278c8092c95437d09903c16bb2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jan 3 18:33:28 2020 -0800
+
+    configure, include/net-snmp/net-snmp-config.h.in: Fix a description
+    
+    Fixes: 5da4fc8c8e08 ("MinGW64: Fix select() and ioctlsocket() calls")
+
+commit d3e17f70f26898dfe870cff03c56be628b9c0fd2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Dec 7 15:34:31 2019 -0800
+
+    Fix -D_FORTIFY_SOURCE=1 compiler warnings
+    
+    See also https://github.com/net-snmp/net-snmp/issues/51
+    
+    Reported-by: coding@rms95.nl
+
+commit 2c837e1811b49278d8ec34185f14c2651adeda79
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Nov 24 16:51:44 2019 -0800
+
+    ci/perl.bat: Bump the Perl version from 5.31.2 to 5.31.6
+
+commit d418c635e68a95711b617c4d348fb806746329df
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Nov 29 20:21:52 2019 -0800
+
+    ci/net-snmp-run-tests: Do not run the DTLS tests
+    
+    Do not run the DTLS tests since these tests fail systematically against
+    OpenSSL version 1.1.1 and later.
+
+commit f67a451c509a0482c37ea53989bdde3b68ac4f43
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Nov 29 19:26:59 2019 -0800
+
+    testing/RUNFULLTESTS: Add command line option -e for excluding tests
+
+commit 9fe45caf87ae6faf405d938ce0dfb6e3456bed4e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Nov 28 20:56:09 2019 -0800
+
+    libsnmp: Fix spelling of 'implementation' in a source code comment
+
+commit 964700dc4382e7b39cc58438a4c48d50ea2a266f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Nov 26 18:38:08 2019 -0800
+
+    .gitignore: Add netsnmp.pc and netsnmp-agent.pc
+    
+    See also https://github.com/net-snmp/net-snmp/issues/42.
+
+commit 6624b240e034e8f8a85acd09d19519150df2c0a3
+Author: Sam Tannous <stannous@cumulusnetworks.com>
+Date:   Wed Nov 13 11:20:46 2019 -0800
+
+    Add new config option to limit max number of interfaces for IF-MIB
+    
+    This patch introduces a new config option "ifmib_max_num_ifaces NUM"
+    This patch sets the maximum number of interfaces included in IF-MIB
+    data collection.  For servers with a large number of interfaces
+    (ppp, dummy, bridge, etc) the IF-MIB processing will take a large
+    chunk of CPU for ioctl calls (on Linux). Setting a reasonable
+    maximum number of ifaces for the CPU used will reduce the CPU
+    load for IF-MIB processing.  For example, configuring
+    "ifmib_max_num_ifaces 500" will include only the first 500
+    interfaces based on ifindex and ignore all others for IF-MIB
+    processing.
+    
+    Signed-off-by: Sam Tannous <stannous@cumulusnetworks.com>
+    [ bvanassche: combined two patches into one and removed one unused variable ]
+
+commit 0a6e8c3311594e6449fc2b4df52ca03556b890bc
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Oct 28 18:54:48 2019 -0700
+
+    libsnmp: Re-export two USM functions
+    
+    See also commit ee65591fba88 ("libsnmp, USM: Unexport more functions").
+    
+    Reported-by: Joe Clark <joeclarkia@gmail.com>
+
+commit b4ec525601709d4004d5c0746f0d6f62111b5006
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Oct 23 14:18:13 2019 -0700
+
+    libsnmp: Port to OpenSSL 1.1.1e
+    
+    See also OpenSSL commit b13342e933c5 ("Modernise the ERR functionality
+    further (new functions and deprecations)").
+
+commit b0f60ff42e0126a71f97b9733f2df211b37342d0
+Author: Sam Tannous <stannous@cumulusnetworks.com>
+Date:   Wed Oct 9 12:58:14 2019 -0700
+
+    Reduce CPU load for IF-MIB on Linux servers with large number of interfaces
+    
+    This patch introduces a new configution option to limit the number
+    of interfaces that the IF-MIB will process.  On Linux servers with a
+    large number of interfaces (ppp, dummy, bridge, etc.), the IF-MIB
+    timer based stats collector can take a large amount of CPU processing.
+    
+    The new config option "include_ifmib_iface_prefix" takes a space
+    separated string of ifname prefixes ("eth lo bridg") and will only
+    include interfaces with these prefixes in the IF-MIB tables.
+    
+    If this config option is not present (the default), all interfaces
+    will continue to be processed in the IF-MIB.
+    
+    Signed-off-by: Sam Tannous <stannous@cumulusnetworks.com>
+    [ bvanassche: Moved the netsnmp_access_interface_init() call from
+      init_mib_modules() into the MIB implementations that depend on that call. ]
+
+commit 0917aead00854aa7458fa5f7341f01261aa88bb6
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Oct 22 07:51:14 2019 -0700
+
+    libsnmp: Restore the second argument of snmp_parse()
+    
+    Since converting a netsnmp_session pointer into a struct session_list
+    pointer is not possible if a session has not been registered, restore
+    the second argument of snmp_parse(). This patch reverts f11583ee7bef
+    ("libsnmp: Remove one argument from snmp_parse()").
+
+commit 34991ccfc3494ab4ea987adbbe6d6deb207153f7
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 19 09:30:30 2019 -0700
+
+    libsnmp: Document snmp_build() and snmp_parse()
+
+commit 46a49c9f692073e7bf5742578e9668b3e366a402
+Author: Sławomir Nizio <poczta-sn@gazeta.pl>
+Date:   Fri Oct 18 12:53:11 2019 +0200
+
+    libsnmp: Expose snmp_build and snmp_parse
+    
+    [ bvanassche: Ported this patch to the v5.8 branch ]
+
+commit f11583ee7bef26c56408d6416054a904fa8521ca
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 19 10:17:50 2019 -0700
+
+    libsnmp: Remove one argument from snmp_parse()
+    
+    Since all snmp_parse() callers pass slp->session as the second argument
+    to this function, this patch does not change any functionality.
+
+commit 8b957a68307fa0da7f6f4c4ad04142d9189b601f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Oct 16 18:55:26 2019 -0700
+
+    Makefiles: Remove the LIB_LD_LIBS variable
+    
+    This variable is never set, hence remove all occurrences.
+
+commit 361b93b76c87cd422f4ff670358351363241f15c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Oct 16 18:44:27 2019 -0700
+
+    agent: Fix libnetsnmptrapd linker flags
+    
+    See also https://github.com/net-snmp/net-snmp/issues/29.
+    
+    Fixes: e09bf1a5f2bf ("Use libtool for building").
+    Signed-off-by: Craig Small
+    [ bvanassche: Removed use of $(CPPFLAGS) while generating 'sedscript' ]
+
+commit 9201c9479ffa78033aaff6ccf5f4f1a34a33791e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Oct 15 20:27:57 2019 -0700
+
+    agent: Improve robustness of handle_subagent_set_response()
+    
+    Several users have reported that 'retsess' can be NULL. Avoid that the
+    agent crashes if retsess == NULL. See also:
+    * https://sourceforge.net/p/net-snmp/mailman/message/29293701/
+    * https://sourceforge.net/p/net-snmp/bugs/2468/
+    * https://github.com/net-snmp/net-snmp/issues/28
+
+commit 5a0ac74b93efab05ee7fca3b13adc304c848dc28
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 12 21:25:09 2019 -0700
+
+    apps: Fix potential buffer overflows
+    
+    This patch fixes the following Coverity complaint:
+    CID 85476: Out-of-bounds access (OVERRUN)
+    overrun-buffer-arg: Overrunning buffer pointed to by &base[base_length] of 1024 bytes by passing it to a function which accesses it at byte offset 1031 using argument indexlen * 8UL (which evaluates to 8).
+
+commit 9b65cf7edc31f6fb053c78bfaa2120e65dcb4719
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 12 21:16:21 2019 -0700
+
+    apps/snmptop: Fix a memory leak complaint reported by Coverity
+    
+    Fix the following Coverity complaint:
+    CID 85620: Resource leak (RESOURCE_LEAK)
+    leaked_storage: Variable oproc going out of scope leaks the storage it points to.
+
+commit d0787a2c86a80e31756965c436fac67b7d1c0f9b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Oct 11 20:09:08 2019 -0700
+
+    HOST-RESOURCES-MIB, UCD-SNMP-MIB: Report empty strings correctly
+    
+    See also https://github.com/net-snmp/net-snmp/issues/26.
+    
+    Fixes: 9b9c0e287b4d ("MIBs: Use asprintf() instead of snprintf() to prevent truncation")
+
+commit 76c4ea51a48d36458ee7cb31918535a2f421408a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Oct 11 18:11:26 2019 -0700
+
+    LM-SENSORS-MIB: Log an error message if initialization fails
+
+commit a8651678216d48c91c58e4aba6a6bd269383a122
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Oct 6 19:55:00 2019 -0700
+
+    libsnmp, netsnmp_tlstmAddr_restore_common(): Fix potential buffer overflows
+    
+    Make sure that netsnmp_tlstmAddr_restore_common() does not write past the
+    end of the buffers passed as arguments. This patch fixes e.g. the following
+    Coverity complaint:
+    
+    CID 344598: Out-of-bounds access (OVERRUN)
+    overrun-buffer-arg: Overrunning array name of 256 bytes by passing it to a function which accesses it at byte offset 256 using argument name_len (which evaluates to 256).
+
+commit 48d06b9b46840e3933288dc1d09cdd58f21f55c9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Oct 6 11:49:21 2019 -0700
+
+    libsnmp: Remove a check from encode_keychange()
+    
+    All callers pass a valid kcstring_len pointer. Remove a test of that
+    pointer. This patch fixes the following Coverity complaint:
+    
+    CID 266316: Dereference after null check (FORWARD_NULL)
+    var_deref_op: Dereferencing null pointer kcstring_len.
+
+commit ac09ffc5487ce3cae6f3f08e2dee5e01a89ef063
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Oct 6 09:51:30 2019 -0700
+
+    libsnmp, DTLSUDP transport: Remove a superfluous pointer check
+    
+    All f_fmtaddr() callers dereference the transport pointer. This patch
+    fixes the following Coverity complaint:
+    
+    CID 341230: Dereference after null check (FORWARD_NULL)
+    var_deref_op: Dereferencing null pointer t.
+
+commit 8e6a1d6d6088bd85436c0184fbe30eec32a47e7f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Oct 6 09:47:45 2019 -0700
+
+    libsnmp: Fix a NULL pointer dereference in the asn_build_string() debug code
+    
+    This patch fixes
+    CID 344578: Dereference after null check (FORWARD_NULL)
+    var_deref_model: Passing null pointer str to sprint_realloc_asciistring, which dereferences it.
+
+commit 776308793cd4683dac7ef7605487c66ac908560f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Oct 6 07:28:33 2019 -0700
+
+    ci/openssl.bat: Bump the OpenSSL version
+
+commit 05c544a48e45371d4450338c356c68503a7a45e6
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 5 20:47:12 2019 -0700
+
+    IP-MIB: Fix a memory leak in an error path
+    
+    This patch fixes the following Coverity complaint:
+    
+    CID 344587 (#2 of 2): Resource leak (RESOURCE_LEAK)
+    leaked_storage: Variable bcastentry going out of scope leaks the storage it points to.
+
+commit da8c970d534c41455267ad5352ef06cc757c4c47
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 5 20:44:38 2019 -0700
+
+    libsnmp, DTLSUDP transport: Fix memory leaks in error paths
+
+commit 7efdf32d3281e113cc6bff6aca4f5a4354345de5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 5 20:43:08 2019 -0700
+
+    libsnmp, DTLSUDP transport: Use free() to free buffers allocated with malloc()
+    
+    This patch addresses the following Coverity complaint:
+    
+    CID 344589 (#1 of 1): Incorrect deallocator used (ALLOC_FREE_MISMATCH)
+    free: Calling CRYPTO_free frees buffer using CRYPTO_free but it should have been freed using free.
+
+commit 2f114d1d253fdb91de839ec874d46cd55e174d62
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 5 20:32:00 2019 -0700
+
+    Linux: Stop including the header file <sys/sysctl.h>
+    
+    According to the glibc authors <sys/sysctl.h> is considered deprecated on
+    Linux and including that header file triggers a compiler warning. See also
+    https://savannah.gnu.org/forum/forum.php?forum_id=9515.
+
+commit 56e1909436c525753e42f82e608b6b47dbb83884
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 5 18:00:43 2019 -0700
+
+    libsnmp, UDP shared transport: Handle memory allocation failures properly
+    
+    This patch fixes the following Coverity complaint:
+    
+    CID 344602: Write to pointer after free (USE_AFTER_FREE)
+    double_free: Calling netsnmp_transport_free frees pointer t which has already been freed.
+
+commit 5eb25dac673782219ebc24621294960fbff5415e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 5 17:44:56 2019 -0700
+
+    libsnmp: Fix an out-of-bounds read
+    
+    This patch fixes the following Coverity complaint about the
+    snmp_set_var_value() call in get_first_logging_entry() in nsLogging.c:
+    
+    CID 344604 (#1 of 1): Out-of-bounds access (OVERRUN)
+    overrun-buffer-val: Overrunning buffer pointed to by (u_char *)&temp of 8 bytes by passing it to a function which accesses it at byte offset 15.
+
+commit 2ea95d6e4f5bd2426f39e08c7276a8582b02043b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 5 17:37:03 2019 -0700
+
+    LM-SENSORS-MIB: Fix a use-after-free in case registration fails
+    
+    This patch fixes CID 344606: Use after free (USE_AFTER_FREE)
+    pass_freed_arg: Passing freed pointer reg as an argument to netsnmp_inject_handler_before.
+
+commit 5d61e93672004cea961f1b9129ee3b84e7e1701c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 5 17:31:27 2019 -0700
+
+    snmplib, UDP transport: Do not compare array pointers against NULL
+    
+    Comparing an array pointer against NULL is not useful. This was detected by
+    Coverity. See also commit 02de400544de ("libsnmp: Set Linux VRF iface on
+    Trap sink IP addresses").
+
+commit f7d52958c71345900492abe29d05e6efe5ff7428
+Author: Benjamin Hesmans <benjamin.hesmans@tessares.net>
+Date:   Tue Oct 1 16:12:05 2019 +0200
+
+    HOST-MIB: Fix hrSWRunPath reported string length
+    
+    ```
+    snprintf (...) return value is the number of characters (excluding the
+    terminating null byte) which would have been written to the final string
+    if enough space had been available.
+    ```
+    
+    The length of the string reported was not correct because of this.
+    
+    snmpget would then misinterpret the value like :
+    
+    iso.3.6.1.2.1.25.4.2.1.4.19031 = Hex-STRING: 2F 74 6D 70 2F 6C 6F 6F 6F
+    6F 6F 6F 6F 6F 6F 6F
+    6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F
+    6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F
+    6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F
+    6F 6F 6F 6F 6F 6F 6F 6F 6E 67 2F 6C 6F 6F 6F 6F
+    6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F
+    6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F
+    6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 6F 00
+    00 2D 70 6F 20 2D 72 61 6F 65 6B 72 6B 20 65 72
+    61 7A 00 00 00 00
+    
+    after the patch :
+    
+    iso.3.6.1.2.1.25.4.2.1.4.19031 = STRING:
+    "/tmp/loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooong/loooooooooooooooooooooooooooooooooooooooooooooooooooo"
+    
+    Signed-off-by: Benjamin Hesmans <benjamin.hesmans@tessares.net>
+    [ bvanassche: changed patch title ]
+
+commit e5b55323c00544b10e4780a752e1daad504e9d9e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Oct 1 21:29:51 2019 -0700
+
+    snmpd, ip-forward-mib: Fix a NULL pointer dereference
+    
+    Dereference route_container after having checked whether or not that
+    pointer is NULL instead of before. See also
+    https://github.com/net-snmp/net-snmp/issues/15.
+    
+    This patch has been provided by Amit Sharma.
+
+commit 02de400544dea6804c348c457a5ea5ea5531b12d
+Author: Sam Tannous <stannous@cumulusnetworks.com>
+Date:   Thu Sep 26 09:40:58 2019 -0700
+
+    libsnmp: Set Linux VRF iface on Trap sink IP addresses
+    
+    For Linux VRF support in Traps, this patch fixes an issue (#12) where
+    configuring and iface on the sink IP address was not being bound (via
+    SO_BINDTODEVICE) to the socket.  This was broken for versions 1, 2c, and 3.
+    
+    While a clientaddr setting in snmp.conf could fix this, a user would have to
+    find and set a source IP address in the VRF to be used. This patch does not
+    require setting a clientaddr but simply binds the iface provided in the sink
+    IP address (target) to the session socket that will be used.
+    
+    Signed-off-by: Sam Tannous <stannous@cumulusnetworks.com>
+    [ bvanassche: made minor edits to patch description and removed one space from
+      the patch itself ]
+
+commit 160fcda849ed111f457f74310148be90670ea417
+Author: Yuri Pankov <yuripv@yuripv.net>
+Date:   Sat Oct 6 13:48:35 2018 +0300
+
+    CHANGES: FreeBSD: Fix first byte of IF-MIB::ifPhysAddress
+    
+    Don't write past the interface name, and use temporary copy instead.
+    This fixes the first byte of ifPhysAddress always being 0 on FreeBSD.
+    
+    See also https://sourceforge.net/p/net-snmp/code/merge-requests/20/.
+    
+    [ bvanassche: edited patch title / added test for malloc() result / reduced
+      number of free(if_name) calls ]
+
+commit f059d6e66d4a0aed7b176182b9191615b7cf85ac
+Author: Peter Valdemar Mørch <peter@morch.com>
+Date:   Wed Sep 25 18:23:15 2019 +0200
+
+    perl: Document format of SecEngineId
+
+commit cff90fa9fe3afe88a498fb21a07bc7cb7cec46e8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Sep 22 22:23:43 2019 -0700
+
+    libsnmp, TLS-TCP transport: Fix spelling in log messages
+
+commit feda56b6265d16f254fe70407920b2573ce78214
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Sep 22 21:57:36 2019 -0700
+
+    libsnmp: Split netsnmp_tlstcp_open()
+    
+    The length of this function hurts readability. Hence split this function.
+
+commit 525a063e7e7915e64fc202c656c65da45289d5cb
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Sep 22 21:29:44 2019 -0700
+
+    snmplib/cert_util.c: Remove a superfluous cast
+
+commit d443bbd6fdbd6388387925e2457dfac54941f0d8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Sep 20 07:12:57 2019 -0700
+
+    UCD-SNMP-MIB: Fix parsing of 'proc' directives for process names with spaces
+    
+    See also https://github.com/net-snmp/net-snmp/issues/10.
+
+commit 90837dcec21cc2faa55711c6f823e97c87085dd3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Sep 15 16:17:14 2019 -0700
+
+    snmpd: Make the output of a trap debug message more detailed
+    
+    An example of the new output:
+    
+    trap: sending trap type=166, version=3 to UDP: [127.0.0.1]:162->[0.0.0.0]:37458
+    
+    This should help with root-causing https://sourceforge.net/p/net-snmp/bugs/2978.
+
+commit 7d2c65836b59fa6e1cd81bf9c4d7fa21f0947056
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Sep 15 12:58:46 2019 -0700
+
+    CHANGES: snmpd: Suppress OpenVZ related error messages
+    
+    When snmpd is run inside an OpenVZ container neither /proc/bus/pci nor
+    /proc/diskstat are available and /proc/partitions is empty.
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2975/.
+    
+    Signed-off-by: Sergey Chernomorets
+    [ bvanassche: introduced init_libpci() and simplified this patch ]
+
+commit 2633eedde135c2e69c92b82f702da783608c6009
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Sep 14 10:13:40 2019 -0700
+
+    CHANGES: snmpd: Reduce the time needed to execute "pass" scripts on BSD systems
+    
+    See also https://github.com/net-snmp/net-snmp/issues/8.
+
+commit a346dbcf7f1181510a2a39f14a45eb594db26e90
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Sep 11 08:41:09 2019 +0100
+
+    agent/mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable.h: Remove superfluous whitespace
+
+commit 90fd668641c9c113d67f959677aae7f03b6f67fe
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Sep 11 08:27:23 2019 +0100
+
+    IF-MIB, MIB-II: Remove #ifdef SCNuMAX
+    
+    SCNuMAX is available on Linux since a long time. Hence remove #ifdef SCNuMAX.
+
+commit 9c00aaebe4316910b34f3ddc01b866db060680fc
+Author: Sam Tannous <stannous@cumulusnetworks.com>
+Date:   Mon Sep 9 19:22:38 2019 -0700
+
+    linux: IF-MIB Counters (HwIfInOctets, HwIfOutOctets, etc.) became 32-bit counters
+    
+    Recently, patch 64f4ead (libsnmp: Only include <inttypes.h> when necessary)
+    effectively removed inttypes.h from types.h and added it back for most files
+    except for
+    
+    if-mib/data_access/interface_linux.c
+    
+    This turned what were 64 bit counters (SCNuMAX is no longer defined) into
+    32 bit counters.
+    
+    This patch simply adds inttypes.h back to interface_linux.c
+    correcting the counters.
+    
+    Signed-off-by: Sam Tannous <stannous@cumulusnetworks.com>
+    [ bvanassche: Moved inttypes.h include directive up ]
+
+commit 635ccb36d32f94097021191bc77c1b211c4f4209
+Author: Anders Wallin <wallinux@gmail.com>
+Date:   Fri Feb 22 17:14:30 2019 +0100
+
+    CHANGES: BUG: 2926: Make it possible to set agentXPingInterval for a subagent
+    
+    - register agentXPingInterval for the subagent list handler,
+      before it was registered for snmp
+    - added agentxTimeout to the subagent list handler.
+      It's now possible to set for snmpd and the subagent.
+      See 'man snmpd.conf'
+    - added agentxRetries to the subagent list handler.
+      It's now possible to set for snmpd and the subagent.
+      See 'man snmpd.conf'. It's never used in the subagent,
+      but it's now following the documentation
+    
+    Signed-off-by: Anders Wallin <wallinux@gmail.com>
+
+commit bcb1a6b8afc444bbcd099a195e08f0b01cbc8f6b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Sep 6 14:51:35 2019 -0700
+
+    HOST-MIB, hr_filesys: Fix Check_HR_FileSys_AutoFs()
+    
+    On Linux getmntent() is available but getfsstat() not. Hence remove #if
+    HAVE_GETFSSTAT from around the HRFS_type check.
+    
+    See also https://sourceforge.net/p/net-snmp/patches/1350/.
+    
+    Fixes: cf41e6e91015 ("HOST-MIB: Skip autofs entries").
+
+commit a2334651b84878222b6a758154b283bcf8b233ef
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Sep 6 14:49:32 2019 -0700
+
+    HOST-MIB, hr_filesys: Clean up HRFS_ignores[]
+    
+    Declare the HRFS_ignores array static. Make sure that "autofs" occurs once.
+    Define MNTTYPE_AUTOFS if necessary.
+
+commit 5e416538cf035a4a0856022327f6b5494b0506e3
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Wed Sep 4 14:50:22 2019 -0700
+
+    openssl 1.1.0 -> 1.1.1 per David Hauck
+
+----------------------------------------------------------------------
+
+Changes: V5.8 -> V5.8.1.pre1
+
+commit f69459109f64555321421501344c6965dc6355fd
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Tue Sep 3 08:10:21 2019 -0700
+
+    Version number update: 5.8.1.pre1
+
+commit 1b3ef39cb7a3a7142be5b250f36770fa9a011e61
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Tue Sep 3 08:04:19 2019 -0700
+
+    version update for 5.8.1.pre1
+
+commit 5e3643e627568661daf65c4e0a9ab2be633952ef
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Tue Sep 3 07:59:35 2019 -0700
+
+    NEWS: snmpd: security vulnerabilty in the ping MIB reported by Christopher Ertl from Microsoft fixed
+
+commit 2b0fc439d1507a267558b26e20edda13e0ad0d09
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Wed Aug 28 08:21:35 2019 -0700
+
+    snmpd.conf: document the "-s" argument to trap*
+
+commit 7c073e3a1b736689135fd2ed44ede5b83790bd37
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Aug 26 18:32:08 2019 -0700
+
+    IP-MIB, Linux: Fix a memory leak in an error path
+    
+    When a Linux system is booted with "ipv6.disable=1" in the kernel command
+    line, the file "/proc/net/snmp6" is not created. Fix the memory leak in
+    _systemstats_v6_load_systemstats() that is triggered with IPv6 disabled.
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2976/.
+    
+    Reported-by: Mark E Rusk <marker55@users.sourceforge.net>
+
+commit 37e498fdcde98ee93875a750dbcd5a8a9ba336b1
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Mon Aug 26 18:17:40 2019 -0700
+
+    SNMP-TARGET-MIB: express features used (broken by 58ae9e6b11)
+
+commit 904aefa5a241473f2075e60147a307b2250a4853
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Mon Aug 26 18:07:05 2019 -0700
+
+    ci: skip mibs that do not support read-only
+
+commit f8168d8f56744d1b96e776e863eae138253c18b9
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Mon Aug 26 14:33:30 2019 -0700
+
+    minimalist: adapt to semicolon-terminated feature macros
+
+commit a0aa55d4541906bdc7b92c9db3f4282d9aa6fb48
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Mon Aug 26 14:44:12 2019 -0700
+
+    ci: display configure command in Travis log
+
+commit f024ffeaef028d5db44dc40b97e53c352b573d4f
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Mon Aug 26 14:58:08 2019 -0700
+
+    ci: fix env configuration
+
+commit 22ce0a3e6d43ca0fd7451d13328bce7b719d549f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 25 07:44:11 2019 -0700
+
+    Win32: Remove most references to ActiveState Perl
+    
+    Several years ago the ActiveState Perl binaries were built with Microsoft
+    Visual Studio. Today the ActiveState Perl binaries are built with gcc. This
+    makes ActiveState Perl inappropriate for building Net-SNMP Perl modules with
+    Microsoft Visual Studio. Hence remove most references to ActiveState Perl.
+
+commit c887c216fc6a0cc9cd840e31742fba7f7bf5c8eb
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jan 23 20:40:00 2019 -0800
+
+    testing: Make it possible to run the Perl tests without installing Net-SNMP
+
+commit 3eadd6e2e4b2d4d118f7d4fe7ed329880c667e39
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jan 12 15:28:11 2019 -0800
+
+    perl: Fix "use of uninitialized value $ENV{"OSTYPE"}" warnings
+    
+    The bash shell sets the OSTYPE environment variable but FreeBSD sh not.
+    Hence check whether $OSTYPE has been set before using its value.
+    
+    [ bvanassche: backported this patch from the master branch ]
+
+commit d1a3c063b58b063feec4e58d7d1245ae0644cb47
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Nov 19 18:59:03 2018 -0800
+
+    snmpd, MIB-II: Fix a compiler warning in TCP_Count_Connections()
+    
+    Avoid that the compiler reports the following on Linux:
+    
+    mibII/tcpTable.c:341:1: warning: control reaches end of non-void function [-Wreturn-type]
+     }
+     ^
+    
+    Fixes: 7f3abe7515d5 ("Patch for tcpTable for FreeBSD 12")
+    
+    [ bvanassche: backported this patch from the master branch ]
+
+commit 54c71b0376b1597e01bf88187a9b807502526ec2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jun 6 11:20:42 2018 +0200
+
+    snmplib, MIBs, Python: Fix gcc 8 warnings
+    
+    Avoid that gcc 8 complains about incompatible function casts. This
+    patch does not change any functionality.
+    
+    [ bvanassche: backported this patch from the master branch ]
+
+commit f12c3f87e0c05c69e851ae1c152fa3c29d02f0df
+Author: Robert Story <rstory@freesnmp.com>
+Date:   Wed Nov 16 23:12:03 2016 -0500
+
+    Perl: Initialize session objects correctly
+    
+    [ bvanassche: backported this patch from the master branch ]
+
+commit 10a689b732c02ec8990400fbced0d0134b78c799
+Author: Robert Story <rstory@freesnmp.com>
+Date:   Thu Oct 13 13:43:42 2016 -0400
+
+    add range check; init vars to keep compiler happy
+    
+    [ bvanassche: backported this patch from the master branch ]
+
+commit 87bd90d04f20dd3f73e3e7e631a442ccd419b9d3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Aug 13 20:54:23 2019 -0700
+
+    libsnmp: Move the free_securityStateRef() call into snmp_free_pdu()
+    
+    This patch fixes a memory leak that was introduced in commit 5f881d3bf245
+    ("libsnmp, USM: Introduce a reference count in struct usmStateReference").
+    
+    This patch partially reverts commit adc9b71aba91 ("snmpd: Avoid that snmpv3
+    bulkget errors result in a double free").
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2938/.
+
+commit f124907b2a814dc2db2b3fd806a7cf9e83af5fc5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 11 12:25:22 2019 -0700
+
+    include/net-snmp/types.h: Remove a superfluous forward declaration
+
+commit 171ca693cf7b3d089e69042b5d187c45e1cf2303
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 11 12:00:00 2019 -0700
+
+    doxygen.conf: Fix INCLUDE_PATH
+
+commit deaf0a7d29ad0a6b4e8ee84fedcc30a0edd61921
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 11 12:11:53 2019 -0700
+
+    libsnmp, feature checking: Trigger a syntax error if the terminating semicolon is missing
+
+commit 59a6f52f1e64391d1fc08cb391651c60ff7ed047
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Aug 13 19:58:05 2019 -0700
+
+    treewide: Terminate netsnmp_feature_*() uses with a semicolon
+    
+    This patch has been generated by the following shell command:
+    
+    git grep -l netsnmp_feature_ |
+      while read f; do sed -i 's/^netsnmp_feature.*[^;]$/&;/' "$f"; done
+
+commit f3e80746fde826cf4665fb959bda78cce061c883
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Aug 5 20:15:37 2019 -0700
+
+    AgentX: Fix a use-after-free
+    
+    When calling snmp_async_send(), the callback function is called whether or
+    not sending succeeds. Since the agentx_got_response() callback function
+    frees the cache unconditionally, calling netsnmp_free_delegated_cache()
+    explicitly after snmp_async_send() is wrong.
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2943/.
+    
+    Fixes: f9304c83f762 ("CHANGES: PATCH 1633670: fixed snmpd crashing when an AgentX subagent disconnect in the middle of processing of a request.") # v5.8.
+
+commit f7972681c8d35506b75ec5fd652633b47e437869
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Aug 5 20:02:09 2019 -0700
+
+    libsnmp: Document _sess_async_send()
+
+commit 1300ebd66ac124139522542aef41ddc251d9f64e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Aug 5 20:05:17 2019 -0700
+
+    libsnmp: Fix Doxygen headers
+
+commit 9d150386ca35d0adffc7de1618ec69501f2d3bb1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 3 18:38:46 2019 -0700
+
+    winExtDLL: Call pfSnmpExtensionInitEx() even if pfSnmpExtensionInit() returns FALSE
+    
+    Fixes: https://sourceforge.net/p/net-snmp/bugs/2969/
+
+commit 73f2db7f669504789626d1a4644b0a9c24311147
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 3 17:46:29 2019 -0700
+
+    Win32, MSVC: Use the /MANIFEST:EMBED linker option instead of mt.exe
+    
+    This patch simplifies the Win32 Makefiles.
+
+commit b439755400da5954c45d055e48668f5f92d1cd55
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 3 17:22:18 2019 -0700
+
+    Win32, MSVC: Remove _BIND_TO_CURRENT_VCLIBS_VERSION
+    
+    Building with _BIND_TO_CURRENT_VCLIBS_VERSION defined is considered
+    questionable. Hence remove _BIND_TO_CURRENT_VCLIBS_VERSION. This
+    patch reverts commit b0a62eb19763 ("Define _BIND_TO_CURRENT_VCLIBS_VERSION
+    token (as per Alex' build instructions)") # v5.7.1.
+
+commit ed685ee20a1bc48b1c52bf1e77a693693499971b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 31 12:53:02 2019 -0700
+
+    Win32, MSVC: Enable Blumenthal AES if OpenSSL is enabled
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2966/.
+
+commit 620c8438f8cbf0c62deddb27b13aa25004b2dfe1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Jul 25 15:19:35 2019 -0700
+
+    ci/perl.bat, Win32: Upgrade the Perl version from 5.30.0 to 5.31.2
+
+commit bf391f4e98d4568a828d2c55f367cdddef7fa36f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jul 28 20:43:48 2019 -0700
+
+    apps/snmptable: Remove dead code
+    
+    This patch fixes CID 345250 (#1 of 1): Logically dead code (DEADCODE)
+    dead_error_line: Execution cannot reach the expression (char *)buf inside this statement: printf("End of table: %s\n"....
+
+commit 48550f0887528fe6e74315736f398ca53aa16171
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jul 28 20:45:17 2019 -0700
+
+    Perl modules: Fix a memory leak in an error path
+    
+    This patch fixes CID 345251 (#1 of 1): Unchecked return value (CHECKED_RETURN)
+    5. check_return: Calling snmp_send without checking return value (as is done elsewhere 14 out of 15 times).
+
+commit 5f881d3bf24599b90d67a45cae7a3eb099cd71c9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jul 27 19:34:09 2019 -0700
+
+    libsnmp, USM: Introduce a reference count in struct usmStateReference
+    
+    This patch fixes https://sourceforge.net/p/net-snmp/bugs/2956/.
+
+commit cae2cb04e05bbf74f8bfca0a7e6836c3c8144a6c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jul 28 21:07:38 2019 -0700
+
+    libsnmp, USM: Remove superfluous secStateRef tests
+    
+    secStateRef is never NULL. Hence remove the tests that check whether that
+    pointer is NULL. This was detected by Coverity.
+
+commit 42e21ea0279185d28219868612dbf83adac8b647
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jul 27 17:48:33 2019 -0700
+
+    libsnmp, USM: Unexport usm_create_user_from_session_hook()
+
+commit 2b32a0d80576caf0cc77a101179ceebba124020e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jul 21 20:44:18 2019 -0700
+
+    libsnmp: Fix memory leaks in usm_process_in_msg() error paths
+
+commit ee65591fba88648091ee3b72b1579a7b73581186
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jul 27 16:42:21 2019 -0700
+
+    libsnmp, USM: Unexport more functions
+    
+    Additionally, remove usm_remove_usmUser() since that function has no
+    callers.
+
+commit 8a97e3b4509ad07b155febb6a7bd8d70ad5d8033
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jul 27 07:29:40 2019 -0700
+
+    ci, Travis: Unbreak the Darwin build
+    
+    Fixes: 102dafdd1b2e ("ci: Fix ubuntu xenial build")
+
+commit 102dafdd1b2e2fa172008b5e84a8cf65b6bf3e40
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jul 26 22:00:42 2019 -0700
+
+    ci: Fix ubuntu xenial build
+    
+    Apparently Travis CI switched to trusty to xenial a few days ago. Make
+    the Travis build work on xenial.
+
+commit a0df31c18c513a0d79f4d526b1af7fad48748e57
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jul 26 21:40:12 2019 -0700
+
+    HOST-MIB: Fix a recently introduced bug
+    
+    Fixes: cf41e6e91015 ("HOST-MIB: Skip autofs entries")
+    
+    Note: this bug was not introduced by Josef but by me.
+
+commit aba456530704d671a74c77ed8d1e60158b1e7261
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jul 26 20:58:33 2019 -0700
+
+    libsnmp, USM: Enable type checking for session pointers
+
+commit e2c452c794705cd8b036e3fc4a04c1dc4e436cff
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jul 26 20:27:42 2019 -0700
+
+    libsnmp, USM: Declare two functions 'static'
+
+commit b78cb2621a6dee3d7cbf5bc382a3a9a481de20ea
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jul 26 20:07:21 2019 -0700
+
+    libsnmp, USM: Unexport four user manipulating functions
+
+commit d20c294762fba2fd33657fc571682921de1f5458
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jul 26 19:45:35 2019 -0700
+
+    libsnmp, USM: Unexport init_usm_post_config(), deinit_usm_post_config() and clear_user_list()
+
+commit 9ae17fd957dc0ca18993edc56c68f2e34133a7d9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jul 26 10:54:19 2019 -0700
+
+    Perl modules, Win32: Suppress C compiler warnings about integer assignments
+
+commit 944284745ef9d4ddc877202e258722f16e3afacb
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jul 26 08:18:20 2019 -0700
+
+    Perl modules: Split NET-SNMP-CFLAGS into NET-SNMP-INC and NET-SNMP-DEFINE
+
+commit 665cf2f66b9fc5a3f6afe4e75b7a1809e4a99515
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Jul 25 15:04:01 2019 -0700
+
+    ci, MSVC: Build Perl modules
+
+commit bca38bcc7284a9a69f4d55768a8d2eb21fe40ad4
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Jul 23 16:50:44 2019 -0700
+
+    ci, MSVC: Build and install Perl
+
+commit 07ed2514cc6ea863ec403eab6e2bb8bda2e6dd3e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Jul 25 12:40:00 2019 -0700
+
+    Perl modules, MSVC: Pass the OpenSSL include path to Perl MakeMaker
+
+commit 2a20a2a6169da21bca90ea23645ffdca6e09768c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Jul 23 21:36:35 2019 -0700
+
+    perl, Win32: Set PERL5LIB
+    
+    This is required for Perl 5.30.0. See also
+    https://sourceforge.net/p/net-snmp/bugs/2963/. See also
+    https://perldoc.perl.org/perl5260delta.html#Removal-of-the-current-directory-(%22.%22)-from-%40INC.
+
+commit ac6963606664099da58aa32a8c6ecac4ad7990b9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 24 16:38:04 2019 -0700
+
+    perl modules: Remove the now superfluous #define _WIN32_WINNT 0x501
+
+commit 9e8c1a413b2deca943d89414c0aeab6c15f97303
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 24 15:17:27 2019 -0700
+
+    Perl, MakeMaker, Win32: Define Net-SNMP C macros while building Perl modules
+    
+    This patch fixes https://sourceforge.net/p/net-snmp/bugs/2965/.
+
+commit f0292ee2edb038d52927f1b4330e315eadc42027
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 24 15:23:26 2019 -0700
+
+    Perl, MakeMaker: Remove NetSNMPGetOpts() argument
+
+commit df5ac81d2a662b2085d4272a7c6fb3902e5f697d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 24 13:09:05 2019 -0700
+
+    Perl, MakeMaker: Introduce AddCommonParams()
+    
+    This patch reduces code duplication.
+
+commit fe7558b32d52a50034332d353cb306e6a2b926db
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 24 14:40:10 2019 -0700
+
+    Perl, MakeMaker: Check all net-snmp-config invocations
+    
+    Fail if invoking net-snmp-config fails.
+
+commit 895a4c1ad8271be85bd35542f92ce80b2a3d9411
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 24 14:21:42 2019 -0700
+
+    Perl, MakeMaker: Always set $MakefileSubs::basedir
+    
+    This change will allow to use $MakefileSubs::basedir on the Windows platform
+    in a later patch.
+
+commit 3d175504fd9c6aa97210e31bc610afdd6f16623d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 24 20:39:21 2019 -0700
+
+    perl/MakefileSubs.pm: Set $opts->{'debug'}
+    
+    Avoid that using $opts->{'debug'} causes Perl to complain about using an
+    undefined value.
+
+commit 631bb2f2343ad4b5643f514d0e3b737b24bf00eb
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 24 14:48:19 2019 -0700
+
+    Perl modules: Convert to C89 function declaration syntax
+
+commit 2fbf8dec41710ab5d46110b07e3d1753c6ae2330
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 24 16:01:53 2019 -0700
+
+    ci, Appveyor: Download and install OpenSSL once
+
+commit cf41e6e910158fb4c4cb546c49acd587c5f58232
+Author: Josef Ridky <jridky@redhat.com>
+Date:   Wed Jul 24 07:23:47 2019 -0700
+
+    HOST-MIB: Skip autofs entries
+    
+    Do not call statfs() for autofs entries.
+    
+    See also https://sourceforge.net/p/net-snmp/patches/1350/.
+    See also https://sourceforge.net/p/net-snmp/bugs/2968/.
+    
+    [ bvanassche: Made several small edits ]
+
+commit 39381c4d20dd8042870c28ae3b0c16291e50b705
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Jul 23 10:52:28 2019 -0700
+
+    libsnmp: Unexport struct usmStateReference
+    
+    Certain snmpd crashes can only be fixed by introducing a reference
+    count in struct usmStateReference. Unexport that structure such that
+    changing it does not affect the ABI.
+
+commit bfcd20d9478bb5541fbf0bbf3bc7f857e82a3357
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Jul 23 08:28:38 2019 -0700
+
+    win32/Configure: Define NETSNMP_REMOVE_U64
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2965/.
+    
+    Reported-by: Harmdhast <harmdhast@users.sourceforge.net>
+
+commit 5293fe9902755b9c4ce9cb0a5fc64ed3ace0ff29
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jul 22 08:55:41 2019 -0700
+
+    libsnmp: Fix several Valgrind complaints
+    
+    Avoid that Valgrind complains about reading uninitialized memory on
+    random numbers generated by the OpenSSL library. Avoid that Valgrind
+    complains about received SSL data not having been initialized.
+
+commit 51ea70063882110e69be15d338ba3b86f1d98c38
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jul 21 20:55:29 2019 -0700
+
+    libsnmp: Optimize snmp_free_pdu()
+    
+    Remove commented-out code that would trigger a use-after-free if enabled.
+    Remove the memset() call that occurs just before the last free() call
+    since today there are better tools for detecting use-after-free issues,
+    e.g. Valgrind and AddressSanitizer.
+
+commit e59ccc374c463236416e036c8dd0702eb1da8f6f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jul 22 19:12:06 2019 -0700
+
+    testing/fulltests/unit-tests/T104agentx_parse_cagentlib: Add to repository
+    
+    This test is a reproducer for
+    https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=14502.
+
+commit 8b429a54b495fb69aa2efa4f15a815aaedd69f0c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jul 22 19:48:16 2019 -0700
+
+    AgentX: Fix an integer overflow
+    
+    Fixes: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=14502
+
+commit 341eef1b98e5406575aa4ec4708d3ab4615069ca
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jul 21 12:15:52 2019 -0700
+
+    libsnmp: Add ref argument to the MAKE_ENTRY() macro
+    
+    Make it explicit that 'ref' is an argument of the MAKE_ENTRY() macro.
+
+commit b8a882812ac08da4add3f5df53300a656fecdb17
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jul 21 20:47:58 2019 -0700
+
+    RMON-MIB: Fix a compiler warning
+    
+    Fix the following compiler warning:
+    
+    Rmon/alarm.c: In function 'var_alarmEntry':
+    Rmon/alarm.c:648:20: warning: cast discards 'const' qualifier from pointer target type [-Wcast-qual]
+      648 |             return (unsigned char *) "";
+          |
+
+commit 5ff6745c103abbac55d20892bddee66351ec554f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jul 21 20:46:01 2019 -0700
+
+    RMON-MIB: Fix a NULL pointer dereference in an error path
+    
+    This was detected by gcc.
+
+commit 273cd33796133a1642dcfbcae33935fce776911e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Jul 2 21:18:58 2019 -0700
+
+    perl Makefiles: MinGW / MSYS fixes
+    
+    This patch improves but does not fix the MinGW / MSYS Perl module build
+    entirely.
+
+commit 9ba4d351b42f2c46ea53d09546b7dd20b6200cde
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Fri Jul 19 07:41:01 2019 +0200
+
+    Reorder ifdefs to unbreak DragonflyBSD compilation.
+
+commit c82bc0f099b03c31f69daaf5106884c7cb008cb1
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Fri Jul 19 07:40:10 2019 +0200
+
+    snmptable: fix crash when agent has more columns than MIB.
+
+commit 2014ae27a44e6121acefd37db8091e075947b27a
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Tue Jul 16 22:10:21 2019 +0200
+
+    nmptable: detect and fail on non-increaing OIDs.
+
+commit 51df0da6f65be33ffc9723688318338fc4cce5c9
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Tue Jul 16 22:01:15 2019 +0200
+
+    testing: Debian 10 (buster) moved ss to /usr/bin/ss
+
+commit ef6db67f708f6590fb9d2797022ca1d957c89073
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 10 18:15:15 2019 -0700
+
+    Revert "NET-SNMP-SYSTEM-MIB, Linux: Update calculation of free space"
+    
+    Since there is a risk that this patch breaks existing monitoring
+    software, revert it.
+
+commit a88d81f1144ecf33f0ca02ada042b77368855a94
+Author: Josef Ridky <jridky@redhat.com>
+Date:   Thu Jul 4 08:45:19 2019 +0200
+
+    NET-SNMP-SYSTEM-MIB, Linux: Update calculation of free space
+    
+    Update calculation of free space for Physical and Virtual memory on linux.
+    Based on https://gitlab.com/procps-ng/procps/blob/master/proc/sysinfo.c#L789
+    
+    [ bvanassche: edited patch subject ]
+
+commit 18b7ab7ae81293e48fc6f24c085a536ac2dbf6da
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jul 3 20:58:41 2019 -0700
+
+    NET-SNMP-SYSTEM-MIB, Linux: Read /proc/meminfo once
+    
+    With recent Linux kernels the size of /proc/meminfo exceeds 1279 bytes.
+    Hence increase MEMINFO_INIT_SIZE and MEMINFO_STEP_SIZE.
+
+commit 4e3ace87b566c80585001bb55efe5886d0a9474f
+Author: Michael Rodrigues <michael.rodrigues@logicmonitor.com>
+Date:   Wed Jul 3 20:49:16 2019 -0700
+
+    NET-SNMP-SYSTEM-MIB: Account reclaimable space
+    
+    See also:
+    * https://gitlab.com/procps-ng/procps/commit/05d751c4f076a2f0118b914c5e51cfbb4762ad8e
+    * https://sourceforge.net/p/net-snmp/patches/1338/
+    * Linux kernel commit 972d1a7b1405 ("[PATCH] ZVC: Support NR_SLAB_RECLAIMABLE / NR_SLAB_UNRECLAIMABLE") # v2.6.19.
+    
+    [ bvanassche: rewrote patch description / removed error message if SReclaimable is not found ]
+
+commit 4fd9a450444a434a993bc72f7c3486ccce41f602
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 22 09:56:21 2019 +0200
+
+    CHANGES: snmpd: Stop reading and writing the mib_indexes/* files
+    
+    Caching directory contents is something the operating system should do
+    and is not something Net-SNMP should do. Instead of storing a copy of
+    the directory contents in ${tmp_dir}/mib_indexes/${n}, always scan a
+    MIB directory.
+
+commit 5ed1bc566a02c800f18e8439aa00e758158594ca
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jun 29 14:49:25 2019 -0700
+
+    SNMP-TARGET-MIB: Improve error messages
+    
+    Make it clear why adding a trap destination fails if the security name
+    is missing.
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2948/.
+
+commit 928f0726ff69a131006d904552ea482a31c6bd69
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jun 28 19:49:57 2019 -0700
+
+    ci/net-snmp-configure, MSYS2: Use OpenSSL again
+    
+    Apparently the previous two patches are sufficient to fix the MSYS2 + OpenSSL
+    build. Hence re-enable OpenSSL.
+    
+    This reverts commit e57b0f4f97f0 ("ci/net-snmp-configure, MSYS2: Use the internal OpenSSL implementation")
+
+commit a35c49fa673544e7128efcd0fcbd0ece5cfef979
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jun 23 08:19:48 2018 -0700
+
+    configure: Reduce MinGW build time
+
+commit 1d72b9f39dbaa7ad20b41c55ba5d03172503adb5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 12 07:51:29 2018 -0700
+
+    MSVC: Reduce build time
+    
+    Define VC_EXTRALEAN and WIN32_LEAN_AND_MEAN. Add additional #include
+    directives where necessary.
+
+commit e57b0f4f97f0bf5b63f94bd0850bbbbf51c9bebb
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jun 26 08:44:22 2019 -0700
+
+    ci/net-snmp-configure, MSYS2: Use the internal OpenSSL implementation
+    
+    To do: figure out why building with OpenSSL on MSYS2 succeeds locally
+    but not on AppVeyor.
+
+commit 886c864bba262c3993ea9485ac3d262ef526cf38
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jun 26 14:47:40 2019 -0700
+
+    ci/build.sh: Fix the branch name
+
+commit 2e08bbaa915fc5cdcd06a672b778104afb40b132
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 19 20:52:10 2018 -0700
+
+    snmplib/asprintf.c: Fix header file inclusion order
+    
+    Include <net-snmp/net-snmp-config.h> first.
+
+commit b51032fd7361775ff851067b0e0ce6d74daf1a41
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jun 23 08:09:34 2018 -0700
+
+    MinGW-w64: Suppress more compiler warnings
+
+commit 122245d0c78fecc12bf059b2ae01542dc365f9a1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun May 20 07:47:18 2018 -0700
+
+    Win32: Avoid that restart_doit() crashes snmpd
+
+commit f7540763f79dd9d738ed2a388de5004597114632
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 19 21:53:41 2018 -0700
+
+    MinGW: Rely on the configure script
+
+commit 56d8662c867a47d012920537198de6300017fc02
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jun 23 08:17:21 2018 -0700
+
+    snmplib: Define LOG_DAEMON etc. once
+
+commit 71292606c6b7c62a0cb3bdfe63c1bf41fbdb0877
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jun 3 21:00:34 2019 -0700
+
+    MSYS2: Fix IPv6 stack type detection
+    
+    Make sure that the IPv6 stack is detected as "generic" instead of "cygwin".
+
+commit 1d36ff4bc472a7e47de498c65de886b6c5e41fd6
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jun 3 20:55:44 2019 -0700
+
+    configure.d/config_project_ipv6_types: Remove dead code
+    
+    Fixes: 3efbbe9a7fa3 ("configure: Simplify IPv6 stack detection")
+
+commit 2689dfdff5d11169b743ccecc5a4bab9a7d153d7
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jan 20 21:12:44 2019 -0800
+
+    configure: Add a test for getlogin()
+    
+    This patch avoids that the build fails as follows on MinGW64:
+    
+    snmpping.c:567:13: error: conflicting types for 'getlogin'
+     const char *getlogin(void)
+                 ^~~~~~~~
+    In file included from /usr/include/unistd.h:4:0,
+                     from ../include/net-snmp/net-snmp-includes.h:34,
+                     from snmpping.c:59:
+    /usr/include/sys/unistd.h:118:9: note: previous declaration of 'getlogin' was here
+     char *  getlogin (void);
+             ^~~~~~~~
+
+commit cc4a3894e3abdc8e6a4ff6c2c1c1aa67d3449573
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Sep 16 06:17:36 2018 -0700
+
+    configure: Remove two commented out tests
+
+commit 011342d8e453b9e0585bf77f659d80c648df8c9f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 18 09:28:14 2018 -0700
+
+    snmptrapd: Let configure check for mysql_options()
+    
+    Let configure check for mysql_options() instead of using mysql_options()
+    depending on the MySQL version. Only call load_defaults() or
+    my_load_defaults() if mysql_options() is not available. Parse not_argv[]
+    only if mysql_options() is not available. This last change fixes
+    Coverity ID 266336 ("logically dead code").
+
+commit 6972080b8a75aa444a5dc8851dd5d2bc529e3fa3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 18 14:14:14 2018 -0700
+
+    configure: Fix detection of the MySQL header files
+    
+    Fixes: 8e1f21659275 ("CHANGES: snmptrapd: Add support for the latest libmysqlclient version")
+
+commit b5ade7d766e740f7c01ea4ed519b19d85f68773d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jun 22 18:31:05 2018 -0700
+
+    configure: Simplify IPv6 stack detection
+    
+    Combine all v6lib=dummy; v6libdir=none; v6trylibc=yes;
+    CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS" cases into a single case.
+    This patch makes IPv6 detection work on AIX.
+
+commit 15081d4e8f5c6e98f3e46996e9cbae50b7a895fc
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 8 14:48:37 2018 -0700
+
+    MinGW64: Fix the build
+    
+    When using Windows sockets, only detect header files that are compatible
+    with Windows sockets. Exclude any header files that are related to fork().
+    Do not try to detect socket functions that are defined in non-Winsock
+    header files.
+
+commit 3abe2c86dd1296a5a3b4563fd930cdc0223abd04
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 19 21:12:26 2018 -0700
+
+    MinGW: Include the Winsock header files before all other header files
+
+commit 0097fd24427e980a9045f2fed1e7b3aa03e1657c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 8 17:34:50 2018 -0700
+
+    MinGW: Only use the <sys/...>, <net/...> and <netinet/...> header files if not using <winsock2.h>
+    
+    Since most <sys/...>, <net/...> and <netinet/...> conflict with the
+    Winsock header files, only include the former if not using Winsock.
+
+commit 748718eddc9e773d28495bdb93c06fc575a680fd
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 9 05:48:12 2018 -0700
+
+    configure.d/config_os_functions: Avoid testing the target OS name directly
+
+commit b7e9a5064a839ed997d5b22ddd2a2a6ca889e0e5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 19 21:24:51 2018 -0700
+
+    configure.d/config_os_functions: Fix a typo
+
+commit b12c749cc7bea0859e1738da03806c69ff6016c8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jun 23 16:37:36 2019 -0700
+
+    ci: Add --with-systemd to the configure options
+
+commit 43c50b997fa39e599bf6c9b04a33f67e8311ced0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jun 23 16:36:27 2019 -0700
+
+    libsnmp: Fix a compiler warning
+
+commit c84d3843bda3a3d85907c0f00291d43c6e9d8d40
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jun 23 15:47:18 2019 -0700
+
+    libsnmp: Fix --with-systemd build
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2948/.
+    
+    Reported-by: Jean-christophe Manciot <jcmanciot@users.sourceforge.net>
+    Fixes: 76336fb63bb7 ("libsnmp/transports: Change multiple sockaddr_in* arguments into netsnmp_ep").
+
+commit ede5c393704dc1d7e0613b97daacce13865683b6
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Jun 20 21:42:35 2019 -0700
+
+    AgentX: Limit input size again to 64 KB
+    
+    This patch avoids that the oss-fuzzer times out. See also
+    https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=7280.
+    
+    See also 46a42549dbae ("AgentX: Reduce stack usage").
+
+commit 2e83dc51f3d91df109eab8d586b14da07009c641
+Author: Yahu Gao <yahu.gao@windriver.com>
+Date:   Mon Jun 10 09:35:03 2019 +0800
+
+    snmpd: Remove a duplicate assignment
+    
+    See also https://sourceforge.net/p/net-snmp/patches/1395/.
+    
+    Signed-off-by: Yahu Gao <yahu.gao@windriver.com>
+    [ bvanassche: edited patch description ]
+
+commit 3aebfbab87eb8b385abd5de93cbc45fc9780ad2d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jun 7 21:22:08 2019 -0700
+
+    Perl: Fix the session pointer data types
+    
+    Use void * for session pointers that can have either type struct
+    session_list * or netsnmp_session *. This patch does not change any
+    functionality.
+
+commit b590f1bde34b9331cc5270a7f39c839a31d44223
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jun 7 21:39:53 2019 -0700
+
+    Perl: Fix single-session support in __snmp_xs_cb()
+    
+    No matter which API (traditional or single-session) is being used, the
+    second argument (ss) has the type netsnmp_session *. Hence use snmp_send()
+    and do not use snmp_sess_send().
+
+commit de19ec6bd12f81e935a986583a9fd9ab0cf7fd62
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jun 7 21:34:57 2019 -0700
+
+    Perl: Make _catch work for the single-session API
+    
+    The type of the session pointer depends on the value of the api_mode
+    variable. Make the interpretation of the session pointer dependent on
+    the API mode.
+
+commit 0ef2d7209be7f75a147765e5748ac1dd8f2bb36b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jun 8 18:57:35 2019 -0700
+
+    python: Make __send_sync_pdu() set the 'err_num' argument correctly
+    
+    Fix the type of the session pointer passed to __send_sync_pdu() and also
+    fix the *err_num assignment.
+
+commit 0da34dc47eb2214e8e137a9cf2757fae1ceee709
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jun 7 06:52:11 2019 -0700
+
+    configure: Check for Winsock2 before checking for Cygwin
+    
+    This patch avoids that the MSYS2 IPv6 stack is recognized as 'cygwin'
+    instead of 'winsock2'.
+
+commit fd4bb10c3ae046857c5131545ac7c87b4fb8de32
+Author: Jon DeVree <nuxi@vault24.org>
+Date:   Thu Jun 6 19:56:51 2019 -0400
+
+    agent, MIBs: Use snmp_close() instead of snmp_sess_close() where required
+    
+    This patch avoids that closing a session triggers a crash.
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2944/ and
+    https://sourceforge.net/p/net-snmp/patches/1393/.
+    
+    Fixes: 4641464b4ec2 ("netsnmp_create_v3user_notification_session") # v5.8.
+    Fixes: 61ac63fa6ee6 ("add missing error handling in notifyTable") # v5.8.
+    Fixes: de8bc3c2d4ac ("separate notification storage from MIB implementation") # v5.8.pre1~285.
+    
+    [ bvanassche: edited commit message ]
+
+commit a6ba68ff77ca60260d5f5b007f409d08ce75c3b1
+Author: Ming Chen <ming.chen@watchguard.com>
+Date:   Wed Jun 5 22:48:35 2019 -0700
+
+    agent/snmp_agent.c: Fix source code indentation
+
+commit 7384a8b550d4ed4a00e41b72229cfcc124926b06
+Author: Ming Chen <ming0903@users.sourceforge.net>
+Date:   Wed Jun 5 19:58:44 2019 -0700
+
+    libsnmp: Fix usm_free_usmStateReference()
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2923/.
+    
+    Fixes: adc9b71aba91 ("snmpd: Avoid that snmpv3 bulkget errors result in a double free")
+
+commit 270c4018e6ee4f5150aecb3b52039e6eeab2c942
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jun 5 19:32:04 2019 -0700
+
+    MIBs: Fix netsnmp_get_link_settings()
+    
+    This patch is based on a patch from Sam Tannous. See also
+    https://sourceforge.net/p/net-snmp/patches/1387/.
+
+commit 7c2ca346abc13eb0c33d134761b199bcffe753fe
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jun 5 18:56:42 2019 -0700
+
+    MIBs: Introduce netsnmp_get_link_settings()
+    
+    This patch does not change any functionality.
+
+commit 2968b455e6f182f329746e2bca1043f368618c73
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Mon Jun 3 10:01:08 2019 -0700
+
+    libsnmp: free filenames from directory listing
+    
+    Free each filename as we use it, as well as freeing the
+    list of filenames.
+    
+    Fixes: 2b3e300ade4a ("CHANGES: libsnmp: Scan MIB directories in alphabetical order")
+
+commit 5280e837dd475fb29d62e0ee4350c3f996467218
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jun 3 21:31:43 2019 -0700
+
+    MSYS2: Fix IPv6 stack type detection
+    
+    Make sure that the IPv6 stack is detected as "generic" instead of "cygwin".
+
+commit 5e1b4a5655dc0041b4e9ce6489f8223e33593201
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jun 2 10:57:09 2019 -0700
+
+    ci: Build Windows 64-bit installer and store it as an artefact
+
+commit ed630cf540f662f8a7b6d52787e7ce4482254d75
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jun 2 17:09:48 2019 -0700
+
+    win32/dist/build-binary.pl: Search %PATH% for tar.exe and gzip.exe
+    
+    Additionally, obtain the OpenSSL path from %OPENSSLDIR% and only show
+    the makensis output if that command fails.
+
+commit 5a865399bebcc34814860e9fa5539cc7f6de04c3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jun 2 10:43:39 2019 -0700
+
+    apps/snmpping.c: Include <unistd.h> for getlogin()
+
+commit 5018d4ffcf0168e4d3162cacb44507b2a6bc6362
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jun 2 08:52:03 2019 -0700
+
+    apps/snmpusm.c: Avoid that the MSYS2 or MinGW64 build fails
+
+commit a0abab5af9e83ae92bac20f9f8b5118b1d42a5e5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 25 17:28:25 2019 +0200
+
+    snmplib/snmp_client.c: Document that pdu->securityModel == SNMP_DEFAULT_SECMODEL
+
+commit 20524c9fde900a426536b52983a88a0cc3eb4972
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 23 11:08:27 2019 +0200
+
+    _snmp_parse(): Call free_securityStateRef() instead of open-coding it
+    
+    This patch does not change any functionality.
+
+commit 92ccd5a82a019fbfa835cc8ab2294cf0ca48c8f2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 25 16:33:31 2019 +0200
+
+    libsnmp: Move the securityStateRef check into free_securityStateRef()
+    
+    Instead of making each free_securityStateRef() caller check the
+    securityStateRef pointer, move that check into free_securityStateRef().
+
+commit c268ba41bd42ab78184fc91dd0e705259f644802
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jun 1 21:51:32 2019 -0700
+
+    ci/openssl.bat: Bump the OpenSSL version
+
+commit 77b1f7c15ea74e430ca304e61033fdb6fe047ed1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jun 24 19:14:26 2018 -0700
+
+    Fix clang compiler warnings
+    
+    This patch does not change any functionality.
+
+commit 526617cf1ee629fdda48d1702aa90311b9e7a828
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jun 1 09:39:59 2019 -0700
+
+    MIBs, apps: Avoid passing NULL to the %s format specifier
+    
+    This was detected by gcc 9.
+
+commit 6327b217d67a8eb9e5d90f18cc9bbc0c499fe495
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 23 22:44:14 2019 +0200
+
+    include/net-snmp/types.h: Unbreak the MinGW build
+    
+    Revert the two most recent changes to this header file to avoid that the MSYS2
+    build fails as follows:
+    
+    util_funcs.c:406:1: error: conflicting types for 'get_exec_pipes'
+     get_exec_pipes(char *cmd, int *fdIn, int *fdOut, netsnmp_pid_t *pid)
+     ^~~~~~~~~~~~~~
+    In file included from util_funcs.c:91:0:
+    util_funcs.h:40:17: note: previous declaration of 'get_exec_pipes' was here
+     int             get_exec_pipes(char *cmd, int *fdIn, int *fdOut, HANDLE *pid);
+                     ^~~~~~~~~~~~~~
+
+commit e9ce939e41986955ac21bc37dac5c4ed02332c14
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 23 10:48:02 2019 +0200
+
+    ci/build.sh: Stop dumping config.log
+    
+    Now that the configure script works reliably for MinGW, stop dumping config.log
+    upon build failures.
+
+commit f100abcd4dfd386f8c5be2169beed199756404a9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 23 10:50:59 2019 +0200
+
+    Cygwin: Unbreak the build
+    
+    Fixes: 48593bb6abd2 ("include/net-snmp/types.h: Include <windows.h> explicitly")
+
+commit 48593bb6abd20f4817504206ac672ee396c02e47
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 22 17:03:51 2019 +0200
+
+    include/net-snmp/types.h: Include <windows.h> explicitly
+
+commit 328b1161cac13cecb65a87e3355d1ac483a7f89c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 22 17:22:37 2019 +0200
+
+    libsnmp: Simplify snmp_free_pdu()
+    
+    This patch does not change any functionality.
+
+commit deef46f3d24a038fb383f23f638fed4e05985888
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 22 15:06:11 2019 +0200
+
+    libsnmp, MinGW: Fix format specifiers in debug statements
+    
+    Fixes: 2706f0024dc7 ("libsnmp: Make it easier to verify how the maximum message size is determined").
+
+commit 67c2b92015e5f1c82d9877e4008a7df7f3fdd250
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 22 10:30:10 2019 +0200
+
+    configure, MinGW: Make the winsock header file detection more reliable
+    
+    Avoid that winsock header file detection fails due to <sys/types.h> being
+    included before a winsock header file. This patch prevents that detecting
+    a winsock header file fails as follows:
+    
+    In file included from /usr/include/w32api/winsock.h:36:0,
+                     from conftest.c:163:
+    /usr/include/w32api/psdk_inc/_fd_types.h:100:2: warning: #warning "fd_set and associated macros have been defined in sys/types.      This can cause runtime problems with W32 sockets" [-Wcpp]
+     #warning "fd_set and associated macros have been defined in sys/types.  \
+      ^~~~~~~
+    
+    Fixes: f0d400c28b54 ("MinGW64: Fix winsock2.h header detection")
+
+commit c77172ae94bde978c18cf02437e0f2d3875ff75a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 22 10:12:09 2019 +0200
+
+    ci/build.sh: Fail the build if "make" fails
+    
+    Fixes: b3f3cb8b4948 ("ci/build.sh: Dump config.log if 'make' fails")
+
+commit 114e4c2cec2601ca56e8afb1f441520f75a9a312
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 22 10:08:53 2019 +0200
+
+    libsnmp: Fix a compiler warning
+    
+    Avoid that the compiler complains on Windows systems that tmpstr[] is not used.
+    
+    Fixes: 2b3e300ade4a ("CHANGES: libsnmp: Scan MIB directories in alphabetical order")
+
+commit f142b40a3b885d871959e3f94ccc010043158008
+Author: Ming Chen <ming0903@users.sourceforge.net>
+Date:   Tue May 21 19:36:17 2019 +0200
+
+    snmpd: Avoid that CPU usage goes up to 100% while processing a getbulk request
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2941/.
+    
+    [ bvanassche: left out comment and "continue" statements ]
+
+commit 0b32cca60331af47714d3bd369ecdc13e36aa22a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 21 19:34:43 2019 +0200
+
+    agent/helpers/table_iterator.c: Adjust source code indentation
+
+commit 66d32cef5ec3b97d59668ff27fb3c1799bb39966
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 21 17:39:49 2019 +0200
+
+    libsnmp, DTLSUDP: Fix address formatting code
+    
+    Make sure that a meaningful address is shown with debugging enabled when sending
+    DTLSUDP data.
+
+commit 4c7c819f7157ca0593fb8b0a87cf094e088e8736
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 21 14:44:06 2019 +0200
+
+    libsnmp, DTLSUDP: Fix transport constructors
+    
+    Make sure that the transport constructors return a DTLSUDP transport object
+    instead of an UDP transport object.
+    
+    Fixes: d60c3cb2e6af ("NEWS: snmplib: add IPv6 support to DTLSUDP transport CHANGES: snmplib: use new netsnmp_sockaddr_storage in netsnmp_addr_pair CHANGES: snmplib: add base_transport ptr for tunneled transports") # v5.7.rc2~604.
+
+commit 1af6a41824bc4364d5edc3c15b942328300029cc
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 21 14:23:39 2019 +0200
+
+    snmpd: Fix three memory leaks
+    
+    Avoid leaking memory if -profile, -name and/or -tag are specified multiple times
+    in a trapsink, trap2sink or trapsess specification. This was detected by Coverity.
+
+commit 09f2cbaed98012e7e063361d02768161005aaa0f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 16 14:32:26 2019 +0200
+
+    libsnmp, netsnmp_parse_args(): Fix memory leaks in error paths
+
+commit 42535c3a47066bd8d68aff49e4559fd949dd90bb
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 16 14:57:20 2019 +0200
+
+    libsnmp, netsnmp_parse_args(): Rework error paths
+    
+    This patch does not change any functionality.
+
+commit 7576fcde27301d079f37dacb08aba9d0d2b29560
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 16 14:40:00 2019 +0200
+
+    snmpd: Suppress a false positive Coverity complaint
+    
+    Avoid that Coverity complains that the third argument passed to memset() exceeds
+    the size of a single array element.
+
+commit 9d55a7067f21f805aca7c8b58bd68bfeb2c8aef0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 16 14:21:31 2019 +0200
+
+    ucd-snmp proxy: Avoid that proxy_fill_in_session() crashes if out of memory
+
+commit 2e4091f4cbe171213a5674246898181f6706941e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 16 14:15:25 2019 +0200
+
+    libsnmp: Suppress a false positive Coverity complaint
+    
+    Although it is not required that community strings are '\0' terminated,
+    Coverity complains about the community string duplication code in _sess_copy().
+    Make Coverity happy by using strdup() instead of netsnmp_memdup().
+
+commit 9cfb38b0aa95363da1466ca81dd929989ba27c1f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 16 13:49:05 2019 +0200
+
+    libsnmp: Fix two recently introduced issues in the MIB parsing code
+    
+    Ensure that the first argument passed to qsort() is not NULL. Free the memory
+    that holds the directory contents.
+    
+    Fixes: 2b3e300ade4a ("CHANGES: libsnmp: Scan MIB directories in alphabetical order")
+
+commit d73ebccfe45be49f70ab0a3f5dd298db78c99f6d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 16 13:48:03 2019 +0200
+
+    AgentX: Fix two use-after-free issues
+    
+    snmp_add_full() frees the transport if it fails. This was detected by Coverity.
+
+commit 78bf0069ddd24ea0cc716421c53e1daf46da7002
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 15 21:25:46 2019 +0200
+
+    CHANGES: libsnmp: Increase the maximum SNMPv3 session receive size from 1472 to 2**31-1 bytes
+    
+    For the UDP transport this patch increases the maximum message size from 1472
+    to about 64 KB.
+    
+    This patch adjusts a limit that was introduced by commit 6e83b3cd891d
+    ("respect msgMaxSize in received v3 PDUs (in the weak sense that if the
+    serialized response PDU is more than it, we don't send it)") # v5.7.
+
+commit d1f6c87d83f0cef32696f4c4d70b61149e305390
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 15 18:23:59 2019 +0000
+
+    testing/fulltests/default/T0221snmpbulkget_large_simple: Make this test more robust
+    
+    Since sysUpTime may appear in the MIB walk that starts at .1, check whether
+    sysUpTime occurs at least once in the output instead of checking whether it
+    occurs exactly five times. Enable several debug options.
+
+commit 2706f0024dc7edbe29ab3f842468bf50a4d069d3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 15 20:24:07 2019 +0200
+
+    libsnmp: Make it easier to verify how the maximum message size is determined
+    
+    This patch only modifies debug log statements.
+
+commit 6066c6e21991ee31ae4fd5eaf791911a31c3432f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri May 17 08:44:08 2019 +0200
+
+    libsnmp, snmpv3_packet_build(): Avoid triggering a buffer overflow
+
+commit fac879e83e529bf10b7c91227faa18cafe622d22
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri May 17 08:38:25 2019 +0200
+
+    libsnmp, snmpv3_packet_build(): Use sizeof() where appropriate
+    
+    This patch does not change any functionality.
+
+commit a00eb0515be695786bdc7d839a066e4870064a5a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 14 18:09:25 2019 +0200
+
+    perl/SNMP/t/mib.t: Make it easier to enable the debugging code in this test
+
+commit e8f2295bc02e0fc73514efc7c660ed69d689fa68
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 14 18:45:33 2019 +0200
+
+    perl/SNMP/t/mib.t: Verify the result of all tests
+    
+    This patch reverts commit 3c0a609e0c24 ("comment out broken tests for now (XXX marked)") # v5.7.
+
+commit 2b3e300ade4add03b889e61d610b0db77d300fc3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 15 14:09:25 2019 +0200
+
+    CHANGES: libsnmp: Scan MIB directories in alphabetical order
+    
+    This guarantees that e.g. mibs/RFC1213-MIB.txt is read before mibs/SNMPv2-MIB.txt.
+    The order in which these MIBs is read matters because both define sysLocation but
+    with different attributes.
+
+commit e6a1bbc2304fc0391f479e28946872bf324fb597
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Aug 21 04:52:44 2018 +0000
+
+    MIB-II, IPv6: Port to FreeBSD
+    
+    Compile-tested only.
+
+commit b6f77702dfaf98addf8d3502e86cb30de0fccd13
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 15 09:32:10 2019 +0200
+
+    agent/mibgroup/mibII/ipv6.c: Reduce the scope in which 'udb6' and 'tcb6' are visible
+    
+    This patch does not change any functionality.
+
+commit ee11caa817c5b12c290d01299d2554da87b0ddf7
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 15 10:12:44 2019 +0200
+
+    testing/fulltests/tls/STsmPrefix: Specify the snmpd transport endpoint once
+    
+    Additionally, remove an snmpget invocation of which the output is not used.
+    
+    Fixes: d75c5a1c4f03 ("useprefix scalar testing and support") # v5.7.
+
+commit 89aecee38ea9afcd1ae0cad98da02832919730ac
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 14 21:09:05 2019 +0200
+
+    testing/fulltests/default/T0221snmpbulkget_large_simple: Only run this test on Linux systems
+
+commit 785c25da91286b929bcdf196db4a26f10e228bf3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 14 17:35:42 2019 +0200
+
+    testing/fulltests/default/T0221snmpbulkget_large_simple: Add this test
+    
+    Add a test for an snmpbulkget with a reply that exceeds the size of a single
+    Ethernet UDP datagram.
+
+commit b3f3cb8b4948a14663b5071348b95e43a16a4360
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon May 13 18:36:55 2019 +0200
+
+    ci/build.sh: Dump config.log if 'make' fails
+
+commit 9f0e0e6266b3316cda548d2870302ca4cd405aec
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 14 07:52:38 2019 +0200
+
+    testing/fulltests/default/T053trapforwardloop_simple: Improve test robustness
+    
+    Match both text strings that report trap forwarding.
+
+commit 07270f0a1940734eea992949ea9d751e866896d7
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon May 13 17:54:37 2019 +0200
+
+    libsnmp: Remove obsolete comments from the container code
+    
+    See also commit e2f9573849bd ("CHANGES: snmplib: remove inline versions of container funcs") # v5.7.
+
+commit d21d33cf5693a4ac5a6c88182ec59560019694fe
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun May 12 15:09:21 2019 +0200
+
+    win32/Configure: Add the --enable-blumenthal-aes option
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2937/.
+
+commit 9cb80e309be7da1b498b4295d8ec81f21b6d209b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 11 16:07:30 2019 -0700
+
+    testing: Add a test that verifies whether forwarding loops are detected correctly
+
+commit b45782d5632266e86613d9bd5696f0b7fab3ef19
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu May 9 20:14:50 2019 -0700
+
+    snmptrapd: Add original sender and forwarder IP addresses to forwarded traps
+    
+    See also https://sourceforge.net/p/net-snmp/patches/1320/.
+    
+    [ bvanassche: modified the implementation of this patch significantly; added
+      a man page description and removed the --add-forwarder-info snmptrapd
+      command line option ]
+
+commit 3673f3263e4b0d5f0805c557871b3d342289f74f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 8 20:33:48 2019 -0700
+
+    ci/before.sh, ci/net-snmp-configure: Extend FreeBSD test coverage
+
+commit 50bccea7cb515dddb1883dfcee6e9100ab9264ce
+Author: Ming Chen <ming.chen@watchguard.com>
+Date:   Wed May 8 10:50:08 2019 -0700
+
+    MIB-II: Avoid that snmpd uses 100% CPU for querying network interfaces
+    
+    snmpd updates its network interface cache data every 3 seconds. If there
+    is a huge number of virtual interfaces updating the cache takes longer
+    than 3 seconds. Optimize the code that queries network interfaces by
+    moving netsnmp_access_ipaddress_ioctl_get_interface_count() out of the
+    while loop and by calling netsnmp_arch_interface_index_find() only for
+    IPv6.
+    
+    Fixes: https://sourceforge.net/p/net-snmp/bugs/2137/
+    
+    [ bvanassche: fixed coding style issues, rewrote the commit message and
+      fixed a compiler warning ]
+
+commit 0b88ff97e30db34bacd8375b4d15b0b101c0d57c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 8 17:33:35 2019 -0700
+
+    agent/mibgroup/ip-mib/data_access/ipaddress_ioctl.h: Avoid using typedefs
+    
+    Use struct netsnmp_ipaddress_entry_s instead of the corresponding typedef
+    such that it becomes easier to include this file.
+
+commit 8f92cadfecedc4bc6bc56c24d8282d11f82b06c3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon May 6 21:20:13 2019 -0700
+
+    ci: Improve the code that supports various Windows builds
+    
+    Install openssl-devel again on MSYS2. Fix the MSYS2 and MinGW32 code for
+    detecting the OpenSSL version. Disable Python support again for MSYS2.
+
+commit c890caa47876a0da05e69cae1428b65d9ec70478
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Tue May 7 13:10:51 2019 -0700
+
+    Avoid off-by-one error when logging "" to a file
+
+commit f9dfc64746c69e4f9cb34837863baa94156f5082
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon May 6 20:15:51 2019 -0700
+
+    ci/net-snmp-configure: Detect which software has been installed
+    
+    Detect which software has been installed instead of hard-coding per
+    CI environment which options to enable. Fix the OpenSSL and openssh
+    version checks. Simplify the Python check. Fix the SSL include path
+    checks on MinGW32 and MinGW64. Fix the test that decides whether or
+    not to enable Blumenthal AES.
+
+commit 7510e972655f86818eac2944b554396f11a41d1d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon May 6 20:25:34 2019 -0700
+
+    .travis.yml: Also install the MariaDB client library
+
+commit 33f8e2e1d63ad5932ade885ffbff379cab1e50bd
+Author: Shogo Matsumoto <shogo.matsumoto@jp.fujitsu.com>
+Date:   Tue May 7 09:41:13 2019 +0900
+
+    agent/mibgroup/agentx: Fix double free of delegated cache in agentx_got_response()
+    
+    If snmpd receives a response from subagent immediately after the agentx
+    session closed, agentx_got_response() frees delegated cache twice.
+    
+    This patch changes return value of "response too late on session"
+    in agentx_got_response function to make the caller of this function
+    remove the request in order to prevent double free.
+    
+    See also https://sourceforge.net/p/net-snmp/patches/1392/.
+    
+    Signed-off-by: Shogo Matsumoto <shogo.matsumoto@jp.fujitsu.com>
+    [ bvanassche: added patch tracker URL ]
+
+commit be80fdbeb0f21c1ed819f8b80736dab2d093601d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun May 5 20:17:00 2019 -0700
+
+    ci/build.sh: Fix Mingw64 package list
+
+commit 068b4686739cc8add671639597bada19d91845a0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun May 5 19:08:16 2019 -0700
+
+    libsnmp: Rework the MDblock() implementation
+    
+    Avoid that MDblock() modifies its input data buffer on big-endian systems.
+
+commit fc071d97669ccac61d07e28c2b7fd0aacc840ff4
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 29 18:47:07 2019 -0700
+
+    ci/build.bat: Add an URL to the Appveyor documentation
+
+commit 2954c4e3c92026b3a6d4c0a0f44e9919b61d20be
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 29 12:25:59 2019 -0700
+
+    ci/build.sh: Make the MinGW-w64 build more reliable
+    
+    Uninstall packages on which the installed packages depend before installing
+    any packages.
+
+commit bfdccd426c484ec70d80c36c774b2b12b20afec3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 29 10:26:51 2019 -0700
+
+    AgentX: Restore another size check
+    
+    Fixes: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=14502.
+    Fixes: 46a42549dbae ("AgentX: Reduce stack usage").
+
+commit a083613bf8da6863ed252fbe0177cadee779ce07
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 29 06:54:33 2019 -0700
+
+    libsnmp: Really fix the FreeBSD build
+    
+    Apparently on FreeBSD 'timezone' is a function instead of a global variable.
+    Detect the type of 'timezone' and only use its value if it is a scalar.
+
+commit d575c3e77aa951135eca7eabe442d9e90a5b6dad
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 28 21:37:28 2019 -0700
+
+    libsnmp: Unbreak the FreeBSD build
+    
+    Avoid that the FreeBSD build fails as follows:
+    
+    snmp-tc.c:258:21: error: use of undeclared identifier 'daylight'
+        tm.tm_isdst = !!daylight;
+                        ^
+    snmp-tc.c:259:15: error: invalid operands to binary expression ('int' and 'char *(*)(int, int)')
+        tm.tm_sec -= timezone;
+        ~~~~~~~~~ ^  ~~~~~~~~
+
+commit 314ac9a648aa5901dc4daaa3ac04dcc94b0eef5e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 28 21:27:48 2019 -0700
+
+    AgentX: Avoid passing a long to abs()
+    
+    The function abs() namely expects an 'int' as argument.
+
+commit f39d5486bd66adde244fb0c6fbaf8d55e22918cd
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 28 19:49:42 2019 -0700
+
+    MSVC: Define the NETSNMP_BIGENDIAN macro
+    
+    Fixes: 484524cda948 ("configure: Determine endianness at compile time instead of at configure time")
+
+commit d57f431170190c2fd18dea965e8bfc50cd205e02
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 28 18:30:27 2019 -0700
+
+    libsnmp, asn_parse_objid(): Avoid reading uninitialized memory
+    
+    This patch fixes Coverity ID 85590.
+
+commit 88e001fe799e868753f86330a532d94de47f9fe4
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Apr 26 10:31:13 2019 -0700
+
+    testing/fulltests/support/simple_run: Reduce the number of 'cd' commands
+    
+    Make the code easier to read by using explicit paths instead of 'cd'
+    where appropriate. Remove the SNMP_ORIGDIR variable since it is no
+    longer necessary.
+
+commit 39121a995d09484766ee5e86137ade1123bea7ab
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 28 17:15:14 2019 -0700
+
+    snmplib: Fix tm.tm_isdst check in ctime_to_timet()
+    
+    This patch fixes Coverity issue 144417.
+    
+    Fixes: af3fc499f600 ("snmplib: Initialize tm_isdst if available") # v5.8.
+
+commit 484524cda94838dfec8eb1ae92b069ea8ce448f6
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 28 13:40:24 2019 -0700
+
+    configure: Determine endianness at compile time instead of at configure time
+    
+    The new test supports cross-compilation. In other words, --with-endianness
+    no longer has to be specified during cross-compilation.
+
+commit 4a0886b848855942699758b5cee3e47783bdc4db
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 28 15:41:31 2019 -0700
+
+    win32/config.h.borland: Remove this header file because it is obsolete
+    
+    The most recent version of the Borland compiler was released in 2000 so
+    it is unlikely that anyone is still using that compiler. Hence remove the
+    Borland config.h file.
+
+commit 8071426579ca4b00d51fb0c11360ab701e0f9faa
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 28 15:05:05 2019 -0700
+
+    testing/fulltests/unit-tests/T008asn1_clib.c: Make the integer encoding test more strict
+
+commit 79857f794c1d2b17d058b949fc8b30632d8c4e40
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 27 21:12:55 2019 -0700
+
+    libsnmp, ASN parsing: Avoid triggering undefined shift-left behavior
+    
+    A quote from https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=7199:
+    
+    So this is a fun corner case of asn.1 integer parsing: the C standard says
+    that shifting a negative number left has undefined behavior. The other
+    obvious way to do this is to use the same code on an unsigned long, and
+    then cast to long.  The result of a cast to a signed value is
+    implementation-defined.  Linus Torvalds' argument on this is that there
+    is no sensible way for the implementation to define it other than "copy
+    the 2's complement bits".
+    
+    Avoid triggering all these corner cases by using byte-copying instead of
+    using shift operations.
+    
+    Fixes: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=7199
+
+commit 7de049193ab78d9fcdc3baa2c0673bd1e300ed5b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 27 20:53:15 2019 -0700
+
+    AgentX: Avoid reading uninitialized data
+    
+    Fixes: 46a42549dbae ("AgentX: Reduce stack usage")
+    Fixes: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=14481
+
+commit 9af3c50c84d24de06c0fa48c9fef721e2490ce49
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 27 16:54:32 2019 -0700
+
+    ci/net-snmp-configure: Only set --build=... for MSYS2
+
+commit c43115d39ffc9dfbc55d7c18bb33b17a8847c0d7
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 27 16:31:26 2019 -0700
+
+    agent/mibgroup/winExtDLL.c: Fix Mingw64 compiler warnings
+    
+    Avoid that the Mingw64 compiler complains about incompatible function
+    casts.
+
+commit 21b0ea844db3e45ec170ddec0bab1cea083e3709
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 27 16:31:16 2019 -0700
+
+    agent/mibgroup/util_funcs.c: Fix Windows debug statements
+    
+    Fixes: 9f4f13c6cb42 ("CHANGES: Win32: BUG: 2779541 Fixed handle leak in pass_persist.") # v5.7.rc2.
+
+commit e6e45da5229fb14768bd4077ca0cd290c1d7e87f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 27 16:38:24 2019 -0700
+
+    apps/snmptrapd_handlers.h: Remove an obsolete declaration
+    
+    Fixes: d10be3eb4be7 ("Remove redundant code.") # v5.7.rc2.
+
+commit 870e553b9a8051ae93f98e8faf977e151773b08b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 27 11:09:47 2019 -0700
+
+    apps/encode_keychange: Fix an MSVC compiler warning
+    
+    Avoid that the compiler reports that _isatty() has not been declared.
+
+commit 0f25cd33500fd104aa4e977b982bdbba2be7d266
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Apr 27 11:01:43 2019 -0700
+
+    AgentX, MSVC: Fix a recently introduced build error
+    
+    Avoid that the following error and warnings are reported:
+    
+    ..\..\agent\mibgroup\agentx\protocol.c(1249): error C2036: 'void *': unknown size
+    ..\..\agent\mibgroup\agentx\protocol.c(1560): warning C4146: unary minus operator applied to unsigned type, result still unsigned
+    ..\..\agent\mibgroup\agentx\protocol.c(1565): warning C4146: unary minus operator applied to unsigned type, result still unsigned
+    ..\..\agent\mibgroup\agentx\protocol.c(1570): warning C4146: unary minus operator applied to unsigned type, result still unsigned
+
+commit 46a42549dbae76e1c2fc284b81c6e6f83ce46831
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 25 16:31:56 2019 -0700
+
+    AgentX: Reduce stack usage
+    
+    Instead of allocating a buffer with the largest supported size on the
+    stack, allocate a 64 byte buffer on the stack and dynamically allocate
+    a larger buffer if necessary.
+
+commit 4cdf8314a1ff3ecca3483c0b1a4b7cd92ae03f5c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Apr 26 09:24:41 2019 -0700
+
+    AgentX: Fix a debug statement in agentx_realloc_build_string()
+    
+    Avoid that a debug statement reads past the end of the buffer passed
+    to this function. This was detected by Valgrind.
+
+commit 004d7d473d9e7a6929ae0f7a9d2f9b96b6c94f4e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Apr 26 07:00:24 2019 -0700
+
+    AgentX: Micro-optimize agentx_parse_string()
+
+commit 07c4226435a42c260cd7a17e6c89e9c89a036e6c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Apr 26 08:50:48 2019 -0700
+
+    AgentX: Make indentation consistent in _agentx_realloc_build()
+
+commit ecaeda0fff7b2c50661ff170cb1d747641e1f58b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 25 16:31:32 2019 -0700
+
+    AgentX: Make agentx_parse_oid() easier to read
+    
+    Use 64-bit assignments instead of two 32-bit assignments to assign a
+    64-bit number to a 64-bit variable.
+
+commit d20ace88ceb71c208f2b638b822c6b4359ead0d3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 25 13:11:11 2019 -0700
+
+    AgentX: Reduce the number of return statements
+    
+    This patch does not change any functionality.
+
+commit a0fcb8912153e79170afd34044d0d400e1169164
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 25 09:13:59 2019 -0700
+
+    AgentX: Declare pointers that are not modified const
+    
+    Additionally, declare local functions 'static'.
+
+commit 1710f9f8f8bc2ea3ee1a89bdef11bd311dc86ff8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 25 08:55:48 2019 -0700
+
+    AgentX: Remove two superfluous casts
+    
+    This patch does not change any functionality.
+
+commit 8830aafcab6375e7774004c3049b3d9538a0a641
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Apr 25 10:01:15 2019 -0700
+
+    AgentX: Make indentation consistent
+    
+    This patch only changes the indentation level of the code.
+
+commit e28e19b204e3610b9a04d88034163ee43a97e076
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 24 21:47:51 2019 -0700
+
+    Mingw64: Define NETSNMP_PRIz correctly
+    
+    Older versions of Mingw64 identify as *-w64-* while newer identify as
+    x86_64-pc-mingw32. Make sure that both are recognized.
+
+commit a18f036972ccecff51059517b29a231e529efa14
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 24 21:39:19 2019 -0700
+
+    Remove SCCS and RCS IDs
+    
+    Since git is used to manage the Net-SNMP source code these IDs are not relevant.
+
+commit 513aff4c5d05f65030e705e39eb7376c224b862b
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Wed Apr 24 22:00:25 2019 +0200
+
+    swrun_kinfo: DragonflyBSD does not have KERN_PROC_PROC
+
+commit 09da7e285a2ae8a75905ac49e7ebfb0cffaf5139
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Wed Apr 24 21:57:47 2019 +0200
+
+    Fix CentOS6 compile witch does not define ETHTOOL_GLINKSETTINGS
+
+commit 17387a9fc331fba46055894dd8f5eb3e327f310f
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Wed Apr 24 21:55:10 2019 +0200
+
+    Not all compilers groks mixed declaration and statements.
+
+commit 54be00a40b3a31917c8825886dc45d0de14b714b
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Wed Apr 24 21:53:48 2019 +0200
+
+    Remove a superfluous semicolon.
+
+commit 5ca7193ae1978626d1abf491f777e68bbb88c164
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Wed Apr 24 21:48:05 2019 +0200
+
+    Add openbsd6.h to headers to install.
+
+commit 678422d7b8495310fa03e2a1c827b8f0b97fb8b0
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Wed Apr 24 21:29:30 2019 +0200
+
+    Proactively add FreeBSD 13, 14
+
+commit 353287249340c40f1ab1f378d3fc746d8579b822
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Wed Apr 24 21:13:57 2019 +0200
+
+    mibs/rfclist: Add RFCs 8389, 8502, 8502.
+
+commit 48495424cb8d452ebe87bb1df5f2ae1b1f47f08d
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Wed Apr 24 21:12:46 2019 +0200
+
+    Update IANAifType-MIB to current version.
+
+commit 40c319c7bda8cad3d12a8e33297226363e80e879
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 24 06:56:14 2019 -0700
+
+    libsnmp: Use a symbolic name for the TLS version
+
+commit a07d20c370736887cbd9b160ce9dade5de539655
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 22 21:02:37 2019 -0700
+
+    ci/openssl.bat: Bump the OpenSSL version
+
+commit 814abb9392bf84993b81f0a1b481197c166a297a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Apr 22 20:45:22 2019 -0700
+
+    snmplib: Suppress the "'TLSv1_method' is deprecated" compiler warning
+
+commit f632342cd62ca3a064bd1ebde8858fbba76b9626
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 17 19:21:25 2019 -0700
+
+    snmpd: Fix the code for changing DES private keys
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2935/.
+
+commit 7f31df7069e0b1dfed7955d5c7f78aa51052e019
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Apr 17 19:33:41 2019 -0700
+
+    agent/mibgroup/snmpv3/usmUser.c: Remove the 'alen' variable
+
+commit 456ef19a12678b0f73f74fd947bd13a2df329d92
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 14 21:12:20 2019 -0700
+
+    snmplib, Windows: Fix the NETSNMP_IMPORT and NETSNMP_EXPORT definitions
+    
+    Make sure that global variables are exported. See also
+    https://sourceforge.net/p/net-snmp/bugs/2934/.
+
+commit 0cf5a779b6e335c48b6d12665c7748d38449bd20
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 14 20:30:50 2019 -0700
+
+    snmplib: Fix the build for older versions of Visual Studio
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2932/.
+
+commit 21260fdd60c172839f997fb6f888a6e21c6825eb
+Author: Changqing Li <changqing.li@windriver.com>
+Date:   Tue Feb 26 14:26:07 2019 +0800
+
+    net-snmp: fix compile error with --disable-des
+    
+    | scapi.c: In function 'sc_encrypt':
+    | scapi.c:1256:5: error: 'pad_size' undeclared (first use in this function); did you mean 'dysize'?
+    |      pad_size = pai->pad_size;
+    |      ^~~~~~~~
+    |      dysize
+    
+    pad_size is defined only without --disable-des
+    [snip]
+    #ifndef NETSNMP_DISABLE_DES
+        int             pad, plast, pad_size = 0;
+    
+    but used when disable-des,
+    [snip]
+            QUITFUN(SNMPERR_GENERR, sc_encrypt_quit);
+        }
+        pad_size = pai->pad_size;
+    
+        memset(my_iv, 0, sizeof(my_iv));
+    
+    #ifndef NETSNMP_DISABLE_DES
+        if (USM_CREATE_USER_PRIV_DES == (pai->type & USM_PRIV_MASK_ALG)) {
+    
+            /*
+    
+    fix by move it into #ifndef NETSNMP_DISABLE_DES
+    
+    Signed-off-by: Changqing Li <changqing.li@windriver.com>
+
+commit abdcb6af8df352a257a7092c1649471af1e4e97b
+Author: Douglas Royds <douglasr@users.sourceforge.net>
+Date:   Sun Apr 14 19:56:24 2019 -0700
+
+    CHANGES: snmpd: Accept null NETSNMP_CONFIGURE_OPTIONS from the environment
+    
+    Make it possible to avoid that build host paths end up in Net-SNMP binaries
+    by accepting a null NETSNMP_CONFIGURE_OPTIONS environment variable.
+
+commit 5ccd784e0f7bb16b3f2daa77814087e90af3c321
+Author: Roger Bertilsson <rogge@users.sourceforge.net>
+Date:   Sun Apr 14 19:47:48 2019 -0700
+
+    snmpd: Fix a typo in the snmpusm.1.def man page
+    
+    See also https://sourceforge.net/p/net-snmp/patches/1386/.
+
+commit ec9f61461e82d203e24b8e5b431190a40b27ea6d
+Author: Vasile-Laurentiu Stanimir <vlstanimir@gmail.com>
+Date:   Sun Apr 14 19:21:32 2019 -0700
+
+    CHANGES: snmpd: Use ETHTOOL_GLINKSETTINGS when available
+    
+    Newer Linux kernels support ETHTOOL_GLINKSETTINGS. Use it when available
+    instead of the older and deprecated ETHTOOL_GSET. This patch avoids that
+    the Linux kernel reports the following kernel warning:
+    
+    warning: 'snmpd' uses legacy ethtool link settings API, link modes are only partially reported
+    
+    See also https://sourceforge.net/p/net-snmp/patches/1387/.
+    
+    [bvanassche: reworked this patch significantly]
+
+commit d6689d6a938e29e02f1964bc7d7a15103817c0fa
+Author: Masayoshi Mizuma <m.mizuma@jp.fujitsu.com>
+Date:   Mon Apr 8 19:56:04 2019 -0400
+
+    snmplib/snmp_api: Remove the request on the session when the sending is failed
+    
+    snmpd is terminated abnormally due to an invalid memory access after
+    the sending of a request is failed.
+    
+    The time out callback for the failed request is executed when the
+    session is closing because the request remains in the internal session.
+    The cleanup for the request is executed on the
+    callback(NETSNMP_CALLBACK_OP_SEND_FAILED,) and also on the time out
+    callback(NETSNMP_CALLBACK_OP_TIMED_OUT,), so the wrong memory access
+    happens.
+    
+    Remove the failed request from the internal session after the callback
+    for the failed request is done.
+    
+    Signed-off-by: Masayoshi Mizuma <m.mizuma@jp.fujitsu.com>
+    Reported-by: Shogo Matsumoto <shogo.matsumoto@jp.fujitsu.com>
+
+commit 408c8919e36feb4e9c1024e74d3b8c77454d89a0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 14 18:57:17 2019 -0700
+
+    snmplib: Introduce the function remove_request()
+    
+    This patch does not change any functionality.
+
+commit d9b2acc48efc3b5098cde5a7b89cf81a3e1988fa
+Author: Anders Wallin <anders.wallin@windriver.com>
+Date:   Sun Apr 14 18:30:48 2019 -0700
+
+    test: Skip TLS-TCP IPv6 test for OpenSSL versions before 1.1.0
+    
+    See also https://sourceforge.net/p/net-snmp/patches/1382/.
+    
+    Signed-off-by: Anders Wallin <anders.wallin@windriver.com>
+    [ bvanassche: edited patch description; combined two version checks into one ]
+
+commit 69253ba63cfaaaacc10942aad360449b2a081681
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Apr 14 17:30:50 2019 -0700
+
+    snmpd: Fix --disable-snmpv1 build
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2924/.
+    
+    Fixes: e422fbfb09cd ("more checks for disabling protocol versions at runtime").
+
+commit 7f88b06bf0f4140bc03cabacd35eaeffdf21d722
+Author: Anders Wallin <wallinux@gmail.com>
+Date:   Sun Apr 7 18:31:16 2019 -0400
+
+    agentx/master: Return when NETSNMP_CALLBACK_OP_RESEND is set to the callback
+    
+    snmpd is terminated abnormally due to the double free for the
+    request cache after the request is resend.
+    
+    That is because the callback for NETSNMP_CALLBACK_OP_RESEND isn't
+    cared and the cache is freed wrongly.
+    
+    Let's just return if NETSNMP_CALLBACK_OP_RESEND is set on the
+    callback.
+    
+    Fixes: b7b50bbac ("snmp_send callback updates")
+    
+    Signed-off-by: Anders Wallin <wallinux@gmail.com>
+
+commit 6e1329bde834e0edcfadb88d3c05e6015e945638
+Author: Hugh McMaster <hugh.mcmaster@outlook.com>
+Date:   Wed Apr 3 21:36:03 2019 +1100
+
+    NEWS: Add pkg-config support for building applications and sub-agents
+    
+    Use the netsnmp package when building Net-SNMP applications.
+    Use the netsnmp-agent package when building Net-SNMP subagents.
+    
+    Signed-off-by: Hugh McMaster <hugh.mcmaster@outlook.com>
+    [ bvanassche: edited makefile code and .pc files; added ./configure changes ]
+
+commit adc9b71aba9168ec64149345ea37a1acc11875c6
+Author: Sam Tannous <stannous@cumulusnetworks.com>
+Date:   Wed Apr 10 06:57:21 2019 -0700
+
+    snmpd: Avoid that snmpv3 bulkget errors result in a double free
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2923/.
+    See also https://sourceforge.net/p/net-snmp/patches/1388/.
+
+commit 30fb24e6cd9ac495fb7cfa0e32e5eea39c2b29ab
+Author: Narendra Kumar S S <ssnkumar@users.sourceforge.net>
+Date:   Mon Apr 8 09:17:52 2019 -0700
+
+    CHANGES: BUG: 2930: Fix a Solaris hrSWInst crash
+    
+    Avoid that snmpd crashes on Solaris when querying software packages
+    with an empty CATEGORY field.
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2930/.
+    See also https://sourceforge.net/p/net-snmp/patches/1390/.
+
+commit 9f4af8c42d515e6b214738cc97212dfbe7f749cf
+Author: Andreas Hasenack <ahasenack2@users.sourceforge.net>
+Date:   Tue Feb 5 18:21:40 2019 -0800
+
+    apps/snmptrapd_sql: Fix build against MySQL 8
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2922/.
+    
+    [bvanassche: changed 'int' into 'char']
+
+commit b9a778df08315500958fd83d11b4a123aaeec753
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 4 21:43:59 2018 -0700
+
+    testing/fulltests/snmpv3/T010scapitest_capp.c: Port this test to FreeBSD
+
+commit 36fda7476cc26e44af84a679b8448b8629886dc2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Jan 29 20:58:38 2019 -0800
+
+    ci: Skip tests that do not pass
+    
+    Instead of not building transports that do not pass, skip the tests
+    that are known to fail.
+
+commit f727d51b0fa485f93ffd57112442271716042cd7
+Author: Anders Wallin <wallinux@gmail.com>
+Date:   Mon Jan 28 18:59:08 2019 -0800
+
+    testing/fulltests/tls/STlsAgentTrap: Test both TRAP and INFORM
+    
+    Additionally, use localCert / peerCert instead of the deprecated
+    our_hostname / their_hostname. Remove incorrect comments and superfluous
+    configuration directives.
+
+commit e926b1cec44ee769618440719dbcc92bb68f7aa7
+Author: Anders Wallin <wallinux@gmail.com>
+Date:   Mon Jan 28 18:57:40 2019 -0800
+
+    libsnmp, TLS: Change default TLS version from v1.3 into v1.1
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2920/.
+    
+    Fixes: d686bc3502f1 ("CHANGES: snmplib: Add support for OpenSSL 1.1.0")
+
+commit d1300ee69c6ff91779229fd4fba4b5141106ff9e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jan 27 18:27:27 2019 -0800
+
+    ci: Fix and enable MinGW64 build
+
+commit a9fa5dcf2fa238db0538df2213878fa6e6b559dc
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jan 27 21:05:28 2019 -0800
+
+    ci/net-snmp-run-perl-tests: Make the Perl tests pass again
+    
+    Fixes: 41b5927a8b53 ("testing: Unbreak RUNFULLTESTS")
+
+commit 927040dd4ff9601f12ba7d082279b5d35c3d6031
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jan 23 18:47:56 2019 -0800
+
+    ci, Appveyor: Rename MinGW64 build into MSYS2
+    
+    Since that build uses the MSYS2 compiler, rename it into MSYS2. The
+    MinGW64 build has been commented out because it does not yet pass.
+
+commit 1d714a0d9f2f712afdcb9b7ba75222fcc46292af
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jan 23 20:59:55 2019 -0800
+
+    README.win32: Fix a MinGW64 package name
+
+commit 5a86cfb005dbc3dc495c7eb216ac1faaac00a069
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jan 23 20:40:00 2019 -0800
+
+    testing: Unbreak RUNFULLTESTS
+    
+    Make it again possible to run RUNFULLTESTS from outside ci/net-snmp-run-tests.
+    Fixes: 9b1535bfb140 ("testing, perl: Remove push @INC statements")
+
+commit 2d3bb48b00fca7fff0f63dd065742f01ecd8f79f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jan 20 19:40:34 2019 -0800
+
+    .appveyor.yml: Verify whether or not the MinGW64 build succeeded
+    
+    Now that building against MinGW64 works for Appveyor, check the build
+    exit status. Disable the regression tests because these do not yet pass.
+
+commit 58649949f37aa5f37a4a624a715043f7b48215f7
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Jan 15 20:52:59 2019 -0800
+
+    testing/check_for_pskill, MinGW64: Skip pskill test
+    
+    MinGW64 namely provides a proper kill command.
+
+commit e0cfa7c84b1db81b0ad07066bab0d87b4f131991
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Jan 17 20:12:04 2019 -0800
+
+    ci/net-snmp-configure, MinGW64: Enable openssl at configure time
+
+commit 7cdbaad9295467392a8264febaf42583991817f6
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jan 19 12:47:34 2019 -0800
+
+    ci/build.bat, MinGW32: Make downloading succeed
+    
+    Avoid that downloading fails every now and then as follows:
+    
+    curl: (16) Error in the HTTP2 framing layer
+
+commit d2e2624156cb3195efa9a69bdb03d48f5d6782ab
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jan 20 21:36:27 2019 -0800
+
+    ltmain.sh, MinGW64: Fix a linker error
+    
+    Avoid that linking fails as follows with certain MinGW64 versions:
+    
+    ./.libs/lt-snmpps.c: In function 'main':
+    ./.libs/lt-snmpps.c:315:10: warning: implicit declaration of function '_spawnv' [-Wimplicit-function-declaration]
+       rval = _spawnv (_P_WAIT, lt_argv_zero, (const char * const *) newargz);
+              ^~~~~~~
+    ./.libs/lt-snmpps.c:315:19: error: '_P_WAIT' undeclared (first use in this function); did you mean '__VALIST'?
+       rval = _spawnv (_P_WAIT, lt_argv_zero, (const char * const *) newargz);
+                       ^~~~~~~
+                       __VALIST
+
+commit 2ff6a360f79dd63a7569fda8e4714dd9139ea136
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jan 20 16:41:06 2019 -0800
+
+    snmplib/winservice.c: Move local data types and function declarations from .h into .c
+
+commit 14b5618f31cdeedd0ff4e4a8d6ff2aeefe9f235d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jan 20 14:21:44 2019 -0800
+
+    snmplib/winservice.c: Use ANSI C datatypes and functions
+    
+    Use int, void and char instead of INT, VOID and TCHAR. Use snprintf()
+    instead of _sntprintf(). Note: using Microsoft's "Unicode" (UCS-2) mode
+    is considered obsolete. See also https://utf8everywhere.org/.
+
+commit abecab9327fd496d79332256990ade53745e49e0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jan 20 14:13:35 2019 -0800
+
+    snmplib/winservice.c: Reindent
+    
+    Reindent this source file with the help of the indent command mentioned in
+    the CodingStyle file.
+
+commit 1882e55c2f9e2c42eb7a75176710173774c34d3c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jan 20 21:12:44 2019 -0800
+
+    configure: Add a test for getlogin()
+    
+    This patch avoids that the build fails as follows on MinGW64:
+    
+    snmpping.c:567:13: error: conflicting types for 'getlogin'
+     const char *getlogin(void)
+                 ^~~~~~~~
+    In file included from /usr/include/unistd.h:4:0,
+                     from ../include/net-snmp/net-snmp-includes.h:34,
+                     from snmpping.c:59:
+    /usr/include/sys/unistd.h:118:9: note: previous declaration of 'getlogin' was here
+     char *  getlogin (void);
+             ^~~~~~~~
+
+commit 03c98e3d4e7e459ed4e925c22f9cc4b181ded3eb
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jan 20 08:48:43 2019 -0800
+
+    libsnmp, agent, apps, MinGW64: Only use those MSVC functions that are available
+    
+    _get_osfhandle() is available in the MSVC and MinGW32 C libraries but not
+    in the MinGW64 C library. Hence add a configure test for _get_osfhandle()
+    and only use it if it is available.
+
+commit 98eb60dcaf13d5bc8513a785df21bd164ff04c35
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Jan 20 18:41:52 2019 -0800
+
+    agent/mibgroup/util_funcs: Reindent uClinux code
+    
+    Make the uClinux code indentation conform to the Net-SNMP coding style.
+    Change exit(0) statements in the parent into return 0 to make the behavior
+    of get_exec_pipes() more uniform across platforms.
+
+commit 90d91fa1943bbc4e9c18ba19e30ccf49b2be78ff
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jan 21 08:53:58 2019 -0800
+
+    apps/snmptrapd: Fix a MinGW64 compiler warning
+    
+    Avoid that the compiler complains about passing a struct timeval pointer to
+    a function that expects a struct __ms_timeval pointer.
+
+commit 5da4fc8c8e0849ba0997b16657430675283904e8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri May 11 21:55:56 2018 -0700
+
+    MinGW64: Fix select() and ioctlsocket() calls
+    
+    See also https://github.com/mirror/mingw-w64/blob/master/mingw-w64-headers/include/psdk_inc/_ip_types.h.
+
+commit 5250c5f62c573308ab8ecd62366eceaa488a85f6
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri May 11 22:08:14 2018 -0700
+
+    configure.d/config_os_libs2: Remove redundant checks
+    
+    Instead of using both AC_CHECK_DECL() and AC_CHECK_FUNCS() to check for
+    EVP_sha224() and EVP_sha384(), only use AC_CHECK_FUNCS().
+
+commit c7a330e6adefedbd7393401f55243b2b8313afb2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jan 21 12:54:57 2019 -0800
+
+    apps/agentxtrap.c: Fix a MinGW64 compiler warning
+    
+    Avoid that the following compiler warning is reported:
+    
+    agentxtrap.c: In function 'main':
+    agentxtrap.c:576:52: warning: passing argument 5 of 'select' from incompatible pointer type [-Wincompatible-pointer-types]
+             count = select(numfds, &fdset, NULL, NULL, !block ? &timeout : NULL);
+                                                        ^
+    In file included from ../include/net-snmp/system/mingw32.h:29:0,
+                     from ../include/net-snmp/net-snmp-config.h:2194,
+                     from agentxtrap.c:1:
+    /usr/include/w32api/winsock2.h:995:34: note: expected 'PTIMEVAL {aka struct __ms_timeval * const}' but argument is of type 'struct timeval *'
+       WINSOCK_API_LINKAGE int WSAAPI select(int nfds,fd_set *readfds,fd_set *writefds,fd_set *exceptfds,const PTIMEVAL timeout);
+                                      ^~~~~~
+
+commit b8cb73951f9204417c43105a27a5335ecbcddda1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jan 21 12:52:47 2019 -0800
+
+    apps/agentxtrap.c: Declare local variables static
+
+commit 9f3d055ff8523618ae57373e28dacbe33a0c25d6
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jan 21 12:40:32 2019 -0800
+
+    apps/agentxtrap.c: Reindent to make the code conform to the coding style
+
+commit 53a971debbe6c04a41fbe8ce792a778c739174c8
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jan 21 13:26:10 2019 -0800
+
+    agent/mibgroup/util_funcs.c: Fix MinGW32 compiler warnings
+    
+    Avoid that the compiler complains about passing a DWORD (unsigned long int)
+    to the %d format specifier.
+
+commit 45d848dbbf06797f4ff2eca9a576f3c5cad6bb1e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jan 21 20:19:13 2019 -0800
+
+    README.win32: Improve MinGW64 instructions
+
+commit 2baa87b2bfd772b62fa1864903afe101fc2e4946
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Jan 1 19:31:40 2019 -0800
+
+    ci: Add support for Cirrus CI and FreeBSD
+
+commit 241304ef7132a2c04f135ea8a3463e29e6e46496
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jan 12 08:53:14 2019 -0800
+
+    ci: Port three scripts from bash to sh
+
+commit 744ae09fd0a38f4634195197ab201442516559c5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jan 12 19:46:05 2019 -0800
+
+    testing, Perl: enable use strict and use warnings
+
+commit 9b1535bfb140697dff985ce8feaaa939069b7ac1
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jan 12 19:31:28 2019 -0800
+
+    testing, perl: Remove push @INC statements
+    
+    These statements are not necessary if $PERL5LIB is set before these
+    tests are run.
+
+commit ba0505329f18424899c96589bd20c4f5c739aa17
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jan 12 19:21:59 2019 -0800
+
+    testing: Skip DTLS-UDP tests if DTLS-UDP transport is not available
+    
+    Fixes: 0b8b11504729 ("testing for checking client side verification of server certificates")
+
+commit e566d5d792c003f4f67f83a0deb6b482ae694ab5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jan 12 17:01:22 2019 -0800
+
+    testing/RUNFULLTESTS: Only run Perl and Python tests if support for these languages has been enabled
+
+commit 3be8ca102a3c13237b499ef5c7f80dde9f2f5fa3
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jan 12 20:42:04 2019 -0800
+
+    testing/RUNFULLTESTS: Enable 'use warnings'
+    
+    Additionally, fix two bugs: assign the exit code of the $cfp_path
+    script to $rc instead of its output and make decide_exec() return
+    early if there is no app extension.
+
+commit 04e59874c135b7bc8fcad73057c8b75bc0ec2f9b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jan 12 08:51:38 2019 -0800
+
+    testing/fulltests/support/simple_eval_tools.sh: Improve tmp file dumping
+    
+    Avoid showing the contents of temporary files twice that are shorter
+    than 512 lines if a test fails.
+
+commit 969e9a7391067b3829bad7b88918f60c4944a22e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jan 2 06:50:55 2019 -0800
+
+    testing/fulltests/support/simple_TESTCONF.sh: Increase MAX_RETRIES
+    
+    This patch avoids that regression tests sporadically fail due to not
+    finding an UDP port that is not in use.
+
+commit baf47f3e1e3f0c2397ba074a0245d4b3b442a9b6
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jan 12 15:28:11 2019 -0800
+
+    perl: Avoid "use of uninitialized value $ENV{"OSTYPE"}" warnings
+    
+    The bash shell sets the OSTYPE environment variable but FreeBSD sh not.
+    Hence check whether $OSTYPE has been set before using its value.
+
+commit e1c6ec5a73bc67b3b6139479fa7a0b7e985b47ca
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Jan 3 21:14:57 2019 -0800
+
+    snmplib/snmpksm: Fix OLD_HEIMDAL compiler warnings
+    
+    Avoid that the following compiler warnings are reported for OLD_HEIMDAL:
+    
+    snmpksm.c:486:21: warning: unused variable 'blocksize' [-Wunused-variable]
+        size_t          blocksize, encrypted_length;
+                        ^
+    snmpksm.c:1769:21: warning: assigning to 'u_char *' (aka 'unsigned char *') from 'char *' converts between pointers to integer types with different sign [-Wpointer-sign]
+                    *parms->scopedPdu = (char *) output.data;
+                                      ^ ~~~~~~~~~~~~~~~~~~~~
+    snmpksm.c:1249:34: warning: unused variable 'blocksize' [-Wunused-variable]
+        size_t          cksumlength, blocksize;
+                                     ^
+
+commit 611b485ea14541c1e04afb812c88a1bcdf203396
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jan 12 08:30:36 2019 -0800
+
+    agent/auto_nlist: Fix a FreeBSD compiler warning
+    
+    Avoid that the following compiler warning is reported on FreeBSD 10 systems:
+    
+    auto_nlist.c:56:22: warning: unused variable 'n_name' [-Wunused-variable]
+            static char *n_name = NULL;
+                         ^
+
+commit 944c75959517c66dc12fe5c713b5904abb05343d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Jan 12 08:30:32 2019 -0800
+
+    agent/auto_nlist: Enclose a code block in curly braces
+    
+    Other than leaving out a superfluous if-test this patch does not change
+    any functionality. The purpose of this patch is to make the next patch
+    easier to read.
+
+commit 7d66a35cd6bf86ca9e8070751cfba9ce97eddd6b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jan 14 18:39:45 2019 -0800
+
+    configure: Enable shared library support for FreeBSD 10 and later
+    
+    See also https://lists.freebsd.org/pipermail/freebsd-current/2013-March/040460.html.
+
+commit e4e1d25dae34f5a9aeff13c83008d89794211ab0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Dec 16 12:29:11 2018 -0800
+
+    README.win32: Update this document
+    
+    Change "Microsoft Visual C++" into "Microsoft Visual Studio".
+    Remove all references to the Microsoft Platform SDK since that SDK
+    has been integrated in the Windows SDK. Remove all references to .dsp
+    files since these files are no longer maintained. Update all outdated
+    instructions. Add build instructions for Mingw-w64.
+
+commit fccd5f13ce825c813944a555dfbdb36c3eddc21f
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Dec 16 12:29:09 2018 -0800
+
+    README.win32: Strip trailing whitespace
+
+commit a79439a2fe185864183252b7c59d008b1f031b70
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jan 11 19:16:15 2019 -0800
+
+    man/snmpd.conf.5.def: Document that monitor names must be unique
+    
+    Reported-by: Masanari Iida <standby24x7@gmail.com>
+
+commit 79f014464ba761e2430cc767b021993ab9379822
+Author: Wes Hardaker <opensource@hardakers.net>
+Date:   Tue Jan 8 08:52:29 2019 -0800
+
+    NEWS: snmptrap: BUG: 2899: Patch from Drew Roedersheimer to set library engineboots/time values before sending
+
+commit dc3194eaecb4545a0364fe4a565f1c0d001835a7
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Dec 28 18:58:45 2018 -0800
+
+    libsnmp/transports/UDP: Remove MSG_NOSIGNAL
+    
+    Remove MSG_NOSIGNAL from the UDP code because it does not affect SOCK_DGRAM
+    sockets. From the sendto() specification
+    (http://pubs.opengroup.org/onlinepubs/9699919799/functions/sendto.html):
+    "[EPIPE] The socket is shut down for writing, or the socket is
+    connection-mode and is no longer connected. In the latter case, and if
+    the socket is of type SOCK_STREAM or SOCK_SEQPACKET and the MSG_NOSIGNAL
+    flag is not set, the SIGPIPE signal is generated to the calling thread."
+
+commit 3ca90c2c1260e036a5abd73a40f83d4ded545580
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Dec 28 11:57:11 2018 -0800
+
+    libsnmp/transports/UDP: Add support for VRF
+    
+    This patch is based on a patch provided by Sam Tannous. See also
+    https://sourceforge.net/p/net-snmp/patches/1354/.
+
+commit 3dce73c8833a74aab30046155ab50a1c95edd893
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Dec 28 11:56:40 2018 -0800
+
+    libsnmp/transports/UDP: Reduce indentation level
+    
+    This patch does not change any functionality.
+
+commit a74d7087e536cfa3b74a77647fa73a49c742f1c4
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Dec 28 11:34:25 2018 -0800
+
+    libsnmp: Split netsnmp_udpbase_sendto()
+    
+    This patch does not change any functionality but makes the implementation
+    of this function easier to read.
+
+commit 9e29c8da35041520a58614281eb504bb91990177
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Dec 28 11:05:52 2018 -0800
+
+    testing/fulltests/support/simple_eval_tools.sh: Show file name above file contents if a test fails
+    
+    See also commit 0d828eed1fb5 ("testing/fulltests/support/simple_eval_tools.sh: Dump log files in case of test failure").
+
+commit 0b52f2ed1de081c1b8682d55c9c6cde973af7630
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 9 08:12:41 2018 -0700
+
+    testing/fulltests/support/simple_eval_tools.sh: Dump log files in case of test failure
+    
+    This makes it easier to determine the root cause of tests that fail
+    on Travis or Appveyor.
+
+commit 35fcadf5ba23a14a994ac5a963a02b3558a998ec
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Dec 28 09:41:20 2018 -0800
+
+    testing/fulltests/support/myip: Avoid using IO::Socket::IP
+    
+    Since IO::Socket::IP is not available on Travis Darwin instances, rewrite
+    'myip' such that it doesn't use IO::Socket::IP.
+
+commit 472a30e1a49dd2cbfaf63f5571249124064e4671
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Dec 27 21:53:25 2018 -0800
+
+    ci: Move Travis before_script shell code into ci/before.sh
+    
+    This makes it easier to maintain this code.
+
+commit 8d1894314ad1dff67124d50c9f9fa071ac3abb99
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Dec 27 21:28:07 2018 -0800
+
+    libsnmp/asn1.c: Minimize diffs with the master branch
+    
+    See also commit 7aceb7a49264 ("libsnmp, FreeBSD: Fix the build") on the
+    v5.8 branch and commit b97a0417a235 ("MSVC: Reduce build time") on the
+    master branch.
+
+commit ac65c73a90369f725959c820af8579627ec6f965
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Dec 27 16:57:11 2018 -0800
+
+    ci/net-snmp-configure: Make the code for querying the OpenSSL and libssh2 versions more robust
+
+commit 7aceb7a4926430576d2253a5b2e00d9809389fdd
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Dec 28 00:12:13 2018 +0000
+
+    libsnmp, FreeBSD: Fix the build
+
+commit 77972cc90d1ef18f93c81284f5a1623947f55a94
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Dec 27 23:55:30 2018 +0000
+
+    NetBSD: Fix two compiler warnings in MIB implementations
+
+commit 024c6316eb1f37a7c3645e0a15032173d04e2c11
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Dec 27 15:05:47 2018 -0800
+
+    SNMP-TARGET-MIB, FreeBSD: Hide kernel threads
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2890/.
+    See also https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=231732.
+    
+    Signed-off-by: Ben Rubson <benrubson@users.sourceforge.net>
+
+commit 178e3240cb880ddb5489ce3eb5c7a4371cebf288
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jun 8 10:46:22 2018 +0200
+
+    SNMP-TARGET-MIB: Fix the debug code that shows tAddress
+    
+    Since tAddress contains binary data, show it in hex instead of as an
+    ASCII string.
+
+commit 67dbffc04db36be6bd654b8472262e4c1850319e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Dec 17 19:35:00 2018 -0800
+
+    snmplib, transports, Darwin: Fix compiler warnings
+    
+    Avoid that the compiler complains about implicit declarations of
+    strdup(), strchr() and strlcpy().
+
+commit 29f03b11f527c874cc01afa5293eb9bb790b9798
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Dec 17 18:49:18 2018 -0800
+
+    libsnmp, Windows: Fix a recently introduced compiler warning
+    
+    Since sin6_scope_id has been declared as unsigned long on Windows,
+    cast it to int before passing it to the %d format specifier.
+    
+    Fixes: f3d96c8c45f9 ("libsnmp: Add two additional debug statements in the code for parsing IPv6 addresses")
+
+commit bb4631cfbaefbea8b29c4716e858d1467d588541
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Dec 16 19:30:19 2018 -0800
+
+    testing/fulltests/support/myip: Also return IPv6 scope ID
+    
+    This is necessary to let the tests based on S180trapaddrinfra pass.
+
+commit f3d96c8c45f91a193883c7b669b78eec6d2b3242
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Dec 16 19:54:51 2018 -0800
+
+    libsnmp: Add two additional debug statements in the code for parsing IPv6 addresses
+
+commit c602f9527ea63aaafa40f400e1e14dcd4113ae66
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Dec 16 19:53:48 2018 -0800
+
+    libsnmp: Fix the code for parsing the IPv6 scope ID
+    
+    Fixes: 0b637fea62c7 ("libsnmp/transports: Introduce netsnmp_parse_ep_str()")
+
+commit 64f4ead817c4c018f9f811442565feac656fc0e9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Dec 16 14:51:44 2018 -0800
+
+    libsnmp: Only include <inttypes.h> when necessary
+    
+    This helps to reduce the Net-SNMP compilation time.
+
+commit 7d6ab1439d5d8cb09801c184ef17882cb62ba28d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Dec 16 16:44:52 2018 -0800
+
+    ci/openssl.bat: Update OpenSSL version
+
+commit de7f76855c53e9a184f3ec6015c680fd13b03fae
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Dec 16 14:51:25 2018 -0800
+
+    ci/build.sh: Remove CFLAGS / CPPFLAGS / LDFLAGS definitions
+    
+    These definitions are not necessary when building with MinGW and break
+    the build when building with Mingw-w64.
+
+commit cd09fd82522861830aaf9d237b26eef5f9ba50d2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Nov 21 20:47:42 2018 -0800
+
+    MIB-II: Only log once that opening /proc/net/if_inet6 failed
+    
+    If IPv6 has been disabled (ipv6.disable=1) then opening /proc/net/if_inet6
+    fails. Only log this once instead of thousand of times a day.
+    
+    Reported-by: Fif <lefif@users.sourceforge.net>
+
+commit 4eab854c9759be79ad56497445210f60bbc6b50d
+Author: Anders Wallin <anders.wallin@windriver.com>
+Date:   Mon Nov 19 16:27:59 2018 +0100
+
+    snmpd: Fix handling of trapsess option -tag
+    
+    The trapsess argument '-tag' is not recognized due to an incorrect string
+    length. Fix that length.
+    
+    See also https://sourceforge.net/p/net-snmp/patches/1383/.
+    
+    Fixes: 6b7350749490 ("allow trap sinks to set name, tag, profile")
+    Signed-off-by: Anders Wallin <anders.wallin@windriver.com>
+    [ bvanassche: edited commit message ]
+
+commit de590a1a47f610ed0701c19f62c2e92c0d4a535f
+Author: Anders Wallin <wallinux@gmail.com>
+Date:   Thu Aug 30 11:22:31 2018 +0200
+
+    libsnmp/transports/DTLSUDP: Fix a typo in a debug token
+    
+    See also https://sourceforge.net/p/net-snmp/patches/1381/.
+    
+    Fixes: a9a619e0d173 ("CHANGES: snmplib: dtls: overhaul of debug")
+    Signed-off-by: Anders Wallin <wallinux@gmail.com>
+    [ bvanassche: edited commit message ]
+
+commit f651cfa36569ab95d1bc817b3bd1289cdb15a5ea
+Author: Anders Wallin <wallinux@gmail.com>
+Date:   Mon Oct 22 09:05:45 2018 +0200
+
+    tests: Add a delay in STlsVars
+    
+    Avoid that the STlsVars tests fail due to checking whether a trap has been
+    received before it has been sent.
+    
+    See also https://sourceforge.net/p/net-snmp/patches/1380/.
+    
+    Signed-off-by: Anders Wallin <wallinux@gmail.com>
+    [ bvanassche: edited commit message ]
+
+commit 8fd3780f99ae50f33dd1216597bb8b6be271507d
+Author: lijo <lijogeorge@users.sourceforge.net>
+Date:   Mon Nov 19 18:33:26 2018 -0800
+
+    snmpd: Avoid that parsing "trapsess ... -e ..." triggers a memory leak
+    
+    See also https://sourceforge.net/p/net-snmp/patches/1379/.
+    See also https://sourceforge.net/p/net-snmp/bugs/2887/.
+    
+    [ bvanassche: reduced the number of changes in this patch from four to one ]
+
+commit a5282f41db0cb339666fb0db8590085e69464be6
+Author: Anders Wallin <wallinux@gmail.com>
+Date:   Mon Jun 25 10:48:51 2018 +0200
+
+    libsnmp: Include disabled debug tokens in NET-SNMP-AGENT-MIB::nsDebugTokenStatus
+    
+    See also https://sourceforge.net/p/net-snmp/patches/1371/.
+    
+    Signed-off-by: Anders Wallin <wallinux@gmail.com>
+
+commit b0f497b84aa28a754ad7ce260c63092dd85a584d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Nov 19 18:59:03 2018 -0800
+
+    snmpd, MIB-II: Fix a recently introduced compiler warning
+    
+    Avoid that the compiler reports the following on Linux:
+    
+    mibII/tcpTable.c:341:1: warning: control reaches end of non-void function [-Wreturn-type]
+     }
+     ^
+    
+    Fixes: 61c373a9a357 ("Forward port FreeBSD 12 patches")
+
+commit f42a4af67a00deb1b11748b944e45de9e2415c50
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Mon Nov 19 21:39:58 2018 +0100
+
+    hr_disk: include sys/disk.h is not cosher for DragonFly
+
+commit 2bbad43c53ffe040f02bc6269e32368edd7c6ca7
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Wed Nov 14 22:01:52 2018 +0100
+
+    Patch for cpu_sysctl for FreeBSD 12.
+    
+    Patch taken from FreeBSD ports collection.
+
+commit 61c373a9a3571ea3f63a2762e43ddb0c9273ce64
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Wed Nov 14 21:45:26 2018 +0100
+
+    Forward port FreeBSD 12 patches
+
+commit bdfdc84b67124f530cdae9f295fa3906021ebf8e
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Tue Nov 13 23:06:17 2018 +0100
+
+    Update IANAifType-MIB to current IANA version
+
+commit 5e9bf8c69f8b3fe5f49c3402f8d5865a4aa0ed24
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Tue Nov 13 22:57:32 2018 +0100
+
+    Minor hr_disk fixes for FreeBSD/NetBSD.
+
+commit 38dfa1db7b3f60862bdf01d95aac807f222146ab
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Tue Nov 13 22:43:21 2018 +0100
+
+    Fix hr_disk for newer FreeBSD and NetBSD.
+
+commit e48ead2dff1820b8fb7aadf2293b24303659ac26
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Tue Nov 13 22:00:46 2018 +0100
+
+    Update IANAifType-MIB to current IANA version.
+
+commit fcecebf8f0fc894c351c82fda87693d76eebf994
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Tue Nov 13 21:55:34 2018 +0100
+
+    Patch for udpEndpointTable for FreeBSD 12.
+    
+    Patch take from FreeBSD ports collection.
+
+commit 64074f086957ec6dc45f73e67f5007e4eea0734d
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Tue Nov 13 21:54:52 2018 +0100
+
+    Patch for udpTable for FreeBSD 12.
+    
+    Patch take from FreeBSD ports collection.
+
+commit 27e21bee375723ba6b88cbd2d52b9c40206a1e9a
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Tue Nov 13 21:53:04 2018 +0100
+
+    Patch for tcpConnTable for FreeBSD 12
+    
+    Patch taken from FreeBSD ports collection.
+
+commit 7f3abe7515d585e089ddddf9a30762451b95aa44
+Author: Niels Baggesen <nba@users.sourceforge.net>
+Date:   Tue Nov 13 21:51:24 2018 +0100
+
+    Patch for tcpTable for FreeBSD 12
+    
+    Patch taken from Freebsd ports collection.
+
+commit 1f7a794ece5f8e0754c2d584bdee89ed002921c6
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Nov 9 07:07:51 2018 -0800
+
+    libsnmp, transports: Log an error message if parsing "clientaddr" fails
+
+commit 70488e36d3a686d2956464b68043bac62ae2be64
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Nov 8 14:40:11 2018 -0800
+
+    snmplib, transports: Make the IPv6 address parsing code closer to the IPv4 equivalent
+
+commit ebac62b66e35197ee036ea5967c4d4ff91bf1b4a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Nov 8 11:24:51 2018 -0800
+
+    snmplib, transports: Move the code for recognizing bare IPv6 addresses into netsnmp_parse_ep_str()
+    
+    This patch makes Net-SNMP recognize endpoint specifications like ::1@lo next
+    to the already supported [::1]@lo.
+
+commit 0d4d74bcc3e35ed55a6653db71ad2b187a64f3b0
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Nov 8 12:03:01 2018 -0800
+
+    libsnmp, transports: Only recognize non-empty strings as a number
+
+commit 5abe5322404b72c2df2344948be28def710eccca
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Nov 7 16:45:52 2018 -0800
+
+    libsnmp, transports, UDP/IPv6: Simplify netsnmp_udp6_transport()
+    
+    This patch does not change any functionality.
+
+commit a21587438825a6658bca214425240aae473df9ff
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Nov 8 13:26:36 2018 -0800
+
+    libsnmp, transports: Simplify netsnmp_udpipv4base_transport()
+    
+    This patch does not change any functionality.
+
+commit b25536962f81dc4b4e03f3a12b2e847c23fb36a9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Nov 8 14:09:00 2018 -0800
+
+    man/snmp.conf.5.def: Improve clientaddrUsesPort documentation
+
+commit 8cbb36da6ef4e82f0521ff0cf3f4b1424e49d21b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Nov 8 10:30:59 2018 -0800
+
+    snmplib, transports: Remove NETSNMP_TSPEC_NO_DFTL_CLIENT_ADDR
+    
+    Since this flag is never set, remove it. Also remove the code that depends
+    on this flag being set.
+    
+    Fixes: 5d8372341594 ("shared transport + udp shared domain")
+
+commit a240e46cdaf189f2c74b6b465ffbc09d6c697088
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Nov 8 10:33:07 2018 -0800
+
+    snmplib, transports: Remove NETSNMP_TSPEC_SHARED
+    
+    Since this flag is not used anywhere in the Net-SNMP code base, remove it.
+    
+    Fixes: 5d8372341594 ("shared transport + udp shared domain")
+
+commit d566ac2930f66c42dec1a20503b25a3b12902911
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Thu Nov 8 10:45:15 2018 -0800
+
+    Go back to testing ::1, without brackets, for IPv6.
+
+commit 48a1163640a651ad035523a9673ab6e20adf7dfc
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Thu Nov 8 10:43:33 2018 -0800
+
+    Parse a bare IPv6 address, which netsnmp_parse_ep_str() won't.
+
+commit 06a02b7c708c1ea2bf67e59c333001e8ce128dff
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Thu Nov 8 10:42:58 2018 -0800
+
+    Specify the default port of ":0" when parsing source addresses.
+
+commit 280d6c16e847f0204663ccfe81063c5f7da215e9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Nov 7 06:58:22 2018 -0800
+
+    testing, T18[0123]: Synchronize with master branch
+
+commit bb1e817b3b83c3e22951a815689964dc235f5d54
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Nov 7 06:47:50 2018 -0800
+
+    testing/fulltests/default/S180trapaddrinfra: Use again the default port
+    
+    Since the purpose of the T18* tests is to use the default port, remove
+    the PROBE_FOR_PORT calls again.
+
+commit 5d94f6baff0f05dd4976cbbf0fef64ecf70cf881
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Nov 6 19:59:20 2018 -0800
+
+    testing, T18[012345]: Make it possible to run these tests as a regular user
+
+commit 8169acab64012fe0026e8a47a054e16a4c20621e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Nov 6 19:37:35 2018 -0800
+
+    libsnmp/transports: Change the meaning of ":0" back to "any port"
+
+commit 1809c8c0aa33ab48f2e5217d9dafcca87b032a6c
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Tue Nov 6 13:06:33 2018 -0800
+
+    Fix clientaddr for v6 traps by zeroing the port number
+    
+    This is the same thing that snmpUDPIPv4BaseDomain.c does
+    in the same place: zeroes out the port number when parsing
+    the clientaddr.
+
+commit 29d3a54c189e63cab1d15987e07ec8fe8fb76e84
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Tue Nov 6 13:05:52 2018 -0800
+
+    Fix typo: test IPv6, not IPv4.
+
+commit 4833c4ff7d479fd3554eeafa1cd4b23f52dfc7f5
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Tue Nov 6 13:05:28 2018 -0800
+
+    Fix UDP/IPv6 address parsing.  Add default tracing.
+
+commit 7be7d70719dea95a55b29b4fa3a7c29a7e7c946b
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Tue Nov 6 12:17:24 2018 -0800
+
+    Add some default tracing for trap source tests
+
+commit b7d00beeed42137aa5b2b3c93014059e8d67db2b
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Tue Nov 6 12:09:23 2018 -0800
+
+    Fix typo: test v6
+
+commit 9de0984a4c2502f2d548c9e9332cc04267b4c026
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Tue Nov 6 11:58:14 2018 -0800
+
+    Add trap source tests for "trapsess -s"
+
+commit 223de5eb19c95866e7c50c6d022f25cbdb22f816
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Tue Nov 6 11:54:22 2018 -0800
+
+    Bind to the address that we chose above, not just to the session address
+
+commit 6f6d85d27b2c1d42d05173633cea95916ab11cda
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Tue Nov 6 11:12:21 2018 -0800
+
+    Tests for setting the source address of trap messages
+
+commit 379cfa157e51fe51a802a3554fc7f268efeb74dc
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Tue Nov 6 08:16:16 2018 -0800
+
+    Avoid logging "unknown snmp version" for agentx
+
+commit 313949522c4d0ddfeac72195fa63512955d9eb28
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Nov 2 21:12:24 2018 -0700
+
+    libnsmp/transports: Fix the Darwin build
+    
+    Avoid that the Darwin build fails as follows:
+    
+    transports/snmpIPBaseDomain.c:9:12: error: static declaration of 'isnumber' follows non-static declaration
+    static int isnumber(const char *cp)
+               ^
+    /usr/include/ctype.h:323:1: note: previous definition is here
+    isnumber(int _c)
+    ^
+
+commit 62f6babcc7cfc54c79b442b8a7f45662b4ddc807
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Oct 28 12:43:33 2018 -0700
+
+    testing/fulltests/unit-tests: Add netsnmp_parse_ep_str() unit test
+
+commit 0831ed64a39a34dc040eabe39d0229b07fa2a8a5
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Oct 26 19:25:47 2018 -0700
+
+    libsnmp/transports: Add support for interface binding
+
+commit c7398de4122102b3250e6dac7c09dbc5d09f1840
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 27 20:42:47 2018 -0700
+
+    configure: Add a test for SO_BINDTODEVICE
+
+commit 76336fb63bb74b4dede5dda5c14fb8cf2d60be8e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Oct 25 21:13:13 2018 -0700
+
+    libsnmp/transports: Change multiple sockaddr_in* arguments into netsnmp_ep
+    
+    Make this change for all internal transport functions that will need
+    the network interface information. This patch does not change any
+    functionality.
+
+commit 19ba7b0a6b56d201a8563fe6505cd82e313c1c9c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Oct 25 19:53:04 2018 -0700
+
+    libsnmp/transports: Introduce netsnmp_sockaddr_in3() and netsnmp_sockaddr_in6_3()
+    
+    Introduce functions for converting Net-SNMP endpoint definitions into
+    struct netsnmp_ep. Calls to these functions will be added in a later
+    patch.
+
+commit 0b637fea62c7b6dc467b94206d0bd2dec6f912ca
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Oct 22 21:07:14 2018 -0700
+
+    libsnmp/transports: Introduce netsnmp_parse_ep_str()
+    
+    The only functional change in this patch is that it is now allowed
+    to surround IPv4 addresses and hostnames with square brackets in
+    transport endpoint definitions.
+
+commit b5c62f2dc1df5e97d635eab55286190d2acceae4
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Oct 28 14:27:21 2018 -0700
+
+    ci: Disable brew upgrade openssl in travis.yml because it fails often
+
+commit 9b637efe809c490fdcaf30d1af20b4cbaef76e3e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 27 20:34:21 2018 -0700
+
+    libsnmp/transports: Fix netsnmp_udp6_transport()
+    
+    Only create a transport object if parsing the client address succeeded
+    instead of creating a transport object when parsing the client address
+    failed.
+    
+    Fixes: 5d8372341594 ("shared transport + udp shared domain")
+
+commit 22884099f55d0bf33ba5953b5e3dbc24fac8214a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Oct 26 21:45:32 2018 -0700
+
+    libsnmp/transports: Unexport functions that are only used inside libsnmp
+    
+    This only affects the non-Cygwin Windows builds.
+
+commit 1e0856b3cc0336aea3a75076c491e98113c38990
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Jun 22 22:06:41 2018 -0700
+
+    MinGW64: Fix the NETSNMP_PRIz detection code
+
+commit e03dd5b6b906eb8cee8a08a52c69598e07875d1e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon May 7 07:02:51 2018 -0700
+
+    snmplib/read_config: Fix a compiler warning
+
+commit d20012cb9158153c66ddd5ce024e129b3e15e349
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun May 20 20:06:30 2018 -0700
+
+    configure: Fix the netsnmp_cv_size_t_type check
+    
+    Avoid that the following error message appears if size_t == long long:
+    
+    configure: line 26619: [: too many arguments
+
+commit f0b8f2c17707a3526132cfcdfa2056ffd1eea5b7
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Oct 22 21:06:24 2018 -0700
+
+    libsnmp/transports: Introduce netsnmp_resolve_v6_hostname()
+    
+    Other than changing the debug label from netsnmp_sockaddr_in6_2 into
+    netsnmp_sockaddr_in6, this patch does not change any functionality.
+
+commit fc286dc029054d292edc303146b2a07df40cf1fa
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Oct 26 19:47:40 2018 -0700
+
+    libsnmp/transports: Make TCP transport error handling more systematic
+    
+    This patch does not change any functionality.
+
+commit d0c22996629dabee9b416ffdaafaa740075dae8b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Oct 21 20:19:06 2018 -0700
+
+    libsnmp/transports: Remove several superfluous assignments
+    
+    Since the C language guarantees that static objects are zero-initialized,
+    assigning NULL to a member of such an object is superfluous. Leave out
+    several such superfluous NULL assignments.
+
+commit 06b7af9798a521e2ed1f88bcf62e550202d4095b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Oct 21 20:54:23 2018 -0700
+
+    libsnmp/transports/snmpIPv6BaseDomain.c: Remove some trailing whitespace
+
+commit d1ea7513559b66f17593f52b16a90977ca0da999
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Oct 26 18:43:03 2018 -0700
+
+    libsnmp/snmp_transport.c: Document the origin of the format of ostring variables
+
+commit 159b13e99fcdd32f273e0c3018d092b91f45c8e9
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 27 07:46:50 2018 -0700
+
+    MinGW64: Fix UDP transport build
+    
+    Avoid that the MinGW64 build fails as follows:
+    
+    transports/snmpUDPBaseDomain.c: In function 'netsnmp_udpbase_sendto':
+    transports/snmpUDPBaseDomain.c:290:16: error: 'struct in_pktinfo' has no member named 'ipi_spec_dst'
+                 ipi.ipi_spec_dst.s_addr = srcip->s_addr;
+                    ^
+    
+    Additionally, remove some incorrect Cygwin code.
+
+commit 6f1db6a1fecb0c8b39d9d92f412641c729099a9f
+Author: Havard Eidnes <heidnes@users.sourceforge.net>
+Date:   Fri Oct 26 06:55:57 2018 -0700
+
+    configure: Fix a shell script compatibility issue
+    
+    See also https://sourceforge.net/p/net-snmp/bugs/2896/
+
+commit 7e6aa914d066559ce223a6fa065e70e3eafd5949
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Oct 6 15:46:42 2018 -0700
+
+    ucd-snmp, HOST-MIB: Rework pcre abstraction
+    
+    In previous versions of the pcre library the pcre typedef was an alias
+    for struct pcre. In the latest version of that library that typedef is
+    an alias for struct real_pcre8_or_16. This patch avoids that the
+    compiler complains about incompatible pointer assignments between these
+    two structure types.
+
+commit 014a1a0ff052721c66c47b861129d8346ffb85ae
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed Jun 6 11:20:42 2018 +0200
+
+    snmplib, MIBs, Python: Fix gcc 8 warnings
+    
+    Avoid that gcc 8 complains about incompatible function casts. This
+    patch does not change any functionality.
+
+commit c6facf2f080c9e1ea803e4884dc92889ec83d990
+Author: Drew A Roedersheimer <Drew.A.Roedersheimer@leidos.com>
+Date:   Wed Oct 10 21:42:35 2018 -0700
+
+    snmplib/keytools: Fix a memory leak
+    
+    Avoid that Valgrind reports the following memory leak:
+    
+    17,328 bytes in 361 blocks are definitely lost in loss record 696 of 704
+       at 0x4C29BE3: malloc (vg_replace_malloc.c:299)
+       by 0x52223B7: CRYPTO_malloc (in /usr/lib64/libcrypto.so.1.0.2k)
+       by 0x52DDB06: EVP_MD_CTX_create (in /usr/lib64/libcrypto.so.1.0.2k)
+       by 0x4E9885D: generate_Ku (keytools.c:186)
+       by 0x40171F: asynchronous (leaktest.c:276)
+       by 0x400FE7: main (leaktest.c:356)
+
+commit 67726f2a74007b5b4117fe49ca1e02c86110b624
+Author: Drew A Roedersheimer <Drew.A.Roedersheimer@leidos.com>
+Date:   Tue Oct 9 23:28:25 2018 +0000
+
+    snmplib: Fix a memory leak in scapi.c
+    
+    This patch avoids that Valgrind reports the following leak:
+    
+    ==1069== 3,456 bytes in 72 blocks are definitely lost in loss record 1,568 of 1,616
+    ==1069==    at 0x4C29BE3: malloc (vg_replace_malloc.c:299)
+    ==1069==    by 0x70A63B7: CRYPTO_malloc (in /usr/lib64/libcrypto.so.1.0.2k)
+    ==1069==    by 0x7161B06: EVP_MD_CTX_create (in /usr/lib64/libcrypto.so.1.0.2k)
+    ==1069==    by 0x4EA3017: sc_hash (in /usr/lib64/libnetsnmp.so.31.0.2)
+    ==1069==    by 0x4EA1CD8: hash_engineID (in /usr/lib64/libnetsnmp.so.31.0.2)
+    ==1069==    by 0x4EA1DEC: search_enginetime_list (in /usr/lib64/libnetsnmp.so.31.0.2)
+    ==1069==    by 0x4EA2256: set_enginetime (in /usr/lib64/libnetsnmp.so.31.0.2)
+    ==1069==    by 0x4EC495E: usm_process_in_msg (in /usr/lib64/libnetsnmp.so.31.0.2)
+    ==1069==    by 0x4EC58CA: usm_secmod_process_in_msg (in /usr/lib64/libnetsnmp.so.31.0.2)
+    ==1069==    by 0x4E7B91D: snmpv3_parse (in /usr/lib64/libnetsnmp.so.31.0.2)
+    ==1069==    by 0x4E7C1F6: ??? (in /usr/lib64/libnetsnmp.so.31.0.2)
+    ==1069==    by 0x4E7CE94: ??? (in /usr/lib64/libnetsnmp.so.31.0.2)
+    
+    [ bvanassche: minimized diffs / edited commit message ]
+
+commit 0cd9154ec55413c60686ff6d82e3a59592e2b333
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Sep 28 20:55:39 2018 -0700
+
+    IP-MIB: Fix resource leaks in error paths
+    
+    This is a modified version of a subset of a patch supplied by Josef Ridky.
+    See also https://sourceforge.net/p/net-snmp/bugs/2889/.
+
+commit 516c110892cb351ca4f01e864c564703705ed257
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Sep 28 20:49:01 2018 -0700
+
+    NET-SNMP-SYSTEM-MIB: Fix a resource leak in an error path
+    
+    This is a subset of a patch supplied by Josef Ridky. See also
+    https://sourceforge.net/p/net-snmp/bugs/2889/.
+
+commit 484a6904a6926947d3db0185d650eb1e539c391b
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Sep 28 20:46:49 2018 -0700
+
+    net-snmp-create-v3-user.in: Remove dead code
+    
+    This was reported by Josef Ridky. See also
+    https://sourceforge.net/p/net-snmp/bugs/2889/.
+
+commit ddca8b3bd26519ef3ed51b4b80491e27ca306e5a
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Sep 28 20:44:27 2018 -0700
+
+    net-snmp-config.in: Do not execute the gcc output
+    
+    This was reported by Josef Ridky. See also
+    https://sourceforge.net/p/net-snmp/bugs/2889/.
+
+commit 14707eca724bea442e6f54e770410a6a653ec541
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Fri Sep 28 20:41:20 2018 -0700
+
+    net-snmp-config.in, net-snmp-create-v3-user.in: Remove an unused variable
+    
+    This was reported by Josef Ridky. See also
+    https://sourceforge.net/p/net-snmp/bugs/2889/.
+
+commit 28bcf2da9ab935f2db9c33478f8fc32d412ef9ba
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Sep 24 20:34:46 2018 -0700
+
+    ci, MinGW32: Use the MSYS OpenSSL library
+
+commit 6ce87144820964c7dd66a570d46fd4f53786abb4
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Sep 24 20:44:13 2018 -0700
+
+    MinGW32: Fix OpenSSL build
+
+commit c3437f18b88d1476e574d722cb8ae4f15320f8cb
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Sep 23 13:18:46 2018 -0700
+
+    ci/Appveyor: Also build against MinGW32
+
+commit 139da7ac1df864bfd1b03cd9c575242c8196d54d
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 18 08:13:29 2018 -0700
+
+    ci/net-snmp-run-tests: Remove NETSNMP_DNS_WORKAROUND definition
+    
+    Since the code that checks NETSNMP_DNS_WORKAROUND has been removed,
+    stop defining this environment variable.
+
+commit 2eed6491de0e04f82269a91855bad33523d04816
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat Aug 18 08:10:38 2018 -0700
+
+    Revert "Avoid that test T070com2sec_simple fails due to DNS filtering"
+    
+    Now that the tests that depend on the (one|two)*.net-snmp.org DNS
+    workaround have been disabled, remove the workaround itself.
+    
+    This reverts commit 3492c22bb6b730dec0941522199eeca7524ce6ed.
+
+commit 836a3ae5b56a74ef156cba703083ef041c30f430
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Thu Aug 30 08:39:35 2018 -0700
+
+    ci/openssl.bat: Fix the code for installing OpenSSL
+
+commit 61189459e5d2551be29df5c0f2fdb7511e9f8304
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Aug 14 19:02:45 2018 -0700
+
+    ci/openssl.bat: Update OpenSSL version
+
+commit b61b5ce210c6865575f657a7daecd14a8f73fd5c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue Aug 14 09:22:04 2018 -0700
+
+    ci/build.bat: Exit with an error code if nmake fails
+
+commit c9a3607e73ffd16dc6072b6d0b4c735344909f69
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 5 08:50:31 2018 -0700
+
+    ci/net-snmp-run-tests: Generalize the paths to locally built artifacts
+
+commit 0f575722859696b1405533e04d5b957598096c3c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun May 20 16:27:13 2018 -0700
+
+    ci/net-snmp-configure, Cygwin: Use OpenSSL
+
+commit 3eb21af05946417b20673ad7a0d0bd1413c19b71
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun May 20 11:58:51 2018 -0700
+
+    ci, Appveyor: Move the code for running tests from ci/build.bat into ci/test.bat
+
+commit 9452a8e7cfb11beceb529b7850bbe2c6405f2616
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon Jun 18 21:36:35 2018 -0700
+
+    ci: Build and test the SSH transport on Debian systems
+
+commit 6b58f32b100cb9a6948c879c864ae2a7af9d26c2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sun Aug 5 18:32:57 2018 -0700
+
+    testing/fulltests/default: Disable tests that depend on (one|two)*.net-snmp.org
+    
+    The (one|two)*.net-snmp.org domain names resolve into a local IP address
+    (127.0.0.x). Such DNS replies are filtered out by many security devices
+    to avoid DNS rebinding attacks. Hence disable these tests. See also
+    https://en.wikipedia.org/wiki/DNS_rebinding.
+
+commit 7fa458f6b8c0d141d2d416f42b8fb2fab3bbc0fc
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Tue May 8 19:27:10 2018 -0700
+
+    MinGW: configure: Fix the socklen_t, in_addr_t and ssize_t checks
+    
+    Include the Winsock header files before the <sys/...> header files
+    to avoid that compilation fails.
+
+commit c6e392d515e39a150fb2f699725c6f7beb19c0b1
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Mon Aug 27 11:26:56 2018 -0700
+
+    Remove code that accidentally crept in during conflict resolution.
+
+commit 154626c7d002b57056fa0b0f8aff884e42c74285
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Sat Aug 25 07:33:55 2018 -0700
+
+    Fix a typo in feature ifdef for netsnmp_strdup
+
+commit 198de178587841d1f85bdade1dcd892c7e172e4c
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Sat May 19 07:49:58 2018 -0700
+
+    snmplib: Avoid that sprint_realloc_octet_string() triggers a segmentation fault
+    
+    strlcpy() implementations typically scan for the end of the source argument
+    passed to strlcpy(). Hence avoid passing an unterminated string to strlcpy().
+    
+    Reported-by: Stuart Henderson <stu@spacehopper.org>
+    Fixes: 7f05daa8e0e0 ("CHANGES: BUG: 3444939: BUG: 1796886: snmplib: Avoid that sprint_realloc_octet_string() embeds unprintable control characters or binary zeroes in its output. This behavior could cause truncated output in snmptrapd.")
+
+commit 3defab66a7aee60ba582a8254412abd2e630c321
+Author: Bill Fenner <fenner@gmail.com>
+Date:   Mon May 14 14:51:16 2018 +0000
+
+    snmplib: fix clientaddr
+    
+    cea974008da30de8d39a1f8ede7189265d93d598 ("clear stack variable before
+    use") zeroed out the addr_pair, which was cleared at the beginning
+    of the function and then the remote address was stored in it.
+    Clearing it here results in clearing the remote address, meaning
+    that if you create a session with a clientaddr, the remote address
+    gets changed to 0.0.0.0.  Deleting this line restores the correct
+    behavior of sending to the desired remote address, and since the
+    memset() at the beginning of the function already cleared the stack
+    variable, it added no benefit.
+
+commit f1f44571138fb2dfecda7da6e0160d5ec890d0a2
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Mon May 7 07:47:24 2018 -0700
+
+    CHANGES: BUG: 2815: Display UTF-8 characters again
+    
+    Before commit 7f05daa8e0e0 sprint_realloc_octet_string() used memcpy()
+    for ASCII strings. That caused the output to be truncated if a '\0' was
+    embedded in an octet string. Commit 7f05daa8e0e0 fixed that issue but
+    broke UTF-8 support. Restore UTF-8 support by only using
+    sprint_realloc_asciistring() if the octet string contains a '\0'.
+    
+    Fixes: 7f05daa8e0e0 ("CHANGES: BUG: 3444939: BUG: 1796886: snmplib: Avoid that sprint_realloc_octet_string() embeds unprintable control characters or binary zeroes in its output. This behavior could cause truncated output in snmptrapd.")
+
+commit bd965b879fdae6c2bb86e71754156a1d1624e20e
+Author: Bart Van Assche <bvanassche@acm.org>
+Date:   Wed May 9 09:56:10 2018 -0700
+
+    Remove trailing carriage returns from source code files
+    
+    This patch does not change any of the Net-SNMP code.
+
+commit fc14e89dd2a2ec90914521b0faeb09cb0960a40b
+Author: Stuart Henderson <stu@spacehopper.org>
+Date:   Fri May 4 13:32:27 2018 +0100
+
+    ifm_media changed from u_int to uint64_t in OpenBSD 5.9
+    
+    Signed-off-by: Stuart Henderson <sthen@openbsd.org>
+
+----------------------------------------------------------------------
+
 Changes: V5.8.rc4 -> V5.8
 
 commit caff5ff65cd72664dedea827356f966317aa7a6d
diff -urpN net-snmp-5.8/FAQ net-snmp-5.9.1/FAQ
--- net-snmp-5.8/FAQ	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/FAQ	2021-05-26 05:19:35.000000000 +0700
@@ -1,7 +1,7 @@
       Frequently Asked Questions (FAQ) for the UCD/Net-SNMP package
       =============================================================
 		       FAQ Author: Dave Shield
-			Net-SNMP Version: 5.8
+			Net-SNMP Version: 5.9.1
 	    Net-SNMP/UCD-SNMP Project Leader: Wes Hardaker
 	     Email: net-snmp-coders@lists.sourceforge.net
 
diff -urpN net-snmp-5.8/Makefile.in net-snmp-5.9.1/Makefile.in
--- net-snmp-5.8/Makefile.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/Makefile.in	2021-05-26 05:19:35.000000000 +0700
@@ -6,6 +6,7 @@
 VPATH		= @srcdir@
 
 SUBDIRS		= snmplib @MAINSUBS@
+SUBDIRDEPS      = sedscript
 FTSUBDIRS	= @FTMAINSUBS@ snmplib
 TESTDIRS	= testing
 
@@ -17,14 +18,12 @@ CPP		= @CPP@ 					        \
 INSTALLHEADERS=version.h net-snmp-features.h
 INCLUDESUBDIR=system
 INCLUDESUBDIRHEADERS= aix.h bsd.h bsdi3.h bsdi4.h bsdi.h cygwin.h \
-	darwin.h darwin7.h darwin8.h darwin9.h darwin10.h darwin11.h darwin12.h \
-	darwin13.h darwin14.h darwin15.h darwin16.h darwin17.h \
-	dragonfly.h dynix.h \
+	darwin.h dragonfly.h dynix.h \
 	freebsd2.h freebsd3.h freebsd4.h freebsd5.h freebsd6.h \
 	freebsd7.h freebsd8.h freebsd9.h freebsd10.h freebsd11.h \
-	freebsd12.h freebsd.h kfreebsd.h \
+	freebsd12.h freebsd13.h freebsd14.h freebsd.h \
 	generic.h \
-	hpux.h irix.h linux.h mingw32.h mingw32msvc.h mips.h \
+	hpux.h irix.h kfreebsd.h linux.h mingw32.h mingw32msvc.h mips.h \
 	netbsd.h nto-qnx6.h osf5.h \
 	openbsd.h openbsd6.h openbsd5.h openbsd4.h \
 	solaris2.3.h solaris2.4.h solaris2.5.h solaris2.6.h \
@@ -35,6 +34,7 @@ INSTALLBUILTHEADERS=include/net-snmp/net
 INSTALLBUILTINCLUDEHEADERS=@FEATUREHEADERS@
 INSTALLBINSCRIPTS=net-snmp-config net-snmp-create-v3-user
 INSTALLUCDHEADERS=ucd-snmp-config.h version.h mib_module_config.h
+INSTALL_PKGCONFIG=netsnmp.pc netsnmp-agent.pc
 
 #
 # other install rules.
@@ -180,7 +180,7 @@ perlmodules: perlmakefiles subdirs
 
 perlmakefiles: perl/Makefile net-snmp-config-x
 
-perl/Makefile: perl/Makefile.PL
+perl/Makefile: perl/Makefile.PL subdirs
 	dir=`pwd` &&							\
 	cd perl &&							\
 	if false; then							\
@@ -275,6 +275,7 @@ configclean: makefileclean
 		libtool include/net-snmp/net-snmp-config.h \
 		net-snmp-config net-snmp-config-x configure-summary \
 		net-snmp-create-v3-user net-snmp-create-v3-user-x
+	rm -f *.pc
 	rm -f mibs/.index
 	rm -f include/net-snmp/agent/mib_module_config.h		\
 		include/net-snmp/agent/agent_module_config.h		\
@@ -454,6 +455,16 @@ perlcalloccheck:
 
 dist: tar
 
+rpm: dist
+	rpmtopdir=$$PWD/rpmbuilddir &&					\
+	for d in BUILD RPMS SOURCES SPECS SRPMS; do			\
+	  mkdir -p $${rpmtopdir}/$$d;					\
+	done &&								\
+	cp net-snmp-$(VERSION).tar.gz $${rpmtopdir}/SOURCES &&		\
+	MAKE="$(MAKE)" rpmbuild --define="%_topdir $${rpmtopdir}"	\
+	    -ba dist/net-snmp.spec &&					\
+	find $${rpmtopdir} -name '*rpm'
+
 FAQ.html:
 	local/FAQ2HTML FAQ
 
diff -urpN net-snmp-5.8/Makefile.rules net-snmp-5.9.1/Makefile.rules
--- net-snmp-5.8/Makefile.rules	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/Makefile.rules	2021-05-26 05:19:35.000000000 +0700
@@ -70,7 +70,7 @@ cleanfeaturessubdirs:
 		> $(top_builddir)/include/net-snmp/feature-details.h
 	$(FEATURECHECK) --feature-global $(top_builddir)/include/net-snmp/feature-details.h $(mysubdir) $< $@ $(CC) -E $(CPPFLAGS) $(CFLAGS) -c
 
-subdirs:
+subdirs: $(SUBDIRDEPS)
 	@if test "$(SUBDIRS)" != ""; then \
 		it="$(SUBDIRS)" ; \
 		for i in $$it ; do \
@@ -85,12 +85,14 @@ subdirs:
 # installlibs handles local, ucd and subdir libs. need to do subdir libs
 # before bins, sinze those libs may be needed for successful linking
 install: installlocalheaders @installucdheaders@ \
-         installlibs \
-         installlocalbin      installlocalsbin   \
+         installlibs         install_pkgconfig   \
+         installlocalbin     installlocalsbin    \
          installsubdirs      $(OTHERINSTALL)
 
-uninstall: uninstalllibs uninstallbin uninstallsbin uninstallheaders \
-           uninstallsubdirs $(OTHERUNINSTALL)
+uninstall: uninstalllibs     uninstall_pkgconfig \
+           uninstallbin      uninstallsbin       \
+           uninstallheaders                      \
+           uninstallsubdirs  $(OTHERUNINSTALL)
 
 installprogs: installbin installsbin
 
@@ -288,6 +290,26 @@ uninstalllibs:
 	fi
 
 #
+# pkg-config files
+#
+install_pkgconfig: $(INSTALL_PKGCONFIG)
+	@if test "x$(INSTALL_PKGCONFIG)" != x; then			\
+		$(SHELL) $(top_srcdir)/mkinstalldirs $(INSTALL_PREFIX)$(libdir)/pkgconfig; \
+		for i in $(INSTALL_PKGCONFIG); do			\
+			echo "installing $$i in $(INSTALL_PREFIX)$(libdir)/pkgconfig"; \
+		done;							\
+		$(INSTALL_DATA) $(INSTALL_PKGCONFIG) $(INSTALL_PREFIX)$(libdir)/pkgconfig; \
+	fi
+
+uninstall_pkgconfig:
+	@if test "x$(INSTALL_PKGCONFIG)" != x; then			\
+		for i in $(INSTALL_PKGCONFIG); do			\
+			echo "removing $$i from $(INSTALL_PREFIX)$(libdir)/pkgconfig"; \
+			$(UNINSTALL) $(INSTALL_PREFIX)$(libdir)/pkgconfig/$$i;\
+		done;							\
+	fi
+
+#
 # normal bin binaries
 #
 # set INSTALLBINPROGS to a list of things to install in each makefile.
@@ -416,13 +438,17 @@ lint:
 #
 depend: dependdirs
 	@if test -f Makefile.depend ; then \
-		makedepend `echo $(CPPFLAGS) | sed 's/-f[-a-z]*//g'` -o .lo $(srcdir)/*.c $(srcdir)/*/*.c ; \
+		makedepend `echo $(CPPFLAGS) | \
+		awk '{for(i=1;i<=NF;i++) if (match(substr($$i,1,2), "-[ID]")) print $$i}'` \
+		-o .lo $(srcdir)/*.c $(srcdir)/*/*.c ; \
 	fi
 
 
 nosysdepend: nosysdependdirs
 	@if test -f Makefile.depend ; then \
-		makedepend `echo $(CPPFLAGS) | sed 's/-f[-a-z]*//g'` -o .lo $(srcdir)/*.c $(srcdir)/*/*.c ; \
+		makedepend `echo $(CPPFLAGS) | \
+		awk '{for(i=1;i<=NF;i++) if (match(substr($$i,1,2), "-[ID]")) print $$i}'` \
+		-o .lo $(srcdir)/*.c $(srcdir)/*/*.c ; \
 		$(PERL) -n -i.bak $(top_srcdir)/makenosysdepend.pl Makefile ; \
 	fi
 
diff -urpN net-snmp-5.8/Makefile.top net-snmp-5.9.1/Makefile.top
--- net-snmp-5.8/Makefile.top	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/Makefile.top	2021-05-26 05:19:35.000000000 +0700
@@ -81,9 +81,9 @@ LINKCC	        = @LINKCC@
 # 5.3 was at 10, 5.4 is at 15, ...  This leaves some room for needed
 # changes for past releases if absolutely necessary.
 #
-# Most recent change: 35 for release 5.8
-LIBCURRENT  = 35
-LIBAGE      = 0
+# Most recent change: 40 for the v5.8.1 release.
+LIBCURRENT  = 41
+LIBAGE      = 1
 LIBREVISION = 0
 
 LIB_LD_CMD      = $(LIBTOOL) --mode=link $(LINKCC) $(CFLAGS) -rpath $(libdir) -version-info $(LIBCURRENT):$(LIBREVISION):$(LIBAGE) -o
@@ -99,7 +99,7 @@ RANLIB		= :
 .c.lo:
 	$(LIBTOOL) --mode=compile $(CC) $(CPPFLAGS) $(CFLAGS) -c -o $@ $<
 .rc.lo:
-	$(LIBTOOL) --mode=compile --tag=CC windres -o $@ -i $<
+	$(LIBTOOL) --mode=compile --tag=RC @RC@ -o $@ -i $<
 
 # include paths
 #
diff -urpN net-snmp-5.8/NEWS net-snmp-5.9.1/NEWS
--- net-snmp-5.8/NEWS	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/NEWS	2021-05-26 05:19:35.000000000 +0700
@@ -3,6 +3,30 @@ Please see the CHANGES file for a more d
 that have been fixed/applied, and the ChangeLog file for a comprehensive
 listing of all changes made to the code.
 
+*5.9.1*:
+    General: Many bug fixes
+
+*5.9*
+    snmplib:
+      - Add IPv6 support to DTLSUDP transport CHANGES: snmplib: use new
+	netsnmp_sockaddr_storage in netsnmp_addr_pair CHANGES: snmplib: add
+	base_transport ptr for tunneled transports
+
+    snmpd:
+      - Security vulnerabilty in the ping MIB reported by Christopher Ertl
+	from Microsoft fixed
+      - Changing to a different uid/gid can only be done once
+      - The extend mib is now read-only by default
+
+    snmptrap:
+      - BUG: 2899: Patch from Drew Roedersheimer to set library
+	engineboots/time values before sending
+
+    unspecified:
+      - Add pkg-config support for building applications and sub-agents Use
+	the netsnmp package when building Net-SNMP applications. Use the
+	netsnmp-agent package when building Net-SNMP subagents.
+
 *5.8*
     snmplib:
       - TLS/DTLS fixes
diff -urpN net-snmp-5.8/README net-snmp-5.9.1/README
--- net-snmp-5.8/README	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/README	2021-05-26 05:19:35.000000000 +0700
@@ -1,4 +1,4 @@
-	       README file for net-snmp Version: 5.8
+	       README file for net-snmp Version: 5.9.1
 
 DISCLAIMER
 
@@ -245,117 +245,8 @@ CLOSING
 
 THANKS
 
-  The following people have contributed various patches and
-  improvements.  To them we owe our deepest thanks (and you do too!):
-
-    Wes Hardaker <hardaker@users.sourceforge.net>
-    Steve Waldbusser <waldbusser@nextbeacon.com>
-    Dan A. Dickey <ddickey@transition.com>
-    Dave Shield <D.T.Shield@csc.liv.ac.uk>
-    Giovanni S. Marzot <gmarzot@nortelnetworks.com>
-    Niels Baggesen <nba@users.sourceforge.net>
-    Simon Leinen <simon@limmat.switch.ch>
-    David T. Perkins <dperkins@dsperkins.com>
-    Mike Perik <mikep@crt.com>
-    Sanjai Narain <narain@thumper.bellcore.com>
-    francus@metsny.delphi.com
-    Gary Palmer <gpalmer@freebsd.org>
-    Marc G. Fournier <scrappy@ki.net>
-    Gary A. Hayward <gah@bellcore.com>
-    Jennifer Bray <jbray@origin-at.co.uk>
-    Philip Guenther <guenther@gac.edu>
-    Elwyn B Davies <edavies@origin-at.co.uk>
-    Simon Burge <simonb@telstra.com.au>
-    David Paul Zimmerman <dpz@apple.com>
-    Alan Batie <batie@aahz.jf.intel.com>
-    Michael Douglass <mikedoug@texas.net>
-    Ted Rule <Ted_Rule@FLEXTECH.CO.UK>
-    Craig Bevins <craigb@bitcom.net.au>
-    Arther Hyun <arthur@psi.com>
-    Cristian Estan <Cristian.Estan@net.utcluj.ro>
-    Eugene Polovnikov <eugen@rd.zgik.zaporizhzhe.ua>
-    Jakob Ellerstedt <jakob@dynarc.se>
-    Michael J. Slifcak <slif@bellsouth.net>
-    Jonas Olsson <jolsson@erv.ericsson.se>
-    James H. Young <sysjhy@gsu.edu>
-    Jeff Johnson <jbj@redhat.com>
-    Markku Laukkanen <marlaukk@stybba.ntc.nokia.com>
-    Derek Simkowiak <dereks@kd-dev.com>
-    David F. Newman <dnewman@epnet.com>
-    Nick Amato <naamato@merit.edu>
-    Mike Baer <baerm@calweb.com>
-    Patrick Lawrence <pjlawrence@ucdavis.edu>
-    Russ Mundy <mundy@tislabs.com>
-    Olafur Gudmundsson <ogud@tislabs.com>
-    David Reeder <dreeder@tislabs.com>
-    Ed Lewis <lewis@tislabs.com>
-    Bill Babson <wbabson@tislabs.com>
-    Chris Smith <csmith@platform.com>
-    Mike Michaud <mikemichaud@earthlink.net>
-    Andy Hood <ahood@westpac.com.au>
-    Robert Story <rstory@freesnmp.com>
-    Bert Driehuis <driehuis@playbeing.org>
-    Juergen Schoenwaelder <schoenw@ibr.cs.tu-bs.de>
-    Frank Strauss <strauss@ibr.cs.tu-bs.de>
-    Ragnar Kjørstad <ucd@ragnark.vestdata.no>
-    Jochen Kmietsch <jochen.kmietsch@tu-clausthal.de>
-    Jun-ichiro itojun Hagino <itojun@iijlab.net>
-    John L Villalovos <john.l.villalovos@intel.com>
-    Christoph Mammitzsch <Christoph.Mammitzsch@tu-clausthal.de>
-    Arne Oesleboe <Arne.Oesleboe@item.ntnu.no>
-    Jeff Cours <jeff@ultradns.com>
-    Karl Schilke <karl_schilke@eli.net>
-    John Naylon <jbpn@cambridgebroadband.com>
-    Ken Hornstein <kenh@cmf.nrl.navy.mil>
-    Martin Oldfield <m@mail.tc>
-    Harrie Hazewinkel <harrie@users.sourceforge.net>
-    Mark Ferlatte <ferlatte@users.sourceforge.net>
-    Marus Meissner <marcusmeissner@users.sourceforge.net>
-    Stephan Wenzer <stephanwenzel@users.sourceforge.net>
-    Ron Mevissen <ron.mevissen@eed.ericsson.se>
-    T.J. Mather <tjmather@tjmather.com>
-    Craig Setera <seterajunk@charter.net>
-    Katsuhisa ABE <abekatsu@cysols.com>
-    Axel Kittenberger <Axel.Kittenberger@maxxio.com>
-    Johannes Schmidt-Fischer <jsf@InterFace-AG.com>
-    Jeffrey Watson <nostaw@users.sourceforge.net>
-    Bruce Shaw <Bruce.Shaw@gov.ab.ca>
-    Stefan Radman <sradman@users.sourceforge.net>
-    Stephen J. Friedl <sjfriedl@users.sourceforge.net>
-    Alex Burger <alex_b@users.sourceforge.net>
-    Christophe Varoqui <ext.devoteam.varoqui@sncf.fr>
-    Srikanth Pindiproli <sripindip@users.sourceforge.net>
-    Kevin Graham <kevgraham7@users.sourceforge.net>
-    Xiaofeng Ling <xfling@users.sourceforge.net>
-    Brandon Knitter <knitterb@bl...>
-    Andrew Findlay <andrew.findlay@skills-1st.co.uk>
-    Ron Tabor <rtabor@users.sourceforge.net>
-    Peter Warasin <drg-r3@users.sourceforge.net>
-    Bob Rowlands <robert.rowlands@sun.com>
-    Peter Hicks <Peter.Hicks@POGGS.CO.UK>
-    Andy Smith <wasmith32@earthlink.net>
-    Nick Barkas <nbarkas@users.sourceforge.net>
-    Noah Friedman <friedman@prep.ai.mit.edu>
-    Geert De Peuter <geert@depeuter.org>
-    Magnus Fromreide <magfr@lysator.liu.se>
-    Marcus Meissner <marcusmeissner@users.sourceforge.net>
-    Andrew Rucker Jones <arjones@users.sourceforge.net>
-    Dai.H. <dg-f@users.sourceforge.net>
-    Thomas Anders <tanders@users.sourceforge.net>
-    Vladislav Bogdanov <slava_reg@nsys.by>
-    Peter Martin <pnmartin@users.sourceforge.net>
-    Thomas Lackey <telackey@users.sourceforge.net>
-    Joe Buehler <jbuehler@spirentcom.com>
-    Anders Persson <apersson@users.sourceforge.net>
-    Rojer <rojer@users.sourceforge.net>
-    Bart Van Assche <bart.vanassche@gmail.com>
-    Pablo Carboni <pcarboni@users.sourceforge.net>
-    Bill Fenner <fenner@gmail.com>
-    Brian Sipos <bsiposrkf@users.sourceforge.net>
-    Eugene M. Kim <eugene.kim@ntti3.com>
-    Anders Wallin <wallinux@gmail.com>
-    Andrew Stormont <andy-js@users.sourceforge.net>
-    Keith Mendoza <keith@icei.org>
-
-  We've probably forgotten people on this list.  Let us know if you've
-  contributed code and we've left you out.
+  This project has been graciously supported by a long list of people
+  (too long to keep roperly up to date).  To them we owe our deepest
+  thanks (and you do too!).  Please see the git log or ChangeLog file,
+  where the core developers are careful to have (hopefully always)
+  pointed out where patches have come from.
diff -urpN net-snmp-5.8/README.win32 net-snmp-5.9.1/README.win32
--- net-snmp-5.8/README.win32	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/README.win32	2021-05-26 05:19:35.000000000 +0700
@@ -4,9 +4,9 @@
 *
 ***************************************************************************
 
-This guide describes how to build Net-SNMP with Microsoft Visual C++, the
-MinGW gcc compiler or the Cygwin gcc compiler.  As developers build with other
-Win32 environments, their notes will be included here.
+This guide describes how to build Net-SNMP with Microsoft Visual Studio,
+Cygwin, MinGW or Mingw-w64.  As developers build with other Win32
+environments, their notes will be included here.
 
 The sections in this guide are:
 
@@ -14,7 +14,6 @@ Current Status for Win32 platforms
 Interactions with Other Vendor's Products
 Running Net-SNMP as a replacement for the Microsoft SNMP service
 Co-existence with Microsoft SNMP services
-Installing Platform SDK
 Microsoft Visual C++ - Overview
 Microsoft Visual C++ - Configure / nmake - Building
 Microsoft Visual C++ - Workspace - Building
@@ -32,7 +31,7 @@ MinGW - Building with OpenSSL
 Configuring Net-SNMP
 How to Register the Net-SNMP Agent and Trap Daemon as Windows services
 Notes on SET support for WIN32 ports
-Notes on preprocessor defines for MSVC, MinGW and Cygwin
+Notes on preprocessor defines for Microsoft Visual Studio, MinGW and Cygwin
 Acknowledgements
 
 
@@ -42,14 +41,10 @@ Acknowledgements
 *
 ***************************************************************************
 
-All applications build with Microsoft Visual C++ 6.0, Microsoft Development
-Environment 2003 (MSVC 7.0/7.1), Microsoft Visual Studio 2005, Microsoft
-Visual Studio 2008, Microsoft Visual Studio 2010, gcc under Cygwin and gcc
-under MinGW.
+All applications build with Microsoft Studio, Cygwin, MinGW and Mingw-w64.
 
   -  All of the applications work (snmpwalk, snmpget, snmpset, snmptrap, ...).
-  -  The system, snmp, ip, tcp, udp and icmp MIB-groups work (requires the
-     Platform SDK).
+  -  The system, snmp, ip, tcp, udp and icmp MIB-groups work.
   -  The Net-SNMP agent runs as an AgentX master agent or as subagent.
   -  smux is working.
   -  The target, notification, disman/mte groups compile but are not tested.
@@ -67,19 +62,9 @@ under MinGW.
 
 The next subsection relates to items that are built using Visual Studio
 
-  -  All Visual Studio project (.dsp) files are cleaned, and 
-     a) Generate code to use Multi-Threaded DLL (/MD) "C" run-time library;
-     b) Provide the same preprocessor defines (WIN32,_CONSOLE,_MBCS);
-     c) Remove unnecessary references to GDI, ODBC, and "C" libraries;
-     d) Debug versions build source browsing and debugging information;
-     e) Provide consistent include search paths.
-
   -  All Debug and Release targets linked with libsnmp project targets
      build without errors, and are fully functional.
 
-  -  Both building via the interactive development environment and via the
-     command line (nmake) is supported.
-
   -  With Visual Studio 2005 and later, the Net-SNMP source code can be
      compiled into either 32-bit or 64-bit executables (the amd64/x64
      architecture). Previous Visual Studio versions support 32-bit executables
@@ -100,7 +85,7 @@ The next subsection relates to items tha
   -  Running the Net-SNMP Agent or trap receiver as a service on Windows 95
      or Windows 98 is not supported.
 
-  -  The Net-SNMP agent and trap receiver will fail to start if either 
+  -  The Net-SNMP agent and trap receiver will fail to start if either
      cannot bind to their connect port (161 for agent, 162 for trap receiver).
      Check the Services panel to be sure no other SNMP program conflicts. See
      the section titled 'Co-existence with Microsoft SNMP services' below.
@@ -109,7 +94,7 @@ The next subsection relates to items tha
      retaining all functionality and with slightly better SNMP conformance.
      See the section titled 'Co-existence with Microsoft SNMP services' below.
 
-  -  The Net-SNMP agent does not use the MS SNMP.dll, therefore it cannot 
+  -  The Net-SNMP agent does not use the MS SNMP.dll, therefore it cannot
      run as an extensible part of the MS agent.  It is possible to use a third
      party proxy agent for the MS agent to 'proxy' requests to the Net-SNMP
      agent listening on a different UDP port on the same machine.
@@ -127,9 +112,9 @@ The next subsection relates to items tha
 As of Net-SNMP 5.4, the Net-SNMP agent is able to load the Windows SNMP
 service extension DLLs by using the Net-SNMP winExtDLL extension.
 
-The Windows SNMP service must be installed, but the service must be disabled.  
-This is required so that the extension DLLs are available for loading, and 
-also because this extension and the existing Windows extensions use the 
+The Windows SNMP service must be installed, but the service must be disabled.
+This is required so that the extension DLLs are available for loading, and
+also because this extension and the existing Windows extensions use the
 Windows SNMP API from snmpapi.dll.
 
 An alternative to winExtDLL is to proxy requests from Net-SNMP to the Windows
@@ -146,7 +131,7 @@ Limitations
   value of the sysUpTime varbind included in the traps generated by SNMP
   extension DLLs (e.g. linkUp and linkDown) and the value of the sysUpTime
   varbind included in traps generated by Net-SNMP itself (e.g. coldStart).
- 
+
 - When using winExtDLL, hrSystemUptime.0 reports the system uptime in thousands
   of a second instead of hundreds of a second. This is well known behavior of
   the Microsoft DLL that implements this MIB object. For more information,
@@ -156,15 +141,15 @@ Limitations
 Enabling the Windows SNMP extension agents
 ------------------------------------------
 
-When installing Net-SNMP using the binary available from the web site, select 
+When installing Net-SNMP using the binary available from the web site, select
 'With Windows Extension DLL support' for the 'Net-SNMP Agent Service'.
 
 The recommended way to start snmpd is with the following command line:
 
  snmpd.exe -I-udp,udpTable,tcp,tcpTable,icmp,ip,interfaces,system_mib,sysORTable
 
-The above command will exclude all the Net-SNMP extensions that overlap with 
-the default Windows (2003) extensions included with Windows.  Other Net-SNMP 
+The above command will exclude all the Net-SNMP extensions that overlap with
+the default Windows (2003) extensions included with Windows.  Other Net-SNMP
 modules take precedence over the modules loaded by winExtDLL.
 
 The binary install of Net-SNMP includes shortcuts in the Start menu for
@@ -185,12 +170,12 @@ instead of the usual Net-SNMP:
  Windows host1 5.0.2195 Service Pack 4 2000 Server x86 Family 15 Model 12
  Stepping 0
 
-then it's using the Windows DLLs.  You may also notice that your floppy 
-drive is accessed when starting the service.  This is from one of the 
+then it's using the Windows DLLs.  You may also notice that your floppy
+drive is accessed when starting the service.  This is from one of the
 Windows extensions.
 
-To see what Windows modules are being loaded, you can shut down the 
-service and then run snmpd.exe from the command line with winExtDLL 
+To see what Windows modules are being loaded, you can shut down the
+service and then run snmpd.exe from the command line with winExtDLL
 debugging enabled using (all on one line):
 
  snmpd.exe -Lo -I-udp,udpTable,tcp,tcpTable,icmp,ip,interfaces,system_mib,
@@ -198,9 +183,9 @@ debugging enabled using (all on one line
 
 The Windows DLL snmpmib.dll (SNMPMIB) contains SNMP traffic statistics
 (.1.3.6.1.2.1.11).  As we are using Net-SNMP and not the Windows SNMP Service,
-no values will be returned from the Windows extension.  To allow SNMP 
-statistics to be received, the Net-SNMP module snmp_mib is permitted to load 
-by not excluding it in the above command line.  As stated above, this module 
+no values will be returned from the Windows extension.  To allow SNMP
+statistics to be received, the Net-SNMP module snmp_mib is permitted to load
+by not excluding it in the above command line.  As stated above, this module
 will take precedence over the Windows module.
 
 
@@ -214,8 +199,8 @@ The following registry keys are used by
 what extension DLLs to load:
 
 HKLM\SYSTEM\CurrentControlSet\Services\SNMP\Parameters\ExtensionAgents
-       
-Each REG_SZ value contains the registry path to an extension agent which 
+
+Each REG_SZ value contains the registry path to an extension agent which
 contains the path to the DLL.  For example:
 
 Name    Type    Value
@@ -232,27 +217,15 @@ Service dependencies
 --------------------
 
 Services that depend on the SNMP Service will have to be modified to depend on
-Net-SNMP instead of SNMP by modifying the registry.  See Microsoft article 
+Net-SNMP instead of SNMP by modifying the registry.  See Microsoft article
 193888 for more information.
 
 
-Compiling Net-SNMP with the winExtDLL extension (MSVC)
-------------------------------------------------------
-
-When building with MSVC 6, the Microsoft Platform SDK is required. Note: the
-most recent Platform SDK version that is still compatible with MSVC 6 is the
-February 2003 edition. This edition is no longer available online but can be
-ordered via http://mssdk.orderport.net/22221848/showall.asp.
+Compiling Net-SNMP with the winExtDLL extension
+-----------------------------------------------
 
-Configure / nmake:
-
--add --with-winextdll to the Configure command line.
-
-Workspace:
-
--in file win32\net-snmp\net-snmp-config.h modify
- /* #undef USING_WINEXTDLL_MODULE */ into the following:
- #define USING_WINEXTDLL_MODULE 1
+To build Net-SNMP with the winExtDLL extension, add --with-winextdll to the
+configure command line.
 
 
 ***************************************************************************
@@ -261,51 +234,51 @@ Workspace:
 *
 ***************************************************************************
 
-If the Microsoft SNMP agent service (SNMP Service) is running, the Net-SNMP 
+If the Microsoft SNMP agent service (SNMP Service) is running, the Net-SNMP
 agent (snmpd) will fail to start as it will not be able to bind to the default
 TCP/IP port of 161.
 
-If the Microsoft SNMP Trap Receiver service is running, the Net-SNMP trap 
-receiver (snmptrapd) will fail to start as it will not be able to bind to the 
+If the Microsoft SNMP Trap Receiver service is running, the Net-SNMP trap
+receiver (snmptrapd) will fail to start as it will not be able to bind to the
 default TCP/IP port of 162.
 
 It is not a requirement to install the Net-SNMP agent (snmpd) or trap receiver
-(snmptrapd).  All the command line utilities such as snmpget.exe, snmpset.exe 
-and the Perl modules will work without the Net-SNMP services.  All the 
+(snmptrapd).  All the command line utilities such as snmpget.exe, snmpset.exe
+and the Perl modules will work without the Net-SNMP services.  All the
 utilities will work against any SNMP agent.
 
-The main benefit of running the Microsoft SNMP agent instead of the Net-SNMP 
-agent is that many Windows applications such as Microsoft SQL Server, 
-Microsoft Exchange etc, extend the Microsoft agent.  Net-SNMP is NOT a drop 
+The main benefit of running the Microsoft SNMP agent instead of the Net-SNMP
+agent is that many Windows applications such as Microsoft SQL Server,
+Microsoft Exchange etc, extend the Microsoft agent.  Net-SNMP is NOT a drop
 in replacement for the Microsoft agent unless the winExtDLL Net-SNMP extension
-is used (see the section 'Running Net-SNMP as a replacement for the Microsoft 
+is used (see the section 'Running Net-SNMP as a replacement for the Microsoft
 SNMP service').  Running Net-SNMP in place of the Microsoft agent (without
 winExtDLL) will prevent the other applications from working with SNMP.  Also,
 the Net-SNMP agent does not contain as many MIBs as the Microsoft agent.  For
-example, as of August 2005, the HOST-RESOURCES (host) MIB is not yet 
+example, as of August 2005, the HOST-RESOURCES (host) MIB is not yet
 implemented in Net-SNMP.
 
 There are many benefits of running the Net-SNMP agent instead of the Microsoft
-such as you can extend the agent using various features found in snmpd.conf 
+such as you can extend the agent using various features found in snmpd.conf
 such as pass and pass_persist (support for others are being added), you can
 use SNMP v3, and there is more granular access control.
 
-To allow both the Microsoft and Net-SNMP agent / trap receiver to run at the 
-same time, the default TCP/IP port must be changed on either the Microsoft or 
+To allow both the Microsoft and Net-SNMP agent / trap receiver to run at the
+same time, the default TCP/IP port must be changed on either the Microsoft or
 Net-SNMP version of the application.
 
-The Net-SNMP ports for snmpd and snmptrapd can be modified via snmpd.conf and 
-snmptrapd.conf or by using a command line option with each program.  See the 
+The Net-SNMP ports for snmpd and snmptrapd can be modified via snmpd.conf and
+snmptrapd.conf or by using a command line option with each program.  See the
 Net-SNMP Help file for instructions on changing the port number.
 
-The Microsoft services use the 'snmp' and 'snmptrap' entries in the SERVICES 
+The Microsoft services use the 'snmp' and 'snmptrap' entries in the SERVICES
 file (%SystemRoot%\system32\drivers\etc\services) to determine the port to bind
-the service to when the service starts.  Simply modify the entries and restart 
+the service to when the service starts.  Simply modify the entries and restart
 the affected services.
 
-Note:  Changing the default port the service listens on will prevent it from 
-       accepting requests or receiving traps from standard SNMP devices and 
-       management stations unless they have also been reconfigured to use the 
+Note:  Changing the default port the service listens on will prevent it from
+       accepting requests or receiving traps from standard SNMP devices and
+       management stations unless they have also been reconfigured to use the
        new port numbers.
 
 It is possible to configure Net-SNMP agent to listen on the default UDP port
@@ -316,72 +289,72 @@ the Microsoft agent and subagents.  To t
 
  1.  Change the port that the Microsoft agent listens on.
 
- 2.  Configure the Microsoft agent to only accept requests from localhost.  
+ 2.  Configure the Microsoft agent to only accept requests from localhost.
      This can be set in the Security tab for the SNMP service in Windows 2000+.
      This is recommended to prevent users from querying the Microsoft agent
      directly.
- 
- 3.  Add a r/c community string to the Microsoft agent.  This can be set in 
-     the Security tab for the SNMP service in Windows 2000+.  This will give 
+
+ 3.  Add a r/c community string to the Microsoft agent.  This can be set in
+     the Security tab for the SNMP service in Windows 2000+.  This will give
      Net-SNMP full SNMP access.  User access can be restricted by Net-SNMP
      as explained below.
- 
+
  4.  Restart the Microsoft SNMP service.
 
  5.  Configure Net-SNMP to proxy requests to the Microsoft agent.  To have it
-     forward ALL requests to the Microsoft agent, add the following line to 
+     forward ALL requests to the Microsoft agent, add the following line to
      snmpd.conf:
- 
+
        proxy  -v 1 -c public localhost:1161 .1.3
- 
+
      To only forward a section of the MIB tree such as the host section, use:
- 
+
        proxy  -v 1 -c public localhost:1161 host
- 
+
  6.  Start the Net-SNMP agent.
- 
+
      Notes: If Net-SNMP has built in support for an OID and the proxy statement
             is not for a specific OID, then it will respond instead of proxying
             the request.  For example, if you proxy the 'system' tree and issue
-            an snmpget for sysDescr.0, Net-SNMP will respond with it's own 
+            an snmpget for sysDescr.0, Net-SNMP will respond with it's own
             version of sysDescr.0 instead of forwarding it.  To prevent Net-SNMP
-            from doing this, you must prevent the system MIB from being 
-            initialized when snmpd.exe is started by specifying what MIBS to 
+            from doing this, you must prevent the system MIB from being
+            initialized when snmpd.exe is started by specifying what MIBS to
             initialize using the -I switch.
-  
-            If you are forwarding everything to the Microsoft agent (.1.3), 
+
+            If you are forwarding everything to the Microsoft agent (.1.3),
             start snmpd.exe using:
- 
+
               snmpd.exe -Ivacm_conf,proxy,pass,pass_persist
- 
+
             The above will enable proxy, pass and pass_persist support.  See the
             snmpd man page for more information on the -I switch.
- 
+
             If you are forwarding a section of the tree that is not implemented
             in Net-SNMP such as 'host', you do not need to use the -I switch as
-            Net-SNMP will forward the request.  This may cause issues in the 
+            Net-SNMP will forward the request.  This may cause issues in the
             future if newer versions of Net-SNMP implement the section of the
             tree you are forwarding, such as the HOST-RESOURCES MIB.
- 
-            The pass and pass_persist commands will work even if the entire 
+
+            The pass and pass_persist commands will work even if the entire
             tree is proxied to the Microsoft Agent.
- 
+
  7.  Test the agent.  If you have forwarded the entire tree, issue an snmpget
      for sysDescr.0.  For example:
- 
+
        snmpget -v 1 -c public localhost sysDescr.0
- 
+
      The Microsoft agent will respond in a format similar to:
- 
-       Hardware: x86 Family 15 Model 12 Stepping 0 AT/AT COMPATIBLE - Software: 
+
+       Hardware: x86 Family 15 Model 12 Stepping 0 AT/AT COMPATIBLE - Software:
         Windows 2000 Version 5.0 (Build 2195 Uniprocessor Free)
-  
+
      The Net-SNMP agent would normally respond in a format similar to:
- 
+
        Windows host1 5.0.2195 Service Pack 4 2000 Server x86 Family 15 Model 12
         Stepping 0
 
-If you had previously configured the Microsoft agent with multiple community 
+If you had previously configured the Microsoft agent with multiple community
 strings to restrict who can read and write to the OID tree, the security
 settings should be transferred to snmpd.conf.  For example, if the Microsoft
 agent was configured with:
@@ -398,7 +371,7 @@ Add the following to snmpd.conf:
  rwcommunity  S3cur39876
  rwcommunity  Sn0wb0ard345
 
-It is possible to add more granular security using Net-SNMP.  For example, to 
+It is possible to add more granular security using Net-SNMP.  For example, to
 restrict the public community string to only read the system tree, use:
 
  rocommunity  public 0.0.0.0 system
@@ -408,125 +381,65 @@ See the snmpd.conf man page for more inf
 
 ***************************************************************************
 *
-* Installing Platform SDK
-*
-***************************************************************************
-
-If you are using Microsoft Visual Studio 6.0, you will have to install the
-Platform SDK (PSDK) first.
-
-Once the PSDK has been installed, select the following action from the Start
-Menu: Programs / Microsoft Windows SDK / Visual Studio Registration / Windows
-SDK Configuration Tool.
-
-If you are using any of the following environments, the PSDK download is not
-necessary as the required parts of the PSDK are included:
-    - Microsoft Visual Studio 2002 or later.
-    - Cygwin.
-    - MinGW.
-
-In order for the process part of the host resources MIB to work under Windows
-NT you will need to obtain PSAPI.DLL. This is available under the download 
-section of www.microsoft.com.  The DLL is included with Windows 2000 and XP, 
-and is also part of the VC++ distribution.  
-
-If you are building Net-SNMP using Cygwin, go now to "Cygwin - Building".
-If you are building Net-SNMP using MinGW, go now to "MinGW - Building".
-Otherwise, see the Building section below.
-
-
-***************************************************************************
-*
-* Microsoft Visual C++ - Overview
+* Microsoft Visual Studio - Overview
 *
 ***************************************************************************
 
-There are two ways to build Net-SNMP using Microsoft Visual C++.  The first
-and easiest method is using Configure and nmake on the command line, and the 
-second is using the Workspace files inside the interactive development
-environment.
+nmake is required to build Net-SNMP with Microsoft Visual Studio.
 
 To use nmake on the command line, the Configure script is run first to create
 the various makefiles.  Once these have been created, nmake is used to build
 the applications.  Perl is required to use this method, as the Configure
-script is written in Perl.  ActiveState ActivePerl is available at:
+script is written in Perl.  Perl source code is available at:
 
-        http://www.activestate.com/Products/ActivePerl/
+        https://www.cpan.org/src/
 
-The make file system is based on and uses the directory structure of the 
+The make file system is based on and uses the directory structure of the
 projects contained in the Workspace files which are described below.  It is
 recommended that you read and understand how the workspaces are configured
 even if you will only be using the command line Configure / nmake system.
 
-For building via the interactive development environment, there are the Win32
-workspaces win32.dsw and libdll.dsw. The last workspace allows to build a DLL
-version of snmplib (netsnmp.dll).
-
-There is one core development library ('libsnmp'), together with a number 
-of utility projects for the individual executable commands ('snmpget', 
-'snmpwalk', etc...).  All of these projects require the .lib created by 
-the libsnmp project.
-
-The agent requires the core library plus the other two library projects
-('libagent' and 'netsnmpmibs') together with the main agent project ('snmpd').
-
-The final application project is the trap handler 'snmptrapd'.  This also
-requires the agent libraries ('libagent' and 'netsnmpmibs') as well as the
-core development library.
-
-There is a Debug version and Release version for each subproject.  This is so
-the Debug and Release versions of an application can be built and tested
-separately.
-
-VC++ 6.0, 7.1, 8.0 (2005), 9.0 (2008) and 10.0 (2010) have been tested.
-Building with earlier Microsoft compiler versions is no longer supported.
-
-Note: if you want to distribute the generated executable, you will also need
+If you want to distribute the generated executable, you will also need
 to distribute the Microsoft Visual Studio Redistributable Package. Check the
 EULA included with that package before redistributing it.
 
 OpenSSL is required to support the encryption capabilities in SNMPv3,
 or SHA authentication.
 
-Since the MSVC build environment does not natively use "configure" nor "make"
-to generate the various pathnames that the programs require, the header files 
-need to be manually modified when using the IDE, and an install script is
-provided.  When using the Perl Configure / nmake system, the header files are
-automatically modified and require no manual editing.
+Since the Microsoft Visual Studio build environment does not natively use
+"configure" nor "make" to generate the various pathnames that the programs
+require, the header files need to be manually modified when using the IDE, and
+an install script is provided.  When using the Perl Configure / nmake system,
+the header files are automatically modified and require no manual editing.
 
 The projects are arranged so that ALL of the usable products, the .exe files,
-are written to the win32\bin directory.  The win32\lib directory is used only 
-to build the the files in the win32\bin directory.  Once building is 
+are written to the win32\bin directory.  The win32\lib directory is used only
+to build the the files in the win32\bin directory.  Once building is
 completed, there is no further use for the files in the win32\lib directory.
 
-Debug Information
------------------
-
-Note that VC++ 6.0 has options for debugging information - the 'Program 
-Database'.  This option is set in the Project settings, C/C++ tab, 'General' 
-category, and is turned on by default during the conversion of the project 
-files. This option is not for use with a library, as it embeds debug 
-information into the library that references an external file that will 
-not be available to the linking application. If you get an error message 
-along the lines of 'debugging information not available in file vc60.pdb, 
-make sure the library debug option is set to 'Program Database' or "/Zi".
-
-
 ***************************************************************************
 *
-* Microsoft Visual C++ - Configure / nmake - Building
+* Microsoft Visual Studio - Configure / nmake - Building
 *
 ***************************************************************************
 
-There are two ways to build Net-SNMP using the Configure / nmake system.  
+There are two ways to build Net-SNMP using the Configure / nmake system.
 The first and easiest method is by running the win32\build.bat script.  The
 second is manually running Configure and nmake.
 
-Note:  Perl is required to use this method as the Configure script is 
-       written in Perl.  ActiveState ActivePerl is available at:
+Note:  Perl is required to use this method as the Configure script is
+       written in Perl.  The Perl source code is available at:
 
-        http://www.activestate.com/Products/ActivePerl/
+        https://www.cpan.org/src/
 
+The Perl interpreter can be built as follows:
+1. Extract the Perl source code archive.
+2. In win32/Makefile, change CCTYPE to the string that corresponds to your
+   Visual Studio version, e.g. MSVC140.
+3. Edit INST_DRV and INST_TOP if necessary.
+4. Run vcvarsall.bat.
+5. Run nmake.
+6. Run nmake install.
 
 Win32\build.bat script
 ======================
@@ -558,45 +471,44 @@ steps to build using build.bat:
     ==================================
 
     1.  OpenSSL support:                disabled
-    2.  Platform SDK support:           disabled
+    2.  OpenSSL include directory:      C:\OpenSSL-Win64\include
+    3.  OpenSSL library directory:      C:\OpenSSL-Win64\lib\VC
+    4.  Platform SDK support:           disabled
 
-    3.  Install path:                   c:/usr
-    4.  Install after build:            enabled
+    5.  Install path:                   c:/usr
+    6.  Install after build:            enabled
 
-    5.  Perl modules:                   disabled
-    6.  Install perl modules:           disabled
+    7.  Perl modules:                   disabled
+    8.  Install perl modules:           disabled
 
-    7.  Quiet build (logged):           enabled
-    8.  Debug mode:                     disabled
+    9.  Quiet build (logged):           enabled
+    10. Debug mode:                     disabled
 
-    9.  IPv6 transports (requires SDK): disabled
-    10. winExtDLL agent (requires SDK): disabled
+    11. IPv6 transports (requires SDK): disabled
+    12. winExtDLL agent (requires SDK): disabled
 
-    11. Link type:                      static
+    13. Link type:                      static
 
-    12. Install development files       disabled
+    14. Install development files       disabled
 
     F.  Finished - start build
     Q.  Quit - abort build
 
-    Select option to set / toggle:  
+    Select option to set / toggle:
 
-6.  Toggle the options on and off as desired by typing the line number 
-    followed by <enter>.  
+6.  Toggle the options on and off as desired by typing the line number
+    followed by <enter>.
 
-    To compile with OpenSSL, the OpenSSL library and header files must 
-    already be installed.  See the section 'Microsoft Visual C++ - Building 
+    To compile with OpenSSL, the OpenSSL library and header files must
+    already be installed.  See the section 'Microsoft Visual C++ - Building
     with OpenSSL' for details.
 
-    To compile with the Platform SDK, the Platform SDK must already be 
-    installed.  See the section 'Installing Platform SDK' for details.
-
     To use the IPv6 transports, Windows 98 or later is required.
 
-    See the section 'Running Net-SNMP as a replacement for the Microsoft 
+    See the section 'Running Net-SNMP as a replacement for the Microsoft
     SNMP service' for important information on using the winExtDLL agent.
 
-    If Quiet mode is enabled, all build activity is stored in various *.out 
+    If Quiet mode is enabled, all build activity is stored in various *.out
     files inside of the win32 folder.
 
     When you are ready to build, type f <enter>
@@ -604,7 +516,7 @@ steps to build using build.bat:
 7.  Building will begin.  Following is a sample screen shot of a quiet build:
 
     Building...
-    
+
     Deleting old log files...
     Running Configure...
     Cleaning...
@@ -618,13 +530,13 @@ steps to build using build.bat:
     Building Perl modules...
     Testing Perl modules...
     Installing Perl modules...
-    
+
     See perlmake.out for Perl test results
-    
+
     Done!
 
-8.  If the folder that Net-SNMP was installed to is ever changed, modify the 
-    system environment variables or registry keys as explained in the 
+8.  If the folder that Net-SNMP was installed to is ever changed, modify the
+    system environment variables or registry keys as explained in the
     'Configuration_Overview.html' file located in win32/dist/htmlhelp.
 
 
@@ -648,17 +560,16 @@ first by the Configure script.  Followin
 2.  Initialize the Visual Studio build environment by running VCVARS32.bat
     which can be found in the bin folder of your Visual Studio install folder.
 
-3.  Type (all on one line):
+3.  Run the following command:
 
-      perl Configure --with-sdk --with-ssl --config=debug
-           --prefix="c:/usr"
+      perl Configure --with-sdk --with-ssl --config=debug --prefix="c:/usr"
 
 4.  The make files will be generated, and a configuration summary will appear:
 
     ---------------------------------------------------------
                 Net-SNMP configuration summary:
     ---------------------------------------------------------
-    
+
       Config type:                debug
       SDK:                        enabled
       Link type:                  static
@@ -671,7 +582,7 @@ first by the Configure script.  Followin
       nmake
       nmake install
 
-      perl Configure --with-sdk --with-ssl --config=debug --linktype=dynamic
+      perl Configure --with-sdk --with-ssl --config=debug --linktype=dynamic\
            --prefix="c:/usr"
 
       nmake libs_clean
@@ -691,273 +602,36 @@ For a complete list of possible build ta
 using Configure, run:
 
   nmake help
-      
+
 Note:  The Configure option --linktype=static (or not specifying a linktype)
-       will result in libsnmp being compiled and all other components being 
+       will result in libsnmp being compiled and all other components being
        statically linked to it.
 
-       The Configure option --linktype=dynamic will result in libsnmp_dll 
-       (netsnmp.dll) being compiled and all other components being dynamically 
+       The Configure option --linktype=dynamic will result in libsnmp_dll
+       (netsnmp.dll) being compiled and all other components being dynamically
        linked to it.
 
 
 ***************************************************************************
 *
-* Microsoft Visual C++ - Workspace - Building
-*
-***************************************************************************
-
-The win32.dsw and win32dll.dsw workspaces allow to build the agent and the
-applications. Proceed as follows:
-
-1. Update the version stamp in win32\net-snmp\net-snmp-config.h.  The current
-   version can be found in the Unix configure script (top level folder) by 
-   looking for the PACKAGE_VERSION variable.
-
-2. If SNMPv3 encryption capabilities or SHA authentication is required,
-   install the OpenSSL DLL and library file as described in the section 
-   'Microsoft Visual C++ - Building with OpenSSL" and then continue with 
-   step 2.
-
-3. The default installation path is c:\usr.  This folder will contain all
-   the binaries, MIB files, configuration files etc.  To change the location,
-   the win32\net-snmp\net-snmp-config.h file needs to be modified by changing
-   the INSTALL_BASE variable. 
-
-   Note:
-  
-     All paths in net-snmp-config.h use the "/" UNIX pathname delimiter.
-     If a drive letter is not specified, the current drive letter is assumed.
-
-     For example: #define INSTALL_BASE "c:/usr".  
-
-4.  When building DLLs instead of static libraries, *change* the following
-    line which is located near the top of the file:
-
-        /* #undef NETSNMP_USE_DLL */
-
-    *to*
-
-        #define NETSNMP_USE_DLL 1
-
-5. Build the agent and the applications
-
-   a. Open win32.dsw (static build) or win32dll.dsw (dynamic build).
-   b. If you want to generate 64-bit binaries instead of 32-bit binaries,
-      select "Build/Configuration Manager" and add the "x64" platform.
-   c. Select "Build/Batch Build..."  
-   d. Select the projects and configurations you want to build.
-   e. Click "ReBuild All".
-   f. When building is done, View the Output window, clip and
-      save to a text file if there is some information to share.
-
-6.  If the Perl modules are required, continue with the next section:
-    'Microsoft Visual C++ - Building the Perl SNMP modules'.
-
-    Otherwise, continue with the section: 
-    'Microsoft Visual C++ - Installing'
-
-
-***************************************************************************
-*
-* Microsoft Visual C++ - Workspace - Building the Perl SNMP modules
-*
-***************************************************************************
-
-The Perl modules should be compiled against the DLL version of snmplib.
-Compiling against a static version is possible, but each module will
-load it's own copy of the MIB, and sharing data between modules will
-not be possible.  For example, the conf module tests will fail.
-
-1.  Complete the section 'Microsoft Visual C++ - Building' and choose for
-    the dynamic build.  This will build the libraries, agent and applications.
-
-    Note:  SNMPD.EXE and SNMPTRAPD.EXE are required for running the tests 
-           against the SNMP Perl module.
-
-2.  Install Net-SNMP as described in the 'Microsoft Visual C++ - Installing'
-    section to install the applications, the DLL and the .lib files.
-
-3.  Continue with the Win32 section of the Perl README file located in 
-    perl\SNMP\README.
-
-
-***************************************************************************
-*
-* Microsoft Visual C++ - Workspace - Installing
-*
-***************************************************************************
-
-The install script "win32\install-net-snmp.bat" should be run after a
-build is successful.  It copies the programs, MIB files, and development
-components to an install directory named in the INSTALL_BASE variable.
-
-1.  Complete the section 'Microsoft Visual C++ - Building'. 
-
-2.  Open win32\install-net-snmp.bat using a text editor.
-
-    The INSTALL_BASE variable must match the INSTALL_BASE compile constant
-    defined in "win32\net-snmp\net-snmp-config.h", using these rules:
-
-    a.  All paths in install-net-snmp.bat use the "\" DOS pathname delimiter.
-
-        Example: set INSTALL_BASE="c:\usr".  
-
-    b.  All paths in net-snmp-config.h use the "/" UNIX pathname delimiter.
-        If a drive letter is not specified, the current drive letter is 
-        assumed.
-
-        Example: #define INSTALL_BASE "c:/usr".  
-
-    Note: You may also modify "install-net-snmp.bat" in order to not install 
-          the linking libraries, or the header files.
-
-3.  Open a command prompt window.
-
-4.  Cd to the base directory where this file README.win32 is located.
-
-5.  Run win32\install-net-snmp.bat to install the programs.
-
-    ## sample output from install-net-snmp.bat
-    
-    NOTE: Directory already exist messages are normal. If you are
-          not building with OpenSSL, then DLL not found messages
-          are normal.
-    
-    C:\net-snmp-5.1.1>    win32\install-net-snmp
-    Remember to run this script from the base of the source directory.
-    Creating "c:\usr" sub-directories
-    A subdirectory or file c:\usr already exists.
-    A subdirectory or file c:\usr\bin already exists.
-    A subdirectory or file c:\usr\etc\snmp already exists.
-    A subdirectory or file c:\usr\share\snmp\snmpconf-data
-         already exists
-    A subdirectory or file c:\usr\share\snmp\snmpconf-data\
-         snmp-data already exists.
-    A subdirectory or file c:\usr\share\snmp\snmpconf-data\
-         snmpd-data already exists.
-    A subdirectory or file c:\usr\share\snmp\snmpconf-data\
-         snmptrapd-data already exists.
-    A subdirectory or file c:\usr\lib already exists.
-    A subdirectory or file c:\usr\mibs already exists.
-    A subdirectory or file c:\usr\include already exists.
-    A subdirectory or file c:\usr\include\net-snmp already 
-         exists
-    .
-    A subdirectory or file c:\usr\include\ucd-snmp already 
-         exists
-    .
-    Copying MIB files to "c:\usr"\mibs
-    Copying compiled programs to "c:\usr"\bin
-    Copying snmpconf files to "c:\usr"\share\snmp\snmpconf-
-         data\snmp-data
-    Copying link libraries to "c:\usr"\lib
-    Copying header files to "c:\usr"\include
-    Deleting debugging files from "c:\usr"
-    Copying DLL files to "c:\usr"
-    The system cannot find the file specified.
-    Done copying files to "c:\usr"
-    C:\net-snmp-5.1.1>
-    
-    ## END sample output from install-net-snmp.bat
-
-6.  Add the bin folder (c:\usr\bin in the above example) to
-    your system path.
-
-7.  Test the installation.  For a simple test to see if Net-SNMP is working, 
-    open a _new_ command prompt window, and type:
-
-    snmptranslate -IR -Td linkDown
-
-8.  If the folder that Net-SNMP was installed to is ever changed, modify the 
-    system environment variables or registry keys as explained in the 
-    'Configuration_Overview.html' file located in win32/dist/htmlhelp.
-
-
-***************************************************************************
-*
-* Microsoft Visual C++ - Building with OpenSSL
+* Microsoft Visual Studio - Building with OpenSSL
 *
 ***************************************************************************
 
 OpenSSL is required to support the encryption capabilities in SNMPv3
-(or SHA authentication).  The win32 version of OpenSSL can be built
-from the sources or you can download a pre-compiled version.
-
-Building from source:
-=====================
-
- 1. Install an assembler.  If you do not have the M$ assembler installed (MASM)
-    you can get a free one(NASM) from:
-
-	http://www.kernel.org/pub/software/devel/nasm
-
-
- 2. Obtain the OpenSSL source from the link below. Follow instructions in 
-    INSTALL.W32
-
-	ftp://ftp.openssl.org/source/
-
-
- 3. Once the OpenSSL libraries are built, copy the folder inc32\openssl to
-    C:\OpenSSL\Include\openssl and the folder out32dll to C:\OpenSSL\Lib\VC.
-
-
-Using a pre-compiled version
-============================
-
- 1. Obtain the latest OpenSSL binary from the link below. 
-
-	http://www.slproweb.com/products/Win32OpenSSL.html
-
- 2. Install the package to c:\OpenSSL.
-
-
-Project changes
-===============
-
- 1. Edit the win32\net-snmp\net-snmp-config.h header file.  Add:
-
-	#define NETSNMP_USE_OPENSSL 1
-
- 2. Open Visual Studio, open the Tools menu and select Options. Go to
-    Projects and Solutions and select VC++ Directories. Add
-    C:\OpenSSL\Include to the list of include directories and
-    C:\OpenSSL\Lib\VC to the list of library directories.
-
- 3. Continue with the section 'Microsoft Visual C++ - Building"
-
-
-***************************************************************************
-*
-* Microsoft Visual C++ - Building with IPv6
-*
-***************************************************************************
-
-The default build configuration supports SNMP over IPv4-based transports.
-However Windows 2000 and later include an IPv6-capable stack which
-can be used to provide SNMP over IPv6.  To enable IPv6, the Microsoft PSDK 
-is required and NETSNMP_ENABLE_IPV6 has to be enabled in
-win32\net-snmp\net-snmp-config.h. Change the following single line from:
-
-        /* #undef NETSNMP_ENABLE_IPV6 */
-
-    to:
-
-       	#define NETSNMP_ENABLE_IPV6 1
-
-Next, continue with the section 'Microsoft Visual C++ - Building"
+(or SHA authentication). Pre-compiled binaries are available from
+http://www.slproweb.com/products/Win32OpenSSL.html.
 
 
 ***************************************************************************
 *
-* Microsoft Visual C++ - Building your own applications with snmplib
+* Microsoft Visual Studio - Building your own applications with snmplib
 *
 ***************************************************************************
 
-Linking in an snmplib built to use the Multithreaded DLL runtime library to 
-an application configured for the Debug Multithreaded DLL runtime library 
-results in a link error along the lines of 'defaultlib "MSVCRT" conflicts 
+Linking in an snmplib built to use the Multithreaded DLL runtime library to
+an application configured for the Debug Multithreaded DLL runtime library
+results in a link error along the lines of 'defaultlib "MSVCRT" conflicts
 with use of other libs'.   If you receive a similar message, check that the
 projects settings between library and application match up.
 
@@ -986,7 +660,7 @@ Note: Some users may have better results
 
 ***************************************************************************
 *
-* Microsoft Visual C++ - Extending the Agent
+* Microsoft Visual Studio - Extending the Agent
 *
 ***************************************************************************
 
@@ -1015,28 +689,34 @@ and 'snmpd' project. And things should w
 *
 ***************************************************************************
 
-There are two versions of GCC (the GNU Compiler Collection) in common use on
-Microsoft Windows operating systems. This section will attempt to point the 
+There are multiple versions of GCC (the GNU Compiler Collection) in common use
+on Microsoft Windows operating systems. This section will attempt to point the
 user to the information required to choose the one to best suit their needs.
 
 Cygwin
 
 The Cygwin compiler and toolkit provides a Unix style shell and environment
-for Windows based systems. The cygwin1.dll provides a POSIX emulation layer 
+for Windows based systems. The cygwin1.dll provides a POSIX emulation layer
 that simplifies porting Unix / Linux applications to Windows. The Cygwin dlls
-are required if an application is to be distributed. The dependency on the 
+are required if an application is to be distributed. The dependency on the
 The Cygwin tool chain and documentation can be found at:
 
 http://sources.redhat.com/cygwin/
 
 
-MinGW
+MinGW and Mingw-w64
 
-The MinGW compiler is a Windows native version of gcc. The tool chain links 
-against existing Windows dlls found on most systems. Binaries compiled with MinGW
-do not require additional libraries to be distributed. The MSyS environment 
-provides a shell (Bash) and tools to emulate a Unix style build environment on 
-Windows. The MinGW and MSyS tools and documentation can be found at:
+The MinGW projects provide a Windows native version of gcc. The tool chain
+links against existing Windows dlls found on most systems. Binaries compiled
+with MinGW do not require additional libraries to be distributed. The MSYS
+and MSYS2 environments provide a shell (Bash) and tools to emulate a Unix style
+build environment on Windows. Mingw-w64 is an improved version of MinGW which
+supports both 32-bit and 64-bit environments.
+
+MSYS + MinGW
+============
+
+The MinGW and MSYS tools and documentation can be found at:
 
 http://www.mingw.org
 
@@ -1070,13 +750,8 @@ Note: the source code should *not* be in
 For example, compiling in your 'My Documents' folder or your Desktop folder
 (usually c:\Documents and Settings\xxxx\Desktop) is not supported.
 
-A note for Windows NT users: in order for the process part of the host
-resources MIB (hr_swrun) to work under Windows NT you will need to get hold
-of PSAPI.DLL. This DLL is available under the download section of
-www.microsoft.com, and is also included in the VC++ distribution.
-
-If the folder that Net-SNMP was installed to is ever changed, modify the 
-system environment variables or registry keys as explained in the 
+If the folder that Net-SNMP was installed to is ever changed, modify the
+system environment variables or registry keys as explained in the
 'Configuration_Overview.html' file located in win32/dist/htmlhelp.
 
 
@@ -1086,41 +761,19 @@ system environment variables or registry
 *
 ***************************************************************************
 
-Currently the tools and agent will compile on win32 platforms using the
-MinGW tools with the MSyS environment. MinGW, MSyS and the associated
-documentation can be downloaded from: http://www.mingw.org.
+MinGW, MSyS and the associated documentation can be downloaded from
+http://www.mingw.org.
 
 Compiling net-snmp with MinGW requires GNU regex and libintl. Binaries and
-developer header files for these libraries are available at: 
+developer header files for these libraries can be installed by running the
+following command from a MinGW shell:
 
-        http://gnuwin32.sourceforge.net/packages/regex.htm
-        http://gnuwin32.sourceforge.net/packages/libintl.htm
+  mingw-get install msys-libregex msys-libintl msys-libopenssl
+  mingw-get upgrade msys-libregex msys-libintl msys-libopenssl
 
 Proceed as follows to build Net-SNMP:
 
-1.  Install GNU regex and GNU libintl binaries and developer files in the
-    MinGW tree.
-
-2.  If SNMPv3 encryption capabilities or SHA authentication is required,
-    install the OpenSSL DLL and library file as described in the section 
-    'MinGW - Building with OpenSSL" and then continue with step 3.
-
-3.  Determine where you want the programs to be installed.  Currently
-    you must use path segments no longer than 8 characters, and no
-    embedded spaces are allowed. Due to limitations with Makefiles,
-    you must also specify the MIBDIRS default that corresponds to
-    a particular subtree from the base directory.
-
-    Note: All paths use the "/" UNIX pathname delimiter.
-          Also note that embedded spaces will NOT currently work
-          with MinGW configure. Use the DOS 8.3 form of the path,
-
-    For example:  Say that you want to install the programs in
-    the directory "C:\usr".  
-
-    Use BASEDIR=c:/usr
-
-4.  Configure net-snmp using the configure flags as shown:
+1. Configure net-snmp using the configure flags as shown:
 
 	BASEDIR=c:/usr
 
@@ -1129,55 +782,40 @@ Proceed as follows to build Net-SNMP:
 	--with-mib-modules="agentx disman/event-mib winExtDLL examples/example"\
         --disable-embedded-perl --without-perl-modules \
 
-    Note: while the Net-SNMP implementation of the host resources MIB is not
-    supported when using MinGW, winExtDLL is supported. Via winExtDLL you can
-    use Microsoft's implementation of the host resources MIB.
-
-4.1. If you want to use IPv6 transports, add:
-	--enable-ipv6 --with-transports="TCPIPv6 UDPIPv6" \
+   If you want to use IPv6 transports, add:
+	--enable-ipv6 --with-transports="TCPIPv6 UDPIPv6"
 
+   Note: while the Net-SNMP implementation of the host resources MIB is not
+   supported when using MinGW, winExtDLL is supported. Via winExtDLL you can
+   use Microsoft's implementation of the host resources MIB.
 
-5.  Type "make" to compile the package. 
+2. Type "make" to compile the package.
 
-6.  Type "make install" to install the package.
+3. Type "make install" to install the package.
 
-7.  If the folder that Net-SNMP was installed to is ever changed, modify the 
-    system environment variables or registry keys as explained in the 
-    'Configuration_Overview.html' file located in win32/dist/htmlhelp.
+4. If the folder that Net-SNMP was installed to is ever changed, modify the
+   system environment variables or registry keys as explained in the
+   'Configuration_Overview.html' file located in win32/dist/htmlhelp.
 
-       
 ***************************************************************************
 *
-* MinGW - Building with OpenSSL
+* Mingw-w64 - Building
 *
 ***************************************************************************
 
-OpenSSL is required to support the encryption capabilities in SNMPv3
-(or SHA authentication).  A pre-compiled MinGW compatible version of
-OpenSSL is available on the Internet.
-
-Follow these steps to install OpenSSL:
-
- 1. Obtain the latest OpenSSL binary from the link below. 
-
-	http://www.slproweb.com/products/Win32OpenSSL.html
-
- 2. Install the package to c:\OpenSSL
-
- 3. Copy the header and library files to the the MinGW directory:
-
-    a.  Copy the c:\OpenSSL\include\openssl folder to the include folder in 
-        MinGW.
-
-        Example: "C:\MinGW\include\openssl\*.h"
-
-    b.  Copy c:\OpenSSL\lib\MinGW\libeay32.* to the lib folder in Mingw.
-
-        Example: "C:\MinGW\lib\libeay32.a"
-        Example: "C:\MinGW\lib\libeay32.def"
-
- 4. Continue with the section 'MinGW - Building"
+MSYS2 and Mingw-w64 can be installed as follows:
+1. Download the MSYS2 installer from https://www.msys2.org/.
+2. Run the MSYS2 installer.
+3. Open an MSYS2 shell.
+4. Run pacman -S make diffutils
+5. On a 32-bit system, run
+   pacman -S mingw-w64-i686-gcc mingw-w64-i686-openssl
+6. On a 64-bit system, run
+   pacman -S mingw-w64-x86_64-gcc mingw-w64-x86_64-openssl
 
+Do not try to make the MinGW64 gcc compiler to use the MSYS2 openssl-devel
+headers by adding /usr/include to the include path because this will trigger
+plenty of complaints about redefined macros and structures.
 
 ***************************************************************************
 *
@@ -1189,7 +827,7 @@ Proceed as follows:
  1. Uninstall Net-SNMP.
  2. Remove the C:\usr directory completely.
  3. Open a command prompt
- 4. Run the MSVC vcvarsall.bat script.
+ 4. Run the Microsoft Visual Studio vcvarsall.bat script.
  5. Change the current working directory to the Net-SNMP win32\dist directory.
  6. Run the .\build-binary.bat script.
  7. Copy the net-snmp-${version}.x86.exe installer to the desired location.
@@ -1208,12 +846,12 @@ All configuration files should be placed
 The INSTALL_BASE folder is defined in the win32\net-snmp\net-snmp-config.h
 file.  For example, c:\usr\etc\snmp.
 
-Included is a Perl script called snmpconf which can be used to create 
+Included is a Perl script called snmpconf which can be used to create
 configuration files.  Full documentation on using snmpconf is available from the
 Net-SNMP web site at the above link.
 
-To run snmpconf, first modify snmpconf.bat located in the bin folder where 
-Net-SNMP is installed.  Modify the set MYPERLPROGRAM= line to contain the full 
+To run snmpconf, first modify snmpconf.bat located in the bin folder where
+Net-SNMP is installed.  Modify the set MYPERLPROGRAM= line to contain the full
 path to the snmpconf Perl script.  For example:
 
   set MYPERLPROGRAM=c:\usr\bin\snmpconf
@@ -1222,8 +860,8 @@ You can now run snmpconf using the stand
 
   snmpconf -i
 
-For detailed information on using environment variables and the registry to 
-configure Net-SNMP, see the 'Configuration_Overview.html' file in 
+For detailed information on using environment variables and the registry to
+configure Net-SNMP, see the 'Configuration_Overview.html' file in
 win32/dist/htmlhelp.
 
 
@@ -1235,7 +873,7 @@ win32/dist/htmlhelp.
 
 The Agent (snmpd.exe) and trap daemon (snmptrapd.exe) can be run as a service
 under Windows operating systems that have the Service Control Manager (SCM)
-(Services Control Panel).  This includes Windows NT, 2000, XP and 2003.  
+(Services Control Panel).  This includes Windows NT, 2000, XP and 2003.
 Windows 9x/Me do not have the SCM.
 
 To allow snmpd.exe or snmptrapd.exe to run as a service, the programs need
@@ -1243,7 +881,7 @@ to be registered with the SCM.  This is
 the -register command line switch from a command prompt.
 
 If Net-SNMP was installed using the binary available from the Net-SNMP web site,
-there will be shortcuts in the Start menu for registering and unregistering the 
+there will be shortcuts in the Start menu for registering and unregistering the
 agent and snmptrapd.
 
 The synopsis for registering snmpd as a Windows service is:
@@ -1255,7 +893,7 @@ The synopsis for registering snmptrapd a
   snmptrapd -register [OPTIONS] [LISTENING ADDRESSES]
 
 After registration, the services 'Net-SNMP Agent' and 'Net-SNMP Trap Handler'
-will be available in the SCM.  The services can be started and stopped using 
+will be available in the SCM.  The services can be started and stopped using
 the SCM (Services Control Panel) or from the command prompt using:
 
  net start "Net-SNMP Agent"
@@ -1266,16 +904,16 @@ and
  net stop "Net-SNMP Agent"
  net stop "Net-SNMP Trap Handler"
 
-If any command line options are specified after the -register option, they 
+If any command line options are specified after the -register option, they
 will be included when the service starts.  For example, to register the
-snmptrapd daemon and enable logging of traps to c:\usr\log\snmptrapd.log, 
+snmptrapd daemon and enable logging of traps to c:\usr\log\snmptrapd.log,
 enter the following command line:
 
  snmptrapd -register -Lf c:/usr/log/snmptrapd.log
 
 Note:  Use Unix style slashes (/) for all paths.
 
-For a complete list of command line options, consult the man pages, or use 
+For a complete list of command line options, consult the man pages, or use
 the -h switch:
 
  snmpd -h
@@ -1284,20 +922,20 @@ the -h switch:
 Notes: -H will display all available snmpd.conf, snmptrapd.conf and snmp.conf
        configuration file options, not the command line options.
 
-       Like all Net-SNMP applications, snmpd and snmptrapd will use the 
-       SNMPCONFPATH and SNMPSHAREPATH environment variables when run as a 
-       service.  The registry is the recommended method for defining these 
-       variables due to a limitation in the Windows Service Control Manager 
+       Like all Net-SNMP applications, snmpd and snmptrapd will use the
+       SNMPCONFPATH and SNMPSHAREPATH environment variables when run as a
+       service.  The registry is the recommended method for defining these
+       variables due to a limitation in the Windows Service Control Manager
        (SCM).  When running as a service, if any system environment variables
-       are changed, the system will need to be rebooted to allow the services 
-       to access the changed environment variables (see Microsoft knowledge 
-       base article  821761).  Therefore, when running snmpd or snmptrapd as 
-       a service, if SNMPCONFPATH or SNMPSHAREPATH is changed, a reboot will 
-       be required after setting the environment variables, otherwise the 
-       services may fail to start.  Using the registry to store the environment 
+       are changed, the system will need to be rebooted to allow the services
+       to access the changed environment variables (see Microsoft knowledge
+       base article  821761).  Therefore, when running snmpd or snmptrapd as
+       a service, if SNMPCONFPATH or SNMPSHAREPATH is changed, a reboot will
+       be required after setting the environment variables, otherwise the
+       services may fail to start.  Using the registry to store the environment
        variables eliminates this problem.  See the 'Configuration_Overview.html'
        file in win32/dist/htmlhelp for more information on using the registry.
-    
+
 
 Unregistering the services
 --------------------------
@@ -1309,7 +947,7 @@ example:
 
  snmptrapd -unregister
 
-Note:  Be sure to have all Service Control Panel windows closed when 
+Note:  Be sure to have all Service Control Panel windows closed when
        unregistering, otherwise a reboot may be required to complete
        the removal.
 
@@ -1317,18 +955,18 @@ Note:  Be sure to have all Service Contr
 Modifying the services
 ----------------------
 
-To change the parameters that the SCM passes to snmpd or snmptrapd, the 
+To change the parameters that the SCM passes to snmpd or snmptrapd, the
 service must be unregistered, and then re-registered with the new options.
 
-For example, to change the parameters that SCM passes to snmpd, open a 
+For example, to change the parameters that SCM passes to snmpd, open a
 command prompt window, CD to the directory where the snmpd program is located
-(unless it is already in your PATH), identify the full set of parameters you 
+(unless it is already in your PATH), identify the full set of parameters you
 desire, then type these two commands:
 
  snmpd -unregister
  snmpd -register [OPTIONS] [LISTENING ADDRESSES]
 
-Note:  Be sure to have all Service Control Panel windows closed when 
+Note:  Be sure to have all Service Control Panel windows closed when
        unregistering, otherwise a reboot may be required to complete
        the removal.
 
@@ -1343,10 +981,10 @@ The following registry keys are used by
 
 HKLM\SYSTEM\CurrentControlSet\Services\Net-SNMP Agent
 HKLM\SYSTEM\CurrentControlSet\Services\Net-SNMP Trap Handler
-       
-Each command line option specified when regsitering the service will be added 
-to the Parameters registry subkey for the service as a ParamX REG_SZ value 
-where X starts at 1 and increments for each additional command line option.  
+
+Each command line option specified when regsitering the service will be added
+to the Parameters registry subkey for the service as a ParamX REG_SZ value
+where X starts at 1 and increments for each additional command line option.
 For example, '-Lf c:/usr/log/snmptrapd.log' would be:
 
  HKLM\SYSTEM\CurrentControlSet\Services\
@@ -1356,7 +994,7 @@ For example, '-Lf c:/usr/log/snmptrapd.l
    Net-SNMP Trap Handler\Parameters\Param2 c:/usr/log/snmptrapd.log
 
 To add additional command line switches or modify the existing ones, it is
-recommended to unregister and re-register the services with the new command 
+recommended to unregister and re-register the services with the new command
 line options.  It is also possible to directly add or modify the ParamX values
 in the registry.
 
@@ -1373,8 +1011,8 @@ Note:  The Parameters key is only create
 
 Requirements:
 
-  Windows NT/2000/XP or later: Requires Windows NT 4.0 SP4 or later. 
-  Windows 95/98/Me: Requires Windows 98 or later. 
+  Windows NT/2000/XP or later: Requires Windows NT 4.0 SP4 or later.
+  Windows 95/98/Me: Requires Windows 98 or later.
 
 Windows support for SET on following groups:
 
@@ -1386,11 +1024,11 @@ ifAdminStatus is read-write. Status can
 
 ip group:
 --------
-Scalar objects: 
+Scalar objects:
 ipForwarding:Currently windows supports only ON->OFF (IE,
 enable->disable). For any other value, it returns with failure.
 
-ipDefaultTTL: Supports value greater than or equal to 0. 
+ipDefaultTTL: Supports value greater than or equal to 0.
 
 Table objects:
 -------------
@@ -1399,7 +1037,7 @@ Table objects:
 route_write.c implements this.
 
 ipRouteDest: Setting this value, updates row with new ipRouteDest and all other
-             entries will be same as old row. 
+             entries will be same as old row.
     EX:
     Consider there is an entry with ipRouteDest = 10.0.0.20
     Request, snmpset localhost private ip.ipRouteTable.ipRouteEntry.ipRouteDest.10.0.0.20 -a 10.0.0.16
@@ -1423,11 +1061,11 @@ ipRouteMask: Write Supported.
 
 Creation of ipRouteTable row:
 -----------------------------
-snmpset request for non existent OID with ipRouteIfIndex, ipRouteMetric1, 
+snmpset request for non existent OID with ipRouteIfIndex, ipRouteMetric1,
 ipRouteNextHop and ipRouteMask varbinds, creates a row.
 
-snmpset with create option is not supported, as row creation requires 
-ipRouteIfIndex, ipRouteMetric1, ipRouteNextHop and ipRouteMask  in a single 
+snmpset with create option is not supported, as row creation requires
+ipRouteIfIndex, ipRouteMetric1, ipRouteNextHop and ipRouteMask  in a single
 request.
 
 Example to create a row:
@@ -1454,8 +1092,8 @@ Creation of row:
 snmpset request for non existent OID with ipNetToMediaPhysAddress varbind
 creates a row.
 
-snmpset with create option is not supported, as row creation requires 
-ipNetToMediaPhysAddress in a request 
+snmpset with create option is not supported, as row creation requires
+ipNetToMediaPhysAddress in a request
 request.
 
 Example to create a row:
@@ -1478,39 +1116,37 @@ be set by a management station is delete
 
 ***************************************************************************
 *
-* Notes on preprocessor defines for MSVC, MinGW and Cygwin
+* Notes on preprocessor defines for Microsoft Visual Studio, MinGW and Cygwin
 *
 ***************************************************************************
 
-When adding Windows specific code, one or more of the following defines should
-be used:
+When adding Windows specific code, proceed as follows:
+- Add a configure test in the appropriate file under configure.d for MinGW
+  and Cygwin.
+- Add the symbol defined by the configure test to
+  win32/net-snmp/net-snmp-config.h and also to
+  win32/net-snmp/net-snmp-config.h.in. If the feature is supported by
+  Microsoft visual Studio, define the symbol. Otherwise undefine it.
 
-Define:                  Description:
--------                  ------------
-WIN32                    Defined by MSVC & MinGW
+Try to avoid to add #ifdef's that use the WIN32, _MSC_VER, mingw32 and/or
+cygwin macros. These macros are defined as follows:
 
-_MSC_VER                 Defined by MSVC only (standard MSVC macro)
+Define:          Description:
+-------          ------------
+_WIN32           Defined by Microsoft Visual Studio, MinGW and Mingw-w64.
 
-mingw32                  Defined by MinGW only
+_WIN64           Defined by Microsoft Visual Studio and Mingw-w64 when
+                 generating 64-bit code.
 
-cygwin                   Defined by Cygwin only
+_MSC_VER         Defined by Microsoft Visual Studio only
 
-HAVE_WIN32_PLATFORM_SDK  Should be defined if the Microsoft Platform SDK is
-                         installed and registered with MSVC or enabled for
-                         MinGW or Cygwin
+__MINGW32__      Defined by MinGW and Mingw-w64
 
-MinGW and Cygwin do not require the Microsoft Platform SDK as they both should
-contain most if not all of the functionality provided by the SDK.  When adding
-code that requires the PSDK under MSVC, the following can usually be used:
+__MINGW64__      Defined by Mingw-w64 only
 
- #if defined (HAVE_WIN32_PLATFORM_SDK) || defined (mingw32) || defined (cygwin)
-                         
-As listed above, Cygwin does NOT define WIN32.  When adding generic Windows 
-code that will work with MSVC, MinGW and Cygwin, the following should be used:
+cygwin           Defined by Cygwin only
 
- #if defined (WIN32) || defined (cygwin)
 
-  
 ***************************************************************************
 *
 * Acknowledgements
diff -urpN net-snmp-5.8/aclocal.m4 net-snmp-5.9.1/aclocal.m4
--- net-snmp-5.8/aclocal.m4	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/aclocal.m4	2021-05-26 05:19:35.000000000 +0700
@@ -1,7 +1,7 @@
-# generated automatically by aclocal 1.11 -*- Autoconf -*-
+# generated automatically by aclocal 1.16 -*- Autoconf -*-
+
+# Copyright (C) 1996-2018 Free Software Foundation, Inc.
 
-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
-# 2005, 2006, 2007, 2008, 2009  Free Software Foundation, Inc.
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -11,6 +11,7 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+m4_ifndef([AC_CONFIG_MACRO_DIRS], [m4_defun([_AM_CONFIG_MACRO_DIRS], [])m4_defun([AC_CONFIG_MACRO_DIRS], [_AM_CONFIG_MACRO_DIRS($@)])])
 m4_include([m4/ac_add_search_path.m4])
 m4_include([m4/ac_msg_cache.m4])
 m4_include([m4/ac_msg_module_dbg.m4])
diff -urpN net-snmp-5.8/agent/Makefile.depend net-snmp-5.9.1/agent/Makefile.depend
--- net-snmp-5.8/agent/Makefile.depend	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/Makefile.depend	2021-05-26 05:19:35.000000000 +0700
@@ -1,6 +1,9 @@
 # DO NOT DELETE THIS LINE -- make depend depends on it.
 
 ./agent_handler.lo: ../include/net-snmp/net-snmp-config.h
+./agent_handler.lo: ../include/net-snmp/system/linux.h
+./agent_handler.lo: ../include/net-snmp/system/sysv.h
+./agent_handler.lo: ../include/net-snmp/system/generic.h
 ./agent_handler.lo: ../include/net-snmp/machine/generic.h
 ./agent_handler.lo: ../include/net-snmp/net-snmp-features.h
 ./agent_handler.lo: ../include/net-snmp/net-snmp-includes.h
@@ -30,7 +33,9 @@
 ./agent_handler.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./agent_handler.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agent_handler.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agent_handler.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agent_handler.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./agent_handler.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agent_handler.lo: ../include/net-snmp/library/ucd_compat.h
 ./agent_handler.lo: ../include/net-snmp/library/mib.h
 ./agent_handler.lo: ../include/net-snmp/mib_api.h
@@ -71,8 +76,8 @@
 ./agent_handler.lo: ../include/net-snmp/library/lcd_time.h
 ./agent_handler.lo: ../include/net-snmp/library/snmp_secmod.h
 ./agent_handler.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./agent_handler.lo: ../include/net-snmp/library/snmptsm.h
 ./agent_handler.lo: ../include/net-snmp/library/snmpusm.h
+./agent_handler.lo: ../include/net-snmp/library/snmptsm.h
 ./agent_handler.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agent_handler.lo: ../include/net-snmp/agent/mib_module_config.h
 ./agent_handler.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -139,7 +144,9 @@
 ./agent_index.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./agent_index.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agent_index.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agent_index.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agent_index.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./agent_index.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agent_index.lo: ../include/net-snmp/library/ucd_compat.h
 ./agent_index.lo: ../include/net-snmp/library/mib.h
 ./agent_index.lo: ../include/net-snmp/mib_api.h
@@ -179,8 +186,8 @@
 ./agent_index.lo: ../include/net-snmp/library/lcd_time.h
 ./agent_index.lo: ../include/net-snmp/library/snmp_secmod.h
 ./agent_index.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./agent_index.lo: ../include/net-snmp/library/snmptsm.h
 ./agent_index.lo: ../include/net-snmp/library/snmpusm.h
+./agent_index.lo: ../include/net-snmp/library/snmptsm.h
 ./agent_index.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agent_index.lo: ../include/net-snmp/agent/mib_module_config.h
 ./agent_index.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -252,7 +259,9 @@
 ./agent_read_config.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./agent_read_config.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agent_read_config.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agent_read_config.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agent_read_config.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./agent_read_config.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agent_read_config.lo: ../include/net-snmp/library/ucd_compat.h
 ./agent_read_config.lo: ../include/net-snmp/library/mib.h
 ./agent_read_config.lo: ../include/net-snmp/mib_api.h
@@ -292,8 +301,8 @@
 ./agent_read_config.lo: ../include/net-snmp/library/lcd_time.h
 ./agent_read_config.lo: ../include/net-snmp/library/snmp_secmod.h
 ./agent_read_config.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./agent_read_config.lo: ../include/net-snmp/library/snmptsm.h
 ./agent_read_config.lo: ../include/net-snmp/library/snmpusm.h
+./agent_read_config.lo: ../include/net-snmp/library/snmptsm.h
 ./agent_read_config.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agent_read_config.lo: ../include/net-snmp/agent/mib_module_config.h
 ./agent_read_config.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -337,14 +346,68 @@
 ./agent_read_config.lo: mibgroup/smux/smux.h mibgroup/utilities/iquery.h
 ./agent_read_config.lo: mibgroup/snmpv3/usmConf.h mibgroup/mibII/vacm_conf.h
 ./agent_read_config.lo: ../agent/mibgroup/mib_module_includes.h
-./agent_read_config.lo: mibgroup/examples/example.h mibgroup/testhandler.h
-./agent_read_config.lo: mibgroup/Rmon/rows.h mibgroup/Rmon/agutil.h
-./agent_read_config.lo: mibgroup/Rmon/statistics.h mibgroup/Rmon/alarmTable.h
-./agent_read_config.lo: mibgroup/Rmon/history.h mibgroup/Rmon/event.h
-./agent_read_config.lo: mibgroup/examples/scalar_int.h
-./agent_read_config.lo: mibgroup/examples/watched.h
+./agent_read_config.lo: mibgroup/Rmon/alarm.h mibgroup/agent/extend.h
 ./agent_read_config.lo: mibgroup/examples/data_set.h
 ./agent_read_config.lo: mibgroup/examples/delayed_instance.h
+./agent_read_config.lo: mibgroup/examples/example.h
+./agent_read_config.lo: mibgroup/examples/netSnmpHostsTable.h
+./agent_read_config.lo: mibgroup/examples/netSnmpHostsTable_columns.h
+./agent_read_config.lo: mibgroup/examples/netSnmpHostsTable_enums.h
+./agent_read_config.lo: mibgroup/examples/notification.h
+./agent_read_config.lo: mibgroup/examples/scalar_int.h
+./agent_read_config.lo: mibgroup/examples/ucdDemoPublic.h
+./agent_read_config.lo: mibgroup/examples/watched.h
+./agent_read_config.lo: mibgroup/mibII/mta_sendmail.h mibgroup/misc/ipfwacc.h
+./agent_read_config.lo: mibgroup/testhandler.h mibgroup/ucd-snmp/diskio.h
+./agent_read_config.lo: mibgroup/ucd-snmp/extensible.h
+./agent_read_config.lo: ../agent/mibgroup/mibdefs.h mibgroup/Rmon/rows.h
+./agent_read_config.lo: mibgroup/Rmon/agutil.h mibgroup/Rmon/statistics.h
+./agent_read_config.lo: mibgroup/Rmon/alarmTable.h mibgroup/Rmon/history.h
+./agent_read_config.lo: mibgroup/Rmon/event.h
+./agent_read_config.lo: mibgroup/disman/event/mteScalars.h
+./agent_read_config.lo: mibgroup/disman/event/mteTrigger.h
+./agent_read_config.lo: mibgroup/disman/event/mteTriggerTable.h
+./agent_read_config.lo: mibgroup/disman/event/mteTriggerDeltaTable.h
+./agent_read_config.lo: mibgroup/disman/event/mteTriggerExistenceTable.h
+./agent_read_config.lo: mibgroup/disman/event/mteTriggerBooleanTable.h
+./agent_read_config.lo: mibgroup/disman/event/mteTriggerThresholdTable.h
+./agent_read_config.lo: mibgroup/disman/event/mteTriggerConf.h
+./agent_read_config.lo: mibgroup/disman/event/mteEvent.h
+./agent_read_config.lo: ../agent/mibgroup/disman/event/mteTrigger.h
+./agent_read_config.lo: mibgroup/disman/event/mteEventTable.h
+./agent_read_config.lo: mibgroup/disman/event/mteEventSetTable.h
+./agent_read_config.lo: mibgroup/disman/event/mteEventNotificationTable.h
+./agent_read_config.lo: mibgroup/disman/event/mteEventConf.h
+./agent_read_config.lo: mibgroup/disman/event/mteObjects.h
+./agent_read_config.lo: mibgroup/disman/event/mteObjectsTable.h
+./agent_read_config.lo: mibgroup/disman/event/mteObjectsConf.h
+./agent_read_config.lo: mibgroup/disman/expr/expScalars.h
+./agent_read_config.lo: mibgroup/disman/expr/expExpression.h
+./agent_read_config.lo: ../agent/mibgroup/disman/expr/exp_enum.h
+./agent_read_config.lo: mibgroup/disman/expr/expExpressionTable.h
+./agent_read_config.lo: mibgroup/disman/expr/expErrorTable.h
+./agent_read_config.lo: mibgroup/disman/expr/expExpressionConf.h
+./agent_read_config.lo: mibgroup/disman/expr/expObject.h
+./agent_read_config.lo: ../agent/mibgroup/disman/expr/expExpression.h
+./agent_read_config.lo: mibgroup/disman/expr/expObjectTable.h
+./agent_read_config.lo: mibgroup/disman/expr/expObjectConf.h
+./agent_read_config.lo: mibgroup/disman/expr/expValue.h
+./agent_read_config.lo: mibgroup/disman/expr/expValueTable.h
+./agent_read_config.lo: mibgroup/disman/nslookup/lookupCtlTable.h
+./agent_read_config.lo: mibgroup/disman/nslookup/lookupResultsTable.h
+./agent_read_config.lo: mibgroup/disman/ping/pingCtlTable.h
+./agent_read_config.lo: mibgroup/disman/ping/pingResultsTable.h
+./agent_read_config.lo: mibgroup/disman/ping/pingProbeHistoryTable.h
+./agent_read_config.lo: mibgroup/disman/schedule/schedCore.h
+./agent_read_config.lo: mibgroup/disman/schedule/schedConf.h
+./agent_read_config.lo: mibgroup/disman/schedule/schedTable.h
+./agent_read_config.lo: mibgroup/disman/traceroute/traceRouteCtlTable.h
+./agent_read_config.lo: mibgroup/disman/traceroute/traceRouteResultsTable.h
+./agent_read_config.lo: mibgroup/disman/traceroute/traceRouteProbeHistoryTable.h
+./agent_read_config.lo: mibgroup/disman/traceroute/traceRouteHopsTable.h
+./agent_read_config.lo: mibgroup/hardware/cpu/cpu.h
+./agent_read_config.lo: mibgroup/hardware/cpu/cpu_linux.h
+./agent_read_config.lo: mibgroup/hardware/memory/hw_mem.h
 ./agent_read_config.lo: mibgroup/host/hrh_storage.h
 ./agent_read_config.lo: mibgroup/host/hrh_filesys.h
 ./agent_read_config.lo: mibgroup/host/hrSWInstalledTable.h
@@ -353,7 +416,32 @@
 ./agent_read_config.lo: mibgroup/host/hr_other.h mibgroup/host/hr_proc.h
 ./agent_read_config.lo: mibgroup/host/hr_network.h mibgroup/host/hr_print.h
 ./agent_read_config.lo: mibgroup/host/hr_disk.h mibgroup/host/hr_partition.h
+./agent_read_config.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable.h
+./agent_read_config.lo: ../include/net-snmp/data_access/arp.h
+./agent_read_config.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_constants.h
+./agent_read_config.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_interface.h
+./agent_read_config.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable.h
+./agent_read_config.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_data_access.h
+./agent_read_config.lo: mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable.h
+./agent_read_config.lo: ../include/net-snmp/data_access/interface.h
+./agent_read_config.lo: ../agent/mibgroup/if-mib/ifTable/ifTable.h
+./agent_read_config.lo: ../agent/mibgroup/if-mib/ifTable/ifTable_constants.h
+./agent_read_config.lo: ../agent/mibgroup/if-mib/ifTable/ifTable_interface.h
+./agent_read_config.lo: ../agent/mibgroup/if-mib/ifTable/ifTable.h
+./agent_read_config.lo: ../agent/mibgroup/if-mib/ifTable/ifTable_data_access.h
+./agent_read_config.lo: mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable_constants.h
+./agent_read_config.lo: mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable_interface.h
+./agent_read_config.lo: mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable.h
+./agent_read_config.lo: mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable_data_access.h
+./agent_read_config.lo: mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable.h
+./agent_read_config.lo: mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable_constants.h
+./agent_read_config.lo: mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable_interface.h
+./agent_read_config.lo: mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable.h
+./agent_read_config.lo: mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable_data_access.h
+./agent_read_config.lo: mibgroup/notification/snmpNotifyTable.h
+./agent_read_config.lo: mibgroup/notification/snmpNotifyTable_data.h
 ./agent_read_config.lo: mibgroup/tsm-mib/snmpTsmConfigurationUsePrefix.h
+./agent_read_config.lo: mibgroup/tunnel/tunnel.h mibgroup/ucd-snmp/pass.h
 ./agent_read_config.lo: mibgroup/snmpv3/snmpEngine.h
 ./agent_read_config.lo: mibgroup/snmpv3/snmpMPDStats.h
 ./agent_read_config.lo: mibgroup/snmpv3/usmStats.h mibgroup/snmpv3/usmUser.h
@@ -363,20 +451,16 @@
 ./agent_read_config.lo: mibgroup/mibII/setSerialNo.h mibgroup/mibII/at.h
 ./agent_read_config.lo: mibgroup/mibII/ip.h mibgroup/mibII/var_route.h
 ./agent_read_config.lo: mibgroup/mibII/route_write.h mibgroup/mibII/at.h
-./agent_read_config.lo: mibgroup/mibII/tcp.h mibgroup/mibII/icmp.h
-./agent_read_config.lo: mibgroup/mibII/udp.h mibgroup/mibII/ipv6.h
-./agent_read_config.lo: mibgroup/ucd-snmp/disk_hw.h
-./agent_read_config.lo: ../agent/mibgroup/mibdefs.h mibgroup/ucd-snmp/proc.h
+./agent_read_config.lo: mibgroup/mibII/tcp.h mibgroup/mibII/udp.h
+./agent_read_config.lo: mibgroup/mibII/ipv6.h mibgroup/mibII/icmp.h
+./agent_read_config.lo: mibgroup/ucd-snmp/disk_hw.h mibgroup/ucd-snmp/proc.h
 ./agent_read_config.lo: mibgroup/ucd-snmp/versioninfo.h
-./agent_read_config.lo: mibgroup/ucd-snmp/pass.h
 ./agent_read_config.lo: mibgroup/ucd-snmp/pass_persist.h
-./agent_read_config.lo: mibgroup/ucd-snmp/loadave.h mibgroup/agent/extend.h
+./agent_read_config.lo: mibgroup/ucd-snmp/loadave.h
 ./agent_read_config.lo: mibgroup/ucd-snmp/errormib.h mibgroup/ucd-snmp/file.h
 ./agent_read_config.lo: mibgroup/ucd-snmp/dlmod.h mibgroup/ucd-snmp/proxy.h
 ./agent_read_config.lo: mibgroup/ucd-snmp/logmatch.h
 ./agent_read_config.lo: mibgroup/ucd-snmp/memory.h mibgroup/ucd-snmp/vmstat.h
-./agent_read_config.lo: mibgroup/notification/snmpNotifyTable.h
-./agent_read_config.lo: mibgroup/notification/snmpNotifyTable_data.h
 ./agent_read_config.lo: mibgroup/notification/snmpNotifyFilterProfileTable.h
 ./agent_read_config.lo: mibgroup/notification/snmpNotifyFilterProfileTable_data.h
 ./agent_read_config.lo: mibgroup/notification-log-mib/notification_log.h
@@ -390,68 +474,77 @@
 ./agent_read_config.lo: mibgroup/agent/nsDebug.h mibgroup/agent/nsCache.h
 ./agent_read_config.lo: mibgroup/agent/nsLogging.h
 ./agent_read_config.lo: mibgroup/agent/nsVacmAccessTable.h
-./agent_read_config.lo: mibgroup/disman/event/mteScalars.h
-./agent_read_config.lo: mibgroup/disman/event/mteTrigger.h
-./agent_read_config.lo: mibgroup/disman/event/mteTriggerTable.h
-./agent_read_config.lo: mibgroup/disman/event/mteTriggerDeltaTable.h
-./agent_read_config.lo: mibgroup/disman/event/mteTriggerExistenceTable.h
-./agent_read_config.lo: mibgroup/disman/event/mteTriggerBooleanTable.h
-./agent_read_config.lo: mibgroup/disman/event/mteTriggerThresholdTable.h
-./agent_read_config.lo: mibgroup/disman/event/mteTriggerConf.h
-./agent_read_config.lo: mibgroup/disman/event/mteEvent.h
-./agent_read_config.lo: ../agent/mibgroup/disman/event/mteTrigger.h
-./agent_read_config.lo: mibgroup/disman/event/mteEventTable.h
-./agent_read_config.lo: mibgroup/disman/event/mteEventSetTable.h
-./agent_read_config.lo: mibgroup/disman/event/mteEventNotificationTable.h
-./agent_read_config.lo: mibgroup/disman/event/mteEventConf.h
-./agent_read_config.lo: mibgroup/disman/event/mteObjects.h
-./agent_read_config.lo: mibgroup/disman/event/mteObjectsTable.h
-./agent_read_config.lo: mibgroup/disman/event/mteObjectsConf.h
-./agent_read_config.lo: mibgroup/disman/schedule/schedCore.h
-./agent_read_config.lo: mibgroup/disman/schedule/schedConf.h
-./agent_read_config.lo: mibgroup/disman/schedule/schedTable.h
 ./agent_read_config.lo: mibgroup/utilities/override.h
 ./agent_read_config.lo: mibgroup/host/data_access/swinst.h
 ./agent_read_config.lo: mibgroup/host/data_access/swrun.h
 ./agent_read_config.lo: mibgroup/host/hrSWRunPerfTable.h
+./agent_read_config.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable.h
+./agent_read_config.lo: ../include/net-snmp/data_access/route.h
+./agent_read_config.lo: ../agent/mibgroup/mibII/route_headers.h
+./agent_read_config.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_constants.h
+./agent_read_config.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_interface.h
+./agent_read_config.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable.h
+./agent_read_config.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_data_access.h
+./agent_read_config.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable.h
+./agent_read_config.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_constants.h
+./agent_read_config.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_interface.h
+./agent_read_config.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable.h
+./agent_read_config.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_data_access.h
+./agent_read_config.lo: mibgroup/if-mib/data_access/interface.h
+./agent_read_config.lo: mibgroup/if-mib/ifTable/ifTable.h
+./agent_read_config.lo: mibgroup/notification/snmpNotifyTable_data.h
+./agent_read_config.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_storage.h
+./agent_read_config.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable.h
+./agent_read_config.lo: ../agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_storage.h
+./agent_read_config.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_constants.h
+./agent_read_config.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_interface.h
+./agent_read_config.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable.h
+./agent_read_config.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_access.h
+./agent_read_config.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable.h
+./agent_read_config.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_oids.h
+./agent_read_config.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_enums.h
+./agent_read_config.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_interface.h
+./agent_read_config.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable.h
+./agent_read_config.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_data_access.h
+./agent_read_config.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_data_get.h
+./agent_read_config.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_data_set.h
+./agent_read_config.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHParameters/usmDHParameters.h
+./agent_read_config.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable.h
+./agent_read_config.lo: ../include/net-snmp/data_access/tcpConn.h
+./agent_read_config.lo: ../include/net-snmp/data_access/ipaddress.h
+./agent_read_config.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_constants.h
+./agent_read_config.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_interface.h
+./agent_read_config.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable.h
+./agent_read_config.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_data_access.h
+./agent_read_config.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable.h
+./agent_read_config.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_constants.h
+./agent_read_config.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_interface.h
+./agent_read_config.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable.h
+./agent_read_config.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_data_access.h
 ./agent_read_config.lo: mibgroup/tlstm-mib/snmpTlstmSession/snmpTlstmSession.h
 ./agent_read_config.lo: mibgroup/tlstm-mib/snmpTlstmAddrTable/snmpTlstmAddrTable.h
 ./agent_read_config.lo: mibgroup/tlstm-mib/snmpTlstmCertToTSNTable/snmpTlstmCertToTSNTable.h
 ./agent_read_config.lo: mibgroup/tlstm-mib/snmpTlstmParamsTable/snmpTlstmParamsTable.h
 ./agent_read_config.lo: mibgroup/tsm-mib/snmpTsmStats/snmpTsmStats.h
+./agent_read_config.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable.h
+./agent_read_config.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_constants.h
+./agent_read_config.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_interface.h
+./agent_read_config.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable.h
+./agent_read_config.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_data_access.h
 ./agent_read_config.lo: mibgroup/mibII/vacm_context.h
 ./agent_read_config.lo: mibgroup/mibII/var_route.h mibgroup/mibII/tcpTable.h
 ./agent_read_config.lo: mibgroup/mibII/udpTable.h
 ./agent_read_config.lo: mibgroup/ip-mib/ip_scalars.h
-./agent_read_config.lo: mibgroup/notification/snmpNotifyTable_data.h
-./agent_read_config.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_storage.h
-./agent_read_config.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable.h
-./agent_read_config.lo: ../agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_storage.h
-./agent_read_config.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_constants.h
-./agent_read_config.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_interface.h
-./agent_read_config.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable.h
-./agent_read_config.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_access.h
 ./agent_read_config.lo: mibgroup/notification/snmpNotifyFilterProfileTable_data.h
 ./agent_read_config.lo: mibgroup/target/snmpTargetAddrEntry_data.h
 ./agent_read_config.lo: mibgroup/target/snmpTargetParamsEntry_data.h
-./agent_read_config.lo: mibgroup/hardware/memory/hw_mem.h
 ./agent_read_config.lo: mibgroup/hardware/fsys/hw_fsys.h
-./agent_read_config.lo: mibgroup/hardware/cpu/cpu.h
-./agent_read_config.lo: mibgroup/hardware/cpu/cpu_linux.h
-./agent_read_config.lo: mibgroup/if-mib/ifTable/ifTable.h
-./agent_read_config.lo: ../include/net-snmp/data_access/interface.h
-./agent_read_config.lo: mibgroup/if-mib/ifTable/ifTable_constants.h
-./agent_read_config.lo: mibgroup/if-mib/ifTable/ifTable_interface.h
-./agent_read_config.lo: mibgroup/if-mib/ifTable/ifTable.h
-./agent_read_config.lo: mibgroup/if-mib/ifTable/ifTable_data_access.h
 ./agent_read_config.lo: mibgroup/if-mib/ifXTable/ifXTable.h
-./agent_read_config.lo: ../agent/mibgroup/if-mib/ifTable/ifTable.h
 ./agent_read_config.lo: mibgroup/if-mib/ifXTable/ifXTable_constants.h
 ./agent_read_config.lo: mibgroup/if-mib/ifXTable/ifXTable_interface.h
 ./agent_read_config.lo: mibgroup/if-mib/ifXTable/ifXTable.h
 ./agent_read_config.lo: mibgroup/if-mib/ifXTable/ifXTable_data_access.h
 ./agent_read_config.lo: mibgroup/ip-mib/ipAddressTable/ipAddressTable.h
-./agent_read_config.lo: ../include/net-snmp/data_access/ipaddress.h
 ./agent_read_config.lo: mibgroup/ip-mib/ipAddressTable/ipAddressTable_constants.h
 ./agent_read_config.lo: mibgroup/ip-mib/ipAddressTable/ipAddressTable_interface.h
 ./agent_read_config.lo: mibgroup/ip-mib/ipAddressTable/ipAddressTable.h
@@ -469,12 +562,6 @@
 ./agent_read_config.lo: mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable.h
 ./agent_read_config.lo: mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_data_access.h
 ./agent_read_config.lo: mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_data_get.h
-./agent_read_config.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable.h
-./agent_read_config.lo: ../include/net-snmp/data_access/arp.h
-./agent_read_config.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_constants.h
-./agent_read_config.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_interface.h
-./agent_read_config.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable.h
-./agent_read_config.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_data_access.h
 ./agent_read_config.lo: mibgroup/ip-mib/ipSystemStatsTable/ipSystemStatsTable.h
 ./agent_read_config.lo: ../include/net-snmp/data_access/ipstats.h
 ./agent_read_config.lo: ../include/net-snmp/data_access/systemstats.h
@@ -496,35 +583,6 @@
 ./agent_read_config.lo: mibgroup/ip-mib/ipIfStatsTable/ipIfStatsTable.h
 ./agent_read_config.lo: mibgroup/ip-mib/ipIfStatsTable/ipIfStatsTable_data_access.h
 ./agent_read_config.lo: mibgroup/ip-mib/ipIfStatsTable/ipIfStatsTable_data_get.h
-./agent_read_config.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable.h
-./agent_read_config.lo: ../include/net-snmp/data_access/route.h
-./agent_read_config.lo: ../agent/mibgroup/mibII/route_headers.h
-./agent_read_config.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_constants.h
-./agent_read_config.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_interface.h
-./agent_read_config.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable.h
-./agent_read_config.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_data_access.h
-./agent_read_config.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable.h
-./agent_read_config.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_constants.h
-./agent_read_config.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_interface.h
-./agent_read_config.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable.h
-./agent_read_config.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_data_access.h
-./agent_read_config.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable.h
-./agent_read_config.lo: ../include/net-snmp/data_access/tcpConn.h
-./agent_read_config.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_constants.h
-./agent_read_config.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_interface.h
-./agent_read_config.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable.h
-./agent_read_config.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_data_access.h
-./agent_read_config.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable.h
-./agent_read_config.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_constants.h
-./agent_read_config.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_interface.h
-./agent_read_config.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable.h
-./agent_read_config.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_data_access.h
-./agent_read_config.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable.h
-./agent_read_config.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_constants.h
-./agent_read_config.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_interface.h
-./agent_read_config.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable.h
-./agent_read_config.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_data_access.h
-./agent_read_config.lo: mibgroup/if-mib/data_access/interface.h
 ./agent_read_config.lo: ../agent/mibgroup/agent_module_dot_conf.h
 ./agent_read_config.lo: ../agent/mibgroup/mib_module_dot_conf.h
 ./agent_registry.lo: ../include/net-snmp/net-snmp-config.h
@@ -556,7 +614,9 @@
 ./agent_registry.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./agent_registry.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agent_registry.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agent_registry.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agent_registry.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./agent_registry.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agent_registry.lo: ../include/net-snmp/library/ucd_compat.h
 ./agent_registry.lo: ../include/net-snmp/library/mib.h
 ./agent_registry.lo: ../include/net-snmp/mib_api.h
@@ -596,8 +656,8 @@
 ./agent_registry.lo: ../include/net-snmp/library/lcd_time.h
 ./agent_registry.lo: ../include/net-snmp/library/snmp_secmod.h
 ./agent_registry.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./agent_registry.lo: ../include/net-snmp/library/snmptsm.h
 ./agent_registry.lo: ../include/net-snmp/library/snmpusm.h
+./agent_registry.lo: ../include/net-snmp/library/snmptsm.h
 ./agent_registry.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agent_registry.lo: ../include/net-snmp/agent/mib_module_config.h
 ./agent_registry.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -668,7 +728,9 @@
 ./agent_sysORTable.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./agent_sysORTable.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agent_sysORTable.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agent_sysORTable.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agent_sysORTable.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./agent_sysORTable.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agent_sysORTable.lo: ../include/net-snmp/library/ucd_compat.h
 ./agent_sysORTable.lo: ../include/net-snmp/library/mib.h
 ./agent_sysORTable.lo: ../include/net-snmp/mib_api.h
@@ -709,8 +771,8 @@
 ./agent_sysORTable.lo: ../include/net-snmp/library/lcd_time.h
 ./agent_sysORTable.lo: ../include/net-snmp/library/snmp_secmod.h
 ./agent_sysORTable.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./agent_sysORTable.lo: ../include/net-snmp/library/snmptsm.h
 ./agent_sysORTable.lo: ../include/net-snmp/library/snmpusm.h
+./agent_sysORTable.lo: ../include/net-snmp/library/snmptsm.h
 ./agent_sysORTable.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agent_sysORTable.lo: ../include/net-snmp/agent/mib_module_config.h
 ./agent_sysORTable.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -779,7 +841,9 @@
 ./agent_trap.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./agent_trap.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agent_trap.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agent_trap.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agent_trap.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./agent_trap.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agent_trap.lo: ../include/net-snmp/library/ucd_compat.h
 ./agent_trap.lo: ../include/net-snmp/library/mib.h
 ./agent_trap.lo: ../include/net-snmp/mib_api.h
@@ -819,8 +883,8 @@
 ./agent_trap.lo: ../include/net-snmp/library/lcd_time.h
 ./agent_trap.lo: ../include/net-snmp/library/snmp_secmod.h
 ./agent_trap.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./agent_trap.lo: ../include/net-snmp/library/snmptsm.h
 ./agent_trap.lo: ../include/net-snmp/library/snmpusm.h
+./agent_trap.lo: ../include/net-snmp/library/snmptsm.h
 ./agent_trap.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agent_trap.lo: ../include/net-snmp/agent/mib_module_config.h
 ./agent_trap.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -889,7 +953,9 @@
 ./kernel.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./kernel.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./kernel.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./kernel.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./kernel.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./kernel.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./kernel.lo: ../include/net-snmp/library/ucd_compat.h
 ./kernel.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./kernel.lo: ../include/net-snmp/library/parse.h
@@ -928,8 +994,8 @@
 ./kernel.lo: ../include/net-snmp/library/lcd_time.h
 ./kernel.lo: ../include/net-snmp/library/snmp_secmod.h
 ./kernel.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./kernel.lo: ../include/net-snmp/library/snmptsm.h
-./kernel.lo: ../include/net-snmp/library/snmpusm.h kernel.h
+./kernel.lo: ../include/net-snmp/library/snmpusm.h
+./kernel.lo: ../include/net-snmp/library/snmptsm.h kernel.h
 ./kernel.lo: ../include/net-snmp/agent/ds_agent.h
 ./mib_modules.lo: ../include/net-snmp/agent/mib_module_config.h
 ./mib_modules.lo: ../include/net-snmp/net-snmp-config.h
@@ -960,7 +1026,9 @@
 ./mib_modules.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./mib_modules.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mib_modules.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mib_modules.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mib_modules.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./mib_modules.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mib_modules.lo: ../include/net-snmp/library/ucd_compat.h
 ./mib_modules.lo: ../include/net-snmp/library/mib.h
 ./mib_modules.lo: ../include/net-snmp/mib_api.h
@@ -1001,8 +1069,8 @@
 ./mib_modules.lo: ../include/net-snmp/library/lcd_time.h
 ./mib_modules.lo: ../include/net-snmp/library/snmp_secmod.h
 ./mib_modules.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./mib_modules.lo: ../include/net-snmp/library/snmptsm.h
 ./mib_modules.lo: ../include/net-snmp/library/snmpusm.h
+./mib_modules.lo: ../include/net-snmp/library/snmptsm.h
 ./mib_modules.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mib_modules.lo: ../include/net-snmp/agent/agent_module_config.h
 ./mib_modules.lo: ../include/net-snmp/agent/snmp_agent.h
@@ -1042,13 +1110,66 @@
 ./mib_modules.lo: ../include/net-snmp/data_access/interface.h
 ./mib_modules.lo: mibgroup/struct.h ../include/net-snmp/agent/mib_modules.h
 ./mib_modules.lo: ../agent/mibgroup/mib_module_includes.h
-./mib_modules.lo: mibgroup/examples/example.h mibgroup/testhandler.h
-./mib_modules.lo: mibgroup/Rmon/rows.h mibgroup/Rmon/agutil.h
-./mib_modules.lo: mibgroup/Rmon/statistics.h mibgroup/Rmon/alarmTable.h
-./mib_modules.lo: mibgroup/Rmon/history.h mibgroup/Rmon/event.h
-./mib_modules.lo: mibgroup/examples/scalar_int.h mibgroup/examples/watched.h
+./mib_modules.lo: mibgroup/Rmon/alarm.h mibgroup/agent/extend.h
 ./mib_modules.lo: mibgroup/examples/data_set.h
 ./mib_modules.lo: mibgroup/examples/delayed_instance.h
+./mib_modules.lo: mibgroup/examples/example.h
+./mib_modules.lo: mibgroup/examples/netSnmpHostsTable.h
+./mib_modules.lo: mibgroup/examples/netSnmpHostsTable_columns.h
+./mib_modules.lo: mibgroup/examples/netSnmpHostsTable_enums.h
+./mib_modules.lo: mibgroup/examples/notification.h
+./mib_modules.lo: mibgroup/examples/scalar_int.h
+./mib_modules.lo: mibgroup/examples/ucdDemoPublic.h
+./mib_modules.lo: mibgroup/examples/watched.h mibgroup/mibII/mta_sendmail.h
+./mib_modules.lo: mibgroup/misc/ipfwacc.h mibgroup/testhandler.h
+./mib_modules.lo: mibgroup/ucd-snmp/diskio.h mibgroup/ucd-snmp/extensible.h
+./mib_modules.lo: ../agent/mibgroup/mibdefs.h mibgroup/Rmon/rows.h
+./mib_modules.lo: mibgroup/Rmon/agutil.h mibgroup/Rmon/statistics.h
+./mib_modules.lo: mibgroup/Rmon/alarmTable.h mibgroup/Rmon/history.h
+./mib_modules.lo: mibgroup/Rmon/event.h mibgroup/disman/event/mteScalars.h
+./mib_modules.lo: mibgroup/disman/event/mteTrigger.h
+./mib_modules.lo: mibgroup/disman/event/mteTriggerTable.h
+./mib_modules.lo: mibgroup/disman/event/mteTriggerDeltaTable.h
+./mib_modules.lo: mibgroup/disman/event/mteTriggerExistenceTable.h
+./mib_modules.lo: mibgroup/disman/event/mteTriggerBooleanTable.h
+./mib_modules.lo: mibgroup/disman/event/mteTriggerThresholdTable.h
+./mib_modules.lo: mibgroup/disman/event/mteTriggerConf.h
+./mib_modules.lo: mibgroup/disman/event/mteEvent.h
+./mib_modules.lo: ../agent/mibgroup/disman/event/mteTrigger.h
+./mib_modules.lo: mibgroup/disman/event/mteEventTable.h
+./mib_modules.lo: mibgroup/disman/event/mteEventSetTable.h
+./mib_modules.lo: mibgroup/disman/event/mteEventNotificationTable.h
+./mib_modules.lo: mibgroup/disman/event/mteEventConf.h
+./mib_modules.lo: mibgroup/disman/event/mteObjects.h
+./mib_modules.lo: mibgroup/disman/event/mteObjectsTable.h
+./mib_modules.lo: mibgroup/disman/event/mteObjectsConf.h
+./mib_modules.lo: mibgroup/disman/expr/expScalars.h
+./mib_modules.lo: mibgroup/disman/expr/expExpression.h
+./mib_modules.lo: ../agent/mibgroup/disman/expr/exp_enum.h
+./mib_modules.lo: mibgroup/disman/expr/expExpressionTable.h
+./mib_modules.lo: mibgroup/disman/expr/expErrorTable.h
+./mib_modules.lo: mibgroup/disman/expr/expExpressionConf.h
+./mib_modules.lo: mibgroup/disman/expr/expObject.h
+./mib_modules.lo: ../agent/mibgroup/disman/expr/expExpression.h
+./mib_modules.lo: mibgroup/disman/expr/expObjectTable.h
+./mib_modules.lo: mibgroup/disman/expr/expObjectConf.h
+./mib_modules.lo: mibgroup/disman/expr/expValue.h
+./mib_modules.lo: mibgroup/disman/expr/expValueTable.h
+./mib_modules.lo: mibgroup/disman/nslookup/lookupCtlTable.h
+./mib_modules.lo: mibgroup/disman/nslookup/lookupResultsTable.h
+./mib_modules.lo: mibgroup/disman/ping/pingCtlTable.h
+./mib_modules.lo: mibgroup/disman/ping/pingResultsTable.h
+./mib_modules.lo: mibgroup/disman/ping/pingProbeHistoryTable.h
+./mib_modules.lo: mibgroup/disman/schedule/schedCore.h
+./mib_modules.lo: mibgroup/disman/schedule/schedConf.h
+./mib_modules.lo: mibgroup/disman/schedule/schedTable.h
+./mib_modules.lo: mibgroup/disman/traceroute/traceRouteCtlTable.h
+./mib_modules.lo: mibgroup/disman/traceroute/traceRouteResultsTable.h
+./mib_modules.lo: mibgroup/disman/traceroute/traceRouteProbeHistoryTable.h
+./mib_modules.lo: mibgroup/disman/traceroute/traceRouteHopsTable.h
+./mib_modules.lo: mibgroup/hardware/cpu/cpu.h
+./mib_modules.lo: mibgroup/hardware/cpu/cpu_linux.h
+./mib_modules.lo: mibgroup/hardware/memory/hw_mem.h
 ./mib_modules.lo: mibgroup/host/hrh_storage.h mibgroup/host/hrh_filesys.h
 ./mib_modules.lo: mibgroup/host/hrSWInstalledTable.h
 ./mib_modules.lo: mibgroup/host/hrSWRunTable.h mibgroup/host/hr_system.h
@@ -1056,7 +1177,31 @@
 ./mib_modules.lo: mibgroup/host/hr_proc.h mibgroup/host/hr_network.h
 ./mib_modules.lo: mibgroup/host/hr_print.h mibgroup/host/hr_disk.h
 ./mib_modules.lo: mibgroup/host/hr_partition.h
+./mib_modules.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable.h
+./mib_modules.lo: ../include/net-snmp/data_access/arp.h
+./mib_modules.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_constants.h
+./mib_modules.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_interface.h
+./mib_modules.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable.h
+./mib_modules.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_data_access.h
+./mib_modules.lo: mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable.h
+./mib_modules.lo: ../agent/mibgroup/if-mib/ifTable/ifTable.h
+./mib_modules.lo: ../agent/mibgroup/if-mib/ifTable/ifTable_constants.h
+./mib_modules.lo: ../agent/mibgroup/if-mib/ifTable/ifTable_interface.h
+./mib_modules.lo: ../agent/mibgroup/if-mib/ifTable/ifTable.h
+./mib_modules.lo: ../agent/mibgroup/if-mib/ifTable/ifTable_data_access.h
+./mib_modules.lo: mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable_constants.h
+./mib_modules.lo: mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable_interface.h
+./mib_modules.lo: mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable.h
+./mib_modules.lo: mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable_data_access.h
+./mib_modules.lo: mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable.h
+./mib_modules.lo: mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable_constants.h
+./mib_modules.lo: mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable_interface.h
+./mib_modules.lo: mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable.h
+./mib_modules.lo: mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable_data_access.h
+./mib_modules.lo: mibgroup/notification/snmpNotifyTable.h
+./mib_modules.lo: mibgroup/notification/snmpNotifyTable_data.h
 ./mib_modules.lo: mibgroup/tsm-mib/snmpTsmConfigurationUsePrefix.h
+./mib_modules.lo: mibgroup/tunnel/tunnel.h mibgroup/ucd-snmp/pass.h
 ./mib_modules.lo: mibgroup/snmpv3/snmpEngine.h mibgroup/snmpv3/snmpMPDStats.h
 ./mib_modules.lo: mibgroup/snmpv3/usmStats.h mibgroup/snmpv3/usmUser.h
 ./mib_modules.lo: mibgroup/mibII/system_mib.h mibgroup/mibII/sysORTable.h
@@ -1064,18 +1209,15 @@
 ./mib_modules.lo: mibgroup/mibII/setSerialNo.h mibgroup/mibII/at.h
 ./mib_modules.lo: mibgroup/mibII/ip.h mibgroup/mibII/var_route.h
 ./mib_modules.lo: mibgroup/mibII/route_write.h mibgroup/mibII/at.h
-./mib_modules.lo: mibgroup/mibII/tcp.h mibgroup/mibII/icmp.h
-./mib_modules.lo: mibgroup/mibII/udp.h mibgroup/mibII/ipv6.h
-./mib_modules.lo: mibgroup/ucd-snmp/disk_hw.h ../agent/mibgroup/mibdefs.h
-./mib_modules.lo: mibgroup/ucd-snmp/proc.h mibgroup/ucd-snmp/versioninfo.h
-./mib_modules.lo: mibgroup/ucd-snmp/pass.h mibgroup/ucd-snmp/pass_persist.h
-./mib_modules.lo: mibgroup/ucd-snmp/loadave.h mibgroup/agent/extend.h
-./mib_modules.lo: mibgroup/ucd-snmp/errormib.h mibgroup/ucd-snmp/file.h
-./mib_modules.lo: mibgroup/ucd-snmp/dlmod.h mibgroup/ucd-snmp/proxy.h
-./mib_modules.lo: mibgroup/ucd-snmp/logmatch.h mibgroup/ucd-snmp/memory.h
-./mib_modules.lo: mibgroup/ucd-snmp/vmstat.h
-./mib_modules.lo: mibgroup/notification/snmpNotifyTable.h
-./mib_modules.lo: mibgroup/notification/snmpNotifyTable_data.h
+./mib_modules.lo: mibgroup/mibII/tcp.h mibgroup/mibII/udp.h
+./mib_modules.lo: mibgroup/mibII/ipv6.h mibgroup/mibII/icmp.h
+./mib_modules.lo: mibgroup/ucd-snmp/disk_hw.h mibgroup/ucd-snmp/proc.h
+./mib_modules.lo: mibgroup/ucd-snmp/versioninfo.h
+./mib_modules.lo: mibgroup/ucd-snmp/pass_persist.h
+./mib_modules.lo: mibgroup/ucd-snmp/loadave.h mibgroup/ucd-snmp/errormib.h
+./mib_modules.lo: mibgroup/ucd-snmp/file.h mibgroup/ucd-snmp/dlmod.h
+./mib_modules.lo: mibgroup/ucd-snmp/proxy.h mibgroup/ucd-snmp/logmatch.h
+./mib_modules.lo: mibgroup/ucd-snmp/memory.h mibgroup/ucd-snmp/vmstat.h
 ./mib_modules.lo: mibgroup/notification/snmpNotifyFilterProfileTable.h
 ./mib_modules.lo: mibgroup/notification/snmpNotifyFilterProfileTable_data.h
 ./mib_modules.lo: mibgroup/notification-log-mib/notification_log.h
@@ -1088,38 +1230,24 @@
 ./mib_modules.lo: mibgroup/agent/nsModuleTable.h mibgroup/agent/nsDebug.h
 ./mib_modules.lo: mibgroup/agent/nsCache.h mibgroup/agent/nsLogging.h
 ./mib_modules.lo: mibgroup/agent/nsVacmAccessTable.h
-./mib_modules.lo: mibgroup/disman/event/mteScalars.h
-./mib_modules.lo: mibgroup/disman/event/mteTrigger.h
-./mib_modules.lo: mibgroup/disman/event/mteTriggerTable.h
-./mib_modules.lo: mibgroup/disman/event/mteTriggerDeltaTable.h
-./mib_modules.lo: mibgroup/disman/event/mteTriggerExistenceTable.h
-./mib_modules.lo: mibgroup/disman/event/mteTriggerBooleanTable.h
-./mib_modules.lo: mibgroup/disman/event/mteTriggerThresholdTable.h
-./mib_modules.lo: mibgroup/disman/event/mteTriggerConf.h
-./mib_modules.lo: mibgroup/disman/event/mteEvent.h
-./mib_modules.lo: ../agent/mibgroup/disman/event/mteTrigger.h
-./mib_modules.lo: mibgroup/disman/event/mteEventTable.h
-./mib_modules.lo: mibgroup/disman/event/mteEventSetTable.h
-./mib_modules.lo: mibgroup/disman/event/mteEventNotificationTable.h
-./mib_modules.lo: mibgroup/disman/event/mteEventConf.h
-./mib_modules.lo: mibgroup/disman/event/mteObjects.h
-./mib_modules.lo: mibgroup/disman/event/mteObjectsTable.h
-./mib_modules.lo: mibgroup/disman/event/mteObjectsConf.h
-./mib_modules.lo: mibgroup/disman/schedule/schedCore.h
-./mib_modules.lo: mibgroup/disman/schedule/schedConf.h
-./mib_modules.lo: mibgroup/disman/schedule/schedTable.h
 ./mib_modules.lo: mibgroup/utilities/override.h
 ./mib_modules.lo: mibgroup/host/data_access/swinst.h
 ./mib_modules.lo: mibgroup/host/data_access/swrun.h
 ./mib_modules.lo: mibgroup/host/hrSWRunPerfTable.h
-./mib_modules.lo: mibgroup/tlstm-mib/snmpTlstmSession/snmpTlstmSession.h
-./mib_modules.lo: mibgroup/tlstm-mib/snmpTlstmAddrTable/snmpTlstmAddrTable.h
-./mib_modules.lo: mibgroup/tlstm-mib/snmpTlstmCertToTSNTable/snmpTlstmCertToTSNTable.h
-./mib_modules.lo: mibgroup/tlstm-mib/snmpTlstmParamsTable/snmpTlstmParamsTable.h
-./mib_modules.lo: mibgroup/tsm-mib/snmpTsmStats/snmpTsmStats.h
-./mib_modules.lo: mibgroup/mibII/vacm_context.h mibgroup/mibII/var_route.h
-./mib_modules.lo: mibgroup/mibII/tcpTable.h mibgroup/mibII/udpTable.h
-./mib_modules.lo: mibgroup/ip-mib/ip_scalars.h
+./mib_modules.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable.h
+./mib_modules.lo: ../include/net-snmp/data_access/route.h
+./mib_modules.lo: ../agent/mibgroup/mibII/route_headers.h
+./mib_modules.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_constants.h
+./mib_modules.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_interface.h
+./mib_modules.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable.h
+./mib_modules.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_data_access.h
+./mib_modules.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable.h
+./mib_modules.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_constants.h
+./mib_modules.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_interface.h
+./mib_modules.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable.h
+./mib_modules.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_data_access.h
+./mib_modules.lo: mibgroup/if-mib/data_access/interface.h
+./mib_modules.lo: mibgroup/if-mib/ifTable/ifTable.h
 ./mib_modules.lo: mibgroup/notification/snmpNotifyTable_data.h
 ./mib_modules.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_storage.h
 ./mib_modules.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable.h
@@ -1128,26 +1256,50 @@
 ./mib_modules.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_interface.h
 ./mib_modules.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable.h
 ./mib_modules.lo: mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_access.h
+./mib_modules.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable.h
+./mib_modules.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_oids.h
+./mib_modules.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_enums.h
+./mib_modules.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_interface.h
+./mib_modules.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable.h
+./mib_modules.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_data_access.h
+./mib_modules.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_data_get.h
+./mib_modules.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_data_set.h
+./mib_modules.lo: mibgroup/snmp-usm-dh-objects-mib/usmDHParameters/usmDHParameters.h
+./mib_modules.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable.h
+./mib_modules.lo: ../include/net-snmp/data_access/tcpConn.h
+./mib_modules.lo: ../include/net-snmp/data_access/ipaddress.h
+./mib_modules.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_constants.h
+./mib_modules.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_interface.h
+./mib_modules.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable.h
+./mib_modules.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_data_access.h
+./mib_modules.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable.h
+./mib_modules.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_constants.h
+./mib_modules.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_interface.h
+./mib_modules.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable.h
+./mib_modules.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_data_access.h
+./mib_modules.lo: mibgroup/tlstm-mib/snmpTlstmSession/snmpTlstmSession.h
+./mib_modules.lo: mibgroup/tlstm-mib/snmpTlstmAddrTable/snmpTlstmAddrTable.h
+./mib_modules.lo: mibgroup/tlstm-mib/snmpTlstmCertToTSNTable/snmpTlstmCertToTSNTable.h
+./mib_modules.lo: mibgroup/tlstm-mib/snmpTlstmParamsTable/snmpTlstmParamsTable.h
+./mib_modules.lo: mibgroup/tsm-mib/snmpTsmStats/snmpTsmStats.h
+./mib_modules.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable.h
+./mib_modules.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_constants.h
+./mib_modules.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_interface.h
+./mib_modules.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable.h
+./mib_modules.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_data_access.h
+./mib_modules.lo: mibgroup/mibII/vacm_context.h mibgroup/mibII/var_route.h
+./mib_modules.lo: mibgroup/mibII/tcpTable.h mibgroup/mibII/udpTable.h
+./mib_modules.lo: mibgroup/ip-mib/ip_scalars.h
 ./mib_modules.lo: mibgroup/notification/snmpNotifyFilterProfileTable_data.h
 ./mib_modules.lo: mibgroup/target/snmpTargetAddrEntry_data.h
 ./mib_modules.lo: mibgroup/target/snmpTargetParamsEntry_data.h
-./mib_modules.lo: mibgroup/hardware/memory/hw_mem.h
 ./mib_modules.lo: mibgroup/hardware/fsys/hw_fsys.h
-./mib_modules.lo: mibgroup/hardware/cpu/cpu.h
-./mib_modules.lo: mibgroup/hardware/cpu/cpu_linux.h
-./mib_modules.lo: mibgroup/if-mib/ifTable/ifTable.h
-./mib_modules.lo: mibgroup/if-mib/ifTable/ifTable_constants.h
-./mib_modules.lo: mibgroup/if-mib/ifTable/ifTable_interface.h
-./mib_modules.lo: mibgroup/if-mib/ifTable/ifTable.h
-./mib_modules.lo: mibgroup/if-mib/ifTable/ifTable_data_access.h
 ./mib_modules.lo: mibgroup/if-mib/ifXTable/ifXTable.h
-./mib_modules.lo: ../agent/mibgroup/if-mib/ifTable/ifTable.h
 ./mib_modules.lo: mibgroup/if-mib/ifXTable/ifXTable_constants.h
 ./mib_modules.lo: mibgroup/if-mib/ifXTable/ifXTable_interface.h
 ./mib_modules.lo: mibgroup/if-mib/ifXTable/ifXTable.h
 ./mib_modules.lo: mibgroup/if-mib/ifXTable/ifXTable_data_access.h
 ./mib_modules.lo: mibgroup/ip-mib/ipAddressTable/ipAddressTable.h
-./mib_modules.lo: ../include/net-snmp/data_access/ipaddress.h
 ./mib_modules.lo: mibgroup/ip-mib/ipAddressTable/ipAddressTable_constants.h
 ./mib_modules.lo: mibgroup/ip-mib/ipAddressTable/ipAddressTable_interface.h
 ./mib_modules.lo: mibgroup/ip-mib/ipAddressTable/ipAddressTable.h
@@ -1165,12 +1317,6 @@
 ./mib_modules.lo: mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable.h
 ./mib_modules.lo: mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_data_access.h
 ./mib_modules.lo: mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_data_get.h
-./mib_modules.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable.h
-./mib_modules.lo: ../include/net-snmp/data_access/arp.h
-./mib_modules.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_constants.h
-./mib_modules.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_interface.h
-./mib_modules.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable.h
-./mib_modules.lo: mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_data_access.h
 ./mib_modules.lo: mibgroup/ip-mib/ipSystemStatsTable/ipSystemStatsTable.h
 ./mib_modules.lo: ../include/net-snmp/data_access/ipstats.h
 ./mib_modules.lo: ../include/net-snmp/data_access/systemstats.h
@@ -1192,35 +1338,6 @@
 ./mib_modules.lo: mibgroup/ip-mib/ipIfStatsTable/ipIfStatsTable.h
 ./mib_modules.lo: mibgroup/ip-mib/ipIfStatsTable/ipIfStatsTable_data_access.h
 ./mib_modules.lo: mibgroup/ip-mib/ipIfStatsTable/ipIfStatsTable_data_get.h
-./mib_modules.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable.h
-./mib_modules.lo: ../include/net-snmp/data_access/route.h
-./mib_modules.lo: ../agent/mibgroup/mibII/route_headers.h
-./mib_modules.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_constants.h
-./mib_modules.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_interface.h
-./mib_modules.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable.h
-./mib_modules.lo: mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_data_access.h
-./mib_modules.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable.h
-./mib_modules.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_constants.h
-./mib_modules.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_interface.h
-./mib_modules.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable.h
-./mib_modules.lo: mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_data_access.h
-./mib_modules.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable.h
-./mib_modules.lo: ../include/net-snmp/data_access/tcpConn.h
-./mib_modules.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_constants.h
-./mib_modules.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_interface.h
-./mib_modules.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable.h
-./mib_modules.lo: mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_data_access.h
-./mib_modules.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable.h
-./mib_modules.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_constants.h
-./mib_modules.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_interface.h
-./mib_modules.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable.h
-./mib_modules.lo: mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_data_access.h
-./mib_modules.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable.h
-./mib_modules.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_constants.h
-./mib_modules.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_interface.h
-./mib_modules.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable.h
-./mib_modules.lo: mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_data_access.h
-./mib_modules.lo: mibgroup/if-mib/data_access/interface.h
 ./mib_modules.lo: ../agent/mibgroup/mib_module_shutdown.h
 ./mib_modules.lo: ../agent/mibgroup/mib_module_inits.h
 ./netsnmp_close_fds.lo: ../include/net-snmp/net-snmp-config.h
@@ -1253,7 +1370,9 @@
 ./object_monitor.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./object_monitor.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./object_monitor.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./object_monitor.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./object_monitor.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./object_monitor.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./object_monitor.lo: ../include/net-snmp/library/ucd_compat.h
 ./object_monitor.lo: ../include/net-snmp/library/mib.h
 ./object_monitor.lo: ../include/net-snmp/mib_api.h
@@ -1294,8 +1413,8 @@
 ./object_monitor.lo: ../include/net-snmp/library/lcd_time.h
 ./object_monitor.lo: ../include/net-snmp/library/snmp_secmod.h
 ./object_monitor.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./object_monitor.lo: ../include/net-snmp/library/snmptsm.h
 ./object_monitor.lo: ../include/net-snmp/library/snmpusm.h
+./object_monitor.lo: ../include/net-snmp/library/snmptsm.h
 ./object_monitor.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./object_monitor.lo: ../include/net-snmp/agent/mib_module_config.h
 ./object_monitor.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -1363,7 +1482,9 @@
 ./snmp_agent.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_agent.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_agent.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_agent.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_agent.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_agent.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_agent.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_agent.lo: ../include/net-snmp/library/mib.h
 ./snmp_agent.lo: ../include/net-snmp/mib_api.h
@@ -1403,8 +1524,8 @@
 ./snmp_agent.lo: ../include/net-snmp/library/lcd_time.h
 ./snmp_agent.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmp_agent.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmp_agent.lo: ../include/net-snmp/library/snmptsm.h
 ./snmp_agent.lo: ../include/net-snmp/library/snmpusm.h
+./snmp_agent.lo: ../include/net-snmp/library/snmptsm.h
 ./snmp_agent.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./snmp_agent.lo: ../include/net-snmp/agent/mib_module_config.h
 ./snmp_agent.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -1475,7 +1596,9 @@
 ./snmp_perl.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_perl.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_perl.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_perl.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_perl.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_perl.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_perl.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_perl.lo: ../include/net-snmp/library/mib.h
 ./snmp_perl.lo: ../include/net-snmp/mib_api.h
@@ -1516,8 +1639,8 @@
 ./snmp_perl.lo: ../include/net-snmp/library/lcd_time.h
 ./snmp_perl.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmp_perl.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmp_perl.lo: ../include/net-snmp/library/snmptsm.h
 ./snmp_perl.lo: ../include/net-snmp/library/snmpusm.h
+./snmp_perl.lo: ../include/net-snmp/library/snmptsm.h
 ./snmp_perl.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./snmp_perl.lo: ../include/net-snmp/agent/mib_module_config.h
 ./snmp_perl.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -1557,8 +1680,8 @@
 ./snmp_perl.lo: ../include/net-snmp/agent/snmp_get_statistic.h snmp_perl.h
 ./snmp_vars.lo: ../include/net-snmp/net-snmp-config.h
 ./snmp_vars.lo: ../include/net-snmp/net-snmp-includes.h
-./snmp_vars.lo: ../include/net-snmp/definitions.h ../include/net-snmp/types.h
-./snmp_vars.lo: ../include/net-snmp/library/oid.h
+./snmp_vars.lo: ../include/net-snmp/definitions.h
+./snmp_vars.lo: ../include/net-snmp/types.h ../include/net-snmp/library/oid.h
 ./snmp_vars.lo: ../include/net-snmp/library/types.h
 ./snmp_vars.lo: ../include/net-snmp/library/snmp_api.h
 ./snmp_vars.lo: ../include/net-snmp/varbind_api.h
@@ -1582,7 +1705,9 @@
 ./snmp_vars.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_vars.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_vars.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_vars.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_vars.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_vars.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_vars.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_vars.lo: ../include/net-snmp/library/mib.h
 ./snmp_vars.lo: ../include/net-snmp/mib_api.h
@@ -1623,8 +1748,8 @@
 ./snmp_vars.lo: ../include/net-snmp/library/lcd_time.h
 ./snmp_vars.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmp_vars.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmp_vars.lo: ../include/net-snmp/library/snmptsm.h
 ./snmp_vars.lo: ../include/net-snmp/library/snmpusm.h
+./snmp_vars.lo: ../include/net-snmp/library/snmptsm.h
 ./snmp_vars.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./snmp_vars.lo: ../include/net-snmp/agent/mib_module_config.h
 ./snmp_vars.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -1698,7 +1823,9 @@
 ./snmpd.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpd.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpd.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpd.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpd.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpd.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpd.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpd.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./snmpd.lo: ../include/net-snmp/library/parse.h
@@ -1737,8 +1864,8 @@
 ./snmpd.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpd.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpd.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpd.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpd.lo: ../include/net-snmp/library/snmpusm.h
+./snmpd.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpd.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./snmpd.lo: ../include/net-snmp/agent/mib_module_config.h
 ./snmpd.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -1779,7 +1906,7 @@
 ./snmpd.lo: agent_global_vars.h ../include/net-snmp/library/large_fd_set.h
 ./snmpd.lo: m2m.h snmpd.h ../include/net-snmp/agent/mib_modules.h
 ./snmpd.lo: ../include/net-snmp/agent/netsnmp_close_fds.h
-./snmpd.lo: mibgroup/util_funcs/restart.h
+./snmpd.lo: ../snmplib/snmp_syslog.h mibgroup/util_funcs/restart.h
 ./snmpd.lo: ../include/net-snmp/library/sd-daemon.h mibgroup/smux/smux.h
 ./helpers/all_helpers.lo: ../include/net-snmp/net-snmp-config.h
 ./helpers/all_helpers.lo: ../include/net-snmp/net-snmp-features.h
@@ -1810,7 +1937,9 @@
 ./helpers/all_helpers.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/all_helpers.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/all_helpers.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/all_helpers.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/all_helpers.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/all_helpers.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/all_helpers.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/all_helpers.lo: ../include/net-snmp/library/mib.h
 ./helpers/all_helpers.lo: ../include/net-snmp/mib_api.h
@@ -1850,8 +1979,8 @@
 ./helpers/all_helpers.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/all_helpers.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/all_helpers.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/all_helpers.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/all_helpers.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/all_helpers.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/all_helpers.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/all_helpers.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/all_helpers.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -1919,7 +2048,9 @@
 ./helpers/baby_steps.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/baby_steps.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/baby_steps.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/baby_steps.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/baby_steps.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/baby_steps.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/baby_steps.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/baby_steps.lo: ../include/net-snmp/library/mib.h
 ./helpers/baby_steps.lo: ../include/net-snmp/mib_api.h
@@ -1959,8 +2090,8 @@
 ./helpers/baby_steps.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/baby_steps.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/baby_steps.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/baby_steps.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/baby_steps.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/baby_steps.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/baby_steps.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/baby_steps.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/baby_steps.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -2026,7 +2157,9 @@
 ./helpers/bulk_to_next.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/bulk_to_next.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/bulk_to_next.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/bulk_to_next.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/bulk_to_next.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/bulk_to_next.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/bulk_to_next.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/bulk_to_next.lo: ../include/net-snmp/library/mib.h
 ./helpers/bulk_to_next.lo: ../include/net-snmp/mib_api.h
@@ -2067,8 +2200,8 @@
 ./helpers/bulk_to_next.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/bulk_to_next.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/bulk_to_next.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/bulk_to_next.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/bulk_to_next.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/bulk_to_next.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/bulk_to_next.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/bulk_to_next.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/bulk_to_next.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -2135,7 +2268,9 @@
 ./helpers/cache_handler.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/cache_handler.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/cache_handler.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/cache_handler.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/cache_handler.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/cache_handler.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/cache_handler.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/cache_handler.lo: ../include/net-snmp/library/mib.h
 ./helpers/cache_handler.lo: ../include/net-snmp/mib_api.h
@@ -2175,8 +2310,8 @@
 ./helpers/cache_handler.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/cache_handler.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/cache_handler.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/cache_handler.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/cache_handler.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/cache_handler.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/cache_handler.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/cache_handler.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/cache_handler.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -2242,7 +2377,9 @@
 ./helpers/debug_handler.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/debug_handler.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/debug_handler.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/debug_handler.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/debug_handler.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/debug_handler.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/debug_handler.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/debug_handler.lo: ../include/net-snmp/library/mib.h
 ./helpers/debug_handler.lo: ../include/net-snmp/mib_api.h
@@ -2283,8 +2420,8 @@
 ./helpers/debug_handler.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/debug_handler.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/debug_handler.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/debug_handler.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/debug_handler.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/debug_handler.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/debug_handler.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/debug_handler.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/debug_handler.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -2351,7 +2488,9 @@
 ./helpers/instance.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/instance.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/instance.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/instance.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/instance.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/instance.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/instance.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/instance.lo: ../include/net-snmp/library/mib.h
 ./helpers/instance.lo: ../include/net-snmp/mib_api.h
@@ -2391,8 +2530,8 @@
 ./helpers/instance.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/instance.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/instance.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/instance.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/instance.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/instance.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/instance.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/instance.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/instance.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -2459,7 +2598,9 @@
 ./helpers/mode_end_call.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/mode_end_call.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/mode_end_call.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/mode_end_call.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/mode_end_call.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/mode_end_call.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/mode_end_call.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/mode_end_call.lo: ../include/net-snmp/library/mib.h
 ./helpers/mode_end_call.lo: ../include/net-snmp/mib_api.h
@@ -2499,8 +2640,8 @@
 ./helpers/mode_end_call.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/mode_end_call.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/mode_end_call.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/mode_end_call.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/mode_end_call.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/mode_end_call.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/mode_end_call.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/mode_end_call.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/mode_end_call.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -2566,7 +2707,9 @@
 ./helpers/multiplexer.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/multiplexer.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/multiplexer.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/multiplexer.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/multiplexer.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/multiplexer.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/multiplexer.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/multiplexer.lo: ../include/net-snmp/library/mib.h
 ./helpers/multiplexer.lo: ../include/net-snmp/mib_api.h
@@ -2607,8 +2750,8 @@
 ./helpers/multiplexer.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/multiplexer.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/multiplexer.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/multiplexer.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/multiplexer.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/multiplexer.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/multiplexer.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/multiplexer.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/multiplexer.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -2674,7 +2817,9 @@
 ./helpers/null.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/null.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/null.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/null.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/null.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/null.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/null.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/null.lo: ../include/net-snmp/library/mib.h
 ./helpers/null.lo: ../include/net-snmp/mib_api.h
@@ -2715,8 +2860,8 @@
 ./helpers/null.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/null.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/null.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/null.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/null.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/null.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/null.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/null.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/null.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -2782,7 +2927,9 @@
 ./helpers/old_api.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/old_api.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/old_api.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/old_api.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/old_api.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/old_api.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/old_api.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/old_api.lo: ../include/net-snmp/library/mib.h
 ./helpers/old_api.lo: ../include/net-snmp/mib_api.h
@@ -2823,8 +2970,8 @@
 ./helpers/old_api.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/old_api.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/old_api.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/old_api.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/old_api.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/old_api.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/old_api.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/old_api.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/old_api.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -2891,7 +3038,9 @@
 ./helpers/read_only.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/read_only.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/read_only.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/read_only.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/read_only.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/read_only.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/read_only.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/read_only.lo: ../include/net-snmp/library/mib.h
 ./helpers/read_only.lo: ../include/net-snmp/mib_api.h
@@ -2932,8 +3081,8 @@
 ./helpers/read_only.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/read_only.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/read_only.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/read_only.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/read_only.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/read_only.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/read_only.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/read_only.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/read_only.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -3000,7 +3149,9 @@
 ./helpers/row_merge.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/row_merge.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/row_merge.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/row_merge.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/row_merge.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/row_merge.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/row_merge.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/row_merge.lo: ../include/net-snmp/library/mib.h
 ./helpers/row_merge.lo: ../include/net-snmp/mib_api.h
@@ -3040,8 +3191,8 @@
 ./helpers/row_merge.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/row_merge.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/row_merge.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/row_merge.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/row_merge.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/row_merge.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/row_merge.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/row_merge.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/row_merge.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -3107,7 +3258,9 @@
 ./helpers/scalar.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/scalar.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/scalar.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/scalar.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/scalar.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/scalar.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/scalar.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/scalar.lo: ../include/net-snmp/library/mib.h
 ./helpers/scalar.lo: ../include/net-snmp/mib_api.h
@@ -3148,8 +3301,8 @@
 ./helpers/scalar.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/scalar.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/scalar.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/scalar.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/scalar.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/scalar.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/scalar.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/scalar.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/scalar.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -3215,7 +3368,9 @@
 ./helpers/scalar_group.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/scalar_group.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/scalar_group.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/scalar_group.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/scalar_group.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/scalar_group.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/scalar_group.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/scalar_group.lo: ../include/net-snmp/library/mib.h
 ./helpers/scalar_group.lo: ../include/net-snmp/mib_api.h
@@ -3256,8 +3411,8 @@
 ./helpers/scalar_group.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/scalar_group.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/scalar_group.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/scalar_group.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/scalar_group.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/scalar_group.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/scalar_group.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/scalar_group.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/scalar_group.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -3323,7 +3478,9 @@
 ./helpers/serialize.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/serialize.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/serialize.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/serialize.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/serialize.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/serialize.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/serialize.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/serialize.lo: ../include/net-snmp/library/mib.h
 ./helpers/serialize.lo: ../include/net-snmp/mib_api.h
@@ -3364,8 +3521,8 @@
 ./helpers/serialize.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/serialize.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/serialize.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/serialize.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/serialize.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/serialize.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/serialize.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/serialize.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/serialize.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -3432,7 +3589,9 @@
 ./helpers/snmp_get_statistic.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/snmp_get_statistic.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/snmp_get_statistic.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/snmp_get_statistic.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/snmp_get_statistic.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/snmp_get_statistic.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/snmp_get_statistic.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/snmp_get_statistic.lo: ../include/net-snmp/library/mib.h
 ./helpers/snmp_get_statistic.lo: ../include/net-snmp/mib_api.h
@@ -3472,8 +3631,8 @@
 ./helpers/snmp_get_statistic.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/snmp_get_statistic.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/snmp_get_statistic.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/snmp_get_statistic.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/snmp_get_statistic.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/snmp_get_statistic.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/snmp_get_statistic.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/snmp_get_statistic.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/snmp_get_statistic.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -3540,7 +3699,9 @@
 ./helpers/stash_cache.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/stash_cache.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/stash_cache.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/stash_cache.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/stash_cache.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/stash_cache.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/stash_cache.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/stash_cache.lo: ../include/net-snmp/library/mib.h
 ./helpers/stash_cache.lo: ../include/net-snmp/mib_api.h
@@ -3580,8 +3741,8 @@
 ./helpers/stash_cache.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/stash_cache.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/stash_cache.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/stash_cache.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/stash_cache.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/stash_cache.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/stash_cache.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/stash_cache.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/stash_cache.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -3650,7 +3811,9 @@
 ./helpers/stash_to_next.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/stash_to_next.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/stash_to_next.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/stash_to_next.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/stash_to_next.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/stash_to_next.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/stash_to_next.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/stash_to_next.lo: ../include/net-snmp/library/mib.h
 ./helpers/stash_to_next.lo: ../include/net-snmp/mib_api.h
@@ -3690,8 +3853,8 @@
 ./helpers/stash_to_next.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/stash_to_next.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/stash_to_next.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/stash_to_next.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/stash_to_next.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/stash_to_next.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/stash_to_next.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/stash_to_next.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/stash_to_next.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -3760,7 +3923,9 @@
 ./helpers/table.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/table.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/table.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/table.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/table.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/table.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/table.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/table.lo: ../include/net-snmp/library/mib.h
 ./helpers/table.lo: ../include/net-snmp/mib_api.h
@@ -3800,8 +3965,8 @@
 ./helpers/table.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/table.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/table.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/table.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/table.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/table.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/table.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -3868,7 +4033,9 @@
 ./helpers/table_array.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/table_array.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/table_array.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/table_array.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/table_array.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/table_array.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/table_array.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/table_array.lo: ../include/net-snmp/library/mib.h
 ./helpers/table_array.lo: ../include/net-snmp/mib_api.h
@@ -3908,8 +4075,8 @@
 ./helpers/table_array.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/table_array.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/table_array.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/table_array.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table_array.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/table_array.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table_array.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/table_array.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/table_array.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -3976,7 +4143,9 @@
 ./helpers/table_container.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/table_container.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/table_container.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/table_container.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/table_container.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/table_container.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/table_container.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/table_container.lo: ../include/net-snmp/library/mib.h
 ./helpers/table_container.lo: ../include/net-snmp/mib_api.h
@@ -4016,8 +4185,8 @@
 ./helpers/table_container.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/table_container.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/table_container.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/table_container.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table_container.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/table_container.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table_container.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/table_container.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/table_container.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -4084,7 +4253,9 @@
 ./helpers/table_data.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/table_data.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/table_data.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/table_data.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/table_data.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/table_data.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/table_data.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/table_data.lo: ../include/net-snmp/library/mib.h
 ./helpers/table_data.lo: ../include/net-snmp/mib_api.h
@@ -4124,8 +4295,8 @@
 ./helpers/table_data.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/table_data.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/table_data.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/table_data.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table_data.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/table_data.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table_data.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/table_data.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/table_data.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -4192,7 +4363,9 @@
 ./helpers/table_dataset.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/table_dataset.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/table_dataset.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/table_dataset.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/table_dataset.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/table_dataset.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/table_dataset.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/table_dataset.lo: ../include/net-snmp/library/mib.h
 ./helpers/table_dataset.lo: ../include/net-snmp/mib_api.h
@@ -4232,8 +4405,8 @@
 ./helpers/table_dataset.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/table_dataset.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/table_dataset.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/table_dataset.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table_dataset.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/table_dataset.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table_dataset.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/table_dataset.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/table_dataset.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -4300,7 +4473,9 @@
 ./helpers/table_iterator.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/table_iterator.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/table_iterator.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/table_iterator.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/table_iterator.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/table_iterator.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/table_iterator.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/table_iterator.lo: ../include/net-snmp/library/mib.h
 ./helpers/table_iterator.lo: ../include/net-snmp/mib_api.h
@@ -4340,8 +4515,8 @@
 ./helpers/table_iterator.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/table_iterator.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/table_iterator.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/table_iterator.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table_iterator.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/table_iterator.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table_iterator.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/table_iterator.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/table_iterator.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -4409,7 +4584,9 @@
 ./helpers/table_row.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/table_row.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/table_row.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/table_row.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/table_row.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/table_row.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/table_row.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/table_row.lo: ../include/net-snmp/library/mib.h
 ./helpers/table_row.lo: ../include/net-snmp/mib_api.h
@@ -4449,8 +4626,8 @@
 ./helpers/table_row.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/table_row.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/table_row.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/table_row.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table_row.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/table_row.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table_row.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/table_row.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/table_row.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -4517,7 +4694,9 @@
 ./helpers/table_tdata.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/table_tdata.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/table_tdata.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/table_tdata.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/table_tdata.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/table_tdata.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/table_tdata.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/table_tdata.lo: ../include/net-snmp/library/mib.h
 ./helpers/table_tdata.lo: ../include/net-snmp/mib_api.h
@@ -4557,8 +4736,8 @@
 ./helpers/table_tdata.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/table_tdata.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/table_tdata.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/table_tdata.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table_tdata.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/table_tdata.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/table_tdata.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/table_tdata.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/table_tdata.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -4625,7 +4804,9 @@
 ./helpers/watcher.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./helpers/watcher.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./helpers/watcher.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./helpers/watcher.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./helpers/watcher.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./helpers/watcher.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./helpers/watcher.lo: ../include/net-snmp/library/ucd_compat.h
 ./helpers/watcher.lo: ../include/net-snmp/library/mib.h
 ./helpers/watcher.lo: ../include/net-snmp/mib_api.h
@@ -4665,8 +4846,8 @@
 ./helpers/watcher.lo: ../include/net-snmp/library/lcd_time.h
 ./helpers/watcher.lo: ../include/net-snmp/library/snmp_secmod.h
 ./helpers/watcher.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./helpers/watcher.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/watcher.lo: ../include/net-snmp/library/snmpusm.h
+./helpers/watcher.lo: ../include/net-snmp/library/snmptsm.h
 ./helpers/watcher.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./helpers/watcher.lo: ../include/net-snmp/agent/mib_module_config.h
 ./helpers/watcher.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -4732,7 +4913,9 @@
 ./mibgroup/header_complex.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./mibgroup/header_complex.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibgroup/header_complex.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibgroup/header_complex.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibgroup/header_complex.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./mibgroup/header_complex.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibgroup/header_complex.lo: ../include/net-snmp/library/ucd_compat.h
 ./mibgroup/header_complex.lo: ../include/net-snmp/library/mib.h
 ./mibgroup/header_complex.lo: ../include/net-snmp/mib_api.h
@@ -4773,8 +4956,8 @@
 ./mibgroup/header_complex.lo: ../include/net-snmp/library/lcd_time.h
 ./mibgroup/header_complex.lo: ../include/net-snmp/library/snmp_secmod.h
 ./mibgroup/header_complex.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./mibgroup/header_complex.lo: ../include/net-snmp/library/snmptsm.h
 ./mibgroup/header_complex.lo: ../include/net-snmp/library/snmpusm.h
+./mibgroup/header_complex.lo: ../include/net-snmp/library/snmptsm.h
 ./mibgroup/header_complex.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibgroup/header_complex.lo: ../include/net-snmp/agent/mib_module_config.h
 ./mibgroup/header_complex.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -4843,7 +5026,9 @@
 ./mibgroup/testhandler.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./mibgroup/testhandler.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibgroup/testhandler.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibgroup/testhandler.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibgroup/testhandler.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./mibgroup/testhandler.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibgroup/testhandler.lo: ../include/net-snmp/library/ucd_compat.h
 ./mibgroup/testhandler.lo: ../include/net-snmp/library/mib.h
 ./mibgroup/testhandler.lo: ../include/net-snmp/mib_api.h
@@ -4883,8 +5068,8 @@
 ./mibgroup/testhandler.lo: ../include/net-snmp/library/lcd_time.h
 ./mibgroup/testhandler.lo: ../include/net-snmp/library/snmp_secmod.h
 ./mibgroup/testhandler.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./mibgroup/testhandler.lo: ../include/net-snmp/library/snmptsm.h
 ./mibgroup/testhandler.lo: ../include/net-snmp/library/snmpusm.h
+./mibgroup/testhandler.lo: ../include/net-snmp/library/snmptsm.h
 ./mibgroup/testhandler.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibgroup/testhandler.lo: ../include/net-snmp/agent/mib_module_config.h
 ./mibgroup/testhandler.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -4952,7 +5137,9 @@
 ./mibgroup/util_funcs.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./mibgroup/util_funcs.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibgroup/util_funcs.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibgroup/util_funcs.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibgroup/util_funcs.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./mibgroup/util_funcs.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibgroup/util_funcs.lo: ../include/net-snmp/library/ucd_compat.h
 ./mibgroup/util_funcs.lo: ../include/net-snmp/library/mib.h
 ./mibgroup/util_funcs.lo: ../include/net-snmp/mib_api.h
@@ -4992,8 +5179,8 @@
 ./mibgroup/util_funcs.lo: ../include/net-snmp/library/lcd_time.h
 ./mibgroup/util_funcs.lo: ../include/net-snmp/library/snmp_secmod.h
 ./mibgroup/util_funcs.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./mibgroup/util_funcs.lo: ../include/net-snmp/library/snmptsm.h
 ./mibgroup/util_funcs.lo: ../include/net-snmp/library/snmpusm.h
+./mibgroup/util_funcs.lo: ../include/net-snmp/library/snmptsm.h
 ./mibgroup/util_funcs.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibgroup/util_funcs.lo: ../include/net-snmp/agent/mib_module_config.h
 ./mibgroup/util_funcs.lo: ../include/net-snmp/agent/agent_module_config.h
diff -urpN net-snmp-5.8/agent/Makefile.in net-snmp-5.9.1/agent/Makefile.in
--- net-snmp-5.8/agent/Makefile.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/Makefile.in	2021-05-26 05:19:35.000000000 +0700
@@ -300,11 +300,11 @@ snmpd$(EXEEXT):	${LAGENTOBJS} $(USELIBS)
 	$(LINK) $(CFLAGS) -o $@ ${LAGENTOBJS} ${LDFLAGS} ${OUR_AGENT_LIBS}
 
 libnetsnmpagent.$(LIB_EXTENSION)$(LIB_VERSION):    ${LLIBAGENTOBJS} $(USELIBS)
-	$(LIB_LD_CMD) $(AGENTLIB) ${LLIBAGENTOBJS} $(USELIBS) ${LAGENTLIBS} @LD_NO_UNDEFINED@ $(LDFLAGS) $(PERLLDOPTS_FOR_LIBS) $(LIB_LD_LIBS) @AGENTLIBS@
+	$(LIB_LD_CMD) $(AGENTLIB) ${LLIBAGENTOBJS} $(USELIBS) ${LAGENTLIBS} @LD_NO_UNDEFINED@ $(LDFLAGS) $(PERLLDOPTS_FOR_LIBS) @AGENTLIBS@
 	$(RANLIB) $(AGENTLIB)
 
-libnetsnmpmibs.$(LIB_EXTENSION)$(LIB_VERSION): ${LMIBOBJS} $(AGENTLIB) $(USELIBS)
-	$(LIB_LD_CMD) $(MIBLIB) ${LMIBOBJS} $(AGENTLIB) $(USELIBS) @LD_NO_UNDEFINED@ $(LDFLAGS) ${LMIBLIBS} $(PERLLDOPTS_FOR_LIBS) $(LIB_LD_LIBS) @AGENTLIBS@
+libnetsnmpmibs.$(LIB_EXTENSION)$(LIB_VERSION): ${LMIBOBJS} $(AGENTLIB) $(USELIBS) subdirs
+	$(LIB_LD_CMD) $(MIBLIB) ${LMIBOBJS} $(AGENTLIB) $(USELIBS) @LD_NO_UNDEFINED@ $(LDFLAGS) ${LMIBLIBS} $(PERLLDOPTS_FOR_LIBS) @AGENTLIBS@
 	$(RANLIB) $(MIBLIB)
 
 agentlib: $(AGENTLIB)
diff -urpN net-snmp-5.8/agent/agent_handler.c net-snmp-5.9.1/agent/agent_handler.c
--- net-snmp-5.8/agent/agent_handler.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/agent_handler.c	2021-05-26 05:19:35.000000000 +0700
@@ -27,9 +27,9 @@
 
 #include <net-snmp/agent/bulk_to_next.h>
 
-netsnmp_feature_child_of(agent_handler, libnetsnmpagent)
+netsnmp_feature_child_of(agent_handler, libnetsnmpagent);
 
-netsnmp_feature_child_of(handler_mark_requests_as_delegated, agent_handler)
+netsnmp_feature_child_of(handler_mark_requests_as_delegated, agent_handler);
 
 static netsnmp_mib_handler *_clone_handler(netsnmp_mib_handler *it);
 
@@ -667,7 +667,7 @@ netsnmp_call_next_handler(netsnmp_mib_ha
  *
  *  @return Returns SNMPERR_SUCCESS or SNMP_ERR_* error code.
  */
-netsnmp_feature_child_of(netsnmp_call_next_handler_one_request,netsnmp_unused)
+netsnmp_feature_child_of(netsnmp_call_next_handler_one_request,netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_NETSNMP_CALL_NEXT_HANDLER_ONE_REQUEST
 NETSNMP_INLINE int
 netsnmp_call_next_handler_one_request(netsnmp_mib_handler *current,
@@ -806,56 +806,51 @@ netsnmp_handler_registration_dup(netsnmp
 {
     netsnmp_handler_registration *r = NULL;
 
-    if (reginfo == NULL) {
+    if (reginfo == NULL)
         return NULL;
-    }
-
-
-    r = (netsnmp_handler_registration *) calloc(1,
-                                                sizeof
-                                                (netsnmp_handler_registration));
-
-    if (r != NULL) {
-        r->modes = reginfo->modes;
-        r->priority = reginfo->priority;
-        r->range_subid = reginfo->range_subid;
-        r->timeout = reginfo->timeout;
-        r->range_ubound = reginfo->range_ubound;
-        r->rootoid_len = reginfo->rootoid_len;
-
-        if (reginfo->handlerName != NULL) {
-            r->handlerName = strdup(reginfo->handlerName);
-            if (r->handlerName == NULL) {
-                netsnmp_handler_registration_free(r);
-                return NULL;
-            }
-        }
 
-        if (reginfo->contextName != NULL) {
-            r->contextName = strdup(reginfo->contextName);
-            if (r->contextName == NULL) {
-                netsnmp_handler_registration_free(r);
-                return NULL;
-            }
-        }
+    r = calloc(1, sizeof(netsnmp_handler_registration));
+    if (!r)
+        return r;
+    r->modes = reginfo->modes;
+    r->priority = reginfo->priority;
+    r->range_subid = reginfo->range_subid;
+    r->timeout = reginfo->timeout;
+    r->range_ubound = reginfo->range_ubound;
+    r->rootoid_len = reginfo->rootoid_len;
+
+    if (reginfo->handlerName != NULL) {
+        r->handlerName = strdup(reginfo->handlerName);
+        if (r->handlerName == NULL)
+            goto err;
+    }
 
-        if (reginfo->rootoid != NULL) {
-            r->rootoid =
-                snmp_duplicate_objid(reginfo->rootoid, reginfo->rootoid_len);
-            if (r->rootoid == NULL) {
-                netsnmp_handler_registration_free(r);
-                return NULL;
-            }
-        }
+    if (reginfo->contextName != NULL) {
+        r->contextName = strdup(reginfo->contextName);
+        if (r->contextName == NULL)
+            goto err;
+    }
 
-        r->handler = netsnmp_handler_dup(reginfo->handler);
-        if (r->handler == NULL) {
-            netsnmp_handler_registration_free(r);
-            return NULL;
-        }
-        return r;
+    if (reginfo->rootoid != NULL) {
+        /*
+         * + 1 to make the following code safe:
+         * reginfo->rootoid[reginfo->rootoid_len++] = 0;
+         * See also netsnmp_scalar_helper_handler().
+         */
+        r->rootoid = malloc((reginfo->rootoid_len + 1) * sizeof(oid));
+        if (r->rootoid == NULL)
+            goto err;
+        memcpy(r->rootoid, reginfo->rootoid,
+               reginfo->rootoid_len * sizeof(oid));
     }
 
+    r->handler = netsnmp_handler_dup(reginfo->handler);
+    if (r->handler == NULL)
+        goto err;
+    return r;
+
+err:
+    netsnmp_handler_registration_free(r);
     return NULL;
 }
 
diff -urpN net-snmp-5.8/agent/agent_index.c net-snmp-5.9.1/agent/agent_index.c
--- net-snmp-5.8/agent/agent_index.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/agent_index.c	2021-05-26 05:19:35.000000000 +0700
@@ -49,9 +49,9 @@
 #include "agentx/client.h"
 #endif
 
-netsnmp_feature_child_of(agent_index_all, libnetsnmpagent)
+netsnmp_feature_child_of(agent_index_all, libnetsnmpagent);
 
-netsnmp_feature_child_of(remove_index, agent_index_all)
+netsnmp_feature_child_of(remove_index, agent_index_all);
 
         /*
          * Initial support for index allocation
@@ -454,7 +454,7 @@ register_index(netsnmp_variable_list * v
          * Release an allocated index,
          *   to allow it to be used elsewhere
          */
-netsnmp_feature_child_of(release_index,netsnmp_unused)
+netsnmp_feature_child_of(release_index,netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_RELEASE_INDEX
 int
 release_index(netsnmp_variable_list * varbind)
@@ -597,7 +597,7 @@ unregister_index(netsnmp_variable_list *
     return SNMP_ERR_NOERROR;
 }
 
-netsnmp_feature_child_of(unregister_indexes,netsnmp_unused)
+netsnmp_feature_child_of(unregister_indexes,netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_UNREGISTER_INDEXES
 int
 unregister_string_index(oid * name, size_t name_len, char *cp)
@@ -704,7 +704,7 @@ dump_idx_registry(void)
     }
 }
 
-netsnmp_feature_child_of(count_indexes, netsnmp_unused)
+netsnmp_feature_child_of(count_indexes, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_UNUSED
 unsigned long
 count_indexes(oid * name, size_t namelen, int include_unallocated)
diff -urpN net-snmp-5.8/agent/agent_read_config.c net-snmp-5.9.1/agent/agent_read_config.c
--- net-snmp-5.8/agent/agent_read_config.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/agent_read_config.c	2021-05-26 05:19:35.000000000 +0700
@@ -112,13 +112,38 @@
 #include "agent_module_includes.h"
 #include "mib_module_includes.h"
 
-netsnmp_feature_child_of(agent_read_config_all, libnetsnmpagent)
+netsnmp_feature_child_of(agent_read_config_all, libnetsnmpagent);
 
-netsnmp_feature_child_of(snmpd_unregister_config_handler, agent_read_config_all)
+netsnmp_feature_child_of(snmpd_unregister_config_handler, agent_read_config_all);
+
+void netsnmp_set_agent_user_id(int uid)
+{
+    static int agent_user_id = -1;
+
+    if (agent_user_id != -1 && uid != agent_user_id) {
+        snmp_log(LOG_ERR, "User ID has already been set -- can not change\n");
+        return;
+    }
+    agent_user_id = uid;
+    netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID, NETSNMP_DS_AGENT_USERID, uid);
+}
+
+void netsnmp_set_agent_group_id(int gid)
+{
+    static int agent_group_id = -1;
+
+    if (agent_group_id != -1 && gid != agent_group_id) {
+        snmp_log(LOG_ERR, "Group ID has already been set -- can not change\n");
+        return;
+    }
+    agent_group_id = gid;
+    netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID, NETSNMP_DS_AGENT_GROUPID,
+                       gid);
+}
 
 #ifdef HAVE_UNISTD_H
 void
-snmpd_set_agent_user(const char *token, char *cptr)
+netsnmp_parse_agent_user(const char *token, char *cptr)
 {
     if (cptr[0] == '#') {
         char           *ecp;
@@ -128,8 +153,7 @@ snmpd_set_agent_user(const char *token,
         if (*ecp != 0) {
             config_perror("Bad number");
 	} else {
-	    netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID, 
-			       NETSNMP_DS_AGENT_USERID, uid);
+            netsnmp_set_agent_user_id(uid);
 	}
 #if defined(HAVE_GETPWNAM) && defined(HAVE_PWD_H)
     } else {
@@ -137,8 +161,7 @@ snmpd_set_agent_user(const char *token,
 
         info = getpwnam(cptr);
         if (info)
-            netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID, 
-                               NETSNMP_DS_AGENT_USERID, info->pw_uid);
+            netsnmp_set_agent_user_id(info->pw_uid);
         else
             config_perror("User not found in passwd database");
         endpwent();
@@ -147,7 +170,7 @@ snmpd_set_agent_user(const char *token,
 }
 
 void
-snmpd_set_agent_group(const char *token, char *cptr)
+netsnmp_parse_agent_group(const char *token, char *cptr)
 {
     if (cptr[0] == '#') {
         char           *ecp;
@@ -156,8 +179,7 @@ snmpd_set_agent_group(const char *token,
         if (*ecp != 0) {
             config_perror("Bad number");
 	} else {
-            netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID, 
-			       NETSNMP_DS_AGENT_GROUPID, gid);
+            netsnmp_set_agent_group_id(gid);
 	}
 #if defined(HAVE_GETGRNAM) && defined(HAVE_GRP_H)
     } else {
@@ -165,8 +187,7 @@ snmpd_set_agent_group(const char *token,
 
         info = getgrnam(cptr);
         if (info)
-            netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID, 
-                               NETSNMP_DS_AGENT_GROUPID, info->gr_gid);
+            netsnmp_set_agent_group_id(info->gr_gid);
         else
             config_perror("Group not found in group database");
         endgrent();
@@ -256,9 +277,9 @@ init_agent_read_config(const char *app)
                                NETSNMP_DS_AGENT_TRAP_ADDR);
 #ifdef HAVE_UNISTD_H
     register_app_config_handler("agentuser",
-                                snmpd_set_agent_user, NULL, "userid");
+                                netsnmp_parse_agent_user, NULL, "userid");
     register_app_config_handler("agentgroup",
-                                snmpd_set_agent_group, NULL, "groupid");
+                                netsnmp_parse_agent_group, NULL, "groupid");
 #endif
 #ifndef NETSNMP_NO_LISTEN_SUPPORT
     register_app_config_handler("agentaddress",
@@ -333,7 +354,7 @@ snmpd_register_const_config_handler(cons
 }
 
 #ifdef NETSNMP_FEATURE_REQUIRE_SNMPD_UNREGISTER_CONFIG_HANDLER
-netsnmp_feature_require(unregister_app_config_handler)
+netsnmp_feature_require(unregister_app_config_handler);
 #endif /* NETSNMP_FEATURE_REQUIRE_SNMPD_UNREGISTER_CONFIG_HANDLER */
 
 #ifndef NETSNMP_FEATURE_REMOVE_SNMPD_UNREGISTER_CONFIG_HANDLER
diff -urpN net-snmp-5.8/agent/agent_registry.c net-snmp-5.9.1/agent/agent_registry.c
--- net-snmp-5.8/agent/agent_registry.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/agent_registry.c	2021-05-26 05:19:35.000000000 +0700
@@ -73,9 +73,9 @@
 #include "agentx/client.h"
 #endif
 
-netsnmp_feature_child_of(agent_registry_all, libnetsnmpagent)
+netsnmp_feature_child_of(agent_registry_all, libnetsnmpagent);
 
-netsnmp_feature_child_of(unregister_mib_table_row, agent_registry_all)
+netsnmp_feature_child_of(unregister_mib_table_row, agent_registry_all);
 
 /** @defgroup agent_lookup_cache Lookup cache, storing the registered OIDs.
  *     Maintain the cache used for locating sub-trees and OIDs.
@@ -561,7 +561,7 @@ netsnmp_subtree_change_prev(netsnmp_subt
                                &ptr->oid_off);
 }
 
-netsnmp_feature_child_of(netsnmp_subtree_compare,netsnmp_unused)
+netsnmp_feature_child_of(netsnmp_subtree_compare,netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_NETSNMP_SUBTREE_COMPARE
 /** Compares OIDs of given subtrees.
  *
@@ -1278,7 +1278,6 @@ netsnmp_register_mib(const char *moduleN
         reg_parms.range_ubound = range_ubound;
         reg_parms.timeout = timeout;
         reg_parms.flags = (u_char) flags;
-        reg_parms.contextName = context;
         reg_parms.session = ss;
         reg_parms.reginfo = reginfo;
         reg_parms.contextName = context;
@@ -2167,7 +2166,7 @@ netsnmp_acm_check_subtree(netsnmp_pdu *p
     return 1;
 }
 
-netsnmp_feature_child_of(get_session_for_oid,netsnmp_unused)
+netsnmp_feature_child_of(get_session_for_oid,netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_GET_SESSION_FOR_OID
 netsnmp_session *
 get_session_for_oid(const oid *name, size_t len, const char *context_name)
@@ -2334,7 +2333,7 @@ dump_registry(void)
 /* End of MIB registration code */
 
 
-netsnmp_feature_child_of(register_signal, netsnmp_unused)
+netsnmp_feature_child_of(register_signal, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_REGISTER_SIGNAL
 
 /** @defgroup agent_signals POSIX signals support for agents.
diff -urpN net-snmp-5.8/agent/agent_trap.c net-snmp-5.9.1/agent/agent_trap.c
--- net-snmp-5.8/agent/agent_trap.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/agent_trap.c	2021-05-26 05:19:35.000000000 +0700
@@ -75,13 +75,13 @@
 #include "mibgroup/notification/snmpNotifyTable_data.h"
 #endif
 
-netsnmp_feature_child_of(agent_trap_all, libnetsnmpagent)
+netsnmp_feature_child_of(agent_trap_all, libnetsnmpagent);
 
-netsnmp_feature_child_of(trap_vars_with_context, agent_trap_all)
-netsnmp_feature_child_of(remove_trap_session, agent_trap_all)
+netsnmp_feature_child_of(trap_vars_with_context, agent_trap_all);
+netsnmp_feature_child_of(remove_trap_session, agent_trap_all);
 
-netsnmp_feature_child_of(send_v3trap,netsnmp_unused)
-netsnmp_feature_child_of(send_trap_pdu,netsnmp_unused)
+netsnmp_feature_child_of(send_v3trap,netsnmp_unused);
+netsnmp_feature_child_of(send_trap_pdu,netsnmp_unused);
 
 struct trap_sink {
     netsnmp_session *sesp;
@@ -92,11 +92,6 @@ struct trap_sink {
 
 struct trap_sink *sinks = NULL;
 
-#ifndef NETSNMP_DISABLE_SNMPV1
-static int _v1_sessions = 0;
-#endif /* NETSNMP_DISABLE_SNMPV1 */
-static int _v2_sessions = 0;
-
 const oid       objid_enterprisetrap[] = { NETSNMP_NOTIFICATION_MIB };
 const oid       trap_version_id[] = { NETSNMP_SYSTEM_MIB };
 const int       enterprisetrap_len = OID_LENGTH(objid_enterprisetrap);
@@ -159,55 +154,6 @@ free_trap_session(struct trap_sink *sp)
     free(sp);
 }
 
-static void
-_trap_version_incr(int version)
-{
-    switch (version) {
-#ifndef NETSNMP_DISABLE_SNMPV1
-        case SNMP_VERSION_1:
-            ++_v1_sessions;
-            break;
-#endif
-#ifndef NETSNMP_DISABLE_SNMPV2C
-        case SNMP_VERSION_2c:
-#endif
-        case SNMP_VERSION_3:
-            ++_v2_sessions;
-            break;
-        default:
-            snmp_log(LOG_ERR, "unknown snmp version %d\n", version);
-    }
-    return;
-}
-
-static void
-_trap_version_decr(int version)
-{
-    switch (version) {
-#ifndef NETSNMP_DISABLE_SNMPV1
-        case SNMP_VERSION_1:
-            if (--_v1_sessions < 0) {
-                snmp_log(LOG_ERR,"v1 session count < 0! fixed.\n");
-                _v1_sessions = 0;
-            }
-            break;
-#endif
-#ifndef NETSNMP_DISABLE_SNMPV2C
-        case SNMP_VERSION_2c:
-#endif
-        case SNMP_VERSION_3:
-            if (--_v2_sessions < 0) {
-                snmp_log(LOG_ERR,"v2 session count < 0! fixed.\n");
-                _v2_sessions = 0;
-            }
-            break;
-        default:
-            snmp_log(LOG_ERR, "unknown snmp version %d\n", version);
-    }
-    return;
-}
-
-
 #ifndef NETSNMP_NO_TRAP_STATS
 static void
 _dump_trap_stats(netsnmp_session *sess)
@@ -285,8 +231,6 @@ netsnmp_add_notification_session(netsnmp
         sinks = new_sink;
     }
 
-    _trap_version_incr(version);
-
     return 1;
 }
 
@@ -338,7 +282,6 @@ remove_trap_session(netsnmp_session * ss
             } else {
                 sinks = sp->next;
             }
-            _trap_version_decr(ss->version);
             /*
              * I don't believe you *really* want to close the session here;
              * it may still be in use for other purposes.  In particular this
@@ -490,7 +433,6 @@ snmpd_free_trapsinks(void)
     DEBUGMSGTL(("trap", "freeing trap sessions\n"));
     while (sp) {
         sinks = sinks->next;
-        _trap_version_decr(sp->version);
         free_trap_session(sp);
         sp = sinks;
     }
@@ -1025,11 +967,11 @@ netsnmp_send_traps(int trap, int specifi
         }
     }
 #ifndef NETSNMP_DISABLE_SNMPV1
-    if (template_v1pdu && _v1_sessions)
+    if (template_v1pdu)
         snmp_call_callbacks(SNMP_CALLBACK_APPLICATION,
                         SNMPD_CALLBACK_SEND_TRAP1, template_v1pdu);
 #endif
-    if (template_v2pdu && _v2_sessions)
+    if (template_v2pdu)
         snmp_call_callbacks(SNMP_CALLBACK_APPLICATION,
                         SNMPD_CALLBACK_SEND_TRAP2, template_v2pdu);
     snmp_free_pdu(template_v1pdu);
@@ -1219,8 +1161,19 @@ send_trap_to_sess(netsnmp_session * sess
                     template_pdu->command, sess->version));
         return;
     }
-    DEBUGMSGTL(("trap", "sending trap type=%d, version=%ld\n",
-                template_pdu->command, sess->version));
+    DEBUGIF("trap") {
+        struct session_list *sessp = snmp_sess_pointer(sess);
+        netsnmp_transport *t = sessp->transport;
+        const void *dst = template_pdu->transport_data;
+        const int dst_len = template_pdu->transport_data_length;
+        char *peer = NULL;
+
+        if (t && t->f_fmtaddr)
+            peer = t->f_fmtaddr(t, dst, dst_len);
+        DEBUGMSGTL(("trap", "sending trap type=%d, version=%ld to %s\n",
+                    template_pdu->command, sess->version, peer ? peer : "(?)"));
+        free(peer);
+    }
 
 #ifndef NETSNMP_DISABLE_SNMPV1
     if (sess->version == SNMP_VERSION_1 &&
@@ -1603,8 +1556,7 @@ netsnmp_create_v3user_notification_sessi
         engineId = tmp_engineId;
     }
 
-    usmUser = usm_get_user(NETSNMP_REMOVE_CONST(u_char *,engineId),
-                           engineId_len, NETSNMP_REMOVE_CONST(char *,user));
+    usmUser = usm_get_user(engineId, engineId_len, user);
     if (NULL == usmUser) {
         DEBUGMSGTL(("trap:v3user_notif_sess", "usmUser %s not found\n", user));
         return NULL;
@@ -1701,7 +1653,7 @@ netsnmp_create_v3user_notification_sessi
                                          ss->version, notif_name, notif_tag,
                                          notif_profile) != 1) {
         DEBUGMSGTL(("trap:v3user_notif_sess", "add notification failed\n"));
-        snmp_sess_close(ss);
+        snmp_close(ss);
         ss = NULL;
         goto bail;
     }
@@ -1735,14 +1687,17 @@ snmpd_parse_config_trapsess(const char *
         if (strncmp(cp, "-profile", 8) == 0) {
             cp = skip_token(cp);
             cp = copy_nword(cp, tmp, SPRINT_MAX_LEN);
+            free(profile);
             profile = strdup(tmp);
         } else if (strncmp(cp, "-name", 5) == 0) {
             cp = skip_token(cp);
             cp = copy_nword(cp, tmp, SPRINT_MAX_LEN);
+            free(name);
             name = strdup(tmp);
-        } else if (strncmp(cp, "-tag", 5) == 0) {
+        } else if (strncmp(cp, "-tag", 4) == 0) {
             cp = skip_token(cp);
             cp = copy_nword(cp, tmp, SPRINT_MAX_LEN);
+            free(tag);
             tag = strdup(tmp);
         } else
             break;
@@ -1835,6 +1790,8 @@ snmpd_parse_config_trapsess(const char *
                                      ss->version, name, tag, profile);
 
   cleanup:
+    if (session.securityEngineIDLen > 0)
+        SNMP_FREE(session.securityEngineID);
     SNMP_FREE(clientaddr_save);
     SNMP_FREE(profile);
     SNMP_FREE(name);
diff -urpN net-snmp-5.8/agent/auto_nlist.c net-snmp-5.9.1/agent/auto_nlist.c
--- net-snmp-5.8/agent/auto_nlist.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/auto_nlist.c	2021-05-26 05:19:35.000000000 +0700
@@ -14,11 +14,10 @@
 #include <errno.h>
 #include <fcntl.h>
 #include <netinet/in.h>
-#ifdef HAVE_NLIST_H
-#include <nlist.h>
-#endif
 #if HAVE_KVM_H
 #include <kvm.h>
+#elif defined(HAVE_NLIST_H)
+#include <nlist.h>
 #endif
 
 #include <net-snmp/agent/auto_nlist.h>
@@ -52,9 +51,6 @@ auto_nlist_value(const char *string)
         }
     }
     if (*ptr == 0) {
-#if !(defined(aix4) || defined(aix5) || defined(aix6) || defined(aix7))
-        static char *n_name = NULL;
-#endif
         *ptr = (struct autonlist *) malloc(sizeof(struct autonlist));
         memset(*ptr, 0, sizeof(struct autonlist));
         it = *ptr;
@@ -72,17 +68,17 @@ auto_nlist_value(const char *string)
 #elif defined(freebsd9)
         sprintf(__DECONST(char*, it->nl[0].n_name), "_%s", string);
 #else
+        {
+            static char *name;
 
-        if (n_name != NULL)
-            free(n_name);
-
-        n_name = malloc(strlen(string) + 2);
-        if (n_name == NULL) {
-            snmp_log(LOG_ERR, "nlist err: failed to allocate memory");
-            return (-1);
+            free(name);
+	    name = NULL;
+	    if (asprintf(&name, "_%s", string) < 0) {
+                snmp_log(LOG_ERR, "nlist err: failed to allocate memory");
+                return -1;
+            }
+            it->nl[0].n_name = name;
         }
-        snprintf(n_name, strlen(string) + 2, "_%s", string);
-        it->nl[0].n_name = (const char*)n_name;
 #endif
         it->nl[1].n_name = 0;
         init_nlist(it->nl);
@@ -104,7 +100,7 @@ auto_nlist_value(const char *string)
                 return (-1);
             }
             strcpy(n_name2, string);
-            it->nl[0].n_name = (const char*)n_name2;
+            it->nl[0].n_name = n_name2;
 #endif
             init_nlist(it->nl);
         }
diff -urpN net-snmp-5.8/agent/helpers/Makefile.depend net-snmp-5.9.1/agent/helpers/Makefile.depend
--- net-snmp-5.8/agent/helpers/Makefile.depend	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/Makefile.depend	2021-05-26 05:19:35.000000000 +0700
@@ -1,6 +1,9 @@
 # DO NOT DELETE THIS LINE -- make depend depends on it.
 
 ./all_helpers.lo: ../../include/net-snmp/net-snmp-config.h
+./all_helpers.lo: ../../include/net-snmp/system/linux.h
+./all_helpers.lo: ../../include/net-snmp/system/sysv.h
+./all_helpers.lo: ../../include/net-snmp/system/generic.h
 ./all_helpers.lo: ../../include/net-snmp/machine/generic.h
 ./all_helpers.lo: ../../include/net-snmp/net-snmp-features.h
 ./all_helpers.lo: ../../include/net-snmp/net-snmp-includes.h
@@ -30,7 +33,9 @@
 ./all_helpers.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./all_helpers.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./all_helpers.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./all_helpers.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./all_helpers.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./all_helpers.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./all_helpers.lo: ../../include/net-snmp/library/ucd_compat.h
 ./all_helpers.lo: ../../include/net-snmp/library/mib.h
 ./all_helpers.lo: ../../include/net-snmp/mib_api.h
@@ -71,8 +76,8 @@
 ./all_helpers.lo: ../../include/net-snmp/library/lcd_time.h
 ./all_helpers.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./all_helpers.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./all_helpers.lo: ../../include/net-snmp/library/snmptsm.h
 ./all_helpers.lo: ../../include/net-snmp/library/snmpusm.h
+./all_helpers.lo: ../../include/net-snmp/library/snmptsm.h
 ./all_helpers.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./all_helpers.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./all_helpers.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -140,7 +145,9 @@
 ./baby_steps.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./baby_steps.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./baby_steps.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./baby_steps.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./baby_steps.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./baby_steps.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./baby_steps.lo: ../../include/net-snmp/library/ucd_compat.h
 ./baby_steps.lo: ../../include/net-snmp/library/mib.h
 ./baby_steps.lo: ../../include/net-snmp/mib_api.h
@@ -180,8 +187,8 @@
 ./baby_steps.lo: ../../include/net-snmp/library/lcd_time.h
 ./baby_steps.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./baby_steps.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./baby_steps.lo: ../../include/net-snmp/library/snmptsm.h
 ./baby_steps.lo: ../../include/net-snmp/library/snmpusm.h
+./baby_steps.lo: ../../include/net-snmp/library/snmptsm.h
 ./baby_steps.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./baby_steps.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./baby_steps.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -247,7 +254,9 @@
 ./bulk_to_next.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./bulk_to_next.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./bulk_to_next.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./bulk_to_next.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./bulk_to_next.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./bulk_to_next.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./bulk_to_next.lo: ../../include/net-snmp/library/ucd_compat.h
 ./bulk_to_next.lo: ../../include/net-snmp/library/mib.h
 ./bulk_to_next.lo: ../../include/net-snmp/mib_api.h
@@ -288,8 +297,8 @@
 ./bulk_to_next.lo: ../../include/net-snmp/library/lcd_time.h
 ./bulk_to_next.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./bulk_to_next.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./bulk_to_next.lo: ../../include/net-snmp/library/snmptsm.h
 ./bulk_to_next.lo: ../../include/net-snmp/library/snmpusm.h
+./bulk_to_next.lo: ../../include/net-snmp/library/snmptsm.h
 ./bulk_to_next.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./bulk_to_next.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./bulk_to_next.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -356,7 +365,9 @@
 ./cache_handler.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./cache_handler.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./cache_handler.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./cache_handler.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./cache_handler.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./cache_handler.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./cache_handler.lo: ../../include/net-snmp/library/ucd_compat.h
 ./cache_handler.lo: ../../include/net-snmp/library/mib.h
 ./cache_handler.lo: ../../include/net-snmp/mib_api.h
@@ -396,8 +407,8 @@
 ./cache_handler.lo: ../../include/net-snmp/library/lcd_time.h
 ./cache_handler.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./cache_handler.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./cache_handler.lo: ../../include/net-snmp/library/snmptsm.h
 ./cache_handler.lo: ../../include/net-snmp/library/snmpusm.h
+./cache_handler.lo: ../../include/net-snmp/library/snmptsm.h
 ./cache_handler.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./cache_handler.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./cache_handler.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -463,7 +474,9 @@
 ./debug_handler.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./debug_handler.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./debug_handler.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./debug_handler.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./debug_handler.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./debug_handler.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./debug_handler.lo: ../../include/net-snmp/library/ucd_compat.h
 ./debug_handler.lo: ../../include/net-snmp/library/mib.h
 ./debug_handler.lo: ../../include/net-snmp/mib_api.h
@@ -504,8 +517,8 @@
 ./debug_handler.lo: ../../include/net-snmp/library/lcd_time.h
 ./debug_handler.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./debug_handler.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./debug_handler.lo: ../../include/net-snmp/library/snmptsm.h
 ./debug_handler.lo: ../../include/net-snmp/library/snmpusm.h
+./debug_handler.lo: ../../include/net-snmp/library/snmptsm.h
 ./debug_handler.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./debug_handler.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./debug_handler.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -572,7 +585,9 @@
 ./instance.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./instance.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./instance.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./instance.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./instance.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./instance.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./instance.lo: ../../include/net-snmp/library/ucd_compat.h
 ./instance.lo: ../../include/net-snmp/library/mib.h
 ./instance.lo: ../../include/net-snmp/mib_api.h
@@ -612,8 +627,8 @@
 ./instance.lo: ../../include/net-snmp/library/lcd_time.h
 ./instance.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./instance.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./instance.lo: ../../include/net-snmp/library/snmptsm.h
 ./instance.lo: ../../include/net-snmp/library/snmpusm.h
+./instance.lo: ../../include/net-snmp/library/snmptsm.h
 ./instance.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./instance.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./instance.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -680,7 +695,9 @@
 ./mode_end_call.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mode_end_call.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mode_end_call.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mode_end_call.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mode_end_call.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mode_end_call.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mode_end_call.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mode_end_call.lo: ../../include/net-snmp/library/mib.h
 ./mode_end_call.lo: ../../include/net-snmp/mib_api.h
@@ -720,8 +737,8 @@
 ./mode_end_call.lo: ../../include/net-snmp/library/lcd_time.h
 ./mode_end_call.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mode_end_call.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mode_end_call.lo: ../../include/net-snmp/library/snmptsm.h
 ./mode_end_call.lo: ../../include/net-snmp/library/snmpusm.h
+./mode_end_call.lo: ../../include/net-snmp/library/snmptsm.h
 ./mode_end_call.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mode_end_call.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mode_end_call.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -787,7 +804,9 @@
 ./multiplexer.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./multiplexer.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./multiplexer.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./multiplexer.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./multiplexer.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./multiplexer.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./multiplexer.lo: ../../include/net-snmp/library/ucd_compat.h
 ./multiplexer.lo: ../../include/net-snmp/library/mib.h
 ./multiplexer.lo: ../../include/net-snmp/mib_api.h
@@ -828,8 +847,8 @@
 ./multiplexer.lo: ../../include/net-snmp/library/lcd_time.h
 ./multiplexer.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./multiplexer.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./multiplexer.lo: ../../include/net-snmp/library/snmptsm.h
 ./multiplexer.lo: ../../include/net-snmp/library/snmpusm.h
+./multiplexer.lo: ../../include/net-snmp/library/snmptsm.h
 ./multiplexer.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./multiplexer.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./multiplexer.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -895,7 +914,9 @@
 ./null.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./null.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./null.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./null.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./null.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./null.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./null.lo: ../../include/net-snmp/library/ucd_compat.h
 ./null.lo: ../../include/net-snmp/library/mib.h
 ./null.lo: ../../include/net-snmp/mib_api.h
@@ -936,8 +957,8 @@
 ./null.lo: ../../include/net-snmp/library/lcd_time.h
 ./null.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./null.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./null.lo: ../../include/net-snmp/library/snmptsm.h
 ./null.lo: ../../include/net-snmp/library/snmpusm.h
+./null.lo: ../../include/net-snmp/library/snmptsm.h
 ./null.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./null.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./null.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1003,7 +1024,9 @@
 ./old_api.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./old_api.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./old_api.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./old_api.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./old_api.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./old_api.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./old_api.lo: ../../include/net-snmp/library/ucd_compat.h
 ./old_api.lo: ../../include/net-snmp/library/mib.h
 ./old_api.lo: ../../include/net-snmp/mib_api.h
@@ -1044,8 +1067,8 @@
 ./old_api.lo: ../../include/net-snmp/library/lcd_time.h
 ./old_api.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./old_api.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./old_api.lo: ../../include/net-snmp/library/snmptsm.h
 ./old_api.lo: ../../include/net-snmp/library/snmpusm.h
+./old_api.lo: ../../include/net-snmp/library/snmptsm.h
 ./old_api.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./old_api.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./old_api.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1112,7 +1135,9 @@
 ./read_only.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./read_only.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./read_only.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./read_only.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./read_only.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./read_only.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./read_only.lo: ../../include/net-snmp/library/ucd_compat.h
 ./read_only.lo: ../../include/net-snmp/library/mib.h
 ./read_only.lo: ../../include/net-snmp/mib_api.h
@@ -1153,8 +1178,8 @@
 ./read_only.lo: ../../include/net-snmp/library/lcd_time.h
 ./read_only.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./read_only.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./read_only.lo: ../../include/net-snmp/library/snmptsm.h
 ./read_only.lo: ../../include/net-snmp/library/snmpusm.h
+./read_only.lo: ../../include/net-snmp/library/snmptsm.h
 ./read_only.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./read_only.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./read_only.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1221,7 +1246,9 @@
 ./row_merge.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./row_merge.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./row_merge.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./row_merge.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./row_merge.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./row_merge.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./row_merge.lo: ../../include/net-snmp/library/ucd_compat.h
 ./row_merge.lo: ../../include/net-snmp/library/mib.h
 ./row_merge.lo: ../../include/net-snmp/mib_api.h
@@ -1261,8 +1288,8 @@
 ./row_merge.lo: ../../include/net-snmp/library/lcd_time.h
 ./row_merge.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./row_merge.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./row_merge.lo: ../../include/net-snmp/library/snmptsm.h
 ./row_merge.lo: ../../include/net-snmp/library/snmpusm.h
+./row_merge.lo: ../../include/net-snmp/library/snmptsm.h
 ./row_merge.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./row_merge.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./row_merge.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1328,7 +1355,9 @@
 ./scalar.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./scalar.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./scalar.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./scalar.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./scalar.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./scalar.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./scalar.lo: ../../include/net-snmp/library/ucd_compat.h
 ./scalar.lo: ../../include/net-snmp/library/mib.h
 ./scalar.lo: ../../include/net-snmp/mib_api.h
@@ -1369,8 +1398,8 @@
 ./scalar.lo: ../../include/net-snmp/library/lcd_time.h
 ./scalar.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./scalar.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./scalar.lo: ../../include/net-snmp/library/snmptsm.h
 ./scalar.lo: ../../include/net-snmp/library/snmpusm.h
+./scalar.lo: ../../include/net-snmp/library/snmptsm.h
 ./scalar.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./scalar.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./scalar.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1436,7 +1465,9 @@
 ./scalar_group.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./scalar_group.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./scalar_group.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./scalar_group.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./scalar_group.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./scalar_group.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./scalar_group.lo: ../../include/net-snmp/library/ucd_compat.h
 ./scalar_group.lo: ../../include/net-snmp/library/mib.h
 ./scalar_group.lo: ../../include/net-snmp/mib_api.h
@@ -1477,8 +1508,8 @@
 ./scalar_group.lo: ../../include/net-snmp/library/lcd_time.h
 ./scalar_group.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./scalar_group.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./scalar_group.lo: ../../include/net-snmp/library/snmptsm.h
 ./scalar_group.lo: ../../include/net-snmp/library/snmpusm.h
+./scalar_group.lo: ../../include/net-snmp/library/snmptsm.h
 ./scalar_group.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./scalar_group.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./scalar_group.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1544,7 +1575,9 @@
 ./serialize.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./serialize.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./serialize.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./serialize.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./serialize.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./serialize.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./serialize.lo: ../../include/net-snmp/library/ucd_compat.h
 ./serialize.lo: ../../include/net-snmp/library/mib.h
 ./serialize.lo: ../../include/net-snmp/mib_api.h
@@ -1585,8 +1618,8 @@
 ./serialize.lo: ../../include/net-snmp/library/lcd_time.h
 ./serialize.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./serialize.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./serialize.lo: ../../include/net-snmp/library/snmptsm.h
 ./serialize.lo: ../../include/net-snmp/library/snmpusm.h
+./serialize.lo: ../../include/net-snmp/library/snmptsm.h
 ./serialize.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./serialize.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./serialize.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1653,7 +1686,9 @@
 ./snmp_get_statistic.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_get_statistic.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_get_statistic.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_get_statistic.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_get_statistic.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./snmp_get_statistic.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_get_statistic.lo: ../../include/net-snmp/library/ucd_compat.h
 ./snmp_get_statistic.lo: ../../include/net-snmp/library/mib.h
 ./snmp_get_statistic.lo: ../../include/net-snmp/mib_api.h
@@ -1693,8 +1728,8 @@
 ./snmp_get_statistic.lo: ../../include/net-snmp/library/lcd_time.h
 ./snmp_get_statistic.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./snmp_get_statistic.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./snmp_get_statistic.lo: ../../include/net-snmp/library/snmptsm.h
 ./snmp_get_statistic.lo: ../../include/net-snmp/library/snmpusm.h
+./snmp_get_statistic.lo: ../../include/net-snmp/library/snmptsm.h
 ./snmp_get_statistic.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./snmp_get_statistic.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./snmp_get_statistic.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1761,7 +1796,9 @@
 ./stash_cache.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./stash_cache.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./stash_cache.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./stash_cache.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./stash_cache.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./stash_cache.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./stash_cache.lo: ../../include/net-snmp/library/ucd_compat.h
 ./stash_cache.lo: ../../include/net-snmp/library/mib.h
 ./stash_cache.lo: ../../include/net-snmp/mib_api.h
@@ -1801,8 +1838,8 @@
 ./stash_cache.lo: ../../include/net-snmp/library/lcd_time.h
 ./stash_cache.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./stash_cache.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./stash_cache.lo: ../../include/net-snmp/library/snmptsm.h
 ./stash_cache.lo: ../../include/net-snmp/library/snmpusm.h
+./stash_cache.lo: ../../include/net-snmp/library/snmptsm.h
 ./stash_cache.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./stash_cache.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./stash_cache.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1871,7 +1908,9 @@
 ./stash_to_next.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./stash_to_next.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./stash_to_next.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./stash_to_next.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./stash_to_next.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./stash_to_next.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./stash_to_next.lo: ../../include/net-snmp/library/ucd_compat.h
 ./stash_to_next.lo: ../../include/net-snmp/library/mib.h
 ./stash_to_next.lo: ../../include/net-snmp/mib_api.h
@@ -1911,8 +1950,8 @@
 ./stash_to_next.lo: ../../include/net-snmp/library/lcd_time.h
 ./stash_to_next.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./stash_to_next.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./stash_to_next.lo: ../../include/net-snmp/library/snmptsm.h
 ./stash_to_next.lo: ../../include/net-snmp/library/snmpusm.h
+./stash_to_next.lo: ../../include/net-snmp/library/snmptsm.h
 ./stash_to_next.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./stash_to_next.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./stash_to_next.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1981,7 +2020,9 @@
 ./table.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./table.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./table.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./table.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./table.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./table.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./table.lo: ../../include/net-snmp/library/ucd_compat.h
 ./table.lo: ../../include/net-snmp/library/mib.h
 ./table.lo: ../../include/net-snmp/mib_api.h
@@ -2021,8 +2062,8 @@
 ./table.lo: ../../include/net-snmp/library/lcd_time.h
 ./table.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./table.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./table.lo: ../../include/net-snmp/library/snmptsm.h
 ./table.lo: ../../include/net-snmp/library/snmpusm.h
+./table.lo: ../../include/net-snmp/library/snmptsm.h
 ./table.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./table.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./table.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2089,7 +2130,9 @@
 ./table_array.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./table_array.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./table_array.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./table_array.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./table_array.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./table_array.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./table_array.lo: ../../include/net-snmp/library/ucd_compat.h
 ./table_array.lo: ../../include/net-snmp/library/mib.h
 ./table_array.lo: ../../include/net-snmp/mib_api.h
@@ -2129,8 +2172,8 @@
 ./table_array.lo: ../../include/net-snmp/library/lcd_time.h
 ./table_array.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./table_array.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./table_array.lo: ../../include/net-snmp/library/snmptsm.h
 ./table_array.lo: ../../include/net-snmp/library/snmpusm.h
+./table_array.lo: ../../include/net-snmp/library/snmptsm.h
 ./table_array.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./table_array.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./table_array.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2197,7 +2240,9 @@
 ./table_container.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./table_container.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./table_container.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./table_container.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./table_container.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./table_container.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./table_container.lo: ../../include/net-snmp/library/ucd_compat.h
 ./table_container.lo: ../../include/net-snmp/library/mib.h
 ./table_container.lo: ../../include/net-snmp/mib_api.h
@@ -2237,8 +2282,8 @@
 ./table_container.lo: ../../include/net-snmp/library/lcd_time.h
 ./table_container.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./table_container.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./table_container.lo: ../../include/net-snmp/library/snmptsm.h
 ./table_container.lo: ../../include/net-snmp/library/snmpusm.h
+./table_container.lo: ../../include/net-snmp/library/snmptsm.h
 ./table_container.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./table_container.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./table_container.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2305,7 +2350,9 @@
 ./table_data.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./table_data.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./table_data.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./table_data.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./table_data.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./table_data.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./table_data.lo: ../../include/net-snmp/library/ucd_compat.h
 ./table_data.lo: ../../include/net-snmp/library/mib.h
 ./table_data.lo: ../../include/net-snmp/mib_api.h
@@ -2345,8 +2392,8 @@
 ./table_data.lo: ../../include/net-snmp/library/lcd_time.h
 ./table_data.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./table_data.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./table_data.lo: ../../include/net-snmp/library/snmptsm.h
 ./table_data.lo: ../../include/net-snmp/library/snmpusm.h
+./table_data.lo: ../../include/net-snmp/library/snmptsm.h
 ./table_data.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./table_data.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./table_data.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2413,7 +2460,9 @@
 ./table_dataset.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./table_dataset.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./table_dataset.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./table_dataset.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./table_dataset.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./table_dataset.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./table_dataset.lo: ../../include/net-snmp/library/ucd_compat.h
 ./table_dataset.lo: ../../include/net-snmp/library/mib.h
 ./table_dataset.lo: ../../include/net-snmp/mib_api.h
@@ -2453,8 +2502,8 @@
 ./table_dataset.lo: ../../include/net-snmp/library/lcd_time.h
 ./table_dataset.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./table_dataset.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./table_dataset.lo: ../../include/net-snmp/library/snmptsm.h
 ./table_dataset.lo: ../../include/net-snmp/library/snmpusm.h
+./table_dataset.lo: ../../include/net-snmp/library/snmptsm.h
 ./table_dataset.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./table_dataset.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./table_dataset.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2521,7 +2570,9 @@
 ./table_iterator.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./table_iterator.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./table_iterator.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./table_iterator.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./table_iterator.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./table_iterator.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./table_iterator.lo: ../../include/net-snmp/library/ucd_compat.h
 ./table_iterator.lo: ../../include/net-snmp/library/mib.h
 ./table_iterator.lo: ../../include/net-snmp/mib_api.h
@@ -2561,8 +2612,8 @@
 ./table_iterator.lo: ../../include/net-snmp/library/lcd_time.h
 ./table_iterator.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./table_iterator.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./table_iterator.lo: ../../include/net-snmp/library/snmptsm.h
 ./table_iterator.lo: ../../include/net-snmp/library/snmpusm.h
+./table_iterator.lo: ../../include/net-snmp/library/snmptsm.h
 ./table_iterator.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./table_iterator.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./table_iterator.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2630,7 +2681,9 @@
 ./table_row.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./table_row.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./table_row.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./table_row.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./table_row.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./table_row.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./table_row.lo: ../../include/net-snmp/library/ucd_compat.h
 ./table_row.lo: ../../include/net-snmp/library/mib.h
 ./table_row.lo: ../../include/net-snmp/mib_api.h
@@ -2670,8 +2723,8 @@
 ./table_row.lo: ../../include/net-snmp/library/lcd_time.h
 ./table_row.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./table_row.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./table_row.lo: ../../include/net-snmp/library/snmptsm.h
 ./table_row.lo: ../../include/net-snmp/library/snmpusm.h
+./table_row.lo: ../../include/net-snmp/library/snmptsm.h
 ./table_row.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./table_row.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./table_row.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2738,7 +2791,9 @@
 ./table_tdata.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./table_tdata.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./table_tdata.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./table_tdata.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./table_tdata.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./table_tdata.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./table_tdata.lo: ../../include/net-snmp/library/ucd_compat.h
 ./table_tdata.lo: ../../include/net-snmp/library/mib.h
 ./table_tdata.lo: ../../include/net-snmp/mib_api.h
@@ -2778,8 +2833,8 @@
 ./table_tdata.lo: ../../include/net-snmp/library/lcd_time.h
 ./table_tdata.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./table_tdata.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./table_tdata.lo: ../../include/net-snmp/library/snmptsm.h
 ./table_tdata.lo: ../../include/net-snmp/library/snmpusm.h
+./table_tdata.lo: ../../include/net-snmp/library/snmptsm.h
 ./table_tdata.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./table_tdata.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./table_tdata.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2846,7 +2901,9 @@
 ./watcher.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./watcher.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./watcher.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./watcher.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./watcher.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./watcher.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./watcher.lo: ../../include/net-snmp/library/ucd_compat.h
 ./watcher.lo: ../../include/net-snmp/library/mib.h
 ./watcher.lo: ../../include/net-snmp/mib_api.h
@@ -2886,8 +2943,8 @@
 ./watcher.lo: ../../include/net-snmp/library/lcd_time.h
 ./watcher.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./watcher.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./watcher.lo: ../../include/net-snmp/library/snmptsm.h
 ./watcher.lo: ../../include/net-snmp/library/snmpusm.h
+./watcher.lo: ../../include/net-snmp/library/snmptsm.h
 ./watcher.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./watcher.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./watcher.lo: ../../include/net-snmp/agent/agent_module_config.h
diff -urpN net-snmp-5.8/agent/helpers/Makefile.in net-snmp-5.9.1/agent/helpers/Makefile.in
--- net-snmp-5.8/agent/helpers/Makefile.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/Makefile.in	2021-05-26 05:19:35.000000000 +0700
@@ -32,5 +32,5 @@ LOBJS = dummy.lo
 all: standardall
 
 libnetsnmphelpers.$(LIB_EXTENSION)$(LIB_VERSION):    $(LOBJS)
-	$(LIB_LD_CMD) $@ $(LOBJS) @LD_NO_UNDEFINED@ $(LDFLAGS) $(LIB_LD_LIBS)
+	$(LIB_LD_CMD) $@ $(LOBJS) @LD_NO_UNDEFINED@ $(LDFLAGS)
 	$(RANLIB) $@
diff -urpN net-snmp-5.8/agent/helpers/all_helpers.c net-snmp-5.9.1/agent/helpers/all_helpers.c
--- net-snmp-5.8/agent/helpers/all_helpers.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/all_helpers.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,7 +13,7 @@
 #include <net-snmp/agent/table_dataset.h>
 #include <net-snmp/agent/stash_cache.h>
 
-netsnmp_feature_child_of(mib_helpers, libnetsnmpagent)
+netsnmp_feature_child_of(mib_helpers, libnetsnmpagent);
 
 
 /** call the initialization sequence for all handlers with init_ routines. */
diff -urpN net-snmp-5.8/agent/helpers/baby_steps.c net-snmp-5.9.1/agent/helpers/baby_steps.c
--- net-snmp-5.8/agent/helpers/baby_steps.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/baby_steps.c	2021-05-26 05:19:35.000000000 +0700
@@ -12,11 +12,11 @@
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
-netsnmp_feature_provide(baby_steps)
-netsnmp_feature_child_of(baby_steps, mib_helpers)
+netsnmp_feature_provide(baby_steps);
+netsnmp_feature_child_of(baby_steps, mib_helpers);
 
 #ifdef NETSNMP_FEATURE_REQUIRE_BABY_STEPS
-netsnmp_feature_require(check_requests_error)
+netsnmp_feature_require(check_requests_error);
 #endif
 
 #ifndef NETSNMP_FEATURE_REMOVE_BABY_STEPS
@@ -355,7 +355,7 @@ _baby_steps_helper(netsnmp_mib_handler *
  *  handler as a run-time injectable handler for configuration file
  *  use.
  */
-netsnmp_feature_child_of(netsnmp_baby_steps_handler_init,netsnmp_unused)
+netsnmp_feature_child_of(netsnmp_baby_steps_handler_init,netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_NETSNMP_BABY_STEPS_HANDLER_INIT
 void
 netsnmp_baby_steps_handler_init(void)
diff -urpN net-snmp-5.8/agent/helpers/cache_handler.c net-snmp-5.9.1/agent/helpers/cache_handler.c
--- net-snmp-5.8/agent/helpers/cache_handler.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/cache_handler.c	2021-05-26 05:19:35.000000000 +0700
@@ -27,10 +27,10 @@
 
 #include <net-snmp/agent/cache_handler.h>
 
-netsnmp_feature_child_of(cache_handler, mib_helpers)
+netsnmp_feature_child_of(cache_handler, mib_helpers);
 
-netsnmp_feature_child_of(cache_find_by_oid, cache_handler)
-netsnmp_feature_child_of(cache_get_head, cache_handler)
+netsnmp_feature_child_of(cache_find_by_oid, cache_handler);
+netsnmp_feature_child_of(cache_get_head, cache_handler);
 
 static netsnmp_cache  *cache_head = NULL;
 static int             cache_outstanding_valid = 0;
@@ -457,7 +457,7 @@ _cache_handler_register(netsnmp_handler_
 
 /** functionally the same as calling netsnmp_register_handler() but also
  * injects a cache handler at the same time for you. */
-netsnmp_feature_child_of(netsnmp_cache_handler_register,netsnmp_unused)
+netsnmp_feature_child_of(netsnmp_cache_handler_register,netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_NETSNMP_CACHE_HANDLER_REGISTER
 int
 netsnmp_cache_handler_register(netsnmp_handler_registration * reginfo,
@@ -475,7 +475,7 @@ netsnmp_cache_handler_register(netsnmp_h
 
 /** functionally the same as calling netsnmp_register_handler() but also
  * injects a cache handler at the same time for you. */
-netsnmp_feature_child_of(netsnmp_register_cache_handler,netsnmp_unused)
+netsnmp_feature_child_of(netsnmp_register_cache_handler,netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_NETSNMP_REGISTER_CACHE_HANDLER
 int
 netsnmp_register_cache_handler(netsnmp_handler_registration * reginfo,
@@ -538,7 +538,7 @@ netsnmp_cache_reqinfo_extract(netsnmp_ag
 }
 
 /** Extract the cache information for a given request (PDU) */
-netsnmp_feature_child_of(netsnmp_extract_cache_info,netsnmp_unused)
+netsnmp_feature_child_of(netsnmp_extract_cache_info,netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_NETSNMP_EXTRACT_CACHE_INFO
 netsnmp_cache  *
 netsnmp_extract_cache_info(netsnmp_agent_request_info * reqinfo)
@@ -594,7 +594,7 @@ netsnmp_cache_is_valid(netsnmp_agent_req
 /** Is the cache valid for a given request?
  * for backwards compatability. netsnmp_cache_is_valid() is preferred.
  */
-netsnmp_feature_child_of(netsnmp_is_cache_valid,netsnmp_unused)
+netsnmp_feature_child_of(netsnmp_is_cache_valid,netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_NETSNMP_IS_CACHE_VALID
 int
 netsnmp_is_cache_valid(netsnmp_agent_request_info * reqinfo)
diff -urpN net-snmp-5.8/agent/helpers/instance.c net-snmp-5.9.1/agent/helpers/instance.c
--- net-snmp-5.8/agent/helpers/instance.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/instance.c	2021-05-26 05:19:35.000000000 +0700
@@ -32,8 +32,8 @@
 #include <net-snmp/agent/serialize.h>
 #include <net-snmp/agent/read_only.h>
 
-netsnmp_feature_provide(instance)
-netsnmp_feature_child_of(instance, mib_helpers)
+netsnmp_feature_provide(instance);
+netsnmp_feature_child_of(instance, mib_helpers);
 
 typedef struct netsnmp_num_file_instance_s {
     int   refcnt;
@@ -214,7 +214,7 @@ get_reg(const char *name,
 #endif /* NETSNMP_FEATURE_REMOVE_REGISTER_NUM_FILE_INSTANCE */
 
 /* Watched 'long' instances are writable on both 32-bit and 64-bit systems  */
-netsnmp_feature_child_of(read_only_ulong_instance,instance)
+netsnmp_feature_child_of(read_only_ulong_instance,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_READ_ONLY_ULONG_INSTANCE
 int
 netsnmp_register_read_only_ulong_instance(const char *name,
@@ -232,7 +232,7 @@ netsnmp_register_read_only_ulong_instanc
 }
 #endif /* NETSNMP_FEATURE_REMOVE_READ_ONLY_ULONG_INSTANCE */
 
-netsnmp_feature_child_of(ulong_instance,instance)
+netsnmp_feature_child_of(ulong_instance,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_ULONG_INSTANCE
 int
 netsnmp_register_ulong_instance(const char *name,
@@ -249,7 +249,7 @@ netsnmp_register_ulong_instance(const ch
 }
 #endif /* NETSNMP_FEATURE_REMOVE_ULONG_INSTANCE */
 
-netsnmp_feature_child_of(read_only_counter32_instance,instance)
+netsnmp_feature_child_of(read_only_counter32_instance,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_READ_ONLY_COUNTER32_INSTANCE
 int
 netsnmp_register_read_only_counter32_instance(const char *name,
@@ -268,7 +268,7 @@ netsnmp_register_read_only_counter32_ins
 }
 #endif /* NETSNMP_FEATURE_REMOVE_READ_ONLY_COUNTER32_INSTANCE */
 
-netsnmp_feature_child_of(read_only_long_instance,instance)
+netsnmp_feature_child_of(read_only_long_instance,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_READ_ONLY_LONG_INSTANCE
 int
 netsnmp_register_read_only_long_instance(const char *name,
@@ -285,7 +285,7 @@ netsnmp_register_read_only_long_instance
 }
 #endif /* NETSNMP_FEATURE_REMOVE_READ_ONLY_LONG_INSTANCE */
 
-netsnmp_feature_child_of(long_instance,instance)
+netsnmp_feature_child_of(long_instance,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_LONG_INSTANCE
 int
 netsnmp_register_long_instance(const char *name,
@@ -301,7 +301,7 @@ netsnmp_register_long_instance(const cha
 #endif /* NETSNMP_FEATURE_REMOVE_LONG_INSTANCE */
 
 /* Watched 'int' instances are only writable on 32-bit systems  */
-netsnmp_feature_child_of(read_only_uint_instance,instance)
+netsnmp_feature_child_of(read_only_uint_instance,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_READ_ONLY_UINT_INSTANCE
 int
 netsnmp_register_read_only_uint_instance(const char *name,
@@ -319,7 +319,7 @@ netsnmp_register_read_only_uint_instance
 }
 #endif /* NETSNMP_FEATURE_REMOVE_READ_ONLY_UINT_INSTANCE */
 
-netsnmp_feature_child_of(uint_instance,instance)
+netsnmp_feature_child_of(uint_instance,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_UINT_INSTANCE
 int
 netsnmp_register_uint_instance(const char *name,
@@ -335,7 +335,7 @@ netsnmp_register_uint_instance(const cha
 }
 #endif /* NETSNMP_FEATURE_REMOVE_UINT_INSTANCE */
 
-netsnmp_feature_child_of(read_only_int_instance,instance)
+netsnmp_feature_child_of(read_only_int_instance,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_READ_ONLY_INT_INSTANCE
 int
 netsnmp_register_read_only_int_instance(const char *name,
@@ -353,7 +353,7 @@ netsnmp_register_read_only_int_instance(
   /*
    * Compatibility with earlier (inconsistently named) routine
    */
-netsnmp_feature_child_of(register_read_only_int_instance,netsnmp_unused)
+netsnmp_feature_child_of(register_read_only_int_instance,netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_REGISTER_READ_ONLY_INT_INSTANCE
 int
 register_read_only_int_instance(const char *name,
@@ -370,7 +370,7 @@ register_read_only_int_instance(const ch
  * Context registrations
  */
 
-netsnmp_feature_child_of(register_read_only_ulong_instance_context,instance)
+netsnmp_feature_child_of(register_read_only_ulong_instance_context,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_REGISTER_READ_ONLY_ULONG_INSTANCE_CONTEXT
 int
 netsnmp_register_read_only_ulong_instance_context(const char *name,
@@ -392,7 +392,7 @@ netsnmp_register_read_only_ulong_instanc
 }
 #endif /* NETSNMP_FEATURE_REMOVE_REGISTER_READ_ONLY_ULONG_INSTANCE_CONTEXT */
 
-netsnmp_feature_child_of(register_ulong_instance_context,instance)
+netsnmp_feature_child_of(register_ulong_instance_context,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_REGISTER_ULONG_INSTANCE_CONTEXT
 int
 netsnmp_register_ulong_instance_context(const char *name,
@@ -412,7 +412,7 @@ netsnmp_register_ulong_instance_context(
 }
 #endif /* NETSNMP_FEATURE_REMOVE_REGISTER_ULONG_INSTANCE_CONTEXT */
 
-netsnmp_feature_child_of(register_read_only_counter32_instance_context,instance)
+netsnmp_feature_child_of(register_read_only_counter32_instance_context,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_REGISTER_READ_ONLY_COUNTER32_INSTANCE_CONTEXT
 int
 netsnmp_register_read_only_counter32_instance_context(const char *name,
@@ -434,7 +434,7 @@ netsnmp_register_read_only_counter32_ins
 }
 #endif /* NETSNMP_FEATURE_REMOVE_REGISTER_READ_ONLY_COUNTER32_INSTANCE_CONTEXT */
 
-netsnmp_feature_child_of(register_read_only_long_instance_context,instance)
+netsnmp_feature_child_of(register_read_only_long_instance_context,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_REGISTER_READ_ONLY_LONG_INSTANCE_CONTEXT
 int
 netsnmp_register_read_only_long_instance_context(const char *name,
@@ -456,7 +456,7 @@ netsnmp_register_read_only_long_instance
 }
 #endif /* NETSNMP_FEATURE_REMOVE_REGISTER_READ_ONLY_LONG_INSTANCE_CONTEXT */
 
-netsnmp_feature_child_of(register_long_instance_context,instance)
+netsnmp_feature_child_of(register_long_instance_context,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_REGISTER_LONG_INSTANCE_CONTEXT
 int
 netsnmp_register_long_instance_context(const char *name,
@@ -476,7 +476,7 @@ netsnmp_register_long_instance_context(c
 }
 #endif /* NETSNMP_FEATURE_REMOVE_REGISTER_LONG_INSTANCE_CONTEXT */
 
-netsnmp_feature_child_of(register_int_instance_context,instance)
+netsnmp_feature_child_of(register_int_instance_context,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_REGISTER_INT_INSTANCE_CONTEXT
 int
 netsnmp_register_int_instance_context(const char *name,
@@ -497,7 +497,7 @@ netsnmp_register_int_instance_context(co
 }
 #endif /* NETSNMP_FEATURE_REMOVE_REGISTER_INT_INSTANCE_CONTEXT */
 
-netsnmp_feature_child_of(register_read_only_int_instance_context,instance)
+netsnmp_feature_child_of(register_read_only_int_instance_context,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_REGISTER_READ_ONLY_INT_INSTANCE_CONTEXT
 int
 netsnmp_register_read_only_int_instance_context(const char *name,
@@ -521,7 +521,7 @@ netsnmp_register_read_only_int_instance_
 /*
  * Compatibility with earlier (inconsistently named) routine
  */
-netsnmp_feature_child_of(read_only_int_instance_context,instance)
+netsnmp_feature_child_of(read_only_int_instance_context,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_READ_ONLY_INT_INSTANCE_CONTEXT
 int
 register_read_only_int_instance_context(const char *name,
@@ -537,7 +537,7 @@ register_read_only_int_instance_context(
 }
 #endif /* NETSNMP_FEATURE_REMOVE_READ_ONLY_INT_INSTANCE_CONTEXT */
 
-netsnmp_feature_child_of(register_num_file_instance,instance)
+netsnmp_feature_child_of(register_num_file_instance,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_REGISTER_NUM_FILE_INSTANCE
 int
 netsnmp_register_num_file_instance(const char *name,
@@ -581,7 +581,7 @@ netsnmp_register_num_file_instance(const
 }
 #endif /* NETSNMP_FEATURE_REMOVE_REGISTER_NUM_FILE_INSTANCE */
 
-netsnmp_feature_child_of(register_int_instance,instance)
+netsnmp_feature_child_of(register_int_instance,instance);
 #ifndef NETSNMP_FEATURE_REMOVE_REGISTER_INT_INSTANCE
 /**
  * This function registers an int helper handler to a specified OID.
diff -urpN net-snmp-5.8/agent/helpers/mode_end_call.c net-snmp-5.9.1/agent/helpers/mode_end_call.c
--- net-snmp-5.8/agent/helpers/mode_end_call.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/mode_end_call.c	2021-05-26 05:19:35.000000000 +0700
@@ -16,8 +16,8 @@
 
 #include <net-snmp/agent/mode_end_call.h>
 
-netsnmp_feature_provide(mode_end_call)
-netsnmp_feature_child_of(mode_end_call, mib_helpers)
+netsnmp_feature_provide(mode_end_call);
+netsnmp_feature_child_of(mode_end_call, mib_helpers);
 
 #ifndef NETSNMP_FEATURE_REMOVE_MODE_END_CALL
 /** @defgroup mode_end_call mode_end_call
diff -urpN net-snmp-5.8/agent/helpers/row_merge.c net-snmp-5.9.1/agent/helpers/row_merge.c
--- net-snmp-5.8/agent/helpers/row_merge.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/row_merge.c	2021-05-26 05:19:35.000000000 +0700
@@ -17,15 +17,17 @@
 
 #include <net-snmp/agent/row_merge.h>
 
+#include <stdint.h>
+
 #if HAVE_STRING_H
 #include <string.h>
 #else
 #include <strings.h>
 #endif
 
-netsnmp_feature_provide(row_merge)
-netsnmp_feature_child_of(row_merge, row_merge_all)
-netsnmp_feature_child_of(row_merge_all, mib_helpers)
+netsnmp_feature_provide(row_merge);
+netsnmp_feature_child_of(row_merge, row_merge_all);
+netsnmp_feature_child_of(row_merge_all, mib_helpers);
 
 
 #ifndef NETSNMP_FEATURE_REMOVE_ROW_MERGE
@@ -56,7 +58,7 @@ netsnmp_get_row_merge_handler(int prefix
 
 /** functionally the same as calling netsnmp_register_handler() but also
  * injects a row_merge handler at the same time for you. */
-netsnmp_feature_child_of(register_row_merge, row_merge_all)
+netsnmp_feature_child_of(register_row_merge, row_merge_all);
 #ifndef NETSNMP_FEATURE_REMOVE_REGISTER_ROW_MERGE
 int
 netsnmp_register_row_merge(netsnmp_handler_registration *reginfo)
diff -urpN net-snmp-5.8/agent/helpers/snmp_get_statistic.c net-snmp-5.9.1/agent/helpers/snmp_get_statistic.c
--- net-snmp-5.8/agent/helpers/snmp_get_statistic.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/snmp_get_statistic.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,15 +13,15 @@
 #include <net-snmp/net-snmp-features.h>
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
-
 #include <net-snmp/agent/snmp_get_statistic.h>
+#include <stdint.h>
 
-netsnmp_feature_provide(helper_statistics)
-netsnmp_feature_child_of(helper_statistics, mib_helpers)
+netsnmp_feature_provide(helper_statistics);
+netsnmp_feature_child_of(helper_statistics, mib_helpers);
 
 #ifdef NETSNMP_FEATURE_REQUIRE_HELPER_STATISTICS
 /* if we're not needed, then neither is this */
-netsnmp_feature_require(statistics)
+netsnmp_feature_require(statistics);
 #endif
 
 #ifndef NETSNMP_FEATURE_REMOVE_HELPER_STATISTICS
diff -urpN net-snmp-5.8/agent/helpers/stash_cache.c net-snmp-5.9.1/agent/helpers/stash_cache.c
--- net-snmp-5.8/agent/helpers/stash_cache.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/stash_cache.c	2021-05-26 05:19:35.000000000 +0700
@@ -4,12 +4,12 @@
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
-netsnmp_feature_provide(stash_cache)
-netsnmp_feature_child_of(stash_cache, mib_helpers)
+netsnmp_feature_provide(stash_cache);
+netsnmp_feature_child_of(stash_cache, mib_helpers);
 #ifdef NETSNMP_FEATURE_REQUIRE_STASH_CACHE
-netsnmp_feature_require(oid_stash)
-netsnmp_feature_require(oid_stash_iterate)
-netsnmp_feature_require(oid_stash_get_data)
+netsnmp_feature_require(oid_stash);
+netsnmp_feature_require(oid_stash_iterate);
+netsnmp_feature_require(oid_stash_get_data);
 #endif
 
 #ifndef NETSNMP_FEATURE_REMOVE_STASH_CACHE
diff -urpN net-snmp-5.8/agent/helpers/stash_to_next.c net-snmp-5.9.1/agent/helpers/stash_to_next.c
--- net-snmp-5.8/agent/helpers/stash_to_next.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/stash_to_next.c	2021-05-26 05:19:35.000000000 +0700
@@ -4,12 +4,12 @@
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
-netsnmp_feature_provide(stash_to_next)
-netsnmp_feature_child_of(stash_to_next, mib_helpers)
+netsnmp_feature_provide(stash_to_next);
+netsnmp_feature_child_of(stash_to_next, mib_helpers);
 
 #ifdef NETSNMP_FEATURE_REQUIRE_STASH_TO_NEXT
-netsnmp_feature_require(oid_stash)
-netsnmp_feature_require(oid_stash_add_data)
+netsnmp_feature_require(oid_stash);
+netsnmp_feature_require(oid_stash_add_data);
 #endif
 
 #ifndef NETSNMP_FEATURE_REMOVE_STASH_TO_NEXT
diff -urpN net-snmp-5.8/agent/helpers/table.c net-snmp-5.9.1/agent/helpers/table.c
--- net-snmp-5.8/agent/helpers/table.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/table.c	2021-05-26 05:19:35.000000000 +0700
@@ -33,7 +33,7 @@
 #include <net-snmp/agent/table.h>
 
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(oid_stash)
+netsnmp_feature_require(oid_stash);
 #endif /* !NETSNMP_NO_WRITE_SUPPORT */
 
 #if HAVE_STRING_H
@@ -44,12 +44,12 @@ netsnmp_feature_require(oid_stash)
 
 #include <net-snmp/library/snmp_assert.h>
 
-netsnmp_feature_child_of(table_all, mib_helpers)
+netsnmp_feature_child_of(table_all, mib_helpers);
 
-netsnmp_feature_child_of(table_build_result, table_all)
-netsnmp_feature_child_of(table_get_or_create_row_stash, table_all)
-netsnmp_feature_child_of(registration_owns_table_info, table_all)
-netsnmp_feature_child_of(table_sparse, table_all)
+netsnmp_feature_child_of(table_build_result, table_all);
+netsnmp_feature_child_of(table_get_or_create_row_stash, table_all);
+netsnmp_feature_child_of(registration_owns_table_info, table_all);
+netsnmp_feature_child_of(table_sparse, table_all);
 
 static void     table_helper_cleanup(netsnmp_agent_request_info *reqinfo,
                                      netsnmp_request_info *request,
@@ -998,7 +998,8 @@ netsnmp_update_indexes_from_variable_lis
     if (!tri)
         return SNMPERR_GENERR;
 
-    return build_oid_noalloc(tri->index_oid, sizeof(tri->index_oid),
+    return build_oid_noalloc(tri->index_oid,
+                             sizeof(tri->index_oid) / sizeof(tri->index_oid[0]),
                              &tri->index_oid_len, NULL, 0, tri->indexes);
 }
 
diff -urpN net-snmp-5.8/agent/helpers/table_array.c net-snmp-5.9.1/agent/helpers/table_array.c
--- net-snmp-5.8/agent/helpers/table_array.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/table_array.c	2021-05-26 05:19:35.000000000 +0700
@@ -30,12 +30,12 @@
 #include <net-snmp/library/container.h>
 #include <net-snmp/library/snmp_assert.h>
 
-netsnmp_feature_child_of(table_array_all, mib_helpers)
+netsnmp_feature_child_of(table_array_all, mib_helpers);
 
-netsnmp_feature_child_of(table_array_register,table_array_all)
-netsnmp_feature_child_of(table_array_find_table_array_handler,table_array_all)
-netsnmp_feature_child_of(table_array_extract_array_context,table_array_all)
-netsnmp_feature_child_of(table_array_check_row_status,table_array_all)
+netsnmp_feature_child_of(table_array_register,table_array_all);
+netsnmp_feature_child_of(table_array_find_table_array_handler,table_array_all);
+netsnmp_feature_child_of(table_array_extract_array_context,table_array_all);
+netsnmp_feature_child_of(table_array_check_row_status,table_array_all);
 
 #ifndef NETSNMP_FEATURE_REMOVE_TABLE_CONTAINER
 
diff -urpN net-snmp-5.8/agent/helpers/table_container.c net-snmp-5.9.1/agent/helpers/table_container.c
--- net-snmp-5.8/agent/helpers/table_container.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/table_container.c	2021-05-26 05:19:35.000000000 +0700
@@ -30,14 +30,14 @@
 #include <net-snmp/library/container.h>
 #include <net-snmp/library/snmp_assert.h>
 
-netsnmp_feature_provide(table_container)
-netsnmp_feature_child_of(table_container, table_container_all)
-netsnmp_feature_child_of(table_container_replace_row, table_container_all)
-netsnmp_feature_child_of(table_container_extract, table_container_all)
-netsnmp_feature_child_of(table_container_management, table_container_all)
-netsnmp_feature_child_of(table_container_row_remove, table_container_all)
-netsnmp_feature_child_of(table_container_row_insert, table_container_all)
-netsnmp_feature_child_of(table_container_all, mib_helpers)
+netsnmp_feature_provide(table_container);
+netsnmp_feature_child_of(table_container, table_container_all);
+netsnmp_feature_child_of(table_container_replace_row, table_container_all);
+netsnmp_feature_child_of(table_container_extract, table_container_all);
+netsnmp_feature_child_of(table_container_management, table_container_all);
+netsnmp_feature_child_of(table_container_row_remove, table_container_all);
+netsnmp_feature_child_of(table_container_row_insert, table_container_all);
+netsnmp_feature_child_of(table_container_all, mib_helpers);
 
 #ifndef NETSNMP_FEATURE_REMOVE_TABLE_CONTAINER
 
diff -urpN net-snmp-5.8/agent/helpers/table_data.c net-snmp-5.9.1/agent/helpers/table_data.c
--- net-snmp-5.8/agent/helpers/table_data.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/table_data.c	2021-05-26 05:19:35.000000000 +0700
@@ -26,24 +26,24 @@
 #include <net-snmp/agent/table.h>
 #include <net-snmp/agent/read_only.h>
 
-netsnmp_feature_child_of(table_data_all, mib_helpers)
+netsnmp_feature_child_of(table_data_all, mib_helpers);
 
-netsnmp_feature_child_of(table_data, table_data_all)
-netsnmp_feature_child_of(register_read_only_table_data, table_data_all)
-netsnmp_feature_child_of(extract_table_row_data, table_data_all)
-netsnmp_feature_child_of(insert_table_row, table_data_all)
-netsnmp_feature_child_of(table_data_delete_table, table_data_all)
-
-netsnmp_feature_child_of(table_data_extras, table_data_all)
-
-netsnmp_feature_child_of(table_data_create_table, table_data_extras)
-netsnmp_feature_child_of(table_data_create_row, table_data_extras)
-netsnmp_feature_child_of(table_data_copy_row, table_data_extras)
-netsnmp_feature_child_of(table_data_remove_delete_row, table_data_extras)
-netsnmp_feature_child_of(table_data_unregister, table_data_extras)
-netsnmp_feature_child_of(table_data_row_count, table_data_extras)
-netsnmp_feature_child_of(table_data_row_operations, table_data_extras)
-netsnmp_feature_child_of(table_data_row_first, table_data_extras)
+netsnmp_feature_child_of(table_data, table_data_all);
+netsnmp_feature_child_of(register_read_only_table_data, table_data_all);
+netsnmp_feature_child_of(extract_table_row_data, table_data_all);
+netsnmp_feature_child_of(insert_table_row, table_data_all);
+netsnmp_feature_child_of(table_data_delete_table, table_data_all);
+
+netsnmp_feature_child_of(table_data_extras, table_data_all);
+
+netsnmp_feature_child_of(table_data_create_table, table_data_extras);
+netsnmp_feature_child_of(table_data_create_row, table_data_extras);
+netsnmp_feature_child_of(table_data_copy_row, table_data_extras);
+netsnmp_feature_child_of(table_data_remove_delete_row, table_data_extras);
+netsnmp_feature_child_of(table_data_unregister, table_data_extras);
+netsnmp_feature_child_of(table_data_row_count, table_data_extras);
+netsnmp_feature_child_of(table_data_row_operations, table_data_extras);
+netsnmp_feature_child_of(table_data_row_first, table_data_extras);
 
 #ifndef NETSNMP_FEATURE_REMOVE_TABLE_DATA
 
diff -urpN net-snmp-5.8/agent/helpers/table_dataset.c net-snmp-5.9.1/agent/helpers/table_dataset.c
--- net-snmp-5.8/agent/helpers/table_dataset.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/table_dataset.c	2021-05-26 05:19:35.000000000 +0700
@@ -24,32 +24,32 @@
 #include <strings.h>
 #endif
 
-netsnmp_feature_child_of(table_dataset_all, mib_helpers)
-netsnmp_feature_child_of(table_dataset, table_dataset_all)
-netsnmp_feature_child_of(table_dataset_remove_row, table_dataset_all)
-netsnmp_feature_child_of(table_data_set_column, table_dataset_all)
-netsnmp_feature_child_of(table_dataset_get_newrow, table_dataset_all)
-netsnmp_feature_child_of(table_set_add_indexes, table_dataset_all)
-netsnmp_feature_child_of(delete_table_data_set, table_dataset_all)
-netsnmp_feature_child_of(table_set_multi_add_default_row, table_dataset_all)
-netsnmp_feature_child_of(table_dataset_unregister_auto_data_table, table_dataset_all)
+netsnmp_feature_child_of(table_dataset_all, mib_helpers);
+netsnmp_feature_child_of(table_dataset, table_dataset_all);
+netsnmp_feature_child_of(table_dataset_remove_row, table_dataset_all);
+netsnmp_feature_child_of(table_data_set_column, table_dataset_all);
+netsnmp_feature_child_of(table_dataset_get_newrow, table_dataset_all);
+netsnmp_feature_child_of(table_set_add_indexes, table_dataset_all);
+netsnmp_feature_child_of(delete_table_data_set, table_dataset_all);
+netsnmp_feature_child_of(table_set_multi_add_default_row, table_dataset_all);
+netsnmp_feature_child_of(table_dataset_unregister_auto_data_table, table_dataset_all);
 
 #ifdef NETSNMP_FEATURE_REQUIRE_TABLE_DATASET
-netsnmp_feature_require(table_get_or_create_row_stash)
-netsnmp_feature_require(table_data_delete_table)
-netsnmp_feature_require(table_data)
-netsnmp_feature_require(oid_stash_get_data)
-netsnmp_feature_require(oid_stash_add_data)
+netsnmp_feature_require(table_get_or_create_row_stash);
+netsnmp_feature_require(table_data_delete_table);
+netsnmp_feature_require(table_data);
+netsnmp_feature_require(oid_stash_get_data);
+netsnmp_feature_require(oid_stash_add_data);
 #endif /* NETSNMP_FEATURE_REQUIRE_TABLE_DATASET */
 
 #ifndef NETSNMP_FEATURE_REMOVE_TABLE_DATASET
 
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(oid_stash)
+netsnmp_feature_require(oid_stash);
 #endif /* !NETSNMP_NO_WRITE_SUPPORT */
 
 #ifndef NETSNMP_DISABLE_MIB_LOADING
-netsnmp_feature_require(mib_to_asn_type)
+netsnmp_feature_require(mib_to_asn_type);
 #endif /* NETSNMP_DISABLE_MIB_LOADING */
 
 static netsnmp_data_list *auto_tables;
diff -urpN net-snmp-5.8/agent/helpers/table_iterator.c net-snmp-5.9.1/agent/helpers/table_iterator.c
--- net-snmp-5.8/agent/helpers/table_iterator.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/table_iterator.c	2021-05-26 05:19:35.000000000 +0700
@@ -105,16 +105,16 @@
 #include <net-snmp/agent/serialize.h>
 #include <net-snmp/agent/stash_cache.h>
 
-netsnmp_feature_child_of(table_iterator_all, mib_helpers)
+netsnmp_feature_child_of(table_iterator_all, mib_helpers);
 
-netsnmp_feature_child_of(table_iterator_insert_context, table_iterator_all)
-netsnmp_feature_child_of(table_iterator_create_table, table_iterator_all)
-netsnmp_feature_child_of(table_iterator_row_first, table_iterator_all)
-netsnmp_feature_child_of(table_iterator_row_count, table_iterator_all)
+netsnmp_feature_child_of(table_iterator_insert_context, table_iterator_all);
+netsnmp_feature_child_of(table_iterator_create_table, table_iterator_all);
+netsnmp_feature_child_of(table_iterator_row_first, table_iterator_all);
+netsnmp_feature_child_of(table_iterator_row_count, table_iterator_all);
 
 #ifdef NETSNMP_FEATURE_REQUIRE_STASH_CACHE
-netsnmp_feature_require(data_list_get_list_node)
-netsnmp_feature_require(oid_stash_add_data)
+netsnmp_feature_require(data_list_get_list_node);
+netsnmp_feature_require(oid_stash_add_data);
 #endif /* NETSNMP_FEATURE_REQUIRE_STASH_CACHE */
 
 /* ==================================
@@ -850,7 +850,8 @@ netsnmp_table_iterator_helper_handler(ne
                         netsnmp_request_get_list_data(request,
                                                       TI_REQUEST_CACHE);
                     if (!ti_info->results) {
-                      int nc;
+                        int nc;
+
                         table_info = netsnmp_extract_table_info(request);
                         nc = netsnmp_table_next_column(table_info);
                         if (0 == nc) {
@@ -858,7 +859,6 @@ netsnmp_table_iterator_helper_handler(ne
                             snmp_set_var_objid(request->requestvb,
                                                coloid, reginfo->rootoid_len+2);
                             request->processed = TABLE_ITERATOR_NOTAGAIN;
-                            break;
                         } else {
                           table_info->colnum = nc;
                           hintok = 0;
diff -urpN net-snmp-5.8/agent/helpers/table_row.c net-snmp-5.9.1/agent/helpers/table_row.c
--- net-snmp-5.8/agent/helpers/table_row.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/table_row.c	2021-05-26 05:19:35.000000000 +0700
@@ -31,9 +31,9 @@
 #include <net-snmp/library/container.h>
 #include <net-snmp/library/snmp_assert.h>
 
-netsnmp_feature_child_of(table_row_all, mib_helpers)
+netsnmp_feature_child_of(table_row_all, mib_helpers);
 
-netsnmp_feature_child_of(table_row_extract, table_row_all)
+netsnmp_feature_child_of(table_row_extract, table_row_all);
 
 
 /*
diff -urpN net-snmp-5.8/agent/helpers/table_tdata.c net-snmp-5.9.1/agent/helpers/table_tdata.c
--- net-snmp-5.8/agent/helpers/table_tdata.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/table_tdata.c	2021-05-26 05:19:35.000000000 +0700
@@ -27,21 +27,17 @@
 #include <net-snmp/agent/table_container.h>
 #include <net-snmp/agent/read_only.h>
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
-netsnmp_feature_child_of(table_tdata_all, mib_helpers)
-netsnmp_feature_child_of(table_tdata, table_tdata_all)
-netsnmp_feature_child_of(table_tdata_delete_table, table_tdata_all)
-netsnmp_feature_child_of(table_tdata_extract_table, table_tdata_all)
-netsnmp_feature_child_of(table_tdata_remove_row, table_tdata_all)
-netsnmp_feature_child_of(table_tdata_insert_row, table_tdata_all)
+netsnmp_feature_child_of(table_tdata_all, mib_helpers);
+netsnmp_feature_child_of(table_tdata, table_tdata_all);
+netsnmp_feature_child_of(table_tdata_delete_table, table_tdata_all);
+netsnmp_feature_child_of(table_tdata_extract_table, table_tdata_all);
+netsnmp_feature_child_of(table_tdata_remove_row, table_tdata_all);
+netsnmp_feature_child_of(table_tdata_insert_row, table_tdata_all);
 
 #ifdef NETSNMP_FEATURE_REQUIRE_TABLE_TDATA
-netsnmp_feature_require(table_container_row_insert)
+netsnmp_feature_require(table_container_row_insert);
 #ifdef NETSNMP_FEATURE_REQUIRE_TABLE_TDATA_REMOVE_ROW
-netsnmp_feature_require(table_container_row_remove)
+netsnmp_feature_require(table_container_row_remove);
 #endif /* NETSNMP_FEATURE_REQUIRE_TABLE_TDATA_REMOVE_ROW */
 #endif /* NETSNMP_FEATURE_REQUIRE_TABLE_TDATA */
 
@@ -127,7 +123,7 @@ netsnmp_tdata_create_row(void)
 }
 
 /** clones a 'tdata' row. DOES NOT CLONE THE TABLE-SPECIFIC ENTRY DATA. */
-netsnmp_feature_child_of(tdata_clone_row, table_tdata_all)
+netsnmp_feature_child_of(tdata_clone_row, table_tdata_all);
 #ifndef NETSNMP_FEATURE_REMOVE_TDATA_CLONE_ROW
 netsnmp_tdata_row *
 netsnmp_tdata_clone_row(netsnmp_tdata_row *row)
@@ -165,7 +161,7 @@ netsnmp_tdata_clone_row(netsnmp_tdata_ro
 
 /** copy the contents of a 'tdata' row.
     DOES NOT COPY THE TABLE-SPECIFIC ENTRY DATA. */
-netsnmp_feature_child_of(tdata_copy_row, table_tdata_all)
+netsnmp_feature_child_of(tdata_copy_row, table_tdata_all);
 #ifndef NETSNMP_FEATURE_REMOVE_TDATA_COPY_ROW
 int
 netsnmp_tdata_copy_row(netsnmp_tdata_row *dst_row, netsnmp_tdata_row *src_row)
@@ -267,7 +263,7 @@ netsnmp_tdata_add_row(netsnmp_tdata
 }
 
 /** swaps out origrow with newrow.  This does *not* delete/free anything! */
-netsnmp_feature_child_of(tdata_replace_row, table_tdata_all)
+netsnmp_feature_child_of(tdata_replace_row, table_tdata_all);
 #ifndef NETSNMP_FEATURE_REMOVE_TDATA_REPLACE_ROW
 void
 netsnmp_tdata_replace_row(netsnmp_tdata *table,
@@ -428,7 +424,7 @@ netsnmp_tdata_register(netsnmp_handler_r
                   table->container, TABLE_CONTAINER_KEY_NETSNMP_INDEX);
 }
 
-netsnmp_feature_child_of(tdata_unregister, table_tdata_all)
+netsnmp_feature_child_of(tdata_unregister, table_tdata_all);
 #ifndef NETSNMP_FEATURE_REMOVE_TDATA_UNREGISTER
 int
 netsnmp_tdata_unregister(netsnmp_handler_registration    *reginfo)
@@ -449,7 +445,7 @@ netsnmp_tdata_extract_table(netsnmp_requ
 #endif /* NETSNMP_FEATURE_REMOVE_TABLE_TDATA_EXTRACT_TABLE */
 
 /** extracts the tdata container from the request structure */
-netsnmp_feature_child_of(tdata_extract_container, table_tdata_all)
+netsnmp_feature_child_of(tdata_extract_container, table_tdata_all);
 #ifndef NETSNMP_FEATURE_REMOVE_TDATA_EXTRACT_CONTAINER
 netsnmp_container *
 netsnmp_tdata_extract_container(netsnmp_request_info *request)
@@ -596,7 +592,7 @@ netsnmp_tdata_row_next_byoid(netsnmp_tda
     return (netsnmp_tdata_row*)CONTAINER_NEXT( table->container, &index );
 }
 
-netsnmp_feature_child_of(tdata_row_count, table_tdata_all)
+netsnmp_feature_child_of(tdata_row_count, table_tdata_all);
 #ifndef NETSNMP_FEATURE_REMOVE_TDATA_ROW_COUNT
 int
 netsnmp_tdata_row_count(netsnmp_tdata *table)
@@ -615,7 +611,7 @@ netsnmp_tdata_row_count(netsnmp_tdata *t
 
 
 /** compare a row with the given index values */
-netsnmp_feature_child_of(tdata_compare_idx, table_tdata_all)
+netsnmp_feature_child_of(tdata_compare_idx, table_tdata_all);
 #ifndef NETSNMP_FEATURE_REMOVE_TDATA_COMPARE_IDX
 int
 netsnmp_tdata_compare_idx(netsnmp_tdata_row     *row,
diff -urpN net-snmp-5.8/agent/helpers/watcher.c net-snmp-5.9.1/agent/helpers/watcher.c
--- net-snmp-5.8/agent/helpers/watcher.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/helpers/watcher.c	2021-05-26 05:19:35.000000000 +0700
@@ -31,18 +31,18 @@ static void free_wrapper(void * p)
 #define free_wrapper free
 #endif
 
-netsnmp_feature_provide(watcher_all)
-netsnmp_feature_child_of(watcher_all, mib_helpers)
-netsnmp_feature_child_of(watcher_create_info6, watcher_all)
-netsnmp_feature_child_of(watcher_register_timestamp, watcher_all)
-netsnmp_feature_child_of(watcher_ulong_scalar, watcher_all)
-netsnmp_feature_child_of(watcher_read_only_ulong_scalar, watcher_all)
-netsnmp_feature_child_of(watcher_read_only_int_scalar, watcher_all)
-netsnmp_feature_child_of(watcher_long_scalar, watcher_all)
-netsnmp_feature_child_of(watcher_read_only_long_scalar, watcher_all)
-netsnmp_feature_child_of(watcher_int_scalar, watcher_all)
-netsnmp_feature_child_of(read_only_counter32_scalar, watcher_all)
-netsnmp_feature_child_of(watcher_spinlock, watcher_all)
+netsnmp_feature_provide(watcher_all);
+netsnmp_feature_child_of(watcher_all, mib_helpers);
+netsnmp_feature_child_of(watcher_create_info6, watcher_all);
+netsnmp_feature_child_of(watcher_register_timestamp, watcher_all);
+netsnmp_feature_child_of(watcher_ulong_scalar, watcher_all);
+netsnmp_feature_child_of(watcher_read_only_ulong_scalar, watcher_all);
+netsnmp_feature_child_of(watcher_read_only_int_scalar, watcher_all);
+netsnmp_feature_child_of(watcher_long_scalar, watcher_all);
+netsnmp_feature_child_of(watcher_read_only_long_scalar, watcher_all);
+netsnmp_feature_child_of(watcher_int_scalar, watcher_all);
+netsnmp_feature_child_of(read_only_counter32_scalar, watcher_all);
+netsnmp_feature_child_of(watcher_spinlock, watcher_all);
 
 /** @defgroup watcher watcher
  *  Watch a specified variable and process it as an instance or scalar object
diff -urpN net-snmp-5.8/agent/kernel.c net-snmp-5.9.1/agent/kernel.c
--- net-snmp-5.8/agent/kernel.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/kernel.c	2021-05-26 05:19:35.000000000 +0700
@@ -44,13 +44,8 @@
 #include "kernel.h"
 #include <net-snmp/agent/ds_agent.h>
 
-#ifndef NULL
-#define NULL 0
-#endif
-
-
-#if HAVE_KVM_H
-kvm_t *kd = NULL;
+#if defined(HAVE_KVM_H) && !defined(NETSNMP_NO_KMEM_USAGE)
+kvm_t *kd;
 
 /**
  * Initialize the support for accessing kernel virtual memory.
@@ -135,9 +130,8 @@ free_kmem(void)
     }
 }
 
-#else                           /* HAVE_KVM_H */
-
-#ifdef HAVE_KMEM
+#elif defined(HAVE_NLIST_H) && !defined(__linux__) &&   \
+    !defined(NETSNMP_NO_KMEM_USAGE)
 
 static off_t    klseek(off_t);
 static int      klread(char *, int);
@@ -259,6 +253,15 @@ free_kmem(void)
     }
 }
 
-#endif                          /* HAVE_KMEM */
+#else
+int
+init_kmem(const char *file)
+{
+    return 1;  /* success */
+}
 
-#endif                          /* HAVE_KVM_H */
+void
+free_kmem(void)
+{
+}
+#endif
diff -urpN net-snmp-5.8/agent/mib_modules.c net-snmp-5.9.1/agent/mib_modules.c
--- net-snmp-5.8/agent/mib_modules.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mib_modules.c	2021-05-26 05:19:35.000000000 +0700
@@ -65,9 +65,6 @@ init_mib_modules(void)
 {
     static int once = 0;
 
-#ifdef USING_IF_MIB_DATA_ACCESS_INTERFACE_MODULE
-    netsnmp_access_interface_init();
-#endif
 #  include "mib_module_inits.h"
 
     need_shutdown = 1;
diff -urpN net-snmp-5.8/agent/mibgroup/Makefile.depend net-snmp-5.9.1/agent/mibgroup/Makefile.depend
--- net-snmp-5.8/agent/mibgroup/Makefile.depend	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/Makefile.depend	2021-05-26 05:19:35.000000000 +0700
@@ -1,6 +1,9 @@
 # DO NOT DELETE THIS LINE -- make depend depends on it.
 
 ./header_complex.lo: ../../include/net-snmp/net-snmp-config.h
+./header_complex.lo: ../../include/net-snmp/system/linux.h
+./header_complex.lo: ../../include/net-snmp/system/sysv.h
+./header_complex.lo: ../../include/net-snmp/system/generic.h
 ./header_complex.lo: ../../include/net-snmp/machine/generic.h
 ./header_complex.lo: ../../include/net-snmp/net-snmp-includes.h
 ./header_complex.lo: ../../include/net-snmp/definitions.h
@@ -29,7 +32,9 @@
 ./header_complex.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./header_complex.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./header_complex.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./header_complex.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./header_complex.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./header_complex.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./header_complex.lo: ../../include/net-snmp/library/ucd_compat.h
 ./header_complex.lo: ../../include/net-snmp/library/mib.h
 ./header_complex.lo: ../../include/net-snmp/mib_api.h
@@ -71,8 +76,8 @@
 ./header_complex.lo: ../../include/net-snmp/library/lcd_time.h
 ./header_complex.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./header_complex.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./header_complex.lo: ../../include/net-snmp/library/snmptsm.h
 ./header_complex.lo: ../../include/net-snmp/library/snmpusm.h
+./header_complex.lo: ../../include/net-snmp/library/snmptsm.h
 ./header_complex.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./header_complex.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./header_complex.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -141,7 +146,9 @@
 ./testhandler.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./testhandler.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./testhandler.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./testhandler.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./testhandler.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./testhandler.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./testhandler.lo: ../../include/net-snmp/library/ucd_compat.h
 ./testhandler.lo: ../../include/net-snmp/library/mib.h
 ./testhandler.lo: ../../include/net-snmp/mib_api.h
@@ -181,8 +188,8 @@
 ./testhandler.lo: ../../include/net-snmp/library/lcd_time.h
 ./testhandler.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./testhandler.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./testhandler.lo: ../../include/net-snmp/library/snmptsm.h
 ./testhandler.lo: ../../include/net-snmp/library/snmpusm.h
+./testhandler.lo: ../../include/net-snmp/library/snmptsm.h
 ./testhandler.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./testhandler.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./testhandler.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -250,7 +257,9 @@
 ./util_funcs.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./util_funcs.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./util_funcs.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./util_funcs.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./util_funcs.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./util_funcs.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./util_funcs.lo: ../../include/net-snmp/library/ucd_compat.h
 ./util_funcs.lo: ../../include/net-snmp/library/mib.h
 ./util_funcs.lo: ../../include/net-snmp/mib_api.h
@@ -290,8 +299,8 @@
 ./util_funcs.lo: ../../include/net-snmp/library/lcd_time.h
 ./util_funcs.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./util_funcs.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./util_funcs.lo: ../../include/net-snmp/library/snmptsm.h
 ./util_funcs.lo: ../../include/net-snmp/library/snmpusm.h
+./util_funcs.lo: ../../include/net-snmp/library/snmptsm.h
 ./util_funcs.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./util_funcs.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./util_funcs.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -365,7 +374,9 @@
 ./Rmon/agutil.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./Rmon/agutil.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./Rmon/agutil.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./Rmon/agutil.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./Rmon/agutil.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./Rmon/agutil.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./Rmon/agutil.lo: ../../include/net-snmp/library/ucd_compat.h
 ./Rmon/agutil.lo: ../../include/net-snmp/library/mib.h
 ./Rmon/agutil.lo: ../../include/net-snmp/mib_api.h
@@ -406,8 +417,8 @@
 ./Rmon/agutil.lo: ../../include/net-snmp/library/lcd_time.h
 ./Rmon/agutil.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./Rmon/agutil.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./Rmon/agutil.lo: ../../include/net-snmp/library/snmptsm.h
 ./Rmon/agutil.lo: ../../include/net-snmp/library/snmpusm.h
+./Rmon/agutil.lo: ../../include/net-snmp/library/snmptsm.h
 ./Rmon/agutil.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./Rmon/agutil.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./Rmon/agutil.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -474,7 +485,9 @@
 ./Rmon/alarm.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./Rmon/alarm.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./Rmon/alarm.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./Rmon/alarm.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./Rmon/alarm.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./Rmon/alarm.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./Rmon/alarm.lo: ../../include/net-snmp/library/ucd_compat.h
 ./Rmon/alarm.lo: ../../include/net-snmp/library/mib.h
 ./Rmon/alarm.lo: ../../include/net-snmp/mib_api.h
@@ -515,8 +528,8 @@
 ./Rmon/alarm.lo: ../../include/net-snmp/library/lcd_time.h
 ./Rmon/alarm.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./Rmon/alarm.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./Rmon/alarm.lo: ../../include/net-snmp/library/snmptsm.h
 ./Rmon/alarm.lo: ../../include/net-snmp/library/snmpusm.h
+./Rmon/alarm.lo: ../../include/net-snmp/library/snmptsm.h
 ./Rmon/alarm.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./Rmon/alarm.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./Rmon/alarm.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -585,7 +598,9 @@
 ./Rmon/alarmTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./Rmon/alarmTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./Rmon/alarmTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./Rmon/alarmTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./Rmon/alarmTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./Rmon/alarmTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./Rmon/alarmTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./Rmon/alarmTable.lo: ../../include/net-snmp/library/mib.h
 ./Rmon/alarmTable.lo: ../../include/net-snmp/mib_api.h
@@ -625,8 +640,8 @@
 ./Rmon/alarmTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./Rmon/alarmTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./Rmon/alarmTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./Rmon/alarmTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./Rmon/alarmTable.lo: ../../include/net-snmp/library/snmpusm.h
+./Rmon/alarmTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./Rmon/alarmTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./Rmon/alarmTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./Rmon/alarmTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -694,7 +709,9 @@
 ./Rmon/event.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./Rmon/event.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./Rmon/event.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./Rmon/event.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./Rmon/event.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./Rmon/event.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./Rmon/event.lo: ../../include/net-snmp/library/ucd_compat.h
 ./Rmon/event.lo: ../../include/net-snmp/library/mib.h
 ./Rmon/event.lo: ../../include/net-snmp/mib_api.h
@@ -734,8 +751,8 @@
 ./Rmon/event.lo: ../../include/net-snmp/library/lcd_time.h
 ./Rmon/event.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./Rmon/event.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./Rmon/event.lo: ../../include/net-snmp/library/snmptsm.h
 ./Rmon/event.lo: ../../include/net-snmp/library/snmpusm.h
+./Rmon/event.lo: ../../include/net-snmp/library/snmptsm.h
 ./Rmon/event.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./Rmon/event.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./Rmon/event.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -802,7 +819,9 @@
 ./Rmon/history.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./Rmon/history.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./Rmon/history.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./Rmon/history.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./Rmon/history.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./Rmon/history.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./Rmon/history.lo: ../../include/net-snmp/library/ucd_compat.h
 ./Rmon/history.lo: ../../include/net-snmp/library/mib.h
 ./Rmon/history.lo: ../../include/net-snmp/mib_api.h
@@ -843,8 +862,8 @@
 ./Rmon/history.lo: ../../include/net-snmp/library/lcd_time.h
 ./Rmon/history.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./Rmon/history.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./Rmon/history.lo: ../../include/net-snmp/library/snmptsm.h
 ./Rmon/history.lo: ../../include/net-snmp/library/snmpusm.h
+./Rmon/history.lo: ../../include/net-snmp/library/snmptsm.h
 ./Rmon/history.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./Rmon/history.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./Rmon/history.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -911,7 +930,9 @@
 ./Rmon/rows.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./Rmon/rows.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./Rmon/rows.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./Rmon/rows.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./Rmon/rows.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./Rmon/rows.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./Rmon/rows.lo: ../../include/net-snmp/library/ucd_compat.h
 ./Rmon/rows.lo: ../../include/net-snmp/library/mib.h
 ./Rmon/rows.lo: ../../include/net-snmp/mib_api.h
@@ -952,8 +973,8 @@
 ./Rmon/rows.lo: ../../include/net-snmp/library/lcd_time.h
 ./Rmon/rows.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./Rmon/rows.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./Rmon/rows.lo: ../../include/net-snmp/library/snmptsm.h
 ./Rmon/rows.lo: ../../include/net-snmp/library/snmpusm.h
+./Rmon/rows.lo: ../../include/net-snmp/library/snmptsm.h
 ./Rmon/rows.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./Rmon/rows.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./Rmon/rows.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1020,7 +1041,9 @@
 ./Rmon/statistics.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./Rmon/statistics.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./Rmon/statistics.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./Rmon/statistics.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./Rmon/statistics.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./Rmon/statistics.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./Rmon/statistics.lo: ../../include/net-snmp/library/ucd_compat.h
 ./Rmon/statistics.lo: ../../include/net-snmp/library/mib.h
 ./Rmon/statistics.lo: ../../include/net-snmp/mib_api.h
@@ -1061,8 +1084,8 @@
 ./Rmon/statistics.lo: ../../include/net-snmp/library/lcd_time.h
 ./Rmon/statistics.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./Rmon/statistics.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./Rmon/statistics.lo: ../../include/net-snmp/library/snmptsm.h
 ./Rmon/statistics.lo: ../../include/net-snmp/library/snmpusm.h
+./Rmon/statistics.lo: ../../include/net-snmp/library/snmptsm.h
 ./Rmon/statistics.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./Rmon/statistics.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./Rmon/statistics.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1131,7 +1154,9 @@
 ./agent/extend.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./agent/extend.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agent/extend.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agent/extend.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agent/extend.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./agent/extend.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agent/extend.lo: ../../include/net-snmp/library/ucd_compat.h
 ./agent/extend.lo: ../../include/net-snmp/library/mib.h
 ./agent/extend.lo: ../../include/net-snmp/mib_api.h
@@ -1171,8 +1196,8 @@
 ./agent/extend.lo: ../../include/net-snmp/library/lcd_time.h
 ./agent/extend.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./agent/extend.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./agent/extend.lo: ../../include/net-snmp/library/snmptsm.h
 ./agent/extend.lo: ../../include/net-snmp/library/snmpusm.h
+./agent/extend.lo: ../../include/net-snmp/library/snmptsm.h
 ./agent/extend.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agent/extend.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./agent/extend.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1212,7 +1237,6 @@
 ./agent/extend.lo: ../../include/net-snmp/agent/snmp_get_statistic.h
 ./agent/extend.lo: ../../include/net-snmp/agent/agent_callbacks.h
 ./agent/extend.lo: agent/extend.h utilities/execute.h struct.h
-./agent/extend.lo: util_funcs/header_simple_table.h mibdefs.h
 ./agent/nsCache.lo: ../../include/net-snmp/net-snmp-config.h
 ./agent/nsCache.lo: ../../include/net-snmp/net-snmp-features.h
 ./agent/nsCache.lo: ../../include/net-snmp/net-snmp-includes.h
@@ -1242,7 +1266,9 @@
 ./agent/nsCache.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./agent/nsCache.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agent/nsCache.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agent/nsCache.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agent/nsCache.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./agent/nsCache.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agent/nsCache.lo: ../../include/net-snmp/library/ucd_compat.h
 ./agent/nsCache.lo: ../../include/net-snmp/library/mib.h
 ./agent/nsCache.lo: ../../include/net-snmp/mib_api.h
@@ -1282,8 +1308,8 @@
 ./agent/nsCache.lo: ../../include/net-snmp/library/lcd_time.h
 ./agent/nsCache.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./agent/nsCache.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./agent/nsCache.lo: ../../include/net-snmp/library/snmptsm.h
 ./agent/nsCache.lo: ../../include/net-snmp/library/snmpusm.h
+./agent/nsCache.lo: ../../include/net-snmp/library/snmptsm.h
 ./agent/nsCache.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agent/nsCache.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./agent/nsCache.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1350,7 +1376,9 @@
 ./agent/nsDebug.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./agent/nsDebug.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agent/nsDebug.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agent/nsDebug.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agent/nsDebug.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./agent/nsDebug.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agent/nsDebug.lo: ../../include/net-snmp/library/ucd_compat.h
 ./agent/nsDebug.lo: ../../include/net-snmp/library/mib.h
 ./agent/nsDebug.lo: ../../include/net-snmp/mib_api.h
@@ -1391,8 +1419,8 @@
 ./agent/nsDebug.lo: ../../include/net-snmp/library/lcd_time.h
 ./agent/nsDebug.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./agent/nsDebug.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./agent/nsDebug.lo: ../../include/net-snmp/library/snmptsm.h
 ./agent/nsDebug.lo: ../../include/net-snmp/library/snmpusm.h
+./agent/nsDebug.lo: ../../include/net-snmp/library/snmptsm.h
 ./agent/nsDebug.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agent/nsDebug.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./agent/nsDebug.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1460,7 +1488,9 @@
 ./agent/nsLogging.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./agent/nsLogging.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agent/nsLogging.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agent/nsLogging.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agent/nsLogging.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./agent/nsLogging.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agent/nsLogging.lo: ../../include/net-snmp/library/ucd_compat.h
 ./agent/nsLogging.lo: ../../include/net-snmp/library/mib.h
 ./agent/nsLogging.lo: ../../include/net-snmp/mib_api.h
@@ -1500,8 +1530,8 @@
 ./agent/nsLogging.lo: ../../include/net-snmp/library/lcd_time.h
 ./agent/nsLogging.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./agent/nsLogging.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./agent/nsLogging.lo: ../../include/net-snmp/library/snmptsm.h
 ./agent/nsLogging.lo: ../../include/net-snmp/library/snmpusm.h
+./agent/nsLogging.lo: ../../include/net-snmp/library/snmptsm.h
 ./agent/nsLogging.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agent/nsLogging.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./agent/nsLogging.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1569,7 +1599,9 @@
 ./agent/nsModuleTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./agent/nsModuleTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agent/nsModuleTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agent/nsModuleTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agent/nsModuleTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./agent/nsModuleTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agent/nsModuleTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./agent/nsModuleTable.lo: ../../include/net-snmp/library/mib.h
 ./agent/nsModuleTable.lo: ../../include/net-snmp/mib_api.h
@@ -1609,8 +1641,8 @@
 ./agent/nsModuleTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./agent/nsModuleTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./agent/nsModuleTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./agent/nsModuleTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./agent/nsModuleTable.lo: ../../include/net-snmp/library/snmpusm.h
+./agent/nsModuleTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./agent/nsModuleTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agent/nsModuleTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./agent/nsModuleTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1678,7 +1710,9 @@
 ./agent/nsTransactionTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./agent/nsTransactionTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agent/nsTransactionTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agent/nsTransactionTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agent/nsTransactionTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./agent/nsTransactionTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agent/nsTransactionTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./agent/nsTransactionTable.lo: ../../include/net-snmp/library/mib.h
 ./agent/nsTransactionTable.lo: ../../include/net-snmp/mib_api.h
@@ -1718,8 +1752,8 @@
 ./agent/nsTransactionTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./agent/nsTransactionTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./agent/nsTransactionTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./agent/nsTransactionTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./agent/nsTransactionTable.lo: ../../include/net-snmp/library/snmpusm.h
+./agent/nsTransactionTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./agent/nsTransactionTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agent/nsTransactionTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./agent/nsTransactionTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1788,7 +1822,9 @@
 ./agent/nsVacmAccessTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./agent/nsVacmAccessTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agent/nsVacmAccessTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agent/nsVacmAccessTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agent/nsVacmAccessTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./agent/nsVacmAccessTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agent/nsVacmAccessTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./agent/nsVacmAccessTable.lo: ../../include/net-snmp/library/mib.h
 ./agent/nsVacmAccessTable.lo: ../../include/net-snmp/mib_api.h
@@ -1828,8 +1864,8 @@
 ./agent/nsVacmAccessTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./agent/nsVacmAccessTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./agent/nsVacmAccessTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./agent/nsVacmAccessTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./agent/nsVacmAccessTable.lo: ../../include/net-snmp/library/snmpusm.h
+./agent/nsVacmAccessTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./agent/nsVacmAccessTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agent/nsVacmAccessTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./agent/nsVacmAccessTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -1897,7 +1933,9 @@
 ./agentx/agentx_config.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./agentx/agentx_config.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agentx/agentx_config.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agentx/agentx_config.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agentx/agentx_config.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./agentx/agentx_config.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agentx/agentx_config.lo: ../../include/net-snmp/library/ucd_compat.h
 ./agentx/agentx_config.lo: ../../include/net-snmp/library/mib.h
 ./agentx/agentx_config.lo: ../../include/net-snmp/mib_api.h
@@ -1937,8 +1975,8 @@
 ./agentx/agentx_config.lo: ../../include/net-snmp/library/lcd_time.h
 ./agentx/agentx_config.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./agentx/agentx_config.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./agentx/agentx_config.lo: ../../include/net-snmp/library/snmptsm.h
 ./agentx/agentx_config.lo: ../../include/net-snmp/library/snmpusm.h
+./agentx/agentx_config.lo: ../../include/net-snmp/library/snmptsm.h
 ./agentx/agentx_config.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agentx/agentx_config.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./agentx/agentx_config.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2007,7 +2045,9 @@
 ./agentx/client.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./agentx/client.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agentx/client.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agentx/client.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agentx/client.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./agentx/client.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agentx/client.lo: ../../include/net-snmp/library/ucd_compat.h
 ./agentx/client.lo: ../../include/net-snmp/library/mib.h
 ./agentx/client.lo: ../../include/net-snmp/mib_api.h
@@ -2047,8 +2087,8 @@
 ./agentx/client.lo: ../../include/net-snmp/library/lcd_time.h
 ./agentx/client.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./agentx/client.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./agentx/client.lo: ../../include/net-snmp/library/snmptsm.h
 ./agentx/client.lo: ../../include/net-snmp/library/snmpusm.h
+./agentx/client.lo: ../../include/net-snmp/library/snmptsm.h
 ./agentx/client.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agentx/client.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./agentx/client.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2118,7 +2158,9 @@
 ./agentx/master.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./agentx/master.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agentx/master.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agentx/master.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agentx/master.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./agentx/master.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agentx/master.lo: ../../include/net-snmp/library/ucd_compat.h
 ./agentx/master.lo: ../../include/net-snmp/library/mib.h
 ./agentx/master.lo: ../../include/net-snmp/mib_api.h
@@ -2158,8 +2200,8 @@
 ./agentx/master.lo: ../../include/net-snmp/library/lcd_time.h
 ./agentx/master.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./agentx/master.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./agentx/master.lo: ../../include/net-snmp/library/snmptsm.h
 ./agentx/master.lo: ../../include/net-snmp/library/snmpusm.h
+./agentx/master.lo: ../../include/net-snmp/library/snmptsm.h
 ./agentx/master.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agentx/master.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./agentx/master.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2228,7 +2270,9 @@
 ./agentx/master_admin.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./agentx/master_admin.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agentx/master_admin.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agentx/master_admin.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agentx/master_admin.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./agentx/master_admin.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agentx/master_admin.lo: ../../include/net-snmp/library/ucd_compat.h
 ./agentx/master_admin.lo: ../../include/net-snmp/library/mib.h
 ./agentx/master_admin.lo: ../../include/net-snmp/mib_api.h
@@ -2268,8 +2312,8 @@
 ./agentx/master_admin.lo: ../../include/net-snmp/library/lcd_time.h
 ./agentx/master_admin.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./agentx/master_admin.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./agentx/master_admin.lo: ../../include/net-snmp/library/snmptsm.h
 ./agentx/master_admin.lo: ../../include/net-snmp/library/snmpusm.h
+./agentx/master_admin.lo: ../../include/net-snmp/library/snmptsm.h
 ./agentx/master_admin.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agentx/master_admin.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./agentx/master_admin.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2342,7 +2386,9 @@
 ./agentx/protocol.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./agentx/protocol.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agentx/protocol.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agentx/protocol.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agentx/protocol.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./agentx/protocol.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agentx/protocol.lo: ../../include/net-snmp/library/ucd_compat.h
 ./agentx/protocol.lo: ../../include/net-snmp/library/mib.h
 ./agentx/protocol.lo: ../../include/net-snmp/mib_api.h
@@ -2383,8 +2429,8 @@
 ./agentx/protocol.lo: ../../include/net-snmp/library/lcd_time.h
 ./agentx/protocol.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./agentx/protocol.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./agentx/protocol.lo: ../../include/net-snmp/library/snmptsm.h
 ./agentx/protocol.lo: ../../include/net-snmp/library/snmpusm.h
+./agentx/protocol.lo: ../../include/net-snmp/library/snmptsm.h
 ./agentx/protocol.lo: agentx/protocol.h
 ./agentx/subagent.lo: ../../include/net-snmp/net-snmp-config.h
 ./agentx/subagent.lo: ../../include/net-snmp/net-snmp-features.h
@@ -2415,7 +2461,9 @@
 ./agentx/subagent.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./agentx/subagent.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agentx/subagent.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agentx/subagent.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agentx/subagent.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./agentx/subagent.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agentx/subagent.lo: ../../include/net-snmp/library/ucd_compat.h
 ./agentx/subagent.lo: ../../include/net-snmp/library/mib.h
 ./agentx/subagent.lo: ../../include/net-snmp/mib_api.h
@@ -2455,8 +2503,8 @@
 ./agentx/subagent.lo: ../../include/net-snmp/library/lcd_time.h
 ./agentx/subagent.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./agentx/subagent.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./agentx/subagent.lo: ../../include/net-snmp/library/snmptsm.h
 ./agentx/subagent.lo: ../../include/net-snmp/library/snmpusm.h
+./agentx/subagent.lo: ../../include/net-snmp/library/snmptsm.h
 ./agentx/subagent.lo: ../../include/net-snmp/agent/agent_index.h
 ./agentx/subagent.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./agentx/subagent.lo: ../../include/net-snmp/agent/mib_module_config.h
@@ -2531,7 +2579,9 @@
 ./deliver/deliverByNotify.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./deliver/deliverByNotify.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./deliver/deliverByNotify.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./deliver/deliverByNotify.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./deliver/deliverByNotify.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./deliver/deliverByNotify.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./deliver/deliverByNotify.lo: ../../include/net-snmp/library/ucd_compat.h
 ./deliver/deliverByNotify.lo: ../../include/net-snmp/library/mib.h
 ./deliver/deliverByNotify.lo: ../../include/net-snmp/mib_api.h
@@ -2571,8 +2621,8 @@
 ./deliver/deliverByNotify.lo: ../../include/net-snmp/library/lcd_time.h
 ./deliver/deliverByNotify.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./deliver/deliverByNotify.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./deliver/deliverByNotify.lo: ../../include/net-snmp/library/snmptsm.h
 ./deliver/deliverByNotify.lo: ../../include/net-snmp/library/snmpusm.h
+./deliver/deliverByNotify.lo: ../../include/net-snmp/library/snmptsm.h
 ./deliver/deliverByNotify.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./deliver/deliverByNotify.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./deliver/deliverByNotify.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2640,7 +2690,9 @@
 ./disman/mteEventNotificationTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./disman/mteEventNotificationTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./disman/mteEventNotificationTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./disman/mteEventNotificationTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./disman/mteEventNotificationTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./disman/mteEventNotificationTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./disman/mteEventNotificationTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./disman/mteEventNotificationTable.lo: ../../include/net-snmp/library/mib.h
 ./disman/mteEventNotificationTable.lo: ../../include/net-snmp/mib_api.h
@@ -2680,8 +2732,8 @@
 ./disman/mteEventNotificationTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./disman/mteEventNotificationTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./disman/mteEventNotificationTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./disman/mteEventNotificationTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteEventNotificationTable.lo: ../../include/net-snmp/library/snmpusm.h
+./disman/mteEventNotificationTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteEventNotificationTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./disman/mteEventNotificationTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./disman/mteEventNotificationTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2749,7 +2801,9 @@
 ./disman/mteEventTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./disman/mteEventTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./disman/mteEventTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./disman/mteEventTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./disman/mteEventTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./disman/mteEventTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./disman/mteEventTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./disman/mteEventTable.lo: ../../include/net-snmp/library/mib.h
 ./disman/mteEventTable.lo: ../../include/net-snmp/mib_api.h
@@ -2789,8 +2843,8 @@
 ./disman/mteEventTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./disman/mteEventTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./disman/mteEventTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./disman/mteEventTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteEventTable.lo: ../../include/net-snmp/library/snmpusm.h
+./disman/mteEventTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteEventTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./disman/mteEventTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./disman/mteEventTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2861,7 +2915,9 @@
 ./disman/mteObjectsTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./disman/mteObjectsTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./disman/mteObjectsTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./disman/mteObjectsTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./disman/mteObjectsTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./disman/mteObjectsTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./disman/mteObjectsTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./disman/mteObjectsTable.lo: ../../include/net-snmp/library/mib.h
 ./disman/mteObjectsTable.lo: ../../include/net-snmp/mib_api.h
@@ -2901,8 +2957,8 @@
 ./disman/mteObjectsTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./disman/mteObjectsTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./disman/mteObjectsTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./disman/mteObjectsTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteObjectsTable.lo: ../../include/net-snmp/library/snmpusm.h
+./disman/mteObjectsTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteObjectsTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./disman/mteObjectsTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./disman/mteObjectsTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -2970,7 +3026,9 @@
 ./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/library/mib.h
 ./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/mib_api.h
@@ -3011,8 +3069,8 @@
 ./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/library/snmpusm.h
+./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./disman/mteTriggerBooleanTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -3081,7 +3139,9 @@
 ./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/library/mib.h
 ./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/mib_api.h
@@ -3122,8 +3182,8 @@
 ./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/library/snmpusm.h
+./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./disman/mteTriggerDeltaTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -3192,7 +3252,9 @@
 ./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/library/mib.h
 ./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/mib_api.h
@@ -3233,8 +3295,8 @@
 ./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/library/snmpusm.h
+./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./disman/mteTriggerExistenceTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -3304,7 +3366,9 @@
 ./disman/mteTriggerTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./disman/mteTriggerTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./disman/mteTriggerTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./disman/mteTriggerTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./disman/mteTriggerTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./disman/mteTriggerTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./disman/mteTriggerTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./disman/mteTriggerTable.lo: ../../include/net-snmp/library/mib.h
 ./disman/mteTriggerTable.lo: ../../include/net-snmp/mib_api.h
@@ -3344,8 +3408,8 @@
 ./disman/mteTriggerTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./disman/mteTriggerTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./disman/mteTriggerTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./disman/mteTriggerTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteTriggerTable.lo: ../../include/net-snmp/library/snmpusm.h
+./disman/mteTriggerTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteTriggerTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./disman/mteTriggerTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./disman/mteTriggerTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -3418,7 +3482,9 @@
 ./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/library/mib.h
 ./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/mib_api.h
@@ -3459,8 +3525,8 @@
 ./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/library/snmpusm.h
+./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./disman/mteTriggerThresholdTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -3529,7 +3595,9 @@
 ./examples/data_set.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./examples/data_set.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./examples/data_set.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./examples/data_set.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./examples/data_set.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./examples/data_set.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./examples/data_set.lo: ../../include/net-snmp/library/ucd_compat.h
 ./examples/data_set.lo: ../../include/net-snmp/library/mib.h
 ./examples/data_set.lo: ../../include/net-snmp/mib_api.h
@@ -3570,8 +3638,8 @@
 ./examples/data_set.lo: ../../include/net-snmp/library/lcd_time.h
 ./examples/data_set.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./examples/data_set.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./examples/data_set.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/data_set.lo: ../../include/net-snmp/library/snmpusm.h
+./examples/data_set.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/data_set.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./examples/data_set.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./examples/data_set.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -3637,7 +3705,9 @@
 ./examples/delayed_instance.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./examples/delayed_instance.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./examples/delayed_instance.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./examples/delayed_instance.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./examples/delayed_instance.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./examples/delayed_instance.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./examples/delayed_instance.lo: ../../include/net-snmp/library/ucd_compat.h
 ./examples/delayed_instance.lo: ../../include/net-snmp/library/mib.h
 ./examples/delayed_instance.lo: ../../include/net-snmp/mib_api.h
@@ -3678,8 +3748,8 @@
 ./examples/delayed_instance.lo: ../../include/net-snmp/library/lcd_time.h
 ./examples/delayed_instance.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./examples/delayed_instance.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./examples/delayed_instance.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/delayed_instance.lo: ../../include/net-snmp/library/snmpusm.h
+./examples/delayed_instance.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/delayed_instance.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./examples/delayed_instance.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./examples/delayed_instance.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -3746,7 +3816,9 @@
 ./examples/example.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./examples/example.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./examples/example.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./examples/example.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./examples/example.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./examples/example.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./examples/example.lo: ../../include/net-snmp/library/ucd_compat.h
 ./examples/example.lo: ../../include/net-snmp/library/mib.h
 ./examples/example.lo: ../../include/net-snmp/mib_api.h
@@ -3787,8 +3859,8 @@
 ./examples/example.lo: ../../include/net-snmp/library/lcd_time.h
 ./examples/example.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./examples/example.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./examples/example.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/example.lo: ../../include/net-snmp/library/snmpusm.h
+./examples/example.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/example.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./examples/example.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./examples/example.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -3856,7 +3928,9 @@
 ./examples/netSnmpHostsTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./examples/netSnmpHostsTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./examples/netSnmpHostsTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./examples/netSnmpHostsTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./examples/netSnmpHostsTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./examples/netSnmpHostsTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./examples/netSnmpHostsTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./examples/netSnmpHostsTable.lo: ../../include/net-snmp/library/mib.h
 ./examples/netSnmpHostsTable.lo: ../../include/net-snmp/mib_api.h
@@ -3896,8 +3970,8 @@
 ./examples/netSnmpHostsTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./examples/netSnmpHostsTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./examples/netSnmpHostsTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./examples/netSnmpHostsTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/netSnmpHostsTable.lo: ../../include/net-snmp/library/snmpusm.h
+./examples/netSnmpHostsTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/netSnmpHostsTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./examples/netSnmpHostsTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./examples/netSnmpHostsTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -3968,7 +4042,9 @@
 ./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/library/ucd_compat.h
 ./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/library/mib.h
 ./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/mib_api.h
@@ -4009,8 +4085,8 @@
 ./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/library/lcd_time.h
 ./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/library/snmpusm.h
+./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./examples/netSnmpHostsTable_access.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -4079,7 +4155,9 @@
 ./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/library/ucd_compat.h
 ./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/library/mib.h
 ./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/mib_api.h
@@ -4119,8 +4197,8 @@
 ./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/library/lcd_time.h
 ./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/library/snmpusm.h
+./examples/netSnmpHostsTable_checkfns.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/netSnmpHostsTable_checkfns.lo: ./examples/netSnmpHostsTable_checkfns.h
 ./examples/netSnmpHostsTable_checkfns.lo: ./examples/netSnmpHostsTable_checkfns_local.h
 ./examples/netSnmpHostsTable_checkfns.lo: ./examples/netSnmpHostsTable_enums.h
@@ -4152,7 +4230,9 @@
 ./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/library/ucd_compat.h
 ./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/library/mib.h
 ./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/mib_api.h
@@ -4193,8 +4273,8 @@
 ./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/library/lcd_time.h
 ./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/library/snmpusm.h
+./examples/netSnmpHostsTable_checkfns_local.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/netSnmpHostsTable_checkfns_local.lo: ./examples/netSnmpHostsTable_checkfns.h
 ./examples/netSnmpHostsTable_checkfns_local.lo: ./examples/netSnmpHostsTable_enums.h
 ./examples/netSnmpHostsTable_checkfns_local.lo: ./examples/netSnmpHostsTable_checkfns_local.h
@@ -4226,7 +4306,9 @@
 ./examples/notification.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./examples/notification.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./examples/notification.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./examples/notification.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./examples/notification.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./examples/notification.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./examples/notification.lo: ../../include/net-snmp/library/ucd_compat.h
 ./examples/notification.lo: ../../include/net-snmp/library/mib.h
 ./examples/notification.lo: ../../include/net-snmp/mib_api.h
@@ -4267,8 +4349,8 @@
 ./examples/notification.lo: ../../include/net-snmp/library/lcd_time.h
 ./examples/notification.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./examples/notification.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./examples/notification.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/notification.lo: ../../include/net-snmp/library/snmpusm.h
+./examples/notification.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/notification.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./examples/notification.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./examples/notification.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -4336,7 +4418,9 @@
 ./examples/scalar_int.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./examples/scalar_int.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./examples/scalar_int.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./examples/scalar_int.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./examples/scalar_int.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./examples/scalar_int.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./examples/scalar_int.lo: ../../include/net-snmp/library/ucd_compat.h
 ./examples/scalar_int.lo: ../../include/net-snmp/library/mib.h
 ./examples/scalar_int.lo: ../../include/net-snmp/mib_api.h
@@ -4376,8 +4460,8 @@
 ./examples/scalar_int.lo: ../../include/net-snmp/library/lcd_time.h
 ./examples/scalar_int.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./examples/scalar_int.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./examples/scalar_int.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/scalar_int.lo: ../../include/net-snmp/library/snmpusm.h
+./examples/scalar_int.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/scalar_int.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./examples/scalar_int.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./examples/scalar_int.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -4443,7 +4527,9 @@
 ./examples/ucdDemoPublic.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./examples/ucdDemoPublic.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./examples/ucdDemoPublic.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./examples/ucdDemoPublic.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./examples/ucdDemoPublic.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./examples/ucdDemoPublic.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./examples/ucdDemoPublic.lo: ../../include/net-snmp/library/ucd_compat.h
 ./examples/ucdDemoPublic.lo: ../../include/net-snmp/library/mib.h
 ./examples/ucdDemoPublic.lo: ../../include/net-snmp/mib_api.h
@@ -4484,8 +4570,8 @@
 ./examples/ucdDemoPublic.lo: ../../include/net-snmp/library/lcd_time.h
 ./examples/ucdDemoPublic.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./examples/ucdDemoPublic.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./examples/ucdDemoPublic.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/ucdDemoPublic.lo: ../../include/net-snmp/library/snmpusm.h
+./examples/ucdDemoPublic.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/ucdDemoPublic.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./examples/ucdDemoPublic.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./examples/ucdDemoPublic.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -4553,7 +4639,9 @@
 ./examples/watched.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./examples/watched.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./examples/watched.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./examples/watched.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./examples/watched.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./examples/watched.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./examples/watched.lo: ../../include/net-snmp/library/ucd_compat.h
 ./examples/watched.lo: ../../include/net-snmp/library/mib.h
 ./examples/watched.lo: ../../include/net-snmp/mib_api.h
@@ -4594,8 +4682,8 @@
 ./examples/watched.lo: ../../include/net-snmp/library/lcd_time.h
 ./examples/watched.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./examples/watched.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./examples/watched.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/watched.lo: ../../include/net-snmp/library/snmpusm.h
+./examples/watched.lo: ../../include/net-snmp/library/snmptsm.h
 ./examples/watched.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./examples/watched.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./examples/watched.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -4661,7 +4749,9 @@
 ./host/hrSWInstalledTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hrSWInstalledTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hrSWInstalledTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hrSWInstalledTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hrSWInstalledTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hrSWInstalledTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hrSWInstalledTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hrSWInstalledTable.lo: ../../include/net-snmp/library/mib.h
 ./host/hrSWInstalledTable.lo: ../../include/net-snmp/mib_api.h
@@ -4702,8 +4792,8 @@
 ./host/hrSWInstalledTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hrSWInstalledTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hrSWInstalledTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hrSWInstalledTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hrSWInstalledTable.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hrSWInstalledTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hrSWInstalledTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./host/hrSWInstalledTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./host/hrSWInstalledTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -4771,7 +4861,9 @@
 ./host/hrSWRunPerfTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hrSWRunPerfTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hrSWRunPerfTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hrSWRunPerfTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hrSWRunPerfTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hrSWRunPerfTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hrSWRunPerfTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hrSWRunPerfTable.lo: ../../include/net-snmp/library/mib.h
 ./host/hrSWRunPerfTable.lo: ../../include/net-snmp/mib_api.h
@@ -4812,8 +4904,8 @@
 ./host/hrSWRunPerfTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hrSWRunPerfTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hrSWRunPerfTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hrSWRunPerfTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hrSWRunPerfTable.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hrSWRunPerfTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hrSWRunPerfTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./host/hrSWRunPerfTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./host/hrSWRunPerfTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -4882,7 +4974,9 @@
 ./host/hrSWRunTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hrSWRunTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hrSWRunTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hrSWRunTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hrSWRunTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hrSWRunTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hrSWRunTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hrSWRunTable.lo: ../../include/net-snmp/library/mib.h
 ./host/hrSWRunTable.lo: ../../include/net-snmp/mib_api.h
@@ -4923,8 +5017,8 @@
 ./host/hrSWRunTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hrSWRunTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hrSWRunTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hrSWRunTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hrSWRunTable.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hrSWRunTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hrSWRunTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./host/hrSWRunTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./host/hrSWRunTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -4993,7 +5087,9 @@
 ./host/hr_device.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hr_device.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hr_device.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hr_device.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hr_device.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hr_device.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hr_device.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hr_device.lo: ../../include/net-snmp/library/mib.h
 ./host/hr_device.lo: ../../include/net-snmp/mib_api.h
@@ -5034,8 +5130,8 @@
 ./host/hr_device.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hr_device.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hr_device.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hr_device.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_device.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hr_device.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_device.lo: ../../include/net-snmp/agent/snmp_agent.h
 ./host/hr_device.lo: ../../include/net-snmp/agent/agent_handler.h
 ./host/hr_device.lo: ../../include/net-snmp/agent/snmp_vars.h
@@ -5071,7 +5167,9 @@
 ./host/hr_disk.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hr_disk.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hr_disk.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hr_disk.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hr_disk.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hr_disk.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hr_disk.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hr_disk.lo: ../../include/net-snmp/library/mib.h
 ./host/hr_disk.lo: ../../include/net-snmp/mib_api.h
@@ -5112,8 +5210,8 @@
 ./host/hr_disk.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hr_disk.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hr_disk.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hr_disk.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_disk.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hr_disk.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_disk.lo: ../../include/net-snmp/agent/snmp_agent.h
 ./host/hr_disk.lo: ../../include/net-snmp/agent/agent_handler.h
 ./host/hr_disk.lo: ../../include/net-snmp/agent/snmp_vars.h
@@ -5151,7 +5249,9 @@
 ./host/hr_filesys.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hr_filesys.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hr_filesys.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hr_filesys.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hr_filesys.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hr_filesys.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hr_filesys.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hr_filesys.lo: ../../include/net-snmp/library/mib.h
 ./host/hr_filesys.lo: ../../include/net-snmp/mib_api.h
@@ -5191,8 +5291,8 @@
 ./host/hr_filesys.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hr_filesys.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hr_filesys.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hr_filesys.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_filesys.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hr_filesys.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_filesys.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./host/hr_filesys.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./host/hr_filesys.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -5262,7 +5362,9 @@
 ./host/hr_network.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hr_network.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hr_network.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hr_network.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hr_network.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hr_network.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hr_network.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hr_network.lo: ../../include/net-snmp/library/mib.h
 ./host/hr_network.lo: ../../include/net-snmp/mib_api.h
@@ -5302,8 +5404,8 @@
 ./host/hr_network.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hr_network.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hr_network.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hr_network.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_network.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hr_network.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_network.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./host/hr_network.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./host/hr_network.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -5371,7 +5473,9 @@
 ./host/hr_other.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hr_other.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hr_other.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hr_other.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hr_other.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hr_other.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hr_other.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hr_other.lo: ../../include/net-snmp/library/mib.h
 ./host/hr_other.lo: ../../include/net-snmp/mib_api.h
@@ -5412,8 +5516,8 @@
 ./host/hr_other.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hr_other.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hr_other.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hr_other.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_other.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hr_other.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_other.lo: ../../include/net-snmp/agent/snmp_agent.h
 ./host/hr_other.lo: ../../include/net-snmp/agent/agent_handler.h
 ./host/hr_other.lo: ../../include/net-snmp/agent/snmp_vars.h
@@ -5450,7 +5554,9 @@
 ./host/hr_partition.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hr_partition.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hr_partition.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hr_partition.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hr_partition.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hr_partition.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hr_partition.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hr_partition.lo: ../../include/net-snmp/library/mib.h
 ./host/hr_partition.lo: ../../include/net-snmp/mib_api.h
@@ -5491,8 +5597,8 @@
 ./host/hr_partition.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hr_partition.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hr_partition.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hr_partition.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_partition.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hr_partition.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_partition.lo: ../../include/net-snmp/agent/snmp_agent.h
 ./host/hr_partition.lo: ../../include/net-snmp/agent/agent_handler.h
 ./host/hr_partition.lo: ../../include/net-snmp/agent/snmp_vars.h
@@ -5530,7 +5636,9 @@
 ./host/hr_print.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hr_print.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hr_print.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hr_print.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hr_print.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hr_print.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hr_print.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hr_print.lo: ../../include/net-snmp/library/mib.h
 ./host/hr_print.lo: ../../include/net-snmp/mib_api.h
@@ -5571,8 +5679,8 @@
 ./host/hr_print.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hr_print.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hr_print.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hr_print.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_print.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hr_print.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_print.lo: ../../include/net-snmp/agent/snmp_agent.h
 ./host/hr_print.lo: ../../include/net-snmp/agent/agent_handler.h
 ./host/hr_print.lo: ../../include/net-snmp/agent/snmp_vars.h
@@ -5611,7 +5719,9 @@
 ./host/hr_proc.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hr_proc.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hr_proc.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hr_proc.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hr_proc.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hr_proc.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hr_proc.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hr_proc.lo: ../../include/net-snmp/library/mib.h
 ./host/hr_proc.lo: ../../include/net-snmp/mib_api.h
@@ -5652,8 +5762,8 @@
 ./host/hr_proc.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hr_proc.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hr_proc.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hr_proc.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_proc.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hr_proc.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_proc.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./host/hr_proc.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./host/hr_proc.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -5724,7 +5834,9 @@
 ./host/hr_storage.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hr_storage.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hr_storage.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hr_storage.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hr_storage.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hr_storage.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hr_storage.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hr_storage.lo: ../../include/net-snmp/library/mib.h
 ./host/hr_storage.lo: ../../include/net-snmp/mib_api.h
@@ -5765,8 +5877,8 @@
 ./host/hr_storage.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hr_storage.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hr_storage.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hr_storage.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_storage.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hr_storage.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_storage.lo: ../../include/net-snmp/agent/snmp_agent.h
 ./host/hr_storage.lo: ../../include/net-snmp/agent/agent_handler.h
 ./host/hr_storage.lo: ../../include/net-snmp/agent/snmp_vars.h
@@ -5837,7 +5949,9 @@
 ./host/hr_swinst.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hr_swinst.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hr_swinst.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hr_swinst.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hr_swinst.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hr_swinst.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hr_swinst.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hr_swinst.lo: ../../include/net-snmp/library/mib.h
 ./host/hr_swinst.lo: ../../include/net-snmp/mib_api.h
@@ -5877,8 +5991,8 @@
 ./host/hr_swinst.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hr_swinst.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hr_swinst.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hr_swinst.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_swinst.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hr_swinst.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_swinst.lo: ../../include/net-snmp/agent/snmp_agent.h
 ./host/hr_swinst.lo: ../../include/net-snmp/agent/agent_handler.h
 ./host/hr_swinst.lo: ../../include/net-snmp/agent/snmp_vars.h
@@ -5910,7 +6024,9 @@
 ./host/hr_swrun.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hr_swrun.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hr_swrun.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hr_swrun.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hr_swrun.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hr_swrun.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hr_swrun.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hr_swrun.lo: ../../include/net-snmp/library/mib.h
 ./host/hr_swrun.lo: ../../include/net-snmp/mib_api.h
@@ -5956,8 +6072,8 @@
 ./host/hr_swrun.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hr_swrun.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hr_swrun.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hr_swrun.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_swrun.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hr_swrun.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_swrun.lo: ../../include/net-snmp/agent/snmp_agent.h
 ./host/hr_swrun.lo: ../../include/net-snmp/agent/agent_handler.h
 ./host/hr_swrun.lo: ../../include/net-snmp/agent/snmp_vars.h
@@ -5996,7 +6112,9 @@
 ./host/hr_system.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hr_system.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hr_system.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hr_system.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hr_system.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hr_system.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hr_system.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hr_system.lo: ../../include/net-snmp/library/mib.h
 ./host/hr_system.lo: ../../include/net-snmp/mib_api.h
@@ -6036,8 +6154,8 @@
 ./host/hr_system.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hr_system.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hr_system.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hr_system.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_system.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hr_system.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hr_system.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./host/hr_system.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./host/hr_system.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -6107,7 +6225,9 @@
 ./host/hrh_filesys.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hrh_filesys.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hrh_filesys.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hrh_filesys.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hrh_filesys.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hrh_filesys.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hrh_filesys.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hrh_filesys.lo: ../../include/net-snmp/library/mib.h
 ./host/hrh_filesys.lo: ../../include/net-snmp/mib_api.h
@@ -6147,8 +6267,8 @@
 ./host/hrh_filesys.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hrh_filesys.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hrh_filesys.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hrh_filesys.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hrh_filesys.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hrh_filesys.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hrh_filesys.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./host/hrh_filesys.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./host/hrh_filesys.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -6218,7 +6338,9 @@
 ./host/hrh_storage.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./host/hrh_storage.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./host/hrh_storage.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./host/hrh_storage.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./host/hrh_storage.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./host/hrh_storage.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./host/hrh_storage.lo: ../../include/net-snmp/library/ucd_compat.h
 ./host/hrh_storage.lo: ../../include/net-snmp/library/mib.h
 ./host/hrh_storage.lo: ../../include/net-snmp/mib_api.h
@@ -6259,8 +6381,8 @@
 ./host/hrh_storage.lo: ../../include/net-snmp/library/lcd_time.h
 ./host/hrh_storage.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./host/hrh_storage.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./host/hrh_storage.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hrh_storage.lo: ../../include/net-snmp/library/snmpusm.h
+./host/hrh_storage.lo: ../../include/net-snmp/library/snmptsm.h
 ./host/hrh_storage.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./host/hrh_storage.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./host/hrh_storage.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -6331,7 +6453,9 @@
 ./ip-mib/ip_scalars.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ip-mib/ip_scalars.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ip-mib/ip_scalars.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ip-mib/ip_scalars.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ip-mib/ip_scalars.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ip-mib/ip_scalars.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ip-mib/ip_scalars.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ip-mib/ip_scalars.lo: ../../include/net-snmp/library/mib.h
 ./ip-mib/ip_scalars.lo: ../../include/net-snmp/mib_api.h
@@ -6371,8 +6495,8 @@
 ./ip-mib/ip_scalars.lo: ../../include/net-snmp/library/lcd_time.h
 ./ip-mib/ip_scalars.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ip-mib/ip_scalars.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ip-mib/ip_scalars.lo: ../../include/net-snmp/library/snmptsm.h
 ./ip-mib/ip_scalars.lo: ../../include/net-snmp/library/snmpusm.h
+./ip-mib/ip_scalars.lo: ../../include/net-snmp/library/snmptsm.h
 ./ip-mib/ip_scalars.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ip-mib/ip_scalars.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ip-mib/ip_scalars.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -6440,7 +6564,9 @@
 ./mibII/at.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/at.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/at.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/at.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/at.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/at.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/at.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/at.lo: ../../include/net-snmp/library/mib.h
 ./mibII/at.lo: ../../include/net-snmp/mib_api.h
@@ -6481,8 +6607,8 @@
 ./mibII/at.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/at.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/at.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/at.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/at.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/at.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/at.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/at.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/at.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -6550,7 +6676,9 @@
 ./mibII/icmp.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/icmp.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/icmp.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/icmp.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/icmp.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/icmp.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/icmp.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/icmp.lo: ../../include/net-snmp/library/mib.h
 ./mibII/icmp.lo: ../../include/net-snmp/mib_api.h
@@ -6591,8 +6719,8 @@
 ./mibII/icmp.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/icmp.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/icmp.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/icmp.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/icmp.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/icmp.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/icmp.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/icmp.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/icmp.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -6666,7 +6794,9 @@
 ./mibII/interfaces.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/interfaces.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/interfaces.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/interfaces.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/interfaces.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/interfaces.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/interfaces.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/interfaces.lo: ../../include/net-snmp/library/mib.h
 ./mibII/interfaces.lo: ../../include/net-snmp/mib_api.h
@@ -6706,8 +6836,8 @@
 ./mibII/interfaces.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/interfaces.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/interfaces.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/interfaces.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/interfaces.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/interfaces.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/interfaces.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/interfaces.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/interfaces.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -6783,7 +6913,9 @@
 ./mibII/ip.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/ip.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/ip.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/ip.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/ip.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/ip.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/ip.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/ip.lo: ../../include/net-snmp/library/mib.h
 ./mibII/ip.lo: ../../include/net-snmp/mib_api.h
@@ -6824,8 +6956,8 @@
 ./mibII/ip.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/ip.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/ip.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/ip.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/ip.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/ip.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/ip.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/ip.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/ip.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -6899,7 +7031,9 @@
 ./mibII/ipAddr.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/ipAddr.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/ipAddr.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/ipAddr.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/ipAddr.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/ipAddr.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/ipAddr.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/ipAddr.lo: ../../include/net-snmp/library/mib.h
 ./mibII/ipAddr.lo: ../../include/net-snmp/mib_api.h
@@ -6939,8 +7073,8 @@
 ./mibII/ipAddr.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/ipAddr.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/ipAddr.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/ipAddr.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/ipAddr.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/ipAddr.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/ipAddr.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/ipAddr.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/ipAddr.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -7012,7 +7146,9 @@
 ./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/library/mib.h
 ./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/mib_api.h
@@ -7052,8 +7188,8 @@
 ./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/ipCidrRouteTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -7126,7 +7262,9 @@
 ./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/library/mib.h
 ./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/mib_api.h
@@ -7167,8 +7305,8 @@
 ./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/ipCidrRouteTable_access.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -7236,7 +7374,9 @@
 ./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/library/mib.h
 ./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/mib_api.h
@@ -7277,8 +7417,8 @@
 ./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/ipCidrRouteTable_checkfns.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/ipCidrRouteTable_checkfns.lo: ./mibII/ipCidrRouteTable_checkfns.h
 ./mibII/ipCidrRouteTable_checkfns.lo: ./mibII/ipCidrRouteTable_enums.h
 ./mibII/ipv6.lo: ../../include/net-snmp/net-snmp-config.h
@@ -7310,7 +7450,9 @@
 ./mibII/ipv6.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/ipv6.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/ipv6.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/ipv6.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/ipv6.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/ipv6.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/ipv6.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/ipv6.lo: ../../include/net-snmp/library/mib.h
 ./mibII/ipv6.lo: ../../include/net-snmp/mib_api.h
@@ -7350,8 +7492,8 @@
 ./mibII/ipv6.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/ipv6.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/ipv6.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/ipv6.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/ipv6.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/ipv6.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/ipv6.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/ipv6.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/ipv6.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -7421,7 +7563,9 @@
 ./mibII/kernel_linux.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/kernel_linux.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/kernel_linux.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/kernel_linux.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/kernel_linux.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/kernel_linux.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/kernel_linux.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/kernel_linux.lo: ../../include/net-snmp/library/mib.h
 ./mibII/kernel_linux.lo: ../../include/net-snmp/mib_api.h
@@ -7461,8 +7605,8 @@
 ./mibII/kernel_linux.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/kernel_linux.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/kernel_linux.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/kernel_linux.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/kernel_linux.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/kernel_linux.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/kernel_linux.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/kernel_linux.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/kernel_linux.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -7529,7 +7673,9 @@
 ./mibII/kernel_netbsd.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/kernel_netbsd.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/kernel_netbsd.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/kernel_netbsd.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/kernel_netbsd.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/kernel_netbsd.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/kernel_netbsd.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/kernel_netbsd.lo: ../../include/net-snmp/library/mib.h
 ./mibII/kernel_netbsd.lo: ../../include/net-snmp/mib_api.h
@@ -7570,8 +7716,8 @@
 ./mibII/kernel_netbsd.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/kernel_netbsd.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/kernel_netbsd.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/kernel_netbsd.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/kernel_netbsd.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/kernel_netbsd.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/kernel_netbsd.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/kernel_netbsd.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/kernel_netbsd.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -7638,7 +7784,9 @@
 ./mibII/kernel_sysctl.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/kernel_sysctl.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/kernel_sysctl.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/kernel_sysctl.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/kernel_sysctl.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/kernel_sysctl.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/kernel_sysctl.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/kernel_sysctl.lo: ../../include/net-snmp/library/mib.h
 ./mibII/kernel_sysctl.lo: ../../include/net-snmp/mib_api.h
@@ -7679,8 +7827,8 @@
 ./mibII/kernel_sysctl.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/kernel_sysctl.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/kernel_sysctl.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/kernel_sysctl.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/kernel_sysctl.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/kernel_sysctl.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/kernel_sysctl.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/kernel_sysctl.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/kernel_sysctl.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -7747,7 +7895,9 @@
 ./mibII/mta_sendmail.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/mta_sendmail.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/mta_sendmail.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/mta_sendmail.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/mta_sendmail.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/mta_sendmail.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/mta_sendmail.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/mta_sendmail.lo: ../../include/net-snmp/library/mib.h
 ./mibII/mta_sendmail.lo: ../../include/net-snmp/mib_api.h
@@ -7788,8 +7938,8 @@
 ./mibII/mta_sendmail.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/mta_sendmail.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/mta_sendmail.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/mta_sendmail.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/mta_sendmail.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/mta_sendmail.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/mta_sendmail.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/mta_sendmail.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/mta_sendmail.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -7856,7 +8006,9 @@
 ./mibII/route_write.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/route_write.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/route_write.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/route_write.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/route_write.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/route_write.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/route_write.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/route_write.lo: ../../include/net-snmp/library/mib.h
 ./mibII/route_write.lo: ../../include/net-snmp/mib_api.h
@@ -7897,8 +8049,8 @@
 ./mibII/route_write.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/route_write.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/route_write.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/route_write.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/route_write.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/route_write.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/route_write.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/route_write.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/route_write.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -7967,7 +8119,9 @@
 ./mibII/setSerialNo.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/setSerialNo.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/setSerialNo.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/setSerialNo.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/setSerialNo.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/setSerialNo.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/setSerialNo.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/setSerialNo.lo: ../../include/net-snmp/library/mib.h
 ./mibII/setSerialNo.lo: ../../include/net-snmp/mib_api.h
@@ -8007,8 +8161,8 @@
 ./mibII/setSerialNo.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/setSerialNo.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/setSerialNo.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/setSerialNo.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/setSerialNo.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/setSerialNo.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/setSerialNo.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/setSerialNo.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/setSerialNo.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -8076,7 +8230,9 @@
 ./mibII/snmp_mib.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/snmp_mib.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/snmp_mib.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/snmp_mib.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/snmp_mib.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/snmp_mib.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/snmp_mib.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/snmp_mib.lo: ../../include/net-snmp/library/mib.h
 ./mibII/snmp_mib.lo: ../../include/net-snmp/mib_api.h
@@ -8116,8 +8272,8 @@
 ./mibII/snmp_mib.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/snmp_mib.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/snmp_mib.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/snmp_mib.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/snmp_mib.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/snmp_mib.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/snmp_mib.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/snmp_mib.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/snmp_mib.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -8187,7 +8343,9 @@
 ./mibII/sysORTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/sysORTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/sysORTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/sysORTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/sysORTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/sysORTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/sysORTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/sysORTable.lo: ../../include/net-snmp/library/mib.h
 ./mibII/sysORTable.lo: ../../include/net-snmp/mib_api.h
@@ -8228,8 +8386,8 @@
 ./mibII/sysORTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/sysORTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/sysORTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/sysORTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/sysORTable.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/sysORTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/sysORTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/sysORTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/sysORTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -8300,7 +8458,9 @@
 ./mibII/system_mib.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/system_mib.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/system_mib.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/system_mib.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/system_mib.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/system_mib.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/system_mib.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/system_mib.lo: ../../include/net-snmp/library/mib.h
 ./mibII/system_mib.lo: ../../include/net-snmp/mib_api.h
@@ -8340,8 +8500,8 @@
 ./mibII/system_mib.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/system_mib.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/system_mib.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/system_mib.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/system_mib.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/system_mib.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/system_mib.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/system_mib.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/system_mib.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -8417,7 +8577,9 @@
 ./mibII/tcp.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/tcp.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/tcp.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/tcp.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/tcp.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/tcp.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/tcp.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/tcp.lo: ../../include/net-snmp/library/mib.h
 ./mibII/tcp.lo: ../../include/net-snmp/mib_api.h
@@ -8457,8 +8619,8 @@
 ./mibII/tcp.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/tcp.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/tcp.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/tcp.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/tcp.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/tcp.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/tcp.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/tcp.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/tcp.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -8532,7 +8694,9 @@
 ./mibII/tcpTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/tcpTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/tcpTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/tcpTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/tcpTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/tcpTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/tcpTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/tcpTable.lo: ../../include/net-snmp/library/mib.h
 ./mibII/tcpTable.lo: ../../include/net-snmp/mib_api.h
@@ -8572,8 +8736,8 @@
 ./mibII/tcpTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/tcpTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/tcpTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/tcpTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/tcpTable.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/tcpTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/tcpTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/tcpTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/tcpTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -8643,7 +8807,9 @@
 ./mibII/udp.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/udp.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/udp.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/udp.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/udp.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/udp.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/udp.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/udp.lo: ../../include/net-snmp/library/mib.h
 ./mibII/udp.lo: ../../include/net-snmp/mib_api.h
@@ -8684,8 +8850,8 @@
 ./mibII/udp.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/udp.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/udp.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/udp.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/udp.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/udp.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/udp.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/udp.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/udp.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -8758,7 +8924,9 @@
 ./mibII/udpTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/udpTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/udpTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/udpTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/udpTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/udpTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/udpTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/udpTable.lo: ../../include/net-snmp/library/mib.h
 ./mibII/udpTable.lo: ../../include/net-snmp/mib_api.h
@@ -8799,8 +8967,8 @@
 ./mibII/udpTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/udpTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/udpTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/udpTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/udpTable.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/udpTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/udpTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/udpTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/udpTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -8868,7 +9036,9 @@
 ./mibII/updates.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/updates.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/updates.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/updates.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/updates.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/updates.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/updates.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/updates.lo: ../../include/net-snmp/library/mib.h
 ./mibII/updates.lo: ../../include/net-snmp/mib_api.h
@@ -8909,8 +9079,8 @@
 ./mibII/updates.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/updates.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/updates.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/updates.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/updates.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/updates.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/updates.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/updates.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/updates.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -8977,7 +9147,9 @@
 ./mibII/vacm_conf.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/vacm_conf.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/vacm_conf.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/vacm_conf.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/vacm_conf.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/vacm_conf.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/vacm_conf.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/vacm_conf.lo: ../../include/net-snmp/library/mib.h
 ./mibII/vacm_conf.lo: ../../include/net-snmp/mib_api.h
@@ -9018,8 +9190,8 @@
 ./mibII/vacm_conf.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/vacm_conf.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/vacm_conf.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/vacm_conf.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/vacm_conf.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/vacm_conf.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/vacm_conf.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/vacm_conf.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/vacm_conf.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -9087,7 +9259,9 @@
 ./mibII/vacm_context.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/vacm_context.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/vacm_context.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/vacm_context.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/vacm_context.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/vacm_context.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/vacm_context.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/vacm_context.lo: ../../include/net-snmp/library/mib.h
 ./mibII/vacm_context.lo: ../../include/net-snmp/mib_api.h
@@ -9128,8 +9302,8 @@
 ./mibII/vacm_context.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/vacm_context.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/vacm_context.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/vacm_context.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/vacm_context.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/vacm_context.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/vacm_context.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/vacm_context.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/vacm_context.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -9196,7 +9370,9 @@
 ./mibII/vacm_vars.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/vacm_vars.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/vacm_vars.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/vacm_vars.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/vacm_vars.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/vacm_vars.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/vacm_vars.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/vacm_vars.lo: ../../include/net-snmp/library/mib.h
 ./mibII/vacm_vars.lo: ../../include/net-snmp/mib_api.h
@@ -9237,8 +9413,8 @@
 ./mibII/vacm_vars.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/vacm_vars.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/vacm_vars.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/vacm_vars.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/vacm_vars.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/vacm_vars.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/vacm_vars.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/vacm_vars.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/vacm_vars.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -9309,7 +9485,9 @@
 ./mibII/var_route.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./mibII/var_route.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mibII/var_route.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mibII/var_route.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mibII/var_route.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./mibII/var_route.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mibII/var_route.lo: ../../include/net-snmp/library/ucd_compat.h
 ./mibII/var_route.lo: ../../include/net-snmp/library/mib.h
 ./mibII/var_route.lo: ../../include/net-snmp/mib_api.h
@@ -9349,8 +9527,8 @@
 ./mibII/var_route.lo: ../../include/net-snmp/library/lcd_time.h
 ./mibII/var_route.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./mibII/var_route.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./mibII/var_route.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/var_route.lo: ../../include/net-snmp/library/snmpusm.h
+./mibII/var_route.lo: ../../include/net-snmp/library/snmptsm.h
 ./mibII/var_route.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./mibII/var_route.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./mibII/var_route.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -9423,7 +9601,9 @@
 ./misc/ipfwacc.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./misc/ipfwacc.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./misc/ipfwacc.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./misc/ipfwacc.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./misc/ipfwacc.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./misc/ipfwacc.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./misc/ipfwacc.lo: ../../include/net-snmp/library/ucd_compat.h
 ./misc/ipfwacc.lo: ../../include/net-snmp/library/mib.h
 ./misc/ipfwacc.lo: ../../include/net-snmp/mib_api.h
@@ -9464,8 +9644,8 @@
 ./misc/ipfwacc.lo: ../../include/net-snmp/library/lcd_time.h
 ./misc/ipfwacc.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./misc/ipfwacc.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./misc/ipfwacc.lo: ../../include/net-snmp/library/snmptsm.h
 ./misc/ipfwacc.lo: ../../include/net-snmp/library/snmpusm.h
+./misc/ipfwacc.lo: ../../include/net-snmp/library/snmptsm.h
 ./misc/ipfwacc.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./misc/ipfwacc.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./misc/ipfwacc.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -9533,7 +9713,9 @@
 ./notification-log-mib/notification_log.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./notification-log-mib/notification_log.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./notification-log-mib/notification_log.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./notification-log-mib/notification_log.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./notification-log-mib/notification_log.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./notification-log-mib/notification_log.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./notification-log-mib/notification_log.lo: ../../include/net-snmp/library/ucd_compat.h
 ./notification-log-mib/notification_log.lo: ../../include/net-snmp/library/mib.h
 ./notification-log-mib/notification_log.lo: ../../include/net-snmp/mib_api.h
@@ -9573,8 +9755,8 @@
 ./notification-log-mib/notification_log.lo: ../../include/net-snmp/library/lcd_time.h
 ./notification-log-mib/notification_log.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./notification-log-mib/notification_log.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./notification-log-mib/notification_log.lo: ../../include/net-snmp/library/snmptsm.h
 ./notification-log-mib/notification_log.lo: ../../include/net-snmp/library/snmpusm.h
+./notification-log-mib/notification_log.lo: ../../include/net-snmp/library/snmptsm.h
 ./notification-log-mib/notification_log.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./notification-log-mib/notification_log.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./notification-log-mib/notification_log.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -9644,7 +9826,9 @@
 ./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/library/mib.h
 ./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/mib_api.h
@@ -9684,8 +9868,8 @@
 ./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/library/snmpusm.h
+./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./notification/snmpNotifyFilterProfileTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -9756,7 +9940,9 @@
 ./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/library/ucd_compat.h
 ./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/library/mib.h
 ./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/mib_api.h
@@ -9796,8 +9982,8 @@
 ./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/library/lcd_time.h
 ./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/library/snmptsm.h
 ./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/library/snmpusm.h
+./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/library/snmptsm.h
 ./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./notification/snmpNotifyFilterProfileTable_data.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -9867,7 +10053,9 @@
 ./notification/snmpNotifyTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./notification/snmpNotifyTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./notification/snmpNotifyTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./notification/snmpNotifyTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./notification/snmpNotifyTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./notification/snmpNotifyTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./notification/snmpNotifyTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./notification/snmpNotifyTable.lo: ../../include/net-snmp/library/mib.h
 ./notification/snmpNotifyTable.lo: ../../include/net-snmp/mib_api.h
@@ -9907,8 +10095,8 @@
 ./notification/snmpNotifyTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./notification/snmpNotifyTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./notification/snmpNotifyTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./notification/snmpNotifyTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./notification/snmpNotifyTable.lo: ../../include/net-snmp/library/snmpusm.h
+./notification/snmpNotifyTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./notification/snmpNotifyTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./notification/snmpNotifyTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./notification/snmpNotifyTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -9995,7 +10183,9 @@
 ./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/library/ucd_compat.h
 ./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/library/mib.h
 ./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/mib_api.h
@@ -10035,8 +10225,8 @@
 ./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/library/lcd_time.h
 ./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/library/snmptsm.h
 ./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/library/snmpusm.h
+./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/library/snmptsm.h
 ./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./notification/snmpNotifyTable_data.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -10113,7 +10303,9 @@
 ./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/mib_api.h
@@ -10154,8 +10346,8 @@
 ./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpAssocLocalAddrTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -10223,7 +10415,9 @@
 ./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/mib_api.h
@@ -10264,8 +10458,8 @@
 ./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpAssocRemAddrTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -10333,7 +10527,9 @@
 ./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/mib_api.h
@@ -10374,8 +10570,8 @@
 ./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpAssocTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -10443,7 +10639,9 @@
 ./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/mib_api.h
@@ -10484,8 +10682,8 @@
 ./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpLookupLocalPortTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -10553,7 +10751,9 @@
 ./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/mib_api.h
@@ -10594,8 +10794,8 @@
 ./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpLookupRemHostNameTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -10663,7 +10863,9 @@
 ./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/mib_api.h
@@ -10704,8 +10906,8 @@
 ./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpLookupRemIPAddrTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -10773,7 +10975,9 @@
 ./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/mib_api.h
@@ -10814,8 +11018,8 @@
 ./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpLookupRemPortTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -10883,7 +11087,9 @@
 ./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/mib_api.h
@@ -10924,8 +11130,8 @@
 ./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpLookupRemPrimIPAddrTable.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -10993,7 +11199,9 @@
 ./sctp-mib/sctpScalars.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpScalars.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpScalars.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpScalars.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpScalars.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpScalars.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpScalars.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpScalars.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpScalars.lo: ../../include/net-snmp/mib_api.h
@@ -11034,8 +11242,8 @@
 ./sctp-mib/sctpScalars.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpScalars.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpScalars.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpScalars.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpScalars.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpScalars.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpScalars.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpScalars.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpScalars.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -11103,7 +11311,9 @@
 ./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/mib_api.h
@@ -11144,8 +11354,8 @@
 ./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpScalars_common.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -11212,7 +11422,9 @@
 ./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/mib_api.h
@@ -11253,8 +11465,8 @@
 ./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpScalars_freebsd.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -11321,7 +11533,9 @@
 ./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/mib_api.h
@@ -11362,8 +11576,8 @@
 ./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpScalars_linux.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -11430,7 +11644,9 @@
 ./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/mib_api.h
@@ -11471,8 +11687,8 @@
 ./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpScalars_solaris2.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -11541,7 +11757,9 @@
 ./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/mib_api.h
@@ -11581,8 +11799,8 @@
 ./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpTables_common.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -11657,7 +11875,9 @@
 ./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/mib_api.h
@@ -11698,8 +11918,8 @@
 ./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpTables_freebsd.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -11772,7 +11992,9 @@
 ./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/mib_api.h
@@ -11813,8 +12035,8 @@
 ./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpTables_linux.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -11885,7 +12107,9 @@
 ./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/library/ucd_compat.h
 ./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/library/mib.h
 ./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/mib_api.h
@@ -11926,8 +12150,8 @@
 ./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/library/lcd_time.h
 ./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/library/snmpusm.h
+./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/library/snmptsm.h
 ./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./sctp-mib/sctpTables_solaris2.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -12002,7 +12226,9 @@
 ./smux/smux.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./smux/smux.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./smux/smux.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./smux/smux.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./smux/smux.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./smux/smux.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./smux/smux.lo: ../../include/net-snmp/library/ucd_compat.h
 ./smux/smux.lo: ../../include/net-snmp/library/mib.h
 ./smux/smux.lo: ../../include/net-snmp/mib_api.h
@@ -12042,8 +12268,8 @@
 ./smux/smux.lo: ../../include/net-snmp/library/lcd_time.h
 ./smux/smux.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./smux/smux.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./smux/smux.lo: ../../include/net-snmp/library/snmptsm.h
 ./smux/smux.lo: ../../include/net-snmp/library/snmpusm.h
+./smux/smux.lo: ../../include/net-snmp/library/snmptsm.h
 ./smux/smux.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./smux/smux.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./smux/smux.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -12110,7 +12336,9 @@
 ./smux/snmp_bgp.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./smux/snmp_bgp.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./smux/snmp_bgp.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./smux/snmp_bgp.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./smux/snmp_bgp.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./smux/snmp_bgp.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./smux/snmp_bgp.lo: ../../include/net-snmp/library/ucd_compat.h
 ./smux/snmp_bgp.lo: ../../include/net-snmp/library/mib.h
 ./smux/snmp_bgp.lo: ../../include/net-snmp/mib_api.h
@@ -12151,8 +12379,8 @@
 ./smux/snmp_bgp.lo: ../../include/net-snmp/library/lcd_time.h
 ./smux/snmp_bgp.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./smux/snmp_bgp.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./smux/snmp_bgp.lo: ../../include/net-snmp/library/snmptsm.h
 ./smux/snmp_bgp.lo: ../../include/net-snmp/library/snmpusm.h
+./smux/snmp_bgp.lo: ../../include/net-snmp/library/snmptsm.h
 ./smux/snmp_bgp.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./smux/snmp_bgp.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./smux/snmp_bgp.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -12219,7 +12447,9 @@
 ./smux/snmp_ospf.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./smux/snmp_ospf.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./smux/snmp_ospf.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./smux/snmp_ospf.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./smux/snmp_ospf.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./smux/snmp_ospf.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./smux/snmp_ospf.lo: ../../include/net-snmp/library/ucd_compat.h
 ./smux/snmp_ospf.lo: ../../include/net-snmp/library/mib.h
 ./smux/snmp_ospf.lo: ../../include/net-snmp/mib_api.h
@@ -12260,8 +12490,8 @@
 ./smux/snmp_ospf.lo: ../../include/net-snmp/library/lcd_time.h
 ./smux/snmp_ospf.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./smux/snmp_ospf.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./smux/snmp_ospf.lo: ../../include/net-snmp/library/snmptsm.h
 ./smux/snmp_ospf.lo: ../../include/net-snmp/library/snmpusm.h
+./smux/snmp_ospf.lo: ../../include/net-snmp/library/snmptsm.h
 ./smux/snmp_ospf.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./smux/snmp_ospf.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./smux/snmp_ospf.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -12328,7 +12558,9 @@
 ./smux/snmp_rip2.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./smux/snmp_rip2.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./smux/snmp_rip2.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./smux/snmp_rip2.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./smux/snmp_rip2.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./smux/snmp_rip2.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./smux/snmp_rip2.lo: ../../include/net-snmp/library/ucd_compat.h
 ./smux/snmp_rip2.lo: ../../include/net-snmp/library/mib.h
 ./smux/snmp_rip2.lo: ../../include/net-snmp/mib_api.h
@@ -12369,8 +12601,8 @@
 ./smux/snmp_rip2.lo: ../../include/net-snmp/library/lcd_time.h
 ./smux/snmp_rip2.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./smux/snmp_rip2.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./smux/snmp_rip2.lo: ../../include/net-snmp/library/snmptsm.h
 ./smux/snmp_rip2.lo: ../../include/net-snmp/library/snmpusm.h
+./smux/snmp_rip2.lo: ../../include/net-snmp/library/snmptsm.h
 ./smux/snmp_rip2.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./smux/snmp_rip2.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./smux/snmp_rip2.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -12438,7 +12670,9 @@
 ./snmpv3/snmpEngine.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./snmpv3/snmpEngine.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpv3/snmpEngine.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpv3/snmpEngine.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpv3/snmpEngine.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./snmpv3/snmpEngine.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpv3/snmpEngine.lo: ../../include/net-snmp/library/ucd_compat.h
 ./snmpv3/snmpEngine.lo: ../../include/net-snmp/library/mib.h
 ./snmpv3/snmpEngine.lo: ../../include/net-snmp/mib_api.h
@@ -12478,8 +12712,8 @@
 ./snmpv3/snmpEngine.lo: ../../include/net-snmp/library/lcd_time.h
 ./snmpv3/snmpEngine.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./snmpv3/snmpEngine.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./snmpv3/snmpEngine.lo: ../../include/net-snmp/library/snmptsm.h
 ./snmpv3/snmpEngine.lo: ../../include/net-snmp/library/snmpusm.h
+./snmpv3/snmpEngine.lo: ../../include/net-snmp/library/snmptsm.h
 ./snmpv3/snmpEngine.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./snmpv3/snmpEngine.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./snmpv3/snmpEngine.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -12549,7 +12783,9 @@
 ./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/library/ucd_compat.h
 ./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/library/mib.h
 ./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/mib_api.h
@@ -12589,8 +12825,8 @@
 ./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/library/lcd_time.h
 ./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/library/snmptsm.h
 ./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/library/snmpusm.h
+./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/library/snmptsm.h
 ./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./snmpv3/snmpMPDStats.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -12659,7 +12895,9 @@
 ./snmpv3/usmConf.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./snmpv3/usmConf.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpv3/usmConf.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpv3/usmConf.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpv3/usmConf.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./snmpv3/usmConf.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpv3/usmConf.lo: ../../include/net-snmp/library/ucd_compat.h
 ./snmpv3/usmConf.lo: ../../include/net-snmp/library/mib.h
 ./snmpv3/usmConf.lo: ../../include/net-snmp/mib_api.h
@@ -12700,8 +12938,8 @@
 ./snmpv3/usmConf.lo: ../../include/net-snmp/library/lcd_time.h
 ./snmpv3/usmConf.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./snmpv3/usmConf.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./snmpv3/usmConf.lo: ../../include/net-snmp/library/snmptsm.h
 ./snmpv3/usmConf.lo: ../../include/net-snmp/library/snmpusm.h
+./snmpv3/usmConf.lo: ../../include/net-snmp/library/snmptsm.h
 ./snmpv3/usmConf.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./snmpv3/usmConf.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./snmpv3/usmConf.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -12768,7 +13006,9 @@
 ./snmpv3/usmStats.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./snmpv3/usmStats.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpv3/usmStats.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpv3/usmStats.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpv3/usmStats.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./snmpv3/usmStats.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpv3/usmStats.lo: ../../include/net-snmp/library/ucd_compat.h
 ./snmpv3/usmStats.lo: ../../include/net-snmp/library/mib.h
 ./snmpv3/usmStats.lo: ../../include/net-snmp/mib_api.h
@@ -12808,8 +13048,8 @@
 ./snmpv3/usmStats.lo: ../../include/net-snmp/library/lcd_time.h
 ./snmpv3/usmStats.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./snmpv3/usmStats.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./snmpv3/usmStats.lo: ../../include/net-snmp/library/snmptsm.h
 ./snmpv3/usmStats.lo: ../../include/net-snmp/library/snmpusm.h
+./snmpv3/usmStats.lo: ../../include/net-snmp/library/snmptsm.h
 ./snmpv3/usmStats.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./snmpv3/usmStats.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./snmpv3/usmStats.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -12879,7 +13119,9 @@
 ./snmpv3/usmUser.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./snmpv3/usmUser.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpv3/usmUser.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpv3/usmUser.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpv3/usmUser.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./snmpv3/usmUser.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpv3/usmUser.lo: ../../include/net-snmp/library/ucd_compat.h
 ./snmpv3/usmUser.lo: ../../include/net-snmp/library/mib.h
 ./snmpv3/usmUser.lo: ../../include/net-snmp/mib_api.h
@@ -12919,8 +13161,8 @@
 ./snmpv3/usmUser.lo: ../../include/net-snmp/library/lcd_time.h
 ./snmpv3/usmUser.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./snmpv3/usmUser.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./snmpv3/usmUser.lo: ../../include/net-snmp/library/snmptsm.h
 ./snmpv3/usmUser.lo: ../../include/net-snmp/library/snmpusm.h
+./snmpv3/usmUser.lo: ../../include/net-snmp/library/snmptsm.h
 ./snmpv3/usmUser.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./snmpv3/usmUser.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./snmpv3/usmUser.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -12987,7 +13229,9 @@
 ./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/library/ucd_compat.h
 ./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/library/mib.h
 ./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/mib_api.h
@@ -13028,8 +13272,8 @@
 ./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/library/lcd_time.h
 ./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/library/snmptsm.h
 ./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/library/snmpusm.h
+./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/library/snmptsm.h
 ./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./target/snmpTargetAddrEntry.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -13098,7 +13342,9 @@
 ./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/library/ucd_compat.h
 ./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/library/mib.h
 ./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/mib_api.h
@@ -13139,8 +13385,8 @@
 ./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/library/lcd_time.h
 ./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/library/snmptsm.h
 ./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/library/snmpusm.h
+./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/library/snmptsm.h
 ./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./target/snmpTargetAddrEntry_data.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -13208,7 +13454,9 @@
 ./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/library/ucd_compat.h
 ./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/library/mib.h
 ./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/mib_api.h
@@ -13249,8 +13497,8 @@
 ./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/library/lcd_time.h
 ./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/library/snmptsm.h
 ./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/library/snmpusm.h
+./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/library/snmptsm.h
 ./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./target/snmpTargetParamsEntry.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -13318,7 +13566,9 @@
 ./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/library/ucd_compat.h
 ./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/library/mib.h
 ./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/mib_api.h
@@ -13359,8 +13609,8 @@
 ./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/library/lcd_time.h
 ./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/library/snmptsm.h
 ./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/library/snmpusm.h
+./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/library/snmptsm.h
 ./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./target/snmpTargetParamsEntry_data.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -13428,7 +13678,9 @@
 ./target/target.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./target/target.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./target/target.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./target/target.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./target/target.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./target/target.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./target/target.lo: ../../include/net-snmp/library/ucd_compat.h
 ./target/target.lo: ../../include/net-snmp/library/mib.h
 ./target/target.lo: ../../include/net-snmp/mib_api.h
@@ -13468,8 +13720,8 @@
 ./target/target.lo: ../../include/net-snmp/library/lcd_time.h
 ./target/target.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./target/target.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./target/target.lo: ../../include/net-snmp/library/snmptsm.h
 ./target/target.lo: ../../include/net-snmp/library/snmpusm.h
+./target/target.lo: ../../include/net-snmp/library/snmptsm.h
 ./target/target.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./target/target.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./target/target.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -13540,7 +13792,9 @@
 ./target/target_counters.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./target/target_counters.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./target/target_counters.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./target/target_counters.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./target/target_counters.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./target/target_counters.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./target/target_counters.lo: ../../include/net-snmp/library/ucd_compat.h
 ./target/target_counters.lo: ../../include/net-snmp/library/mib.h
 ./target/target_counters.lo: ../../include/net-snmp/mib_api.h
@@ -13580,8 +13834,8 @@
 ./target/target_counters.lo: ../../include/net-snmp/library/lcd_time.h
 ./target/target_counters.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./target/target_counters.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./target/target_counters.lo: ../../include/net-snmp/library/snmptsm.h
 ./target/target_counters.lo: ../../include/net-snmp/library/snmpusm.h
+./target/target_counters.lo: ../../include/net-snmp/library/snmptsm.h
 ./target/target_counters.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./target/target_counters.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./target/target_counters.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -13648,7 +13902,9 @@
 ./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/library/ucd_compat.h
 ./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/library/mib.h
 ./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/mib_api.h
@@ -13689,8 +13945,8 @@
 ./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/library/lcd_time.h
 ./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/library/snmptsm.h
 ./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/library/snmpusm.h
+./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/library/snmptsm.h
 ./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./tsm-mib/snmpTsmConfigurationUsePrefix.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -13757,7 +14013,9 @@
 ./tunnel/tunnel.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./tunnel/tunnel.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./tunnel/tunnel.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./tunnel/tunnel.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./tunnel/tunnel.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./tunnel/tunnel.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./tunnel/tunnel.lo: ../../include/net-snmp/library/ucd_compat.h
 ./tunnel/tunnel.lo: ../../include/net-snmp/library/mib.h
 ./tunnel/tunnel.lo: ../../include/net-snmp/mib_api.h
@@ -13798,8 +14056,8 @@
 ./tunnel/tunnel.lo: ../../include/net-snmp/library/lcd_time.h
 ./tunnel/tunnel.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./tunnel/tunnel.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./tunnel/tunnel.lo: ../../include/net-snmp/library/snmptsm.h
 ./tunnel/tunnel.lo: ../../include/net-snmp/library/snmpusm.h
+./tunnel/tunnel.lo: ../../include/net-snmp/library/snmptsm.h
 ./tunnel/tunnel.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./tunnel/tunnel.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./tunnel/tunnel.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -13839,6 +14097,13 @@
 ./tunnel/tunnel.lo: ../../include/net-snmp/agent/snmp_get_statistic.h
 ./tunnel/tunnel.lo: ../../include/net-snmp/agent/sysORTable.h
 ./tunnel/tunnel.lo: ../../include/net-snmp/agent/agent_callbacks.h tunnel.h
+./tunnel/tunnel.lo: if-mib/ifTable/ifTable.h
+./tunnel/tunnel.lo: ../../include/net-snmp/data_access/interface.h
+./tunnel/tunnel.lo: if-mib/ifTable/ifTable_constants.h
+./tunnel/tunnel.lo: if-mib/ifTable/ifTable_interface.h
+./tunnel/tunnel.lo: if-mib/ifTable/ifTable.h
+./tunnel/tunnel.lo: if-mib/ifTable/ifTable_data_access.h
+./tunnel/tunnel.lo: if-mib/ifTable/ifTable_defs.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/net-snmp-config.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/net-snmp-includes.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/definitions.h
@@ -13867,7 +14132,9 @@
 ./ucd-snmp/disk.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/disk.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/disk.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/mib_api.h
@@ -13908,8 +14175,8 @@
 ./ucd-snmp/disk.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/disk.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/disk.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/disk.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -13978,7 +14245,9 @@
 ./ucd-snmp/disk_hw.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/disk_hw.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/disk_hw.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/disk_hw.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/disk_hw.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/disk_hw.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/disk_hw.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/disk_hw.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/disk_hw.lo: ../../include/net-snmp/mib_api.h
@@ -14019,8 +14288,8 @@
 ./ucd-snmp/disk_hw.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/disk_hw.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/disk_hw.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/disk_hw.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/disk_hw.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/disk_hw.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/disk_hw.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/disk_hw.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/disk_hw.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -14089,7 +14358,9 @@
 ./ucd-snmp/diskio.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/diskio.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/diskio.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/diskio.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/diskio.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/diskio.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/diskio.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/diskio.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/diskio.lo: ../../include/net-snmp/mib_api.h
@@ -14130,8 +14401,8 @@
 ./ucd-snmp/diskio.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/diskio.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/diskio.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/diskio.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/diskio.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/diskio.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/diskio.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/diskio.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/diskio.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -14201,7 +14472,9 @@
 ./ucd-snmp/dlmod.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/dlmod.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/dlmod.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/dlmod.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/dlmod.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/dlmod.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/dlmod.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/dlmod.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/dlmod.lo: ../../include/net-snmp/mib_api.h
@@ -14241,8 +14514,8 @@
 ./ucd-snmp/dlmod.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/dlmod.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/dlmod.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/dlmod.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/dlmod.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/dlmod.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/dlmod.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/dlmod.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/dlmod.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -14309,7 +14582,9 @@
 ./ucd-snmp/errormib.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/errormib.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/errormib.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/errormib.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/errormib.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/errormib.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/errormib.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/errormib.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/errormib.lo: ../../include/net-snmp/mib_api.h
@@ -14350,8 +14625,8 @@
 ./ucd-snmp/errormib.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/errormib.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/errormib.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/errormib.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/errormib.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/errormib.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/errormib.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/errormib.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/errormib.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -14421,7 +14696,9 @@
 ./ucd-snmp/extensible.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/extensible.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/extensible.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/extensible.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/extensible.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/extensible.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/extensible.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/extensible.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/extensible.lo: ../../include/net-snmp/mib_api.h
@@ -14461,8 +14738,8 @@
 ./ucd-snmp/extensible.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/extensible.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/extensible.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/extensible.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/extensible.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/extensible.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/extensible.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/extensible.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/extensible.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -14536,7 +14813,9 @@
 ./ucd-snmp/file.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/file.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/file.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/file.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/file.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/file.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/file.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/file.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/file.lo: ../../include/net-snmp/mib_api.h
@@ -14577,8 +14856,8 @@
 ./ucd-snmp/file.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/file.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/file.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/file.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/file.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/file.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/file.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/file.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/file.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -14646,7 +14925,9 @@
 ./ucd-snmp/hpux.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/hpux.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/hpux.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/hpux.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/hpux.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/hpux.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/hpux.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/hpux.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/hpux.lo: ../../include/net-snmp/mib_api.h
@@ -14687,8 +14968,8 @@
 ./ucd-snmp/hpux.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/hpux.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/hpux.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/hpux.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/hpux.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/hpux.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/hpux.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/hpux.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/hpux.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -14756,7 +15037,9 @@
 ./ucd-snmp/lmSensors.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/lmSensors.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/lmSensors.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/lmSensors.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/lmSensors.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/lmSensors.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/lmSensors.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/lmSensors.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/lmSensors.lo: ../../include/net-snmp/mib_api.h
@@ -14796,8 +15079,8 @@
 ./ucd-snmp/lmSensors.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/lmSensors.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/lmSensors.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/lmSensors.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/lmSensors.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/lmSensors.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/lmSensors.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/lmSensors.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/lmSensors.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -14865,7 +15148,9 @@
 ./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/mib_api.h
@@ -14906,8 +15191,8 @@
 ./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/lmsensorsMib.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -14976,7 +15261,9 @@
 ./ucd-snmp/loadave.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/loadave.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/loadave.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/loadave.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/loadave.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/loadave.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/loadave.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/loadave.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/loadave.lo: ../../include/net-snmp/mib_api.h
@@ -15017,8 +15304,8 @@
 ./ucd-snmp/loadave.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/loadave.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/loadave.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/loadave.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/loadave.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/loadave.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/loadave.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/loadave.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/loadave.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -15089,7 +15376,9 @@
 ./ucd-snmp/memory.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/memory.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/memory.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/memory.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/memory.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/memory.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/memory.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/memory.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/memory.lo: ../../include/net-snmp/mib_api.h
@@ -15130,8 +15419,8 @@
 ./ucd-snmp/memory.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/memory.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/memory.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/memory.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/memory.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/memory.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/memory.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -15199,7 +15488,9 @@
 ./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/mib_api.h
@@ -15240,8 +15531,8 @@
 ./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/memory_aix4.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -15310,7 +15601,9 @@
 ./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/mib_api.h
@@ -15351,8 +15644,8 @@
 ./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/memory_darwin7.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -15421,7 +15714,9 @@
 ./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/mib_api.h
@@ -15462,8 +15757,8 @@
 ./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/memory_dynix.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -15532,7 +15827,9 @@
 ./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/mib_api.h
@@ -15573,8 +15870,8 @@
 ./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/memory_freebsd2.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -15646,7 +15943,9 @@
 ./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/mib_api.h
@@ -15687,8 +15986,8 @@
 ./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/memory_hpux.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -15757,7 +16056,9 @@
 ./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/mib_api.h
@@ -15798,8 +16099,8 @@
 ./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/memory_netbsd1.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -15868,7 +16169,9 @@
 ./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/mib_api.h
@@ -15909,8 +16212,8 @@
 ./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/memory_solaris2.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -15981,7 +16284,9 @@
 ./ucd-snmp/pass.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/pass.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/pass.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/pass.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/pass.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/pass.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/pass.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/pass.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/pass.lo: ../../include/net-snmp/mib_api.h
@@ -16021,8 +16326,8 @@
 ./ucd-snmp/pass.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/pass.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/pass.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/pass.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/pass.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/pass.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/pass.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/pass.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/pass.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -16093,7 +16398,9 @@
 ./ucd-snmp/pass_common.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/pass_common.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/pass_common.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/pass_common.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/pass_common.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/pass_common.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/pass_common.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/pass_common.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/pass_common.lo: ../../include/net-snmp/mib_api.h
@@ -16134,8 +16441,8 @@
 ./ucd-snmp/pass_common.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/pass_common.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/pass_common.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/pass_common.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/pass_common.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/pass_common.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/pass_common.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/pass_common.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/pass_common.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -16207,7 +16514,9 @@
 ./ucd-snmp/pass_persist.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/pass_persist.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/pass_persist.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/pass_persist.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/pass_persist.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/pass_persist.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/pass_persist.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/pass_persist.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/pass_persist.lo: ../../include/net-snmp/mib_api.h
@@ -16247,8 +16556,8 @@
 ./ucd-snmp/pass_persist.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/pass_persist.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/pass_persist.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/pass_persist.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/pass_persist.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/pass_persist.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/pass_persist.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/pass_persist.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/pass_persist.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -16320,7 +16629,9 @@
 ./ucd-snmp/proc.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/proc.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/proc.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/mib_api.h
@@ -16360,8 +16671,8 @@
 ./ucd-snmp/proc.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/proc.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/proc.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -16399,12 +16710,12 @@
 ./ucd-snmp/proc.lo: ../../include/net-snmp/agent/table_array.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/agent/mfd.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/agent/snmp_get_statistic.h
-./ucd-snmp/proc.lo: struct.h ./ucd-snmp/proc.h mibdefs.h
+./ucd-snmp/proc.lo: mibdefs.h struct.h ./ucd-snmp/proc.h
 ./ucd-snmp/proc.lo: ../../include/net-snmp/data_access/swrun.h
 ./ucd-snmp/proc.lo: ./ucd-snmp/errormib.h util_funcs.h
 ./ucd-snmp/proc.lo: util_funcs/header_generic.h
 ./ucd-snmp/proc.lo: util_funcs/header_simple_table.h
-./ucd-snmp/proc.lo: util_funcs/MIB_STATS_CACHE_TIMEOUT.h ../../agent/kernel.h
+./ucd-snmp/proc.lo: util_funcs/MIB_STATS_CACHE_TIMEOUT.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/net-snmp-config.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/net-snmp-features.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/net-snmp-includes.h
@@ -16434,7 +16745,9 @@
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/proxy.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/proxy.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/mib_api.h
@@ -16474,8 +16787,8 @@
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/proxy.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/proxy.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/proxy.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -16543,7 +16856,9 @@
 ./ucd-snmp/versioninfo.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/versioninfo.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/versioninfo.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/versioninfo.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/versioninfo.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/versioninfo.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/versioninfo.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/versioninfo.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/versioninfo.lo: ../../include/net-snmp/mib_api.h
@@ -16583,8 +16898,8 @@
 ./ucd-snmp/versioninfo.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/versioninfo.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/versioninfo.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/versioninfo.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/versioninfo.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/versioninfo.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/versioninfo.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/versioninfo.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/versioninfo.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -16654,7 +16969,9 @@
 ./ucd-snmp/vmstat.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/vmstat.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/vmstat.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/vmstat.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/vmstat.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/vmstat.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/vmstat.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/vmstat.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/vmstat.lo: ../../include/net-snmp/mib_api.h
@@ -16695,8 +17012,8 @@
 ./ucd-snmp/vmstat.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/vmstat.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/vmstat.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/vmstat.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/vmstat.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/vmstat.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/vmstat.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -16765,7 +17082,9 @@
 ./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/mib_api.h
@@ -16806,8 +17125,8 @@
 ./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/vmstat_aix4.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -16875,7 +17194,9 @@
 ./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/mib_api.h
@@ -16916,8 +17237,8 @@
 ./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/vmstat_bsdi4.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -16986,7 +17307,9 @@
 ./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/mib_api.h
@@ -17027,8 +17350,8 @@
 ./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/vmstat_darwin7.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -17097,7 +17420,9 @@
 ./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/mib_api.h
@@ -17138,8 +17463,8 @@
 ./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/vmstat_dynix.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -17207,7 +17532,9 @@
 ./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/mib_api.h
@@ -17248,8 +17575,8 @@
 ./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/vmstat_freebsd2.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -17319,7 +17646,9 @@
 ./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/mib_api.h
@@ -17360,8 +17689,8 @@
 ./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/vmstat_hpux.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -17430,7 +17759,9 @@
 ./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/mib_api.h
@@ -17470,8 +17801,8 @@
 ./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/vmstat_linux.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -17541,7 +17872,9 @@
 ./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/mib_api.h
@@ -17582,8 +17915,8 @@
 ./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/vmstat_netbsd1.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -17652,7 +17985,9 @@
 ./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/library/ucd_compat.h
 ./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/library/mib.h
 ./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/mib_api.h
@@ -17693,8 +18028,8 @@
 ./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/library/lcd_time.h
 ./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/library/snmpusm.h
+./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/library/snmptsm.h
 ./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./ucd-snmp/vmstat_solaris2.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -17762,7 +18097,9 @@
 ./util_funcs/Exit.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./util_funcs/Exit.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./util_funcs/Exit.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./util_funcs/Exit.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./util_funcs/Exit.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./util_funcs/Exit.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./util_funcs/Exit.lo: ../../include/net-snmp/library/ucd_compat.h
 ./util_funcs/Exit.lo: ../../include/net-snmp/library/mib.h
 ./util_funcs/Exit.lo: ../../include/net-snmp/mib_api.h
@@ -17802,7 +18139,9 @@
 ./util_funcs/get_pid_from_inode.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./util_funcs/get_pid_from_inode.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./util_funcs/get_pid_from_inode.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./util_funcs/get_pid_from_inode.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./util_funcs/get_pid_from_inode.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./util_funcs/get_pid_from_inode.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./util_funcs/get_pid_from_inode.lo: ../../include/net-snmp/library/ucd_compat.h
 ./util_funcs/get_pid_from_inode.lo: ../../include/net-snmp/library/mib.h
 ./util_funcs/get_pid_from_inode.lo: ../../include/net-snmp/mib_api.h
@@ -17840,7 +18179,9 @@
 ./util_funcs/header_generic.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./util_funcs/header_generic.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./util_funcs/header_generic.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./util_funcs/header_generic.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./util_funcs/header_generic.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./util_funcs/header_generic.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./util_funcs/header_generic.lo: ../../include/net-snmp/library/ucd_compat.h
 ./util_funcs/header_generic.lo: ../../include/net-snmp/library/mib.h
 ./util_funcs/header_generic.lo: ../../include/net-snmp/mib_api.h
@@ -17881,8 +18222,8 @@
 ./util_funcs/header_generic.lo: ../../include/net-snmp/library/lcd_time.h
 ./util_funcs/header_generic.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./util_funcs/header_generic.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./util_funcs/header_generic.lo: ../../include/net-snmp/library/snmptsm.h
 ./util_funcs/header_generic.lo: ../../include/net-snmp/library/snmpusm.h
+./util_funcs/header_generic.lo: ../../include/net-snmp/library/snmptsm.h
 ./util_funcs/header_generic.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./util_funcs/header_generic.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./util_funcs/header_generic.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -17949,7 +18290,9 @@
 ./util_funcs/header_simple_table.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./util_funcs/header_simple_table.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./util_funcs/header_simple_table.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./util_funcs/header_simple_table.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./util_funcs/header_simple_table.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./util_funcs/header_simple_table.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./util_funcs/header_simple_table.lo: ../../include/net-snmp/library/ucd_compat.h
 ./util_funcs/header_simple_table.lo: ../../include/net-snmp/library/mib.h
 ./util_funcs/header_simple_table.lo: ../../include/net-snmp/mib_api.h
@@ -17990,8 +18333,8 @@
 ./util_funcs/header_simple_table.lo: ../../include/net-snmp/library/lcd_time.h
 ./util_funcs/header_simple_table.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./util_funcs/header_simple_table.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./util_funcs/header_simple_table.lo: ../../include/net-snmp/library/snmptsm.h
 ./util_funcs/header_simple_table.lo: ../../include/net-snmp/library/snmpusm.h
+./util_funcs/header_simple_table.lo: ../../include/net-snmp/library/snmptsm.h
 ./util_funcs/header_simple_table.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./util_funcs/header_simple_table.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./util_funcs/header_simple_table.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -18058,7 +18401,9 @@
 ./util_funcs/restart.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./util_funcs/restart.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./util_funcs/restart.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./util_funcs/restart.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./util_funcs/restart.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./util_funcs/restart.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./util_funcs/restart.lo: ../../include/net-snmp/library/ucd_compat.h
 ./util_funcs/restart.lo: ../../include/net-snmp/library/mib.h
 ./util_funcs/restart.lo: ../../include/net-snmp/mib_api.h
@@ -18099,8 +18444,8 @@
 ./util_funcs/restart.lo: ../../include/net-snmp/library/lcd_time.h
 ./util_funcs/restart.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./util_funcs/restart.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./util_funcs/restart.lo: ../../include/net-snmp/library/snmptsm.h
 ./util_funcs/restart.lo: ../../include/net-snmp/library/snmpusm.h
+./util_funcs/restart.lo: ../../include/net-snmp/library/snmptsm.h
 ./util_funcs/restart.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./util_funcs/restart.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./util_funcs/restart.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -18167,7 +18512,9 @@
 ./utilities/execute.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./utilities/execute.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./utilities/execute.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./utilities/execute.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./utilities/execute.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./utilities/execute.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./utilities/execute.lo: ../../include/net-snmp/library/ucd_compat.h
 ./utilities/execute.lo: ../../include/net-snmp/library/mib.h
 ./utilities/execute.lo: ../../include/net-snmp/mib_api.h
@@ -18208,8 +18555,8 @@
 ./utilities/execute.lo: ../../include/net-snmp/library/lcd_time.h
 ./utilities/execute.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./utilities/execute.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./utilities/execute.lo: ../../include/net-snmp/library/snmptsm.h
 ./utilities/execute.lo: ../../include/net-snmp/library/snmpusm.h
+./utilities/execute.lo: ../../include/net-snmp/library/snmptsm.h
 ./utilities/execute.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./utilities/execute.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./utilities/execute.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -18279,7 +18626,9 @@
 ./utilities/iquery.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./utilities/iquery.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./utilities/iquery.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./utilities/iquery.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./utilities/iquery.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./utilities/iquery.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./utilities/iquery.lo: ../../include/net-snmp/library/ucd_compat.h
 ./utilities/iquery.lo: ../../include/net-snmp/library/mib.h
 ./utilities/iquery.lo: ../../include/net-snmp/mib_api.h
@@ -18319,8 +18668,8 @@
 ./utilities/iquery.lo: ../../include/net-snmp/library/lcd_time.h
 ./utilities/iquery.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./utilities/iquery.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./utilities/iquery.lo: ../../include/net-snmp/library/snmptsm.h
 ./utilities/iquery.lo: ../../include/net-snmp/library/snmpusm.h
+./utilities/iquery.lo: ../../include/net-snmp/library/snmptsm.h
 ./utilities/iquery.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./utilities/iquery.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./utilities/iquery.lo: ../../include/net-snmp/agent/agent_module_config.h
@@ -18388,7 +18737,9 @@
 ./utilities/override.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./utilities/override.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./utilities/override.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./utilities/override.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./utilities/override.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./utilities/override.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./utilities/override.lo: ../../include/net-snmp/library/ucd_compat.h
 ./utilities/override.lo: ../../include/net-snmp/library/mib.h
 ./utilities/override.lo: ../../include/net-snmp/mib_api.h
@@ -18429,8 +18780,8 @@
 ./utilities/override.lo: ../../include/net-snmp/library/lcd_time.h
 ./utilities/override.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./utilities/override.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./utilities/override.lo: ../../include/net-snmp/library/snmptsm.h
 ./utilities/override.lo: ../../include/net-snmp/library/snmpusm.h
+./utilities/override.lo: ../../include/net-snmp/library/snmptsm.h
 ./utilities/override.lo: ../../include/net-snmp/agent/net-snmp-agent-includes.h
 ./utilities/override.lo: ../../include/net-snmp/agent/mib_module_config.h
 ./utilities/override.lo: ../../include/net-snmp/agent/agent_module_config.h
diff -urpN net-snmp-5.8/agent/mibgroup/Rmon/alarm.c net-snmp-5.9.1/agent/mibgroup/Rmon/alarm.c
--- net-snmp-5.8/agent/mibgroup/Rmon/alarm.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/Rmon/alarm.c	2021-05-26 05:19:35.000000000 +0700
@@ -129,6 +129,8 @@
          0;
 #endif
 
+static unsigned char zero_octet_string[1];
+
 static int
 fetch_var_val(oid * name, size_t namelen, u_long * new_value)
 {
@@ -645,7 +647,7 @@ var_alarmEntry(struct variable * vp, oid
             return (unsigned char *) hdr->owner;
         } else {
             *var_len = 0;
-            return (unsigned char *) "";
+            return zero_octet_string;
         }
 
     case IDalarmStatus:
diff -urpN net-snmp-5.8/agent/mibgroup/Rmon/alarmTable.c net-snmp-5.9.1/agent/mibgroup/Rmon/alarmTable.c
--- net-snmp-5.8/agent/mibgroup/Rmon/alarmTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/Rmon/alarmTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -17,14 +17,14 @@
 #include "alarmTable.h"
 #include "event.h"
 
-netsnmp_feature_require(iquery)
-netsnmp_feature_require(query_set_default_session)
-netsnmp_feature_require(table_tdata)
-netsnmp_feature_require(check_vb_type_and_max_size)
-netsnmp_feature_require(table_tdata_extract_table)
+netsnmp_feature_require(iquery);
+netsnmp_feature_require(query_set_default_session);
+netsnmp_feature_require(table_tdata);
+netsnmp_feature_require(check_vb_type_and_max_size);
+netsnmp_feature_require(table_tdata_extract_table);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(table_tdata_insert_row)
-netsnmp_feature_require(iquery_pdu_session)
+netsnmp_feature_require(table_tdata_insert_row);
+netsnmp_feature_require(iquery_pdu_session);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /** Initializes the alarmTable module */
@@ -805,7 +805,7 @@ alarmTable_handler(netsnmp_mib_handler *
                         netsnmp_query_set_default_session(sess);
                         DEBUGMSGTL(("rmon:alarmTable", "user name %s\n", secName));
                     } else { 
-                        snmp_log(LOG_ERR, "user name %s not found\n", secName);
+                        snmp_log(LOG_ERR, "user name not found\n");
                         config_perror("Unknown user name\n");
                     }
 
diff -urpN net-snmp-5.8/agent/mibgroup/Rmon/event.c net-snmp-5.9.1/agent/mibgroup/Rmon/event.c
--- net-snmp-5.8/agent/mibgroup/Rmon/event.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/Rmon/event.c	2021-05-26 05:19:35.000000000 +0700
@@ -50,7 +50,7 @@
 #include "agutil_api.h"
 #include "row_api.h"
 
-netsnmp_feature_require(snprint_objid)
+netsnmp_feature_require(snprint_objid);
 
 /*
  * File scope definitions section 
@@ -524,7 +524,7 @@ create_explanaition(CRTL_ENTRY_T * evptr
         tmp = strchr(pch, '.');
         if (!tmp)
             break;
-        if (isdigit(tmp[1]) || '"' == tmp[1])
+        if (isdigit((unsigned char)tmp[1]) || '"' == tmp[1])
             break;
         pch = tmp + 1;
     }
diff -urpN net-snmp-5.8/agent/mibgroup/agent/extend.c net-snmp-5.9.1/agent/mibgroup/agent/extend.c
--- net-snmp-5.8/agent/mibgroup/agent/extend.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/agent/extend.c	2021-05-26 05:19:35.000000000 +0700
@@ -16,10 +16,16 @@
 #define SHELLCOMMAND 3
 #endif
 
-netsnmp_feature_require(extract_table_row_data)
-netsnmp_feature_require(table_data_delete_table)
+/*  This mib is potentially dangerous to turn on by default, since it
+ *  allows arbitrary commands to be set by anyone with SNMP WRITE
+ *  access to the MIB table.  If all of your users are "root" level
+ *  users, then it may be safe to turn on. */
+#define ENABLE_EXTEND_WRITE_ACCESS 0
+
+netsnmp_feature_require(extract_table_row_data);
+netsnmp_feature_require(table_data_delete_table);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(insert_table_row)
+netsnmp_feature_require(insert_table_row);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 oid  ns_extend_oid[]    = { 1, 3, 6, 1, 4, 1, 8072, 1, 3, 2 };
@@ -646,9 +652,9 @@ handle_nsExtendConfigTable(netsnmp_mib_h
     netsnmp_request_info       *request;
     netsnmp_table_request_info *table_info;
     netsnmp_extend             *extension;
-    extend_registration_block  *eptr;
+    extend_registration_block  *eptr NETSNMP_ATTRIBUTE_UNUSED;
     int  i;
-    int  need_to_validate = 0;
+    int  need_to_validate NETSNMP_ATTRIBUTE_UNUSED = 0;
 
     for ( request=requests; request; request=request->next ) {
         if (request->processed)
@@ -742,7 +748,7 @@ handle_nsExtendConfigTable(netsnmp_mib_h
          *
          **********/
 
-#ifndef NETSNMP_NO_WRITE_SUPPORT
+#if !defined(NETSNMP_NO_WRITE_SUPPORT) && ENABLE_EXTEND_WRITE_ACCESS
         case MODE_SET_RESERVE1:
             /*
              * Validate the new assignments
@@ -1068,7 +1074,7 @@ handle_nsExtendConfigTable(netsnmp_mib_h
                 }
             }
             break;
-#endif /* !NETSNMP_NO_WRITE_SUPPORT */ 
+#endif /* !NETSNMP_NO_WRITE_SUPPORT and ENABLE_EXTEND_WRITE_ACCESS */
 
         default:
             netsnmp_set_request_error(reqinfo, request, SNMP_ERR_GENERR);
@@ -1076,7 +1082,7 @@ handle_nsExtendConfigTable(netsnmp_mib_h
         }
     }
 
-#ifndef NETSNMP_NO_WRITE_SUPPORT
+#if !defined(NETSNMP_NO_WRITE_SUPPORT) && ENABLE_EXTEND_WRITE_ACCESS
     /*
      * If we're marking a given row as active,
      *  then we need to check that it's ready.
@@ -1101,7 +1107,7 @@ handle_nsExtendConfigTable(netsnmp_mib_h
             }
         }
     }
-#endif /* !NETSNMP_NO_WRITE_SUPPORT */
+#endif /* !NETSNMP_NO_WRITE_SUPPORT && ENABLE_EXTEND_WRITE_ACCESS */
     
     return SNMP_ERR_NOERROR;
 }
@@ -1526,52 +1532,49 @@ var_extensible_old(struct variable * vp,
     idx = name[*length-1] -1;
 	if (idx > max_compatability_entries)
 		return NULL;
-    exten = &compatability_entries[ idx ];
-    if (exten) {
-        switch (vp->magic) {
-        case MIBINDEX:
-            long_ret = name[*length - 1];
-            return ((u_char *) (&long_ret));
-        case ERRORNAME:        /* name defined in config file */
-            *var_len = strlen(exten->exec_entry->token);
-            return ((u_char *) (exten->exec_entry->token));
-        case SHELLCOMMAND:
-            cmdline = _get_cmdline(exten->exec_entry);
+    exten = &compatability_entries[idx];
+    switch (vp->magic) {
+    case MIBINDEX:
+        long_ret = name[*length - 1];
+        return (u_char *) &long_ret;
+    case ERRORNAME:        /* name defined in config file */
+        *var_len = strlen(exten->exec_entry->token);
+        return ((u_char *) (exten->exec_entry->token));
+    case SHELLCOMMAND:
+        cmdline = _get_cmdline(exten->exec_entry);
+        if (cmdline)
+            *var_len = strlen(cmdline);
+        return (u_char *) cmdline;
+    case ERRORFLAG:        /* return code from the process */
+        netsnmp_cache_check_and_reload( exten->exec_entry->cache );
+        long_ret = exten->exec_entry->result;
+        return (u_char *) &long_ret;
+    case ERRORMSG:         /* first line of text returned from the process */
+        netsnmp_cache_check_and_reload( exten->exec_entry->cache );
+        if (exten->exec_entry->numlines > 1) {
+            *var_len = (exten->exec_entry->lines[1])-
+                (exten->exec_entry->output) -1;
+        } else if (exten->exec_entry->output) {
+            *var_len = strlen(exten->exec_entry->output);
+        } else {
+            *var_len = 0;
+        }
+        return (u_char *) exten->exec_entry->output;
+    case ERRORFIX:
+        *write_method = fixExec2Error;
+        long_return = 0;
+        return (u_char *) &long_return;
+
+    case ERRORFIXCMD:
+        if (exten->efix_entry) {
+            cmdline = _get_cmdline(exten->efix_entry);
             if (cmdline)
                 *var_len = strlen(cmdline);
-            return ((u_char *) cmdline);
-        case ERRORFLAG:        /* return code from the process */
-            netsnmp_cache_check_and_reload( exten->exec_entry->cache );
-            long_ret = exten->exec_entry->result;
-            return ((u_char *) (&long_ret));
-        case ERRORMSG:         /* first line of text returned from the process */
-            netsnmp_cache_check_and_reload( exten->exec_entry->cache );
-            if (exten->exec_entry->numlines > 1) {
-                *var_len = (exten->exec_entry->lines[1])-
-                           (exten->exec_entry->output) -1;
-            } else if (exten->exec_entry->output) {
-                *var_len = strlen(exten->exec_entry->output);
-            } else {
-                *var_len = 0;
-            }
-            return ((u_char *) (exten->exec_entry->output));
-        case ERRORFIX:
-            *write_method = fixExec2Error;
-            long_return = 0;
-            return ((u_char *) &long_return);
-
-        case ERRORFIXCMD:
-            if (exten->efix_entry) {
-                cmdline = _get_cmdline(exten->efix_entry);
-		if (cmdline)
-                    *var_len = strlen(cmdline);
-                return ((u_char *) cmdline);
-            } else {
-                *var_len = 0;
-                return ((u_char *) &long_return);  /* Just needs to be non-null! */
-            }
+            return (u_char *) cmdline;
+        } else {
+            *var_len = 0;
+            return (u_char *) &long_return;  /* Just needs to be non-null! */
         }
-        return NULL;
     }
     return NULL;
 }
@@ -1590,7 +1593,7 @@ fixExec2Error(int action,
     idx = name[name_len-1] -1;
     exten = &compatability_entries[ idx ];
 
-#ifndef NETSNMP_NO_WRITE_SUPPORT
+#if !defined(NETSNMP_NO_WRITE_SUPPORT) && ENABLE_EXTEND_WRITE_ACCESS
     switch (action) {
     case MODE_SET_RESERVE1:
         if (var_val_type != ASN_INTEGER) {
@@ -1611,7 +1614,7 @@ fixExec2Error(int action,
     case MODE_SET_COMMIT:
         netsnmp_cache_check_and_reload( exten->efix_entry->cache );
     }
-#endif /* !NETSNMP_NO_WRITE_SUPPORT */
+#endif /* !NETSNMP_NO_WRITE_SUPPORT && ENABLE_EXTEND_WRITE_ACCESS */
     return SNMP_ERR_NOERROR;
 }
 #endif /* USING_UCD_SNMP_EXTENSIBLE_MODULE */
diff -urpN net-snmp-5.8/agent/mibgroup/agent/nsCache.c net-snmp-5.9.1/agent/mibgroup/agent/nsCache.c
--- net-snmp-5.8/agent/mibgroup/agent/nsCache.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/agent/nsCache.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,7 +13,7 @@
 #include <net-snmp/agent/cache_handler.h>
 #include "agent/nsCache.h"
 
-netsnmp_feature_require(cache_get_head)
+netsnmp_feature_require(cache_get_head);
 
 
 /*
diff -urpN net-snmp-5.8/agent/mibgroup/agent/nsDebug.c net-snmp-5.9.1/agent/mibgroup/agent/nsDebug.c
--- net-snmp-5.8/agent/mibgroup/agent/nsDebug.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/agent/nsDebug.c	2021-05-26 05:19:35.000000000 +0700
@@ -3,6 +3,7 @@
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 #include <net-snmp/agent/scalar.h>
 
+#include <stdint.h>
 #ifdef HAVE_STRING_H
 #include <string.h>
 #else
diff -urpN net-snmp-5.8/agent/mibgroup/agent/nsLogging.c net-snmp-5.9.1/agent/mibgroup/agent/nsLogging.c
--- net-snmp-5.8/agent/mibgroup/agent/nsLogging.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/agent/nsLogging.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,9 +13,9 @@
 #include <net-snmp/library/snmp_logging.h>
 #include "agent/nsLogging.h"
 
-netsnmp_feature_require(logging_external)
+netsnmp_feature_require(logging_external);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(table_iterator_insert_context)
+netsnmp_feature_require(table_iterator_insert_context);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /*
diff -urpN net-snmp-5.8/agent/mibgroup/agent/nsModuleTable.c net-snmp-5.9.1/agent/mibgroup/agent/nsModuleTable.c
--- net-snmp-5.8/agent/mibgroup/agent/nsModuleTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/agent/nsModuleTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -9,7 +9,7 @@
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 #include "nsModuleTable.h"
 
-netsnmp_feature_require(table_dataset)
+netsnmp_feature_require(table_dataset);
 
 void
 nsModuleTable_free(void *context, netsnmp_iterator_info *dont_care)
diff -urpN net-snmp-5.8/agent/mibgroup/agent/nsTransactionTable.c net-snmp-5.9.1/agent/mibgroup/agent/nsTransactionTable.c
--- net-snmp-5.8/agent/mibgroup/agent/nsTransactionTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/agent/nsTransactionTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -12,7 +12,7 @@
 #include <net-snmp/agent/table_iterator.h>
 #include "nsTransactionTable.h"
 
-netsnmp_feature_require(table_dataset)
+netsnmp_feature_require(table_dataset);
 
 /** Initialize the nsTransactionTable table by defining it's contents
    and how it's structured */
diff -urpN net-snmp-5.8/agent/mibgroup/agent/nsVacmAccessTable.c net-snmp-5.9.1/agent/mibgroup/agent/nsVacmAccessTable.c
--- net-snmp-5.8/agent/mibgroup/agent/nsVacmAccessTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/agent/nsVacmAccessTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -10,10 +10,10 @@
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 #include "nsVacmAccessTable.h"
 
-netsnmp_feature_require(check_vb_storagetype)
+netsnmp_feature_require(check_vb_storagetype);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_type_and_max_size)
-netsnmp_feature_require(table_iterator_insert_context)
+netsnmp_feature_require(check_vb_type_and_max_size);
+netsnmp_feature_require(table_iterator_insert_context);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /** Initializes the nsVacmAccessTable module */
diff -urpN net-snmp-5.8/agent/mibgroup/agentx/agentx_config.c net-snmp-5.9.1/agent/mibgroup/agentx/agentx_config.c
--- net-snmp-5.8/agent/mibgroup/agentx/agentx_config.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/agentx/agentx_config.c	2021-05-26 05:19:35.000000000 +0700
@@ -21,8 +21,8 @@
 #include "agentx/agentx_config.h"
 #include "agentx/protocol.h"
 
-netsnmp_feature_require(user_information)
-netsnmp_feature_require(string_time_to_secs)
+netsnmp_feature_require(user_information);
+netsnmp_feature_require(string_time_to_secs);
 
 /* ---------------------------------------------------------------------
  *
@@ -140,6 +140,22 @@ agentx_parse_agentx_retries(const char *
 }
 #endif                          /* USING_AGENTX_MASTER_MODULE */
 
+#ifdef USING_AGENTX_SUBAGENT_MODULE
+void
+agentx_parse_agentx_ping_interval(const char *token, char *cptr)
+{
+    int x = atoi(cptr);
+
+    DEBUGMSGTL(("agentx/config/ping", "%s\n", cptr));
+    if (x < 1) {
+        config_perror("Invalid ping interval value");
+        return;
+    }
+    netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID,
+                       NETSNMP_DS_AGENT_AGENTX_PING_INTERVAL, x);
+}
+#endif                          /* USING_AGENTX_SUBAGENT_MODULE */
+
 /* ---------------------------------------------------------------------
  *
  * Sub-agent
@@ -160,7 +176,7 @@ agentx_register_config_handler(const cha
     register_config_handler(":agentx", token, parser, releaser, help);
 }
 
-netsnmp_feature_child_of(agentx_unregister_config_handler, netsnmp_unused)
+netsnmp_feature_child_of(agentx_unregister_config_handler, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_AGENTX_UNREGISTER_CONFIG_HANDLER
 void
 agentx_unregister_config_handler(const char *token)
@@ -187,6 +203,21 @@ agentx_config_init(void)
     agentx_register_config_handler("agentxsocket",
                                   agentx_parse_agentx_socket, NULL,
                                   "AgentX bind address");
+
+    agentx_register_config_handler("agentxRetries",
+                                  agentx_parse_agentx_retries, NULL,
+                                  "AgentX Retries");
+    /* default to 5 retries */
+    netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID,
+                       NETSNMP_DS_AGENT_AGENTX_RETRIES, 5);
+
+    agentx_register_config_handler("agentxTimeout",
+                                  agentx_parse_agentx_timeout, NULL,
+                                  "AgentX Timeout (seconds)");
+    /* default to 1 second */
+    netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID,
+                       NETSNMP_DS_AGENT_AGENTX_TIMEOUT, 1 * ONE_SEC);
+
 #ifdef USING_AGENTX_MASTER_MODULE
     /*
      * tokens for master agent
@@ -198,33 +229,20 @@ agentx_config_init(void)
     agentx_register_config_handler("agentxperms",
                                   agentx_parse_agentx_perms, NULL,
                                   "AgentX socket permissions: socket_perms [directory_perms [username|userid [groupname|groupid]]]");
-    agentx_register_config_handler("agentxRetries",
-                                  agentx_parse_agentx_retries, NULL,
-                                  "AgentX Retries");
-    agentx_register_config_handler("agentxTimeout",
-                                  agentx_parse_agentx_timeout, NULL,
-                                  "AgentX Timeout (seconds)");
     }
 #endif                          /* USING_AGENTX_MASTER_MODULE */
 
 #ifdef USING_AGENTX_SUBAGENT_MODULE
     /*
-     * tokens for master agent
+     * tokens for subagent
      */
     if (SUB_AGENT == agent_role) {
-        /*
-         * set up callbacks to initiate master agent pings for this session 
-         */
-        netsnmp_ds_register_config(ASN_INTEGER,
-                                   netsnmp_ds_get_string(NETSNMP_DS_LIBRARY_ID,
-                                                         NETSNMP_DS_LIB_APPTYPE),
-                                   "agentxPingInterval",
-                                   NETSNMP_DS_APPLICATION_ID,
-                                   NETSNMP_DS_AGENT_AGENTX_PING_INTERVAL);
-        /* ping and/or reconnect by default every 15 seconds */
-        netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID,
-                           NETSNMP_DS_AGENT_AGENTX_PING_INTERVAL, 15);
-        
+      agentx_register_config_handler("agentxPingInterval",
+                                     agentx_parse_agentx_ping_interval, NULL,
+                                     "AgentX ping interval");
+      /* ping and/or reconnect by default every 15 seconds */
+      netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID,
+                         NETSNMP_DS_AGENT_AGENTX_PING_INTERVAL, 15);
     }
 #endif /* USING_AGENTX_SUBAGENT_MODULE */
 }
diff -urpN net-snmp-5.8/agent/mibgroup/agentx/client.c net-snmp-5.9.1/agent/mibgroup/agentx/client.c
--- net-snmp-5.8/agent/mibgroup/agentx/client.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/agentx/client.c	2021-05-26 05:19:35.000000000 +0700
@@ -43,7 +43,7 @@
 #include "agentx/client.h"
 #include "agentx/subagent.h"
 
-netsnmp_feature_require(set_agent_uptime)
+netsnmp_feature_require(set_agent_uptime);
 
         /*
          * AgentX handling utility routines
@@ -105,7 +105,7 @@ int
 agentx_open_session(netsnmp_session * ss)
 {
     netsnmp_pdu    *pdu, *response;
-    u_long 	    timeout;
+    int 	    timeout;
 
     DEBUGMSGTL(("agentx/subagent", "opening session \n"));
     if (ss == NULL || !IS_AGENTX_VERSION(ss->version)) {
@@ -118,7 +118,7 @@ agentx_open_session(netsnmp_session * ss
     timeout = netsnmp_ds_get_int(NETSNMP_DS_APPLICATION_ID,
                                    NETSNMP_DS_AGENT_AGENTX_TIMEOUT);
     if (timeout < 0) 
-    pdu->time = 0;
+        pdu->time = 0;
     else
 	/* for master TIMEOUT is usec, but Agentx Open specifies sec */
     	pdu->time = timeout/ONE_SEC;
diff -urpN net-snmp-5.8/agent/mibgroup/agentx/master.c net-snmp-5.9.1/agent/mibgroup/agentx/master.c
--- net-snmp-5.8/agent/mibgroup/agentx/master.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/agentx/master.c	2021-05-26 05:19:35.000000000 +0700
@@ -51,9 +51,9 @@
 #include "agentx/protocol.h"
 #include "agentx/master_admin.h"
 
-netsnmp_feature_require(handler_mark_requests_as_delegated)
-netsnmp_feature_require(unix_socket_paths)
-netsnmp_feature_require(free_agent_snmp_session_by_session)
+netsnmp_feature_require(handler_mark_requests_as_delegated);
+netsnmp_feature_require(unix_socket_paths);
+netsnmp_feature_require(free_agent_snmp_session_by_session);
 
 void
 real_init_master(void)
@@ -178,13 +178,17 @@ real_init_master(void)
                         agentx_sock_user = -1;
                     if (agentx_sock_group == 0 )
                         agentx_sock_group = -1;
-                    chown(name, agentx_sock_user, agentx_sock_group);
+                    NETSNMP_IGNORE_RESULT(chown(name, agentx_sock_user,
+                                                agentx_sock_group));
                 }
             }
 #endif
             session =
                 snmp_add_full(&sess, t, NULL, agentx_parse, NULL, NULL,
                               agentx_realloc_build, agentx_check_packet, NULL);
+            /* snmp_add_full() frees 't' upon failure. */
+            if (!session)
+                t = NULL;
         }
         if (session == NULL) {
             netsnmp_transport_free(t);
@@ -221,7 +225,7 @@ agentx_got_response(int operation,
         /* response is too late, free the cache */
         if (magic)
             netsnmp_free_delegated_cache((netsnmp_delegated_cache*) magic);
-        return 0;
+        return 1;
     }
     requests = cache->requests;
 
@@ -280,6 +284,11 @@ agentx_got_response(int operation,
         netsnmp_free_delegated_cache(cache);
         return 0;
 
+    case NETSNMP_CALLBACK_OP_RESEND:
+        DEBUGMSGTL(("agentx/master", "resend on session %8p req=0x%x\n",
+                    session, (unsigned)reqid));
+        return 0;
+
     case NETSNMP_CALLBACK_OP_RECEIVED_MESSAGE:
         /*
          * This session is alive 
@@ -608,8 +617,6 @@ agentx_master_handler(netsnmp_mib_handle
     result = snmp_async_send(ax_session, pdu, agentx_got_response, cb_data);
     if (result == 0) {
         snmp_free_pdu(pdu);
-        if (cb_data)
-            netsnmp_free_delegated_cache((netsnmp_delegated_cache*) cb_data);
     }
 
     return SNMP_ERR_NOERROR;
diff -urpN net-snmp-5.8/agent/mibgroup/agentx/master_admin.c net-snmp-5.9.1/agent/mibgroup/agentx/master_admin.c
--- net-snmp-5.8/agent/mibgroup/agentx/master_admin.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/agentx/master_admin.c	2021-05-26 05:19:35.000000000 +0700
@@ -45,11 +45,11 @@
 #include <net-snmp/agent/agent_sysORTable.h>
 #include "master.h"
 
-netsnmp_feature_require(unregister_mib_table_row)
-netsnmp_feature_require(trap_vars_with_context)
-netsnmp_feature_require(calculate_sectime_diff)
-netsnmp_feature_require(allocate_globalcacheid)
-netsnmp_feature_require(remove_index)
+netsnmp_feature_require(unregister_mib_table_row);
+netsnmp_feature_require(trap_vars_with_context);
+netsnmp_feature_require(calculate_sectime_diff);
+netsnmp_feature_require(allocate_globalcacheid);
+netsnmp_feature_require(remove_index);
 
 netsnmp_session *
 find_agentx_session(netsnmp_session * session, int sessid)
@@ -444,17 +444,12 @@ agentx_notify(netsnmp_session * session,
      *     as this is valid AgentX syntax.
      */
 
-	/* If a context name was specified, send the trap using that context.
-	 * Otherwise, send the trap without the context using the old method */
-	if (pdu->contextName != NULL)
-	{
-        send_trap_vars_with_context(-1, -1, pdu->variables, 
-                       pdu->contextName);
-	}
-	else
-	{
+    /* If a context name was specified, send the trap using that context.
+     * Otherwise, send the trap without the context using the old method */
+    if (pdu->contextName != NULL)
+        send_trap_vars_with_context(-1, -1, pdu->variables, pdu->contextName);
+    else
         send_trap_vars(-1, -1, pdu->variables);
-	}
 
     return AGENTX_ERR_NOERROR;
 }
diff -urpN net-snmp-5.8/agent/mibgroup/agentx/protocol.c net-snmp-5.9.1/agent/mibgroup/agentx/protocol.c
--- net-snmp-5.8/agent/mibgroup/agentx/protocol.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/agentx/protocol.c	2021-05-26 05:19:35.000000000 +0700
@@ -11,6 +11,7 @@
 
 #include <net-snmp/net-snmp-config.h>
 
+#include <limits.h>
 #include <stdio.h>
 #include <errno.h>
 #if HAVE_STDLIB_H
@@ -98,9 +99,7 @@ agentx_realloc_build_int(u_char ** buf,
 {
     unsigned int    ivalue = value;
     size_t          ilen = *out_len;
-#ifdef WORDS_BIGENDIAN
     unsigned int    i = 0;
-#endif
 
     while ((*out_len + 4) >= *buf_len) {
         if (!(allow_realloc && snmp_realloc(buf, buf_len))) {
@@ -109,22 +108,21 @@ agentx_realloc_build_int(u_char ** buf,
     }
 
     if (network_order) {
-#ifndef WORDS_BIGENDIAN
-        value = ntohl(value);
-#endif
+        if (!NETSNMP_BIGENDIAN)
+            value = ntohl(value);
         memmove((*buf + *out_len), &value, 4);
         *out_len += 4;
     } else {
-#ifndef WORDS_BIGENDIAN
-        memmove((*buf + *out_len), &value, 4);
-        *out_len += 4;
-#else
-        for (i = 0; i < 4; i++) {
-            *(*buf + *out_len) = (u_char) value & 0xff;
-            (*out_len)++;
-            value >>= 8;
+        if (!NETSNMP_BIGENDIAN) {
+            memmove((*buf + *out_len), &value, 4);
+            *out_len += 4;
+        } else {
+            for (i = 0; i < 4; i++) {
+                *(*buf + *out_len) = (u_char) value & 0xff;
+                (*out_len)++;
+                value >>= 8;
+            }
         }
-#endif
     }
     DEBUGDUMPSETUP("send", (*buf + ilen), 4);
     DEBUGMSG(("dumpv_send", "  Integer:\t%u (0x%.2X)\n", ivalue,
@@ -139,25 +137,24 @@ agentx_build_int(u_char * bufp, u_int va
     u_int           orig_val = value;
 
     if (network_byte_order) {
-#ifndef WORDS_BIGENDIAN
-        value = ntohl(value);
-#endif
+        if (!NETSNMP_BIGENDIAN)
+            value = ntohl(value);
         memmove(bufp, &value, 4);
     } else {
-#ifndef WORDS_BIGENDIAN
-        memmove(bufp, &value, 4);
-#else
-        *bufp = (u_char) value & 0xff;
-        value >>= 8;
-        bufp++;
-        *bufp = (u_char) value & 0xff;
-        value >>= 8;
-        bufp++;
-        *bufp = (u_char) value & 0xff;
-        value >>= 8;
-        bufp++;
-        *bufp = (u_char) value & 0xff;
-#endif
+        if (!NETSNMP_BIGENDIAN) {
+            memmove(bufp, &value, 4);
+        } else {
+            *bufp = (u_char) value & 0xff;
+            value >>= 8;
+            bufp++;
+            *bufp = (u_char) value & 0xff;
+            value >>= 8;
+            bufp++;
+            *bufp = (u_char) value & 0xff;
+            value >>= 8;
+            bufp++;
+            *bufp = (u_char) value & 0xff;
+        }
     }
     DEBUGDUMPSETUP("send", orig_bufp, 4);
     DEBUGMSG(("dumpv_send", "  Integer:\t%u (0x%.2X)\n", orig_val,
@@ -171,9 +168,7 @@ agentx_realloc_build_short(u_char ** buf
 {
     unsigned short  ivalue = value;
     size_t          ilen = *out_len;
-#ifdef WORDS_BIGENDIAN
     unsigned short  i = 0;
-#endif
 
     while ((*out_len + 2) >= *buf_len) {
         if (!(allow_realloc && snmp_realloc(buf, buf_len))) {
@@ -182,22 +177,21 @@ agentx_realloc_build_short(u_char ** buf
     }
 
     if (network_order) {
-#ifndef WORDS_BIGENDIAN
-        value = ntohs(value);
-#endif
+        if (!NETSNMP_BIGENDIAN)
+            value = ntohs(value);
         memmove((*buf + *out_len), &value, 2);
         *out_len += 2;
     } else {
-#ifndef WORDS_BIGENDIAN
-        memmove((*buf + *out_len), &value, 2);
-        *out_len += 2;
-#else
-        for (i = 0; i < 2; i++) {
-            *(*buf + *out_len) = (u_char) value & 0xff;
-            (*out_len)++;
-            value >>= 8;
+        if (!NETSNMP_BIGENDIAN) {
+            memmove((*buf + *out_len), &value, 2);
+            *out_len += 2;
+        } else {
+            for (i = 0; i < 2; i++) {
+                *(*buf + *out_len) = (u_char) value & 0xff;
+                (*out_len)++;
+                value >>= 8;
+            }
         }
-#endif
     }
     DEBUGDUMPSETUP("send", (*buf + ilen), 2);
     DEBUGMSG(("dumpv_send", "  Short:\t%hu (0x%.2hX)\n", ivalue, ivalue));
@@ -323,7 +317,7 @@ agentx_realloc_build_string(u_char ** bu
     }
 
     DEBUGDUMPSETUP("send", (*buf + ilen + 4), ((string_len + 3) / 4) * 4);
-    DEBUGMSG(("dumpv_send", "  String:\t%s\n", string));
+    DEBUGMSG(("dumpv_send", "  String:\t%.*s\n", (int)string_len, string));
     DEBUGINDENTLESS();
     DEBUGINDENTLESS();
     return 1;
@@ -694,16 +688,16 @@ _agentx_realloc_build(u_char ** buf, siz
         pdu->flags &= ~(AGENTX_MSG_FLAG_NON_DEFAULT_CONTEXT);
     }
 
-	/* We've received a PDU that has specified a context.  NetSNMP however, uses
-	 * the pdu->community field to specify context when using the AgentX
-	 * protocol.  Therefore we need to copy the context name and length into the
-	 * pdu->community and pdu->community_len fields, respectively. */
-	if (pdu->contextName != NULL && pdu->community == NULL)
-	{	
-		pdu->community     = (u_char *) strdup(pdu->contextName);
-		pdu->community_len = pdu->contextNameLen;
-		pdu->flags |= AGENTX_MSG_FLAG_NON_DEFAULT_CONTEXT;
-	}
+    /* We've received a PDU that has specified a context.  NetSNMP however, uses
+     * the pdu->community field to specify context when using the AgentX
+     * protocol.  Therefore we need to copy the context name and length into the
+     * pdu->community and pdu->community_len fields, respectively. */
+    if (pdu->contextName != NULL && pdu->community == NULL)
+    {	
+        pdu->community     = (u_char *) strdup(pdu->contextName);
+        pdu->community_len = pdu->contextNameLen;
+        pdu->flags |= AGENTX_MSG_FLAG_NON_DEFAULT_CONTEXT;
+    }
 
     /*
      * Build the header (and context if appropriate).  
@@ -1033,8 +1027,8 @@ agentx_realloc_build(netsnmp_session * s
 	*
 	***********************/
 
-int
-agentx_parse_int(u_char * data, u_int network_byte_order)
+static int
+agentx_parse_int(const u_char *data, u_int network_byte_order)
 {
     u_int           value = 0;
 
@@ -1045,25 +1039,24 @@ agentx_parse_int(u_char * data, u_int ne
     DEBUGDUMPSETUP("recv", data, 4);
     if (network_byte_order) {
         memmove(&value, data, 4);
-#ifndef WORDS_BIGENDIAN
-        value = ntohl(value);
-#endif
+        if (!NETSNMP_BIGENDIAN)
+            value = ntohl(value);
     } else {
-#ifndef WORDS_BIGENDIAN
-        memmove(&value, data, 4);
-#else
-        /*
-         * The equivalent of the 'ntohl()' macro,
-         * except this macro is null on big-endian systems 
-         */
-        value += data[3];
-        value <<= 8;
-        value += data[2];
-        value <<= 8;
-        value += data[1];
-        value <<= 8;
-        value += data[0];
-#endif
+        if (!NETSNMP_BIGENDIAN) {
+            memmove(&value, data, 4);
+        } else {
+            /*
+             * The equivalent of the 'ntohl()' macro,
+             * except this macro is null on big-endian systems
+             */
+            value += data[3];
+            value <<= 8;
+            value += data[2];
+            value <<= 8;
+            value += data[1];
+            value <<= 8;
+            value += data[0];
+        }
     }
     DEBUGMSG(("dumpv_recv", "  Integer:\t%u (0x%.2X)\n", value, value));
 
@@ -1071,28 +1064,27 @@ agentx_parse_int(u_char * data, u_int ne
 }
 
 
-int
-agentx_parse_short(u_char * data, u_int network_byte_order)
+static int
+agentx_parse_short(const u_char *data, u_int network_byte_order)
 {
     u_short         value = 0;
 
     if (network_byte_order) {
         memmove(&value, data, 2);
-#ifndef WORDS_BIGENDIAN
-        value = ntohs(value);
-#endif
+        if (!NETSNMP_BIGENDIAN)
+            value = ntohs(value);
     } else {
-#ifndef WORDS_BIGENDIAN
-        memmove(&value, data, 2);
-#else
-        /*
-         * The equivalent of the 'ntohs()' macro,
-         * except this macro is null on big-endian systems 
-         */
-        value += data[1];
-        value <<= 8;
-        value += data[0];
-#endif
+        if (!NETSNMP_BIGENDIAN) {
+            memmove(&value, data, 2);
+        } else {
+            /*
+             * The equivalent of the 'ntohs()' macro,
+             * except this macro is null on big-endian systems
+             */
+            value += data[1];
+            value <<= 8;
+            value += data[0];
+        }
     }
 
     DEBUGDUMPSETUP("recv", data, 2);
@@ -1100,18 +1092,48 @@ agentx_parse_short(u_char * data, u_int
     return value;
 }
 
+/**
+ * struct rszbuf - a resizeable buffer
+ * @buf:  Buffer pointer.
+ * @size: Size in bytes of the memory region @buf points at. Negative if @buf
+ *        has not been allocated dynamically.
+ * @used: Number of bytes in buf with useful data. If @buf points at an OID,
+ *        @used must be multiplied with sizeof(oid).
+ */
+struct rszbuf {
+    void    *buf;
+    int      size;
+    unsigned used;
+};
+
+/* Free @rb->buf if it has been allocated dynamically. */
+static void cleanup_rszbuf(struct rszbuf *rb)
+{
+    if (rb->size > 0)
+        free(rb->buf);
+}
+
+/* Reallocate @rb->buf if it is smaller than @min_size. */
+static int increase_size(struct rszbuf *rb, int min_size)
+{
+    if (min_size <= abs(rb->size))
+        return 1;
+    cleanup_rszbuf(rb);
+    rb->buf = malloc(min_size);
+    rb->size = rb->buf ? min_size : 0;
+    return rb->buf != NULL;
+}
 
-u_char         *
-agentx_parse_oid(u_char * data, size_t * length, int *inc,
-                 oid * oid_buf, size_t * oid_len, u_int network_byte_order)
+const u_char *
+agentx_parse_oid(const u_char *data, size_t *length, int *inc,
+                 struct rszbuf *oid_buf, u_int network_byte_order)
 {
     u_int           n_subid;
     u_int           prefix;
     u_int           tmp_oid_len;
     int             i;
-    int             int_offset;
-    u_int          *int_ptr = (u_int *)oid_buf;
-    u_char         *buf_ptr = data;
+    oid            *oid_ptr;
+    const u_char   *buf_ptr = data;
 
     if (*length < 4) {
         DEBUGMSGTL(("agentx", "Incomplete Object ID\n"));
@@ -1136,7 +1158,6 @@ agentx_parse_oid(u_char * data, size_t *
     prefix = data[1];
     if (inc)
         *inc = data[2];
-    int_offset = sizeof(oid)/4;
 
     buf_ptr += 4;
     *length -= 4;
@@ -1147,8 +1168,10 @@ agentx_parse_oid(u_char * data, size_t *
         /*
          * Null OID 
          */
-        memset(int_ptr, 0, 2 * sizeof(oid));
-        *oid_len = 2;
+        if (!increase_size(oid_buf, 2 * sizeof(oid)))
+            return NULL;
+        memset(oid_buf->buf, 0, 2 * sizeof(oid));
+        oid_buf->used = 2;
         DEBUGPRINTINDENT("dumpv_recv");
         DEBUGMSG(("dumpv_recv", "OID: NULL (0.0)\n"));
         DEBUGINDENTLESS();
@@ -1158,64 +1181,44 @@ agentx_parse_oid(u_char * data, size_t *
     /*
      * Check that the expanded OID will fit in the buffer provided
      */
-    tmp_oid_len = (prefix ? n_subid + 5 : n_subid);
-    if (*oid_len < tmp_oid_len) {
-        DEBUGMSGTL(("agentx", "Oversized Object ID (buf=%" NETSNMP_PRIz "d"
-		    " pdu=%d)\n", *oid_len, tmp_oid_len));
+    tmp_oid_len = n_subid + 5 * (prefix != 0);
+    if (!increase_size(oid_buf, tmp_oid_len * sizeof(oid))) {
+        DEBUGMSGTL(("agentx", "Out of memory\n"));
         DEBUGINDENTLESS();
         return NULL;
     }
 
-#ifdef WORDS_BIGENDIAN
-# define endianoff 1
-#else
-# define endianoff 0
-#endif
     if (*length < 4 * n_subid) {
         DEBUGMSGTL(("agentx", "Incomplete Object ID\n"));
         DEBUGINDENTLESS();
         return NULL;
     }
 
+    oid_ptr = oid_buf->buf;
+
     if (prefix) {	 
-        if (int_offset == 2) {  	/* align OID values in 64 bit agent */  
-	    memset(int_ptr, 0, 10*sizeof(int_ptr[0])); 
-	    int_ptr[0+endianoff] = 1;
-	    int_ptr[2+endianoff] = 3;
-	    int_ptr[4+endianoff] = 6;
-	    int_ptr[6+endianoff] = 1;
-	    int_ptr[8+endianoff] = prefix;
-        } else { /* assume int_offset == 1 */
-	    int_ptr[0] = 1;
-	    int_ptr[1] = 3;
-	    int_ptr[2] = 6;
-	    int_ptr[3] = 1;
-	    int_ptr[4] = prefix;
-        }
-        int_ptr = int_ptr + (int_offset * 5);
+        *oid_ptr++ = 1;
+        *oid_ptr++ = 3;
+        *oid_ptr++ = 6;
+        *oid_ptr++ = 1;
+        *oid_ptr++ = prefix;
     }
 
-    for (i = 0; i < (int) (int_offset * n_subid); i = i + int_offset) {
+    for (i = 0; i < n_subid; i++) {
 	int x;
 
 	x = agentx_parse_int(buf_ptr, network_byte_order);
-	if (int_offset == 2) {
-            int_ptr[i+0] = 0;
-	    int_ptr[i+1] = 0;
-	    int_ptr[i+endianoff]=x;
-        } else {
-	    int_ptr[i] = x;
-        }
+        *oid_ptr++ = x;
         buf_ptr += 4;
         *length -= 4;
     }
 
-    *oid_len = tmp_oid_len;
+    oid_buf->used = tmp_oid_len;
 
     DEBUGINDENTLESS();
     DEBUGPRINTINDENT("dumpv_recv");
     DEBUGMSG(("dumpv_recv", "OID: "));
-    DEBUGMSGOID(("dumpv_recv", oid_buf, *oid_len));
+    DEBUGMSGOID(("dumpv_recv", oid_buf->buf, oid_buf->used));
     DEBUGMSG(("dumpv_recv", "\n"));
 
     return buf_ptr;
@@ -1223,9 +1226,8 @@ agentx_parse_oid(u_char * data, size_t *
 
 
 
-u_char         *
-agentx_parse_string(u_char * data, size_t * length,
-                    u_char * string, size_t * str_len,
+static const u_char *
+agentx_parse_string(const u_char *data, size_t *length, struct rszbuf *string,
                     u_int network_byte_order)
 {
     u_int           len;
@@ -1237,22 +1239,24 @@ agentx_parse_string(u_char * data, size_
     }
 
     len = agentx_parse_int(data, network_byte_order);
+    if (len > UINT_MAX - 4) {
+        DEBUGMSGTL(("agentx", "Too long: %u\n", len));
+        return NULL;
+    }
     if (*length < len + 4) {
         DEBUGMSGTL(("agentx", "Incomplete string (still too short: %d)\n",
                     (int)*length));
         return NULL;
     }
-    if (len > (*str_len - 1)) {
-        DEBUGMSGTL(("agentx", "String too long (too long)\n"));
+    if (!increase_size(string, len + 1)) {
+        DEBUGMSGTL(("agentx", "Out of memory\n"));
         return NULL;
     }
-    memmove(string, data + 4, len);
-    string[len] = '\0';
-    *str_len = len;
-
-    len += 3;                   /* Extend the string length to include the padding */
-    len >>= 2;
-    len <<= 2;
+    memmove(string->buf, data + 4, len);
+    memset((char *)string->buf + len, '\0', 1);
+    string->used = len;
+
+    len = (len + 3) & ~3UL; /* Include padding. */
 
     if (*length < len + 4) {
         DEBUGMSGTL(("agentx", "Packet too short for string padding (still too short: %d)\n",
@@ -1267,7 +1271,7 @@ agentx_parse_string(u_char * data, size_
         size_t          buf_len = 0, out_len = 0;
 
         if (sprint_realloc_asciistring(&buf, &buf_len, &out_len, 1,
-                                       string, len)) {
+                                       string->buf, string->used)) {
             DEBUGMSG(("dumpv_recv", "String: %s\n", buf));
         } else {
             DEBUGMSG(("dumpv_recv", "String: %s [TRUNCATED]\n", buf));
@@ -1279,10 +1283,9 @@ agentx_parse_string(u_char * data, size_
     return data + (len + 4);
 }
 
-u_char         *
-agentx_parse_opaque(u_char * data, size_t * length, int *type,
-                    u_char * opaque_buf, size_t * opaque_len,
-                    u_int network_byte_order)
+static const u_char *
+agentx_parse_opaque(const u_char *data, size_t *length, int *type,
+                    struct rszbuf *opaque_buf, u_int network_byte_order)
 {
 #ifdef NETSNMP_WITH_OPAQUE_SPECIAL_TYPES
     union {
@@ -1294,35 +1297,34 @@ agentx_parse_opaque(u_char * data, size_
     int             tmp;
     u_char         *buf;
 #endif
-    u_char         *const cp =
-        agentx_parse_string(data, length,
-                            opaque_buf, opaque_len, network_byte_order);
+    const u_char   *const cp =
+        agentx_parse_string(data, length, opaque_buf, network_byte_order);
 
 #ifdef NETSNMP_WITH_OPAQUE_SPECIAL_TYPES
     if (cp == NULL)
         return NULL;
 
-    buf = opaque_buf;
+    buf = opaque_buf->buf;
 
-    if ((*opaque_len <= 3) || (buf[0] != ASN_OPAQUE_TAG1))
+    if (opaque_buf->used <= 3 || buf[0] != ASN_OPAQUE_TAG1)
         return cp;              /* Unrecognised opaque type */
 
     switch (buf[1]) {
     case ASN_OPAQUE_FLOAT:
-        if ((*opaque_len != (3 + sizeof(float))) ||
+        if (opaque_buf->used != 3 + sizeof(float) ||
             (buf[2] != sizeof(float)))
             return cp;          /* Encoding isn't right for FLOAT */
 
         memcpy(&fu.c[0], &buf[3], sizeof(float));
         fu.intVal[0] = ntohl(fu.intVal[0]);
-        *opaque_len = sizeof(float);
-        memcpy(opaque_buf, &fu.c[0], sizeof(float));
+        opaque_buf->used = sizeof(float);
+        memcpy(buf, &fu.c[0], sizeof(float));
         *type = ASN_OPAQUE_FLOAT;
         DEBUGMSG(("dumpv_recv", "Float: %f\n", fu.floatVal));
         return cp;
 
     case ASN_OPAQUE_DOUBLE:
-        if ((*opaque_len != (3 + sizeof(double))) ||
+        if (opaque_buf->used != 3 + sizeof(double) ||
             (buf[2] != sizeof(double)))
             return cp;          /* Encoding isn't right for DOUBLE */
 
@@ -1330,8 +1332,8 @@ agentx_parse_opaque(u_char * data, size_
         tmp = ntohl(fu.intVal[1]);
         fu.intVal[1] = ntohl(fu.intVal[0]);
         fu.intVal[0] = tmp;
-        *opaque_len = sizeof(double);
-        memcpy(opaque_buf, &fu.c[0], sizeof(double));
+        opaque_buf->used = sizeof(double);
+        memcpy(buf, &fu.c[0], sizeof(double));
         *type = ASN_OPAQUE_DOUBLE;
         DEBUGMSG(("dumpv_recv", "Double: %f\n", fu.doubleVal));
         return cp;
@@ -1348,13 +1350,12 @@ agentx_parse_opaque(u_char * data, size_
 }
 
 
-u_char         *
-agentx_parse_varbind(u_char * data, size_t * length, int *type,
-                     oid * oid_buf, size_t * oid_len,
-                     u_char * data_buf, size_t * data_len,
+static const u_char *
+agentx_parse_varbind(const u_char *data, size_t *length, int *type,
+                     struct rszbuf *oid_buf, struct rszbuf *data_buf,
                      u_int network_byte_order)
 {
-    u_char         *bufp = data;
+    const u_char   *bufp = data;
     u_int           int_val;
     struct counter64 tmp64;
 
@@ -1367,8 +1368,7 @@ agentx_parse_varbind(u_char * data, size
     bufp += 4;
     *length -= 4;
 
-    bufp = agentx_parse_oid(bufp, length, NULL, oid_buf, oid_len,
-                            network_byte_order);
+    bufp = agentx_parse_oid(bufp, length, NULL, oid_buf, network_byte_order);
     if (bufp == NULL) {
         DEBUGINDENTLESS();
         return NULL;
@@ -1385,30 +1385,28 @@ agentx_parse_varbind(u_char * data, size
             return NULL;
         }
         int_val = agentx_parse_int(bufp, network_byte_order);
-        memmove(data_buf, &int_val, 4);
-        *data_len = 4;
+        memmove(data_buf->buf, &int_val, 4);
+        data_buf->used = 4;
         bufp += 4;
         *length -= 4;
         break;
 
     case ASN_OCTET_STR:
     case ASN_IPADDRESS:
-        bufp = agentx_parse_string(bufp, length, data_buf, data_len,
-                                   network_byte_order);
+        bufp = agentx_parse_string(bufp, length, data_buf, network_byte_order);
         break;
 
     case ASN_OPAQUE:
-        bufp = agentx_parse_opaque(bufp, length, type, data_buf, data_len,
+        bufp = agentx_parse_opaque(bufp, length, type, data_buf,
                                    network_byte_order);
         break;
 
     case ASN_PRIV_INCL_RANGE:
     case ASN_PRIV_EXCL_RANGE:
     case ASN_OBJECT_ID:
-        bufp =
-            agentx_parse_oid(bufp, length, NULL, (oid *) data_buf,
-                             data_len, network_byte_order);
-        *data_len *= sizeof(oid);
+        bufp = agentx_parse_oid(bufp, length, NULL, data_buf,
+                                network_byte_order);
+        data_buf->used *= sizeof(oid);
         /*
          * 'agentx_parse_oid()' returns the number of sub_ids 
          */
@@ -1428,8 +1426,8 @@ agentx_parse_varbind(u_char * data, size
 	    tmp64.low  = agentx_parse_int(bufp,   network_byte_order);
 	}
 
-        memcpy(data_buf, &tmp64, sizeof(tmp64));
-	*data_len = sizeof(tmp64);
+        memcpy(data_buf->buf, &tmp64, sizeof(tmp64));
+        data_buf->used = sizeof(tmp64);
 	bufp    += 8;
 	*length -= 8;
         break;
@@ -1441,7 +1439,7 @@ agentx_parse_varbind(u_char * data, size
         /*
          * No data associated with these types. 
          */
-        *data_len = 0;
+        data_buf->used = 0;
         break;
 
     default:
@@ -1479,10 +1477,10 @@ agentx_parse_varbind(u_char * data, size
  *    (and hence we should have the full packet), any subsequent
  *    "running out of room" is indeed an error.
  */
-u_char         *
-agentx_parse_header(netsnmp_pdu *pdu, u_char * data, size_t * length)
+static const u_char *
+agentx_parse_header(netsnmp_pdu *pdu, const u_char *data, size_t *length)
 {
-    register u_char *bufp = data;
+    const u_char   *bufp = data;
     size_t          payload;
 
     if (*length < 20) {         /* Incomplete header */
@@ -1561,23 +1559,36 @@ int
 agentx_parse(netsnmp_session * session, netsnmp_pdu *pdu, u_char * data,
              size_t len)
 {
-    register u_char *bufp = data;
-    u_char          buffer[65536];
-    oid             oid_buffer[MAX_OID_LEN], end_oid_buf[MAX_OID_LEN];
-    size_t          buf_len = sizeof(buffer);
-    size_t          oid_buf_len = MAX_OID_LEN;
-    size_t          end_oid_buf_len = MAX_OID_LEN;
-
+    const u_char   *bufp = data;
+    char            data_buffer[64];
+    struct rszbuf   data_buf = {
+        data_buffer,
+        -(int)sizeof(data_buffer)
+    };
+    oid             oid_buffer[32];
+    struct rszbuf   oid_buf = {
+        oid_buffer,
+        -(int)sizeof(oid_buffer)
+    };
+    oid             end_oid_buffer[32];
+    struct rszbuf   end_oid_buf = {
+        end_oid_buffer,
+        -(int)sizeof(end_oid_buffer)
+    };
     int             range_bound;        /* OID-range upper bound */
     int             inc;        /* Inclusive SearchRange flag */
     int             type;       /* VarBind data type */
     size_t         *length = &len;
+    const int       dbgindent = debug_indent_get();
+    int             res = SNMP_ERR_NOERROR;
 
     if (pdu == NULL)
-        return (0);
+        return SNMP_ERR_NOERROR;
  
-    if (!IS_AGENTX_VERSION(session->version))
-        return SNMPERR_BAD_VERSION;
+    if (!IS_AGENTX_VERSION(session->version)) {
+        res = SNMPERR_BAD_VERSION;
+        goto out;
+    }
 
 #ifndef SNMPERR_INCOMPLETE_PACKET
     /*
@@ -1594,13 +1605,17 @@ agentx_parse(netsnmp_session * session,
 #define SNMPERR_INCOMPLETE_PACKET SNMPERR_ASN_PARSE_ERR
 #endif
 
+    if (len > 65536)
+        goto parse_err;
 
     /*
      *  Handle (common) header ....
      */
     bufp = agentx_parse_header(pdu, bufp, length);
-    if (bufp == NULL)
-        return SNMPERR_INCOMPLETE_PACKET;       /* i.e. wait for the rest */
+    if (bufp == NULL) {
+        res = SNMPERR_INCOMPLETE_PACKET;       /* i.e. wait for the rest */
+        goto out;
+    }
 
     /*
      * Control PDU handling 
@@ -1614,34 +1629,28 @@ agentx_parse(netsnmp_session * session,
      */
     if (pdu->flags & AGENTX_MSG_FLAG_NON_DEFAULT_CONTEXT) {
         DEBUGDUMPHEADER("recv", "Context");
-        bufp = agentx_parse_string(bufp, length, buffer, &buf_len,
-                                   pdu->flags &
+        bufp = agentx_parse_string(bufp, length, &data_buf, pdu->flags &
                                    AGENTX_FLAGS_NETWORK_BYTE_ORDER);
         DEBUGINDENTLESS();
         if (bufp == NULL)
-            return SNMPERR_ASN_PARSE_ERR;
+            goto parse_err;
 
-        pdu->community_len = buf_len;
-        snmp_clone_mem((void **) &pdu->community,
-                       (void *) buffer, (unsigned) buf_len);
+        pdu->community_len = data_buf.used;
+        snmp_clone_mem((void **)&pdu->community, data_buf.buf, data_buf.used);
 		
-		/* The NetSNMP API stuffs the context into the PDU's community string
-		 * field, when using the AgentX Protocol.  The rest of the code however,
-		 * expects to find the context in the PDU's context field.  Therefore we
-		 * need to copy the context into the PDU's context fields.  */
-		if (pdu->community_len > 0 && pdu->contextName == NULL)
-		{
-			pdu->contextName    = strdup((char *) pdu->community);
-			pdu->contextNameLen = pdu->community_len;
-		}
-
-        buf_len = sizeof(buffer);
+        /* The NetSNMP API stuffs the context into the PDU's community string
+         * field, when using the AgentX Protocol.  The rest of the code however,
+         * expects to find the context in the PDU's context field.  Therefore we
+         * need to copy the context into the PDU's context fields.  */
+        if (pdu->community_len > 0 && pdu->contextName == NULL) {
+            pdu->contextName    = strdup((char *) pdu->community);
+            pdu->contextNameLen = pdu->community_len;
+        }
     }
 
 #define AGENTX_NEEDLEN( len ) \
         if ( *length < len ) { \
-            DEBUGINDENTLESS(); \
-            return SNMPERR_ASN_PARSE_ERR; \
+            goto parse_err; \
         }
     DEBUGDUMPHEADER("recv", "PDU");
     switch (pdu->command) {
@@ -1655,30 +1664,19 @@ agentx_parse(netsnmp_session * session,
          * Store subagent OID & description in a VarBind 
          */
         DEBUGDUMPHEADER("recv", "Subagent OID");
-        bufp = agentx_parse_oid(bufp, length, NULL,
-                                oid_buffer, &oid_buf_len,
-                                pdu->
-                                flags & AGENTX_FLAGS_NETWORK_BYTE_ORDER);
+        bufp = agentx_parse_oid(bufp, length, NULL, &oid_buf, pdu->flags &
+                                AGENTX_FLAGS_NETWORK_BYTE_ORDER);
         DEBUGINDENTLESS();
-        if (bufp == NULL) {
-            DEBUGINDENTLESS();
-            return SNMPERR_ASN_PARSE_ERR;
-        }
+        if (bufp == NULL)
+            goto parse_err;
         DEBUGDUMPHEADER("recv", "Subagent Description");
-        bufp = agentx_parse_string(bufp, length, buffer, &buf_len,
-                                   pdu->
-                                   flags &
+        bufp = agentx_parse_string(bufp, length, &data_buf, pdu->flags &
                                    AGENTX_FLAGS_NETWORK_BYTE_ORDER);
         DEBUGINDENTLESS();
-        if (bufp == NULL) {
-            DEBUGINDENTLESS();
-            return SNMPERR_ASN_PARSE_ERR;
-        }
-        snmp_pdu_add_variable(pdu, oid_buffer, oid_buf_len,
-                              ASN_OCTET_STR, buffer, buf_len);
-
-        oid_buf_len = MAX_OID_LEN;
-        buf_len = sizeof(buffer);
+        if (bufp == NULL)
+            goto parse_err;
+        snmp_pdu_add_variable(pdu, oid_buf.buf, oid_buf.used,
+                              ASN_OCTET_STR, data_buf.buf, data_buf.used);
         break;
 
     case AGENTX_MSG_CLOSE:
@@ -1712,20 +1710,15 @@ agentx_parse(netsnmp_session * session,
         DEBUGINDENTLESS();
 
         DEBUGDUMPHEADER("recv", "Registration OID");
-        bufp = agentx_parse_oid(bufp, length, NULL,
-                                oid_buffer, &oid_buf_len,
-                                pdu->flags & AGENTX_FLAGS_NETWORK_BYTE_ORDER);
+        bufp = agentx_parse_oid(bufp, length, NULL, &oid_buf, pdu->flags &
+                                AGENTX_FLAGS_NETWORK_BYTE_ORDER);
         DEBUGINDENTLESS();
-        if (bufp == NULL) {
-            DEBUGINDENTLESS();
-            return SNMPERR_ASN_PARSE_ERR;
-        }
+        if (bufp == NULL)
+            goto parse_err;
 
         if (pdu->range_subid) {
-            if (pdu->range_subid > oid_buf_len) {
-                DEBUGINDENTLESS();
-                return SNMPERR_ASN_PARSE_ERR;
-            }
+            if (pdu->range_subid > oid_buf.used)
+                goto parse_err;
             AGENTX_NEEDLEN(4);
             range_bound = agentx_parse_int(bufp, pdu->flags &
                                            AGENTX_FLAGS_NETWORK_BYTE_ORDER);
@@ -1735,18 +1728,17 @@ agentx_parse(netsnmp_session * session,
             /*
              * Construct the end-OID.  
              */
-            end_oid_buf_len = oid_buf_len * sizeof(oid);
-            memcpy(end_oid_buf, oid_buffer, end_oid_buf_len);
-            end_oid_buf[pdu->range_subid - 1] = range_bound;
-
-            snmp_pdu_add_variable(pdu, oid_buffer, oid_buf_len,
-                                  ASN_PRIV_INCL_RANGE,
-                                  (u_char *) end_oid_buf, end_oid_buf_len);
+            if (!increase_size(&end_oid_buf, oid_buf.used * sizeof(oid)))
+                goto parse_err;
+            memcpy(end_oid_buf.buf, oid_buf.buf, oid_buf.used * sizeof(oid));
+            ((oid *)end_oid_buf.buf)[pdu->range_subid - 1] = range_bound;
+
+            snmp_pdu_add_variable(pdu, oid_buf.buf, oid_buf.used,
+                                  ASN_PRIV_INCL_RANGE, end_oid_buf.buf,
+                                  oid_buf.used * sizeof(oid));
         } else {
-            snmp_add_null_var(pdu, oid_buffer, oid_buf_len);
+            snmp_add_null_var(pdu, oid_buf.buf, oid_buf.used);
         }
-
-        oid_buf_len = MAX_OID_LEN;
         break;
 
     case AGENTX_MSG_GETBULK:
@@ -1772,42 +1764,23 @@ agentx_parse(netsnmp_session * session,
          */
         DEBUGDUMPHEADER("recv", "Search Range");
         while (*length > 0) {
-            bufp = agentx_parse_oid(bufp, length, &inc,
-                                    oid_buffer, &oid_buf_len,
-                                    pdu->flags &
+            bufp = agentx_parse_oid(bufp, length, &inc, &oid_buf, pdu->flags &
                                     AGENTX_FLAGS_NETWORK_BYTE_ORDER);
-            if (bufp == NULL) {
-                DEBUGINDENTLESS();
-                DEBUGINDENTLESS();
-                return SNMPERR_ASN_PARSE_ERR;
-            }
-            bufp = agentx_parse_oid(bufp, length, NULL,
-                                    end_oid_buf, &end_oid_buf_len,
+            if (bufp == NULL)
+                goto parse_err;
+            bufp = agentx_parse_oid(bufp, length, NULL, &end_oid_buf,
                                     pdu->flags &
                                     AGENTX_FLAGS_NETWORK_BYTE_ORDER);
-            if (bufp == NULL) {
-                DEBUGINDENTLESS();
-                DEBUGINDENTLESS();
-                return SNMPERR_ASN_PARSE_ERR;
-            }
-            end_oid_buf_len *= sizeof(oid);
+            if (bufp == NULL)
+                goto parse_err;
             /*
              * 'agentx_parse_oid()' returns the number of sub_ids 
              */
-
-            if (inc) {
-                snmp_pdu_add_variable(pdu, oid_buffer, oid_buf_len,
-                                      ASN_PRIV_INCL_RANGE,
-                                      (u_char *) end_oid_buf,
-                                      end_oid_buf_len);
-            } else {
-                snmp_pdu_add_variable(pdu, oid_buffer, oid_buf_len,
-                                      ASN_PRIV_EXCL_RANGE,
-                                      (u_char *) end_oid_buf,
-                                      end_oid_buf_len);
-            }
-            oid_buf_len = MAX_OID_LEN;
-            end_oid_buf_len = MAX_OID_LEN;
+            snmp_pdu_add_variable(pdu, oid_buf.buf, oid_buf.used,
+                                  inc ? ASN_PRIV_INCL_RANGE :
+                                  ASN_PRIV_EXCL_RANGE,
+                                  end_oid_buf.buf,
+                                  end_oid_buf.used * sizeof(oid));
         }
 
         DEBUGINDENTLESS();
@@ -1849,21 +1822,13 @@ agentx_parse(netsnmp_session * session,
 
         DEBUGDUMPHEADER("recv", "VarBindList");
         while (*length > 0) {
-            bufp = agentx_parse_varbind(bufp, length, &type,
-                                        oid_buffer, &oid_buf_len,
-                                        buffer, &buf_len,
-                                        pdu->flags &
+            bufp = agentx_parse_varbind(bufp, length, &type, &oid_buf,
+                                        &data_buf, pdu->flags &
                                         AGENTX_FLAGS_NETWORK_BYTE_ORDER);
-            if (bufp == NULL) {
-                DEBUGINDENTLESS();
-                DEBUGINDENTLESS();
-                return SNMPERR_ASN_PARSE_ERR;
-            }
-            snmp_pdu_add_variable(pdu, oid_buffer, oid_buf_len,
-                                  (u_char) type, buffer, buf_len);
-
-            oid_buf_len = MAX_OID_LEN;
-            buf_len = sizeof(buffer);
+            if (bufp == NULL)
+                goto parse_err;
+            snmp_pdu_add_variable(pdu, oid_buf.buf, oid_buf.used, type,
+                                  data_buf.buf, data_buf.used);
         }
         DEBUGINDENTLESS();
         break;
@@ -1883,45 +1848,45 @@ agentx_parse(netsnmp_session * session,
         /*
          * Store AgentCap OID & description in a VarBind 
          */
-        bufp = agentx_parse_oid(bufp, length, NULL,
-                                oid_buffer, &oid_buf_len,
+        bufp = agentx_parse_oid(bufp, length, NULL, &oid_buf,
                                 pdu->flags & AGENTX_FLAGS_NETWORK_BYTE_ORDER);
         if (bufp == NULL)
-            return SNMPERR_ASN_PARSE_ERR;
-        bufp = agentx_parse_string(bufp, length, buffer, &buf_len,
-                                   pdu->flags &
+            goto parse_err;
+        bufp = agentx_parse_string(bufp, length, &data_buf, pdu->flags &
                                    AGENTX_FLAGS_NETWORK_BYTE_ORDER);
         if (bufp == NULL)
-            return SNMPERR_ASN_PARSE_ERR;
-        snmp_pdu_add_variable(pdu, oid_buffer, oid_buf_len,
-                              ASN_OCTET_STR, buffer, buf_len);
-
-        oid_buf_len = MAX_OID_LEN;
-        buf_len = sizeof(buffer);
+            goto parse_err;
+        snmp_pdu_add_variable(pdu, oid_buf.buf, oid_buf.used,
+                              ASN_OCTET_STR, data_buf.buf, data_buf.used);
         break;
 
     case AGENTX_MSG_REMOVE_AGENT_CAPS:
         /*
          * Store AgentCap OID & description in a VarBind 
          */
-        bufp = agentx_parse_oid(bufp, length, NULL,
-                                oid_buffer, &oid_buf_len,
+        bufp = agentx_parse_oid(bufp, length, NULL, &oid_buf,
                                 pdu->flags & AGENTX_FLAGS_NETWORK_BYTE_ORDER);
         if (bufp == NULL)
-            return SNMPERR_ASN_PARSE_ERR;
-        snmp_add_null_var(pdu, oid_buffer, oid_buf_len);
-
-        oid_buf_len = MAX_OID_LEN;
+            goto parse_err;
+        snmp_add_null_var(pdu, oid_buf.buf, oid_buf.used);
         break;
 
     default:
-        DEBUGINDENTLESS();
         DEBUGMSGTL(("agentx", "Unrecognised PDU type: %d\n",
                     pdu->command));
-        return SNMPERR_UNKNOWN_PDU;
+        res = SNMPERR_UNKNOWN_PDU;
     }
-    DEBUGINDENTLESS();
-    return SNMP_ERR_NOERROR;
+
+out:
+    debug_indent_add(dbgindent - debug_indent_get());
+    cleanup_rszbuf(&end_oid_buf);
+    cleanup_rszbuf(&oid_buf);
+    cleanup_rszbuf(&data_buf);
+    return res;
+
+parse_err:
+    res = SNMPERR_ASN_PARSE_ERR;
+    goto out;
 }
 #undef AGENTX_NEEDLEN
 
diff -urpN net-snmp-5.8/agent/mibgroup/agentx/subagent.c net-snmp-5.9.1/agent/mibgroup/agentx/subagent.c
--- net-snmp-5.8/agent/mibgroup/agentx/subagent.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/agentx/subagent.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,10 +47,10 @@
 
 #include "subagent.h"
 
-netsnmp_feature_child_of(agentx_subagent, agentx_all)
-netsnmp_feature_child_of(agentx_enable_subagent, agentx_subagent)
+netsnmp_feature_child_of(agentx_subagent, agentx_all);
+netsnmp_feature_child_of(agentx_enable_subagent, agentx_subagent);
 
-netsnmp_feature_require(remove_trap_session)
+netsnmp_feature_require(remove_trap_session);
 
 #ifdef USING_AGENTX_SUBAGENT_MODULE
 
@@ -247,6 +247,8 @@ static void
 send_agentx_error(netsnmp_session *session, netsnmp_pdu *pdu, int errstat, int errindex)
 {
     pdu = snmp_clone_pdu(pdu);
+    if (!pdu)
+        return;
     pdu->command   = AGENTX_MSG_RESPONSE;
     pdu->version   = session->version;
     pdu->errstat   = errstat;
@@ -503,6 +505,9 @@ handle_agentx_packet(int operation, nets
      */
 
     internal_pdu = snmp_clone_pdu(pdu);
+    if (!internal_pdu)
+        return 1;
+    free(internal_pdu->contextName);
     internal_pdu->contextName = (char *) internal_pdu->community;
     internal_pdu->contextNameLen = internal_pdu->community_len;
     internal_pdu->community = NULL;
@@ -548,6 +553,8 @@ handle_subagent_response(int op, netsnmp
     }
 
     pdu = snmp_clone_pdu(pdu);
+    if (!pdu)
+        return 1;
     DEBUGMSGTL(("agentx/subagent",
                 "handling AgentX response (cmd 0x%02x orig_cmd 0x%02x)"
                 " (req=0x%x,trans=0x%x,sess=0x%x)\n",
@@ -642,6 +649,8 @@ handle_subagent_set_response(int op, net
                 (unsigned)pdu->command, (unsigned)pdu->reqid,
 		(unsigned)pdu->transid, (unsigned)pdu->sessid));
     pdu = snmp_clone_pdu(pdu);
+    if (!pdu)
+        return 1;
 
     asi = (struct agent_netsnmp_set_info *) magic;
     retsess = asi->sess;
@@ -675,11 +684,13 @@ handle_subagent_set_response(int op, net
         pdu->variables = NULL;  /* the variables were added by us */
     }
 
-    netsnmp_assert(retsess != NULL);
-    pdu->command = AGENTX_MSG_RESPONSE;
-    pdu->version = retsess->version;
-
-    if (!snmp_send(retsess, pdu)) {
+    if (retsess && pdu) {
+        pdu->command = AGENTX_MSG_RESPONSE;
+        pdu->version = retsess->version;
+
+        if (!snmp_send(retsess, pdu))
+            snmp_free_pdu(pdu);
+    } else if (pdu) {
         snmp_free_pdu(pdu);
     }
     DEBUGMSGTL(("agentx/subagent", "  FINISHED\n"));
@@ -870,6 +881,8 @@ subagent_open_master_session(void)
                       agentx_realloc_build, agentx_check_packet, NULL);
 
     if (main_session == NULL) {
+        /* snmp_add_full() frees 't' upon failure. */
+        t = NULL;
         if (!netsnmp_ds_get_boolean(NETSNMP_DS_APPLICATION_ID,
                                     NETSNMP_DS_AGENT_NO_CONNECTION_WARNINGS)) {
             char buf[1024];
diff -urpN net-snmp-5.8/agent/mibgroup/deliver/deliverByNotify.c net-snmp-5.9.1/agent/mibgroup/deliver/deliverByNotify.c
--- net-snmp-5.8/agent/mibgroup/deliver/deliverByNotify.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/deliver/deliverByNotify.c	2021-05-26 05:19:35.000000000 +0700
@@ -5,7 +5,7 @@
 
 #include <limits.h>
 
-netsnmp_feature_require(container_fifo)
+netsnmp_feature_require(container_fifo);
 
 #include "deliverByNotify.h"
 
diff -urpN net-snmp-5.8/agent/mibgroup/disman/event/mteEvent.c net-snmp-5.9.1/agent/mibgroup/disman/event/mteEvent.c
--- net-snmp-5.8/agent/mibgroup/disman/event/mteEvent.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/event/mteEvent.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,9 +13,9 @@
 #include "disman/event/mteTrigger.h"
 #include "disman/event/mteObjects.h"
 
-netsnmp_feature_child_of(disman_debugging, libnetsnmpmibs)
-netsnmp_feature_child_of(mteevent, libnetsnmpmibs)
-netsnmp_feature_child_of(mteevent_removeentry, mteevent)
+netsnmp_feature_child_of(disman_debugging, libnetsnmpmibs);
+netsnmp_feature_child_of(mteevent, libnetsnmpmibs);
+netsnmp_feature_child_of(mteevent_removeentry, mteevent);
 
 netsnmp_tdata *event_table_data;
 
diff -urpN net-snmp-5.8/agent/mibgroup/disman/event/mteEventConf.c net-snmp-5.9.1/agent/mibgroup/disman/event/mteEventConf.c
--- net-snmp-5.8/agent/mibgroup/disman/event/mteEventConf.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/event/mteEventConf.c	2021-05-26 05:19:35.000000000 +0700
@@ -12,7 +12,7 @@
 #include "disman/event/mteEvent.h"
 #include "disman/event/mteEventConf.h"
 
-netsnmp_feature_require(iquery)
+netsnmp_feature_require(iquery);
 
 /** Initializes the mteEventsConf module */
 void
diff -urpN net-snmp-5.8/agent/mibgroup/disman/event/mteEventNotificationTable.c net-snmp-5.9.1/agent/mibgroup/disman/event/mteEventNotificationTable.c
--- net-snmp-5.8/agent/mibgroup/disman/event/mteEventNotificationTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/event/mteEventNotificationTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,10 +13,10 @@
 #include "disman/event/mteEvent.h"
 #include "disman/event/mteEventNotificationTable.h"
 
-netsnmp_feature_require(table_tdata)
+netsnmp_feature_require(table_tdata);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_type_and_max_size)
-netsnmp_feature_require(check_vb_oid)
+netsnmp_feature_require(check_vb_type_and_max_size);
+netsnmp_feature_require(check_vb_oid);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 static netsnmp_table_registration_info *table_info;
diff -urpN net-snmp-5.8/agent/mibgroup/disman/event/mteEventSetTable.c net-snmp-5.9.1/agent/mibgroup/disman/event/mteEventSetTable.c
--- net-snmp-5.8/agent/mibgroup/disman/event/mteEventSetTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/event/mteEventSetTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,11 +13,11 @@
 #include "disman/event/mteEvent.h"
 #include "disman/event/mteEventSetTable.h"
 
-netsnmp_feature_require(table_tdata)
+netsnmp_feature_require(table_tdata);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_type_and_max_size)
-netsnmp_feature_require(check_vb_oid)
-netsnmp_feature_require(check_vb_truthvalue)
+netsnmp_feature_require(check_vb_type_and_max_size);
+netsnmp_feature_require(check_vb_oid);
+netsnmp_feature_require(check_vb_truthvalue);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 static netsnmp_table_registration_info *table_info;
diff -urpN net-snmp-5.8/agent/mibgroup/disman/event/mteEventTable.c net-snmp-5.9.1/agent/mibgroup/disman/event/mteEventTable.c
--- net-snmp-5.8/agent/mibgroup/disman/event/mteEventTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/event/mteEventTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -14,14 +14,14 @@
 #include "disman/event/mteEvent.h"
 #include "disman/event/mteEventTable.h"
 
-netsnmp_feature_require(iquery)
-netsnmp_feature_require(table_tdata)
+netsnmp_feature_require(iquery);
+netsnmp_feature_require(table_tdata);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(iquery_pdu_session)
-netsnmp_feature_require(check_vb_type_and_max_size)
-netsnmp_feature_require(mteevent_removeentry)
-netsnmp_feature_require(check_vb_truthvalue)
-netsnmp_feature_require(table_tdata_insert_row)
+netsnmp_feature_require(iquery_pdu_session);
+netsnmp_feature_require(check_vb_type_and_max_size);
+netsnmp_feature_require(mteevent_removeentry);
+netsnmp_feature_require(check_vb_truthvalue);
+netsnmp_feature_require(table_tdata_insert_row);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 static netsnmp_table_registration_info *table_info;
diff -urpN net-snmp-5.8/agent/mibgroup/disman/event/mteObjectsTable.c net-snmp-5.9.1/agent/mibgroup/disman/event/mteObjectsTable.c
--- net-snmp-5.8/agent/mibgroup/disman/event/mteObjectsTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/event/mteObjectsTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,11 +13,11 @@
 #include "disman/event/mteObjects.h"
 #include "disman/event/mteObjectsTable.h"
 
-netsnmp_feature_require(table_tdata)
+netsnmp_feature_require(table_tdata);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_oid)
-netsnmp_feature_require(check_vb_truthvalue)
-netsnmp_feature_require(table_tdata_insert_row)
+netsnmp_feature_require(check_vb_oid);
+netsnmp_feature_require(check_vb_truthvalue);
+netsnmp_feature_require(table_tdata_insert_row);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 static netsnmp_table_registration_info *table_info;
diff -urpN net-snmp-5.8/agent/mibgroup/disman/event/mteTrigger.c net-snmp-5.9.1/agent/mibgroup/disman/event/mteTrigger.c
--- net-snmp-5.8/agent/mibgroup/disman/event/mteTrigger.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/event/mteTrigger.c	2021-05-26 05:19:35.000000000 +0700
@@ -11,9 +11,9 @@
 #include "disman/event/mteTrigger.h"
 #include "disman/event/mteEvent.h"
 
-netsnmp_feature_child_of(disman_debugging, libnetsnmpmibs)
-netsnmp_feature_child_of(mtetrigger, libnetsnmpmibs)
-netsnmp_feature_child_of(mtetrigger_removeentry, mtetrigger)
+netsnmp_feature_child_of(disman_debugging, libnetsnmpmibs);
+netsnmp_feature_child_of(mtetrigger, libnetsnmpmibs);
+netsnmp_feature_child_of(mtetrigger_removeentry, mtetrigger);
 
 netsnmp_tdata *trigger_table_data;
 
diff -urpN net-snmp-5.8/agent/mibgroup/disman/event/mteTriggerBooleanTable.c net-snmp-5.9.1/agent/mibgroup/disman/event/mteTriggerBooleanTable.c
--- net-snmp-5.8/agent/mibgroup/disman/event/mteTriggerBooleanTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/event/mteTriggerBooleanTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,10 +13,10 @@
 #include "disman/event/mteTrigger.h"
 #include "disman/event/mteTriggerBooleanTable.h"
 
-netsnmp_feature_require(table_tdata)
+netsnmp_feature_require(table_tdata);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_type_and_max_size)
-netsnmp_feature_require(check_vb_truthvalue)
+netsnmp_feature_require(check_vb_type_and_max_size);
+netsnmp_feature_require(check_vb_truthvalue);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 static netsnmp_table_registration_info *table_info;
diff -urpN net-snmp-5.8/agent/mibgroup/disman/event/mteTriggerConf.c net-snmp-5.9.1/agent/mibgroup/disman/event/mteTriggerConf.c
--- net-snmp-5.8/agent/mibgroup/disman/event/mteTriggerConf.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/event/mteTriggerConf.c	2021-05-26 05:19:35.000000000 +0700
@@ -15,7 +15,7 @@
 
 #include <ctype.h>
 
-netsnmp_feature_require(iquery)
+netsnmp_feature_require(iquery);
 
 /** Initializes the mteTriggerConf module */
 void
diff -urpN net-snmp-5.8/agent/mibgroup/disman/event/mteTriggerDeltaTable.c net-snmp-5.9.1/agent/mibgroup/disman/event/mteTriggerDeltaTable.c
--- net-snmp-5.8/agent/mibgroup/disman/event/mteTriggerDeltaTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/event/mteTriggerDeltaTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,10 +13,10 @@
 #include "disman/event/mteTrigger.h"
 #include "disman/event/mteTriggerDeltaTable.h"
 
-netsnmp_feature_require(table_tdata)
+netsnmp_feature_require(table_tdata);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_oid)
-netsnmp_feature_require(check_vb_truthvalue)
+netsnmp_feature_require(check_vb_oid);
+netsnmp_feature_require(check_vb_truthvalue);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /** Initializes the mteTriggerDeltaTable module */
@@ -63,8 +63,11 @@ init_mteTriggerDeltaTable(void)
 
     /* Register this using the (common) trigger_table_data container */
     rc = netsnmp_tdata_register(reg, trigger_table_data, table_info);
-    if (rc != SNMPERR_SUCCESS)
+    if (rc != SNMPERR_SUCCESS) {
+        snmp_log(LOG_ERR, "%s: netsnmp_tdata_register() returned %d\n",
+                 __func__, rc);
         return;
+    }
     netsnmp_handler_owns_table_info(reg->handler->next);
     DEBUGMSGTL(("disman:event:init", "Trigger Delta Table\n"));
 }
diff -urpN net-snmp-5.8/agent/mibgroup/disman/event/mteTriggerExistenceTable.c net-snmp-5.9.1/agent/mibgroup/disman/event/mteTriggerExistenceTable.c
--- net-snmp-5.8/agent/mibgroup/disman/event/mteTriggerExistenceTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/event/mteTriggerExistenceTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,9 +13,9 @@
 #include "disman/event/mteTrigger.h"
 #include "disman/event/mteTriggerExistenceTable.h"
 
-netsnmp_feature_require(table_tdata)
+netsnmp_feature_require(table_tdata);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_type_and_max_size)
+netsnmp_feature_require(check_vb_type_and_max_size);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 static netsnmp_table_registration_info *table_info;
@@ -63,9 +63,11 @@ init_mteTriggerExistenceTable(void)
 
     /* Register this using the (common) trigger_table_data container */
     rc = netsnmp_tdata_register(reg, trigger_table_data, table_info);
-    if (rc != SNMPERR_SUCCESS)
+    if (rc != SNMPERR_SUCCESS) {
+        snmp_log(LOG_ERR, "%s: netsnmp_tdata_register() returned %d\n",
+                 __func__, rc);
         return;
-
+    }
     netsnmp_handler_owns_table_info(reg->handler->next);
     DEBUGMSGTL(("disman:event:init", "Trigger Exist Table\n"));
 }
diff -urpN net-snmp-5.8/agent/mibgroup/disman/event/mteTriggerTable.c net-snmp-5.9.1/agent/mibgroup/disman/event/mteTriggerTable.c
--- net-snmp-5.8/agent/mibgroup/disman/event/mteTriggerTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/event/mteTriggerTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -15,16 +15,16 @@
 #include "disman/event/mteTrigger.h"
 #include "disman/event/mteTriggerTable.h"
 
-netsnmp_feature_require(iquery)
-netsnmp_feature_require(table_tdata)
+netsnmp_feature_require(iquery);
+netsnmp_feature_require(table_tdata);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(iquery_pdu_session)
-netsnmp_feature_require(check_vb_type_and_max_size)
-netsnmp_feature_require(check_vb_oid)
-netsnmp_feature_require(check_vb_uint)
-netsnmp_feature_require(mtetrigger_removeentry)
-netsnmp_feature_require(check_vb_truthvalue)
-netsnmp_feature_require(table_tdata_insert_row)
+netsnmp_feature_require(iquery_pdu_session);
+netsnmp_feature_require(check_vb_type_and_max_size);
+netsnmp_feature_require(check_vb_oid);
+netsnmp_feature_require(check_vb_uint);
+netsnmp_feature_require(mtetrigger_removeentry);
+netsnmp_feature_require(check_vb_truthvalue);
+netsnmp_feature_require(table_tdata_insert_row);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 static netsnmp_table_registration_info *table_info;
diff -urpN net-snmp-5.8/agent/mibgroup/disman/event/mteTriggerThresholdTable.c net-snmp-5.9.1/agent/mibgroup/disman/event/mteTriggerThresholdTable.c
--- net-snmp-5.8/agent/mibgroup/disman/event/mteTriggerThresholdTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/event/mteTriggerThresholdTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,9 +13,9 @@
 #include "disman/event/mteTrigger.h"
 #include "disman/event/mteTriggerThresholdTable.h"
 
-netsnmp_feature_require(table_tdata)
+netsnmp_feature_require(table_tdata);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_type_and_max_size)
+netsnmp_feature_require(check_vb_type_and_max_size);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 static netsnmp_table_registration_info *table_info;
diff -urpN net-snmp-5.8/agent/mibgroup/disman/expr/expErrorTable.c net-snmp-5.9.1/agent/mibgroup/disman/expr/expErrorTable.c
--- net-snmp-5.8/agent/mibgroup/disman/expr/expErrorTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/expr/expErrorTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,7 +13,7 @@
 #include "disman/expr/expExpression.h"
 #include "disman/expr/expErrorTable.h"
 
-netsnmp_feature_require(table_tdata)
+netsnmp_feature_require(table_tdata);
 
 /* Initializes the expExpressionErrorTable module */
 void
diff -urpN net-snmp-5.8/agent/mibgroup/disman/expr/expExpressionConf.c net-snmp-5.9.1/agent/mibgroup/disman/expr/expExpressionConf.c
--- net-snmp-5.8/agent/mibgroup/disman/expr/expExpressionConf.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/expr/expExpressionConf.c	2021-05-26 05:19:35.000000000 +0700
@@ -15,7 +15,7 @@
 #include "disman/expr/expObject.h"
 #include "disman/expr/expExpressionConf.h"
 
-netsnmp_feature_require(iquery)
+netsnmp_feature_require(iquery);
 
 /* Initializes the expExpressionConf module */
 void
diff -urpN net-snmp-5.8/agent/mibgroup/disman/expr/expExpressionTable.c net-snmp-5.9.1/agent/mibgroup/disman/expr/expExpressionTable.c
--- net-snmp-5.8/agent/mibgroup/disman/expr/expExpressionTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/expr/expExpressionTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -14,12 +14,12 @@
 #include "disman/expr/expExpression.h"
 #include "disman/expr/expExpressionTable.h"
 
-netsnmp_feature_require(iquery)
-netsnmp_feature_require(table_tdata)
+netsnmp_feature_require(iquery);
+netsnmp_feature_require(table_tdata);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_type_and_max_size)
-netsnmp_feature_require(table_tdata_insert_row)
-netsnmp_feature_require(iquery_pdu_session)
+netsnmp_feature_require(check_vb_type_and_max_size);
+netsnmp_feature_require(table_tdata_insert_row);
+netsnmp_feature_require(iquery_pdu_session);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /* Initializes the expExpressionTable module */
diff -urpN net-snmp-5.8/agent/mibgroup/disman/expr/expObjectConf.c net-snmp-5.9.1/agent/mibgroup/disman/expr/expObjectConf.c
--- net-snmp-5.8/agent/mibgroup/disman/expr/expObjectConf.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/expr/expObjectConf.c	2021-05-26 05:19:35.000000000 +0700
@@ -11,7 +11,7 @@
 #include "disman/expr/expObject.h"
 #include "disman/expr/expObjectConf.h"
 
-netsnmp_feature_require(iquery)
+netsnmp_feature_require(iquery);
 
 /* Initializes the expObjectConf module */
 void
diff -urpN net-snmp-5.8/agent/mibgroup/disman/expr/expObjectTable.c net-snmp-5.9.1/agent/mibgroup/disman/expr/expObjectTable.c
--- net-snmp-5.8/agent/mibgroup/disman/expr/expObjectTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/expr/expObjectTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,11 +13,11 @@
 #include "disman/expr/expObject.h"
 #include "disman/expr/expObjectTable.h"
 
-netsnmp_feature_require(table_tdata)
+netsnmp_feature_require(table_tdata);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_oid)
-netsnmp_feature_require(check_vb_truthvalue)
-netsnmp_feature_require(table_tdata_insert_row)
+netsnmp_feature_require(check_vb_oid);
+netsnmp_feature_require(check_vb_truthvalue);
+netsnmp_feature_require(table_tdata_insert_row);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /* Initializes the expObjectTable module */
diff -urpN net-snmp-5.8/agent/mibgroup/disman/expr/expValue.c net-snmp-5.9.1/agent/mibgroup/disman/expr/expValue.c
--- net-snmp-5.8/agent/mibgroup/disman/expr/expValue.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/expr/expValue.c	2021-05-26 05:19:35.000000000 +0700
@@ -3,6 +3,10 @@
  *    Core implementation of expression evaluation
  */
 
+#ifdef HAVE_INTTYPES_H
+#include <inttypes.h>
+#endif
+
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
diff -urpN net-snmp-5.8/agent/mibgroup/disman/expression/expExpressionTable.c net-snmp-5.9.1/agent/mibgroup/disman/expression/expExpressionTable.c
--- net-snmp-5.8/agent/mibgroup/disman/expression/expExpressionTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/expression/expExpressionTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -46,9 +46,9 @@
 #include "expObjectTable.h"
 #include "expValueTable.h"
 
-netsnmp_feature_require(tdomain_support)
+netsnmp_feature_require(tdomain_support);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(header_complex_find_entry)
+netsnmp_feature_require(header_complex_find_entry);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /*
diff -urpN net-snmp-5.8/agent/mibgroup/disman/expression/expObjectTable.c net-snmp-5.9.1/agent/mibgroup/disman/expression/expObjectTable.c
--- net-snmp-5.8/agent/mibgroup/disman/expression/expObjectTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/expression/expObjectTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -36,7 +36,7 @@
 #endif
 
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(header_complex_find_entry)
+netsnmp_feature_require(header_complex_find_entry);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /*
diff -urpN net-snmp-5.8/agent/mibgroup/disman/mteEventNotificationTable.c net-snmp-5.9.1/agent/mibgroup/disman/mteEventNotificationTable.c
--- net-snmp-5.8/agent/mibgroup/disman/mteEventNotificationTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/mteEventNotificationTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -9,8 +9,8 @@
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 #include "mteEventNotificationTable.h"
 
-netsnmp_feature_require(table_dataset)
-netsnmp_feature_require(table_set_multi_add_default_row)
+netsnmp_feature_require(table_dataset);
+netsnmp_feature_require(table_set_multi_add_default_row);
 
 netsnmp_table_data_set *mteEventNotif_table_set;
 
diff -urpN net-snmp-5.8/agent/mibgroup/disman/mteEventTable.c net-snmp-5.9.1/agent/mibgroup/disman/mteEventTable.c
--- net-snmp-5.8/agent/mibgroup/disman/mteEventTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/mteEventTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -12,8 +12,8 @@
 #include "mteEventNotificationTable.h"
 #include "mteObjectsTable.h"
 
-netsnmp_feature_require(table_dataset)
-netsnmp_feature_require(table_set_multi_add_default_row)
+netsnmp_feature_require(table_dataset);
+netsnmp_feature_require(table_set_multi_add_default_row);
 
 static netsnmp_table_data_set *table_set = NULL;
 
diff -urpN net-snmp-5.8/agent/mibgroup/disman/mteObjectsTable.c net-snmp-5.9.1/agent/mibgroup/disman/mteObjectsTable.c
--- net-snmp-5.8/agent/mibgroup/disman/mteObjectsTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/mteObjectsTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -19,7 +19,7 @@
 #endif
 
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(header_complex_find_entry)
+netsnmp_feature_require(header_complex_find_entry);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /*
diff -urpN net-snmp-5.8/agent/mibgroup/disman/mteTriggerTable.c net-snmp-5.9.1/agent/mibgroup/disman/mteTriggerTable.c
--- net-snmp-5.8/agent/mibgroup/disman/mteTriggerTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/mteTriggerTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -21,12 +21,12 @@
 #include <limits.h>
 #endif
 
-netsnmp_feature_require(mib_snprint_variable)
-netsnmp_feature_require(tdomain_support)
-netsnmp_feature_require(check_vb_uint)
-netsnmp_feature_require(string_time_to_secs)
+netsnmp_feature_require(mib_snprint_variable);
+netsnmp_feature_require(tdomain_support);
+netsnmp_feature_require(check_vb_uint);
+netsnmp_feature_require(string_time_to_secs);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(header_complex_find_entry)
+netsnmp_feature_require(header_complex_find_entry);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /*
diff -urpN net-snmp-5.8/agent/mibgroup/disman/nslookup/lookupCtlTable.c net-snmp-5.9.1/agent/mibgroup/disman/nslookup/lookupCtlTable.c
--- net-snmp-5.8/agent/mibgroup/disman/nslookup/lookupCtlTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/nslookup/lookupCtlTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -21,7 +21,7 @@
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(header_complex_find_entry)
+netsnmp_feature_require(header_complex_find_entry);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 #include <arpa/inet.h>
diff -urpN net-snmp-5.8/agent/mibgroup/disman/ping/pingCtlTable.c net-snmp-5.9.1/agent/mibgroup/disman/ping/pingCtlTable.c
--- net-snmp-5.8/agent/mibgroup/disman/ping/pingCtlTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/ping/pingCtlTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -74,6 +74,10 @@ static struct proto {
     int             icmpproto;  /* IPPROTO_xxx value for ICMP */
 } *pr;
 
+static volatile int    exiting;
+static volatile int    status_snapshot;
+
+
 /*
  *pingCtlTable_variables_oid:
  *                                                      
@@ -1328,7 +1332,8 @@ readloop(struct pingCtlTable_data *item,
 	snmp_log_perror("pingCtlTable: failed to create socket");
 	return;
     }
-    setuid(getuid());           /* don't need special permissions any more */
+    /* don't need special permissions any more */
+    NETSNMP_IGNORE_RESULT(setuid(getuid()));
 
     tv.tv_sec = 5;
     tv.tv_usec = 0;
@@ -1408,9 +1413,12 @@ proc_v4(char *ptr, ssize_t len, struct t
         ip = (struct ip *) ptr; /* start of IP header */
         hlen1 = ip->ip_hl << 2; /* length of IP header */
 
-        icmp = (struct icmp *) (ptr + hlen1);   /* start of ICMP header */
-        if ((icmplen = len - hlen1) < 8)
+        if ((icmplen = len - hlen1) < 8) {
             DEBUGMSGTL(("pingCtlTable", "icmplen (%d) < 8", icmplen));
+            return SNMP_ERR_BADVALUE;
+        }
+
+        icmp = (struct icmp *) (ptr + hlen1);   /* start of ICMP header */
 
         DEBUGMSGTL(("pingCtlTable", "ICMP type = %d (%sa reply)\n",
                     icmp->icmp_type,
@@ -1422,8 +1430,10 @@ proc_v4(char *ptr, ssize_t len, struct t
                 return SNMP_ERR_NOERROR;
             }
 
-            if (icmplen < 16)
+            if (icmplen < 16) {
                 DEBUGMSGTL(("pingCtlTable", "icmplen (%d) < 16", icmplen));
+                return SNMP_ERR_BADVALUE;
+            }
 
             tvsend = (struct timeval *) icmp->icmp_data;
 
@@ -1812,7 +1822,7 @@ run_ping(unsigned int clientreg, void *c
         socket_errno = errno;
 
         uid = getuid();
-        setuid(uid);
+        NETSNMP_IGNORE_RESULT(setuid(uid));
 
         source.sin6_family = AF_INET6;
         memset(&firsthop, 0, sizeof(firsthop));
@@ -4610,7 +4620,7 @@ pinger(int icmp_sock, int preload, int c
                  && (*pipesize) < (*screen_width))
                 || in_flight(acked, nreceived, ntransmitted,
                              nerrors) < (*screen_width))
-                write(STDOUT_FILENO, ".", 1);
+                NETSNMP_IGNORE_RESULT(write(STDOUT_FILENO, ".", 1));
         }
 
         return interval - tokens;
@@ -4672,7 +4682,7 @@ pinger(int icmp_sock, int preload, int c
 
         if (i == 0 && !(options & F_QUIET)) {
             if (options & F_FLOOD)
-                write(STDOUT_FILENO, "E", 1);
+                NETSNMP_IGNORE_RESULT(write(STDOUT_FILENO, "E", 1));
             else
                 perror("ping: sendmsg");
         }
@@ -5268,9 +5278,9 @@ gather_statistics(int *series, struct pi
 
     if (options & F_FLOOD) {
         if (!csfailed)
-            write(STDOUT_FILENO, "\b \b", 3);
+            NETSNMP_IGNORE_RESULT(write(STDOUT_FILENO, "\b \b", 3));
         else
-            write(STDOUT_FILENO, "\bC", 1);
+            NETSNMP_IGNORE_RESULT(write(STDOUT_FILENO, "\bC", 1));
     } else {
         int             i;
         __u8           *cp, *dp;
@@ -5592,7 +5602,7 @@ receive_error_msg(int icmp_sock, struct
         if (options & F_QUIET)
             goto out;
         if (options & F_FLOOD)
-            write(STDOUT_FILENO, "E", 1);
+            NETSNMP_IGNORE_RESULT(write(STDOUT_FILENO, "E", 1));
         else if (e->ee_errno != EMSGSIZE)
             snmp_log(LOG_ERR, "ping: local error: %s\n", strerror(e->ee_errno));
         else
@@ -5616,7 +5626,7 @@ receive_error_msg(int icmp_sock, struct
         if (options & F_QUIET)
             goto out;
         if (options & F_FLOOD) {
-            write(STDOUT_FILENO, "\bE", 2);
+            NETSNMP_IGNORE_RESULT(write(STDOUT_FILENO, "\bE", 2));
         } else {
             fflush(stdout);
         }
@@ -5770,7 +5780,7 @@ parse_reply(int *series, struct pingCtlT
                 return 0;
             (*nerrors)++;
             if (options & F_FLOOD) {
-                write(STDOUT_FILENO, "\bE", 2);
+                NETSNMP_IGNORE_RESULT(write(STDOUT_FILENO, "\bE", 2));
                 return 0;
             }
             DEBUGMSGTL(("pingCtlTable", "From %s: icmp_seq=%u ",
diff -urpN net-snmp-5.8/agent/mibgroup/disman/ping/pingCtlTable.h net-snmp-5.9.1/agent/mibgroup/disman/ping/pingCtlTable.h
--- net-snmp-5.8/agent/mibgroup/disman/ping/pingCtlTable.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/ping/pingCtlTable.h	2021-05-26 05:19:35.000000000 +0700
@@ -327,8 +327,6 @@ unsigned long   round_double(double);
 
 #define	MAX_DUP_CHK	0x10000
 
-volatile int    exiting;
-volatile int    status_snapshot;
 
 #ifndef MSG_CONFIRM
 #define MSG_CONFIRM 0
diff -urpN net-snmp-5.8/agent/mibgroup/disman/schedule/schedConf.c net-snmp-5.9.1/agent/mibgroup/disman/schedule/schedConf.c
--- net-snmp-5.8/agent/mibgroup/disman/schedule/schedConf.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/schedule/schedConf.c	2021-05-26 05:19:35.000000000 +0700
@@ -11,8 +11,8 @@
 #include "disman/schedule/schedCore.h"
 #include "disman/schedule/schedConf.h"
 
-netsnmp_feature_require(iquery)
-netsnmp_feature_require(string_time_to_secs)
+netsnmp_feature_require(iquery);
+netsnmp_feature_require(string_time_to_secs);
 
 static int schedEntries;
 
diff -urpN net-snmp-5.8/agent/mibgroup/disman/schedule/schedCore.c net-snmp-5.9.1/agent/mibgroup/disman/schedule/schedCore.c
--- net-snmp-5.8/agent/mibgroup/disman/schedule/schedCore.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/schedule/schedCore.c	2021-05-26 05:19:35.000000000 +0700
@@ -10,9 +10,9 @@
 #include "disman/schedule/schedCore.h"
 #include "utilities/iquery.h"
 
-netsnmp_feature_require(iquery)
+netsnmp_feature_require(iquery);
 
-netsnmp_feature_child_of(sched_nextrowtime, netsnmp_unused)
+netsnmp_feature_child_of(sched_nextrowtime, netsnmp_unused);
 
 netsnmp_tdata *schedule_table;
 
diff -urpN net-snmp-5.8/agent/mibgroup/disman/schedule/schedTable.c net-snmp-5.9.1/agent/mibgroup/disman/schedule/schedTable.c
--- net-snmp-5.8/agent/mibgroup/disman/schedule/schedTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/schedule/schedTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -14,16 +14,16 @@
 #include "disman/schedule/schedCore.h"
 #include "disman/schedule/schedTable.h"
 
-netsnmp_feature_require(iquery)
-netsnmp_feature_require(iquery_pdu_session)
-netsnmp_feature_require(table_tdata)
-netsnmp_feature_require(date_n_time)
-netsnmp_feature_require(check_vb_uint)
+netsnmp_feature_require(iquery);
+netsnmp_feature_require(iquery_pdu_session);
+netsnmp_feature_require(table_tdata);
+netsnmp_feature_require(date_n_time);
+netsnmp_feature_require(check_vb_uint);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_type_and_max_size)
-netsnmp_feature_require(check_vb_oid)
-netsnmp_feature_require(check_vb_truthvalue)
-netsnmp_feature_require(table_tdata_insert_row)
+netsnmp_feature_require(check_vb_type_and_max_size);
+netsnmp_feature_require(check_vb_oid);
+netsnmp_feature_require(check_vb_truthvalue);
+netsnmp_feature_require(table_tdata_insert_row);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 static netsnmp_table_registration_info *table_info;
diff -urpN net-snmp-5.8/agent/mibgroup/disman/traceroute/traceRouteCtlTable.c net-snmp-5.9.1/agent/mibgroup/disman/traceroute/traceRouteCtlTable.c
--- net-snmp-5.8/agent/mibgroup/disman/traceroute/traceRouteCtlTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/traceroute/traceRouteCtlTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -24,7 +24,7 @@
 #include <math.h>
 
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(header_complex_find_entry)
+netsnmp_feature_require(header_complex_find_entry);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 #include "traceRouteCtlTable.h"
@@ -4394,8 +4394,8 @@ run_traceRoute_ipv4(struct traceRouteCtl
     /*
      * Revert to non-privileged user after opening sockets 
      */
-    setgid(getgid());
-    setuid(getuid());
+    NETSNMP_IGNORE_RESULT(setgid(getgid()));
+    NETSNMP_IGNORE_RESULT(setuid(getuid()));
 
     outip->ip_src = from->sin_addr;
 #ifndef IP_HDRINCL
@@ -4981,7 +4981,7 @@ run_traceRoute_ipv6(struct traceRouteCtl
     icmp_sock = socket(AF_INET6, SOCK_RAW, IPPROTO_ICMPV6);
     socket_errno = errno;
 
-    setuid(getuid());
+    NETSNMP_IGNORE_RESULT(setuid(getuid()));
 
     on = 1;
     seq = tos = 0;
@@ -5003,14 +5003,14 @@ run_traceRoute_ipv6(struct traceRouteCtl
 
     if (inet_pton(AF_INET6, hostname, &to->sin6_addr) <= 0) {
         hp = gethostbyname2(hostname, AF_INET6);
-        free(hostname);
-        hostname = NULL;
         if (hp != NULL) {
             memmove((caddr_t) & to->sin6_addr, hp->h_addr, 16);
+            free(hostname);
             hostname = strdup((char *) hp->h_name);
         } else {
-            (void) fprintf(stderr,
-                           "traceroute: unknown host %s\n", hostname);
+            fprintf(stderr, "traceroute: unknown host %s\n", hostname);
+            free(hostname);
+            hostname = NULL;
             goto out;
         }
     }
@@ -5880,6 +5880,10 @@ packet_ok(u_char * buf, int cc, struct s
         struct ip *hip;
         struct udphdr *up;
 
+        if(cc < offsetof(struct icmp, icmp_ip) + sizeof(icp->icmp_ip)) {
+            return (0);
+        }
+
         hip = &icp->icmp_ip;
         hlen = hip->ip_hl << 2;
         up = (struct udphdr *) ((u_char *) hip + hlen);
@@ -5906,6 +5910,9 @@ packet_ok_v6(u_char * buf, int cc, struc
     struct icmp6_hdr *icp = NULL;
     u_char          type, code;
 
+    if(cc < sizeof(struct icmp6_hdr))
+        return 0;
+
     icp = (struct icmp6_hdr *) buf;
 
     type = icp->icmp6_type;
diff -urpN net-snmp-5.8/agent/mibgroup/disman/traceroute/traceRouteCtlTable.h net-snmp-5.9.1/agent/mibgroup/disman/traceroute/traceRouteCtlTable.h
--- net-snmp-5.8/agent/mibgroup/disman/traceroute/traceRouteCtlTable.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/traceroute/traceRouteCtlTable.h	2021-05-26 05:19:35.000000000 +0700
@@ -274,8 +274,6 @@ WriteMethod     write_traceRouteCtlRowSt
 static const char copyright[] =
     "@(#) Copyright (c) 1988, 1989, 1991, 1994, 1995, 1996, 1997, 1998, 1999, 2000\n\
 The Regents of the University of California.  All rights reserved.\n";
-static const char rcsid[] =
-    "@(#)$Id$ (LBL)";
 #endif
 
 /*
diff -urpN net-snmp-5.8/agent/mibgroup/disman/traceroute/traceRouteResultsTable.c net-snmp-5.9.1/agent/mibgroup/disman/traceroute/traceRouteResultsTable.c
--- net-snmp-5.8/agent/mibgroup/disman/traceroute/traceRouteResultsTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/disman/traceroute/traceRouteResultsTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -42,7 +42,7 @@
 #include "traceRouteHopsTable.h"
 #include "header_complex.h"
 
-netsnmp_feature_require(table_dataset)
+netsnmp_feature_require(table_dataset);
 
 /*
  *traceRouteResultsTable_variables_oid:
diff -urpN net-snmp-5.8/agent/mibgroup/etherlike-mib/data_access/dot3stats_linux.c net-snmp-5.9.1/agent/mibgroup/etherlike-mib/data_access/dot3stats_linux.c
--- net-snmp-5.8/agent/mibgroup/etherlike-mib/data_access/dot3stats_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/etherlike-mib/data_access/dot3stats_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -5,6 +5,13 @@
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/data_access/interface.h>
+
+#if HAVE_UNISTD_H
+#include <unistd.h>
+#endif
+
+#include "util_funcs.h"
 
 /*
  * include our parent header 
@@ -122,6 +129,9 @@ dot3stats_interface_ioctl_ifindex_get (i
     struct ifreq    ifrq;
     int rc = 0;
 
+    if (!netsnmp_access_interface_include(name))
+        return 0;
+
     DEBUGMSGTL(("access:dot3StatsTable:interface_ioctl_ifindex_get", "called\n"));
                  
     rc = _dot3Stats_ioctl_get(fd, SIOCGIFINDEX, &ifrq, name);
@@ -783,56 +793,34 @@ interface_ioctl_dot3stats_get (dot3Stats
 
 /*
  * @retval  0 success
- * @retval -1 ETHTOOL_GSET failed
+ * @retval -1 Both ETHTOOL_GLINKSETTINGS and ETHTOOL_GSET failed
  * @retval -2 function not supported if HAVE_LINUX_ETHTOOL_H not defined
  */
 
 int
-interface_ioctl_dot3stats_duplex_get(dot3StatsTable_rowreq_ctx *rowreq_ctx, int fd, const char* name) {
-
-#ifdef HAVE_LINUX_ETHTOOL_H
+interface_ioctl_dot3stats_duplex_get(dot3StatsTable_rowreq_ctx *rowreq_ctx, int fd, const char* name)
+{
     dot3StatsTable_data *data = &rowreq_ctx->data;
-    struct ethtool_cmd edata;
-    struct ifreq ifr;
+    struct netsnmp_linux_link_settings nlls;
     int err;
 
-    DEBUGMSGTL(("access:dot3StatsTable:interface_ioctl_dot3Stats_duplex_get",
-                "called\n"));
-
-    memset(&edata, 0, sizeof (edata));
-    memset(&ifr, 0, sizeof (ifr));
-    edata.cmd = ETHTOOL_GSET;
-    ifr.ifr_data = (char *)&edata;
-
-    err = _dot3Stats_ioctl_get (fd, SIOCETHTOOL, &ifr, name);
-    if (err < 0) {
-        DEBUGMSGTL(("access:dot3StatsTable:interface_ioctl_dot3Stats_duplex_get",
-                    "ETHTOOL_GSET failed\n"));
-
-        return -1;
-    }
-    
+    err = netsnmp_get_link_settings(&nlls, fd, name);
     if (err == 0) {
         rowreq_ctx->column_exists_flags |= COLUMN_DOT3STATSDUPLEXSTATUS_FLAG;
-        switch (edata.duplex) {
+        switch (nlls.duplex) {
         case DUPLEX_HALF:
-            data->dot3StatsDuplexStatus = (u_long) DOT3STATSDUPLEXSTATUS_HALFDUPLEX;
+            data->dot3StatsDuplexStatus = DOT3STATSDUPLEXSTATUS_HALFDUPLEX;
             break;
         case DUPLEX_FULL:
-            data->dot3StatsDuplexStatus = (u_long) DOT3STATSDUPLEXSTATUS_FULLDUPLEX;
+            data->dot3StatsDuplexStatus = DOT3STATSDUPLEXSTATUS_FULLDUPLEX;
             break;
         default:
-            data->dot3StatsDuplexStatus = (u_long) DOT3STATSDUPLEXSTATUS_UNKNOWN;
+            data->dot3StatsDuplexStatus = DOT3STATSDUPLEXSTATUS_UNKNOWN;
             break;
-        };
+        }
     }
 
-    DEBUGMSGTL(("access:dot3StatsTable:interface_ioctl_dot3Stats_duplex_get",
-                "ETHTOOL_GSET processed\n"));
     return err;
-#else
-    return -2;
-#endif
 }
 
 
@@ -904,8 +892,8 @@ _dot3Stats_ioctl_get(int fd, int which,
      */
     if(NULL == name) {
         DEBUGMSGTL(("access:dot3StatsTable:ioctl",
-                    "_dot3Stats_ioctl_get invalid ifname '%s'\n", name));
-        snmp_log (LOG_ERR, "access:dot3StatsTable:ioctl, _dot3Stats_ioctl_get error on interface '%s'\n", name);
+                    "_dot3Stats_ioctl_get interface name is NULL"));
+        snmp_log (LOG_ERR, "access:dot3StatsTable:ioctl, _dot3Stats_ioctl_get interface name is NULL");
         return -1;
     }
 
diff -urpN net-snmp-5.8/agent/mibgroup/etherlike-mib/dot3StatsTable/dot3StatsTable_data_access.c net-snmp-5.9.1/agent/mibgroup/etherlike-mib/dot3StatsTable/dot3StatsTable_data_access.c
--- net-snmp-5.8/agent/mibgroup/etherlike-mib/dot3StatsTable/dot3StatsTable_data_access.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/etherlike-mib/dot3StatsTable/dot3StatsTable_data_access.c	2021-05-26 05:19:35.000000000 +0700
@@ -12,6 +12,10 @@
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
+#if HAVE_UNISTD_H
+#include <unistd.h>
+#endif
+
 /*
  * include our parent header 
  */
diff -urpN net-snmp-5.8/agent/mibgroup/etherlike-mib/dot3StatsTable/dot3StatsTable_interface.c net-snmp-5.9.1/agent/mibgroup/etherlike-mib/dot3StatsTable/dot3StatsTable_interface.c
--- net-snmp-5.8/agent/mibgroup/etherlike-mib/dot3StatsTable/dot3StatsTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/etherlike-mib/dot3StatsTable/dot3StatsTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,9 +47,9 @@
 
 #include <ctype.h>
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(check_all_requests_error);
 
 /**********************************************************************
  **********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/examples/data_set.c net-snmp-5.9.1/agent/mibgroup/examples/data_set.c
--- net-snmp-5.8/agent/mibgroup/examples/data_set.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/examples/data_set.c	2021-05-26 05:19:35.000000000 +0700
@@ -68,12 +68,12 @@
 #include <net-snmp/net-snmp-features.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
-netsnmp_feature_require(table_set_multi_add_default_row)
-netsnmp_feature_require(unregister_auto_data_table)
-netsnmp_feature_require(delete_table_data_set)
-netsnmp_feature_require(table_dataset)
-netsnmp_feature_require(table_set_multi_add_default_row)
-netsnmp_feature_require(table_dataset_unregister_auto_data_table)
+netsnmp_feature_require(table_set_multi_add_default_row);
+netsnmp_feature_require(unregister_auto_data_table);
+netsnmp_feature_require(delete_table_data_set);
+netsnmp_feature_require(table_dataset);
+netsnmp_feature_require(table_set_multi_add_default_row);
+netsnmp_feature_require(table_dataset_unregister_auto_data_table);
 
 static netsnmp_table_data_set *table_set;
 
diff -urpN net-snmp-5.8/agent/mibgroup/examples/netSnmpHostsTable.c net-snmp-5.9.1/agent/mibgroup/examples/netSnmpHostsTable.c
--- net-snmp-5.8/agent/mibgroup/examples/netSnmpHostsTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/examples/netSnmpHostsTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -11,9 +11,9 @@
 #include "netSnmpHostsTable_checkfns.h"
 #include "netSnmpHostsTable_access.h"
 
-netsnmp_feature_require(oid_stash)
-netsnmp_feature_require(oid_stash_get_data)
-netsnmp_feature_require(oid_stash_add_data)
+netsnmp_feature_require(oid_stash);
+netsnmp_feature_require(oid_stash_get_data);
+netsnmp_feature_require(oid_stash_add_data);
 
 static netsnmp_oid_stash_node *undoStorage = NULL;
 static netsnmp_oid_stash_node *commitStorage = NULL;
diff -urpN net-snmp-5.8/agent/mibgroup/examples/netSnmpHostsTable_checkfns.c net-snmp-5.9.1/agent/mibgroup/examples/netSnmpHostsTable_checkfns.c
--- net-snmp-5.8/agent/mibgroup/examples/netSnmpHostsTable_checkfns.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/examples/netSnmpHostsTable_checkfns.c	2021-05-26 05:19:35.000000000 +0700
@@ -20,7 +20,7 @@
 #include "netSnmpHostsTable_checkfns_local.h"
 #include "netSnmpHostsTable_enums.h"
 
-netsnmp_feature_require(check_storage_transition)
+netsnmp_feature_require(check_storage_transition);
 
 /** Decides if an incoming value for the netSnmpHostAddressType mib node is legal.
  *  @param type    The incoming data type.
@@ -83,7 +83,7 @@ check_netSnmpHostAddress(int type, char
         return SNMP_ERR_WRONGTYPE;
 
     /** Check the ranges of the passed value for legality */
-    if (!(val_len >= 0 && val_len <= 255))
+    if (val_len > 255)
         return SNMP_ERR_WRONGVALUE;
 
     /** looks ok, call the local version of the same function. */
diff -urpN net-snmp-5.8/agent/mibgroup/examples/scalar_int.c net-snmp-5.9.1/agent/mibgroup/examples/scalar_int.c
--- net-snmp-5.8/agent/mibgroup/examples/scalar_int.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/examples/scalar_int.c	2021-05-26 05:19:35.000000000 +0700
@@ -31,7 +31,7 @@
  * if --enable-minimalist has been turned on, we need to register
  * the support we need so the needed functions aren't removed at compile time
  */
-netsnmp_feature_require(long_instance)
+netsnmp_feature_require(long_instance);
 
 /*
  * Then, we declare the variables we want to be accessed 
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/cpu/cpu.c net-snmp-5.9.1/agent/mibgroup/hardware/cpu/cpu.c
--- net-snmp-5.8/agent/mibgroup/hardware/cpu/cpu.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/cpu/cpu.c	2021-05-26 05:19:35.000000000 +0700
@@ -5,12 +5,12 @@
 #include <net-snmp/agent/hardware/cpu.h>
 #include "cpu.h"
 
-netsnmp_feature_child_of(hardware_cpu, libnetsnmpmibs)
+netsnmp_feature_child_of(hardware_cpu, libnetsnmpmibs);
 
-netsnmp_feature_child_of(hardware_cpu_copy_stats, hardware_cpu)
-netsnmp_feature_child_of(hardware_cpu_load, hardware_cpu)
-netsnmp_feature_child_of(hardware_cpu_get_cache, hardware_cpu)
-netsnmp_feature_child_of(hardware_cpu_get_byName, hardware_cpu)
+netsnmp_feature_child_of(hardware_cpu_copy_stats, hardware_cpu);
+netsnmp_feature_child_of(hardware_cpu_load, hardware_cpu);
+netsnmp_feature_child_of(hardware_cpu_get_cache, hardware_cpu);
+netsnmp_feature_child_of(hardware_cpu_get_byName, hardware_cpu);
 
 static void _cpu_update_stats( unsigned int, void* );
 
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/cpu/cpu_kinfo.c net-snmp-5.9.1/agent/mibgroup/hardware/cpu/cpu_kinfo.c
--- net-snmp-5.8/agent/mibgroup/hardware/cpu/cpu_kinfo.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/cpu/cpu_kinfo.c	2021-05-26 05:19:35.000000000 +0700
@@ -14,7 +14,7 @@
 #include <unistd.h>
 #include <sys/sysctl.h>
 
-netsnmp_feature_require(hardware_cpu_copy_stats)
+netsnmp_feature_require(hardware_cpu_copy_stats);
 void _cpu_copy_stats( netsnmp_cpu_info *cpu );
 
     /*
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/cpu/cpu_kstat.c net-snmp-5.9.1/agent/mibgroup/hardware/cpu/cpu_kstat.c
--- net-snmp-5.8/agent/mibgroup/hardware/cpu/cpu_kstat.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/cpu/cpu_kstat.c	2021-05-26 05:19:35.000000000 +0700
@@ -22,8 +22,9 @@ int _cpu_status(char *state);
      * Initialise the list of CPUs on the system
      *   (including descriptions)
      */
-void init_cpu_kstat( void ) {
-    int               i = 0, n = 0, clock, state_begin;
+void init_cpu_kstat(void)
+{
+    int               i = 0, n = 0, clock;
     char              ctype[16], ftype[16], state[10];
     kstat_t          *ksp;
     kstat_named_t    *ks_data;
@@ -49,8 +50,6 @@ void init_cpu_kstat( void ) {
             for (i=0, ks_data = ksp->ks_data; i < ksp->ks_ndata; i++, ks_data++) {
                 if ( strcmp( ks_data->name, "state" ) == 0 ) {
                     strlcpy(state, ks_data->value.c, sizeof(state));
-                } else if ( strcmp( ks_data->name, "state_begin" ) == 0 ) {
-                    state_begin = ks_data->value.i32;
                 } else if ( strcmp( ks_data->name, "cpu_type" ) == 0 ) {
                     strlcpy(ctype, ks_data->value.c, sizeof(ctype));
                 } else if ( strcmp( ks_data->name, "fpu_type" ) == 0 ) {
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/cpu/cpu_linux.c net-snmp-5.9.1/agent/mibgroup/hardware/cpu/cpu_linux.c
--- net-snmp-5.8/agent/mibgroup/hardware/cpu/cpu_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/cpu/cpu_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -122,6 +122,7 @@ int netsnmp_cpu_arch_load( netsnmp_cache
         bsize = getpagesize()-1;
         buff = (char*)malloc(bsize+1);
         if (buff == NULL) {
+            close(statfd);
             return -1;
         }
     }
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/cpu/cpu_nlist.c net-snmp-5.9.1/agent/mibgroup/hardware/cpu/cpu_nlist.c
--- net-snmp-5.8/agent/mibgroup/hardware/cpu/cpu_nlist.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/cpu/cpu_nlist.c	2021-05-26 05:19:35.000000000 +0700
@@ -32,7 +32,7 @@
 #define CPU_SYMBOL  "cp_time"
 #define MEM_SYMBOL  "cnt"
 
-netsnmp_feature_require(hardware_cpu_copy_stats)
+netsnmp_feature_require(hardware_cpu_copy_stats);
 void _cpu_copy_stats( netsnmp_cpu_info *cpu );
 
     /*
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/cpu/cpu_perfstat.c net-snmp-5.9.1/agent/mibgroup/hardware/cpu/cpu_perfstat.c
--- net-snmp-5.8/agent/mibgroup/hardware/cpu/cpu_perfstat.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/cpu/cpu_perfstat.c	2021-05-26 05:19:35.000000000 +0700
@@ -15,7 +15,7 @@
 #include <sys/protosw.h>
 #include <libperfstat.h>
 
-netsnmp_feature_require(hardware_cpu_copy_stats)
+netsnmp_feature_require(hardware_cpu_copy_stats);
 void _cpu_copy_stats( netsnmp_cpu_info *cpu );
 
     /*
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/cpu/cpu_sysctl.c net-snmp-5.9.1/agent/mibgroup/hardware/cpu/cpu_sysctl.c
--- net-snmp-5.8/agent/mibgroup/hardware/cpu/cpu_sysctl.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/cpu/cpu_sysctl.c	2021-05-26 05:19:35.000000000 +0700
@@ -12,7 +12,7 @@
 #include <unistd.h>
 #include <sys/types.h>
 
-#if defined(__FreeBSD__)
+#if defined(freebsd3)
 #include <sys/resource.h>
 #if !defined(CPUSTATES)
 #include <sys/dkstat.h>
@@ -34,7 +34,7 @@
 #include <uvm/uvm_extern.h>
 #endif
 
-netsnmp_feature_require(hardware_cpu_copy_stats)
+netsnmp_feature_require(hardware_cpu_copy_stats);
 
 void _cpu_copy_stats( netsnmp_cpu_info *cpu );
 
@@ -92,7 +92,7 @@ void init_cpu_sysctl( void ) {
 #elif defined(KERN_CPTIME)                /* OpenBSD */
 #define NETSNMP_KERN_CPU  KERN_CPTIME
 
-#elif defined(__FreeBSD__)
+#elif defined(freebsd3)
 #define NETSNMP_KERN_MCPU 1    /* Enable support for multi-cpu stats. Valid for FreeBSD >=6.4, >=7.1, >=8.0 and beyond */
 #define NETSNMP_KERN_MCPU_TYPE NETSNMP_CPU_STATS
 
@@ -132,9 +132,22 @@ void init_cpu_sysctl( void ) {
 #define NETSNMP_VM_STATS_TYPE  struct uvmexp
 #endif  /* VM_UVMEXP2 || VM_UVMEXP */
 
-#elif defined(__FreeBSD__)                /* FreeBSD */
+#elif defined(freebsd3)                /* FreeBSD */
+#if __FreeBSD_version >= 1200028
+#define	VMMETER_TYPE	uint64_t
+#else
+#define	VMMETER_TYPE	u_int
+#endif
+struct __vmmeter {
+	VMMETER_TYPE	v_intr;
+	VMMETER_TYPE	v_swtch;
+	VMMETER_TYPE	v_swappgsin;
+	VMMETER_TYPE	v_swappgsout;
+	VMMETER_TYPE	v_swapin;
+	VMMETER_TYPE	v_swapout;
+};
 #define NETSNMP_VM_STATS       VM_METER
-#define NETSNMP_VM_STATS_TYPE  struct vmmeter
+#define NETSNMP_VM_STATS_TYPE  struct __vmmeter
     #define NS_VM_INTR		v_intr
     #define NS_VM_SWTCH		v_swtch
     #define NS_VM_PAGEIN	v_swappgsin
@@ -172,10 +185,10 @@ int netsnmp_cpu_arch_load( netsnmp_cache
      */
     NETSNMP_CPU_STATS cpu_stats[CPUSTATES];
     size_t         cpu_size  = sizeof(cpu_stats);
-#if !defined(__FreeBSD__) && !defined(__NetBSD__)
+#if !defined(freebsd3) && !defined(__NetBSD__)
     int            cpu_mib[] = { CTL_KERN, NETSNMP_KERN_CPU };
 #endif
-#ifdef __FreeBSD__
+#ifdef freebsd3
     static int     cp_times = -1;
 #endif
 #ifdef KERN_CPTIME2
@@ -188,11 +201,9 @@ int netsnmp_cpu_arch_load( netsnmp_cache
     size_t         mcpu_size;
 #endif
     NETSNMP_VM_STATS_TYPE mem_stats;
-    int            mem_mib[] = { CTL_VM, NETSNMP_VM_STATS };
-    size_t         mem_size  = sizeof(NETSNMP_VM_STATS_TYPE);
     netsnmp_cpu_info *cpu = netsnmp_cpu_get_byIdx( -1, 0 );
 
-#if defined(__FreeBSD__) || defined(__NetBSD__)
+#if defined(freebsd3) || defined(__NetBSD__)
     sysctlbyname("kern.cp_time", cpu_stats, &cpu_size, NULL, 0);
 #else
     sysctl(cpu_mib, 2,  cpu_stats, &cpu_size, NULL, 0);
@@ -205,11 +216,34 @@ int netsnmp_cpu_arch_load( netsnmp_cache
     cpu->intrpt_ticks = cpu_stats[CP_INTR];
         /* wait_ticks, sirq_ticks unused */
     
-        /*
-         * Interrupt/Context Switch statistics
-         *   XXX - Do these really belong here ?
-         */
-    sysctl(mem_mib, 2, &mem_stats, &mem_size, NULL, 0);
+#ifdef freebsd3
+#define	GET_VM_STATS(space, name) sysctlbyname("vm.stats." #space "." #name, &mem_stats.name, &len, NULL, 0)
+    {
+	size_t len;
+
+	len = sizeof(VMMETER_TYPE);
+	GET_VM_STATS(sys, v_intr);
+	GET_VM_STATS(sys, v_swtch);
+	GET_VM_STATS(vm, v_swappgsin);
+	GET_VM_STATS(vm, v_swappgsout);
+	GET_VM_STATS(vm, v_swapin);
+	GET_VM_STATS(vm, v_swapout);
+    }
+#undef GET_VM_STATS
+#else
+    {
+        static const int mem_mib[] = { CTL_VM, NETSNMP_VM_STATS };
+        size_t           mem_size  = sizeof(mem_stats);
+
+        sysctl(mem_mib, sizeof(mem_mib) / sizeof(mem_mib[0]), &mem_stats,
+               &mem_size, NULL, 0);
+        netsnmp_assert(mem_size == sizeof(mem_stats));
+    }
+#endif
+    /*
+     * Interrupt/Context Switch statistics
+     *   XXX - Do these really belong here ?
+     */
     cpu->nInterrupts  = mem_stats.NS_VM_INTR;
     cpu->nCtxSwitches = mem_stats.NS_VM_SWTCH;
     cpu->swapIn       = mem_stats.NS_VM_SWAPIN;
@@ -229,7 +263,7 @@ int netsnmp_cpu_arch_load( netsnmp_cache
     mcpu_size  = cpu_num*sizeof(cpu_stats);
     mcpu_stats = malloc(mcpu_size);
     sysctlbyname("kern.cp_time", mcpu_stats, &mcpu_size, NULL, 0);
-#elif defined(__FreeBSD__)
+#elif defined(freebsd3)
     if (cp_times == -1) {
 	int ret = sysctlbyname("kern.cp_times", NULL, &mcpu_size, NULL, 0);
 	cp_times = ret == -1 ? 0 : 1;
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/fsys/fsys_getfsstats.c net-snmp-5.9.1/agent/mibgroup/hardware/fsys/fsys_getfsstats.c
--- net-snmp-5.8/agent/mibgroup/hardware/fsys/fsys_getfsstats.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/fsys/fsys_getfsstats.c	2021-05-26 05:19:35.000000000 +0700
@@ -119,11 +119,11 @@ netsnmp_fsys_arch_load( void )
     /*
      * Retrieve information about the currently mounted filesystems...
      */
-    n = NSFS_GETFSSTAT( NULL, 0, MNT_NOWAIT );
+    n = NSFS_GETFSSTAT( NULL, 0, MNT_WAIT );
     if ( n==0 )
         return;
     stats = (struct NSFS_STATFS *)malloc( n * sizeof( struct NSFS_STATFS ));
-    n = NSFS_GETFSSTAT( stats, n * sizeof( struct NSFS_STATFS ), MNT_NOWAIT );
+    n = NSFS_GETFSSTAT( stats, n * sizeof( struct NSFS_STATFS ), MNT_WAIT );
 
     /*
      * ... and insert this into the filesystem container.
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/fsys/fsys_mntctl.c net-snmp-5.9.1/agent/mibgroup/hardware/fsys/fsys_mntctl.c
--- net-snmp-5.8/agent/mibgroup/hardware/fsys/fsys_mntctl.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/fsys/fsys_mntctl.c	2021-05-26 05:19:35.000000000 +0700
@@ -43,8 +43,9 @@ _fsys_type( int type)
 
         case  MNT_NFS:
         case  MNT_NFS3:
-        case  MNT_AUTOFS:
             return NETSNMP_FS_TYPE_NFS;
+        case  MNT_AUTOFS:
+            return NETSNMP_FS_TYPE_AUTOFS;
 
     /*
      *  The following code covers selected filesystems
@@ -155,12 +156,15 @@ netsnmp_fsys_arch_load( void )
          */
 
         /*
-         *  Optionally skip retrieving statistics for remote mounts
+         *  Skip retrieving statistics for AUTOFS and optionally for remote
+         *  mounts.
          */
         if ( (entry->flags & NETSNMP_FS_FLAG_REMOTE) &&
             netsnmp_ds_get_boolean(NETSNMP_DS_APPLICATION_ID,
                                    NETSNMP_DS_AGENT_SKIPNFSINHOSTRESOURCES))
             continue;
+        if (entry->type == NETSNMP_FS_TYPE_AUTOFS)
+            continue;
 
         if ( statfs( entry->path, &stat_buf ) < 0 ) {
             snprintf( tmpbuf, sizeof(tmpbuf), "Cannot statfs %s", entry->path );
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/fsys/fsys_mntent.c net-snmp-5.9.1/agent/mibgroup/hardware/fsys/fsys_mntent.c
--- net-snmp-5.8/agent/mibgroup/hardware/fsys/fsys_mntent.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/fsys/fsys_mntent.c	2021-05-26 05:19:35.000000000 +0700
@@ -59,6 +59,36 @@
 
 #endif
 
+/*
+ * File systems to monitor and that are not covered by any hrFSTypes
+ * enumeration.
+ */
+static const char *other_fs[] = {
+    "acfs",
+    "btrfs",
+    "cvfs",
+    "f2fs",
+    "fuse.glusterfs",
+    "gfs",
+    "gfs2",
+    "glusterfs",
+    "jfs",
+    "jffs2",
+    "lofs",
+    "mvfs",
+    "nsspool",
+    "nssvol",
+    "nvmfs",
+    "ocfs2",
+    "reiserfs",
+    "simfs",
+    "tmpfs",
+    "vxfs",
+    "xfs",
+    "zfs",
+    NULL,
+};
+
 static int
 _fsys_remote( char *device, int type )
 {
@@ -72,6 +102,8 @@ _fsys_remote( char *device, int type )
 static int
 _fsys_type( char *typename )
 {
+    const char **fs;
+
     DEBUGMSGTL(("fsys:type", "Classifying %s\n", typename));
 
     if ( !typename || *typename=='\0' )
@@ -124,37 +156,21 @@ _fsys_type( char *typename )
               !strcmp(typename, MNTTYPE_VFAT) )
        return NETSNMP_FS_TYPE_FAT32;
 
-    /*
-     *  The following code covers selected filesystems
-     *    which are not covered by the HR-TYPES enumerations,
-     *    but should still be monitored.
-     *  These are all mapped into type "other"
-     *
-     *    (The systems listed are not fixed in stone,
-     *     but are simply here to illustrate the principle!)
-     */    
-    else if ( !strcmp(typename, MNTTYPE_TMPFS) ||
-              !strcmp(typename, MNTTYPE_GFS) ||
-              !strcmp(typename, MNTTYPE_GFS2) ||
-              !strcmp(typename, MNTTYPE_XFS) ||
-              !strcmp(typename, MNTTYPE_JFS) ||
-              !strcmp(typename, MNTTYPE_VXFS) ||
-              !strcmp(typename, MNTTYPE_REISERFS) ||
-              !strcmp(typename, MNTTYPE_OCFS2) ||
-              !strcmp(typename, MNTTYPE_CVFS) ||
-              !strcmp(typename, MNTTYPE_SIMFS) ||
-              !strcmp(typename, MNTTYPE_BTRFS) ||
-              !strcmp(typename, MNTTYPE_ZFS) ||
-              !strcmp(typename, MNTTYPE_NVMFS) ||
-              !strcmp(typename, MNTTYPE_ACFS) ||
-              !strcmp(typename, MNTTYPE_LOFS))
-       return NETSNMP_FS_TYPE_OTHER;
+    for (fs = other_fs; *fs; fs++)
+        if (strcmp(typename, *fs) == 0)
+            return NETSNMP_FS_TYPE_OTHER;
+
+    /* Detection of AUTOFS.
+     * This file system will be ignored by default
+     */ 
+    if (!strcmp(typename, MNTTYPE_AUTOFS))
+        return NETSNMP_FS_TYPE_AUTOFS;
+
 
     /*    
      *  All other types are silently skipped
      */
-    else
-       return NETSNMP_FS_TYPE_IGNORE;
+    return NETSNMP_FS_TYPE_IGNORE;
 }
 
 void
@@ -212,7 +228,7 @@ netsnmp_fsys_arch_load( void )
         if ( _fsys_remote( entry->device, entry->type ))
             entry->flags |= NETSNMP_FS_FLAG_REMOTE;
 #if HAVE_HASMNTOPT
-        if (hasmntopt( m, "ro" ))
+        if (hasmntopt( m, NETSNMP_REMOVE_CONST(char *, "ro") ))
             entry->flags |= NETSNMP_FS_FLAG_RONLY;
         else
             entry->flags &= ~NETSNMP_FS_FLAG_RONLY;
@@ -239,36 +255,30 @@ netsnmp_fsys_arch_load( void )
                                    NETSNMP_DS_AGENT_SKIPNFSINHOSTRESOURCES))
             continue;
 
+        /* Skip AUTOFS entries */
+        if (entry->type == NETSNMP_FS_TYPE_AUTOFS)
+            continue;
+
 #ifdef irix6
         if ( NSFS_STATFS( entry->path, &stat_buf, sizeof(struct statfs), 0) < 0 )
 #else
         if ( NSFS_STATFS( entry->path, &stat_buf ) < 0 )
 #endif
         {
-            tmpbuf = NULL;
-            if (asprintf(&tmpbuf, "Cannot statfs %s", entry->path) >= 0)
+            static char logged = 0;
+
+            if (!logged &&
+                asprintf(&tmpbuf, "Cannot statfs %s", entry->path) >= 0) {
                 snmp_log_perror(tmpbuf);
-            free(tmpbuf);
-            entry->units = stat_buf.NSFS_SIZE;
-            entry->size  = 0;
-            entry->used  = 0;
-            entry->avail = 0;
-            entry->inums_total = stat_buf.f_files;
-            entry->inums_avail = stat_buf.f_ffree;
-            netsnmp_fsys_calculate32(entry);
-            continue;
+                free(tmpbuf);
+                logged = 1;
+            }
+            memset(&stat_buf, 0, sizeof(stat_buf));
         }
         entry->units =  stat_buf.NSFS_SIZE;
         entry->size  =  stat_buf.f_blocks;
         entry->used  = (stat_buf.f_blocks - stat_buf.f_bfree);
-        /* entry->avail is currently unsigned, so protect against negative
-         * values!
-         * This should be changed to a signed field.
-         */
-        if (stat_buf.f_bavail < 0)
-            entry->avail = 0;
-        else
-            entry->avail =  stat_buf.f_bavail;
+        entry->avail =  stat_buf.f_bavail;
         entry->inums_total = stat_buf.f_files;
         entry->inums_avail = stat_buf.f_ffree;
         netsnmp_fsys_calculate32(entry);
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/fsys/hw_fsys.c net-snmp-5.9.1/agent/mibgroup/hardware/fsys/hw_fsys.c
--- net-snmp-5.8/agent/mibgroup/hardware/fsys/hw_fsys.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/fsys/hw_fsys.c	2021-05-26 05:19:35.000000000 +0700
@@ -9,18 +9,49 @@
 #include <inttypes.h>
 #endif
 
-netsnmp_feature_child_of(hw_fsys_get_container, netsnmp_unused)
-
-static int  _fsys_load( void );
-static void _fsys_free( void );
+netsnmp_feature_child_of(hw_fsys_get_container, netsnmp_unused);
 
 static int _fsysAutoUpdate = 0;   /* 0 means on-demand caching */
-static void _fsys_update_stats( unsigned int, void* );
 
-netsnmp_cache     *_fsys_cache     = NULL;
-netsnmp_container *_fsys_container = NULL;
-static int         _fsys_idx       = 0;
-static netsnmp_fsys_info * _fsys_create_entry( void );
+static netsnmp_cache     *_fsys_cache;
+static netsnmp_container *_fsys_container;
+static int         _fsys_idx;
+
+
+/*
+ * Architecture-independent processing of loading filesystem statistics
+ */
+static int
+_fsys_load(void)
+{
+    netsnmp_fsys_arch_load();
+    /* XXX - update cache timestamp */
+    return 0;
+}
+
+/*
+ * Architecture-independent release of filesystem statistics
+ */
+static void
+_fsys_free(void)
+{
+    netsnmp_fsys_info *sp;
+
+    for (sp = CONTAINER_FIRST(_fsys_container); sp;
+         sp = CONTAINER_NEXT(_fsys_container, sp)) {
+         sp->flags &= ~NETSNMP_FS_FLAG_ACTIVE;
+    }
+}
+
+/*
+ * Wrapper routine for automatically updating fsys information
+ */
+void
+_fsys_update_stats(unsigned int clientreg, void *data)
+{
+    _fsys_free();
+    _fsys_load();
+}
 
 void init_hw_fsys( void ) {
 
@@ -78,16 +109,6 @@ netsnmp_cache *netsnmp_fsys_get_cache( v
 
 
 /*
- * Wrapper routine for automatically updating fsys information
- */
-void
-_fsys_update_stats( unsigned int clientreg, void *data )
-{
-    _fsys_free();
-    _fsys_load();
-}
-
-/*
  * Wrapper routine for re-loading filesystem statistics on demand
  */
 int
@@ -107,39 +128,35 @@ netsnmp_fsys_free( netsnmp_cache *cache,
 }
 
 
-/*
- * Architecture-independent processing of loading filesystem statistics
- */
-static int
-_fsys_load( void )
-{
-    netsnmp_fsys_arch_load();
-    /* XXX - update cache timestamp */
-    return 0;
+netsnmp_fsys_info *netsnmp_fsys_get_first(void) {
+    return CONTAINER_FIRST(_fsys_container);
 }
 
-/*
- * Architecture-independent release of filesystem statistics
- */
-static void
-_fsys_free( void )
+netsnmp_fsys_info *netsnmp_fsys_get_next(netsnmp_fsys_info *this_ptr) {
+    return CONTAINER_NEXT(_fsys_container, this_ptr);
+}
+
+netsnmp_fsys_info *
+_fsys_create_entry(void)
 {
     netsnmp_fsys_info *sp;
 
-    for (sp = CONTAINER_FIRST( _fsys_container );
-         sp;
-         sp = CONTAINER_NEXT(  _fsys_container, sp )) {
-
-         sp->flags &= ~NETSNMP_FS_FLAG_ACTIVE;
+    sp = SNMP_MALLOC_TYPEDEF(netsnmp_fsys_info);
+    if (sp) {
+        /*
+         * Set up the index value.
+         *
+         * All this trouble, just for a simple integer.
+         * Surely there must be a better way?
+         */
+        sp->idx.len  = 1;
+        sp->idx.oids = SNMP_MALLOC_TYPEDEF( oid );
+        sp->idx.oids[0] = ++_fsys_idx;
     }
-}
 
-
-netsnmp_fsys_info *netsnmp_fsys_get_first( void ) {
-    return CONTAINER_FIRST( _fsys_container );
-}
-netsnmp_fsys_info *netsnmp_fsys_get_next( netsnmp_fsys_info *this_ptr ) {
-    return CONTAINER_NEXT( _fsys_container, this_ptr );
+    DEBUGMSGTL(("fsys:new", "Create filesystem entry (index = %d)\n", _fsys_idx));
+    CONTAINER_INSERT(_fsys_container, sp);
+    return sp;
 }
 
 /*
@@ -224,30 +241,6 @@ netsnmp_fsys_by_device( char *device, in
     return sp;
 }
 
-
-netsnmp_fsys_info *
-_fsys_create_entry( void )
-{
-    netsnmp_fsys_info *sp;
-
-    sp = SNMP_MALLOC_TYPEDEF( netsnmp_fsys_info );
-    if ( sp ) {
-        /*
-         * Set up the index value.
-         *  
-         * All this trouble, just for a simple integer.
-         * Surely there must be a better way?
-         */
-        sp->idx.len  = 1;
-        sp->idx.oids = SNMP_MALLOC_TYPEDEF( oid );
-        sp->idx.oids[0] = ++_fsys_idx;
-    }
-
-    DEBUGMSGTL(("fsys:new", "Create filesystem entry (index = %d)\n", _fsys_idx));
-    CONTAINER_INSERT( _fsys_container, sp );
-    return sp;
-}
-
 
 /*
  *  Convert fsys size information to 1K units
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/fsys/mnttypes.h net-snmp-5.9.1/agent/mibgroup/hardware/fsys/mnttypes.h
--- net-snmp-5.8/agent/mibgroup/hardware/fsys/mnttypes.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/fsys/mnttypes.h	2021-05-26 05:19:35.000000000 +0700
@@ -112,61 +112,12 @@
 #ifndef MNTTYPE_MVFS
 #define MNTTYPE_MVFS     "mvfs"
 #endif
-#ifndef MNTTYPE_TMPFS
-#define MNTTYPE_TMPFS    "tmpfs"
-#endif
-#ifndef MNTTYPE_GFS
-#define MNTTYPE_GFS      "gfs"
-#endif
-#ifndef MNTTYPE_GFS2
-#define MNTTYPE_GFS2     "gfs2"
-#endif
-#ifndef MNTTYPE_XFS
-#define MNTTYPE_XFS      "xfs"
-#endif
-#ifndef MNTTYPE_JFS
-#define MNTTYPE_JFS      "jfs"
-#endif
-#ifndef MNTTYPE_VXFS
-#define MNTTYPE_VXFS      "vxfs"
-#endif
-#ifndef MNTTYPE_REISERFS
-#define MNTTYPE_REISERFS "reiserfs"
-#endif
-#ifndef MNTTYPE_LOFS
-#define MNTTYPE_LOFS     "lofs"
-#endif
-#ifndef MNTTYPE_OCFS2
-#define MNTTYPE_OCFS2    "ocfs2"
-#endif
-#ifndef MNTTYPE_CVFS
-#define MNTTYPE_CVFS     "cvfs"
-#endif
-#ifndef MNTTYPE_SIMFS
-#define MNTTYPE_SIMFS     "simfs"
-#endif
-#ifndef MNTTYPE_BTRFS
-#define MNTTYPE_BTRFS     "btrfs"
-#endif
-#ifndef MNTTYPE_ZFS
-#define MNTTYPE_ZFS       "zfs"
-#endif
-#ifndef MNTTYPE_NVMFS
-#define MNTTYPE_NVMFS     "nvmfs"
-#endif
-#ifndef MNTTYPE_ACFS
-#define MNTTYPE_ACFS      "acfs"
-#endif
 
 /*
  *  File systems to skip
- *    (Probably not strictly needed)
  */
-#ifndef MNTTYPE_APP
-#define MNTTYPE_APP      "app"
-#endif
-#ifndef MNTTYPE_DEVPTS
-#define MNTTYPE_DEVPTS   "devpts"
+#ifndef MNTTYPE_AUTOFS
+#define MNTTYPE_AUTOFS   "autofs"
 #endif
 #ifndef MNTTYPE_IGNORE
 #define MNTTYPE_IGNORE   "ignore"
@@ -174,17 +125,5 @@
 #ifndef MNTTYPE_PROC
 #define MNTTYPE_PROC     "proc"
 #endif
-#ifndef MNTTYPE_SYSFS
-#define MNTTYPE_SYSFS    "sysfs"
-#endif
-#ifndef MNTTYPE_USBFS
-#define MNTTYPE_USBFS    "usbfs"
-#endif
-#ifndef MNTTYPE_BINFMT
-#define MNTTYPE_BINFMT   "binfmt_misc"
-#endif
-#ifndef MNTTYPE_RPCPIPE
-#define MNTTYPE_RPCPIPE  "rpc_pipefs"
-#endif
 
 #endif /* _NETSNMP_FSYS_MNTTYPES_H */
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/fsys/mounts.h net-snmp-5.9.1/agent/mibgroup/hardware/fsys/mounts.h
--- net-snmp-5.8/agent/mibgroup/hardware/fsys/mounts.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/fsys/mounts.h	2021-05-26 05:19:35.000000000 +0700
@@ -8,21 +8,6 @@
  */
 
 /*
-#if (defined(BerkelyFS) && !defined(MNTTYPE_HFS)) || defined(solaris2)
-#define  _NETSNMP_FS_TYPE_UFS  NETSNMP_FS_TYPE_BERKELEY
-#else
-#define  _NETSNMP_FS_TYPE_UFS  NETSNMP_FS_TYPE_SYSV
-#endif
-
-#ifdef RockRidge
-#define  _NETSNMP_FS_TYPE_CDFS  NETSNMP_FS_TYPE_ROCKRIDGE
-#else
-#define  _NETSNMP_FS_TYPE_CDFS  NETSNMP_FS_TYPE_ISO9660
-#endif
- */
-
-
-/*
  *  Ensure all recognised filesystem mount type tokens are
  *    available (even on systems where they're not used)
  */
@@ -66,103 +51,4 @@
 #define MOUNT_ACFS   "acfs"
 #endif
 
-/*
-#ifndef MNTTYPE_AFS
-#define MNTTYPE_AFS      "afs"
-#endif
-#ifndef MNTTYPE_CDFS
-#define MNTTYPE_CDFS     "cdfs"
-#endif
-#ifndef MNTTYPE_CD9660
-#define MNTTYPE_CD9660   "cd9660"
-#endif
-#ifndef MNTTYPE_EXT2
-#define MNTTYPE_EXT2     "ext2"
-#endif
-#ifndef MNTTYPE_EXT3
-#define MNTTYPE_EXT3     "ext3"
-#endif
-#ifndef MNTTYPE_EXT2FS
-#define MNTTYPE_EXT2FS   "ext2fs"
-#endif
-#ifndef MNTTYPE_EXT3FS
-#define MNTTYPE_EXT3FS   "ext3fs"
-#endif
-#ifndef MNTTYPE_FAT32
-#define MNTTYPE_FAT32    "fat32"
-#endif
-#ifndef MNTTYPE_FFS
-#define MNTTYPE_FFS      "ffs"
-#endif
-#ifndef MNTTYPE_HFS
-#define MNTTYPE_HFS      "hfs"
-#endif
-#ifndef MNTTYPE_HSFS
-#define MNTTYPE_HSFS     "hsfs"
-#endif
-#ifndef MNTTYPE_ISO9660
-#define MNTTYPE_ISO9660  "iso9660"
-#endif
-#ifndef MNTTYPE_MFS
-#define MNTTYPE_MFS      "mfs"
-#endif
-#ifndef MNTTYPE_MSDOS
-#define MNTTYPE_MSDOS    "msdos"
-#endif
-#ifndef MNTTYPE_NCPFS
-#define MNTTYPE_NCPFS    "ncpfs"
-#endif
-#ifndef MNTTYPE_NFS
-#define MNTTYPE_NFS      "nfs"
-#endif
-#ifndef MNTTYPE_NFS3
-#define MNTTYPE_NFS3     "nfs3"
-#endif
-#ifndef MNTTYPE_NTFS
-#define MNTTYPE_NTFS     "ntfs"
-#endif
-#ifndef MNTTYPE_PC
-#define MNTTYPE_PC       "pc"
-#endif
-#ifndef MNTTYPE_REISERFS
-#define MNTTYPE_REISERFS "reiserfs"
-#endif
-#ifndef MNTTYPE_SMBFS
-#define MNTTYPE_SMBFS    "smbfs"
-#endif
-#ifndef MNTTYPE_SYSV
-#define MNTTYPE_SYSV     "sysv"
-#endif
-#ifndef MNTTYPE_UFS
-#define MNTTYPE_UFS      "ufs"
-#endif
-#ifndef MNTTYPE_VFAT
-#define MNTTYPE_VFAT     "vfat"
-#endif
-*/
-
-/*
- *  File systems to skip
- */
-/*
-#ifndef MNTTYPE_DEVPTS
-#define MNTTYPE_DEVPTS   "devpts"
-#endif
-#ifndef MNTTYPE_IGNORE
-#define MNTTYPE_IGNORE   "ignore"
-#endif
-#ifndef MNTTYPE_PROC
-#define MNTTYPE_PROC     "proc"
-#endif
-#ifndef MNTTYPE_SYSFS
-#define MNTTYPE_SYSFS    "sysfs"
-#endif
-#ifndef MNTTYPE_TMPFS
-#define MNTTYPE_TMPFS    "tmpfs"
-#endif
-#ifndef MNTTYPE_USBFS
-#define MNTTYPE_USBFS    "usbfs"
-#endif
-*/
-
 #endif /* _NETSNMP_FSYS_MOUNTS_H */
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/memory/hw_mem.c net-snmp-5.9.1/agent/mibgroup/hardware/memory/hw_mem.c
--- net-snmp-5.8/agent/mibgroup/hardware/memory/hw_mem.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/memory/hw_mem.c	2021-05-26 05:19:35.000000000 +0700
@@ -5,43 +5,52 @@
 #include <net-snmp/net-snmp-features.h>
 #include "hw_mem.h"
 
-netsnmp_feature_child_of(hardware_memory, netsnmp_unused)
+netsnmp_feature_child_of(hardware_memory, netsnmp_unused);
 
-netsnmp_feature_child_of(memory_get_cache, hardware_memory)
+netsnmp_feature_child_of(memory_get_cache, hardware_memory);
 
-netsnmp_memory_info *_mem_head  = NULL;
-netsnmp_cache       *_mem_cache = NULL;
+netsnmp_memory_info *_mem_head = NULL;
+netsnmp_cache  *_mem_cache = NULL;
 
 #ifdef darwin
-/* the code in memory_darwin.c is *very* expensive */
+/*
+ * the code in memory_darwin.c is *very* expensive 
+ */
 #define	MEMORY_CACHE_SECONDS	300
 #else
 #define	MEMORY_CACHE_SECONDS	5
 #endif
 
-void init_hw_mem( void ) {
-    oid nsMemory[] = { 1, 3, 6, 1, 4, 1, 8072, 1, 31 };
-    _mem_cache = netsnmp_cache_create( MEMORY_CACHE_SECONDS, netsnmp_mem_arch_load, NULL,
-                                          nsMemory, OID_LENGTH(nsMemory));
+void
+init_hw_mem(void)
+{
+    oid             nsMemory[] = { 1, 3, 6, 1, 4, 1, 8072, 1, 31 };
+    _mem_cache =
+        netsnmp_cache_create(MEMORY_CACHE_SECONDS, netsnmp_mem_arch_load,
+                             NULL, nsMemory, OID_LENGTH(nsMemory));
 }
 
 
 
-netsnmp_memory_info *netsnmp_memory_get_first( int type ) {
+netsnmp_memory_info *
+netsnmp_memory_get_first(int type)
+{
     netsnmp_memory_info *mem;
 
-    for ( mem=_mem_head; mem; mem=mem->next )
-        if (mem->type == type)    /* Or treat as bits? */
+    for (mem = _mem_head; mem; mem = mem->next)
+        if (mem->type == type)  /* Or treat as bits? */
             return mem;
     return NULL;
 }
 
-netsnmp_memory_info *netsnmp_memory_get_next( netsnmp_memory_info *this_ptr, int type ) {
+netsnmp_memory_info *
+netsnmp_memory_get_next(netsnmp_memory_info * this_ptr, int type)
+{
     netsnmp_memory_info *mem;
 
     if (this_ptr)
-        for ( mem=this_ptr->next; mem; mem=mem->next )
-            if (mem->type == type)    /* Or treat as bits? */
+        for (mem = this_ptr->next; mem; mem = mem->next)
+            if (mem->type == type)      /* Or treat as bits? */
                 return mem;
     return NULL;
 }
@@ -49,49 +58,57 @@ netsnmp_memory_info *netsnmp_memory_get_
     /*
      * Work with a list of Memory entries, indexed numerically
      */
-netsnmp_memory_info *netsnmp_memory_get_byIdx(  int idx, int create ) {
+netsnmp_memory_info *
+netsnmp_memory_get_byIdx(int idx, int create)
+{
     netsnmp_memory_info *mem, *mem2;
 
-        /*
-         * Find the specified Memory entry
-         */
-    for ( mem=_mem_head; mem; mem=mem->next ) {
-        if ( mem->idx == idx )
+    /*
+     * Find the specified Memory entry
+     */
+    for (mem = _mem_head; mem; mem = mem->next) {
+        if (mem->idx == idx)
             return mem;
     }
     if (!create)
         return NULL;
 
-        /*
-         * Create a new memory entry, and insert it into the list....
-         */
-    mem = SNMP_MALLOC_TYPEDEF( netsnmp_memory_info );
+    /*
+     * Create a new memory entry, and insert it into the list....
+     */
+    mem = SNMP_MALLOC_TYPEDEF(netsnmp_memory_info);
     if (!mem)
         return NULL;
     mem->idx = idx;
-        /* ... either as the first (or only) entry....  */
-    if ( !_mem_head || _mem_head->idx > idx ) {
+    /*
+     * ... either as the first (or only) entry....  
+     */
+    if (!_mem_head || _mem_head->idx > idx) {
         mem->next = _mem_head;
         _mem_head = mem;
         return mem;
     }
-        /* ... or in the appropriate position  */
-    for ( mem2=_mem_head; mem2; mem2=mem2->next ) {
-        if ( !mem2->next || mem2->next->idx > idx ) {
-            mem->next  = mem2->next;
+    /*
+     * ... or in the appropriate position  
+     */
+    for (mem2 = _mem_head; mem2; mem2 = mem2->next) {
+        if (!mem2->next || mem2->next->idx > idx) {
+            mem->next = mem2->next;
             mem2->next = mem;
             return mem;
         }
     }
     SNMP_FREE(mem);
-    return NULL;  /* Shouldn't happen! */
+    return NULL;                /* Shouldn't happen! */
 }
 
-netsnmp_memory_info *netsnmp_memory_get_next_byIdx( int idx, int type ) {
+netsnmp_memory_info *
+netsnmp_memory_get_next_byIdx(int idx, int type)
+{
     netsnmp_memory_info *mem;
 
-    for ( mem=_mem_head; mem; mem=mem->next )
-        if (mem->type == type && mem->idx > idx)    /* Or treat as bits? */
+    for (mem = _mem_head; mem; mem = mem->next)
+        if (mem->type == type && mem->idx > idx)        /* Or treat as bits? */
             return mem;
     return NULL;
 }
@@ -99,11 +116,15 @@ netsnmp_memory_info *netsnmp_memory_get_
 
 
 #ifndef NETSNMP_FEATURE_REMOVE_MEMORY_GET_CACHE
-netsnmp_cache *netsnmp_memory_get_cache( void ) {
+netsnmp_cache  *
+netsnmp_memory_get_cache(void)
+{
     return _mem_cache;
 }
-#endif /* NETSNMP_FEATURE_REMOVE_MEMORY_GET_CACHE */
+#endif                          /* NETSNMP_FEATURE_REMOVE_MEMORY_GET_CACHE */
 
-int netsnmp_memory_load( void ) {
-     return netsnmp_cache_check_and_reload( _mem_cache );
+int
+netsnmp_memory_load(void)
+{
+    return netsnmp_cache_check_and_reload(_mem_cache);
 }
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/memory/memory_darwin.c net-snmp-5.9.1/agent/mibgroup/hardware/memory/memory_darwin.c
--- net-snmp-5.8/agent/mibgroup/hardware/memory/memory_darwin.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/memory/memory_darwin.c	2021-05-26 05:19:35.000000000 +0700
@@ -76,13 +76,22 @@ int pages_swapped(void) {
 
             swapped_pages = 0;
             for (address = 0;; address += size) {
+                kern_return_t ret = KERN_FAILURE;
+
                 /* Get memory region. */
                 count = VM_REGION_EXTENDED_INFO_COUNT; 
-#if defined(__ppc64__) || defined(__x86_64__)
-                if (vm_region_64(tasks[j], &address, &size, VM_REGION_EXTENDED_INFO, &info, &count, &object_name) != KERN_SUCCESS) {
+#if HAVE_VM_REGION_64
+                ret = vm_region_64(tasks[j], &address, &size,
+                                 VM_REGION_EXTENDED_INFO, (void *)&info, &count,
+                                 &object_name);
+#elif HAVE_VM_REGION
+                ret = vm_region(tasks[j], &address, &size,
+                              VM_REGION_EXTENDED_INFO, (void *)&info, &count,
+                              &object_name);
 #else
-                if (vm_region(tasks[j], &address, &size, VM_REGION_EXTENDED_INFO, &info, &count, &object_name) != KERN_SUCCESS) {
+#error How to query memory protection information?
 #endif
+                if (ret != KERN_SUCCESS) {
                     /* No more memory regions. */
                     break;
                 }
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/memory/memory_freebsd.c net-snmp-5.9.1/agent/mibgroup/hardware/memory/memory_freebsd.c
--- net-snmp-5.8/agent/mibgroup/hardware/memory/memory_freebsd.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/memory/memory_freebsd.c	2021-05-26 05:19:35.000000000 +0700
@@ -3,6 +3,7 @@
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 #include <net-snmp/agent/auto_nlist.h>
 #include <net-snmp/agent/hardware/memory.h>
+#include "../../../kernel.h"
 
 #include <unistd.h>
 #include <sys/param.h>
@@ -238,8 +239,6 @@ swapmode(long pagesize)
 
 #include <sys/conf.h>
 
-extern kvm_t *kd;
-
 static int
 swapmode(long pagesize)
 {
diff -urpN net-snmp-5.8/agent/mibgroup/hardware/memory/memory_linux.c net-snmp-5.9.1/agent/mibgroup/hardware/memory/memory_linux.c
--- net-snmp-5.8/agent/mibgroup/hardware/memory/memory_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/hardware/memory/memory_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -9,13 +9,9 @@
 /*
  * Try to use an initial size that will cover default cases. We aren't talking
  * about huge files, so why fiddle about with reallocs?
- * I checked /proc/meminfo sizes on 3 different systems: 598, 644, 654
- * 
- * On newer systems, the size is up to around 930 (2.6.27 kernel)
- *   or 1160  (2.6.28 kernel)
  */
-#define MEMINFO_INIT_SIZE   1279
-#define MEMINFO_STEP_SIZE   256
+#define MEMINFO_INIT_SIZE   4096
+#define MEMINFO_STEP_SIZE   4096
 #define MEMINFO_FILE   "/proc/meminfo"
 
     /*
@@ -28,8 +24,9 @@ int netsnmp_mem_arch_load( netsnmp_cache
     static int   first = 1;
     ssize_t      bytes_read;
     char        *b;
-    unsigned long memtotal = 0,  memfree = 0, memshared = 0,
-                  buffers = 0,   cached = 0,
+    int          have_memavail = 0;
+    unsigned long memtotal = 0,  memavail = 0, memfree = 0, memshared = 0,
+                  buffers = 0,   cached = 0, sreclaimable = 0,
                   swaptotal = 0, swapfree = 0;
 
     netsnmp_memory_info *mem;
@@ -85,6 +82,11 @@ int netsnmp_mem_arch_load( netsnmp_cache
         if (first)
             snmp_log(LOG_ERR, "No MemTotal line in /proc/meminfo\n");
     }
+    b = strstr(buff, "MemAvailable: ");
+    if (b) {
+        have_memavail = 1;
+        sscanf(b, "MemAvailable: %lu", &memavail);
+    }
     b = strstr(buff, "MemFree: ");
     if (b) 
         sscanf(b, "MemFree: %lu", &memfree);
@@ -134,6 +136,9 @@ int netsnmp_mem_arch_load( netsnmp_cache
         if (first)
             snmp_log(LOG_ERR, "No SwapFree line in /proc/meminfo\n");
     }
+    b = strstr(buff, "SReclaimable: ");
+    if (b)
+        sscanf(b, "SReclaimable: %lu", &sreclaimable);
     first = 0;
 
 
@@ -152,6 +157,18 @@ int netsnmp_mem_arch_load( netsnmp_cache
         mem->other = -1;
     }
 
+    if (have_memavail) {
+        mem = netsnmp_memory_get_byIdx(NETSNMP_MEM_TYPE_AVAILMEM, 1);
+        if (mem) {
+            if (!mem->descr)
+                mem->descr = strdup("Available memory");
+            mem->units = 1024;
+            mem->size  = memavail;
+            mem->free  = memavail;
+            mem->other = -1;
+        }
+    }
+
     mem = netsnmp_memory_get_byIdx( NETSNMP_MEM_TYPE_VIRTMEM, 1 );
     if (!mem) {
         snmp_log_perror("No Virtual Memory info entry");
@@ -183,7 +200,7 @@ int netsnmp_mem_arch_load( netsnmp_cache
         if (!mem->descr)
              mem->descr = strdup("Cached memory");
         mem->units = 1024;
-        mem->size  = cached;
+        mem->size  = cached + sreclaimable;
         mem->free  = 0;     /* Report cached size/used as equal */
         mem->other = -1;
     }
diff -urpN net-snmp-5.8/agent/mibgroup/header_complex.c net-snmp-5.9.1/agent/mibgroup/header_complex.c
--- net-snmp-5.8/agent/mibgroup/header_complex.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/header_complex.c	2021-05-26 05:19:35.000000000 +0700
@@ -20,10 +20,10 @@
 
 #include <net-snmp/net-snmp-features.h>
 
-netsnmp_feature_child_of(header_complex_all, libnetsnmpmibs)
+netsnmp_feature_child_of(header_complex_all, libnetsnmpmibs);
 
-netsnmp_feature_child_of(header_complex_free_all, header_complex_all)
-netsnmp_feature_child_of(header_complex_find_entry, header_complex_all)
+netsnmp_feature_child_of(header_complex_free_all, header_complex_all);
+netsnmp_feature_child_of(header_complex_find_entry, header_complex_all);
 
 int
 header_complex_generate_varoid(netsnmp_variable_list * var)
diff -urpN net-snmp-5.8/agent/mibgroup/host/data_access/swinst.c net-snmp-5.9.1/agent/mibgroup/host/data_access/swinst.c
--- net-snmp-5.8/agent/mibgroup/host/data_access/swinst.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/data_access/swinst.c	2021-05-26 05:19:35.000000000 +0700
@@ -16,9 +16,9 @@
 #include "swinst.h"
 #include "swinst_private.h"
 
-netsnmp_feature_child_of(software_installed, libnetsnmpmibs)
+netsnmp_feature_child_of(software_installed, libnetsnmpmibs);
 
-netsnmp_feature_child_of(swinst_entry_remove, netsnmp_unused)
+netsnmp_feature_child_of(swinst_entry_remove, netsnmp_unused);
 
 /* ---------------------------------------------------------------------
  */
diff -urpN net-snmp-5.8/agent/mibgroup/host/data_access/swinst_darwin.c net-snmp-5.9.1/agent/mibgroup/host/data_access/swinst_darwin.c
--- net-snmp-5.8/agent/mibgroup/host/data_access/swinst_darwin.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/data_access/swinst_darwin.c	2021-05-26 05:19:35.000000000 +0700
@@ -28,8 +28,8 @@
 #include <CoreFoundation/CoreFoundation.h>
 #include <ApplicationServices/ApplicationServices.h>
 
-netsnmp_feature_require(container_directory)
-netsnmp_feature_require(date_n_time)
+netsnmp_feature_require(container_directory);
+netsnmp_feature_require(date_n_time);
 
 /* ---------------------------------------------------------------------
  */
diff -urpN net-snmp-5.8/agent/mibgroup/host/data_access/swinst_pkginfo.c net-snmp-5.9.1/agent/mibgroup/host/data_access/swinst_pkginfo.c
--- net-snmp-5.8/agent/mibgroup/host/data_access/swinst_pkginfo.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/data_access/swinst_pkginfo.c	2021-05-26 05:19:35.000000000 +0700
@@ -44,7 +44,7 @@
 #include <net-snmp/data_access/swinst.h>
 #include "swinst_private.h"
 
-netsnmp_feature_require(date_n_time)
+netsnmp_feature_require(date_n_time);
 
    /*
     * Location of package directory.
@@ -182,14 +182,14 @@ netsnmp_swinst_arch_load( netsnmp_contai
             CONTAINER_INSERT(container, entry);
 
 #ifdef HAVE_PKGINFO
-	    v = pkgparam( dp->d_name, "VERSION" );
-	    c = pkgparam( dp->d_name, "CATEGORY" );
+	    v = pkgparam( dp->d_name, NETSNMP_REMOVE_CONST(char *, "VERSION") );
+	    c = pkgparam( dp->d_name, NETSNMP_REMOVE_CONST(char *, "CATEGORY") );
 
 	    entry->swName_len = snprintf( entry->swName, sizeof(entry->swName),
 					  "%s-%s", dp->d_name, v );
 	    if (entry->swName_len >= sizeof(entry->swName))
 		entry->swName_len = sizeof(entry->swName)-1;
-	    entry->swType = (NULL != strstr( c, "system"))
+	    entry->swType = (c && (NULL != strstr( c, "system")))
 			    ? 2      /* operatingSystem */
 			    : 4;     /*  application    */
 
diff -urpN net-snmp-5.8/agent/mibgroup/host/data_access/swinst_rpm.c net-snmp-5.9.1/agent/mibgroup/host/data_access/swinst_rpm.c
--- net-snmp-5.8/agent/mibgroup/host/data_access/swinst_rpm.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/data_access/swinst_rpm.c	2021-05-26 05:19:35.000000000 +0700
@@ -45,7 +45,7 @@
 #include <net-snmp/data_access/swinst.h>
 #include "swinst_private.h"
 
-netsnmp_feature_require(date_n_time)
+netsnmp_feature_require(date_n_time);
 
    /*
     * Location of RPM package directory.
diff -urpN net-snmp-5.8/agent/mibgroup/host/data_access/swrun.c net-snmp-5.9.1/agent/mibgroup/host/data_access/swrun.c
--- net-snmp-5.8/agent/mibgroup/host/data_access/swrun.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/data_access/swrun.c	2021-05-26 05:19:35.000000000 +0700
@@ -21,11 +21,11 @@
 #include <pcre.h>
 #endif
 
-netsnmp_feature_child_of(software_running, libnetsnmpmibs)
+netsnmp_feature_child_of(software_running, libnetsnmpmibs);
 
-netsnmp_feature_child_of(swrun_max_processes, software_running)
-netsnmp_feature_child_of(swrun_count_processes_by_name, software_running)
-netsnmp_feature_child_of(swrun_count_processes_by_regex, software_running)
+netsnmp_feature_child_of(swrun_max_processes, software_running);
+netsnmp_feature_child_of(swrun_count_processes_by_name, software_running);
+netsnmp_feature_child_of(swrun_count_processes_by_regex, software_running);
 
 /**---------------------------------------------------------------------*/
 /*
@@ -102,7 +102,7 @@ swrun_max_processes( void )
 #ifndef NETSNMP_FEATURE_REMOVE_SWRUN_COUNT_PROCESSES_BY_REGEX
 #if HAVE_PCRE_H
 int
-swrun_count_processes_by_regex( char *name, struct real_pcre *regexp )
+swrun_count_processes_by_regex( char *name, netsnmp_regex_ptr regexp )
 {
     netsnmp_swrun_entry *entry;
     netsnmp_iterator  *it;
@@ -112,14 +112,14 @@ swrun_count_processes_by_regex( char *na
     char fullCommand[64 + 128 + 128 + 3];
 
     netsnmp_cache_check_and_reload(swrun_cache);
-    if ( !swrun_container || !name || !regexp )
+    if ( !swrun_container || !name || !regexp.regex_ptr )
         return 0;    /* or -1 */
 
     it = CONTAINER_ITERATOR( swrun_container );
     while ((entry = (netsnmp_swrun_entry*)ITERATOR_NEXT( it )) != NULL) {
         /* need to assemble full command back so regexps can get full picture */
         sprintf(fullCommand, "%s %s", entry->hrSWRunPath, entry->hrSWRunParameters);
-        found = pcre_exec(regexp, NULL, fullCommand, strlen(fullCommand), 0, 0, found_ndx, 30);
+        found = pcre_exec(regexp.regex_ptr, NULL, fullCommand, strlen(fullCommand), 0, 0, found_ndx, 30);
         if (found > 0) {
             i++;
         }
diff -urpN net-snmp-5.8/agent/mibgroup/host/data_access/swrun_kinfo.c net-snmp-5.9.1/agent/mibgroup/host/data_access/swrun_kinfo.c
--- net-snmp-5.8/agent/mibgroup/host/data_access/swrun_kinfo.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/data_access/swrun_kinfo.c	2021-05-26 05:19:35.000000000 +0700
@@ -48,9 +48,7 @@
 #include <net-snmp/library/snmp_debug.h>
 #include <net-snmp/data_access/swrun.h>
 #include "swrun_private.h"
-
-extern kvm_t *kd;
-
+#include "../../../kernel.h"
 
 #if defined(freebsd5) && __FreeBSD_version >= 500014
     /*
@@ -189,8 +187,10 @@ netsnmp_arch_swrun_container_load( netsn
     proc_table = kvm_getprocs(kd, KERN_PROC_KTHREAD, 0, sizeof(struct kinfo_proc), &nprocs );
 #elif defined(HAVE_KVM_GETPROC2)
     proc_table = kvm_getproc2(kd, KERN_PROC_ALL, 0, sizeof(struct kinfo_proc2), &nprocs );
+#elif defined(KERN_PROC_PROC)
+    proc_table = kvm_getprocs(kd, KERN_PROC_PROC, 0, &nprocs);
 #else
-    proc_table = kvm_getprocs(kd, KERN_PROC_ALL, 0, &nprocs );
+    proc_table = kvm_getprocs(kd, KERN_PROC_ALL, 0, &nprocs);
 #endif
     for ( i=0 ; i<nprocs; i++ ) {
         if ( 0 == proc_table[i].SWRUN_K_STAT )
@@ -205,6 +205,10 @@ netsnmp_arch_swrun_container_load( netsn
         if (NULL == entry)
             continue;   /* error already logged by function */
         rc = CONTAINER_INSERT(container, entry);
+        if (rc < 0) {
+            netsnmp_swrun_entry_free(entry);
+            continue;
+        }
 
         /*
          * There are two possible sources for the command being run:
@@ -287,7 +291,9 @@ netsnmp_arch_swrun_container_load( netsn
 	case LSSUSPENDED:
         case LSSTOP:  entry->hrSWRunStatus = HRSWRUNSTATUS_NOTRUNNABLE;
                       break;
+#ifdef LSDEAD
 	case LSDEAD:
+#endif
         case LSZOMB:  entry->hrSWRunStatus = HRSWRUNSTATUS_INVALID;
 		      break;
         default:   
diff -urpN net-snmp-5.8/agent/mibgroup/host/data_access/swrun_null.c net-snmp-5.9.1/agent/mibgroup/host/data_access/swrun_null.c
--- net-snmp-5.8/agent/mibgroup/host/data_access/swrun_null.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/data_access/swrun_null.c	2021-05-26 05:19:35.000000000 +0700
@@ -38,7 +38,7 @@ int
 netsnmp_arch_swrun_container_load( netsnmp_container *container, u_int flags)
 {
     /* Nothing to do */
-    DEBUGMSGTL(("swrun:load:arch"," loaded %d entries\n",
+    DEBUGMSGTL(("swrun:load:arch"," loaded %" NETSNMP_PRIz "u entries\n",
                 CONTAINER_SIZE(container)));
 
     return 0;
diff -urpN net-snmp-5.8/agent/mibgroup/host/data_access/swrun_procfs_psinfo.c net-snmp-5.9.1/agent/mibgroup/host/data_access/swrun_procfs_psinfo.c
--- net-snmp-5.8/agent/mibgroup/host/data_access/swrun_procfs_psinfo.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/data_access/swrun_procfs_psinfo.c	2021-05-26 05:19:35.000000000 +0700
@@ -56,7 +56,7 @@ netsnmp_arch_swrun_container_load( netsn
     DIR                 *procdir = NULL;
     struct dirent       *procentry_p;
     psinfo_t             psinfo;
-    int                  pid, rc, fd;
+    int                  pid, fd;
     char                *cp, buf[512];
     netsnmp_swrun_entry *entry;
 
@@ -77,7 +77,7 @@ netsnmp_arch_swrun_container_load( netsn
         entry = netsnmp_swrun_entry_create(pid);
         if (NULL == entry)
             continue;   /* error already logged by function */
-        rc = CONTAINER_INSERT(container, entry);
+        CONTAINER_INSERT(container, entry);
 
         /*
          * Now extract the interesting information
diff -urpN net-snmp-5.8/agent/mibgroup/host/data_access/swrun_procfs_status.c net-snmp-5.9.1/agent/mibgroup/host/data_access/swrun_procfs_status.c
--- net-snmp-5.8/agent/mibgroup/host/data_access/swrun_procfs_status.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/data_access/swrun_procfs_status.c	2021-05-26 05:19:35.000000000 +0700
@@ -56,7 +56,7 @@ netsnmp_arch_swrun_container_load( netsn
     DIR                 *procdir = NULL;
     struct dirent       *procentry_p;
     FILE                *fp;
-    int                  pid, i;
+    int                  pid, i, ret;
     unsigned long long   cpu;
     char                 buf[BUFSIZ], buf2[BUFSIZ], *cp, *cp1;
     netsnmp_swrun_entry *entry;
@@ -129,24 +129,26 @@ netsnmp_arch_swrun_container_load( netsn
         if (cp != NULL) {
             /*
              *     argv[0]   is hrSWRunPath
-             */ 
-            entry->hrSWRunPath_len = snprintf(entry->hrSWRunPath,
-                                       sizeof(entry->hrSWRunPath)-1, "%s", buf);
+             */
+            ret = snprintf(entry->hrSWRunPath, sizeof(entry->hrSWRunPath),
+                           "%s", buf);
+
+            if (ret < sizeof(entry->hrSWRunPath))
+                entry->hrSWRunPath_len = ret;
+            else
+                entry->hrSWRunPath_len = sizeof(entry->hrSWRunPath) - 1;
+
             /*
              * Stitch together argv[1..] to construct hrSWRunParameters
              */
-            cp = buf + entry->hrSWRunPath_len+1;
-            while ( 1 ) {
-                while (*cp)
-                    cp++;
-                if ( '\0' == *(cp+1))
-                    break;      /* '\0''\0' => End of command line */
-                *cp = ' ';
-            }
+            for (cp = buf + ret; ! (*cp == '\0' && *(cp + 1) == '\0'); cp++)
+                    if (*cp == '\0')
+                            *cp = ' ';
+
             entry->hrSWRunParameters_len
                 = sprintf(entry->hrSWRunParameters, "%.*s",
                           (int)sizeof(entry->hrSWRunParameters) - 1,
-                          buf + entry->hrSWRunPath_len + 1);
+                          buf + ret + 1);
         } else {
             /* empty /proc/PID/cmdline, it's probably a kernel thread */
             entry->hrSWRunPath_len = 0;
diff -urpN net-snmp-5.8/agent/mibgroup/host/hr_disk.c net-snmp-5.9.1/agent/mibgroup/host/hr_disk.c
--- net-snmp-5.8/agent/mibgroup/host/hr_disk.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/hr_disk.c	2021-05-26 05:19:35.000000000 +0700
@@ -59,6 +59,9 @@
 #if HAVE_SYS_DISKLABEL_H
 #define DKTYPENAMES
 #include <sys/disklabel.h>
+#ifndef dragonfly
+#include <sys/disk.h>
+#endif
 #endif
 #if TIME_WITH_SYS_TIME
 # include <sys/time.h>
@@ -78,6 +81,9 @@
 #if HAVE_LIMITS_H
 #include <limits.h>
 #endif
+#ifdef HAVE_UNISTD_H
+#include <unistd.h>
+#endif
 
 #ifdef darwin
 #include <CoreFoundation/CoreFoundation.h>
@@ -173,7 +179,7 @@ static int      HRD_savedCtrl_type;
 static struct hd_driveid HRD_info;
 #endif
 
-#ifdef DIOCGDINFO
+#if defined(DIOCGDINFO) || defined(DIOCGMEDIASIZE)
 static struct disklabel HRD_info;
 #endif
 
@@ -268,6 +274,9 @@ init_hr_disk(void)
 #elif defined(freebsd2)
     Add_HR_Disk_entry("/dev/wd%d%c", -1, -1, 0, 3, "/dev/wd%d", 'a', 'h');
     Add_HR_Disk_entry("/dev/sd%d%c", -1, -1, 0, 3, "/dev/sd%d", 'a', 'h');
+#elif defined(netbsd6)
+    Add_HR_Disk_entry("/dev/wd%d%c", -1, -1, 0, 3, "/dev/rwd%da", 'a', 'h');
+    Add_HR_Disk_entry("/dev/sd%d%c", -1, -1, 0, 3, "/dev/rsd%da", 'a', 'h');
 #elif defined(netbsd1)
     Add_HR_Disk_entry("/dev/wd%d%c", -1, -1, 0, 3, "/dev/wd%dc", 'a', 'h');
     Add_HR_Disk_entry("/dev/sd%d%c", -1, -1, 0, 3, "/dev/sd%dc", 'a', 'h');
@@ -1050,7 +1059,14 @@ Query_Disk(int fd, const char *devfull)
     }
 #endif
 
-#ifdef DIOCGDINFO
+#if defined(DIOCGMEDIASIZE)
+    unsigned long long size64;
+
+    if (ioctl(fd, DIOCGMEDIASIZE, &size64) < 0)
+	result = -1;
+    HRD_info.d_secperunit = size64 / 512;
+    result = 0;
+#elif defined(DIOCGDINFO)
     result = ioctl(fd, DIOCGDINFO, &HRD_info);
 #endif
 
diff -urpN net-snmp-5.8/agent/mibgroup/host/hr_filesys.c net-snmp-5.9.1/agent/mibgroup/host/hr_filesys.c
--- net-snmp-5.8/agent/mibgroup/host/hr_filesys.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/hr_filesys.c	2021-05-26 05:19:35.000000000 +0700
@@ -64,9 +64,13 @@
 #include <sys/statfs.h>
 #endif
 
-netsnmp_feature_require(se_find_free_value_in_slist)
-netsnmp_feature_require(date_n_time)
-netsnmp_feature_require(ctime_to_timet)
+netsnmp_feature_require(se_find_free_value_in_slist);
+netsnmp_feature_require(date_n_time);
+netsnmp_feature_require(ctime_to_timet);
+
+#ifndef MNTTYPE_AUTOFS
+#define MNTTYPE_AUTOFS	"autofs"
+#endif
 
 #if defined(bsdi4) || defined(freebsd3) || defined(freebsd4) || defined(freebsd5) || defined(darwin)
 #if HAVE_GETFSSTAT && defined(MFSNAMELEN)
@@ -618,7 +622,7 @@ Init_HR_FileSys(void)
 #if defined(HAVE_STATVFS) && defined(__NetBSD__)
     fscount = getvfsstat(NULL, 0, ST_NOWAIT);
 #else
-    fscount = getfsstat(NULL, 0, MNT_NOWAIT);
+    fscount = getfsstat(NULL, 0, MNT_WAIT);
 #endif
     if (fsstats)
         free((char *) fsstats);
@@ -627,7 +631,7 @@ Init_HR_FileSys(void)
 #if defined(HAVE_STATVFS) && defined(__NetBSD__)
     getvfsstat(fsstats, fscount * sizeof(*fsstats), ST_NOWAIT);
 #else
-    getfsstat(fsstats, fscount * sizeof(*fsstats), MNT_NOWAIT);
+    getfsstat(fsstats, fscount * sizeof(*fsstats), MNT_WAIT);
 #endif
     HRFS_index = 0;
 #elif defined(aix4) || defined(aix5) || defined(aix6) || defined(aix7)
@@ -664,7 +668,7 @@ Init_HR_FileSys(void)
 #endif
 }
 
-const char     *HRFS_ignores[] = {
+static const char *HRFS_ignores[] = {
 #ifdef MNTTYPE_IGNORE
     MNTTYPE_IGNORE,
 #endif
@@ -677,13 +681,8 @@ const char     *HRFS_ignores[] = {
 #ifdef MNTTYPE_PROCFS
     MNTTYPE_PROCFS,
 #endif
-#ifdef MNTTYPE_AUTOFS
     MNTTYPE_AUTOFS,
-#else
-    "autofs",
-#endif
 #ifdef linux
-    "autofs",
     "bdev",
     "binfmt_misc",
     "cpuset",
@@ -705,7 +704,6 @@ const char     *HRFS_ignores[] = {
     "shm",
     "sockfs",
     "sysfs",
-    "tmpfs",
     "usbdevfs",
     "usbfs",
 #endif
@@ -720,6 +718,7 @@ const char     *HRFS_ignores[] = {
 int
 Get_Next_HR_FileSys(void)
 {
+next:
 #if HAVE_GETFSSTAT
     if (HRFS_index >= fscount)
         return -1;
@@ -746,8 +745,7 @@ Get_Next_HR_FileSys(void)
         case MNT_PROCFS:
 #endif
         case MNT_SFS:
-            return Get_Next_HR_FileSys();
-            break;
+            goto next;
     }
     return HRFS_index++;
 #else
@@ -767,7 +765,7 @@ Get_Next_HR_FileSys(void)
 
     for (cpp = HRFS_ignores; *cpp != NULL; ++cpp)
         if (!strcmp(HRFS_entry->HRFS_type, *cpp))
-            return Get_Next_HR_FileSys();
+            goto next;
 
     /*
      * Try and ensure that index values are persistent
@@ -834,6 +832,17 @@ Check_HR_FileSys_NFS (void)
     return 0;		/* no NFS file system */
 }
 
+/* This function checks whether current file system is an AutoFs
+ * HRFS_entry must be valid prior to calling this function
+ * return 1 if AutoFs, 0 otherwise
+ */
+int
+Check_HR_FileSys_AutoFs(void)
+{
+    return HRFS_entry->HRFS_type &&
+        strcmp(HRFS_entry->HRFS_type, MNTTYPE_AUTOFS) == 0;
+}
+
 void
 End_HR_FileSys(void)
 {
diff -urpN net-snmp-5.8/agent/mibgroup/host/hr_filesys.h net-snmp-5.9.1/agent/mibgroup/host/hr_filesys.h
--- net-snmp-5.8/agent/mibgroup/host/hr_filesys.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/hr_filesys.h	2021-05-26 05:19:35.000000000 +0700
@@ -10,6 +10,7 @@ extern void     Init_HR_FileSys(void);
 extern FindVarMethod var_hrfilesys;
 extern int      Get_Next_HR_FileSys(void);
 extern int      Check_HR_FileSys_NFS(void);
+extern int      Check_HR_FileSys_AutoFs(void);
 
 extern int      Get_FSIndex(char *);
 extern long     Get_FSSize(char *);     /* Temporary */
diff -urpN net-snmp-5.8/agent/mibgroup/host/hr_network.c net-snmp-5.9.1/agent/mibgroup/host/hr_network.c
--- net-snmp-5.8/agent/mibgroup/host/hr_network.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/hr_network.c	2021-05-26 05:19:35.000000000 +0700
@@ -24,7 +24,7 @@
 #include "hr_network.h"
 
 #if !defined( solaris2 )
-netsnmp_feature_require(interface_legacy)
+netsnmp_feature_require(interface_legacy);
 #endif /* !solaris2 */
 
         /*********************
@@ -299,8 +299,10 @@ network_status(int idx)
         return 2;               /* running */
     else
         return 5;               /* down */
+#else
+    /* To do: implement network_status() for Windows. */
+    return 2;                   /* running */
 #endif /* WIN32 */
-
 }
 
 int
diff -urpN net-snmp-5.8/agent/mibgroup/host/hr_storage.c net-snmp-5.9.1/agent/mibgroup/host/hr_storage.c
--- net-snmp-5.8/agent/mibgroup/host/hr_storage.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/hr_storage.c	2021-05-26 05:19:35.000000000 +0700
@@ -544,6 +544,8 @@ really_try_next:
                                         NETSNMP_DS_AGENT_SKIPNFSINHOSTRESOURCES) &&
                  Check_HR_FileSys_NFS())
                 return NULL;  /* or goto try_next; */
+            if (Check_HR_FileSys_AutoFs())
+                return NULL;
 	    if (HRFS_statfs(HRFS_entry->HRFS_mount, &stat_buf) < 0) {
 		snmp_log_perror(HRFS_entry->HRFS_mount);
 		goto try_next;
@@ -683,7 +685,8 @@ Get_Next_HR_Store(void)
 		if (HRS_index >= 0) {
 			if (!(netsnmp_ds_get_boolean(NETSNMP_DS_APPLICATION_ID, 
 							NETSNMP_DS_AGENT_SKIPNFSINHOSTRESOURCES) && 
-						Check_HR_FileSys_NFS())) {
+						Check_HR_FileSys_NFS()) &&
+                            !Check_HR_FileSys_AutoFs()) {
 				return HRS_index + NETSNMP_MEM_TYPE_MAX;	
 			}
 		} else {
diff -urpN net-snmp-5.8/agent/mibgroup/host/hr_swinst.c net-snmp-5.9.1/agent/mibgroup/host/hr_swinst.c
--- net-snmp-5.8/agent/mibgroup/host/hr_swinst.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/hr_swinst.c	2021-05-26 05:19:35.000000000 +0700
@@ -72,7 +72,7 @@
 
 #define HRSWINST_MONOTONICALLY_INCREASING
 
-netsnmp_feature_require(date_n_time)
+netsnmp_feature_require(date_n_time);
 
         /*********************
 	 *
diff -urpN net-snmp-5.8/agent/mibgroup/host/hr_system.c net-snmp-5.9.1/agent/mibgroup/host/hr_system.c
--- net-snmp-5.8/agent/mibgroup/host/hr_system.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/hr_system.c	2021-05-26 05:19:35.000000000 +0700
@@ -45,7 +45,7 @@
 #include <signal.h>
 #include <errno.h>
 
-#ifdef WIN32
+#if HAVE_LM_H
 #include <lm.h>
 #endif
 
@@ -79,7 +79,7 @@
 #include <sys/sysctl.h>
 #endif
 
-netsnmp_feature_require(date_n_time)
+netsnmp_feature_require(date_n_time);
 
 #if !defined(UTMP_FILE) && defined(_PATH_UTMP)
 #define UTMP_FILE _PATH_UTMP
@@ -303,7 +303,7 @@ var_hrsys(struct variable * vp,
     case HRSYS_LOAD_PARAM:
 #ifdef linux
         if((fp = fopen("/proc/cmdline", "r")) != NULL) {
-            fgets(string, sizeof(string), fp);
+            NETSNMP_IGNORE_RESULT(fgets(string, sizeof(string), fp));
             fclose(fp);
         } else {
             return NULL;
@@ -433,7 +433,7 @@ set_solaris_bootcommand_parameter(int ac
         case RESERVE2: {
             /* create copy of old value */
             if(statP) {
-                int old_val_len=strlen(statP);
+                int old_val_len = strlen((const char *)statP);
                 if(old_val_len >= sizeof(old_value)) {
                     p_old_value=(char *)malloc(old_val_len+1);
                     if(p_old_value==NULL) {
@@ -441,7 +441,7 @@ set_solaris_bootcommand_parameter(int ac
                         return SNMP_ERR_GENERR;
                     } 
                 }
-                strlcpy(p_old_value,statP,old_val_len+1);
+                strlcpy(p_old_value, (const char *)statP, old_val_len+1);
             } else { 
                 p_old_value=NULL;
             }
@@ -537,16 +537,16 @@ static long get_max_solaris_processes(vo
     static long maxprocs=-1;
 
     /* assume only necessary to compute once, since /etc/system must be modified */
-    if (maxprocs == -1) {
-        if ( (ksc=kstat_open()) != NULL && 
-             (ks=kstat_lookup(ksc, "unix", 0, "var")) != NULL && 
-             (kstat_read(ksc, ks, &v) != -1)) {
+    if (maxprocs >= 0)
+        return maxprocs;
 
-            maxprocs=v.v_proc;
-        }
-        if(ksc) {
-            kstat_close(ksc);
-        }
+    ksc = kstat_open();
+    if (ksc) {
+        ks = kstat_lookup(ksc, NETSNMP_REMOVE_CONST(char *, "unix"), 0,
+                          NETSNMP_REMOVE_CONST(char *, "var"));
+        if (ks && kstat_read(ksc, ks, &v) != -1)
+            maxprocs = v.v_proc;
+        kstat_close(ksc);
     }
 
     return maxprocs;
@@ -607,7 +607,8 @@ ns_set_time(int action,
             newtimetm.tm_mday=(int)var_val[3];
 
             /* determine if day light savings time in effect DST */
-            if ( ( hours_from_utc*60*60+minutes_from_utc*60 ) == abs(timezone) ) {
+            if (hours_from_utc*60*60+minutes_from_utc*60 ==
+                (timezone >= 0 ? timezone : -timezone)) {
                 newtimetm.tm_isdst=0;
             } else {
                 newtimetm.tm_isdst=1;
diff -urpN net-snmp-5.8/agent/mibgroup/host/hrh_filesys.c net-snmp-5.9.1/agent/mibgroup/host/hrh_filesys.c
--- net-snmp-5.8/agent/mibgroup/host/hrh_filesys.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/hrh_filesys.c	2021-05-26 05:19:35.000000000 +0700
@@ -62,8 +62,8 @@
 #include <sys/statfs.h>
 #endif
 
-netsnmp_feature_require(date_n_time)
-netsnmp_feature_require(ctime_to_timet)
+netsnmp_feature_require(date_n_time);
+netsnmp_feature_require(ctime_to_timet);
 
 #define HRFS_MONOTONICALLY_INCREASING
 
@@ -219,6 +219,7 @@ var_hrhfilesys(struct variable *vp,
 {
     int             fsys_idx;
     static char    *string;
+    static char     empty_str[1];
 
     fsys_idx =
         header_hrhfilesys(vp, name, length, exact, var_len, write_method);
@@ -235,7 +236,7 @@ var_hrhfilesys(struct variable *vp,
         *var_len = 0;
         if (asprintf(&string, "%s", HRFS_entry->path) >= 0)
             *var_len = strlen(string);
-        return (u_char *) string;
+        return (u_char *)(string ? string : empty_str);
     case HRFSYS_RMOUNT:
         free(string);
         if (HRFS_entry->flags & NETSNMP_FS_FLAG_REMOTE) {
@@ -245,7 +246,7 @@ var_hrhfilesys(struct variable *vp,
             string = strdup("");
         }
         *var_len = string ? strlen(string) : 0;
-        return (u_char *) string;
+        return (u_char *)(string ? string : empty_str);
 
     case HRFSYS_TYPE:
         fsys_type_id[fsys_type_len - 1] = 
@@ -429,3 +430,9 @@ Check_HR_FileSys_NFS (void)
 {
     return (HRFS_entry->flags & NETSNMP_FS_FLAG_REMOTE) ? 1 : 0;
 }
+
+int
+Check_HR_FileSys_AutoFs (void)
+{
+    return HRFS_entry->type == NETSNMP_FS_TYPE_AUTOFS;
+}
diff -urpN net-snmp-5.8/agent/mibgroup/host/hrh_filesys.h net-snmp-5.9.1/agent/mibgroup/host/hrh_filesys.h
--- net-snmp-5.8/agent/mibgroup/host/hrh_filesys.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/hrh_filesys.h	2021-05-26 05:19:35.000000000 +0700
@@ -10,6 +10,7 @@ extern void     Init_HR_FileSys(void);
 extern FindVarMethod var_hrhfilesys;
 extern int      Get_Next_HR_FileSys(void);
 extern int      Check_HR_FileSys_NFS(void);
+extern int	Check_HR_FileSys_AutoFs(void);
 
 extern int      Get_FSIndex(char *);
 extern long     Get_FSSize(char *);     /* Temporary */
diff -urpN net-snmp-5.8/agent/mibgroup/host/hrh_storage.c net-snmp-5.9.1/agent/mibgroup/host/hrh_storage.c
--- net-snmp-5.8/agent/mibgroup/host/hrh_storage.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/host/hrh_storage.c	2021-05-26 05:19:35.000000000 +0700
@@ -27,7 +27,6 @@
 # ifdef WIN32
 #  include <windows.h>
 #  include <errno.h>
-#  include <sys/timeb.h>
 # else
 #  include <sys/time.h>
 # endif
@@ -371,6 +370,8 @@ really_try_next:
                                    NETSNMP_DS_AGENT_SKIPNFSINHOSTRESOURCES) &&
             Check_HR_FileSys_NFS())
             return NULL;
+        if (HRFS_entry && Check_HR_FileSys_AutoFs())
+            return NULL;
         if (store_idx <= NETSNMP_MEM_TYPE_MAX ) {
 	    mem = (netsnmp_memory_info*)ptr;
         }
@@ -508,7 +509,8 @@ Get_Next_HR_Store(void)
 		if (HRS_index >= 0) {
 			if (!(netsnmp_ds_get_boolean(NETSNMP_DS_APPLICATION_ID, 
 							NETSNMP_DS_AGENT_SKIPNFSINHOSTRESOURCES) && 
-						Check_HR_FileSys_NFS())) {
+						Check_HR_FileSys_NFS()) &&
+                         !Check_HR_FileSys_AutoFs()) {
 				return HRS_index + NETSNMP_MEM_TYPE_MAX;	
 			}
 		} else {
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface.c net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface.c
--- net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -6,6 +6,7 @@
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-features.h>
 #include <net-snmp/net-snmp-includes.h>
+#include <errno.h>
 
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 #include <net-snmp/library/snmp_enum.h>
@@ -15,14 +16,20 @@
 #include "if-mib/ifTable/ifTable.h"
 #include "if-mib/data_access/interface.h"
 #include "interface_private.h"
+#if HAVE_PCRE_H
+#include <pcre.h>
+#elif HAVE_REGEX_H
+#include <sys/types.h>
+#include <regex.h>
+#endif
 
-netsnmp_feature_child_of(interface_all, libnetsnmpmibs)
-netsnmp_feature_child_of(interface, interface_all)
-netsnmp_feature_child_of(interface_access_entry_set_admin_status, interface_all)
-netsnmp_feature_child_of(interface_legacy, interface_all)
+netsnmp_feature_child_of(interface_all, libnetsnmpmibs);
+netsnmp_feature_child_of(interface, interface_all);
+netsnmp_feature_child_of(interface_access_entry_set_admin_status, interface_all);
+netsnmp_feature_child_of(interface_legacy, interface_all);
 
 #ifdef NETSNMP_FEATURE_REQUIRE_INTERFACE_ACCESS_ENTRY_SET_ADMIN_STATUS
-netsnmp_feature_require(interface_arch_set_admin_status)
+netsnmp_feature_require(interface_arch_set_admin_status);
 #endif /* NETSNMP_FEATURE_REQUIRE_INTERFACE_ACCESS_ENTRY_SET_ADMIN_STATUS */
 
 /**---------------------------------------------------------------------*/
@@ -32,20 +39,33 @@ netsnmp_feature_require(interface_arch_s
 static netsnmp_conf_if_list *conf_list = NULL;
 static int need_wrap_check = -1;
 static int _access_interface_init = 0;
+static netsnmp_include_if_list *include_list;
+static int ifmib_max_num_ifaces = 0;
 
 /*
  * local static prototypes
  */
 static int _access_interface_entry_compare_name(const void *lhs,
                                                 const void *rhs);
-#ifndef NETSNMP_ACCESS_INTERFACE_NOARCH
 static void _access_interface_entry_release(netsnmp_interface_entry * entry,
                                             void *unused);
-#endif
 static void _access_interface_entry_save_name(const char *name, oid index);
 static void _parse_interface_config(const char *token, char *cptr);
+static void _parse_ifmib_max_num_ifaces(const char *token, char *cptr);
 static void _free_interface_config(void);
+static void _parse_include_if_config(const char *token, char *cptr);
+static void _free_include_if_config(void);
 
+/*
+ * This function is called after the snmpd configuration has been read
+ * and loads the interface list if it has not yet been loaded.
+ */
+static int
+_load_if_list(int majorID, int minorID, void *serverargs, void *clientarg)
+{
+    netsnmp_access_interface_init();
+    return 0;
+}
 
 /**
  * initialization
@@ -56,20 +76,31 @@ init_interface(void)
     snmpd_register_config_handler("interface", _parse_interface_config,
                                   _free_interface_config,
                                   "name type speed");
-}
 
+    snmpd_register_config_handler("ifmib_max_num_ifaces",
+                                  _parse_ifmib_max_num_ifaces,
+                                  NULL,
+                                  "IF-MIB MAX Number of ifaces");
+
+    snmpd_register_config_handler("include_ifmib_iface_prefix",
+                                  _parse_include_if_config,
+                                  _free_include_if_config,
+                                  "IF-MIB iface names included");
+
+    snmp_register_callback(SNMP_CALLBACK_LIBRARY,
+                           SNMP_CALLBACK_POST_READ_CONFIG,
+                           _load_if_list, NULL);
+}
 
+/* May be called multiple times. */
 void
 netsnmp_access_interface_init(void)
 {
-    netsnmp_assert(0 == _access_interface_init); /* who is calling twice? */
-
     if (1 == _access_interface_init)
         return;
 
     _access_interface_init = 1;
 
-#ifndef NETSNMP_ACCESS_INTERFACE_NOARCH
     {
         netsnmp_container * ifcontainer;
 
@@ -82,7 +113,6 @@ netsnmp_access_interface_init(void)
         if(NULL != ifcontainer)
             netsnmp_access_interface_container_free(ifcontainer, 0);
     }
-#endif
 }
 
 /**---------------------------------------------------------------------*/
@@ -133,7 +163,6 @@ netsnmp_access_interface_container_init(
  * @retval NULL  error
  * @retval !NULL pointer to container
  */
-#ifndef NETSNMP_ACCESS_INTERFACE_NOARCH
 netsnmp_container*
 netsnmp_access_interface_container_load(netsnmp_container* container, u_int load_flags)
 {
@@ -192,7 +221,6 @@ netsnmp_access_interface_index_find(cons
 
     return netsnmp_arch_interface_index_find(name);
 }
-#endif
 
 /**---------------------------------------------------------------------*/
 /*
@@ -279,11 +307,9 @@ netsnmp_access_interface_entry_create(co
     /*
      * get if index, and save name for reverse lookup
      */
-#ifndef NETSNMP_ACCESS_INTERFACE_NOARCH
     if (0 == if_index)
         entry->index = netsnmp_access_interface_index_find(name);
     else
-#endif
         entry->index = if_index;
     _access_interface_entry_save_name(name, entry->index);
 
@@ -417,7 +443,6 @@ Interface_Scan_NextInt(int *index, char
  * @retval 0   : success
  * @retval < 0 : error
  */
-#ifndef NETSNMP_ACCESS_INTERFACE_NOARCH
 int
 netsnmp_access_interface_entry_set_admin_status(netsnmp_interface_entry * entry,
                                                 int ifAdminStatus)
@@ -439,7 +464,6 @@ netsnmp_access_interface_entry_set_admin
 
     return rc;
 }
-#endif
 #endif /* NETSNMP_FEATURE_REMOVE_INTERFACE_ACCESS_ENTRY_SET_ADMIN_STATUS */
 
 /**---------------------------------------------------------------------*/
@@ -456,7 +480,6 @@ _access_interface_entry_compare_name(con
                   ((const netsnmp_interface_entry *) rhs)->name);
 }
 
-#ifndef NETSNMP_ACCESS_INTERFACE_NOARCH
 /**
  */
 static void
@@ -464,7 +487,6 @@ _access_interface_entry_release(netsnmp_
 {
     netsnmp_access_interface_entry_free(entry);
 }
-#endif
 
 /**
  */
@@ -782,6 +804,74 @@ netsnmp_access_interface_entry_overrides
     }
 }
 
+/*
+ * ifmib_max_num_ifaces config token
+ *
+ * Users may configure a maximum number if interfaces for
+ * the IF-MIB to include. This is useful in case there are
+ * a large number of interfaces (bridges, bonds, SVIs) that
+ * can slow things down.
+ */
+int netsnmp_access_interface_max_reached(const char *name)
+{
+    if (!name)
+        return FALSE;
+
+    if (ifmib_max_num_ifaces == 0)
+        /* nothing was set as a max so we include it all */
+        return FALSE;
+
+    if (netsnmp_arch_interface_index_find(name) > ifmib_max_num_ifaces)
+        /* We have gone over the max configured iface count */
+        return TRUE;
+
+    return FALSE;
+}
+
+/*
+ * include_ifmib_iface_prefix config token
+ *
+ * If and only if there is an iface prefix name match, we return TRUE.
+ * If there are no ifaces defined at all, return 1 so that the
+ * default behavior is to include all ifaces (include everything).
+ * (Note: including at least one iface prefix means we will only include
+ * those iface names that match the prefix and exclude all others.)
+ */
+int netsnmp_access_interface_include(const char *name)
+{
+    netsnmp_include_if_list *if_ptr;
+#if HAVE_PCRE_H
+    int                      found_ndx[3];
+#endif
+
+    if (!name)
+        return TRUE;
+
+    if (!include_list)
+        /*
+         * If include_ifmib_iface_prefix was not configured, we should include
+         * all interfaces (which is the default).
+         */
+        return TRUE;
+
+
+    for (if_ptr = include_list; if_ptr; if_ptr = if_ptr->next) {
+#if HAVE_PCRE_H
+        if (pcre_exec(if_ptr->regex_ptr, NULL, name, strlen(name), 0, 0,
+                      found_ndx, 3) >= 0)
+            return TRUE;
+#elif HAVE_REGEX_H
+        if (regexec(if_ptr->regex_ptr, name, 0, NULL, 0) == 0)
+            return TRUE;
+#else
+        if (strncmp(name, if_ptr->name, strlen(if_ptr->name)) == 0)
+            return TRUE;
+#endif
+    }
+
+    return FALSE;
+}
+
 /**---------------------------------------------------------------------*/
 /*
  * interface config token
@@ -857,3 +947,131 @@ _free_interface_config(void)
     }
     conf_list = NULL;
 }
+
+/*
+ * Maximum number of interfaces to include in IF-MIB
+ */
+static void
+_parse_ifmib_max_num_ifaces(const char *token, char *cptr)
+{
+    int temp_max;
+    char *name, *st;
+
+    errno = 0;
+    name = strtok_r(cptr, " \t", &st);
+    if (!name) {
+        config_perror("Missing NUMBER parameter");
+        return;
+    }
+    if (sscanf(cptr, "%d", &temp_max) != 1) {
+        config_perror("Error converting parameter");
+        return;
+    }
+
+    ifmib_max_num_ifaces = temp_max;
+}
+
+
+/*
+ * include interface config token
+ */
+static void
+_parse_include_if_config(const char *token, char *cptr)
+{
+    netsnmp_include_if_list *if_ptr, *if_new;
+    char                    *name, *st;
+#if HAVE_PCRE_H
+    const char              *pcre_error;
+    int                     pcre_error_offset;
+#elif HAVE_REGEX_H
+    int                     r = 0;
+#endif
+
+    name = strtok_r(cptr, " \t", &st);
+    if (!name) {
+        config_perror("Missing NAME parameter");
+        return;
+    }
+
+    /* check for duplicate prefix configuration */
+    while (name != NULL) {
+        for (if_ptr = include_list; if_ptr; if_ptr = if_ptr->next) {
+            if (strncmp(name, if_ptr->name, strlen(if_ptr->name)) == 0) {
+                config_pwarn("Duplicate include interface prefix specification");
+                return;
+            }
+        }
+        /* now save the prefixes */
+        if_new = SNMP_MALLOC_TYPEDEF(netsnmp_include_if_list);
+        if (!if_new) {
+            config_perror("Out of memory");
+            goto err;
+        }
+        if_new->name = strdup(name);
+        if (!if_new->name) {
+            config_perror("Out of memory");
+            goto err;
+        }
+#if HAVE_PCRE_H
+        if_new->regex_ptr = pcre_compile(if_new->name, 0,  &pcre_error,
+                                         &pcre_error_offset, NULL);
+        if (!if_new->regex_ptr) {
+            config_perror(pcre_error);
+            goto err;
+        }
+#elif HAVE_REGEX_H
+        if_new->regex_ptr = malloc(sizeof(regex_t));
+        if (!if_new->regex_ptr) {
+            config_perror("Out of memory");
+            goto err;
+        }
+        r = regcomp(if_new->regex_ptr, if_new->name, REG_NOSUB);
+        if (r) {
+            char buf[BUFSIZ];
+            size_t regerror_len = 0;
+
+            regerror_len = regerror(r, if_new->regex_ptr, buf, BUFSIZ);
+            if (regerror_len >= BUFSIZ)
+                buf[BUFSIZ - 1] = '\0';
+            else
+                buf[regerror_len] = '\0';
+            config_perror(buf);
+            goto err;
+        }
+#endif
+        if_new->next = include_list;
+        include_list = if_new;
+        if_new = NULL;
+        name = strtok_r(NULL, " \t", &st);
+    }
+    return;
+
+err:
+    if (if_new) {
+#if defined(HAVE_PCRE_H) || defined(HAVE_REGEX_H)
+        free(if_new->regex_ptr);
+#endif
+        free(if_new->name);
+    }
+    free(if_new);
+}
+
+static void
+_free_include_if_config(void)
+{
+    netsnmp_include_if_list   *if_ptr = include_list, *if_next;
+
+    while (if_ptr) {
+        if_next = if_ptr->next;
+#if HAVE_PCRE_H
+        free(if_ptr->regex_ptr);
+#elif HAVE_REGEX_H
+        regfree(if_ptr->regex_ptr);
+        free(if_ptr->regex_ptr);
+#endif
+        free(if_ptr->name);
+        free(if_ptr);
+        if_ptr = if_next;
+    }
+    include_list = NULL;
+}
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface.h net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface.h
--- net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface.h	2021-05-26 05:19:35.000000000 +0700
@@ -26,33 +26,23 @@ config_require(if-mib/data_access/interf
  *    be handled in the *_hpux.h header file.
  */
 
-#ifdef NETSNMP_INCLUDE_IFTABLE_REWRITES
-
 config_exclude(mibII/interfaces)
 
-#   if defined( linux )
-
-    config_require(util_funcs)
-    config_require(if-mib/data_access/interface_linux)
-    config_require(if-mib/data_access/interface_ioctl)
-
-#   elif defined( openbsd3 ) || \
-         defined( freebsd4 ) || defined( freebsd5 ) || defined( freebsd6 ) || \
-         defined( darwin )   || defined( dragonfly ) || defined( netbsd1 )
-
-    config_require(if-mib/data_access/interface_sysctl)
-
-#   elif defined( solaris2 )
-
-    config_require(if-mib/data_access/interface_solaris2)
-
-#   else
-
-    config_error(This platform does not yet support IF-MIB rewrites)
-
-#   endif
+#if defined(linux)
+config_require(util_funcs)
+config_require(if-mib/data_access/interface_linux)
+config_require(if-mib/data_access/interface_ioctl)
+#elif defined( openbsd3 ) ||                                         \
+    defined( freebsd4 ) || defined( freebsd5 ) || defined( freebsd6 ) || \
+    defined( darwin )   || defined( dragonfly ) || defined( netbsd1 )
+config_require(if-mib/data_access/interface_sysctl)
+#elif defined(solaris2)
+config_require(if-mib/data_access/interface_solaris2)
+#elif defined(HAVE_IPHLPAPI_H) && !defined(cygwin)
+config_require(if-mib/data_access/interface_iphlpapi)
 #else
-#   define NETSNMP_ACCESS_INTERFACE_NOARCH 1
+config_warning(This platform does not yet support the IF-MIB)
+config_require(if-mib/data_access/interface_unsup)
 #endif
 
 #endif /* NETSNMP_ACCESS_INTERFACE_CONFIG_H */
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_ioctl.c net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_ioctl.c
--- net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_ioctl.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_ioctl.c	2021-05-26 05:19:35.000000000 +0700
@@ -14,7 +14,7 @@
 #include <net-snmp/data_access/ipaddress.h>
 #include "if-mib/data_access/interface.h"
 
-netsnmp_feature_child_of(interface_ioctl_flags_set, interface_all)
+netsnmp_feature_child_of(interface_ioctl_flags_set, interface_all);
 
 #ifdef HAVE_NET_IF_H
 #include <net/if.h>
@@ -417,7 +417,7 @@ netsnmp_access_interface_ioctl_ifindex_g
         return 0;
     }
 
-#if defined(__FreeBSD__)    /* ? Should use HAVE_STRUCT_IFREQ_IFR_INDEX */
+#if defined(freebsd3)    /* ? Should use HAVE_STRUCT_IFREQ_IFR_INDEX */
     return ifrq.ifr_index;
 #else
     return ifrq.ifr_ifindex;
@@ -432,6 +432,7 @@ netsnmp_access_interface_ioctl_ifindex_g
  * @param if_name : optional name. takes precedent over if_index.
  * @param if_index: optional if index. only used if no if_name specified
  * @param flags   :
+ * @param pifc    : ifconf structures returned by the SIOCGIFCONF ioctl
  *
  * @retval < 0 : error
  * @retval   0 : no ip v4 addresses
@@ -439,30 +440,24 @@ netsnmp_access_interface_ioctl_ifindex_g
  */
 int
 netsnmp_access_interface_ioctl_has_ipv4(int sd, const char *if_name,
-                                        int if_index, u_int *flags)
+                                        int if_index, u_int *flags,
+                                        const struct ifconf *pifc)
 {
     int             i, interfaces = 0;
-    struct ifconf   ifc;
     struct ifreq   *ifrp;
 
     /*
      * one or the other
      */
-    if ((NULL == flags) ||
+    if (NULL == flags || NULL == pifc ||
         ((0 == if_index) && (NULL == if_name))) {
         return -1;
     }
 
-    interfaces = netsnmp_access_ipaddress_ioctl_get_interface_count(sd, &ifc);
-    if(interfaces < 0) {
-        close(sd);
-        return -2;
-    }
-    netsnmp_assert(NULL != ifc.ifc_buf);
-
     *flags &= ~NETSNMP_INTERFACE_FLAGS_HAS_IPV4;
 
-    ifrp = ifc.ifc_req;
+    ifrp = pifc->ifc_req;
+    interfaces = pifc->ifc_len / sizeof(struct ifreq);
     for(i=0; i < interfaces; ++i, ++ifrp) {
 
         DEBUGMSGTL(("access:ipaddress:container",
@@ -497,10 +492,5 @@ netsnmp_access_interface_ioctl_has_ipv4(
         }
     }
 
-    /*
-     * clean up
-     */
-    free(ifc.ifc_buf);
-
     return 0;
 }
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_ioctl.h net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_ioctl.h
--- net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_ioctl.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_ioctl.h	2021-05-26 05:19:35.000000000 +0700
@@ -41,7 +41,8 @@ netsnmp_access_interface_ioctl_ifindex_g
 
 int
 netsnmp_access_interface_ioctl_has_ipv4(int sd, const char *if_name,
-                                        int if_index, u_int *flags);
+                                        int if_index, u_int *flags,
+                                        const struct ifconf *pifc);
 
 /**---------------------------------------------------------------------*/
 
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_iphlpapi.c net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_iphlpapi.c
--- net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_iphlpapi.c	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_iphlpapi.c	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,208 @@
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-features.h>
+#include <net-snmp/library/container.h>
+#include <net-snmp/library/snmp.h>
+#include <net-snmp/agent/snmp_agent.h>
+#include <net-snmp/agent/snmp_vars.h>
+#include "interface_private.h"
+#include "net-snmp/data_access/interface.h"
+#include <ws2tcpip.h>
+#include <iphlpapi.h>
+
+/* For Cygwin, MinGW32 and MSYS */
+#ifndef NETIO_STATUS
+#define NETIO_STATUS DWORD
+#endif
+
+#ifdef HAVE_MIB_IF_TABLE2
+static void (*pFreeMibTable)(void *Table);
+static NETIO_STATUS (*pGetIfEntry2)(MIB_IF_ROW2 *Row);
+static NETIO_STATUS (*pGetIfTable2)(MIB_IF_TABLE2 **Table);
+static NETIO_STATUS (*pSetIfEntry2)(MIB_IF_ROW2 *Row);
+#endif
+
+void
+netsnmp_arch_interface_init(void)
+{
+#ifdef HAVE_MIB_IF_TABLE2
+    HANDLE dll_handle = LoadLibrary("iphlpapi.dll");
+
+    pFreeMibTable = (void(*)(void*))(uintptr_t)
+        GetProcAddress(dll_handle, "FreeMibTable");
+    pGetIfEntry2 = (NETIO_STATUS(*)(MIB_IF_ROW2*))(uintptr_t)
+        GetProcAddress(dll_handle, "GetIfEntry2");
+    pGetIfTable2 = (NETIO_STATUS(*)(MIB_IF_TABLE2**))(uintptr_t)
+        GetProcAddress(dll_handle, "GetIfTable2");
+    pSetIfEntry2 = (NETIO_STATUS(*)(MIB_IF_ROW2*))(uintptr_t)
+        GetProcAddress(dll_handle, "SetIfEntry2");
+#endif
+}
+
+/* Load interface data using GetIfTable() (Windows 2000 and later). */
+static int netsnmp_arch_interface_load_old(netsnmp_container *container)
+{
+    DWORD           status;
+    DWORD           dwActualSize = 0;
+    MIB_IFTABLE    *iftable = NULL;
+    MIB_IFROW      *row, *end;
+
+    status = GetIfTable(iftable, &dwActualSize, /*bOrder=*/FALSE);
+    if (status == NO_ERROR)
+        return 0;
+    if (status != ERROR_INSUFFICIENT_BUFFER)
+        return SNMP_ERR_GENERR;
+    iftable = malloc(dwActualSize);
+    if (!iftable)
+        return SNMP_ERR_GENERR;
+    status = GetIfTable(iftable, &dwActualSize, /*bOrder=*/FALSE);
+    if (status != NO_ERROR)
+        return SNMP_ERR_GENERR;
+    end = iftable->table + iftable->dwNumEntries;
+    for (row = iftable->table; row < end; row++) {
+        netsnmp_interface_entry *entry;
+
+        entry = calloc(sizeof(*entry), 1);
+        if (!entry)
+            continue;
+        entry->name = strdup((const char *) row->wszName);
+        entry->oid_index.len = 1;
+        entry->oid_index.oids = &entry->index;
+        entry->index = row->dwIndex;
+        entry->descr = netsnmp_memdup(row->bDescr, row->dwDescrLen);
+        entry->type = row->dwType;
+        entry->mtu = row->dwMtu;
+        entry->speed = row->dwSpeed;
+        entry->paddr_len = row->dwPhysAddrLen;
+        entry->paddr = netsnmp_memdup(row->bPhysAddr, row->dwPhysAddrLen);
+        entry->admin_status = row->dwAdminStatus;
+        entry->oper_status = row->dwOperStatus ==
+            MIB_IF_OPER_STATUS_OPERATIONAL ? 1/*up*/ : 2/*down*/;
+        entry->lastchange = 0;  /* row->dwLastChange is not a Unix time */
+        entry->stats.ibytes.low = row->dwInOctets;
+        entry->stats.iucast.low = row->dwInUcastPkts;
+        entry->stats.inucast = row->dwInNUcastPkts;
+        entry->stats.ierrors = row->dwInErrors;
+        entry->stats.idiscards = row->dwInDiscards;
+        entry->stats.iunknown_protos = row->dwInUnknownProtos;
+        entry->stats.obytes.low = row->dwOutOctets;
+        entry->stats.oucast.low = row->dwOutUcastPkts;
+        entry->stats.oerrors = row->dwOutErrors;
+        entry->stats.oqlen = row->dwOutQLen;
+        entry->stats.onucast = row->dwOutNUcastPkts;
+        CONTAINER_INSERT(container, entry);
+    }
+
+    free(iftable);
+    return 0;
+}
+
+#ifdef HAVE_MIB_IF_TABLE2
+/*
+ * Load interface data using GetIfTable2(). GetIfTable2() is available on
+ * Windows Vista, Windows Server 2008 and later.
+ */
+static int netsnmp_arch_interface_load_new(netsnmp_container *container)
+{
+    DWORD           status;
+    MIB_IF_TABLE2  *iftable = NULL;
+    MIB_IF_ROW2    *row, *end;
+    char           *descr;
+    unsigned        descr_len;
+
+    status = pGetIfTable2(&iftable);
+    if (status != NO_ERROR)
+        return SNMP_ERR_GENERR;
+    end = iftable->Table + iftable->NumEntries;
+    for (row = iftable->Table; row < end; row++) {
+        netsnmp_interface_entry *entry;
+
+        entry = calloc(sizeof(*entry), 1);
+        if (!entry)
+            continue;
+        entry->name = strdup((const char *) row->Alias);
+        entry->oid_index.len = 1;
+        entry->oid_index.oids = &entry->index;
+        entry->index = row->InterfaceIndex;
+        descr_len = WideCharToMultiByte(CP_UTF8, 0, row->Description, -1, NULL,
+                                        0, NULL, NULL);
+        descr = malloc(descr_len);
+        if (row && WideCharToMultiByte(CP_UTF8, 0, row->Description, -1, descr,
+                                       descr_len, NULL, NULL) > 0) {
+            entry->descr = descr;
+        } else {
+            free(row);
+        }
+        entry->type = row->Type;
+        entry->mtu = row->Mtu;
+        entry->speed = row->TransmitLinkSpeed;
+        entry->paddr_len = row->PhysicalAddressLength;
+        entry->paddr = netsnmp_memdup(row->PhysicalAddress,
+                                      row->PhysicalAddressLength);
+        entry->admin_status = row->AdminStatus;
+        entry->oper_status = row->OperStatus;
+        entry->lastchange = 0;  /* row->dwLastChange is not a Unix time */
+        entry->stats.ibytes.low = row->InOctets;
+        entry->stats.iucast.low = row->InUcastPkts;
+        entry->stats.inucast = row->InNUcastPkts;
+        entry->stats.ierrors = row->InErrors;
+        entry->stats.idiscards = row->InDiscards;
+        entry->stats.iunknown_protos = row->InUnknownProtos;
+        entry->stats.obytes.low = row->OutOctets;
+        entry->stats.oucast.low = row->OutUcastPkts;
+        entry->stats.oerrors = row->OutErrors;
+        entry->stats.oqlen = row->OutQLen;
+        entry->stats.onucast = row->OutNUcastPkts;
+        CONTAINER_INSERT(container, entry);
+    }
+
+    pFreeMibTable(iftable);
+    return 0;
+}
+#else
+static int netsnmp_arch_interface_load_new(netsnmp_container *container)
+{
+    return SNMP_ERR_GENERR;
+}
+#endif
+
+int
+netsnmp_arch_interface_container_load(netsnmp_container *container,
+                                      u_int load_flags)
+{
+#ifdef HAVE_MIB_IF_TABLE2
+    return pGetIfTable2 ? netsnmp_arch_interface_load_new(container) :
+        netsnmp_arch_interface_load_old(container);
+#else
+    return netsnmp_arch_interface_load_old(container);
+#endif
+}
+
+oid
+netsnmp_arch_interface_index_find(const char *name)
+{
+    /* To do: implement this function. */
+    return 0;
+}
+
+int
+netsnmp_arch_set_admin_status(struct netsnmp_interface_entry_s *entry,
+                              int ifAdminStatus_val)
+{
+    MIB_IFROW       row;
+
+    memset(&row, 0, sizeof(row));
+    row.dwIndex = entry->index;
+    if (GetIfEntry(&row) != NO_ERROR) {
+        snmp_log(LOG_ERR, "GetIfEntry() failed for index %" NETSNMP_PRIo "u",
+                 entry->index);
+        return SNMP_ERR_GENERR;
+    }
+    row.dwAdminStatus = ifAdminStatus_val;
+    if (SetIfEntry(&row) != NO_ERROR) {
+        snmp_log(LOG_ERR,
+                 "SetIfEntry() failed for index %" NETSNMP_PRIo "u and admin status %u\n",
+                 entry->index, ifAdminStatus_val);
+        return SNMP_ERR_GENERR;
+    }
+    return 0;
+}
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_linux.c net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_linux.c
--- net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -10,15 +10,19 @@
 #include <net-snmp/agent/snmp_vars.h>
 #include "interface_private.h"
 
-netsnmp_feature_require(fd_event_manager)
-netsnmp_feature_require(delete_prefix_info)
-netsnmp_feature_require(create_prefix_info)
-netsnmp_feature_child_of(interface_arch_set_admin_status, interface_all)
+netsnmp_feature_require(fd_event_manager);
+netsnmp_feature_require(delete_prefix_info);
+netsnmp_feature_require(create_prefix_info);
+netsnmp_feature_child_of(interface_arch_set_admin_status, interface_all);
 
 #ifdef NETSNMP_FEATURE_REQUIRE_INTERFACE_ARCH_SET_ADMIN_STATUS
-netsnmp_feature_require(interface_ioctl_flags_set)
+netsnmp_feature_require(interface_ioctl_flags_set);
 #endif /* NETSNMP_FEATURE_REQUIRE_INTERFACE_ARCH_SET_ADMIN_STATUS */
 
+#ifdef HAVE_INTTYPES_H
+#include <inttypes.h>
+#endif
+
 #ifdef HAVE_PCI_LOOKUP_NAME
 #include <pci/pci.h>
 #include <setjmp.h>
@@ -61,6 +65,7 @@ typedef __u8 u8;           /* ditto */
 
 #include "mibII/mibII_common.h"
 #include "if-mib/ifTable/ifTable_constants.h"
+#include "ip-mib/data_access/ipaddress_ioctl.h"
 
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
@@ -132,6 +137,41 @@ netsnmp_prefix_listen_info list_info;
 int netsnmp_prefix_listen(void);
 #endif
 
+#ifdef HAVE_PCI_LOOKUP_NAME
+static void init_libpci(void)
+{
+    struct stat stbuf;
+
+    /*
+     * When snmpd is run inside an OpenVZ container or on a Raspberry Pi system
+     * /proc/bus/pci is not available.
+     */
+    if (stat("/proc/bus/pci", &stbuf) == 0)
+        return;
+
+    pci_access = pci_alloc();
+    if (!pci_access) {
+	snmp_log(LOG_ERR, "pcilib: pci_alloc failed\n");
+	return;
+    }
+
+    pci_access->error = netsnmp_pci_error;
+
+    do_longjmp = 1;
+    if (setjmp(err_buf)) {
+        pci_cleanup(pci_access);
+	snmp_log(LOG_ERR, "pcilib: pci_init failed\n");
+        pci_access = NULL;
+    }
+    else if (pci_access)
+	pci_init(pci_access);
+    do_longjmp = 0;
+}
+#else
+static void init_libpci(void)
+{
+}
+#endif
 
 void
 netsnmp_arch_interface_init(void)
@@ -171,25 +211,7 @@ netsnmp_arch_interface_init(void)
     netsnmp_prefix_listen();
 #endif
 
-#ifdef HAVE_PCI_LOOKUP_NAME
-    pci_access = pci_alloc();
-    if (!pci_access) {
-	snmp_log(LOG_ERR, "pcilib: pci_alloc failed\n");
-	return;
-    }
-
-    pci_access->error = netsnmp_pci_error;
-
-    do_longjmp = 1;
-    if (setjmp(err_buf)) {
-        pci_cleanup(pci_access);
-	snmp_log(LOG_ERR, "pcilib: pci_init failed\n");
-        pci_access = NULL;
-    }
-    else if (pci_access)
-	pci_init(pci_access);
-    do_longjmp = 0;
-#endif
+    init_libpci();
 }
 
 /*
@@ -463,7 +485,6 @@ _parse_stats(netsnmp_interface_entry *en
      *  [               OUT                               ]
      *   byte pkts errs drop fifo colls carrier compressed
      */
-#ifdef SCNuMAX
     uintmax_t       rec_pkt, rec_oct, rec_err, rec_drop, rec_mcast;
     uintmax_t       snd_pkt, snd_oct, snd_err, snd_drop, coll;
     const char     *scan_line_2_2 =
@@ -475,14 +496,6 @@ _parse_stats(netsnmp_interface_entry *en
         "%"   SCNuMAX " %"  SCNuMAX " %*" SCNuMAX " %*" SCNuMAX
         " %*" SCNuMAX " %"  SCNuMAX " %"  SCNuMAX " %*" SCNuMAX
         " %*" SCNuMAX " %"  SCNuMAX;
-#else
-    unsigned long   rec_pkt, rec_oct, rec_err, rec_drop, rec_mcast;
-    unsigned long   snd_pkt, snd_oct, snd_err, snd_drop, coll;
-    const char     *scan_line_2_2 =
-        "%lu %lu %lu %lu %*lu %*lu %*lu %lu %lu %lu %lu %lu %*lu %lu";
-    const char     *scan_line_2_0 =
-        "%lu %lu %*lu %*lu %*lu %lu %lu %*lu %*lu %lu";
-#endif
     static const char     *scan_line_to_use = NULL;
     int             scan_count;
 
@@ -522,10 +535,8 @@ _parse_stats(netsnmp_interface_entry *en
              */
             entry->ns_flags |= NETSNMP_INTERFACE_FLAGS_HAS_MCAST_PKTS;
             entry->ns_flags |= NETSNMP_INTERFACE_FLAGS_HAS_HIGH_SPEED;
-#ifdef SCNuMAX   /* XXX - should be flag for 64-bit variables */
             entry->ns_flags |= NETSNMP_INTERFACE_FLAGS_HAS_HIGH_BYTES;
             entry->ns_flags |= NETSNMP_INTERFACE_FLAGS_HAS_HIGH_PACKETS;
-#endif
         }
     } else {
         scan_count = sscanf(stats, scan_line_to_use,
@@ -561,13 +572,11 @@ _parse_stats(netsnmp_interface_entry *en
     entry->stats.imcast.low = rec_mcast & 0xffffffff;
     entry->stats.obytes.low = snd_oct & 0xffffffff;
     entry->stats.oucast.low = snd_pkt & 0xffffffff;
-#ifdef SCNuMAX   /* XXX - should be flag for 64-bit variables */
     entry->stats.ibytes.high = rec_oct >> 32;
     entry->stats.iall.high = rec_pkt >> 32;
     entry->stats.imcast.high = rec_mcast >> 32;
     entry->stats.obytes.high = snd_oct >> 32;
     entry->stats.oucast.high = snd_pkt >> 32;
-#endif
     entry->stats.ierrors   = rec_err;
     entry->stats.idiscards = rec_drop;
     entry->stats.oerrors   = snd_err;
@@ -603,6 +612,8 @@ netsnmp_arch_interface_container_load(ne
     netsnmp_interface_entry *entry = NULL;
     static char     scan_expected = 0;
     int             fd;
+    int             interfaces = 0;
+    struct ifconf   ifc;
 #ifdef NETSNMP_ENABLE_IPV6
     netsnmp_container *addr_container;
 #endif
@@ -648,8 +659,8 @@ netsnmp_arch_interface_container_load(ne
      * to detect the position of individual fields directly,
      * but I suspect this is probably more trouble than it's worth.
      */
-    fgets(line, sizeof(line), devin);
-    fgets(line, sizeof(line), devin);
+    NETSNMP_IGNORE_RESULT(fgets(line, sizeof(line), devin));
+    NETSNMP_IGNORE_RESULT(fgets(line, sizeof(line), devin));
 
     if( 0 == scan_expected ) {
         if (strstr(line, "compressed")) {
@@ -663,6 +674,16 @@ netsnmp_arch_interface_container_load(ne
         }
     }
 
+    interfaces = netsnmp_access_ipaddress_ioctl_get_interface_count(fd, &ifc);
+    if (interfaces < 0) {
+        snmp_log(LOG_ERR,"get interface count failed\n");
+        fclose(devin);
+        close(fd);
+        return -2;
+    }
+    netsnmp_assert(NULL != ifc.ifc_buf);
+
+
     /*
      * The rest of the file provides the statistics for each interface.
      * Read in each line in turn, isolate the interface name
@@ -700,8 +721,12 @@ netsnmp_arch_interface_container_load(ne
          */
         *stats++ = 0; /* null terminate name */
 
-        if_index = netsnmp_arch_interface_index_find(ifstart);
+	if (!netsnmp_access_interface_include(ifstart))
+		continue;
 
+	if (netsnmp_access_interface_max_reached(ifstart))
+		/* we may need to stop tracking ifaces if a max was set */
+		continue;
         /*
          * set address type flags.
          * the only way I know of to check an interface for
@@ -709,9 +734,10 @@ netsnmp_arch_interface_container_load(ne
          * knows a better way, put it here!
          */
 #ifdef NETSNMP_ENABLE_IPV6
+        if_index = netsnmp_arch_interface_index_find(ifstart);
         _arch_interface_has_ipv6(if_index, &flags, addr_container);
 #endif
-        netsnmp_access_interface_ioctl_has_ipv4(fd, ifstart, 0, &flags);
+        netsnmp_access_interface_ioctl_has_ipv4(fd, ifstart, 0, &flags, &ifc);
 
         /*
          * do we only want one address type?
@@ -731,10 +757,9 @@ netsnmp_arch_interface_container_load(ne
 #ifdef NETSNMP_ENABLE_IPV6
             netsnmp_access_ipaddress_container_free(addr_container, 0);
 #endif
-            netsnmp_access_interface_container_free(container,
-                                                    NETSNMP_ACCESS_INTERFACE_FREE_NOFLAGS);
             fclose(devin);
             close(fd);
+            free(ifc.ifc_buf);
             return -3;
         }
         entry->ns_flags = flags; /* initial flags; we'll set more later */
@@ -902,6 +927,7 @@ netsnmp_arch_interface_container_load(ne
 #endif
     fclose(devin);
     close(fd);
+    free(ifc.ifc_buf);
     return 0;
 }
 
@@ -926,43 +952,29 @@ netsnmp_arch_set_admin_status(netsnmp_in
 
 #ifdef HAVE_LINUX_ETHTOOL_H
 /**
- * Determines network interface speed from ETHTOOL_GSET
+ * Determines network interface speed from ETHTOOL_GLINKSETTINGS
+ * In case of failure revert to obsolete ETHTOOL_GSET
  */
 unsigned long long
 netsnmp_linux_interface_get_if_speed(int fd, const char *name,
             unsigned long long defaultspeed)
 {
     int ret;
-    struct ifreq ifr;
-    struct ethtool_cmd edata;
-    uint16_t speed_hi;
-    uint32_t speed;
-
-    memset(&ifr, 0, sizeof(ifr));
-    memset(&edata, 0, sizeof(edata));
-    edata.cmd = ETHTOOL_GSET;
-    
-    strlcpy(ifr.ifr_name, name, sizeof(ifr.ifr_name));
-    ifr.ifr_data = (char *) &edata;
-    
-    ret = ioctl(fd, SIOCETHTOOL, &ifr);
-    if (ret == -1 || edata.speed == 0) {
+    struct netsnmp_linux_link_settings nlls;
+    uint32_t speed = -1;
+
+    ret = netsnmp_get_link_settings(&nlls, fd, name);
+    if (ret < 0) {
         DEBUGMSGTL(("mibII/interfaces", "ETHTOOL_GSET on %s failed (%d / %d)\n",
-                    ifr.ifr_name, ret, edata.speed));
-        return netsnmp_linux_interface_get_if_speed_mii(fd,name,defaultspeed);
+                    name, ret, speed));
+        return netsnmp_linux_interface_get_if_speed_mii(fd, name, defaultspeed);
     }
-
-#ifdef HAVE_STRUCT_ETHTOOL_CMD_SPEED_HI
-    speed_hi = edata.speed_hi;
-#else
-    speed_hi = 0;
-#endif
-    speed = speed_hi << 16 | edata.speed;
+    speed = nlls.speed;
     if (speed == 0xffff || speed == 0xffffffffUL /*SPEED_UNKNOWN*/)
         speed = defaultspeed;
     /* return in bps */
-    DEBUGMSGTL(("mibII/interfaces", "ETHTOOL_GSET on %s speed = %#x -> %d\n",
-                ifr.ifr_name, speed_hi << 16 | edata.speed, speed));
+    DEBUGMSGTL(("mibII/interfaces", "ETHTOOL_GSET on %s speed = %#x = %d\n",
+                name, speed, speed));
     return speed * 1000LL * 1000LL;
 }
 #endif
@@ -1242,9 +1254,9 @@ void netsnmp_prefix_process(int fd, void
         iret = net_snmp_delete_prefix_info (list_info.list_head, in6pAddr);
         if(iret < 0)
             DEBUGMSGTL(("access:interface:prefix", "Unable to delete the prefix info\n"));
-            if(!iret)
-                DEBUGMSGTL(("access:interface:prefix", "Unable to find the node to delete\n"));
-            have_addr = 0;
+        if(!iret)
+            DEBUGMSGTL(("access:interface:prefix", "Unable to find the node to delete\n"));
+        have_addr = 0;
     }
 }
 #endif
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_openbsd.c net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_openbsd.c
--- net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_openbsd.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_openbsd.c	2021-05-26 05:19:35.000000000 +0700
@@ -9,7 +9,7 @@
 #include "mibII/mibII_common.h"
 #include "if-mib/ifTable/ifTable_constants.h"
 
-netsnmp_feature_child_of(interface_arch_set_admin_status, interface_all)
+netsnmp_feature_child_of(interface_arch_set_admin_status, interface_all);
 
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
@@ -143,8 +143,6 @@ netsnmp_arch_interface_container_load(ne
 
         entry = netsnmp_access_interface_entry_create(if_name, ifp->ifm_index);
         if(NULL == entry) {
-            netsnmp_access_interface_container_free(container,
-                                                    NETSNMP_ACCESS_INTERFACE_FREE_NOFLAGS);
             free(if_list);
             return -3;
         }
@@ -334,7 +332,8 @@ netsnmp_openbsd_interface_get_if_speed(c
 {
     int s;
     struct ifmediareq ifmr;
-    int *media_list, i;
+    int i;
+    uint64_t *media_list;
     u_int t_speed, t_speed_high; 
     u_int m_speed, m_speed_high;
 
@@ -361,7 +360,7 @@ netsnmp_openbsd_interface_get_if_speed(c
     _openbsd_interface_ifmedia_to_speed(ifmr.ifm_current, speed, speed_high);
 
     if (*speed == 0 &&
-        (media_list = (int *) malloc(ifmr.ifm_count * sizeof(int))) != NULL ) {
+        (media_list = (uint64_t *) malloc(ifmr.ifm_count * sizeof(uint64_t))) != NULL ) {
 
         ifmr.ifm_ulist = media_list;
 
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_solaris2.c net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_solaris2.c
--- net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_solaris2.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_solaris2.c	2021-05-26 05:19:35.000000000 +0700
@@ -18,7 +18,7 @@
 #include <strings.h>
 #include <string.h>
 
-netsnmp_feature_child_of(interface_arch_set_admin_status, interface_all)
+netsnmp_feature_child_of(interface_arch_set_admin_status, interface_all);
 
 static int _set_ip_flags_v4(netsnmp_interface_entry *, mib2_ifEntry_t *);
 static int _match_ifname_v4addr(void *ifname, void *ipaddr);
@@ -211,8 +211,6 @@ netsnmp_arch_interface_container_load(ne
     if (error) {
         DEBUGMSGTL(("access:interface:container:arch", 
                     "error %d, free container\n", error));
-        netsnmp_access_interface_container_free(container,
-            NETSNMP_ACCESS_INTERFACE_FREE_NOFLAGS);
         return -2;
     }
 
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_sysctl.c net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_sysctl.c
--- net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_sysctl.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_sysctl.c	2021-05-26 05:19:35.000000000 +0700
@@ -31,7 +31,7 @@
 #include <net/if_types.h>
 #include <net/if_media.h>
 
-netsnmp_feature_child_of(interface_arch_set_admin_status, interface_all)
+netsnmp_feature_child_of(interface_arch_set_admin_status, interface_all);
 
 /*
  * account for minor differences between FreeBSD and OpenBSD.
@@ -136,7 +136,7 @@ netsnmp_sysctl_ifmedia_to_speed(int medi
                     *speed = (u_int) -1; /* 4294967295; */
                     *speed_high = 10000; break;
 #endif
-#if defined(__FreeBSD__)
+#if defined(freebsd3)
 #ifdef IFM_10G_LR
                 case IFM_10G_LR:
 #ifdef IFM_10G_SR
@@ -248,7 +248,7 @@ netsnmp_sysctl_ifmedia_to_speed(int medi
                     *speed = (u_int) -1; /* 4294967295; */
                     *speed_high = 100000; break;
 #endif /* IFM_100G_CR4 */
-#endif /* __FreeBSD__ */
+#endif /* freebsd3 */
             }
             break;
         case IFM_IEEE80211:
@@ -531,8 +531,11 @@ netsnmp_arch_interface_container_load(ne
                 }
             }
             adl = (struct sockaddr_dl *) a;
-            if_name = (char *) adl->sdl_data;
-            if_name[adl->sdl_nlen] = '\0';
+            if_name = malloc(adl->sdl_nlen + 1);
+            if (if_name) {
+                memcpy(if_name, adl->sdl_data, adl->sdl_nlen);
+                if_name[adl->sdl_nlen] = '\0';
+            }
         }
         if (!(ifp->ifm_addrs & RTA_IFP) || if_name == NULL) {
             snmp_log(LOG_ERR, "ifm_index %u: no interface name in message, "
@@ -541,9 +544,8 @@ netsnmp_arch_interface_container_load(ne
         }
 
         entry = netsnmp_access_interface_entry_create(if_name, ifp->ifm_index);
+        free(if_name);
         if(NULL == entry) {
-            netsnmp_access_interface_container_free(container,
-                                                    NETSNMP_ACCESS_INTERFACE_FREE_NOFLAGS);
             free(if_list);
             return -3;
         }
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_unsup.c net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_unsup.c
--- net-snmp-5.8/agent/mibgroup/if-mib/data_access/interface_unsup.c	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/data_access/interface_unsup.c	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,25 @@
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include "interface_private.h"
+
+void netsnmp_arch_interface_init(void)
+{
+}
+
+int netsnmp_arch_interface_container_load(struct netsnmp_container_s* container,
+                                          u_int load_flags)
+{
+    return 0;
+}
+
+oid netsnmp_arch_interface_index_find(const char *name)
+{
+    return 0;
+}
+
+int netsnmp_arch_set_admin_status(struct netsnmp_interface_entry_s * entry,
+                                  int ifAdminStatus_val)
+{
+    return 0;
+}
+
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/ifTable/ifTable.c net-snmp-5.9.1/agent/mibgroup/if-mib/ifTable/ifTable.c
--- net-snmp-5.8/agent/mibgroup/if-mib/ifTable/ifTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/ifTable/ifTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -19,7 +19,7 @@
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(interface_access_entry_set_admin_status)
+netsnmp_feature_require(interface_access_entry_set_admin_status);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /*
@@ -59,21 +59,24 @@ _if_number_handler(netsnmp_mib_handler *
 
 
 /**
- * Initializes the ifTable module
+ * Initializes the ifTable module. Called after the snmpd configuration has
+ * been read.
  */
-void
-init_ifTable(void)
+static int
+_init_ifTable(int majorID, int minorID, void *serverargs, void *clientarg)
 {
     static int      ifTable_did_init = 0;
 
     DEBUGMSGTL(("verbose:ifTable:init_ifTable", "called\n"));
 
+    netsnmp_access_interface_init();
+
     /*
      * TODO:300:o: Perform ifTable one-time module initialization.
      */
     if (++ifTable_did_init != 1) {
         DEBUGMSGTL(("ifTable:init_ifTable", "ignoring duplicate call\n"));
-        return;
+        return 0;
     }
 
     /*
@@ -98,8 +101,18 @@ init_ifTable(void)
             initialize_table_ifXTable();
 #endif
     }
+
+    return 0;
 }                               /* init_ifTable */
 
+void
+init_ifTable(void)
+{
+    snmp_register_callback(SNMP_CALLBACK_LIBRARY,
+                           SNMP_CALLBACK_PRE_READ_CONFIG,
+                           _init_ifTable, NULL);
+}
+
 /**
  * Shut-down the ifTable module (agent is exiting)
  */
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/ifTable/ifTable_data_access.c net-snmp-5.9.1/agent/mibgroup/if-mib/ifTable/ifTable_data_access.c
--- net-snmp-5.8/agent/mibgroup/if-mib/ifTable/ifTable_data_access.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/ifTable/ifTable_data_access.c	2021-05-26 05:19:35.000000000 +0700
@@ -12,7 +12,7 @@
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
-netsnmp_feature_require(container_linked_list)
+netsnmp_feature_require(container_linked_list);
 
 /*
  * include our parent header 
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/ifTable/ifTable_interface.c net-snmp-5.9.1/agent/mibgroup/if-mib/ifTable/ifTable_interface.c
--- net-snmp-5.8/agent/mibgroup/if-mib/ifTable/ifTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/ifTable/ifTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -48,20 +48,20 @@
 
 #include <ctype.h>
 
-netsnmp_feature_child_of(ifTable_external_access, libnetsnmpmibs)
+netsnmp_feature_child_of(ifTable_external_access, libnetsnmpmibs);
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(check_all_requests_error)
-netsnmp_feature_child_of(iftable_container_get, ifTable_external_access)
-netsnmp_feature_child_of(ifxtable_shutdown_interface, netsnmp_unused)
-netsnmp_feature_child_of(ifXTable_container_size, ifXTable_external_access)
-netsnmp_feature_child_of(ifXTable_registration_set, ifXTable_external_access)
-netsnmp_feature_child_of(ifXTable_registration_get, ifXTable_external_access)
-netsnmp_feature_child_of(ifXTable_container_get, ifXTable_external_access)
-netsnmp_feature_child_of(iftable_container_size, ifTable_external_access)
-netsnmp_feature_child_of(iftable_registration_set, ifTable_external_access)
-netsnmp_feature_child_of(iftable_registration_get, ifTable_external_access)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(check_all_requests_error);
+netsnmp_feature_child_of(iftable_container_get, ifTable_external_access);
+netsnmp_feature_child_of(ifxtable_shutdown_interface, netsnmp_unused);
+netsnmp_feature_child_of(ifXTable_container_size, ifXTable_external_access);
+netsnmp_feature_child_of(ifXTable_registration_set, ifXTable_external_access);
+netsnmp_feature_child_of(ifXTable_registration_get, ifXTable_external_access);
+netsnmp_feature_child_of(ifXTable_container_get, ifXTable_external_access);
+netsnmp_feature_child_of(iftable_container_size, ifTable_external_access);
+netsnmp_feature_child_of(iftable_registration_set, ifTable_external_access);
+netsnmp_feature_child_of(iftable_registration_get, ifTable_external_access);
 
 /**********************************************************************
  **********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/ifXTable/ifXTable.c net-snmp-5.9.1/agent/mibgroup/if-mib/ifXTable/ifXTable.c
--- net-snmp-5.8/agent/mibgroup/if-mib/ifXTable/ifXTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/ifXTable/ifXTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -30,8 +30,8 @@
 
 #include "ifXTable_interface.h"
 
-netsnmp_feature_require(ifTable_container_get)
-netsnmp_feature_require(ifTable_container_size)
+netsnmp_feature_require(ifTable_container_get);
+netsnmp_feature_require(ifTable_container_size);
 
 /*
  * not sure if we want to support set for promiscuous mode, because
diff -urpN net-snmp-5.8/agent/mibgroup/if-mib/ifXTable/ifXTable_interface.c net-snmp-5.9.1/agent/mibgroup/if-mib/ifXTable/ifXTable_interface.c
--- net-snmp-5.8/agent/mibgroup/if-mib/ifXTable/ifXTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/if-mib/ifXTable/ifXTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -50,14 +50,14 @@
 
 #include <ctype.h>
 
-netsnmp_feature_child_of(ifXTable_external_access, libnetsnmpmibs)
+netsnmp_feature_child_of(ifXTable_external_access, libnetsnmpmibs);
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(cache_find_by_oid)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(cache_find_by_oid);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(check_all_requests_error);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_type_and_max_size)
+netsnmp_feature_require(check_vb_type_and_max_size);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /**********************************************************************
@@ -1144,9 +1144,7 @@ _ifXTable_check_column(ifXTable_rowreq_c
         /*
          * check defined range(s). 
          */
-        if ((SNMPERR_SUCCESS == rc)
-            && ((var->val_len < 0) || (var->val_len > 64))
-            ) {
+        if (rc == SNMPERR_SUCCESS && var->val_len > 64) {
             rc = SNMP_ERR_WRONGLENGTH;
         }
         if (SNMPERR_SUCCESS != rc) {
@@ -1799,8 +1797,7 @@ static int      _ifXTable_container_save
                                               void *clientarg);
 static void     _ifXTable_container_row_restore(const char *token,
                                                 char *buf);
-static int      _ifXTable_container_row_save(ifXTable_rowreq_ctx *
-                                             rowreq_ctx, void *type);
+static void     _ifXTable_container_row_save(void *data, void *type);
 static char    *_ifXTable_container_col_restore(ifXTable_rowreq_ctx *
                                                 rowreq_ctx, u_int col,
                                                 char *buf);
@@ -1856,7 +1853,6 @@ _ifXTable_container_save_rows(int majorI
      * save all rows
      */
     CONTAINER_FOR_EACH(*(netsnmp_container **)clientarg,
-                       (netsnmp_container_obj_func *)
                        _ifXTable_container_row_save, type);
 
     read_config_store((char *) type, sep);
@@ -1873,9 +1869,10 @@ _ifXTable_container_save_rows(int majorI
 /************************************************************
  * _ifXTable_container_row_save
  */
-static int
-_ifXTable_container_row_save(ifXTable_rowreq_ctx * rowreq_ctx, void *type)
+static void _ifXTable_container_row_save(void *data, void *type)
 {
+    ifXTable_rowreq_ctx *rowreq_ctx = data;
+
     /*
      * Allocate space for a line with all data for a row. An
      * attempt is made to come up with a default maximum size, but
@@ -1918,7 +1915,7 @@ _ifXTable_container_row_save(ifXTable_ro
     int             i;
 
     if (ifXTable_container_should_save(rowreq_ctx) == 0) {
-        return SNMP_ERR_NOERROR;
+        return;
     }
 
     /*
@@ -1930,13 +1927,13 @@ _ifXTable_container_row_save(ifXTable_ro
     if (NULL == pos) {
         snmp_log(LOG_ERR, "error saving ifXTable row "
                  "to persistent file\n");
-        return SNMP_ERR_GENERR;
+        return;
     }
     *pos++ = ' ';
     if (pos > max) {
         snmp_log(LOG_ERR, "error saving ifXTable row "
                  "to persistent file (too long)\n");
-        return SNMP_ERR_GENERR;
+        return;
     }
 
     /*
@@ -1956,7 +1953,7 @@ _ifXTable_container_row_save(ifXTable_ro
         if (pos > max) {
             snmp_log(LOG_ERR, "error saving ifXTable row "
                      "to persistent file (too long)\n");
-            return SNMP_ERR_GENERR;
+            return;
         }
     }
 
@@ -1972,14 +1969,12 @@ _ifXTable_container_row_save(ifXTable_ro
     if (pos > max) {
         snmp_log(LOG_ERR, "error saving ifXTable row "
                  "to persistent file (too long)\n");
-        return SNMP_ERR_GENERR;
+        return;
     }
     read_config_store((char *) type, buf);
 
     DEBUGMSGTL(("internal:ifXTable:_ifXTable_container_row_save",
                 "saving line '%s'\n", buf));
-
-    return SNMP_ERR_NOERROR;
 }
 
 static void
diff -urpN net-snmp-5.8/agent/mibgroup/ip-forward-mib/data_access/route_linux.c net-snmp-5.9.1/agent/mibgroup/ip-forward-mib/data_access/route_linux.c
--- net-snmp-5.8/agent/mibgroup/ip-forward-mib/data_access/route_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-forward-mib/data_access/route_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -69,7 +69,7 @@ _load_ipv4(netsnmp_container* container,
         return -2;
     }
 
-    fgets(line, sizeof(line), in); /* skip header */
+    NETSNMP_IGNORE_RESULT(fgets(line, sizeof(line), in)); /* skip header */
 
     while (fgets(line, sizeof(line), in)) {
         char            rtent_name[32];
diff -urpN net-snmp-5.8/agent/mibgroup/ip-forward-mib/data_access/route_solaris.c net-snmp-5.9.1/agent/mibgroup/ip-forward-mib/data_access/route_solaris.c
--- net-snmp-5.8/agent/mibgroup/ip-forward-mib/data_access/route_solaris.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-forward-mib/data_access/route_solaris.c	2021-05-26 05:19:35.000000000 +0700
@@ -20,8 +20,8 @@
 #include "if-mib/data_access/interface_ioctl.h"
 #include "route_private.h"
 
-static int _load_v4(netsnmp_container *container, u_long *count);
-static int _load_v6(netsnmp_container *container, u_long *count);
+static int _load_v4(netsnmp_container *container);
+static int _load_v6(netsnmp_container *container);
 
 /** arch specific load
  * @internal
@@ -34,7 +34,6 @@ int
 netsnmp_access_route_container_arch_load(netsnmp_container* container,
                                          u_int load_flags)
 {
-    u_long          count = 0;
     int             rc;
 
     DEBUGMSGTL(("access:route:container",
@@ -45,7 +44,7 @@ netsnmp_access_route_container_arch_load
         return -1;
     }
 
-    rc = _load_v4(container, &count);
+    rc = _load_v4(container);
     
 #ifdef NETSNMP_ENABLE_IPV6
     if((0 != rc) || (load_flags & NETSNMP_ACCESS_ROUTE_LOAD_IPV4_ONLY))
@@ -55,7 +54,7 @@ netsnmp_access_route_container_arch_load
      * load ipv6. ipv6 module might not be loaded,
      * so ignore -2 err (file not found)
      */
-    rc = _load_v6(container, &count);
+    rc = _load_v6(container);
     if (-2 == rc)
         rc = 0;
 #endif
@@ -148,7 +147,7 @@ IP6_Cmp_Route(void *addr, void *ep)
 }
 
 
-static int _load_v4(netsnmp_container *container, u_long *count)
+static int _load_v4(netsnmp_container *container)
 {
     netsnmp_route_entry *entry;
     mib2_ipRouteEntry_t Curentry, Nextentry;
@@ -197,13 +196,12 @@ static int _load_v4(netsnmp_container *c
 	    netsnmp_access_route_entry_free(entry);
 	    continue;
 	}
-	*count++;
     }
     return 0;
 }
 
 
-static int _load_v6(netsnmp_container *container, u_long *count)
+static int _load_v6(netsnmp_container *container)
 {
     netsnmp_route_entry *entry;
     mib2_ipv6RouteEntry_t Curentry, Nextentry;
@@ -253,7 +251,6 @@ static int _load_v6(netsnmp_container *c
 	    netsnmp_access_route_entry_free(entry);
 	    continue;
 	}
-	*count++;
     }
     return 0;
 }
diff -urpN net-snmp-5.8/agent/mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable.c net-snmp-5.9.1/agent/mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable.c
--- net-snmp-5.8/agent/mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -27,8 +27,8 @@
 
 #include "inetCidrRouteTable_interface.h"
 
-netsnmp_feature_require(inetCidrRouteTable_container_get)
-netsnmp_feature_require(inetCidrRouteTable_container_size)
+netsnmp_feature_require(inetCidrRouteTable_container_get);
+netsnmp_feature_require(inetCidrRouteTable_container_size);
 
 const oid       inetCidrRouteTable_oid[] = { INETCIDRROUTETABLE_OID };
 const int       inetCidrRouteTable_oid_size =
@@ -394,9 +394,7 @@ inetCidrRouteTable_indexes_set_tbl_idx(i
     /*
      * make sure there is enough space for inetCidrRouteDest data
      */
-    if ((NULL == tbl_idx->inetCidrRouteDest) ||
-        (tbl_idx->inetCidrRouteDest_len <
-         (inetCidrRouteDest_val_ptr_len))) {
+    if (tbl_idx->inetCidrRouteDest_len < (inetCidrRouteDest_val_ptr_len)) {
         snmp_log(LOG_ERR, "not enough space for value\n");
         return MFD_ERROR;
     }
@@ -419,9 +417,7 @@ inetCidrRouteTable_indexes_set_tbl_idx(i
     /*
      * make sure there is enough space for inetCidrRoutePolicy data
      */
-    if (tbl_idx->inetCidrRoutePolicy == NULL ||
-        inetCidrRoutePolicy_val_ptr_len >
-        tbl_idx->inetCidrRoutePolicy_len *
+    if (inetCidrRoutePolicy_val_ptr_len > tbl_idx->inetCidrRoutePolicy_len *
         sizeof(inetCidrRoutePolicy_val_ptr[0])) {
         snmp_log(LOG_ERR,
 	    "inetCidrRoutePolicy: Not enough space for value (%d < %d)\n",
@@ -451,9 +447,8 @@ inetCidrRouteTable_indexes_set_tbl_idx(i
     /*
      * make sure there is enough space for inetCidrRouteNextHop data
      */
-    if ((NULL == tbl_idx->inetCidrRouteNextHop) ||
-        (tbl_idx->inetCidrRouteNextHop_len <
-         (inetCidrRouteNextHop_val_ptr_len / sizeof(inetCidrRouteNextHop_val_ptr[0])))) {
+    if (tbl_idx->inetCidrRouteNextHop_len < (inetCidrRouteNextHop_val_ptr_len /
+          sizeof(inetCidrRouteNextHop_val_ptr[0]))) {
         snmp_log(LOG_ERR,
 	    "inetCidrRouteNexthop: Not enough space for value (%d < %d)\n",
 	    (int)tbl_idx->inetCidrRouteNextHop_len,
diff -urpN net-snmp-5.8/agent/mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_data_access.c net-snmp-5.9.1/agent/mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_data_access.c
--- net-snmp-5.8/agent/mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_data_access.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_data_access.c	2021-05-26 05:19:35.000000000 +0700
@@ -262,12 +262,13 @@ inetCidrRouteTable_container_load(netsnm
     route_container =
         netsnmp_access_route_container_load(NULL,
                                             NETSNMP_ACCESS_ROUTE_LOAD_NOFLAGS);
-    DEBUGMSGT(("verbose:inetCidrRouteTable:inetCidrRouteTable_cache_load",
-               "%d records\n", (int)CONTAINER_SIZE(route_container)));
 
     if (NULL == route_container)
         return MFD_RESOURCE_UNAVAILABLE;        /* msg already logged */
 
+    DEBUGMSGT(("verbose:inetCidrRouteTable:inetCidrRouteTable_cache_load",
+               "%d records\n", (int)CONTAINER_SIZE(route_container)));
+
     /*
      * we just got a fresh copy of route data. snarf data
      */
diff -urpN net-snmp-5.8/agent/mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_interface.c net-snmp-5.9.1/agent/mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_interface.c
--- net-snmp-5.8/agent/mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-forward-mib/inetCidrRouteTable/inetCidrRouteTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,16 +47,16 @@
 
 #include <ctype.h>
 
-netsnmp_feature_child_of(inetCidrRouteTable_external_access, libnetsnmpmibs)
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(table_container_row_insert)
-netsnmp_feature_require(check_all_requests_error)
-
-netsnmp_feature_child_of(inetCidrRouteTable_container_size, inetCidrRouteTable_external_access)
-netsnmp_feature_child_of(inetCidrRouteTable_registration_set, inetCidrRouteTable_external_access)
-netsnmp_feature_child_of(inetCidrRouteTable_registration_get, inetCidrRouteTable_external_access)
-netsnmp_feature_child_of(inetCidrRouteTable_container_get, inetCidrRouteTable_external_access)
+netsnmp_feature_child_of(inetCidrRouteTable_external_access, libnetsnmpmibs);
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(table_container_row_insert);
+netsnmp_feature_require(check_all_requests_error);
+
+netsnmp_feature_child_of(inetCidrRouteTable_container_size, inetCidrRouteTable_external_access);
+netsnmp_feature_child_of(inetCidrRouteTable_registration_set, inetCidrRouteTable_external_access);
+netsnmp_feature_child_of(inetCidrRouteTable_registration_get, inetCidrRouteTable_external_access);
+netsnmp_feature_child_of(inetCidrRouteTable_container_get, inetCidrRouteTable_external_access);
 /**********************************************************************
  **********************************************************************
  ***
@@ -1238,10 +1238,8 @@ _inetCidrRouteTable_check_indexes(inetCi
     /*
      * check defined range(s). 
      */
-    if ((SNMPERR_SUCCESS == rc)
-        && ((rowreq_ctx->tbl_idx.inetCidrRouteDest_len < 0)
-            || (rowreq_ctx->tbl_idx.inetCidrRouteDest_len > 255))
-        ) {
+    if (rc == SNMPERR_SUCCESS &&
+        rowreq_ctx->tbl_idx.inetCidrRouteDest_len > 255) {
         rc = SNMP_ERR_WRONGLENGTH;
     }
     if (MFD_SUCCESS != rc)
@@ -1256,10 +1254,8 @@ _inetCidrRouteTable_check_indexes(inetCi
     /*
      * check defined range(s). 
      */
-    if ((SNMPERR_SUCCESS == rc)
-        && ((rowreq_ctx->tbl_idx.inetCidrRoutePfxLen < 0)
-            || (rowreq_ctx->tbl_idx.inetCidrRoutePfxLen > 2040))
-        ) {
+    if (rc == SNMPERR_SUCCESS &&
+        rowreq_ctx->tbl_idx.inetCidrRoutePfxLen > 2040) {
         rc = SNMP_ERR_WRONGVALUE;
     }
     if (MFD_SUCCESS != rc)
@@ -1311,10 +1307,8 @@ _inetCidrRouteTable_check_indexes(inetCi
     /*
      * check defined range(s). 
      */
-    if ((SNMPERR_SUCCESS == rc)
-        && ((rowreq_ctx->tbl_idx.inetCidrRouteNextHop_len < 0)
-            || (rowreq_ctx->tbl_idx.inetCidrRouteNextHop_len > 255))
-        ) {
+    if (rc == SNMPERR_SUCCESS &&
+        rowreq_ctx->tbl_idx.inetCidrRouteNextHop_len > 255) {
         rc = SNMP_ERR_WRONGLENGTH;
     }
     if (MFD_SUCCESS != rc)
diff -urpN net-snmp-5.8/agent/mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_interface.c net-snmp-5.9.1/agent/mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_interface.c
--- net-snmp-5.8/agent/mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-forward-mib/ipCidrRouteTable/ipCidrRouteTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,17 +47,17 @@
 
 #include <ctype.h>
 
-netsnmp_feature_child_of(ipCidrRouteTable_external_access, libnetsnmpmibs)
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(table_container_row_insert)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_child_of(ipCidrRouteTable_external_access, libnetsnmpmibs);
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(table_container_row_insert);
+netsnmp_feature_require(check_all_requests_error);
 
 
-netsnmp_feature_child_of(ipCidrRouteTable_container_size, ipCidrRouteTable_external_access)
-netsnmp_feature_child_of(ipCidrRouteTable_registration_set, ipCidrRouteTable_external_access)
-netsnmp_feature_child_of(ipCidrRouteTable_registration_get, ipCidrRouteTable_external_access)
-netsnmp_feature_child_of(ipCidrRouteTable_container_get, ipCidrRouteTable_external_access)
+netsnmp_feature_child_of(ipCidrRouteTable_container_size, ipCidrRouteTable_external_access);
+netsnmp_feature_child_of(ipCidrRouteTable_registration_set, ipCidrRouteTable_external_access);
+netsnmp_feature_child_of(ipCidrRouteTable_registration_get, ipCidrRouteTable_external_access);
+netsnmp_feature_child_of(ipCidrRouteTable_container_get, ipCidrRouteTable_external_access);
 /**********************************************************************
  **********************************************************************
  ***
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/data_access/arp_netlink.c net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/arp_netlink.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/data_access/arp_netlink.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/arp_netlink.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,6 +1,7 @@
 /*
  *  Interface MIB architecture support
  */
+
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-includes.h>
 
@@ -9,7 +10,11 @@
 #include <net-snmp/data_access/interface.h>
 
 #include <errno.h>
+#include <stdint.h>
 #include <sys/types.h>
+#if HAVE_UNISTD_H
+#include <unistd.h>
+#endif
 #include <linux/types.h>
 #include <linux/rtnetlink.h>
 
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/data_access/defaultrouter_solaris2.c net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/defaultrouter_solaris2.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/data_access/defaultrouter_solaris2.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/defaultrouter_solaris2.c	2021-05-26 05:19:35.000000000 +0700
@@ -9,6 +9,7 @@
 
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 #include <net-snmp/data_access/defaultrouter.h>
+#include <net-snmp/data_access/interface.h>
 
 #include "ip-mib/ipDefaultRouterTable/ipDefaultRouterTable.h"
 #include "defaultrouter_private.h"
@@ -137,6 +138,5 @@ _load_defaultrouter_from_mib2(netsnmp_co
         }
     }
 
-out:
     return 0;
 }
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/data_access/defaultrouter_sysctl.c net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/defaultrouter_sysctl.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/data_access/defaultrouter_sysctl.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/defaultrouter_sysctl.c	2021-05-26 05:19:35.000000000 +0700
@@ -163,7 +163,7 @@ _load_defaultrouter_from_sysctl(netsnmp_
     lim = buf + needed;
     for (next = buf; next < lim; next += rtm->rtm_msglen) {
 #ifdef NETSNMP_ENABLE_IPV6
-	struct in6_addr in6addr_any = IN6ADDR_ANY_INIT;
+	struct in6_addr in6addr_any = { } /*IN6ADDR_ANY_INIT*/;
 #endif
 
         rtm = (struct rt_msghdr *)next;
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/data_access/ipaddress_common.c net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/ipaddress_common.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/data_access/ipaddress_common.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/ipaddress_common.c	2021-05-26 05:19:35.000000000 +0700
@@ -16,15 +16,15 @@
 
 #include <net-snmp/net-snmp-features.h>
 
-netsnmp_feature_child_of(ipaddress_common, libnetsnmpmibs)
+netsnmp_feature_child_of(ipaddress_common, libnetsnmpmibs);
 
-netsnmp_feature_child_of(ipaddress_common_copy_utilities, ipaddress_common)
-netsnmp_feature_child_of(ipaddress_entry_copy, ipaddress_common)
-netsnmp_feature_child_of(ipaddress_entry_update, ipaddress_common)
-netsnmp_feature_child_of(ipaddress_prefix_copy, ipaddress_common_copy_utilities)
+netsnmp_feature_child_of(ipaddress_common_copy_utilities, ipaddress_common);
+netsnmp_feature_child_of(ipaddress_entry_copy, ipaddress_common);
+netsnmp_feature_child_of(ipaddress_entry_update, ipaddress_common);
+netsnmp_feature_child_of(ipaddress_prefix_copy, ipaddress_common_copy_utilities);
 
 #ifdef NETSNMP_FEATURE_REQUIRE_IPADDRESS_ENTRY_COPY
-netsnmp_feature_require(ipaddress_arch_entry_copy)
+netsnmp_feature_require(ipaddress_arch_entry_copy);
 #endif /* NETSNMP_FEATURE_REQUIRE_IPADDRESS_ENTRY_COPY */
 
 /**---------------------------------------------------------------------*/
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/data_access/ipaddress_ioctl.c net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/ipaddress_ioctl.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/data_access/ipaddress_ioctl.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/ipaddress_ioctl.c	2021-05-26 05:19:35.000000000 +0700
@@ -21,7 +21,7 @@
 
 #include "ipaddress_ioctl.h"
 
-netsnmp_feature_child_of(ipadress_ioctl_entry_copy, ipaddress_common)
+netsnmp_feature_child_of(ipadress_ioctl_entry_copy, ipaddress_common);
 
 static void _print_flags(short flags);
 
@@ -172,6 +172,12 @@ _netsnmp_ioctl_ipaddress_container_load_
             continue;
         }
 
+        if (!netsnmp_access_interface_include(ifrp->ifr_name))
+            continue;
+
+	if (netsnmp_access_interface_max_reached(ifrp->ifr_name))
+            /* we may need to stop tracking ifaces if a max was set */
+            continue;
         /*
          */
         entry = netsnmp_access_ipaddress_entry_create();
@@ -279,6 +285,7 @@ _netsnmp_ioctl_ipaddress_container_load_
         if (ioctl(sd, SIOCGIFFLAGS, ifrp) < 0) {
             snmp_log(LOG_ERR,
                      "error getting if_flags for interface %d\n", i);
+            netsnmp_access_ipaddress_entry_free(bcastentry);
             netsnmp_access_ipaddress_entry_free(entry);
             continue;
         }
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/data_access/ipaddress_ioctl.h net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/ipaddress_ioctl.h
--- net-snmp-5.8/agent/mibgroup/ip-mib/data_access/ipaddress_ioctl.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/ipaddress_ioctl.h	2021-05-26 05:19:35.000000000 +0700
@@ -2,6 +2,8 @@
 extern          "C" {
 #endif
 
+struct netsnmp_ipaddress_s;
+
 /*
  * struct for netlink extras
  */
@@ -17,14 +19,14 @@ int
 _netsnmp_ioctl_ipaddress_container_load_v4(netsnmp_container *container,
                                                   int idx_offset);
 int
-_netsnmp_ioctl_ipaddress_set_v4(netsnmp_ipaddress_entry * entry);
+_netsnmp_ioctl_ipaddress_set_v4(struct netsnmp_ipaddress_s * entry);
 int
-_netsnmp_ioctl_ipaddress_remove_v4(netsnmp_ipaddress_entry * entry);
+_netsnmp_ioctl_ipaddress_remove_v4(struct netsnmp_ipaddress_s * entry);
 
 int
-_netsnmp_ioctl_ipaddress_set_v6(netsnmp_ipaddress_entry * entry);
+_netsnmp_ioctl_ipaddress_set_v6(struct netsnmp_ipaddress_s * entry);
 int
-_netsnmp_ioctl_ipaddress_remove_v6(netsnmp_ipaddress_entry * entry);
+_netsnmp_ioctl_ipaddress_remove_v6(struct netsnmp_ipaddress_s * entry);
 
 int
 netsnmp_access_ipaddress_ioctl_get_interface_count(int sd, struct ifconf * ifc);
@@ -43,20 +45,20 @@ typedef struct _ioctl_extras {
 
 
 _ioctl_extras *
-netsnmp_ioctl_ipaddress_entry_init(netsnmp_ipaddress_entry *entry);
+netsnmp_ioctl_ipaddress_entry_init(struct netsnmp_ipaddress_s *entry);
 void
-netsnmp_ioctl_ipaddress_entry_cleanup(netsnmp_ipaddress_entry *entry);
+netsnmp_ioctl_ipaddress_entry_cleanup(struct netsnmp_ipaddress_s *entry);
 int
-netsnmp_ioctl_ipaddress_entry_copy(netsnmp_ipaddress_entry *lhs,
-                                   netsnmp_ipaddress_entry *rhs);
+netsnmp_ioctl_ipaddress_entry_copy(struct netsnmp_ipaddress_s *lhs,
+                                   struct netsnmp_ipaddress_s *rhs);
 
 _ioctl_extras *
-netsnmp_ioctl_ipaddress_extras_get(netsnmp_ipaddress_entry *entry);
+netsnmp_ioctl_ipaddress_extras_get(struct netsnmp_ipaddress_s *entry);
 
 int
-_netsnmp_ioctl_ipaddress_delete_v4(netsnmp_ipaddress_entry * entry);
+_netsnmp_ioctl_ipaddress_delete_v4(struct netsnmp_ipaddress_s * entry);
 int
-_netsnmp_ioctl_ipaddress_delete_v6(netsnmp_ipaddress_entry * entry);
+_netsnmp_ioctl_ipaddress_delete_v6(struct netsnmp_ipaddress_s * entry);
 
 #ifdef __cplusplus
 }
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/data_access/ipaddress_linux.c net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/ipaddress_linux.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/data_access/ipaddress_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/ipaddress_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -19,14 +19,15 @@
 
 #include <errno.h>
 #include <sys/ioctl.h>
+#include <sys/stat.h>
 
-netsnmp_feature_require(prefix_info)
-netsnmp_feature_require(find_prefix_info)
+netsnmp_feature_require(prefix_info);
+netsnmp_feature_require(find_prefix_info);
 
-netsnmp_feature_child_of(ipaddress_arch_entry_copy, ipaddress_common)
+netsnmp_feature_child_of(ipaddress_arch_entry_copy, ipaddress_common);
 
 #ifdef NETSNMP_FEATURE_REQUIRE_IPADDRESS_ARCH_ENTRY_COPY
-netsnmp_feature_require(ipaddress_ioctl_entry_copy)
+netsnmp_feature_require(ipaddress_ioctl_entry_copy);
 #endif /* NETSNMP_FEATURE_REQUIRE_IPADDRESS_ARCH_ENTRY_COPY */
 
 #if defined (NETSNMP_ENABLE_IPV6)
@@ -234,7 +235,18 @@ _load_v6(netsnmp_container *container, i
 
 #define PROCFILE "/proc/net/if_inet6"
     if (!(in = fopen(PROCFILE, "r"))) {
-        snmp_log_perror("ipaddress_linux: could not open " PROCFILE);
+        /*
+         * If opening /proc/net/if_inet6 fails, only complain if that file
+         * does not exist. If it exists but if it is not readable, do not
+         * log an error message because this probably is the result of IPv6
+         * support having been disabled intentionally.
+         */
+        struct stat st;
+
+        if (stat(PROCFILE, &st) == 0) {
+            NETSNMP_LOGONCE((LOG_ERR,
+                             "ipaddress_linux: could not open " PROCFILE));
+        }
         return -2;
     }
 
@@ -262,6 +274,13 @@ _load_v6(netsnmp_container *container, i
         DEBUGMSGTL(("access:ipaddress:container",
                     "addr %s, index %d, pfx %d, scope %d, flags 0x%X, name %s\n",
                     addr, if_index, pfx_len, scope, flags, if_name));
+
+        if (!netsnmp_access_interface_include(if_name))
+            continue;
+
+	if (netsnmp_access_interface_max_reached(if_name))
+            /* we may need to stop tracking ifaces if a max was set */
+            continue;
         /*
          */
         entry = netsnmp_access_ipaddress_entry_create();
@@ -527,6 +546,8 @@ netsnmp_access_ipaddress_extra_prefix_in
     int                  rtattrlen;
     int                  sd;
     int                  reqaddr = 0;
+    int                  ret = -1;
+
     sd = socket(PF_NETLINK, SOCK_DGRAM, NETLINK_ROUTE);
     if(sd < 0) {
        snmp_log(LOG_ERR, "could not open netlink socket\n");
@@ -543,16 +564,16 @@ netsnmp_access_ipaddress_extra_prefix_in
     status = send (sd, &req, req.nlhdr.nlmsg_len, 0);
     if (status < 0) {
         snmp_log(LOG_ERR, "could not send netlink request\n");
-        return -1;
+        goto out;
     }
     status = recv (sd, buf, sizeof(buf), 0);
     if (status < 0) {
         snmp_log (LOG_ERR, "could not recieve netlink request\n");
-        return -1;
+        goto out;
     }
     if (status == 0) {
        snmp_log (LOG_ERR, "nothing to read\n");
-       return -1;
+       goto out;
     }
     for (nlmp = (struct nlmsghdr *)buf; status > sizeof(*nlmp); ){
 
@@ -561,12 +582,12 @@ netsnmp_access_ipaddress_extra_prefix_in
 
         if (req_len < 0 || len > status) {
             snmp_log (LOG_ERR, "invalid netlink message\n");
-            return -1;
+            goto out;
         }
 
         if (!NLMSG_OK (nlmp, status)) {
             snmp_log (LOG_ERR, "invalid NLMSG message\n");
-            return -1;
+            goto out;
         }
         rtmp = (struct ifaddrmsg *)NLMSG_DATA(nlmp);
         rtatp = (struct rtattr *)IFA_RTA(rtmp);
@@ -594,8 +615,11 @@ netsnmp_access_ipaddress_extra_prefix_in
         status -= NLMSG_ALIGN(len);
         nlmp = (struct nlmsghdr*)((char*)nlmp + NLMSG_ALIGN(len));
     }
+    ret = 0;
+
+out:
     close(sd);
-    return 0;
+    return ret;
 }
 #endif
 #endif
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/data_access/ipaddress_solaris2.c net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/ipaddress_solaris2.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/data_access/ipaddress_solaris2.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/ipaddress_solaris2.c	2021-05-26 05:19:35.000000000 +0700
@@ -16,7 +16,7 @@
 #include "kernel_sunos5.h"
 #include "mibII/mibII_common.h"
 
-netsnmp_feature_child_of(ipaddress_arch_entry_copy, ipaddress_common)
+netsnmp_feature_child_of(ipaddress_arch_entry_copy, ipaddress_common);
 
 static int _load_v4(netsnmp_container *container, int idx_offset);
 #if defined( NETSNMP_ENABLE_IPV6 )
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/data_access/ipaddress_sysctl.c net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/ipaddress_sysctl.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/data_access/ipaddress_sysctl.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/ipaddress_sysctl.c	2021-05-26 05:19:35.000000000 +0700
@@ -20,13 +20,13 @@
 #include <sys/ioctl.h>
 #include <arpa/inet.h>
 
-netsnmp_feature_require(prefix_info)
-netsnmp_feature_require(find_prefix_info)
+netsnmp_feature_require(prefix_info);
+netsnmp_feature_require(find_prefix_info);
 
-netsnmp_feature_child_of(ipaddress_arch_entry_copy, ipaddress_common)
+netsnmp_feature_child_of(ipaddress_arch_entry_copy, ipaddress_common);
 
 #ifdef NETSNMP_FEATURE_REQUIRE_IPADDRESS_ARCH_ENTRY_COPY
-netsnmp_feature_require(ipaddress_ioctl_entry_copy)
+netsnmp_feature_require(ipaddress_ioctl_entry_copy);
 #endif /* NETSNMP_FEATURE_REQUIRE_IPADDRESS_ARCH_ENTRY_COPY */
 
 #include "ipaddress_ioctl.h"
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/data_access/scalars_linux.c net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/scalars_linux.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/data_access/scalars_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/scalars_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -9,7 +9,7 @@
 
 #include <net-snmp/data_access/ip_scalars.h>
 
-netsnmp_feature_require(register_num_file_instance)
+netsnmp_feature_require(register_num_file_instance);
 
 static const char ipfw_name[] = "/proc/sys/net/ipv4/conf/all/forwarding";
 static const char ipttl_name[] = "/proc/sys/net/ipv4/ip_default_ttl";
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/data_access/systemstats_linux.c net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/systemstats_linux.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/data_access/systemstats_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/systemstats_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -14,6 +14,7 @@
 #include "systemstats.h"
 #include "systemstats_private.h"
 
+#include <stdint.h>
 #include <sys/types.h>
 #include <dirent.h>
 #include <ctype.h>
@@ -123,7 +124,7 @@ _systemstats_v4(netsnmp_container* conta
     /*
      * skip header, but make sure it's the length we expect...
      */
-    fgets(line, sizeof(line), devin);
+    NETSNMP_IGNORE_RESULT(fgets(line, sizeof(line), devin));
     len = strlen(line);
     if (224 != len) {
         fclose(devin);
@@ -560,10 +561,12 @@ _systemstats_v6_load_systemstats(netsnmp
      * try to open file. If we can't, that's ok - maybe the module hasn't
      * been loaded yet.
      */
-    if (!(devin = fopen(filename, "r"))) {
+    devin = fopen(filename, "r");
+    if (!devin) {
         DEBUGMSGTL(("access:systemstats",
                 "Failed to load Systemstats Table (linux1), cannot open %s\n",
                 filename));
+        netsnmp_access_systemstats_entry_free(entry);
         return 0;
     }
     
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/data_access/systemstats_sysctl.c net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/systemstats_sysctl.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/data_access/systemstats_sysctl.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/data_access/systemstats_sysctl.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,14 +13,6 @@
 #include "../ipSystemStatsTable/ipSystemStatsTable.h"
 #include "systemstats_private.h"
 
-#if defined(NETSNMP_IFNET_NEEDS_KERNEL) && !defined(_KERNEL)
-#define _KERNEL 1
-#define _I_DEFINED_KERNEL
-#endif
-#if NETSNMP_IFNET_NEEDS_KERNEL_STRUCTURES
-#define _KERNEL_STRUCTURES
-#endif
-
 #include <sys/types.h>
 #include <dirent.h>
 #include <ctype.h>
@@ -29,12 +21,25 @@
 #include <sys/sysctl.h>
 #include <sys/protosw.h>
 
+#if defined(NETSNMP_IFNET_NEEDS_KERNEL) && !defined(_KERNEL)
+#define _KERNEL 1
+#define _I_DEFINED_KERNEL
+#endif
+#if NETSNMP_IFNET_NEEDS_KERNEL_STRUCTURES
+#define _KERNEL_STRUCTURES
+#endif
 #include <net/if.h>
+#ifdef _I_DEFINED_KERNEL
+#undef _KERNEL
+#endif
 #include <netinet/in.h>
 #include <netinet/in_systm.h>
 #include <netinet/ip.h>
 #include <netinet/ip_icmp.h>
 #include <netinet/ip_var.h>
+#if HAVE_NETINET_ICMP6_H
+#include <netinet/icmp6.h>
+#endif
 #if HAVE_NETINET6_IP6_VAR_H
 #include <sys/queue.h>
 #include <netinet6/ip6_var.h>
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_data_access.c net-snmp-5.9.1/agent/mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_data_access.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_data_access.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_data_access.c	2021-05-26 05:19:35.000000000 +0700
@@ -20,7 +20,7 @@
 
 #include "inetNetToMediaTable_data_access.h"
 
-netsnmp_feature_require(container_lifo)
+netsnmp_feature_require(container_lifo);
 static netsnmp_arp_access * arp_access = NULL;
 
 /** @ingroup interface 
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_interface.c net-snmp-5.9.1/agent/mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_interface.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/inetNetToMediaTable/inetNetToMediaTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,18 +47,18 @@
 
 #include <ctype.h>
 
-netsnmp_feature_child_of(inetNetToMediaTable_external_access, libnetsnmpmibs)
+netsnmp_feature_child_of(inetNetToMediaTable_external_access, libnetsnmpmibs);
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(table_container_row_insert)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(table_container_row_insert);
+netsnmp_feature_require(check_all_requests_error);
 
 
-netsnmp_feature_child_of(inetNetToMediaTable_container_size, inetNetToMediaTable_external_access)
-netsnmp_feature_child_of(inetNetToMediaTable_registration_set, inetNetToMediaTable_external_access)
-netsnmp_feature_child_of(inetNetToMediaTable_registration_get, inetNetToMediaTable_external_access)
-netsnmp_feature_child_of(inetNetToMediaTable_container_get, inetNetToMediaTable_external_access)
+netsnmp_feature_child_of(inetNetToMediaTable_container_size, inetNetToMediaTable_external_access);
+netsnmp_feature_child_of(inetNetToMediaTable_registration_set, inetNetToMediaTable_external_access);
+netsnmp_feature_child_of(inetNetToMediaTable_registration_get, inetNetToMediaTable_external_access);
+netsnmp_feature_child_of(inetNetToMediaTable_container_get, inetNetToMediaTable_external_access);
 
 /**********************************************************************
  **********************************************************************
@@ -1101,10 +1101,8 @@ _inetNetToMediaTable_check_indexes(inetN
     /*
      * check defined range(s). 
      */
-    if ((SNMPERR_SUCCESS == rc)
-        && ((rowreq_ctx->tbl_idx.inetNetToMediaNetAddress_len < 0)
-            || (rowreq_ctx->tbl_idx.inetNetToMediaNetAddress_len > 255))
-        ) {
+    if (rc == SNMPERR_SUCCESS &&
+        rowreq_ctx->tbl_idx.inetNetToMediaNetAddress_len > 255) {
         rc = SNMP_ERR_WRONGLENGTH;
     }
     if (MFD_SUCCESS != rc)
@@ -1175,9 +1173,7 @@ _inetNetToMediaTable_check_column(inetNe
         /*
          * check defined range(s). 
          */
-        if ((SNMPERR_SUCCESS == rc)
-            && ((var->val_len < 0) || (var->val_len > 65535))
-            ) {
+        if (rc == SNMPERR_SUCCESS && var->val_len > 65535) {
             rc = SNMP_ERR_WRONGLENGTH;
         }
         if (SNMPERR_SUCCESS != rc) {
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipAddressPrefixTable/ipAddressPrefixTable.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipAddressPrefixTable/ipAddressPrefixTable.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipAddressPrefixTable/ipAddressPrefixTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipAddressPrefixTable/ipAddressPrefixTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -280,9 +280,8 @@ ipAddressPrefixTable_indexes_set_tbl_idx
     /*
      * make sure there is enough space for ipAddressPrefixPrefix data
      */
-    if ((NULL == tbl_idx->ipAddressPrefixPrefix) ||
-        (tbl_idx->ipAddressPrefixPrefix_len <
-         (ipAddressPrefixPrefix_val_ptr_len))) {
+    if (tbl_idx->ipAddressPrefixPrefix_len <
+        ipAddressPrefixPrefix_val_ptr_len) {
         snmp_log(LOG_ERR, "not enough space for value\n");
         return MFD_ERROR;
     }
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipAddressPrefixTable/ipAddressPrefixTable_data_access.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipAddressPrefixTable/ipAddressPrefixTable_data_access.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipAddressPrefixTable/ipAddressPrefixTable_data_access.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipAddressPrefixTable/ipAddressPrefixTable_data_access.c	2021-05-26 05:19:35.000000000 +0700
@@ -22,9 +22,9 @@
 
 #include "ip-mib/ipAddressTable/ipAddressTable.h"
 
-netsnmp_feature_require(ipAddressTable_container_get)
-netsnmp_feature_require(ipaddress_common_copy_utilities)
-netsnmp_feature_require(ipaddress_prefix_copy)
+netsnmp_feature_require(ipAddressTable_container_get);
+netsnmp_feature_require(ipaddress_common_copy_utilities);
+netsnmp_feature_require(ipaddress_prefix_copy);
 
 /** @ingroup interface 
  * @addtogroup data_access data_access: Routines to access data
@@ -246,6 +246,7 @@ ipAddressPrefixTable_container_load(nets
             rowreq_ctx = ipAddressPrefixTable_allocate_rowreq_ctx(NULL);
             if (NULL == rowreq_ctx) {
                 snmp_log(LOG_ERR, "memory allocation failed\n");
+                ITERATOR_RELEASE(addr_it);
                 return MFD_RESOURCE_UNAVAILABLE;
             }
         }
@@ -300,7 +301,7 @@ ipAddressPrefixTable_container_load(nets
          * TODO:352:r: |   |-> populate ipAddressPrefixTable data context.
          * Populate data context here. (optionally, delay until row prep)
          */
-           netsnmp_ipaddress_prefix_origin_copy(&rowreq_ctx->data.
+        netsnmp_ipaddress_prefix_origin_copy(&rowreq_ctx->data.
                                              ipAddressPrefixOrigin,
                                              addr_rowreq_ctx->data->
                                              ia_origin,
@@ -314,12 +315,21 @@ ipAddressPrefixTable_container_load(nets
         /*
          * insert into table container, clear ptr so we reallocate
          */
-        CONTAINER_INSERT(container, rowreq_ctx);
-        rowreq_ctx = NULL;
-        ++count;
+        if (CONTAINER_INSERT(container, rowreq_ctx) == 0) {
+            rowreq_ctx = NULL;
+            ++count;
+        }
     }
     ITERATOR_RELEASE(addr_it);
 
+    /*
+     * clean up if "do we already have this prefix?" was true and no
+     * CONTAINER_INSERT happened afterwards
+     */
+    if (rowreq_ctx) {
+        ipAddressPrefixTable_release_rowreq_ctx(rowreq_ctx);
+    }
+
     DEBUGMSGT(("verbose:ipAddressPrefixTable:ipAddressPrefixTable_container_load", "inserted %d records\n", count));
 
     return MFD_SUCCESS;
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipAddressPrefixTable/ipAddressPrefixTable_interface.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipAddressPrefixTable/ipAddressPrefixTable_interface.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipAddressPrefixTable/ipAddressPrefixTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipAddressPrefixTable/ipAddressPrefixTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,15 +47,15 @@
 
 #include <ctype.h>
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(check_all_requests_error);
 
-netsnmp_feature_child_of(ipaddressprefixtable_row_find_by_mib_index, ipaddressprefixtable_all)
-netsnmp_feature_child_of(ipaddressprefixtable_container_get, ipaddressprefixtable_all)
-netsnmp_feature_child_of(ipAddressPrefixTable_registration_get, ipaddressprefixtable_all)
-netsnmp_feature_child_of(ipAddressPrefixTable_registration_set, ipaddressprefixtable_all)
-netsnmp_feature_child_of(ipAddressPrefixTable_container_size, ipaddressprefixtable_all)
+netsnmp_feature_child_of(ipaddressprefixtable_row_find_by_mib_index, ipaddressprefixtable_all);
+netsnmp_feature_child_of(ipaddressprefixtable_container_get, ipaddressprefixtable_all);
+netsnmp_feature_child_of(ipAddressPrefixTable_registration_get, ipaddressprefixtable_all);
+netsnmp_feature_child_of(ipAddressPrefixTable_registration_set, ipaddressprefixtable_all);
+netsnmp_feature_child_of(ipAddressPrefixTable_container_size, ipaddressprefixtable_all);
 
 /**********************************************************************
  **********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipAddressTable/ipAddressTable.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipAddressTable/ipAddressTable.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipAddressTable/ipAddressTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipAddressTable/ipAddressTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -29,9 +29,9 @@
 
 #include "ipAddressTable_interface.h"
 
-netsnmp_feature_require(check_storage_transition)
-netsnmp_feature_require(ipaddress_entry_copy)
-netsnmp_feature_require(ipaddress_prefix_copy)
+netsnmp_feature_require(check_storage_transition);
+netsnmp_feature_require(ipaddress_entry_copy);
+netsnmp_feature_require(ipaddress_prefix_copy);
 
 const oid       ipAddressTable_oid[] = { IPADDRESSTABLE_OID };
 const int       ipAddressTable_oid_size = OID_LENGTH(ipAddressTable_oid);
@@ -43,14 +43,15 @@ void            initialize_table_ipAddre
 void            shutdown_table_ipAddressTable(void);
 
 
-/**
- * Initializes the ipAddressTable module
- */
-void
-init_ipAddressTable(void)
+/* Called after the snmpd configuration has been read. */
+static int
+_init_ipAddressTable(int majorID, int minorID, void *serverargs,
+                     void *clientarg)
 {
     DEBUGMSGTL(("verbose:ipAddressTable:init_ipAddressTable", "called\n"));
 
+    netsnmp_access_interface_init();
+
     /*
      * TODO:300:o: Perform ipAddressTable one-time module initialization.
      */
@@ -61,7 +62,19 @@ init_ipAddressTable(void)
     if (should_init("ipAddressTable"))
         initialize_table_ipAddressTable();
 
-}                               /* init_ipAddressTable */
+    return 0;
+}
+
+/**
+ * Initializes the ipAddressTable module
+ */
+void
+init_ipAddressTable(void)
+{
+    snmp_register_callback(SNMP_CALLBACK_LIBRARY,
+                           SNMP_CALLBACK_POST_READ_CONFIG,
+                           _init_ipAddressTable, NULL);
+}
 
 /**
  * Shut-down the ipAddressTable module (agent is exiting)
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipAddressTable/ipAddressTable_data_access.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipAddressTable/ipAddressTable_data_access.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipAddressTable/ipAddressTable_data_access.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipAddressTable/ipAddressTable_data_access.c	2021-05-26 05:19:35.000000000 +0700
@@ -23,8 +23,8 @@
 #include <sys/ioctl.h>
 #include <errno.h>
 
-netsnmp_feature_require(container_lifo)
-netsnmp_feature_require(ipaddress_entry_update)
+netsnmp_feature_require(container_lifo);
+netsnmp_feature_require(ipaddress_entry_update);
 
 /** @ingroup interface 
  * @addtogroup data_access data_access: Routines to access data
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipAddressTable/ipAddressTable_interface.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipAddressTable/ipAddressTable_interface.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipAddressTable/ipAddressTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipAddressTable/ipAddressTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,18 +47,18 @@
 
 #include <ctype.h>
 
-netsnmp_feature_child_of(ipAddressTable_external_access, libnetsnmpmibs)
+netsnmp_feature_child_of(ipAddressTable_external_access, libnetsnmpmibs);
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(table_container_row_insert)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(table_container_row_insert);
+netsnmp_feature_require(check_all_requests_error);
 
 
-netsnmp_feature_child_of(ipAddressTable_container_size, ipAddressTable_external_access)
-netsnmp_feature_child_of(ipAddressTable_registration_set, ipAddressTable_external_access)
-netsnmp_feature_child_of(ipAddressTable_registration_get, ipAddressTable_external_access)
-netsnmp_feature_child_of(ipAddressTable_container_get, ipAddressTable_external_access)
+netsnmp_feature_child_of(ipAddressTable_container_size, ipAddressTable_external_access);
+netsnmp_feature_child_of(ipAddressTable_registration_set, ipAddressTable_external_access);
+netsnmp_feature_child_of(ipAddressTable_registration_get, ipAddressTable_external_access);
+netsnmp_feature_child_of(ipAddressTable_container_get, ipAddressTable_external_access);
 
 /**********************************************************************
  **********************************************************************
@@ -1065,10 +1065,7 @@ _ipAddressTable_check_indexes(ipAddressT
     /*
      * check defined range(s). 
      */
-    if ((SNMPERR_SUCCESS == rc)
-        && ((rowreq_ctx->tbl_idx.ipAddressAddr_len < 0)
-            || (rowreq_ctx->tbl_idx.ipAddressAddr_len > 255))
-        ) {
+    if (rc == SNMPERR_SUCCESS && rowreq_ctx->tbl_idx.ipAddressAddr_len > 255) {
         rc = SNMP_ERR_WRONGLENGTH;
     }
     if (MFD_SUCCESS != rc)
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_data_access.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_data_access.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_data_access.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_data_access.c	2021-05-26 05:19:35.000000000 +0700
@@ -20,7 +20,7 @@
 
 #include "ipDefaultRouterTable_data_access.h"
 
-netsnmp_feature_require(container_lifo)
+netsnmp_feature_require(container_lifo);
 
 /** @ingroup interface
  * @addtogroup data_access data_access: Routines to access data
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_data_get.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_data_get.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_data_get.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_data_get.c	2021-05-26 05:19:35.000000000 +0700
@@ -131,9 +131,8 @@ ipDefaultRouterTable_indexes_set_tbl_idx
     /*
      * make sure there is enough space for ipDefaultRouterAddress data
      */
-    if ((NULL == tbl_idx->ipDefaultRouterAddress) ||
-        (tbl_idx->ipDefaultRouterAddress_len <
-         (ipDefaultRouterAddress_val_ptr_len))) {
+    if (tbl_idx->ipDefaultRouterAddress_len <
+        ipDefaultRouterAddress_val_ptr_len) {
         snmp_log(LOG_ERR, "not enough space for value\n");
         return MFD_ERROR;
     }
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_interface.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_interface.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipDefaultRouterTable/ipDefaultRouterTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,9 +47,9 @@
 
 #include <ctype.h>
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(check_all_requests_error);
 
 /**********************************************************************
  **********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipIfStatsTable/ipIfStatsTable_interface.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipIfStatsTable/ipIfStatsTable_interface.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipIfStatsTable/ipIfStatsTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipIfStatsTable/ipIfStatsTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,17 +47,17 @@
 
 #include <ctype.h>
 
-netsnmp_feature_child_of(ipIfStatsTable_external_access, libnetsnmpmibs)
+netsnmp_feature_child_of(ipIfStatsTable_external_access, libnetsnmpmibs);
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(check_all_requests_error);
 
 
-netsnmp_feature_child_of(ipIfStatsTable_container_size, ipIfStatsTable_external_access)
-netsnmp_feature_child_of(ipIfStatsTable_registration_set, ipIfStatsTable_external_access)
-netsnmp_feature_child_of(ipIfStatsTable_registration_get, ipIfStatsTable_external_access)
-netsnmp_feature_child_of(ipIfStatsTable_container_get, ipIfStatsTable_external_access)
+netsnmp_feature_child_of(ipIfStatsTable_container_size, ipIfStatsTable_external_access);
+netsnmp_feature_child_of(ipIfStatsTable_registration_set, ipIfStatsTable_external_access);
+netsnmp_feature_child_of(ipIfStatsTable_registration_get, ipIfStatsTable_external_access);
+netsnmp_feature_child_of(ipIfStatsTable_container_get, ipIfStatsTable_external_access);
 
 /**********************************************************************
  **********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipSystemStatsTable/ipSystemStatsTable_interface.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipSystemStatsTable/ipSystemStatsTable_interface.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipSystemStatsTable/ipSystemStatsTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipSystemStatsTable/ipSystemStatsTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,17 +47,17 @@
 
 #include <ctype.h>
 
-netsnmp_feature_child_of(ipSystemStatsTable_external_access, libnetsnmpmibs)
+netsnmp_feature_child_of(ipSystemStatsTable_external_access, libnetsnmpmibs);
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(check_all_requests_error);
 
 
-netsnmp_feature_child_of(ipSystemStatsTable_container_size, ipSystemStatsTable_external_access)
-netsnmp_feature_child_of(ipSystemStatsTable_registration_set, ipSystemStatsTable_external_access)
-netsnmp_feature_child_of(ipSystemStatsTable_registration_get, ipSystemStatsTable_external_access)
-netsnmp_feature_child_of(ipSystemStatsTable_container_get, ipSystemStatsTable_external_access)
+netsnmp_feature_child_of(ipSystemStatsTable_container_size, ipSystemStatsTable_external_access);
+netsnmp_feature_child_of(ipSystemStatsTable_registration_set, ipSystemStatsTable_external_access);
+netsnmp_feature_child_of(ipSystemStatsTable_registration_get, ipSystemStatsTable_external_access);
+netsnmp_feature_child_of(ipSystemStatsTable_container_get, ipSystemStatsTable_external_access);
 
 /**********************************************************************
  **********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable_interface.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable_interface.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -49,9 +49,9 @@
 
 #include <ctype.h>
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(check_all_requests_error);
 
 /**********************************************************************
  **********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable_subagent.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable_subagent.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable_subagent.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipv4InterfaceTable/ipv4InterfaceTable_subagent.c	2021-05-26 05:19:35.000000000 +0700
@@ -10,9 +10,9 @@
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
-netsnmp_feature_require(agentx_enable_subagent)
-netsnmp_feature_require(agent_check_and_process)
-netsnmp_feature_require(enable_stderrlog)
+netsnmp_feature_require(agentx_enable_subagent);
+netsnmp_feature_require(agent_check_and_process);
+netsnmp_feature_require(enable_stderrlog);
 
 /*
  * include our parent header 
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable.h net-snmp-5.9.1/agent/mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable.h
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable.h	2021-05-26 05:19:35.000000000 +0700
@@ -105,95 +105,27 @@ config_require(ip-mib/ipv6InterfaceTable
      * function prototypes
      */
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceTable_pre_request(ipv6InterfaceTable_registration *
                                        user_context);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceTable_post_request(ipv6InterfaceTable_registration *
                                         user_context, int rc);
 
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceTable_rowreq_ctx_init(ipv6InterfaceTable_rowreq_ctx *
                                            rowreq_ctx,
                                            void *user_init_ctx);
     void
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceTable_rowreq_ctx_cleanup(ipv6InterfaceTable_rowreq_ctx
                                               * rowreq_ctx);
 
     int             ipv6InterfaceTable_commit(ipv6InterfaceTable_rowreq_ctx
                                               * rowreq_ctx);
-
-         
-         
-         
-         
-         
-         
-        ipv6InterfaceTable_rowreq_ctx
-        * ipv6InterfaceTable_row_find_by_mib_index
+    ipv6InterfaceTable_rowreq_ctx *ipv6InterfaceTable_row_find_by_mib_index
         (ipv6InterfaceTable_mib_index * mib_idx);
 
-    extern const oid      ipv6InterfaceTable_oid[];
-    extern const int      ipv6InterfaceTable_oid_size;
+    extern const oid ipv6InterfaceTable_oid[];
+    extern const int ipv6InterfaceTable_oid_size;
 
 
 #include "ipv6InterfaceTable_interface.h"
@@ -224,123 +156,32 @@ config_require(ip-mib/ipv6InterfaceTable
      */
 
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceReasmMaxSize_get(ipv6InterfaceTable_rowreq_ctx *
                                       rowreq_ctx,
                                       u_long *
                                       ipv6InterfaceReasmMaxSize_val_ptr);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceIdentifier_get(ipv6InterfaceTable_rowreq_ctx *
                                     rowreq_ctx, char
                                     **ipv6InterfaceIdentifier_val_ptr_ptr,
-                                    size_t
-                                    *
+                                    size_t *
                                     ipv6InterfaceIdentifier_val_ptr_len_ptr);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceEnableStatus_get(ipv6InterfaceTable_rowreq_ctx *
                                       rowreq_ctx,
                                       u_long *
                                       ipv6InterfaceEnableStatus_val_ptr);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceReachableTime_get(ipv6InterfaceTable_rowreq_ctx *
                                        rowreq_ctx,
                                        u_long *
                                        ipv6InterfaceReachableTime_val_ptr);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceRetransmitTime_get(ipv6InterfaceTable_rowreq_ctx *
                                         rowreq_ctx,
                                         u_long *
                                         ipv6InterfaceRetransmitTime_val_ptr);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceForwarding_get(ipv6InterfaceTable_rowreq_ctx *
                                     rowreq_ctx,
                                     u_long *
@@ -348,40 +189,10 @@ config_require(ip-mib/ipv6InterfaceTable
 
 
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceTable_indexes_set_tbl_idx(ipv6InterfaceTable_mib_index
                                                * tbl_idx, long
                                                ipv6InterfaceIfIndex_val);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceTable_indexes_set(ipv6InterfaceTable_rowreq_ctx *
                                        rowreq_ctx,
                                        long ipv6InterfaceIfIndex_val);
@@ -412,39 +223,9 @@ config_require(ip-mib/ipv6InterfaceTable
 
 
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceTable_undo_setup(ipv6InterfaceTable_rowreq_ctx *
                                       rowreq_ctx);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceTable_undo_cleanup(ipv6InterfaceTable_rowreq_ctx *
                                         rowreq_ctx);
     int             ipv6InterfaceTable_undo(ipv6InterfaceTable_rowreq_ctx *
@@ -452,503 +233,106 @@ config_require(ip-mib/ipv6InterfaceTable
     int             ipv6InterfaceTable_commit(ipv6InterfaceTable_rowreq_ctx
                                               * rowreq_ctx);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceTable_undo_commit(ipv6InterfaceTable_rowreq_ctx *
                                        rowreq_ctx);
-
-
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceReasmMaxSize_check_value(ipv6InterfaceTable_rowreq_ctx
                                               * rowreq_ctx,
                                               u_long
                                               ipv6InterfaceReasmMaxSize_val);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceReasmMaxSize_undo_setup(ipv6InterfaceTable_rowreq_ctx
                                              * rowreq_ctx);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceReasmMaxSize_set(ipv6InterfaceTable_rowreq_ctx *
                                       rowreq_ctx,
                                       u_long
                                       ipv6InterfaceReasmMaxSize_val);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceReasmMaxSize_undo(ipv6InterfaceTable_rowreq_ctx *
                                        rowreq_ctx);
 
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceIdentifier_check_value(ipv6InterfaceTable_rowreq_ctx *
                                             rowreq_ctx, char
                                             *ipv6InterfaceIdentifier_val_ptr,
                                             size_t
                                             ipv6InterfaceIdentifier_val_ptr_len);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceIdentifier_undo_setup(ipv6InterfaceTable_rowreq_ctx *
                                            rowreq_ctx);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceIdentifier_set(ipv6InterfaceTable_rowreq_ctx *
                                     rowreq_ctx,
                                     char *ipv6InterfaceIdentifier_val_ptr,
                                     size_t
                                     ipv6InterfaceIdentifier_val_ptr_len);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceIdentifier_undo(ipv6InterfaceTable_rowreq_ctx *
                                      rowreq_ctx);
 
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceEnableStatus_check_value(ipv6InterfaceTable_rowreq_ctx
                                               * rowreq_ctx,
                                               u_long
                                               ipv6InterfaceEnableStatus_val);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceEnableStatus_undo_setup(ipv6InterfaceTable_rowreq_ctx
                                              * rowreq_ctx);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceEnableStatus_set(ipv6InterfaceTable_rowreq_ctx *
                                       rowreq_ctx,
                                       u_long
                                       ipv6InterfaceEnableStatus_val);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceEnableStatus_undo(ipv6InterfaceTable_rowreq_ctx *
                                        rowreq_ctx);
-
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceReachableTime_check_value
         (ipv6InterfaceTable_rowreq_ctx * rowreq_ctx,
          u_long ipv6InterfaceReachableTime_val);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceReachableTime_undo_setup(ipv6InterfaceTable_rowreq_ctx
                                               * rowreq_ctx);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceReachableTime_set(ipv6InterfaceTable_rowreq_ctx *
                                        rowreq_ctx,
                                        u_long
                                        ipv6InterfaceReachableTime_val);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceReachableTime_undo(ipv6InterfaceTable_rowreq_ctx *
                                         rowreq_ctx);
-
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceRetransmitTime_check_value
         (ipv6InterfaceTable_rowreq_ctx * rowreq_ctx,
          u_long ipv6InterfaceRetransmitTime_val);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceRetransmitTime_undo_setup
         (ipv6InterfaceTable_rowreq_ctx * rowreq_ctx);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceRetransmitTime_set(ipv6InterfaceTable_rowreq_ctx *
                                         rowreq_ctx,
                                         u_long
                                         ipv6InterfaceRetransmitTime_val);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceRetransmitTime_undo(ipv6InterfaceTable_rowreq_ctx *
                                          rowreq_ctx);
-
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceForwarding_check_value(ipv6InterfaceTable_rowreq_ctx *
                                             rowreq_ctx,
                                             u_long
                                             ipv6InterfaceForwarding_val);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceForwarding_undo_setup(ipv6InterfaceTable_rowreq_ctx *
                                            rowreq_ctx);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceForwarding_set(ipv6InterfaceTable_rowreq_ctx *
                                     rowreq_ctx,
                                     u_long ipv6InterfaceForwarding_val);
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceForwarding_undo(ipv6InterfaceTable_rowreq_ctx *
                                      rowreq_ctx);
-
-
     int
-     
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
-        
         ipv6InterfaceTable_check_dependencies(ipv6InterfaceTable_rowreq_ctx
                                               * ctx);
 
@@ -968,4 +352,3 @@ config_require(ip-mib/ipv6InterfaceTable
 #endif
 #endif                          /* IPV6INTERFACETABLE_H */
 /** @} */
-
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable_interface.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable_interface.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipv6InterfaceTable/ipv6InterfaceTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -49,9 +49,9 @@
 
 #include <ctype.h>
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(check_all_requests_error);
 
 /**********************************************************************
  **********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/ip-mib/ipv6ScopeZoneIndexTable/ipv6ScopeZoneIndexTable_interface.c net-snmp-5.9.1/agent/mibgroup/ip-mib/ipv6ScopeZoneIndexTable/ipv6ScopeZoneIndexTable_interface.c
--- net-snmp-5.8/agent/mibgroup/ip-mib/ipv6ScopeZoneIndexTable/ipv6ScopeZoneIndexTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ip-mib/ipv6ScopeZoneIndexTable/ipv6ScopeZoneIndexTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,18 +47,18 @@
 
 #include <ctype.h>
 
-netsnmp_feature_child_of(ipv6ScopeZoneIndexTable_external_access, libnetsnmpmibs)
+netsnmp_feature_child_of(ipv6ScopeZoneIndexTable_external_access, libnetsnmpmibs);
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(table_container_row_insert)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(table_container_row_insert);
+netsnmp_feature_require(check_all_requests_error);
 
 
-netsnmp_feature_child_of(ipv6ScopeZoneIndexTable_container_size, ipv6ScopeZoneIndexTable_external_access)
-netsnmp_feature_child_of(ipv6ScopeZoneIndexTable_registration_set, ipv6ScopeZoneIndexTable_external_access)
-netsnmp_feature_child_of(ipv6ScopeZoneIndexTable_registration_get, ipv6ScopeZoneIndexTable_external_access)
-netsnmp_feature_child_of(ipv6ScopeZoneIndexTable_container_get, ipv6ScopeZoneIndexTable_external_access)
+netsnmp_feature_child_of(ipv6ScopeZoneIndexTable_container_size, ipv6ScopeZoneIndexTable_external_access);
+netsnmp_feature_child_of(ipv6ScopeZoneIndexTable_registration_set, ipv6ScopeZoneIndexTable_external_access);
+netsnmp_feature_child_of(ipv6ScopeZoneIndexTable_registration_get, ipv6ScopeZoneIndexTable_external_access);
+netsnmp_feature_child_of(ipv6ScopeZoneIndexTable_container_get, ipv6ScopeZoneIndexTable_external_access);
 
 /**********************************************************************
  **********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/kernel_sunos5.c net-snmp-5.9.1/agent/mibgroup/kernel_sunos5.c
--- net-snmp-5.8/agent/mibgroup/kernel_sunos5.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/kernel_sunos5.c	2021-05-26 05:19:35.000000000 +0700
@@ -191,19 +191,17 @@ set_if_info(mib2_ifEntry_t *ifp, unsigne
             int mtu);
 static int get_if_stats(mib2_ifEntry_t *ifp);
 
-#if defined(HAVE_IF_NAMEINDEX) && defined(NETSNMP_INCLUDE_IFTABLE_REWRITES)
+#if defined(HAVE_IF_NAMEINDEX)
 static int _dlpi_open(const char *devname);
 static int _dlpi_get_phys_address(int fd, char *paddr, int maxlen,
                                   int *paddrlen);
 static int _dlpi_get_iftype(int fd, unsigned int *iftype);
 static int _dlpi_attach(int fd, int ppa);
 static int _dlpi_parse_devname(char *devname, int *ppap);
-#endif
-
-
-
+#else
 static int
 Name_cmp(void *, void *);
+#endif
 
 static void
 init_mibcache_element(mibcache * cp);
@@ -305,7 +303,8 @@ getKstatInt(const char *classname, const
     if ((ksc = kstat_fd) == NULL) {
 	goto Return;
     }
-    ks = kstat_lookup(ksc, classname, -1, statname);
+    ks = kstat_lookup(ksc, NETSNMP_REMOVE_CONST(char *, classname),
+                      -1, NETSNMP_REMOVE_CONST(char *, statname));
     if (ks == NULL) {
 	DEBUGMSGTL(("kernel_sunos5", "class %s, stat %s not found\n",
 		classname ? classname : "NULL",
@@ -318,7 +317,7 @@ getKstatInt(const char *classname, const
 		classname ? classname : "NULL", statname ? statname : "NULL"));
 	goto Return;
     }
-    named = kstat_data_lookup(ks, varname);
+    named = kstat_data_lookup(ks, NETSNMP_REMOVE_CONST(char *, varname));
     if (named == NULL) {
 	DEBUGMSGTL(("kernel_sunos5", "no var %s for class %s stat %s\n",
 		varname, classname ? classname : "NULL",
@@ -408,7 +407,8 @@ getKstat(const char *statname, const cha
      * contain all available modules. 
      */
 
-    if ((ks = kstat_lookup(ksc, "unix", 0, "kstat_headers")) == NULL) {
+    if ((ks = kstat_lookup(ksc, NETSNMP_REMOVE_CONST(char *, "unix"),
+                           0, NETSNMP_REMOVE_CONST(char *, "kstat_headers"))) == NULL) {
 	ret = -10;
 	goto Return;        /* kstat errors */
     }
@@ -442,7 +442,8 @@ getKstat(const char *statname, const cha
     /*
      * Get the named statistics 
      */
-    if ((ks = kstat_lookup(ksc, module_name, instance, statname)) == NULL) {
+    if ((ks = kstat_lookup(ksc, module_name, instance,
+                           NETSNMP_REMOVE_CONST(char *, statname))) == NULL) {
 	ret = -10;
 	goto Return;        /* kstat errors */
     }
@@ -563,7 +564,8 @@ getKstatString(const char *statname, con
      * contain all available modules.
      */
 
-    if ((ks = kstat_lookup(ksc, "unix", 0, "kstat_headers")) == NULL) {
+    if ((ks = kstat_lookup(ksc, NETSNMP_REMOVE_CONST(char *, "unix"),
+                           0, NETSNMP_REMOVE_CONST(char *, "kstat_headers"))) == NULL) {
         ret = -10;
         goto Return;        /* kstat errors */
     }
@@ -597,7 +599,8 @@ getKstatString(const char *statname, con
     /*
      * Get the named statistics
      */
-    if ((ks = kstat_lookup(ksc, module_name, instance, statname)) == NULL) {
+    if ((ks = kstat_lookup(ksc, module_name, instance,
+                           NETSNMP_REMOVE_CONST(char *, statname))) == NULL) {
         ret = -10;
         goto Return;        /* kstat errors */
     }
@@ -1024,6 +1027,7 @@ getmib(int groupname, int subgroupname,
 		    break;
 		}
 		strbuf.buf = (char *)*statbuf + (oldsize - strbuf.len);
+		/* fallthrough */
 	    case 0:
 		/* fix buffer to real size & position */
 		strbuf.len += strbuf.buf - (char*)*statbuf;
@@ -1068,11 +1072,10 @@ getmib(int groupname, int subgroupname,
  * to be substituted later if SunSoft decides to extend its mib2 interface.
  */
 
-#if defined(HAVE_IF_NAMEINDEX) && defined(NETSNMP_INCLUDE_IFTABLE_REWRITES)
+#if defined(HAVE_IF_NAMEINDEX)
 
 /*
- * If IFTABLE_REWRITES is enabled, then we will also rely on DLPI to obtain
- * information from the NIC.
+ * Use DLPI to obtain information from the NIC.
  */
 
 /*
@@ -1616,7 +1619,7 @@ getif(mib2_ifEntry_t *ifbuf, size_t size
     close(ifsd);
     return ret;
 }
-#endif /*defined(HAVE_IF_NAMEINDEX)&&defined(NETSNMP_INCLUDE_IFTABLE_REWRITES)*/
+#endif /*defined(HAVE_IF_NAMEINDEX)*/
 
 static void
 set_if_info(mib2_ifEntry_t *ifp, unsigned index, char *name, uint64_t flags,
@@ -1759,7 +1762,7 @@ set_if_info(mib2_ifEntry_t *ifp, unsigne
 static int 
 get_if_stats(mib2_ifEntry_t *ifp)
 {
-    Counter l_tmp;
+    int l_tmp;
     char *name = ifp->ifDescr.o_bytes;
 
     if (strchr(name, ':'))
@@ -1846,6 +1849,7 @@ Get_everything(void *x, void *y)
     return 0;             /* Always TRUE */
 }
 
+#if !defined(HAVE_IF_NAMEINDEX)
 /*
  * Compare name and IP address of the interface to ARP table entry.
  * Needed to obtain the physical address of the interface in getif.
@@ -1866,6 +1870,7 @@ Name_cmp(void *ifrp, void *ep)
 	return 1;
     }
 }
+#endif
 
 /*
  * Try to determine the index of a particular interface. If mfd-rewrites is
diff -urpN net-snmp-5.8/agent/mibgroup/kernel_sunos5.h net-snmp-5.9.1/agent/mibgroup/kernel_sunos5.h
--- net-snmp-5.8/agent/mibgroup/kernel_sunos5.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/kernel_sunos5.h	2021-05-26 05:19:35.000000000 +0700
@@ -126,28 +126,28 @@ typedef struct mibmap {
 typedef unsigned long TimeTicks;
 
 typedef struct mib2_ifEntry {
-    int             ifIndex;    /* ifEntry 1 */
+    unsigned int    ifIndex;    /* ifEntry 1 */
     DeviceName      ifDescr;    /* ifEntry 2 */
-    int             ifType;     /* ifEntry 3 */
-    int             ifMtu;      /* ifEntry 4 */
-    Gauge           ifSpeed;    /* ifEntry 5 */
+    unsigned int    ifType;     /* ifEntry 3 */
+    unsigned int    ifMtu;      /* ifEntry 4 */
+    int             ifSpeed;    /* ifEntry 5 */
     PhysAddress     ifPhysAddress;      /* ifEntry 6 */
-    int             ifAdminStatus;      /* ifEntry 7 */
-    int             ifOperStatus;       /* ifEntry 8 */
+    unsigned int    ifAdminStatus;      /* ifEntry 7 */
+    unsigned int    ifOperStatus;       /* ifEntry 8 */
     TimeTicks       ifLastChange;       /* ifEntry 9 */
-    Counter         ifInOctets; /* ifEntry 10 */
-    Counter         ifInUcastPkts;      /* ifEntry 11 */
-    Counter         ifInNUcastPkts;     /* ifEntry 12 */
-    Counter         ifInDiscards;       /* ifEntry 13 */
-    Counter         ifInErrors; /* ifEntry 14 */
-    Counter         ifInUnknownProtos;  /* ifEntry 15 */
-    Counter         ifOutOctets;        /* ifEntry 16 */
-    Counter         ifOutUcastPkts;     /* ifEntry 17 */
-    Counter         ifOutNUcastPkts;    /* ifEntry 18 */
-    Counter         ifOutDiscards;      /* ifEntry 19 */
-    Counter         ifOutErrors;        /* ifEntry 20 */
+    int             ifInOctets; /* ifEntry 10 */
+    int             ifInUcastPkts;      /* ifEntry 11 */
+    int             ifInNUcastPkts;     /* ifEntry 12 */
+    int             ifInDiscards;       /* ifEntry 13 */
+    int             ifInErrors; /* ifEntry 14 */
+    int             ifInUnknownProtos;  /* ifEntry 15 */
+    int             ifOutOctets;        /* ifEntry 16 */
+    int             ifOutUcastPkts;     /* ifEntry 17 */
+    int             ifOutNUcastPkts;    /* ifEntry 18 */
+    int             ifOutDiscards;      /* ifEntry 19 */
+    int             ifOutErrors;        /* ifEntry 20 */
     Gauge           ifOutQLen;  /* ifEntry 21 */
-    int             ifSpecific; /* ifEntry 22 */
+    unsigned int    ifSpecific; /* ifEntry 22 */
 
     /*
      * Support ifXTable.
@@ -164,7 +164,7 @@ typedef struct mib2_ifEntry {
     /*
      * Counters not part of ifTable or ifXTable
      */
-    Counter         ifCollisions;
+    int             ifCollisions;
     int             flags;           /* interface flags (IFF_*) */
 } mib2_ifEntry_t;
 
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/at.c net-snmp-5.9.1/agent/mibgroup/mibII/at.c
--- net-snmp-5.8/agent/mibgroup/mibII/at.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/at.c	2021-05-26 05:19:35.000000000 +0700
@@ -18,6 +18,9 @@
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 #include "at.h"
+#ifdef solaris2
+#include "kernel_sunos5.h"
+#endif
 
 /*
  * define the structure we're going to ask the agent to register our
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/at.h net-snmp-5.9.1/agent/mibgroup/mibII/at.h
--- net-snmp-5.8/agent/mibgroup/mibII/at.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/at.h	2021-05-26 05:19:35.000000000 +0700
@@ -10,8 +10,6 @@
 #include <net/route.h>
 #endif
 
-config_arch_require(solaris2, kernel_sunos5)
-
      extern void     init_at(void);
      extern FindVarMethod var_atEntry;
 
@@ -49,6 +47,7 @@ int      ARP_Scan_Next(in_addr_t *, char
 #if defined(WIN32) || defined(cygwin)
 config_require(mibII/data_access/at_iphlpapi)
 #elif defined(solaris2)
+config_require(kernel_sunos5)
 config_require(mibII/data_access/at_solaris)
 #elif defined(linux)
 config_require(mibII/data_access/at_linux)
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/data_access/at_iphlpapi.c net-snmp-5.9.1/agent/mibgroup/mibII/data_access/at_iphlpapi.c
--- net-snmp-5.8/agent/mibgroup/mibII/data_access/at_iphlpapi.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/data_access/at_iphlpapi.c	2021-05-26 05:19:35.000000000 +0700
@@ -29,7 +29,7 @@
 
 static WriteMethod write_arp;
 MIB_IPNETROW   *arp_row = NULL;
-int             create_flag = 0;
+static int      create_flag;
 
 u_char         *
 var_atEntry(struct variable *vp,
@@ -280,7 +280,8 @@ write_arp(int action,
                 return SNMP_ERR_WRONGTYPE;
             }
             if (var_val_len != 6) {
-                snmp_log(LOG_ERR, "not correct ipAddress length: %d",
+                snmp_log(LOG_ERR,
+                         "incorrect ipAddress length %" NETSNMP_PRIz "d",
                          var_val_len);
                 return SNMP_ERR_WRONGLENGTH;
             }
@@ -383,8 +384,8 @@ write_arp(int action,
              */
             if (!create_flag) {
                 if ((status = SetIpNetEntry(oldarp_row)) != NO_ERROR) {
-                    snmp_log(LOG_ERR, "Error in case UNDO, status : %lu\n",
-                             status);
+                    snmp_log(LOG_ERR, "Error in case UNDO, status : %u\n",
+                             (unsigned int)status);
                     retval = SNMP_ERR_UNDOFAILED;
                 }
             }
@@ -394,8 +395,8 @@ write_arp(int action,
 
                 if ((status = SetIpNetEntry(arp_row)) != NO_ERROR) {
                     snmp_log(LOG_ERR,
-                             "Error while deleting added row, status : %lu\n",
-                             status);
+                             "Error while deleting added row, status : %u\n",
+                             (unsigned int)status);
                     retval = SNMP_ERR_UNDOFAILED;
                 }
             }
@@ -414,8 +415,8 @@ write_arp(int action,
             if (arp_row->dwPhysAddrLen != 0) {
                 if ((status = CreateIpNetEntry(arp_row)) != NO_ERROR) {
                     snmp_log(LOG_ERR,
-                             "Inside COMMIT: CreateIpNetEntry failed, status %lu\n",
-                             status);
+                             "Inside COMMIT: CreateIpNetEntry failed, status %u\n",
+                             (unsigned int)status);
                     retval = SNMP_ERR_COMMITFAILED;
                 }
             } else {
@@ -431,6 +432,7 @@ write_arp(int action,
              */
             create_flag = 0;
         }
+        /* FALL THROUGH */
 
     case FREE:
         /*
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/data_access/at_linux.c net-snmp-5.9.1/agent/mibgroup/mibII/data_access/at_linux.c
--- net-snmp-5.8/agent/mibgroup/mibII/data_access/at_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/data_access/at_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -62,7 +62,7 @@ ARP_Scan_Init(void)
     /*
      * Get rid of the header line
      */
-    fgets(line, sizeof(line), in);
+    NETSNMP_IGNORE_RESULT(fgets(line, sizeof(line), in));
 
     i = 0;
     while (fgets(line, sizeof(line), in)) {
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/data_access/at_solaris.c net-snmp-5.9.1/agent/mibgroup/mibII/data_access/at_solaris.c
--- net-snmp-5.8/agent/mibgroup/mibII/data_access/at_solaris.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/data_access/at_solaris.c	2021-05-26 05:19:35.000000000 +0700
@@ -33,15 +33,10 @@ AT_Cmp(void *addr, void *ep)
     int             ret = -1;
     oid             index;
 
-#ifdef NETSNMP_INCLUDE_IFTABLE_REWRITES
     mp->ipNetToMediaIfIndex.o_bytes[mp->ipNetToMediaIfIndex.o_length] = '\0';
     index = netsnmp_access_interface_index_find(
                     mp->ipNetToMediaIfIndex.o_bytes);
-#else
-    index = Interface_Index_By_Name(mp->ipNetToMediaIfIndex.o_bytes,
-                                    mp->ipNetToMediaIfIndex.o_length);
-#endif
-    DEBUGMSGTL(("mibII/at", "......... AT_Cmp %lx<>%lx %d<>%d (%.5s)\n",
+    DEBUGMSGTL(("mibII/at", "......... AT_Cmp %lx<>%lx %d<>%" NETSNMP_PRIo "d (%.5s)\n",
                 (unsigned long)mp->ipNetToMediaNetAddress,
                 (unsigned long)((if_ip_t *) addr)->ipAddr,
                 ((if_ip_t *) addr)->ifIdx, index,
@@ -101,15 +96,9 @@ var_atEntry(struct variable * vp,
             (MIB_IP_NET, &entry, sizeof(mib2_ipNetToMediaEntry_t),
              req_type, &AT_Cmp, &NextAddr) != 0)
             break;
-#ifdef NETSNMP_INCLUDE_IFTABLE_REWRITES
         entry.ipNetToMediaIfIndex.o_bytes[entry.ipNetToMediaIfIndex.o_length] = '\0';
         current[AT_IFINDEX_OFF] = netsnmp_access_interface_index_find(
            entry.ipNetToMediaIfIndex.o_bytes);
-#else
-        current[AT_IFINDEX_OFF] =
-           Interface_Index_By_Name(entry.ipNetToMediaIfIndex.o_bytes,
-                                   entry.ipNetToMediaIfIndex.o_length);
-#endif
         if (current[6] == 3) {  /* AT group oid */
             current[AT_IFINDEX_OFF + 1] = 1;
             offset = AT_IFINDEX_OFF + 2;
@@ -152,20 +141,14 @@ var_atEntry(struct variable * vp,
     switch (vp->magic) {
     case IPMEDIAIFINDEX:
         *var_len = sizeof long_return;
-#ifdef NETSNMP_INCLUDE_IFTABLE_REWRITES
         Lowentry.ipNetToMediaIfIndex.o_bytes[
             Lowentry.ipNetToMediaIfIndex.o_length] = '\0';
         long_return = netsnmp_access_interface_index_find(
             Lowentry.ipNetToMediaIfIndex.o_bytes);
-#else
-        long_return = Interface_Index_By_Name(
-            Lowentry.ipNetToMediaIfIndex.o_bytes,
-            Lowentry.ipNetToMediaIfIndex.o_length);
-#endif
         return (u_char *) & long_return;
     case IPMEDIAPHYSADDRESS:
         *var_len = Lowentry.ipNetToMediaPhysAddress.o_length;
-        return Lowentry.ipNetToMediaPhysAddress.o_bytes;
+        return (u_char *) Lowentry.ipNetToMediaPhysAddress.o_bytes;
     case IPMEDIANETADDRESS:
         *var_len = sizeof(addr_ret);
         addr_ret = Lowentry.ipNetToMediaNetAddress;
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/icmp.h net-snmp-5.9.1/agent/mibgroup/mibII/icmp.h
--- net-snmp-5.8/agent/mibgroup/mibII/icmp.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/icmp.h	2021-05-26 05:19:35.000000000 +0700
@@ -5,30 +5,16 @@
 #ifndef _MIBGROUP_ICMP_H
 #define _MIBGROUP_ICMP_H
 
-config_arch_require(solaris2,  kernel_sunos5)
-config_arch_require(linux,     mibII/kernel_linux)
-config_arch_require(freebsd4,  mibII/kernel_sysctl)
-config_arch_require(freebsd5,  mibII/kernel_sysctl)
-config_arch_require(freebsd6,  mibII/kernel_sysctl)
-config_arch_require(freebsd7,  mibII/kernel_sysctl)
-config_arch_require(freebsd8,  mibII/kernel_sysctl)
-config_arch_require(freebsd9,  mibII/kernel_sysctl)
-config_arch_require(freebsd10, mibII/kernel_sysctl)
-config_arch_require(freebsd11, mibII/kernel_sysctl)
-config_arch_require(freebsd12, mibII/kernel_sysctl)
-config_arch_require(netbsd,    mibII/kernel_netbsd)
-config_arch_require(netbsdelf, mibII/kernel_netbsd)
-config_arch_require(openbsd4,  mibII/kernel_sysctl)
-config_arch_require(openbsd5,  mibII/kernel_sysctl)
-config_arch_require(openbsd6,  mibII/kernel_sysctl)
-config_arch_require(dragonfly2, mibII/kernel_sysctl)
-config_arch_require(dragonfly3, mibII/kernel_sysctl)
-config_arch_require(dragonfly4, mibII/kernel_sysctl)
-config_arch_require(dragonfly5, mibII/kernel_sysctl)
-config_arch_require(darwin10,  mibII/kernel_sysctl)
-config_arch_require(darwin11,  mibII/kernel_sysctl)
-config_arch_require(darwin12,  mibII/kernel_sysctl)
-config_arch_require(darwin13,  mibII/kernel_sysctl)
+#if defined(solaris2)
+config_require(kernel_sunos5)
+#elif defined(linux)
+config_require(mibII/kernel_linux)
+#elif defined(freebsd4) || defined(openbsd4) || defined(dragonfly2) || \
+    defined(darwin10)
+config_require(mibII/kernel_sysctl)
+#elif defined(netbsd) || defined(netbsdelf)
+config_require(mibII/kernel_netbsd)
+#endif
 
 #include <net-snmp/agent/cache_handler.h>
 
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/ifTable.h net-snmp-5.9.1/agent/mibgroup/mibII/ifTable.h
--- net-snmp-5.8/agent/mibgroup/mibII/ifTable.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/ifTable.h	2021-05-26 05:19:35.000000000 +0700
@@ -3,8 +3,4 @@
  *
  */
 
-#ifdef NETSNMP_INCLUDE_IFTABLE_REWRITES
 config_require(if-mib/ifTable)
-#else
-config_require(mibII/interfaces)
-#endif
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/interfaces.c net-snmp-5.9.1/agent/mibgroup/mibII/interfaces.c
--- net-snmp-5.8/agent/mibgroup/mibII/interfaces.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/interfaces.c	2021-05-26 05:19:35.000000000 +0700
@@ -22,7 +22,7 @@
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-features.h>
 
-netsnmp_feature_provide(interface_legacy)
+netsnmp_feature_provide(interface_legacy);
 
 #if defined(NETSNMP_IFNET_NEEDS_KERNEL) && !defined(_KERNEL) && !defined(NETSNMP_IFNET_NEEDS_KERNEL_LATE)
 #define _KERNEL 1
@@ -1490,7 +1490,6 @@ Interface_Scan_Init(void)
      *  [               OUT                               ]
      *   byte pkts errs drop fifo colls carrier compressed
      */
-#ifdef SCNuMAX
     uintmax_t       rec_pkt, rec_oct, rec_err, rec_drop;
     uintmax_t       snd_pkt, snd_oct, snd_err, snd_drop, coll;
     const char     *scan_line_2_2 =
@@ -1502,14 +1501,6 @@ Interface_Scan_Init(void)
         "%"   SCNuMAX " %"  SCNuMAX " %*" SCNuMAX " %*" SCNuMAX
         " %*" SCNuMAX " %"  SCNuMAX " %"  SCNuMAX " %*" SCNuMAX
         " %*" SCNuMAX " %"  SCNuMAX;
-#else
-    unsigned long   rec_pkt, rec_oct, rec_err, rec_drop;
-    unsigned long   snd_pkt, snd_oct, snd_err, snd_drop, coll;
-    const char     *scan_line_2_2 =
-        "%lu %lu %lu %lu %*lu %*lu %*lu %*lu %lu %lu %lu %lu %*lu %lu";
-    const char     *scan_line_2_0 =
-        "%lu %lu %*lu %*lu %*lu %lu %lu %*lu %*lu %lu";
-#endif
     const char     *scan_line_to_use;
     struct timeval et;                              /* elapsed time */
 
@@ -2671,6 +2662,11 @@ WriteMethod     writeIfEntry;
 long            admin_status = 0;
 long            oldadmin_status = 0;
 
+void
+Interface_Scan_Init(void)
+{
+}
+
 static int
 header_ifEntry(struct variable *vp,
                oid * name,
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/interfaces.h net-snmp-5.9.1/agent/mibgroup/mibII/interfaces.h
--- net-snmp-5.8/agent/mibgroup/mibII/interfaces.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/interfaces.h	2021-05-26 05:19:35.000000000 +0700
@@ -19,7 +19,10 @@ config_exclude(if-mib/ifTable/ifTable)
 config_require(if-mib/data_access/interface)
 #endif
 
-config_arch_require(solaris2, kernel_sunos5)
+#if defined(solaris2)
+config_require(kernel_sunos5)
+#endif
+
 /*
  * need get_address in var_route for some platforms (USE_SYSCTL_IFLIST).
  * Not sure if that can be translated into a config_arch_require, so be
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/ip.c net-snmp-5.9.1/agent/mibgroup/mibII/ip.c
--- net-snmp-5.8/agent/mibgroup/mibII/ip.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/ip.c	2021-05-26 05:19:35.000000000 +0700
@@ -883,7 +883,7 @@ ip_load(netsnmp_cache *cache, void *vmag
     int             i;
     static int      sname[4] = { CTL_NET, PF_INET, IPPROTO_IP, 0 };
     size_t          len;
-    int             magic = (int) vmagic;
+    int             magic = (uintptr_t) vmagic;
 
     switch (magic) {
     case IPFORWARDING:
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/ip.h net-snmp-5.9.1/agent/mibgroup/mibII/ip.h
--- net-snmp-5.8/agent/mibgroup/mibII/ip.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/ip.h	2021-05-26 05:19:35.000000000 +0700
@@ -8,19 +8,23 @@
 
 
 config_require(mibII/ifTable)
+#if !defined(darwin) || defined(HAVE_STRUCT_IN_IFADDR_IA_SUBNETMASK)
+/*
+ * To do: port mibII/ipAddr and mibII/var_route to Darwin versions that do not
+ * export struct in_ifaddr.
+ */
 config_require(mibII/ipAddr)
-config_require(mibII/at)
 config_require(mibII/var_route mibII/route_write)
+#endif /* !defined(darwin) || defined(HAVE_STRUCT_IN_IFADDR_IA_SUBNETMASK) */
+config_require(mibII/at)
 
-config_arch_require(solaris2,        kernel_sunos5)
-config_arch_require(linux,     mibII/kernel_linux)
-config_arch_require(netbsd,    mibII/kernel_netbsd)
-config_arch_require(netbsd5,   mibII/kernel_netbsd)
-config_arch_require(netbsd6,   mibII/kernel_netbsd)
-config_arch_require(netbsd7,   mibII/kernel_netbsd)
-config_arch_require(netbsd8,   mibII/kernel_netbsd)
-config_arch_require(netbsdelf, mibII/kernel_netbsd)
-config_arch_require(netbsdelf5, mibII/kernel_netbsd)
+#ifdef solaris2
+config_require(kernel_sunos5)
+#elif defined(linux)
+config_require(mibII/kernel_linux)
+#elif defined(netbsd) || defined(netbsdelf)
+config_require(mibII/kernel_netbsd)
+#endif
 
 #include "var_route.h"
 #include "route_write.h"
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/ipAddr.c net-snmp-5.9.1/agent/mibgroup/mibII/ipAddr.c
--- net-snmp-5.8/agent/mibgroup/mibII/ipAddr.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/ipAddr.c	2021-05-26 05:19:35.000000000 +0700
@@ -123,7 +123,7 @@
 #include <winerror.h>
 #endif
 
-netsnmp_feature_require(interface_legacy)
+netsnmp_feature_require(interface_legacy);
 
         /*********************
 	 *
@@ -700,16 +700,10 @@ var_ipAddrEntry(struct variable * vp,
         addr_ret = Lowentry.ipAdEntAddr;
         return (u_char *) & addr_ret;
     case IPADIFINDEX:
-#ifdef NETSNMP_INCLUDE_IFTABLE_REWRITES
         Lowentry.ipAdEntIfIndex.o_bytes[Lowentry.ipAdEntIfIndex.o_length] = '\0';
         long_return =
             netsnmp_access_interface_index_find(Lowentry.
                                                 ipAdEntIfIndex.o_bytes);
-#else
-        long_return =
-           Interface_Index_By_Name(Lowentry.ipAdEntIfIndex.o_bytes,
-                                   Lowentry.ipAdEntIfIndex.o_length);
-#endif
         return (u_char *) & long_return;
     case IPADNETMASK:
 	*var_len = sizeof(addr_ret);
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/ipCidrRouteTable.c net-snmp-5.9.1/agent/mibgroup/mibII/ipCidrRouteTable.c
--- net-snmp-5.8/agent/mibgroup/mibII/ipCidrRouteTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/ipCidrRouteTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -14,10 +14,10 @@
 
 #include "var_route.h"
 
-netsnmp_feature_require(oid_stash)
-netsnmp_feature_require(get_routes)
-netsnmp_feature_require(oid_stash_get_data)
-netsnmp_feature_require(oid_stash_add_data)
+netsnmp_feature_require(oid_stash);
+netsnmp_feature_require(get_routes);
+netsnmp_feature_require(oid_stash_get_data);
+netsnmp_feature_require(oid_stash_add_data);
 
 static netsnmp_oid_stash_node *undoStorage;
 
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/ipv6.c net-snmp-5.9.1/agent/mibgroup/mibII/ipv6.c
--- net-snmp-5.8/agent/mibgroup/mibII/ipv6.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/ipv6.c	2021-05-26 05:19:35.000000000 +0700
@@ -5,6 +5,9 @@
 
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-features.h>
+/* For FreeBSD */
+#define _WANT_INPCB 1
+#define _WANT_TCPCB 1
 #include <sys/types.h>
 #include <sys/socket.h>
 #if HAVE_SYS_IOCTL_H
@@ -18,10 +21,11 @@
 #define _KERNEL_STRUCTURES
 #endif
 #include <sys/param.h>
-#if defined(freebsd3) || defined(darwin)
-# if HAVE_SYS_SOCKETVAR_H
-#  include <sys/socketvar.h>
-# endif
+#ifdef _I_DEFINED_KERNEL
+#undef _KERNEL
+#endif
+#if HAVE_SYS_SOCKETVAR_H
+# include <sys/socketvar.h>
 #endif
 
 #if STDC_HEADERS
@@ -86,18 +90,19 @@
 #if HAVE_NETINET_IP_VAR_H
 # include <netinet/ip_var.h>
 #endif
+#if HAVE_NETINET_ICMP6_H
+# include <netinet/icmp6.h>
+#endif
 #if HAVE_NETINET6_IP6_VAR_H
 # include <sys/queue.h>
 # include <netinet6/ip6_var.h>
 #endif
 #include <net/route.h>
-#if defined(freebsd3) || defined(darwin) || defined(openbsd4)
-# if HAVE_NETINET_IP_H
-#  include <netinet/ip.h>
-# endif
-# if HAVE_NETINET_IN_PCB_H
-#  include <netinet/in_pcb.h>
-# endif
+#if HAVE_NETINET_IP_H
+# include <netinet/ip.h>
+#endif
+#if HAVE_NETINET_IN_PCB_H
+# include <netinet/in_pcb.h>
 #endif
 #if HAVE_NETINET6_IN6_PCB_H
 # include <netinet6/in6_pcb.h>
@@ -165,7 +170,11 @@
 #include "ipv6.h"
 #include "interfaces.h"
 
-netsnmp_feature_require(linux_read_ip6_stat)
+#ifdef freebsd3
+#undef in6pcb
+#endif
+
+netsnmp_feature_require(linux_read_ip6_stat);
 
 #if defined(netbsd1) && !defined(openbsd4)
 #define inp_lport in6p_lport
@@ -619,7 +628,7 @@ if_getindex(const char *name)
 /*------------------------------------------------------------*/
 #ifndef linux
 
-#ifdef __OpenBSD__
+#if defined(__OpenBSD__) || defined(freebsd3)
 
  /*
   * It is not possible to use struct ifnet anymore on OpenBSD, get
@@ -863,7 +872,7 @@ var_ifv6Entry(register struct variable *
         p = if_getname(interface);
         if (p) {
             *var_len = strlen(p);
-            return p;
+            return (u_char *)p;
         }
         break;
     case IPV6IFLOWLAYER:
@@ -904,7 +913,7 @@ var_ifv6Entry(register struct variable *
 #endif
     case IPV6IFPHYSADDRESS:
         {
-#ifdef __OpenBSD__
+#if defined(__OpenBSD__) || defined(freebsd3)
 	    struct ifaddrs *ifa0, *ifa;
             static struct sockaddr_dl sdl;
             char ifnam[IF_NAMESIZE];
@@ -1024,7 +1033,7 @@ var_ifv6Entry(register struct variable *
         }
     case IPV6IFADMSTATUS:
         {
-#ifdef __OpenBSD__
+#if defined(__OpenBSD__) || defined(freebsd3)
             int    if_flags;
             if (if_getifflags(interface, &if_flags) < 0)
                 break;
@@ -1040,7 +1049,7 @@ var_ifv6Entry(register struct variable *
         }
     case IPV6IFOPERSTATUS:
         {
-#ifdef __OpenBSD__
+#if defined(__OpenBSD__) || defined(freebsd3)
             int    if_flags;
             if (if_getifflags(interface, &if_flags) < 0)
                 break;
@@ -1504,7 +1513,7 @@ var_udp6(register struct variable * vp,
     int             result;
     int             i, j;
     caddr_t         p;
-#if defined(openbsd4)
+#if defined(openbsd4) || defined(freebsd3)
     static struct inpcb in6pcb, savpcb;
 #else
     static struct in6pcb in6pcb, savpcb;
@@ -1520,7 +1529,6 @@ var_udp6(register struct variable * vp,
 #elif defined(freebsd3) || defined(darwin)
     char           *sysctl_buf;
     struct xinpgen *xig, *oxig;
-    static struct in6pcb udb6;
 #endif
 
     DEBUGMSGTL(("mibII/ipv6", "var_udp6: "));
@@ -1539,10 +1547,6 @@ var_udp6(register struct variable * vp,
 #else
     first = p = (caddr_t)udbtable.inpt_queue.cqh_first;
 #endif
-#elif !defined(freebsd3) && !defined(darwin)
-    if (!auto_nlist("udb6", (char *) &udb6, sizeof(udb6)))
-        return NULL;
-    p = (caddr_t) udb6.in6p_next;
 #elif defined(dragonfly)
     {
         const char     *udblist = "net.inet.udp.pcblist";
@@ -1564,6 +1568,14 @@ var_udp6(register struct variable * vp,
 	}
         p = (caddr_t) ((char *) xig); /* silence compiler warning */
     }
+#elif !defined(freebsd3) && !defined(darwin)
+    {
+    static struct in6pcb udb6;
+
+    if (!auto_nlist("udb6", (char *) &udb6, sizeof(udb6)))
+        return NULL;
+    p = (caddr_t) udb6.in6p_next;
+    }
 #else
     {
         const char     *udblist = "net.inet.udp.pcblist";
@@ -1601,15 +1613,18 @@ var_udp6(register struct variable * vp,
         ) {
         DEBUGMSGTL(("mibII/ipv6", "looping: p=%p\n", p));
 
-#if !defined(freebsd3) && !defined(darwin)
+#if defined(freebsd3)
+	/* To do: fill in in6pcb properly. */
+	memset(&in6pcb, 0, sizeof(in6pcb));
+#elif defined(darwin)
+	in6pcb = ((struct xinpcb *) xig)->xi_inp;
+#else
         if (!NETSNMP_KLOOKUP(p, (char *) &in6pcb, sizeof(in6pcb))) {
             DEBUGMSGTL(("mibII/ipv6", "klookup fail for udb6 at %p\n",
                         p));
             found = 0;
             break;
         }
-#else
-        in6pcb = ((struct xinpcb *) xig)->xi_inp;
 #endif
 #if defined(__NetBSD__) && __NetBSD_Version__ >= 106250000	/*1.6Y*/
         if (in6pcb.in6p_af != AF_INET6)
@@ -1684,10 +1699,10 @@ var_udp6(register struct variable * vp,
 #elif defined(__NetBSD__) && __NetBSD_Version__ >= 106250000	/*1.6Y*/
         p = (caddr_t)in6pcb.in6p_queue.cqe_next;
 	if (p == first) break;
-#elif !defined(freebsd3) && !defined(darwin)
-        p = (caddr_t)in6pcb.in6p_next;
 #elif defined(__DragonFly__)
         xig = (struct xinpcb *) ((char *) xig + xig->xi_len);
+#elif !defined(freebsd3) && !defined(darwin)
+        p = (caddr_t)in6pcb.in6p_next;
 #else
         xig = (struct xinpgen *) ((char *) xig + xig->xig_len);
 #endif
@@ -1757,8 +1772,6 @@ var_tcp6(register struct variable * vp,
 #elif defined(freebsd3) || defined(darwin)
     char           *sysctl_buf;
     struct xinpgen *xig, *oxig;
-#else
-    static struct in6pcb tcb6;
 #endif
 
     if (!initialized) {
@@ -1785,9 +1798,13 @@ var_tcp6(register struct variable * vp,
         return NULL;
     first = p = (caddr_t)tcbtable.inpt_queue.cqh_first;
 #elif !defined(freebsd3) && !defined(darwin)
+    {
+    static struct in6pcb tcb6;
+
     if (!auto_nlist("tcb6", (char *) &tcb6, sizeof(tcb6)))
         return NULL;
     p = (caddr_t) tcb6.in6p_next;
+    }
 #else
     {
         const char     *tcblist = "net.inet.tcp.pcblist";
@@ -2072,7 +2089,7 @@ var_tcp6(register struct variable * vp,
     int             result;
     int             i, j;
     caddr_t         p;
-#if defined(openbsd4)
+#if defined(openbsd4) || defined(freebsd3)
     static struct inpcb in6pcb, savpcb;
 #else
     static struct in6pcb in6pcb, savpcb;
@@ -2089,7 +2106,6 @@ var_tcp6(register struct variable * vp,
 #elif defined(freebsd3) || defined(darwin)
     char           *sysctl_buf;
     struct xinpgen *xig, *oxig;
-    static struct in6pcb tcb6;
 #endif
 
     DEBUGMSGTL(("mibII/ipv6", "var_tcp6: "));
@@ -2106,10 +2122,6 @@ var_tcp6(register struct variable * vp,
 #else
     first = p = (caddr_t)tcbtable.inpt_queue.cqh_first;
 #endif
-#elif !defined(freebsd3) && !defined(darwin)
-    if (!auto_nlist("tcb6", (char *) &tcb6, sizeof(tcb6)))
-        return NULL;
-    p = (caddr_t) tcb6.in6p_next;
 #elif defined(dragonfly)
     {
         const char     *tcblist = "net.inet.tcp.pcblist";
@@ -2131,6 +2143,14 @@ var_tcp6(register struct variable * vp,
 	}
         p = (caddr_t) ((char *) xtp); /* silence compiler warning */
     }
+#elif !defined(freebsd3) && !defined(darwin)
+    {
+    static struct in6pcb tcb6;
+
+    if (!auto_nlist("tcb6", (char *) &tcb6, sizeof(tcb6)))
+        return NULL;
+    p = (caddr_t) tcb6.in6p_next;
+    }
 #else
     {
         const char     *tcblist = "net.inet.tcp.pcblist";
@@ -2168,17 +2188,20 @@ var_tcp6(register struct variable * vp,
         ) {
         DEBUGMSGTL(("mibII/ipv6", "looping: p=%p\n", p));
 
-#if !defined(freebsd3) && !defined(darwin)
+#if defined(freebsd3)
+	/* To do: fill in in6pcb properly. */
+	memset(&in6pcb, 0, sizeof(in6pcb));
+#elif defined(dragonfly)
+	in6pcb = xtp->xt_inp;
+#elif defined(darwin)
+        in6pcb = ((struct xinpcb *) xig)->xi_inp;
+#else
         if (!NETSNMP_KLOOKUP(p, (char *) &in6pcb, sizeof(in6pcb))) {
             DEBUGMSGTL(("mibII/ipv6", "klookup fail for tcb6 at %p\n",
                         p));
             found = 0;
             break;
         }
-#elif defined(dragonfly)
-	in6pcb = xtp->xt_inp;
-#else
-        in6pcb = ((struct xinpcb *) xig)->xi_inp;
 #endif
 #if defined(__NetBSD__) && __NetBSD_Version__ >= 106250000	/*1.6Y*/
         if (in6pcb.in6p_af != AF_INET6)
@@ -2262,10 +2285,10 @@ var_tcp6(register struct variable * vp,
 #elif defined(__NetBSD__) && __NetBSD_Version__ >= 106250000 || defined(openbsd4)	/*1.6Y*/
         p = (caddr_t)in6pcb.in6p_queue.cqe_next;
 	if (p == first) break;
-#elif !defined(freebsd3) && !defined(darwin)
-        p = (caddr_t) in6pcb.in6p_next;
 #elif defined(dragonfly)
 	xtp = (struct xtcpcb *) ((char *)xtp + xtp->xt_len);
+#elif !defined(freebsd3) && !defined(darwin)
+        p = (caddr_t) in6pcb.in6p_next;
 #else
         xig = (struct xinpgen *) ((char *) xig + xig->xig_len);
 #endif
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/ipv6.h net-snmp-5.9.1/agent/mibgroup/mibII/ipv6.h
--- net-snmp-5.8/agent/mibgroup/mibII/ipv6.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/ipv6.h	2021-05-26 05:19:35.000000000 +0700
@@ -13,9 +13,18 @@ struct ip6_mib {
 };
 #endif
 
-config_require(mibII/ifTable mibII/at mibII/var_route mibII/route_write)
+config_require(mibII/ifTable mibII/at)
+#if !defined(darwin) || defined(HAVE_STRUCT_IN_IFADDR_IA_SUBNETMASK)
+/*
+ * To do: port mibII/ipAddr and mibII/var_route to Darwin versions that do not
+ * export struct in_ifaddr.
+ */
+config_require(mibII/var_route mibII/route_write)
+#endif /* !defined(darwin) || defined(HAVE_STRUCT_IN_IFADDR_IA_SUBNETMASK) */
 config_add_mib(IPV6-ICMP-MIB:IPV6-MIB:IPV6-TCP-MIB:IPV6-UDP-MIB)
-config_arch_require(solaris2, kernel_sunos5)
+#ifdef solaris2
+config_require(kernel_sunos5)
+#endif
 #include "var_route.h"
 #include "route_write.h"
 extern void     init_ipv6(void);
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/kernel_linux.c net-snmp-5.9.1/agent/mibgroup/mibII/kernel_linux.c
--- net-snmp-5.8/agent/mibgroup/mibII/kernel_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/kernel_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -179,9 +179,9 @@ static const struct stats_descr ipv4_snm
 #define ICMP6_STATS_PREFIX_LEN	5
 #define UDP6_STATS_PREFIX_LEN   4
 
-netsnmp_feature_child_of(linux_ip6_stat_all, libnetsnmpmibs)
+netsnmp_feature_child_of(linux_ip6_stat_all, libnetsnmpmibs);
 
-netsnmp_feature_child_of(linux_read_ip6_stat, linux_ip6_stat_all)
+netsnmp_feature_child_of(linux_read_ip6_stat, linux_ip6_stat_all);
 
 static int
 decode_icmp_msg(char *line, char *data, struct icmp4_msg_mib *msg)
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/mibII_common.h net-snmp-5.9.1/agent/mibgroup/mibII/mibII_common.h
--- net-snmp-5.8/agent/mibgroup/mibII/mibII_common.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/mibII_common.h	2021-05-26 05:19:35.000000000 +0700
@@ -90,9 +90,6 @@
 #ifdef HAVE_STDINT_H
 #include <stdint.h>
 #endif
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 
 #ifdef solaris2
 #include "kernel_sunos5.h"
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/mta_sendmail.c net-snmp-5.9.1/agent/mibgroup/mibII/mta_sendmail.c
--- net-snmp-5.8/agent/mibgroup/mibII/mta_sendmail.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/mta_sendmail.c	2021-05-26 05:19:35.000000000 +0700
@@ -539,7 +539,7 @@ count_queuegroup(struct QGrp *qg)
 
     qg->last = current_time;
 
-    chdir(cwd);
+    NETSNMP_IGNORE_RESULT(chdir(cwd));
 }
 
 /** static void add_queuegroup(const char *name, const char *path)
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/route_write.c net-snmp-5.9.1/agent/mibgroup/mibII/route_write.c
--- net-snmp-5.8/agent/mibgroup/mibII/route_write.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/route_write.c	2021-05-26 05:19:35.000000000 +0700
@@ -800,8 +800,8 @@ write_rte(int action,
                     if ((status =
                          CreateIpForwardEntry(route_row)) != NO_ERROR) {
                         snmp_log(LOG_ERR,
-                                 "Inside COMMIT: CreateIpNetEntry failed, status %lu\n",
-                                 status);
+                                 "Inside COMMIT: CreateIpNetEntry failed, status %u\n",
+                                 (unsigned int)status);
                         retval = SNMP_ERR_COMMITFAILED;
                     }
                 } else {
@@ -814,6 +814,7 @@ write_rte(int action,
                 }
             }
         }
+        /* FALL THROUGH */
 
     case FREE:
         /*
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/setSerialNo.c net-snmp-5.9.1/agent/mibgroup/mibII/setSerialNo.c
--- net-snmp-5.8/agent/mibgroup/mibII/setSerialNo.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/setSerialNo.c	2021-05-26 05:19:35.000000000 +0700
@@ -6,7 +6,7 @@
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
-netsnmp_feature_require(watcher_spinlock)
+netsnmp_feature_require(watcher_spinlock);
 
 
 #include "setSerialNo.h"
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/snmp_mib.c net-snmp-5.9.1/agent/mibgroup/mibII/snmp_mib.c
--- net-snmp-5.8/agent/mibgroup/mibII/snmp_mib.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/snmp_mib.c	2021-05-26 05:19:35.000000000 +0700
@@ -22,9 +22,9 @@
 #include "updates.h"
 #include "agent_global_vars.h"
 
-netsnmp_feature_require(helper_statistics)
+netsnmp_feature_require(helper_statistics);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_truthvalue)
+netsnmp_feature_require(check_vb_truthvalue);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 #define SNMP_OID 1, 3, 6, 1, 2, 1, 11
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/sysORTable.c net-snmp-5.9.1/agent/mibgroup/mibII/sysORTable.c
--- net-snmp-5.8/agent/mibgroup/mibII/sysORTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/sysORTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -11,7 +11,7 @@
 
 #include <net-snmp/net-snmp-features.h>
 
-netsnmp_feature_require(table_container)
+netsnmp_feature_require(table_container);
 
 
 /** Typical data structure for a row entry */
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/system_mib.c net-snmp-5.9.1/agent/mibgroup/mibII/system_mib.c
--- net-snmp-5.8/agent/mibgroup/mibII/system_mib.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/system_mib.c	2021-05-26 05:19:35.000000000 +0700
@@ -50,7 +50,7 @@
 #include "updates.h"
 #include "agent_global_vars.h"
 
-netsnmp_feature_require(watcher_read_only_int_scalar)
+netsnmp_feature_require(watcher_read_only_int_scalar);
 
         /*********************
 	 *
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/tcp.h net-snmp-5.9.1/agent/mibgroup/mibII/tcp.h
--- net-snmp-5.8/agent/mibgroup/mibII/tcp.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/tcp.h	2021-05-26 05:19:35.000000000 +0700
@@ -8,10 +8,13 @@
 
 config_require(mibII/tcpTable)
 
-config_arch_require(solaris2,        kernel_sunos5)
-config_arch_require(linux,     mibII/kernel_linux)
-config_arch_require(netbsd,    mibII/kernel_netbsd)
-config_arch_require(netbsdelf, mibII/kernel_netbsd)
+#ifdef solaris2
+config_require(kernel_sunos5)
+#elif defined(linux)
+config_require(mibII/kernel_linux)
+#elif defined(netbsd) || defined(netbsdelf)
+config_require(mibII/kernel_netbsd)
+#endif
 
 extern void     init_tcp(void);
 extern Netsnmp_Node_Handler tcp_handler;
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/tcpTable.c net-snmp-5.9.1/agent/mibgroup/mibII/tcpTable.c
--- net-snmp-5.8/agent/mibgroup/mibII/tcpTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/tcpTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -61,9 +61,9 @@
 #include "tcp.h"
 #include "tcpTable.h"
 
-netsnmp_feature_child_of(tcptable_all, libnetsnmpmibs)
+netsnmp_feature_child_of(tcptable_all, libnetsnmpmibs);
 
-netsnmp_feature_child_of(tcp_count_connections, tcptable_all)
+netsnmp_feature_child_of(tcp_count_connections, tcptable_all);
 
 #ifdef hpux11
 #define	TCPTABLE_ENTRY_TYPE	mib_tcpConnEnt 
@@ -120,7 +120,11 @@ struct netsnmp_tcpConnEntry_s {
 
 typedef struct netsnmp_inpcb_s netsnmp_inpcb;
 struct netsnmp_inpcb_s {
+#if __FreeBSD_version >= 1200026
+    struct xinpcb   pcb;
+#else
     struct inpcb    pcb;
+#endif
     int             state;
     netsnmp_inpcb  *inp_next;
 };
@@ -330,7 +334,9 @@ tcpTable_handler(netsnmp_mib_handler
 #ifndef NETSNMP_FEATURE_REMOVE_TCP_COUNT_CONNECTIONS
 int
 TCP_Count_Connections( void ) {
+#if (defined(CAN_USE_SYSCTL) && defined(TCPCTL_PCBLIST))
     tcpTable_load(NULL, NULL);
+#endif
     return tcp_estab;
 }
 #endif /* NETSNMP_FEATURE_REMOVE_TCP_COUNT_CONNECTIONS */
@@ -988,12 +994,20 @@ tcpTable_load(netsnmp_cache *cache, void
         nnew = SNMP_MALLOC_TYPEDEF(netsnmp_inpcb);
         if (!nnew)
             break;
+#if __FreeBSD_version >= 1200026
+        nnew->state = StateMap[((NS_ELEM *) xig)->t_state];
+#else
         nnew->state = StateMap[((NS_ELEM *) xig)->xt_tp.t_state];
+#endif
         if (nnew->state == 5 /* established */ ||
             nnew->state == 8 /*  closeWait  */ )
             tcp_estab++;
         memcpy(&(nnew->pcb), &(((NS_ELEM *) xig)->xt_inp),
+#if __FreeBSD_version >= 1200026
+                           sizeof(struct xinpcb));
+#else
                            sizeof(struct inpcb));
+#endif
 
 #ifdef INP_ISIPV6
 	if (INP_ISIPV6(&nnew->pcb))
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/tcpTable.h net-snmp-5.9.1/agent/mibgroup/mibII/tcpTable.h
--- net-snmp-5.8/agent/mibgroup/mibII/tcpTable.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/tcpTable.h	2021-05-26 05:19:35.000000000 +0700
@@ -5,7 +5,9 @@
 #ifndef _MIBGROUP_TCPTABLE_H
 #define _MIBGROUP_TCPTABLE_H
 
-config_arch_require(solaris2, kernel_sunos5)
+#ifdef solaris2
+config_require(kernel_sunos5)
+#endif
 #if !defined(NETSNMP_ENABLE_MFD_REWRITES)
 config_require(mibII/ip)
 #endif
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/udp.h net-snmp-5.9.1/agent/mibgroup/mibII/udp.h
--- net-snmp-5.8/agent/mibgroup/mibII/udp.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/udp.h	2021-05-26 05:19:35.000000000 +0700
@@ -8,10 +8,13 @@
 
 config_require(mibII/udpTable)
 
-config_arch_require(solaris2,        kernel_sunos5)
-config_arch_require(linux,     mibII/kernel_linux)
-config_arch_require(netbsd,    mibII/kernel_netbsd)
-config_arch_require(netbsdelf, mibII/kernel_netbsd)
+#ifdef solaris2
+config_require(kernel_sunos5)
+#elif defined(linux)
+config_require(mibII/kernel_linux)
+#elif defined(netbsd) || defined(netbsdelf)
+config_require(mibII/kernel_netbsd)
+#endif
 
 extern void     init_udp(void);
 extern Netsnmp_Node_Handler udp_handler;
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/udpTable.c net-snmp-5.9.1/agent/mibgroup/mibII/udpTable.c
--- net-snmp-5.8/agent/mibgroup/mibII/udpTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/udpTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -97,7 +97,11 @@ struct netsnmp_udpEntry_s {
 #if defined(freebsd4) || defined(darwin) || defined(osf5)
 typedef struct netsnmp_inpcb_s netsnmp_inpcb;
 struct netsnmp_inpcb_s {
+#if __FreeBSD_version >= 1200026
+    struct xinpcb   pcb;
+#else
     struct inpcb    pcb;
+#endif
     int             state;
     netsnmp_inpcb  *inp_next;
 };
@@ -708,7 +712,11 @@ udpTable_load(netsnmp_cache *cache, void
         nnew = SNMP_MALLOC_TYPEDEF(UDPTABLE_ENTRY_TYPE);
         if (!nnew)
             break;
+#if __FreeBSD_version >= 1200026
+        memcpy(&nnew->pcb, xig, sizeof(struct xinpcb));
+#else
         memcpy(&nnew->pcb, &((struct xinpcb *) xig)->xi_inp, sizeof(struct inpcb));
+#endif
 	nnew->inp_next = udp_head;
 	udp_head   = nnew;
 #if defined(dragonfly)
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/udpTable.h net-snmp-5.9.1/agent/mibgroup/mibII/udpTable.h
--- net-snmp-5.8/agent/mibgroup/mibII/udpTable.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/udpTable.h	2021-05-26 05:19:35.000000000 +0700
@@ -5,7 +5,9 @@
 #ifndef _MIBGROUP_UDPTABLE_H
 #define _MIBGROUP_UDPTABLE_H
 
-config_arch_require(solaris2, kernel_sunos5)
+#ifdef solaris2
+config_require(kernel_sunos5)
+#endif
 config_require(mibII/ip)
 
 extern void     init_udpTable(void);
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/vacm_vars.c net-snmp-5.9.1/agent/mibgroup/mibII/vacm_vars.c
--- net-snmp-5.8/agent/mibgroup/mibII/vacm_vars.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/vacm_vars.c	2021-05-26 05:19:35.000000000 +0700
@@ -379,7 +379,7 @@ var_vacm_access(struct variable * vp,
             cp = groupName;
             for (i = 0; i <= len && op < name + *length; i++) {
                 if (*op > 255) {
-                    *cp++ = 255;
+                    *cp++ = (char) 255;
                     ++op;
                 } else
                     *cp++ = (char) *op++;
@@ -394,7 +394,7 @@ var_vacm_access(struct variable * vp,
             cp = contextPrefix;
             for (i = 0; i <= len && op < name + *length; i++) {
                 if (*op > 255) {
-                    *cp++ = 255;
+                    *cp++ = (char) 255;
                     ++op;
                 } else
                     *cp++ = (char) *op++;
@@ -590,7 +590,7 @@ var_vacm_view(struct variable * vp,
                 cp = viewName;
                 for (i = 0; i <= len && op < name + *length; i++) {
                     if (*op > 255) {
-                        *cp++ = 255;
+                        *cp++ = (char) 255;
                         ++op;
                     } else
                         *cp++ = (char) *op++;
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/var_route.c net-snmp-5.9.1/agent/mibgroup/mibII/var_route.c
--- net-snmp-5.8/agent/mibgroup/mibII/var_route.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/var_route.c	2021-05-26 05:19:35.000000000 +0700
@@ -69,7 +69,7 @@ PERFORMANCE OF THIS SOFTWARE.
 #include <winerror.h>
 #endif
 
-netsnmp_feature_child_of(get_routes, libnetsnmpmibs)
+netsnmp_feature_child_of(get_routes, libnetsnmpmibs);
 
 #ifndef  MIN
 #define  MIN(a,b)                     (((a) < (b)) ? (a) : (b))
@@ -408,7 +408,7 @@ static union {
     u_short         data[128];
 } klgetsatmp;
 
-struct sockaddr_in *
+static struct sockaddr_in *
 klgetsa(struct sockaddr_in *dst)
 {
     if (!NETSNMP_KLOOKUP(dst, (char *) &klgetsatmp.sin, sizeof klgetsatmp.sin)) {
@@ -822,16 +822,10 @@ var_ipRouteEntry(struct variable * vp,
         addr_ret = Lowentry.ipRouteDest;
         return (u_char *) & addr_ret;
     case IPROUTEIFINDEX:
-#ifdef NETSNMP_INCLUDE_IFTABLE_REWRITES
         Lowentry.ipRouteIfIndex.o_bytes[Lowentry.ipRouteIfIndex.o_length] = '\0';
         long_return =
             netsnmp_access_interface_index_find(
                 Lowentry.ipRouteIfIndex.o_bytes);
-#else
-        long_return =
-           Interface_Index_By_Name(Lowentry.ipRouteIfIndex.o_bytes,
-                                   Lowentry.ipRouteIfIndex.o_length);
-#endif
         return (u_char *) & long_return;
     case IPROUTEMETRIC1:
         long_return = Lowentry.ipRouteMetric1;
@@ -880,7 +874,7 @@ static int      qsort_compare(const void
 #if defined(RTENTRY_4_4) || defined(RTENTRY_RT_NEXT) || defined (hpux11)
 
 #if defined(RTENTRY_4_4) && !defined(hpux11)
-void
+static void
 load_rtentries(struct radix_node *pt)
 {
     struct radix_node node;
@@ -1184,8 +1178,8 @@ Route_Scan_Reload(void)
 #else
 
 #if HAVE_SYS_MBUF_H
-netsnmp_feature_require(string_append_int)
-netsnmp_feature_require(interface_legacy)
+netsnmp_feature_require(string_append_int);
+netsnmp_feature_require(interface_legacy);
 static void
 Route_Scan_Reload(void)
 {
diff -urpN net-snmp-5.8/agent/mibgroup/mibII/var_route.h net-snmp-5.9.1/agent/mibgroup/mibII/var_route.h
--- net-snmp-5.8/agent/mibgroup/mibII/var_route.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII/var_route.h	2021-05-26 05:19:35.000000000 +0700
@@ -6,7 +6,9 @@
 #define _MIBGROUP_VAR_ROUTE_H
 
 config_require(mibII/ip)
-config_arch_require(solaris2, kernel_sunos5)
+#ifdef solaris2
+config_require(kernel_sunos5)
+#endif
 
 #if defined(HAVE_IPHLPAPI_H)
 #include <iphlpapi.h>
@@ -15,13 +17,6 @@ config_arch_require(solaris2, kernel_sun
      extern int      create_flag;
 
      void            init_var_route(void);
-#if defined(RTENTRY_4_4) && !defined(hpux11)
-     struct radix_node;
-     void            load_rtentries(struct radix_node *);
-#endif
-#if defined(freebsd2) || defined(netbsd1) || defined(bsdi2) || defined(openbsd2)
-     struct sockaddr_in *klgetsa(struct sockaddr_in *);
-#endif
 
      extern FindVarMethod var_ipRouteEntry;
 
diff -urpN net-snmp-5.8/agent/mibgroup/mibII.h net-snmp-5.9.1/agent/mibgroup/mibII.h
--- net-snmp-5.8/agent/mibgroup/mibII.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/mibII.h	2021-05-26 05:19:35.000000000 +0700
@@ -10,20 +10,21 @@ config_require(mibII/setSerialNo)
 #if !defined(cygwin) || defined(HAVE_IPHLPAPI_H)
 config_require(mibII/at)
 config_require(mibII/ifTable)
+#if !defined(darwin) || defined(HAVE_STRUCT_IN_IFADDR_IA_SUBNETMASK)
 config_require(mibII/ip)
 config_require(mibII/tcp)
-config_require(mibII/icmp)
 config_require(mibII/udp)
-#endif
 
 /* mibII/ipv6 is activated via --enable-ipv6 and only builds on Linux+*BSD */
 #if defined(NETSNMP_ENABLE_IPV6) && (defined(linux) || defined(freebsd3) || defined(netbsd1) || defined(openbsd4)) 
 config_require(mibII/ipv6)
-#endif
+#endif /* defined(NETSNMP_ENABLE_IPV6) */
+
+#endif /* !defined(darwin) || defined(HAVE_STRUCT_IN_IFADDR_IA_SUBNETMASK) */
+config_require(mibII/icmp)
+#endif /* !defined(cygwin) || defined(HAVE_IPHLPAPI_H) */
 
-#ifdef NETSNMP_INCLUDE_IFTABLE_REWRITES
 config_require(if-mib)
-#endif
 
 /*
  * these new module re-rewrites have only been implemented for
diff -urpN net-snmp-5.8/agent/mibgroup/notification/snmpNotifyFilterProfileTable.c net-snmp-5.9.1/agent/mibgroup/notification/snmpNotifyFilterProfileTable.c
--- net-snmp-5.8/agent/mibgroup/notification/snmpNotifyFilterProfileTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/notification/snmpNotifyFilterProfileTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -37,7 +37,7 @@
 #include "snmpNotifyFilterProfileTable.h"
 
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(header_complex_find_entry)
+netsnmp_feature_require(header_complex_find_entry);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /*
diff -urpN net-snmp-5.8/agent/mibgroup/notification/snmpNotifyTable.c net-snmp-5.9.1/agent/mibgroup/notification/snmpNotifyTable.c
--- net-snmp-5.8/agent/mibgroup/notification/snmpNotifyTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/notification/snmpNotifyTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -49,7 +49,7 @@
 #endif
 
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(header_complex_find_entry)
+netsnmp_feature_require(header_complex_find_entry);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /*
diff -urpN net-snmp-5.8/agent/mibgroup/notification/snmpNotifyTable_data.c net-snmp-5.9.1/agent/mibgroup/notification/snmpNotifyTable_data.c
--- net-snmp-5.8/agent/mibgroup/notification/snmpNotifyTable_data.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/notification/snmpNotifyTable_data.c	2021-05-26 05:19:35.000000000 +0700
@@ -312,7 +312,7 @@ notifyTable_register_notifications(int m
             snmp_log(LOG_ERR,
                      "Can't register new trap destination: max limit reached: %d",
                      MAX_ENTRIES);
-            snmp_sess_close(ss);
+            snmp_close(ss);
             return (0);
         }
         name = buf;
@@ -335,7 +335,7 @@ notifyTable_register_notifications(int m
     if (!t) {
         snmp_log(LOG_ERR,
                 "Cannot add new trap destination, transport is closed.");
-        snmp_sess_close(ss);
+        snmp_close(ss);
         return 0;
     }
     ptr = snmpTargetAddrTable_create();
@@ -378,6 +378,10 @@ notifyTable_register_notifications(int m
     if (ss->version == SNMP_VERSION_3) {
         pptr->secModel = ss->securityModel;
         pptr->secLevel = ss->securityLevel;
+        if (!ss->securityName) {
+            snmp_log(LOG_ERR, "Security name is missing.");
+            goto bail;
+        }
         pptr->secNameData = netsnmp_memdup_nt(ss->securityName,
                                               ss->securityNameLen,
                                               &pptr->secNameLen);
@@ -461,7 +465,7 @@ notifyTable_register_notifications(int m
     return 0;
 
   bail:
-    snmp_log(LOG_ERR, "Cannot add new trap destination");
+    snmp_log(LOG_ERR, "Cannot add new trap destination %s\n", name);
 
     if (NULL != nptr)
         snmpNotifyTable_remove(nptr);
@@ -472,7 +476,7 @@ notifyTable_register_notifications(int m
     if (NULL != ptr)
         snmpTargetAddrTable_remove(ptr);
 
-    snmp_sess_close(ss);
+    snmp_close(ss);
 
     return 0;
 }
diff -urpN net-snmp-5.8/agent/mibgroup/notification-log-mib/notification_log.c net-snmp-5.9.1/agent/mibgroup/notification-log-mib/notification_log.c
--- net-snmp-5.8/agent/mibgroup/notification-log-mib/notification_log.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/notification-log-mib/notification_log.c	2021-05-26 05:19:35.000000000 +0700
@@ -20,11 +20,11 @@
 #include "net-snmp/agent/sysORTable.h"
 #include "notification_log.h"
 
-netsnmp_feature_require(register_ulong_instance_context)
-netsnmp_feature_require(register_read_only_counter32_instance_context)
-netsnmp_feature_require(delete_table_data_set)
-netsnmp_feature_require(table_dataset)
-netsnmp_feature_require(date_n_time)
+netsnmp_feature_require(register_ulong_instance_context);
+netsnmp_feature_require(register_read_only_counter32_instance_context);
+netsnmp_feature_require(delete_table_data_set);
+netsnmp_feature_require(table_dataset);
+netsnmp_feature_require(date_n_time);
 
 /*
  * column number definitions for table nlmLogTable
diff -urpN net-snmp-5.8/agent/mibgroup/rmon-mib/data_access/etherstats_linux.c net-snmp-5.9.1/agent/mibgroup/rmon-mib/data_access/etherstats_linux.c
--- net-snmp-5.8/agent/mibgroup/rmon-mib/data_access/etherstats_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/rmon-mib/data_access/etherstats_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -5,6 +5,10 @@
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
+#if HAVE_UNISTD_H
+#include <unistd.h>
+#endif
+
 /*
  * include our parent header 
  */
@@ -342,8 +346,8 @@ _etherStats_ioctl_get(int fd, int which,
      */
     if(NULL == name) {
         DEBUGMSGTL(("access:etherStatsTable:ioctl",
-                    "_etherStats_ioctl_get invalid ifname '%s'\n", name));
-        snmp_log (LOG_ERR, "access:etherStatsTable:ioctl, _etherStats_ioctl_get error on inerface '%s'\n", name);
+                    "_etherStats_ioctl_get interface name is NULL"));
+        snmp_log (LOG_ERR, "access:etherStatsTable:ioctl, _etherStats_ioctl_get interface name is NULL");
         return -1;
     }
 
diff -urpN net-snmp-5.8/agent/mibgroup/rmon-mib/etherStatsTable/etherStatsTable_data_access.c net-snmp-5.9.1/agent/mibgroup/rmon-mib/etherStatsTable/etherStatsTable_data_access.c
--- net-snmp-5.8/agent/mibgroup/rmon-mib/etherStatsTable/etherStatsTable_data_access.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/rmon-mib/etherStatsTable/etherStatsTable_data_access.c	2021-05-26 05:19:35.000000000 +0700
@@ -11,6 +11,10 @@
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
+#if HAVE_UNISTD_H
+#include <unistd.h>
+#endif
+
 /*
  * include our parent header 
  */
diff -urpN net-snmp-5.8/agent/mibgroup/rmon-mib/etherStatsTable/etherStatsTable_interface.c net-snmp-5.9.1/agent/mibgroup/rmon-mib/etherStatsTable/etherStatsTable_interface.c
--- net-snmp-5.8/agent/mibgroup/rmon-mib/etherStatsTable/etherStatsTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/rmon-mib/etherStatsTable/etherStatsTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,12 +47,12 @@
 
 #include <ctype.h>
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(table_container_row_insert)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(table_container_row_insert);
+netsnmp_feature_require(check_all_requests_error);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_type_and_max_size)
+netsnmp_feature_require(check_vb_type_and_max_size);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /**********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/sctp-mib/sctpTables_common.c net-snmp-5.9.1/agent/mibgroup/sctp-mib/sctpTables_common.c
--- net-snmp-5.8/agent/mibgroup/sctp-mib/sctpTables_common.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/sctp-mib/sctpTables_common.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,7 +13,7 @@
 #include "sctpLookupRemPrimIPAddrTable.h"
 #include "sctpLookupRemIPAddrTable.h"
 
-netsnmp_feature_require(container_lifo)
+netsnmp_feature_require(container_lifo);
 
 static void
 sctpAssocTable_collect_invalid(void *what, void *magic)
diff -urpN net-snmp-5.8/agent/mibgroup/sctp-mib/sctpTables_linux.c net-snmp-5.9.1/agent/mibgroup/sctp-mib/sctpTables_linux.c
--- net-snmp-5.8/agent/mibgroup/sctp-mib/sctpTables_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/sctp-mib/sctpTables_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -286,7 +286,7 @@ load_assoc(sctpTables_containers * conta
     /*
      * ignore the header. 
      */
-    fgets(line, sizeof(line), f);
+    NETSNMP_IGNORE_RESULT(fgets(line, sizeof(line), f));
 
     while (fgets(line, sizeof(line), f) != NULL) {
         DEBUGMSGTL(("sctp:tables:load:assoc", "processing line: %s\n",
@@ -406,7 +406,7 @@ load_remaddr(sctpTables_containers * con
     /*
      * ignore the header. 
      */
-    fgets(line, sizeof(line), f);
+    NETSNMP_IGNORE_RESULT(fgets(line, sizeof(line), f));
 
     while (fgets(line, sizeof(line), f) != NULL) {
         DEBUGMSGTL(("sctp:load:remaddr", "processing line: %s\n", line));
diff -urpN net-snmp-5.8/agent/mibgroup/smux/smux.c net-snmp-5.9.1/agent/mibgroup/smux/smux.c
--- net-snmp-5.8/agent/mibgroup/smux/smux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/smux/smux.c	2021-05-26 05:19:35.000000000 +0700
@@ -68,7 +68,7 @@
 #include "smux.h"
 #include "snmpd.h"
 
-netsnmp_feature_require(snprint_objid)
+netsnmp_feature_require(snprint_objid);
 
 long            smux_long;
 u_long          smux_ulong;
diff -urpN net-snmp-5.8/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable.c net-snmp-5.9.1/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable.c
--- net-snmp-5.8/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -27,7 +27,7 @@
 
 #include "snmpNotifyFilterTable_interface.h"
 
-netsnmp_feature_require(check_storage_transition)
+netsnmp_feature_require(check_storage_transition);
 
 const oid       snmpNotifyFilterTable_oid[] =
     { SNMPNOTIFYFILTERTABLE_OID };
@@ -339,9 +339,8 @@ snmpNotifyFilterTable_indexes_set_tbl_id
     /*
      * make sure there is enough space for snmpNotifyFilterProfileName data
      */
-    if ((NULL == tbl_idx->snmpNotifyFilterProfileName) ||
-        (tbl_idx->snmpNotifyFilterProfileName_len <
-         (snmpNotifyFilterProfileName_val_ptr_len))) {
+    if (tbl_idx->snmpNotifyFilterProfileName_len <
+        snmpNotifyFilterProfileName_val_ptr_len) {
         snmp_log(LOG_ERR, "not enough space for value\n");
         return MFD_ERROR;
     }
@@ -359,9 +358,8 @@ snmpNotifyFilterTable_indexes_set_tbl_id
     /*
      * make sure there is enough space for snmpNotifyFilterSubtree data
      */
-    if ((NULL == tbl_idx->snmpNotifyFilterSubtree) ||
-        (tbl_idx->snmpNotifyFilterSubtree_len <
-         (snmpNotifyFilterSubtree_val_ptr_len))) {
+    if (tbl_idx->snmpNotifyFilterSubtree_len <
+        snmpNotifyFilterSubtree_val_ptr_len) {
         snmp_log(LOG_ERR, "not enough space for value\n");
         return MFD_ERROR;
     }
diff -urpN net-snmp-5.8/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_access.c net-snmp-5.9.1/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_access.c
--- net-snmp-5.8/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_access.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_access.c	2021-05-26 05:19:35.000000000 +0700
@@ -24,7 +24,7 @@
 
 #include "snmpNotifyFilterTable_data_access.h"
 
-netsnmp_feature_require(snmpNotifyFilterTable_container_get)
+netsnmp_feature_require(snmpNotifyFilterTable_container_get);
 
 /** @ingroup interface 
  * @addtogroup data_access data_access: Routines to access data
diff -urpN net-snmp-5.8/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_storage.c net-snmp-5.9.1/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_storage.c
--- net-snmp-5.8/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_storage.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_data_storage.c	2021-05-26 05:19:35.000000000 +0700
@@ -28,7 +28,7 @@
 #include <ctype.h>
 
 
-netsnmp_feature_require(CONTAINER_FREE_ALL)
+netsnmp_feature_require(CONTAINER_FREE_ALL);
 
 
 /**********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_interface.c net-snmp-5.9.1/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_interface.c
--- net-snmp-5.8/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/snmp-notification-mib/snmpNotifyFilterTable/snmpNotifyFilterTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,21 +47,21 @@
 
 #include <ctype.h>
 
-netsnmp_feature_child_of(snmpNotifyFilterTable_external_access, libnetsnmpmibs)
+netsnmp_feature_child_of(snmpNotifyFilterTable_external_access, libnetsnmpmibs);
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(table_container_row_insert)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(table_container_row_insert);
+netsnmp_feature_require(check_all_requests_error);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_type_and_max_size)
+netsnmp_feature_require(check_vb_type_and_max_size);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 
-netsnmp_feature_child_of(snmpNotifyFilterTable_container_size, snmpNotifyFilterTable_external_access)
-netsnmp_feature_child_of(snmpNotifyFilterTable_registration_set, snmpNotifyFilterTable_external_access)
-netsnmp_feature_child_of(snmpNotifyFilterTable_registration_get, snmpNotifyFilterTable_external_access)
-netsnmp_feature_child_of(snmpNotifyFilterTable_container_get, snmpNotifyFilterTable_external_access)
+netsnmp_feature_child_of(snmpNotifyFilterTable_container_size, snmpNotifyFilterTable_external_access);
+netsnmp_feature_child_of(snmpNotifyFilterTable_registration_set, snmpNotifyFilterTable_external_access);
+netsnmp_feature_child_of(snmpNotifyFilterTable_registration_get, snmpNotifyFilterTable_external_access);
+netsnmp_feature_child_of(snmpNotifyFilterTable_container_get, snmpNotifyFilterTable_external_access);
 
 /**********************************************************************
  **********************************************************************
@@ -1125,9 +1125,7 @@ _snmpNotifyFilterTable_check_column(snmp
         /*
          * check defined range(s). 
          */
-        if ((SNMPERR_SUCCESS == rc)
-            && ((var->val_len < 0) || (var->val_len > 16))
-            ) {
+        if (rc == SNMPERR_SUCCESS && var->val_len > 16) {
             rc = SNMP_ERR_WRONGLENGTH;
         }
         if (SNMPERR_SUCCESS != rc) {
@@ -1956,9 +1954,7 @@ static int      _snmpNotifyFilterTable_c
 static void     _snmpNotifyFilterTable_container_row_restore(const char
                                                              *token,
                                                              char *buf);
-static int
-                _snmpNotifyFilterTable_container_row_save(snmpNotifyFilterTable_rowreq_ctx
-                                                          * rowreq_ctx,
+static void     _snmpNotifyFilterTable_container_row_save(void *data,
                                                           void *type);
 static char
  
@@ -2051,8 +2047,7 @@ _snmpNotifyFilterTable_container_save_ro
     /*
      * save all rows
      */
-    CONTAINER_FOR_EACH(c, (netsnmp_container_obj_func *)
-                       _snmpNotifyFilterTable_container_row_save, type);
+    CONTAINER_FOR_EACH(c, _snmpNotifyFilterTable_container_row_save, type);
 
     read_config_store((char *) type, sep);
     read_config_store((char *) type, "\n");
@@ -2068,10 +2063,11 @@ _snmpNotifyFilterTable_container_save_ro
 /************************************************************
  * _snmpNotifyFilterTable_container_row_save
  */
-static int
-_snmpNotifyFilterTable_container_row_save(snmpNotifyFilterTable_rowreq_ctx
-                                          * rowreq_ctx, void *type)
+static void
+_snmpNotifyFilterTable_container_row_save(void *data, void *type)
 {
+    snmpNotifyFilterTable_rowreq_ctx *rowreq_ctx = data;
+
     /*
      * Allocate space for a line with all data for a row. An
      * attempt is made to come up with a default maximum size, but
@@ -2117,7 +2113,7 @@ _snmpNotifyFilterTable_container_row_sav
     int             i;
 
     if (snmpNotifyFilterTable_container_should_save(rowreq_ctx) == 0) {
-        return SNMP_ERR_NOERROR;
+        return;
     }
 
     /*
@@ -2129,13 +2125,13 @@ _snmpNotifyFilterTable_container_row_sav
     if (NULL == pos) {
         snmp_log(LOG_ERR, "error saving snmpNotifyFilterTable row "
                  "to persistent file\n");
-        return SNMP_ERR_GENERR;
+        return;
     }
     *pos++ = ' ';
     if (pos > max) {
         snmp_log(LOG_ERR, "error saving snmpNotifyFilterTable row "
                  "to persistent file (too long)\n");
-        return SNMP_ERR_GENERR;
+        return;
     }
 
     /*
@@ -2157,7 +2153,7 @@ _snmpNotifyFilterTable_container_row_sav
         if (pos > max) {
             snmp_log(LOG_ERR, "error saving snmpNotifyFilterTable row "
                      "to persistent file (too long)\n");
-            return SNMP_ERR_GENERR;
+            return;
         }
     }
 
@@ -2173,13 +2169,11 @@ _snmpNotifyFilterTable_container_row_sav
     if (pos > max) {
         snmp_log(LOG_ERR, "error saving snmpNotifyFilterTable row "
                  "to persistent file (too long)\n");
-        return SNMP_ERR_GENERR;
+        return;
     }
     read_config_store((char *) type, buf);
 
     DEBUGMSGTL(("internal:snmpNotifyFilterTable:_snmpNotifyFilterTable_container_row_save", "saving line '%s'\n", buf));
-
-    return SNMP_ERR_NOERROR;
 }
 
 static void
diff -urpN net-snmp-5.8/agent/mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_data_get.c net-snmp-5.9.1/agent/mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_data_get.c
--- net-snmp-5.8/agent/mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_data_get.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_data_get.c	2021-05-26 05:19:35.000000000 +0700
@@ -203,8 +203,7 @@ usmDHUserKeyTable_indexes_set_tbl_idx(us
     /*
      * make sure there is enough space for usmUserEngineID data
      */
-    if ((NULL == tbl_idx->usmUserEngineID) ||
-        (tbl_idx->usmUserEngineID_len < (usmUserEngineID_val_ptr_len))) {
+    if (tbl_idx->usmUserEngineID_len < usmUserEngineID_val_ptr_len) {
         snmp_log(LOG_ERR, "not enough space for value\n");
         return MFD_ERROR;
     }
@@ -222,8 +221,7 @@ usmDHUserKeyTable_indexes_set_tbl_idx(us
     /*
      * make sure there is enough space for usmUserName data
      */
-    if ((NULL == tbl_idx->usmUserName) ||
-        (tbl_idx->usmUserName_len < (usmUserName_val_ptr_len))) {
+    if (tbl_idx->usmUserName_len < usmUserName_val_ptr_len) {
         snmp_log(LOG_ERR, "not enough space for value\n");
         return MFD_ERROR;
     }
diff -urpN net-snmp-5.8/agent/mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_interface.c net-snmp-5.9.1/agent/mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_interface.c
--- net-snmp-5.8/agent/mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/snmp-usm-dh-objects-mib/usmDHUserKeyTable/usmDHUserKeyTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,9 +47,9 @@
 
 #include <ctype.h>
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(check_all_requests_error);
 
 /**********************************************************************
  **********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/snmpv3/snmpEngine.c net-snmp-5.9.1/agent/mibgroup/snmpv3/snmpEngine.c
--- net-snmp-5.8/agent/mibgroup/snmpv3/snmpEngine.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/snmpv3/snmpEngine.c	2021-05-26 05:19:35.000000000 +0700
@@ -11,9 +11,9 @@
 #include "util_funcs/header_generic.h"
 #include "snmpEngine.h"
 
-netsnmp_feature_child_of(snmpengine_all, libnetsnmpmibs)
+netsnmp_feature_child_of(snmpengine_all, libnetsnmpmibs);
 
-netsnmp_feature_child_of(register_snmpEngine_scalars_context, snmpengine_all)
+netsnmp_feature_child_of(register_snmpEngine_scalars_context, snmpengine_all);
 
 struct variable2 snmpEngine_variables[] = {
     {SNMPENGINEID, ASN_OCTET_STR, NETSNMP_OLDAPI_RONLY,
diff -urpN net-snmp-5.8/agent/mibgroup/snmpv3/snmpMPDStats.c net-snmp-5.9.1/agent/mibgroup/snmpv3/snmpMPDStats.c
--- net-snmp-5.8/agent/mibgroup/snmpv3/snmpMPDStats.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/snmpv3/snmpMPDStats.c	2021-05-26 05:19:35.000000000 +0700
@@ -27,7 +27,7 @@
 #define snmpMPDMIBObjects snmpMPDMIB, 2
 #define snmpMPDMIBCompliances snmpMPDMIB, 3, 1
 
-netsnmp_feature_require(helper_statistics)
+netsnmp_feature_require(helper_statistics);
 
 static oid snmpMPDStats[] = { snmpMPDMIBObjects, 1 };
 
diff -urpN net-snmp-5.8/agent/mibgroup/snmpv3/usmStats.c net-snmp-5.9.1/agent/mibgroup/snmpv3/usmStats.c
--- net-snmp-5.8/agent/mibgroup/snmpv3/usmStats.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/snmpv3/usmStats.c	2021-05-26 05:19:35.000000000 +0700
@@ -22,7 +22,7 @@ static oid usmStats[] = { snmpUsmMIB, 1,
 static netsnmp_handler_registration* usmStats_reg = NULL;
 static oid usmMIBCompliance[] = { usmMIBCompliances, 1 };
 
-netsnmp_feature_require(helper_statistics)
+netsnmp_feature_require(helper_statistics);
 
 void
 init_usmStats(void)
diff -urpN net-snmp-5.8/agent/mibgroup/snmpv3/usmUser.c net-snmp-5.9.1/agent/mibgroup/snmpv3/usmUser.c
--- net-snmp-5.8/agent/mibgroup/snmpv3/usmUser.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/snmpv3/usmUser.c	2021-05-26 05:19:35.000000000 +0700
@@ -31,10 +31,10 @@
 int usmStatusCheck(struct usmUser *uptr);
 #endif  /* !NETSNMP_NO_WRITE_SUPPORT */
 
-netsnmp_feature_child_of(usmuser_all, libnetsnmpmibs)
-netsnmp_feature_child_of(init_register_usmuser_context, usmuser_all)
+netsnmp_feature_child_of(usmuser_all, libnetsnmpmibs);
+netsnmp_feature_child_of(init_register_usmuser_context, usmuser_all);
 
-netsnmp_feature_require(scapi_get_proper_priv_length)
+netsnmp_feature_require(scapi_get_proper_priv_length);
 
 struct variable4 usmUser_variables[] = {
     {USMUSERSPINLOCK, ASN_INTEGER, NETSNMP_OLDAPI_RWRITE,
@@ -1091,7 +1091,7 @@ write_usmUserPrivKeyChange(int action,
     static unsigned char *oldkey;
     static size_t   oldkeylen;
     static int      resetOnFail;
-    int plen, alen;
+    int plen;
 
     if (name[USM_MIB_LENGTH - 1] == 9) {
         fname = fnPrivKey;
@@ -1113,7 +1113,7 @@ write_usmUserPrivKeyChange(int action,
         if ((uptr = usm_parse_user(name, name_len)) == NULL) {
             return SNMP_ERR_INCONSISTENTNAME;
         } else {
-            netsnmp_priv_alg_info *pai =
+            const netsnmp_priv_alg_info *pai =
                 sc_get_priv_alg_byoid(uptr->privProtocol,
                                       uptr->privProtocolLen);
             if (NULL == pai) {
@@ -1121,17 +1121,17 @@ write_usmUserPrivKeyChange(int action,
                             fname));
                 return SNMP_ERR_GENERR;
             }
-            alen = sc_get_properlength(uptr->authProtocol,
-                                       uptr->authProtocolLen);
             plen = pai->proper_length;
-            DEBUGMSGTL(("usmUser", "plen %d, alen %d\n", plen, alen));
-#if 0
+            DEBUGMSGTL(("usmUser", "plen %d\n", plen));
+            /*
+             * ?? we store salt with key. See also the corresponding statement
+             * in apps/snmpusm.c.
+             */
             if (USM_CREATE_USER_PRIV_DES == pai->type)
-                plen *= 2; /* ?? we store salt with key */
-#endif
+                plen *= 2;
             if (var_val_len != 0 && var_val_len != (2 * plen)) {
                 DEBUGMSGTL(("usmUser", "%s: bad len. %" NETSNMP_PRIz "d != %d\n",
-                            fname, var_val_len, (2*alen)));
+                            fname, var_val_len, 2 * plen));
                 return SNMP_ERR_WRONGLENGTH;
             }
         }
@@ -1145,9 +1145,7 @@ write_usmUserPrivKeyChange(int action,
         }
         plen = sc_get_proper_priv_length(uptr->privProtocol,
                                          uptr->privProtocolLen);
-        alen = sc_get_properlength(uptr->authProtocol,
-                                   uptr->authProtocolLen);
-        DEBUGMSGTL(("usmUser", "plen %d, alen %d\n", plen, alen));
+        DEBUGMSGTL(("usmUser", "plen %d\n", plen));
         if (snmp_oid_compare(uptr->privProtocol, uptr->privProtocolLen,
                              usmNoPrivProtocol,
                              sizeof(usmNoPrivProtocol) / sizeof(oid)) ==
diff -urpN net-snmp-5.8/agent/mibgroup/struct.h net-snmp-5.9.1/agent/mibgroup/struct.h
--- net-snmp-5.8/agent/mibgroup/struct.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/struct.h	2021-05-26 05:19:35.000000000 +0700
@@ -28,13 +28,6 @@ struct extensible {
 #endif /* USING_SINGLE_COMMON_PASSPERSIST_INSTANCE */
 };
 
-#if HAVE_PCRE_H
-/* Pointer to pcre struct. Abstract pcre native pointer so all *.c files */
-/* do not have to include pcre.h */
-struct real_pcre;
-typedef struct real_pcre *netsnmp_regex_ptr;
-#endif
-
 struct myproc {
     char            name[STRMAX];
 #if HAVE_PCRE_H
diff -urpN net-snmp-5.8/agent/mibgroup/target/snmpTargetAddrEntry_data.c net-snmp-5.9.1/agent/mibgroup/target/snmpTargetAddrEntry_data.c
--- net-snmp-5.8/agent/mibgroup/target/snmpTargetAddrEntry_data.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/target/snmpTargetAddrEntry_data.c	2021-05-26 05:19:35.000000000 +0700
@@ -25,6 +25,8 @@
 #include "snmpTargetAddrEntry_data.h"
 #include "util_funcs/header_generic.h"
 
+netsnmp_feature_require(container_compare_mem);
+
 static struct targetAddrTable_struct *aAddrTable = NULL;
 static int _active = 0;
 
@@ -312,7 +314,7 @@ store_snmpTargetAddrEntry(int majorID, i
                           void *clientarg)
 {
     const struct targetAddrTable_struct *curr_struct;
-    char            line[1024], *cur, *ep = line + sizeof(line);
+    char            line[1024], *ep = line + sizeof(line);
     int             i;
 
     curr_struct = aAddrTable;
@@ -321,6 +323,8 @@ store_snmpTargetAddrEntry(int majorID, i
              curr_struct->storageType == SNMP_STORAGE_PERMANENT) &&
             (curr_struct->rowStatus == SNMP_ROW_ACTIVE ||
              curr_struct->rowStatus == SNMP_ROW_NOTINSERVICE)) {
+            char *cur;
+
             cur = line + snprintf(line, sizeof(line), "targetAddr ");
             cur = read_config_save_octet_string(
                  cur, (const u_char*)curr_struct->nameData,
@@ -333,12 +337,11 @@ store_snmpTargetAddrEntry(int majorID, i
             *cur++ = ' ';
             cur = read_config_save_octet_string(
                 cur, curr_struct->tAddress, curr_struct->tAddressLen);
-            cur += snprintf(cur, ep - cur, " %i %i \"%s\" %s %i %i",
-                            curr_struct->timeout,
-                            curr_struct->retryCount, curr_struct->tagListData,
-                            curr_struct->paramsData, curr_struct->storageType,
-                            curr_struct->rowStatus);
-            line[ sizeof(line)-1 ] = 0;
+            snprintf(cur, ep - cur, " %i %i \"%s\" %s %i %i",
+                     curr_struct->timeout,
+                     curr_struct->retryCount, curr_struct->tagListData,
+                     curr_struct->paramsData, curr_struct->storageType,
+                     curr_struct->rowStatus);
 
             /*
              * store to file
@@ -643,9 +646,11 @@ snmpd_parse_config_targetAddr(const char
         bptr += snprintf(bptr, buff + sizeof(buff) - bptr,
                          ".%d", (int) newEntry->tDomain[i]);
     }
+    for (i = 0; i < newEntry->tAddressLen; i++)
+        bptr += snprintf(bptr, buff + sizeof(buff) - bptr, " %02x",
+                         ((u_char *)newEntry->tAddress)[i]);
     bptr += snprintf(bptr, buff + sizeof(buff) - bptr,
-                     " %s %d %d %s %s %d %d\n",
-                     newEntry->tAddress, newEntry->timeout,
+                     " %d %d %s %s %d %d\n", newEntry->timeout,
                      newEntry->retryCount, newEntry->tagListData,
                      newEntry->paramsData, newEntry->storageType,
                      newEntry->rowStatus);
diff -urpN net-snmp-5.8/agent/mibgroup/target/snmpTargetParamsEntry_data.c net-snmp-5.9.1/agent/mibgroup/target/snmpTargetParamsEntry_data.c
--- net-snmp-5.8/agent/mibgroup/target/snmpTargetParamsEntry_data.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/target/snmpTargetParamsEntry_data.c	2021-05-26 05:19:35.000000000 +0700
@@ -23,6 +23,8 @@
 
 #include "snmpTargetParamsEntry_data.h"
 
+netsnmp_feature_require(container_compare_mem);
+
 static struct targetParamTable_struct *aPTable = NULL;
 static int _active = 0;
 
diff -urpN net-snmp-5.8/agent/mibgroup/target/target.c net-snmp-5.9.1/agent/mibgroup/target/target.c
--- net-snmp-5.8/agent/mibgroup/target/target.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/target/target.c	2021-05-26 05:19:35.000000000 +0700
@@ -32,9 +32,9 @@
 #include "snmpTargetParamsEntry.h"
 #include "target.h"
 
-netsnmp_feature_require(tdomain_support)
-netsnmp_feature_require(tdomain_transport_oid)
-netsnmp_feature_want(netsnmp_tlstmAddr_get_serverId)
+netsnmp_feature_require(tdomain_support);
+netsnmp_feature_require(tdomain_transport_oid);
+netsnmp_feature_want(netsnmp_tlstmAddr_get_serverId);
 
 #define MAX_TAGS 128
 
@@ -66,8 +66,7 @@ get_target_sessions(char *taglist, Targe
         /*
          * legal row? 
          */
-        if (targaddrs->tDomain == NULL ||
-            targaddrs->tAddress == NULL ||
+        if (targaddrs->tAddress == NULL ||
             targaddrs->rowStatus != SNMP_ROW_ACTIVE) {
             DEBUGMSGTL(("target_sessions", "  which is not ready yet\n"));
             continue;
diff -urpN net-snmp-5.8/agent/mibgroup/target/target_counters.c net-snmp-5.9.1/agent/mibgroup/target/target_counters.c
--- net-snmp-5.8/agent/mibgroup/target/target_counters.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/target/target_counters.c	2021-05-26 05:19:35.000000000 +0700
@@ -15,7 +15,7 @@
 
 #include <net-snmp/agent/snmp_get_statistic.h>
 
-netsnmp_feature_require(helper_statistics)
+netsnmp_feature_require(helper_statistics);
 
 void
 init_target_counters(void)
diff -urpN net-snmp-5.8/agent/mibgroup/tcp-mib/data_access/tcpConn_freebsd4.c net-snmp-5.9.1/agent/mibgroup/tcp-mib/data_access/tcpConn_freebsd4.c
--- net-snmp-5.8/agent/mibgroup/tcp-mib/data_access/tcpConn_freebsd4.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/tcp-mib/data_access/tcpConn_freebsd4.c	2021-05-26 05:19:35.000000000 +0700
@@ -163,7 +163,11 @@ _load(netsnmp_container *container, u_in
 #else
 	xig = (struct xinpgen *) ((char *) xig + xig->xig_len);
 #endif
+#if __FreeBSD_version >= 1200026
+	state = StateMap[pcb.t_state];
+#else
 	state = StateMap[pcb.xt_tp.t_state];
+#endif
 
 	if (load_flags) {
 	    if (state == TCPCONNECTIONSTATE_LISTEN) {
diff -urpN net-snmp-5.8/agent/mibgroup/tcp-mib/data_access/tcpConn_linux.c net-snmp-5.9.1/agent/mibgroup/tcp-mib/data_access/tcpConn_linux.c
--- net-snmp-5.8/agent/mibgroup/tcp-mib/data_access/tcpConn_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/tcp-mib/data_access/tcpConn_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -133,7 +133,7 @@ _load4(netsnmp_container *container, u_i
     }
     
     setvbuf(in, rbuf, _IOFBF, rbufsize);
-    fgets(line, sizeof(line), in); /* skip header */
+    NETSNMP_IGNORE_RESULT(fgets(line, sizeof(line), in)); /* skip header */
 
     /*
      *   sl  local_address rem_address   st tx_queue rx_queue tr tm->when retrnsmt   uid  timeout inode
@@ -278,7 +278,7 @@ _load6(netsnmp_container *container, u_i
     }
 
     setvbuf(in, rbuf, _IOFBF, rbufsize);
-    fgets(line, sizeof(line), in); /* skip header */
+    NETSNMP_IGNORE_RESULT(fgets(line, sizeof(line), in)); /* skip header */
 
     /*
      * Note: PPC (big endian)
diff -urpN net-snmp-5.8/agent/mibgroup/tcp-mib/data_access/tcpConn_openbsd.c net-snmp-5.9.1/agent/mibgroup/tcp-mib/data_access/tcpConn_openbsd.c
--- net-snmp-5.8/agent/mibgroup/tcp-mib/data_access/tcpConn_openbsd.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/tcp-mib/data_access/tcpConn_openbsd.c	2021-05-26 05:19:35.000000000 +0700
@@ -218,8 +218,8 @@ static int
 _load(netsnmp_container *container, u_int load_flags)
 {
     struct inpcbtable table;
-    struct inpcb   *head, *next, *prev;
-    struct inpcb   inpcb;
+    struct inpcb   *next, *prev;
+    struct inpcb   inpcb, previnpcb;
     struct tcpcb   tcpcb;
     int      StateMap[] = { 1, 2, 3, 4, 5, 8, 6, 10, 9, 7, 11 };
     netsnmp_tcpconn_entry  *entry;
@@ -234,21 +234,28 @@ _load(netsnmp_container *container, u_in
 	return -1;
     }
 
-    prev = (struct inpcb *)&CIRCLEQ_FIRST(&table.inpt_queue);
+    next = (struct inpcb *)&TAILQ_FIRST(&table.inpt_queue);
     prev = NULL;
-    head = next = CIRCLEQ_FIRST(&table.inpt_queue);
 
     while (next) {
 	if (!NETSNMP_KLOOKUP(next, (char *)&inpcb, sizeof(inpcb))) {
 	    DEBUGMSGTL(("tcp-mib/data_access/tcpConn", "klookup inpcb failed\n"));
 	    break;
 	}
-	if (prev && CIRCLEQ_PREV(&inpcb, inp_queue) != prev) {
-	    snmp_log(LOG_ERR,"tcbtable link error\n");
-	    break;
+	if (prev != NULL) {
+		if (!NETSNMP_KLOOKUP(prev, (char *)&previnpcb,
+		    sizeof(previnpcb))) {
+			DEBUGMSGTL(("tcp-mib/data_access/tcpConn",
+			    "klookup previnpcb failed\n"));
+			break;
+		}
+		if (TAILQ_NEXT(&previnpcb, inp_queue) != next) {
+		    snmp_log(LOG_ERR,"tcbtable link error\n");
+		    break;
+		}
 	}
 	prev = next;
-	next = CIRCLEQ_NEXT(&inpcb, inp_queue);
+	next = TAILQ_NEXT(&inpcb, inp_queue);
 	if (!NETSNMP_KLOOKUP(inpcb.inp_ppcb, (char *)&tcpcb, sizeof(tcpcb))) {
 	    DEBUGMSGTL(("tcp-mib/data_access/tcpConn", "klookup tcpcb failed\n"));
 	    break;
@@ -260,19 +267,19 @@ _load(netsnmp_container *container, u_in
 		if (load_flags & NETSNMP_ACCESS_TCPCONN_LOAD_NOLISTEN) {
 		    DEBUGMSGT(("verbose:access:tcpconn:container",
 			       " skipping listen\n"));
-		    goto skip;
+		    continue;
 		}
 	    }
 	    else if (load_flags & NETSNMP_ACCESS_TCPCONN_LOAD_ONLYLISTEN) {
 		DEBUGMSGT(("verbose:access:tcpconn:container",
 			    " skipping non-listen\n"));
-		goto skip;
+		continue;
 	    }
 	}
 
 #if !defined(NETSNMP_ENABLE_IPV6)
         if (inpcb.inp_flags & INP_IPV6)
-	    goto skip;
+	    continue;
 #endif
 
         entry = netsnmp_access_tcpconn_entry_create();
@@ -306,9 +313,6 @@ _load(netsnmp_container *container, u_in
          */
         entry->arbitrary_index = CONTAINER_SIZE(container) + 1;
         CONTAINER_INSERT(container, entry);
-skip:
-	if (head == next)
-	    break;
     }
 
     if(rc<0)
diff -urpN net-snmp-5.8/agent/mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable.c net-snmp-5.9.1/agent/mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable.c
--- net-snmp-5.8/agent/mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -345,9 +345,8 @@ tcpConnectionTable_indexes_set_tbl_idx(t
     /*
      * make sure there is enough space for tcpConnectionLocalAddress data
      */
-    if ((NULL == tbl_idx->tcpConnectionLocalAddress) ||
-        (tbl_idx->tcpConnectionLocalAddress_len <
-         (tcpConnectionLocalAddress_val_ptr_len))) {
+    if (tbl_idx->tcpConnectionLocalAddress_len <
+        tcpConnectionLocalAddress_val_ptr_len) {
         snmp_log(LOG_ERR, "not enough space for value\n");
         return MFD_ERROR;
     }
@@ -378,9 +377,8 @@ tcpConnectionTable_indexes_set_tbl_idx(t
     /*
      * make sure there is enough space for tcpConnectionRemAddress data
      */
-    if ((NULL == tbl_idx->tcpConnectionRemAddress) ||
-        (tbl_idx->tcpConnectionRemAddress_len <
-         (tcpConnectionRemAddress_val_ptr_len))) {
+    if (tbl_idx->tcpConnectionRemAddress_len <
+        tcpConnectionRemAddress_val_ptr_len) {
         snmp_log(LOG_ERR, "not enough space for value\n");
         return MFD_ERROR;
     }
diff -urpN net-snmp-5.8/agent/mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_interface.c net-snmp-5.9.1/agent/mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_interface.c
--- net-snmp-5.8/agent/mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/tcp-mib/tcpConnectionTable/tcpConnectionTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,17 +47,17 @@
 
 #include <ctype.h>
 
-netsnmp_feature_child_of(tcpConnectionTable_external_access, libnetsnmpmibs)
+netsnmp_feature_child_of(tcpConnectionTable_external_access, libnetsnmpmibs);
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(check_all_requests_error);
 
 
-netsnmp_feature_child_of(tcpConnectionTable_container_size, tcpConnectionTable_external_access)
-netsnmp_feature_child_of(tcpConnectionTable_registration_set, tcpConnectionTable_external_access)
-netsnmp_feature_child_of(tcpConnectionTable_registration_get, tcpConnectionTable_external_access)
-netsnmp_feature_child_of(tcpConnectionTable_container_get, tcpConnectionTable_external_access)
+netsnmp_feature_child_of(tcpConnectionTable_container_size, tcpConnectionTable_external_access);
+netsnmp_feature_child_of(tcpConnectionTable_registration_set, tcpConnectionTable_external_access);
+netsnmp_feature_child_of(tcpConnectionTable_registration_get, tcpConnectionTable_external_access);
+netsnmp_feature_child_of(tcpConnectionTable_container_get, tcpConnectionTable_external_access);
 
 /**********************************************************************
  **********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable.c net-snmp-5.9.1/agent/mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable.c
--- net-snmp-5.8/agent/mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -314,9 +314,8 @@ tcpListenerTable_indexes_set_tbl_idx(tcp
     /*
      * make sure there is enough space for tcpListenerLocalAddress data
      */
-    if ((NULL == tbl_idx->tcpListenerLocalAddress) ||
-        (tbl_idx->tcpListenerLocalAddress_len <
-         (tcpListenerLocalAddress_val_ptr_len))) {
+    if (tbl_idx->tcpListenerLocalAddress_len <
+        tcpListenerLocalAddress_val_ptr_len) {
         snmp_log(LOG_ERR, "not enough space for value\n");
         return MFD_ERROR;
     }
diff -urpN net-snmp-5.8/agent/mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_interface.c net-snmp-5.9.1/agent/mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_interface.c
--- net-snmp-5.8/agent/mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/tcp-mib/tcpListenerTable/tcpListenerTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,17 +47,17 @@
 
 #include <ctype.h>
 
-netsnmp_feature_child_of(tcpListenerTable_external_access, libnetsnmpmibs)
+netsnmp_feature_child_of(tcpListenerTable_external_access, libnetsnmpmibs);
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(check_all_requests_error);
 
 
-netsnmp_feature_child_of(tcpListenerTable_container_size, tcpListenerTable_external_access)
-netsnmp_feature_child_of(tcpListenerTable_registration_set, tcpListenerTable_external_access)
-netsnmp_feature_child_of(tcpListenerTable_registration_get, tcpListenerTable_external_access)
-netsnmp_feature_child_of(tcpListenerTable_container_get, tcpListenerTable_external_access)
+netsnmp_feature_child_of(tcpListenerTable_container_size, tcpListenerTable_external_access);
+netsnmp_feature_child_of(tcpListenerTable_registration_set, tcpListenerTable_external_access);
+netsnmp_feature_child_of(tcpListenerTable_registration_get, tcpListenerTable_external_access);
+netsnmp_feature_child_of(tcpListenerTable_container_get, tcpListenerTable_external_access);
 
 /**********************************************************************
  **********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/testhandler.c net-snmp-5.9.1/agent/mibgroup/testhandler.c
--- net-snmp-5.8/agent/mibgroup/testhandler.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/testhandler.c	2021-05-26 05:19:35.000000000 +0700
@@ -10,10 +10,10 @@
 #include <strings.h>
 #endif
 
-netsnmp_feature_require(ulong_instance)
-netsnmp_feature_require(register_read_only_table_data)
-netsnmp_feature_require(table_build_result)
-netsnmp_feature_require(table_dataset)
+netsnmp_feature_require(ulong_instance);
+netsnmp_feature_require(register_read_only_table_data);
+netsnmp_feature_require(table_build_result);
+netsnmp_feature_require(table_dataset);
 
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
diff -urpN net-snmp-5.8/agent/mibgroup/tlstm-mib/snmpTlstmAddrTable/snmpTlstmAddrTable.c net-snmp-5.9.1/agent/mibgroup/tlstm-mib/snmpTlstmAddrTable/snmpTlstmAddrTable.c
--- net-snmp-5.8/agent/mibgroup/tlstm-mib/snmpTlstmAddrTable/snmpTlstmAddrTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/tlstm-mib/snmpTlstmAddrTable/snmpTlstmAddrTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,15 +13,15 @@
 #include "tlstm-mib.h"
 #include "snmpTlstmAddrTable.h"
 
-netsnmp_feature_require(table_tdata)
-netsnmp_feature_require(tlstmaddr_container)
-netsnmp_feature_require(table_tdata_delete_table)
-netsnmp_feature_require(table_tdata_extract_table)
-netsnmp_feature_require(table_tdata_remove_row)
+netsnmp_feature_require(table_tdata);
+netsnmp_feature_require(tlstmaddr_container);
+netsnmp_feature_require(table_tdata_delete_table);
+netsnmp_feature_require(table_tdata_extract_table);
+netsnmp_feature_require(table_tdata_remove_row);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_storagetype)
-netsnmp_feature_require(check_vb_type_and_max_size)
-netsnmp_feature_require(table_tdata_insert_row)
+netsnmp_feature_require(check_vb_storagetype);
+netsnmp_feature_require(check_vb_type_and_max_size);
+netsnmp_feature_require(table_tdata_insert_row);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /** XXX - move these to table_data header? */
@@ -83,7 +83,6 @@ typedef struct tlstmAddrTable_entry_s {
     /*
      * user data
      */
-    struct netsnmp_cert_s   *cert;
     char                     addr_flags;
 
 } tlstmAddrTable_entry;
@@ -118,6 +117,7 @@ init_snmpTlstmAddrTable(void)
     netsnmp_table_registration_info *table_info;
     netsnmp_cache                   *cache;
     netsnmp_watcher_info            *watcher;
+    int             rc;
 
     DEBUGMSGTL(("tlstmAddrTable:init",
                 "initializing table tlstmAddrTable\n"));
@@ -167,9 +167,13 @@ init_snmpTlstmAddrTable(void)
     table_info->min_column = TLSTMADDRTABLE_MIN_COLUMN;
     table_info->max_column = TLSTMADDRTABLE_MAX_COLUMN;
 
-    netsnmp_tdata_register(reg, _table_data, table_info);
-
-    if (cache) 
+    rc = netsnmp_tdata_register(reg, _table_data, table_info);
+    if (rc) {
+        snmp_log(LOG_ERR, "%s: netsnmp_tdata_register() returned %d\n",
+                 __func__, rc);
+        return;
+    }
+    if (cache)
         netsnmp_inject_handler_before( reg, netsnmp_cache_handler_get(cache),
                                        "table_container");
 
@@ -185,8 +189,13 @@ init_snmpTlstmAddrTable(void)
         snmp_log(LOG_ERR,
                  "could not create handler for snmpTlstmAddrCount\n");
     else {
-        netsnmp_register_scalar(reg);
-        if (cache) 
+        const int rc = netsnmp_register_scalar(reg);
+        if (rc) {
+            snmp_log(LOG_ERR, "%s: netsnmp_register_scalar() returned %d\n",
+                     __func__, rc);
+            return;
+        }
+        if (cache)
             netsnmp_inject_handler_before(reg,
                                           netsnmp_cache_handler_get(cache),
                                           "snmpTlstmAddrCount");
@@ -331,8 +340,8 @@ tlstmAddrTable_removeEntry(netsnmp_tdata
     DEBUGIF("tlstmAddrTable:entry:delete") {
         char name[sizeof(entry->snmpTargetAddrName)+1];
         snprintf(name, sizeof(name), "%s", entry->snmpTargetAddrName);
-        DEBUGMSGT(("tlstmAddrTable:entry:delete", "entry %s %p / row %p\n",
-                   name, entry, row));
+        DEBUGMSGT(("tlstmAddrTable:entry:delete", "entry %s %p\n", name,
+                   entry));
     }
     if (entry && entry->undo)
         _freeUndo(entry);
@@ -844,7 +853,7 @@ tlstmAddrTable_handler(netsnmp_mib_handl
 
             /** release undo data for requests with no rowstatus */
             if (table_entry->undo &&
-                !table_entry->undo->req[COLUMN_SNMPTLSTMADDRROWSTATUS] != 0) {
+                table_entry->undo->req[COLUMN_SNMPTLSTMADDRROWSTATUS] == NULL) {
 
                 _freeUndo(table_entry);
 
diff -urpN net-snmp-5.8/agent/mibgroup/tlstm-mib/snmpTlstmCertToTSNTable/snmpTlstmCertToTSNTable.c net-snmp-5.9.1/agent/mibgroup/tlstm-mib/snmpTlstmCertToTSNTable/snmpTlstmCertToTSNTable.c
--- net-snmp-5.8/agent/mibgroup/tlstm-mib/snmpTlstmCertToTSNTable/snmpTlstmCertToTSNTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/tlstm-mib/snmpTlstmCertToTSNTable/snmpTlstmCertToTSNTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,17 +13,17 @@
 #include "tlstm-mib.h"
 #include "snmpTlstmCertToTSNTable.h"
 
-netsnmp_feature_require(table_tdata)
-netsnmp_feature_require(cert_fingerprints)
-netsnmp_feature_require(table_tdata_delete_table)
-netsnmp_feature_require(table_tdata_extract_table)
-netsnmp_feature_require(table_tdata_remove_row)
-netsnmp_feature_require(tls_fingerprint_build)
+netsnmp_feature_require(table_tdata);
+netsnmp_feature_require(cert_fingerprints);
+netsnmp_feature_require(table_tdata_delete_table);
+netsnmp_feature_require(table_tdata_extract_table);
+netsnmp_feature_require(table_tdata_remove_row);
+netsnmp_feature_require(tls_fingerprint_build);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_storagetype)
-netsnmp_feature_require(check_vb_type_and_max_size)
-netsnmp_feature_require(check_vb_rowstatus_with_storagetype)
-netsnmp_feature_require(table_tdata_insert_row)
+netsnmp_feature_require(check_vb_storagetype);
+netsnmp_feature_require(check_vb_type_and_max_size);
+netsnmp_feature_require(check_vb_rowstatus_with_storagetype);
+netsnmp_feature_require(table_tdata_insert_row);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /** XXX - move these to table_data header? */
@@ -119,8 +119,9 @@ init_snmpTlstmCertToTSNTable_context(con
     netsnmp_table_registration_info *info;
     netsnmp_cache                   *cache;
     netsnmp_watcher_info            *watcher;
-    const char *mib_map_help = 
+    static const char mib_map_help[] =
         MAP_MIB_CONFIG_TOKEN " table persistence (internal use)";
+    int rc;
 
     DEBUGMSGTL(("tlstmCertToSN:init",
                 "initializing table tlstmCertToTSNTable\n"));
@@ -175,9 +176,13 @@ init_snmpTlstmCertToTSNTable_context(con
     cache->magic = (void *)_table;
     cache->flags = NETSNMP_CACHE_DONT_INVALIDATE_ON_SET;
 
-    netsnmp_tdata_register(reg, _table, info);
-
-    if (cache) 
+    rc = netsnmp_tdata_register(reg, _table, info);
+    if (rc) {
+        snmp_log(LOG_ERR, "%s: netsnmp_tdata_register() returned %d\n",
+                 __func__, rc);
+        return;
+    }
+    if (cache)
         netsnmp_inject_handler_before( reg, netsnmp_cache_handler_get(cache),
                                        "table_container");
 
@@ -193,11 +198,18 @@ init_snmpTlstmCertToTSNTable_context(con
         snmp_log(LOG_ERR,
                  "could not create handler for snmpTlstmCertToTSNCount\n");
     else {
+        int rc;
+
         if (NULL != contextName)
             reg->contextName = strdup(contextName);
 
-        netsnmp_register_scalar(reg);
-        if (cache) 
+        rc = netsnmp_register_scalar(reg);
+        if (rc) {
+            snmp_log(LOG_ERR, "%s: netsnmp_register_scalar() returned %d\n",
+                     __func__, rc);
+            return;
+        }
+        if (cache)
             netsnmp_inject_handler_before(reg, netsnmp_cache_handler_get(cache),
                                           "snmpTlstmCertToTSNCount");
     }
@@ -956,8 +968,7 @@ _cert_map_add(certToTSN_entry *entry)
 
     map->priority = entry->tlstmCertToTSNID;
     map->mapType = entry->mapType;
-    if (entry->data)
-        map->data = strdup(entry->data);
+    map->data = strdup(entry->data);
     map->hashType = entry->hashType;
 
     map->flags = NSCM_FROM_MIB;
@@ -1302,8 +1313,8 @@ _save_maps(int majorID, int minorID, voi
                 continue;
             _save_map(map, RS_ACTIVE, type);
         }
+        ITERATOR_RELEASE(map_itr);
     }
-    ITERATOR_RELEASE(map_itr);
 
     /*
      * save inactive rows from mib
diff -urpN net-snmp-5.8/agent/mibgroup/tlstm-mib/snmpTlstmParamsTable/snmpTlstmParamsTable.c net-snmp-5.9.1/agent/mibgroup/tlstm-mib/snmpTlstmParamsTable/snmpTlstmParamsTable.c
--- net-snmp-5.8/agent/mibgroup/tlstm-mib/snmpTlstmParamsTable/snmpTlstmParamsTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/tlstm-mib/snmpTlstmParamsTable/snmpTlstmParamsTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -15,18 +15,18 @@
 
 #include "snmpTlstmParamsTable.h"
 
-netsnmp_feature_require(table_tdata)
-netsnmp_feature_require(tlstmparams_find)
-netsnmp_feature_require(tlstmparams_external)
-netsnmp_feature_require(cert_fingerprints)
-netsnmp_feature_require(table_tdata_delete_table)
-netsnmp_feature_require(table_tdata_extract_table)
-netsnmp_feature_require(table_tdata_remove_row)
+netsnmp_feature_require(table_tdata);
+netsnmp_feature_require(tlstmparams_find);
+netsnmp_feature_require(tlstmparams_external);
+netsnmp_feature_require(cert_fingerprints);
+netsnmp_feature_require(table_tdata_delete_table);
+netsnmp_feature_require(table_tdata_extract_table);
+netsnmp_feature_require(table_tdata_remove_row);
 #ifndef NETSNMP_NO_WRITE_SUPPORT
-netsnmp_feature_require(check_vb_storagetype)
-netsnmp_feature_require(check_vb_type_and_max_size)
-netsnmp_feature_require(check_vb_rowstatus_with_storagetype)
-netsnmp_feature_require(table_tdata_insert_row)
+netsnmp_feature_require(check_vb_storagetype);
+netsnmp_feature_require(check_vb_type_and_max_size);
+netsnmp_feature_require(check_vb_rowstatus_with_storagetype);
+netsnmp_feature_require(table_tdata_insert_row);
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
 
 /** XXX - move these to table_data header? */
@@ -104,6 +104,7 @@ init_snmpTlstmParamsTable(void)
     netsnmp_table_registration_info *table_info;
     netsnmp_cache                   *cache;
     netsnmp_watcher_info            *watcher;
+    int                              rc;
 
     DEBUGMSGTL(("tlstmParamsTable:init", "initializing table snmpTlstmParamsTable\n"));
 
@@ -147,9 +148,14 @@ init_snmpTlstmParamsTable(void)
     table_info->min_column = SNMPTLSTMPARAMSTABLE_MIN_COLUMN;
     table_info->max_column = SNMPTLSTMPARAMSTABLE_MAX_COLUMN;
     
-    netsnmp_tdata_register( reg, _table_data, table_info );
-    netsnmp_inject_handler_before( reg, netsnmp_cache_handler_get(cache),
-                                   "table_container");
+    rc = netsnmp_tdata_register(reg, _table_data, table_info);
+    if (rc) {
+        snmp_log(LOG_ERR, "%s: netsnmp_tdata_register() returned %d\n",
+                 __func__, rc);
+        return;
+    }
+    netsnmp_inject_handler_before(reg, netsnmp_cache_handler_get(cache),
+                                      "table_container");
 
     /*
      * register scalars
@@ -163,8 +169,13 @@ init_snmpTlstmParamsTable(void)
         snmp_log(LOG_ERR,
                  "could not create handler for snmpTlstmParamsCount\n");
     else {
-        netsnmp_register_scalar(reg);
-        if (cache) 
+        const int rc = netsnmp_register_scalar(reg);
+        if (rc) {
+            snmp_log(LOG_ERR, "%s: netsnmp_register_scalar() returned %d\n",
+                     __func__, rc);
+            return;
+        }
+        if (cache)
             netsnmp_inject_handler_before(reg,
                                           netsnmp_cache_handler_get(cache),
                                           "snmpTlstmParamsCount");
@@ -951,7 +962,7 @@ snmpTlstmParamsTable_handler(
 
             /** release undo data for requests with no rowstatus */
             if (table_entry->undo &&
-                !table_entry->undo->req[COLUMN_SNMPTLSTMPARAMSROWSTATUS] != 0) {
+                table_entry->undo->req[COLUMN_SNMPTLSTMPARAMSROWSTATUS] == NULL) {
                 _freeUndo(table_entry);
                 
                 /** update active addrs */
diff -urpN net-snmp-5.8/agent/mibgroup/tsm-mib/snmpTsmStats/snmpTsmStats.c net-snmp-5.9.1/agent/mibgroup/tsm-mib/snmpTsmStats/snmpTsmStats.c
--- net-snmp-5.8/agent/mibgroup/tsm-mib/snmpTsmStats/snmpTsmStats.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/tsm-mib/snmpTsmStats/snmpTsmStats.c	2021-05-26 05:19:35.000000000 +0700
@@ -11,9 +11,9 @@
 
 static netsnmp_handler_registration* _myreg = NULL;
 
-netsnmp_feature_require(helper_statistics)
+netsnmp_feature_require(helper_statistics);
 
-netsnmp_feature_child_of(shutdown_snmptsmsession, netsnmp_unused)
+netsnmp_feature_child_of(shutdown_snmptsmsession, netsnmp_unused);
 
 /** Initializes the snmpTsmStats module */
 void
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/disk.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/disk.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/disk.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/disk.c	2021-05-26 05:19:35.000000000 +0700
@@ -507,6 +507,16 @@ find_and_add_allDisks(int minpercent)
      */
   }
 #endif /* HAVE_SETMNTENT */
+#elif defined(HAVE_GETMNTINFO)
+  if (1) {
+    struct statfs *mntbuf;
+    size_t i, mntsize;
+    mntsize = getmntinfo(&mntbuf, MNT_NOWAIT);
+    for (i = 0; i < mntsize; i++) {
+	add_device(mntbuf[i].f_mntonname, mntbuf[i].f_mntfromname, -1,
+                   minpercent, 0);
+    }
+  }
 #elif HAVE_FSTAB_H
   setfsent();			/* open /etc/fstab */
   while((fstab1 = getfsent()) != NULL) {
@@ -514,18 +524,6 @@ find_and_add_allDisks(int minpercent)
     dummy = 1;
   }
   endfsent();			/* close /etc/fstab */
-#if defined(__FreeBSD__) && __FreeBSD_version >= 700055
-  {
-    struct statfs *mntbuf;
-    size_t i, mntsize;
-    mntsize = getmntinfo(&mntbuf, MNT_NOWAIT);
-    for (i = 0; i < mntsize; i++) {
-      if (strncmp(mntbuf[i].f_fstypename, "zfs", 3) == 0) {
-	add_device(mntbuf[i].f_mntonname, mntbuf[i].f_mntfromname, -1, minpercent, 0);
-      }
-    }
-  }
-#endif
   if(dummy != 0) {
     /*
      * dummy clause for else below
@@ -825,6 +823,7 @@ var_extensible_disk(struct variable *vp,
     struct dsk_entry entry;
     static long     long_ret;
     static char    *errmsg;
+    static char     empty_str[1];
 
 tryAgain:
     if (header_simple_table
@@ -926,7 +925,7 @@ tryAgain:
                 *var_len = strlen(errmsg);
             }
         }
-        return (u_char *) (errmsg);
+        return (u_char *)(errmsg ? errmsg : empty_str);
     }
     return NULL;
 }
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/disk_hw.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/disk_hw.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/disk_hw.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/disk_hw.c	2021-05-26 05:19:35.000000000 +0700
@@ -314,6 +314,7 @@ var_extensible_disk(struct variable *vp,
     unsigned long long val;
     static long     long_ret;
     static char    *errmsg;
+    static char     empty_str[1];
     netsnmp_cache  *cache;
 
     /* Update the fsys H/W module */
@@ -432,7 +433,7 @@ tryAgain:
              >= 0)) {
             *var_len = strlen(errmsg);
         }
-        return (u_char *) errmsg;
+        return (u_char *)(errmsg ? errmsg : empty_str);
     }
     return NULL;
 }
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/diskio.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/diskio.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/diskio.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/diskio.c	2021-05-26 05:19:35.000000000 +0700
@@ -1364,6 +1364,7 @@ static int get_sysfs_stats(void)
 static int
 getstats(void)
 {
+    struct stat stbuf;
     FILE* parts;
     time_t now;
     
@@ -1412,6 +1413,10 @@ getstats(void)
 	        head.length++;
 	}
     }
+    else if (stat("/proc/vz", &stbuf) == 0) {
+        /* OpenVZ / Virtuozzo containers do not have /proc/diskstats */
+        goto update_cache_time;
+    }
     else {
 	/* See if a 2.4 kernel */
 	char buffer[1024];
@@ -1425,8 +1430,8 @@ getstats(void)
 	/*
 	 * first few fscanfs are garbage we don't care about. skip it.
 	 */
-	fgets(buffer, sizeof(buffer), parts);
-	fgets(buffer, sizeof(buffer), parts);
+	NETSNMP_IGNORE_RESULT(fgets(buffer, sizeof(buffer), parts));
+	NETSNMP_IGNORE_RESULT(fgets(buffer, sizeof(buffer), parts));
 
 	while (! feof(parts)) {
 	    linux_diskio* pTemp;
@@ -1453,6 +1458,8 @@ getstats(void)
     }
 
     fclose(parts);
+
+update_cache_time:
     cache_time = now;
     return 0;
 }
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/dlmod.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/dlmod.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/dlmod.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/dlmod.c	2021-05-26 05:19:35.000000000 +0700
@@ -186,8 +186,7 @@ dlmod_load_module(struct dlmod *dlm)
     DEBUGMSGTL(("dlmod", "dlmod_load_module %s: %s\n", dlm->name,
                 dlm->path));
 
-    if (!dlm || !dlm->path || !dlm->name ||
-        (dlm->status != DLMOD_UNLOADED && dlm->status != DLMOD_ERROR))
+    if (!dlm || (dlm->status != DLMOD_UNLOADED && dlm->status != DLMOD_ERROR))
         return;
 
     free(dlm->error);
@@ -701,7 +700,7 @@ init_dlmod(void)
     DEBUGMSGTL(("dlmod", "dlmod_path: %s\n", dlmod_path));
 }
 
-netsnmp_feature_require(snmpd_unregister_config_handler)
+netsnmp_feature_require(snmpd_unregister_config_handler);
 
 void
 shutdown_dlmod(void)
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/extensible.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/extensible.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/extensible.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/extensible.c	2021-05-26 05:19:35.000000000 +0700
@@ -111,8 +111,8 @@
 #include "utilities/execute.h"
 #include "util_funcs/header_simple_table.h"
 
-netsnmp_feature_require(get_exten_instance)
-netsnmp_feature_require(parse_miboid)
+netsnmp_feature_require(get_exten_instance);
+netsnmp_feature_require(parse_miboid);
 
 /*
  * the relocatable extensible commands variables 
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/extensible.h net-snmp-5.9.1/agent/mibgroup/ucd-snmp/extensible.h
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/extensible.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/extensible.h	2021-05-26 05:19:35.000000000 +0700
@@ -7,6 +7,7 @@
 
 void            init_extensible(void);
 
+config_require(ucd-snmp/pass)
 config_require(util_funcs/header_simple_table)
 config_require(util_funcs)
 config_require(utilities/execute)
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/lmSensors.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/lmSensors.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/lmSensors.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/lmSensors.c	2021-05-26 05:19:35.000000000 +0700
@@ -77,7 +77,7 @@
 #include "util_funcs/header_simple_table.h"
 #include <time.h>
 
-netsnmp_feature_require(table_container)
+netsnmp_feature_require(table_container);
 
 
 /*
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/lmsensorsMib.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/lmsensorsMib.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/lmsensorsMib.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/lmsensorsMib.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,3 +1,7 @@
+#ifdef HAVE_INTTYPES_H
+#include <inttypes.h>
+#endif
+
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
@@ -90,7 +94,11 @@ initialize_lmSensorsTable(const char *ta
     netsnmp_table_helper_add_indexes(table_info, ASN_INTEGER, 0);
     table_info->min_column = COLUMN_LMSENSORS_INDEX;
     table_info->max_column = COLUMN_LMSENSORS_VALUE;
-    netsnmp_container_table_register( reg, table_info, container, 0 );
+    if (netsnmp_container_table_register(reg, table_info, container, 0) !=
+        SNMPERR_SUCCESS) {
+        snmp_log(LOG_ERR, "Failed to register the sensors container table\n");
+        return;
+    }
 
     /*
      * If the HAL sensors module was configured as an on-demand caching
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/memory.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/memory.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/memory.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/memory.c	2021-05-26 05:19:35.000000000 +0700
@@ -26,7 +26,7 @@ init_memory(void)
         netsnmp_create_handler_registration("memory", handle_memory,
                                  memory_oid, OID_LENGTH(memory_oid),
                                              HANDLER_CAN_RONLY),
-                                 1, 26);
+                                 1, 27);
     netsnmp_register_scalar(
         netsnmp_create_handler_registration("memSwapError", handle_memory,
                            memSwapError_oid, OID_LENGTH(memSwapError_oid),
@@ -272,6 +272,16 @@ handle_memory(netsnmp_mib_handler *handl
 	    c64.low = val & 0xFFFFFFFF;
 	    c64.high = val >>32;
             break;
+        case MEMORY_SYS_AVAIL:
+	    type = ASN_COUNTER64;
+            mem_info = netsnmp_memory_get_byIdx(NETSNMP_MEM_TYPE_AVAILMEM, 0);
+            if (!mem_info)
+                goto NOSUCH;
+            val = mem_info->size;       /* memavail */
+            val *= (mem_info->units/1024);
+	    c64.low = val & 0xFFFFFFFF;
+	    c64.high = val >> 32;
+            break;
         case MEMORY_SWAP_ERROR:
             mem_info = netsnmp_memory_get_byIdx( NETSNMP_MEM_TYPE_SWAP, 0 );
             if (!mem_info)
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/memory.h net-snmp-5.9.1/agent/mibgroup/ucd-snmp/memory.h
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/memory.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/memory.h	2021-05-26 05:19:35.000000000 +0700
@@ -41,6 +41,7 @@ Netsnmp_Node_Handler handle_memory;
 #define MEMORY_SHARED_X     24
 #define MEMORY_BUFFER_X     25
 #define MEMORY_CACHED_X     26
+#define MEMORY_SYS_AVAIL    27
 #define MEMORY_SWAP_ERROR  100
 #define MEMORY_SWAP_ERRMSG 101
 #endif                          /* MEMORY_H */
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/memory_darwin7.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/memory_darwin7.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/memory_darwin7.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/memory_darwin7.c	2021-05-26 05:19:35.000000000 +0700
@@ -36,10 +36,6 @@
 #include <mach/mach.h>
 #include <dirent.h>
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 #include <net-snmp/agent/auto_nlist.h>
@@ -385,9 +381,23 @@ int pages_swapped(void) {
 
             swapped_pages = 0;
             for (address = 0;; address += size) {
+                kern_return_t ret = KERN_FAILURE;
+
                 /* Get memory region. */
-                count = VM_REGION_EXTENDED_INFO_COUNT; 
-                if (vm_region(tasks[j], &address, &size, VM_REGION_EXTENDED_INFO, (vm_region_extended_info_t)&info, &count, &object_name) != KERN_SUCCESS) {
+                count = VM_REGION_EXTENDED_INFO_COUNT;
+#if HAVE_VM_REGION_64
+                ret = vm_region64(tasks[j], &address, &size,
+                                  VM_REGION_EXTENDED_INFO,
+                                  (vm_region_extended_info_t)&info, &count,
+                                  &object_name);
+#elif HAVE_VM_REGION
+                ret = vm_region(tasks[j], &address, &size,
+                                VM_REGION_EXTENDED_INFO,
+                                (vm_region_extended_info_t)&info, &count,
+                                &object_name);
+#error How to query memory protection information?
+#endif
+                if (ret != KERN_SUCCESS) {
                     /* No more memory regions. */
                     break;
                 }
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/pass.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/pass.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/pass.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/pass.c	2021-05-26 05:19:35.000000000 +0700
@@ -37,8 +37,8 @@
 #include "extensible.h"
 #include "util_funcs.h"
 
-netsnmp_feature_require(get_exten_instance)
-netsnmp_feature_require(parse_miboid)
+netsnmp_feature_require(get_exten_instance);
+netsnmp_feature_require(parse_miboid);
 
 struct extensible *passthrus = NULL;
 int             numpassthrus = 0;
@@ -323,9 +323,9 @@ setPass(int action, u_char * var_val, u_
 int
 pass_compare(const void *a, const void *b)
 {
-    const struct extensible *const *ap, *const *bp;
-    ap = (const struct extensible * const *) a;
-    bp = (const struct extensible * const *) b;
+    const struct extensible *const *ap = a;
+    const struct extensible *const *bp = b;
+
     return snmp_oid_compare((*ap)->miboid, (*ap)->miblen, (*bp)->miboid,
                             (*bp)->miblen);
 }
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/pass_persist.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/pass_persist.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/pass_persist.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/pass_persist.c	2021-05-26 05:19:35.000000000 +0700
@@ -42,14 +42,14 @@
 #include "extensible.h"
 #include "util_funcs.h"
 
-netsnmp_feature_require(get_exten_instance)
-netsnmp_feature_require(parse_miboid)
+netsnmp_feature_require(get_exten_instance);
+netsnmp_feature_require(parse_miboid);
 
 struct extensible *persistpassthrus = NULL;
 int             numpersistpassthrus = 0;
 struct persist_pipe_type {
-    FILE           *fIn, *fOut;
-    int             fdIn, fdOut;
+    FILE           *fIn;
+    int             fdOut;
     netsnmp_pid_t   pid;
 }              *persist_pipes = (struct persist_pipe_type *) NULL;
 static unsigned pipe_check_alarm_id;
@@ -509,24 +509,22 @@ init_persist_pipes(void)
     /*
      * if we are already taken care of, just return 
      */
-    if (persist_pipes) {
-        return persist_pipes ? 1 : 0;
-    }
+    if (persist_pipes)
+        return 1;
 
     /*
      * Otherwise malloc and initialize 
      */
-    persist_pipes = (struct persist_pipe_type *)
-        malloc(sizeof(struct persist_pipe_type) *
-               (numpersistpassthrus + 1));
-    if (persist_pipes) {
-        for (i = 0; i <= numpersistpassthrus; i++) {
-            persist_pipes[i].fIn = persist_pipes[i].fOut = (FILE *) 0;
-            persist_pipes[i].fdIn = persist_pipes[i].fdOut = -1;
-            persist_pipes[i].pid = NETSNMP_NO_SUCH_PROCESS;
-        }
+    persist_pipes = malloc(sizeof(persist_pipes[0]) *
+                           (numpersistpassthrus + 1));
+    if (!persist_pipes)
+        return 0;
+    for (i = 0; i <= numpersistpassthrus; i++) {
+        persist_pipes[i].fIn = NULL;
+        persist_pipes[i].fdOut = -1;
+        persist_pipes[i].pid = NETSNMP_NO_SUCH_PROCESS;
     }
-    return persist_pipes ? 1 : 0;
+    return 1;
 }
 
 /**
@@ -538,10 +536,9 @@ init_persist_pipes(void)
 static int process_stopped(int idx)
 {
     if (persist_pipes[idx].pid != NETSNMP_NO_SUCH_PROCESS) {
-#if HAVE_SYS_WAIT_H
+#if HAVE_WAITPID
         return waitpid(persist_pipes[idx].pid, NULL, WNOHANG) > 0;
-#endif
-#if defined(WIN32) && !defined (mingw32) && !defined(HAVE_SIGNAL)
+#elif defined(WIN32) && !defined (mingw32) && !defined(HAVE_SIGNAL)
         return WaitForSingleObject(persist_pipes[idx].pid, 0) == WAIT_OBJECT_0;
 #endif
     }
@@ -623,15 +620,9 @@ open_persist_pipe(int iindex, char *comm
          * If not, fill out our structure 
          */
         persist_pipes[iindex].pid = pid;
-        persist_pipes[iindex].fdIn = fdIn;
         persist_pipes[iindex].fdOut = fdOut;
         persist_pipes[iindex].fIn = fdopen(fdIn, "r");
-        persist_pipes[iindex].fOut = fdopen(fdOut, "w");
 
-        /*
-         * Setup our -non-buffered-io- 
-         */
-        setbuf(persist_pipes[iindex].fOut, (char *) 0);
         DEBUGMSGTL(("ucd-snmp/pass_persist", "open_persist_pipe: opened the pipes\n"));
     }
 
@@ -683,12 +674,10 @@ open_persist_pipe(int iindex, char *comm
 static int
 write_persist_pipe(int iindex, const char *data)
 {
-#if HAVE_SIGNAL
-    struct sigaction sa, osa;
-    int             wret = 0, werrno = 0;
+    int             len, wret;
 
     /*
-     * Don't write to a non-existant process 
+     * Don't write to a non-existent process
      */
     if (persist_pipes[iindex].pid == NETSNMP_NO_SUCH_PROCESS) {
         DEBUGMSGTL(("ucd-snmp/pass_persist",
@@ -698,115 +687,42 @@ write_persist_pipe(int iindex, const cha
     }
 
     /*
-     * Setup our signal action to ignore SIGPIPEs 
-     */
-    sa.sa_handler = SIG_IGN;
-    sigemptyset(&sa.sa_mask);
-    sa.sa_flags = 0;
-    if (sigaction(SIGPIPE, &sa, &osa)) {
-        DEBUGMSGTL(("ucd-snmp/pass_persist",
-                    "write_persist_pipe: sigaction failed: %d", errno));
-    }
-
-    /*
      * Do the write 
      */
-    wret = write(persist_pipes[iindex].fdOut, data, strlen(data));
-    werrno = errno;
-
-    /*
-     * Reset the signal handler 
-     */
-    sigaction(SIGPIPE, &osa, (struct sigaction *) 0);
-
+    len = strlen(data);
+    wret = write(persist_pipes[iindex].fdOut, data, len);
+    if (wret == len)
+        return 1;
     if (wret < 0) {
+        int werrno = errno;
+
         if (werrno != EPIPE) {
             DEBUGMSGTL(("ucd-snmp/pass_persist",
-                        "write_persist_pipe: write returned unknown error %d (%s)\n",
+                        "write_persist_pipe: write returned unexpected error %d (%s)\n",
                         werrno, strerror(werrno)));
         }
         close_persist_pipe(iindex);
-        return 0;
-    }
-#endif                          /* HAVE_SIGNAL */
-#if defined(WIN32) && !defined (mingw32) && !defined (HAVE_SIGNAL)
-/* We have no signal here (maybe we can make a Thread?) so write may block, 
- * but probably never will.
- */
-    int wret = 0, werrno = 0;
-
-    /*
-     * Do the write 
-     */
-    wret = write(persist_pipes[iindex].fdOut, data,strlen(data));
-    werrno = errno;
-    
-    if (wret < 0) {
-      if (werrno != EINTR) {
-        DEBUGMSGTL(("ucd-snmp/pass_persist", "write_persist_pipe: write returned unknown error %d\n",errno));
-      }
-      close_persist_pipe(iindex);
-      return 0;
+    } else {
+        DEBUGMSGTL(("ucd-snmp/pass_persist",
+                    "write_persist_pipe: short write (%d < %d)\n", wret, len));
     }
-#endif                          /* WIN32 */
-    return 1;
+    return 0;
 }
 
 static void
 close_persist_pipe(int iindex)
 {
-/*	Alexander Prömel, alexander@proemel.de 08/24/2006
-	The hard coded pathnames, are temporary.
-	I'll fix it soon.
-	If you changed them here, you have to do it in ../util_funcs.c too.
-*/
-#ifdef __uClinux__
-	char fifo_in_path[256];
-	char fifo_out_path[256];
-
-	snprintf(fifo_in_path, 256, "/flash/cp_%d", persist_pipes[iindex].pid);
-	snprintf(fifo_out_path, 256, "/flash/pc_%d", persist_pipes[iindex].pid);
-#endif
-
     /*
      * Check and nix every item 
      */
-    if (persist_pipes[iindex].fOut) {
-        fclose(persist_pipes[iindex].fOut);
-        persist_pipes[iindex].fOut = (FILE *) 0;
-    }
     if (persist_pipes[iindex].fdOut != -1) {
-#ifndef WIN32
-        /*
-         * The sequence open()/fdopen()/fclose()/close() triggers an access
-         * violation with the MSVC runtime. Hence skip the close() call when
-         * using the MSVC runtime.
-         */
         close(persist_pipes[iindex].fdOut);
-#endif
         persist_pipes[iindex].fdOut = -1;
     }
     if (persist_pipes[iindex].fIn) {
         fclose(persist_pipes[iindex].fIn);
         persist_pipes[iindex].fIn = (FILE *) 0;
     }
-    if (persist_pipes[iindex].fdIn != -1) {
-#ifndef WIN32
-        /*
-         * The sequence open()/fdopen()/fclose()/close() triggers an access
-         * violation with the MSVC runtime. Hence skip the close() call when
-         * using the MSVC runtime.
-         */
-        close(persist_pipes[iindex].fdIn);
-#endif
-        persist_pipes[iindex].fdIn = -1;
-    }
-
-#ifdef __uClinux__
-	/*remove the pipes*/
-	unlink(fifo_in_path);
-	unlink(fifo_out_path);
-#endif
 
     if (persist_pipes[iindex].pid != NETSNMP_NO_SUCH_PROCESS) {
         /*
@@ -816,12 +732,12 @@ close_persist_pipe(int iindex)
 #ifdef HAVE_SIGNAL
         (void)kill(persist_pipes[iindex].pid, SIGKILL);
 #endif
-#if HAVE_SYS_WAIT_H
+#if HAVE_WAITPID
         waitpid(persist_pipes[iindex].pid, NULL, 0);
-#endif
-#if defined(WIN32) && !defined (mingw32) && !defined (HAVE_SIGNAL)
+#elif defined(WIN32) && !defined (mingw32) && !defined (HAVE_SIGNAL)
         if (!CloseHandle(persist_pipes[iindex].pid)) {
-            DEBUGMSGTL(("ucd-snmp/pass_persist","close_persist_pipe pid: close error\n"));
+            DEBUGMSGTL(("ucd-snmp/pass_persist",
+                        "close_persist_pipe pid: close error\n"));
         }
 #endif
         persist_pipes[iindex].pid = NETSNMP_NO_SUCH_PROCESS;
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/proc.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/proc.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/proc.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/proc.c	2021-05-26 05:19:35.000000000 +0700
@@ -39,9 +39,6 @@
 #  include <time.h>
 # endif
 #endif
-#if HAVE_KVM_H
-#include <kvm.h>
-#endif
 #if HAVE_PCRE_H
 #include <pcre.h>
 #endif
@@ -49,6 +46,7 @@
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
+#include "mibdefs.h"
 #include "struct.h"
 #include "proc.h"
 #ifdef USING_HOST_DATA_ACCESS_SWRUN_MODULE
@@ -60,7 +58,10 @@
 #define setPerrorstatus(x) snmp_log_perror(x)
 #endif
 #include "util_funcs.h"
-#include "kernel.h"
+
+#define PROCMIN 3
+#define PROCMAX 4
+#define PROCCOUNT 5
 
 static struct myproc *get_proc_instance(struct myproc *, oid);
 struct myproc  *procwatch = NULL;
@@ -134,9 +135,7 @@ proc_free_config(void)
         ptmp2 = ptmp;
         ptmp = ptmp->next;
 #if HAVE_PCRE_H
-        if (ptmp2->regexp) {
-            free(ptmp2->regexp);
-        }
+        free(ptmp2->regexp.regex_ptr);
 #endif
         free(ptmp2);
     }
@@ -193,7 +192,7 @@ proc_parse_config(const char *token, cha
     /*
      * don't allow two entries with the same name 
      */
-    copy_nword(cptr, tmpname, sizeof(tmpname));
+    cptr = copy_nword(cptr, tmpname, sizeof(tmpname));
     if (get_proc_by_name(tmpname) != NULL) {
         config_perror("Already have an entry for this process.");
         return;
@@ -210,14 +209,13 @@ proc_parse_config(const char *token, cha
         return;                 /* memory alloc error */
     numprocs++;
 #if HAVE_PCRE_H
-    (*procp)->regexp = NULL;
+    (*procp)->regexp.regex_ptr = NULL;
 #endif
     /*
      * not blank and not a comment 
      */
-    copy_nword(cptr, (*procp)->name, sizeof((*procp)->name));
-    cptr = skip_not_white(cptr);
-    if ((cptr = skip_white(cptr))) {
+    strlcpy((*procp)->name, tmpname, sizeof((*procp)->name));
+    if (cptr) {
         (*procp)->max = atoi(cptr);
         cptr = skip_not_white(cptr);
         if ((cptr = skip_white(cptr))) {
@@ -229,8 +227,9 @@ proc_parse_config(const char *token, cha
                 int pcre_error_offset;
 
                 DEBUGMSGTL(("ucd-snmp/regexp_proc", "Loading regex %s\n", cptr));
-                (*procp)->regexp = pcre_compile(cptr, 0,  &pcre_error, &pcre_error_offset, NULL);
-                if ((*procp)->regexp == NULL) {
+                (*procp)->regexp.regex_ptr =
+                    pcre_compile(cptr, 0,  &pcre_error, &pcre_error_offset, NULL);
+                if ((*procp)->regexp.regex_ptr == NULL) {
                     config_perror(pcre_error);
                 }
             }
@@ -267,7 +266,7 @@ var_extensible_proc(struct variable *vp,
     struct myproc  *proc;
     static long     long_ret;
     static char    *errmsg;
-
+    static char     empty_str[1];
 
     if (header_simple_table
         (vp, name, length, exact, var_len, write_method, numprocs))
@@ -330,19 +329,14 @@ var_extensible_proc(struct variable *vp,
                 }
             }
             *var_len = errmsg ? strlen(errmsg) : 0;
-            return ((u_char *) errmsg);
+            return (u_char *)(errmsg ? errmsg : empty_str);
         case ERRORFIX:
             *write_method = fixProcError;
             long_return = fixproc.result;
             return ((u_char *) & long_return);
         case ERRORFIXCMD:
-            if (proc->fixcmd) {
-                *var_len = strlen(proc->fixcmd);
-                return (u_char *) proc->fixcmd;
-            }
-            errmsg[0] = 0;
-            *var_len = 0;
-            return ((u_char *) errmsg);
+            *var_len = strlen(proc->fixcmd);
+            return (u_char *) proc->fixcmd;
         }
         return NULL;
     }
@@ -397,7 +391,7 @@ sh_count_myprocs(struct myproc *proc)
         return 0;
 
 #if defined(USING_HOST_DATA_ACCESS_SWRUN_MODULE) && defined(HAVE_PCRE_H)
-    if (proc->regexp != NULL)
+    if (proc->regexp.regex_ptr != NULL)
       return sh_count_procs_by_regex(proc->name, proc->regexp);
 #endif
 
@@ -405,7 +399,7 @@ sh_count_myprocs(struct myproc *proc)
 }
 
 #ifdef USING_HOST_DATA_ACCESS_SWRUN_MODULE
-netsnmp_feature_require(swrun_count_processes_by_name)
+netsnmp_feature_require(swrun_count_processes_by_name);
 int
 sh_count_procs(char *procname)
 {
@@ -413,7 +407,7 @@ sh_count_procs(char *procname)
 }
 
 #if HAVE_PCRE_H
-netsnmp_feature_require(swrun_count_processes_by_regex)
+netsnmp_feature_require(swrun_count_processes_by_regex);
 int
 sh_count_procs_by_regex(char *procname, netsnmp_regex_ptr regexp)
 {
@@ -865,7 +859,7 @@ sh_count_procs(char *procname)
 }
 #endif                          /* _SLASH_PROC_METHOD_ */
 #else
-netsnmp_feature_require(find_field)
+netsnmp_feature_require(find_field);
 int
 sh_count_procs(char *procname)
 {
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/proc.h net-snmp-5.9.1/agent/mibgroup/ucd-snmp/proc.h
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/proc.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/proc.h	2021-05-26 05:19:35.000000000 +0700
@@ -23,10 +23,4 @@ config_require(util_funcs)
      void            proc_parse_config(const char *, char *);
      void            procfix_parse_config(const char *, char *);
 
-#include "mibdefs.h"
-
-#define PROCMIN 3
-#define PROCMAX 4
-#define PROCCOUNT 5
-
 #endif                          /* _MIBGROUP_PROC_H */
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/proxy.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/proxy.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/proxy.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/proxy.c	2021-05-26 05:19:35.000000000 +0700
@@ -20,6 +20,9 @@
 #if HAVE_STRING_H
 #include <string.h>
 #endif
+#if HAVE_UNISTD_H
+#include <unistd.h>
+#endif
 #ifdef HAVE_NETINET_IN_H
 #include <netinet/in.h>
 #endif
@@ -29,8 +32,8 @@
 
 #include "proxy.h"
 
-netsnmp_feature_require(handler_mark_requests_as_delegated)
-netsnmp_feature_require(request_set_error_idx)
+netsnmp_feature_require(handler_mark_requests_as_delegated);
+netsnmp_feature_require(request_set_error_idx);
 
 static struct simple_proxy *proxies = NULL;
 
@@ -277,7 +280,6 @@ proxy_free_config(void)
         unregister_mib_context(rm->name, rm->name_len,
                                DEFAULT_MIB_PRIORITY, 0, 0,
                                rm->context);
-        SNMP_FREE(rm->variables);
         SNMP_FREE(rm->context);
         snmp_close(rm->sess);
         SNMP_FREE(rm);
@@ -336,10 +338,10 @@ proxy_fill_in_session(netsnmp_mib_handle
             *configured = strdup("-c");
             DEBUGMSGTL(("proxy", "pdu has community string\n"));
             session->community_len = reqinfo->asp->pdu->community_len;
-            session->community = malloc(session->community_len + 1);
-            sprintf((char *)session->community, "%.*s",
-                    (int) session->community_len,
-                    (const char *)reqinfo->asp->pdu->community);
+            if (asprintf((char **)&session->community, "%.*s",
+                         (int)session->community_len,
+                         (const char *)reqinfo->asp->pdu->community) < 0)
+                session->community = NULL;
         }
     }
 #endif
@@ -460,7 +462,7 @@ proxy_handler(netsnmp_mib_handler *handl
         if (sp->base_len &&
             reqinfo->mode == MODE_GETNEXT &&
             (snmp_oid_compare(ourname, ourlength,
-                              sp->base, sp->base_len) < 0)) {
+                              sp->name, sp->name_len) < 0)) {
             DEBUGMSGTL(( "proxy", "request is out of registered range\n"));
             /*
              * Create GETNEXT request with an OID so the
@@ -569,6 +571,17 @@ proxy_got_response(int operation, netsnm
     }
 
     switch (operation) {
+    case NETSNMP_CALLBACK_OP_RESEND:
+         /*
+         * Issue#147: Net-SNMP not responding when proxy requests times out
+         *
+         * When snmp_api issue a resend, the default case was hit and the 
+         * delagated cache was freed.
+         * As a result, the NETSNMP_CALLBACK_OP_TIMED_OUT never came in.
+         */
+        DEBUGMSGTL(("proxy", "pdu has been resent for request = %8p\n", requests));
+        return SNMP_ERR_NOERROR;
+
     case NETSNMP_CALLBACK_OP_TIMED_OUT:
         /*
          * WWWXXX: don't leave requests delayed if operation is
@@ -698,8 +711,6 @@ proxy_got_response(int operation, netsnm
                                  "proxy OID return length too long.\n");
                         netsnmp_set_request_error(cache->reqinfo, requests,
                                                   SNMP_ERR_GENERR);
-                        if (pdu)
-                            snmp_free_pdu(pdu);
                         netsnmp_free_delegated_cache(cache);
                         return 1;
                     }
@@ -723,8 +734,6 @@ proxy_got_response(int operation, netsnm
              * ack, this is bad.  The # of varbinds don't match and
              * there is no way to fix the problem 
              */
-            if (pdu)
-                snmp_free_pdu(pdu);
             snmp_log(LOG_ERR,
                      "response to proxy request illegal.  We're screwed.\n");
             netsnmp_set_request_error(cache->reqinfo, requests,
@@ -735,11 +744,6 @@ proxy_got_response(int operation, netsnm
         if (cache->reqinfo->mode == MODE_GETBULK)
             netsnmp_bulk_to_next_fix_requests(requests);
         
-        /*
-         * free the response 
-         */
-        if (pdu && 0)
-            snmp_free_pdu(pdu);
 	break;
 
     default:
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/proxy.h net-snmp-5.9.1/agent/mibgroup/ucd-snmp/proxy.h
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/proxy.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/proxy.h	2021-05-26 05:19:35.000000000 +0700
@@ -1,8 +1,19 @@
 #ifndef UCD_SNMP_PROXY_H
 #define UCD_SNMP_PROXY_H
 
+/*
+ * @name: OID of the tree that is being proxied.
+ * @name_len: Length of @name.
+ * @base: Optional. If specified, the OID that @name is replaced with before
+ *   an SNMP request is forwarded.
+ * @base_len: Length of @base.
+ * @context: Context string specified via <-Cn [contextname]>.
+ * @sess: Session associated with this proxy.
+ * @next: Next proxy in the single-linked proxy list.
+ *
+ * See also the Proxy Support section in the snmpd.conf(5) man page.
+ */
 struct simple_proxy {
-    struct variable2 *variables;
     oid             name[MAX_OID_LEN];
     size_t          name_len;
     oid             base[MAX_OID_LEN];
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/versioninfo.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/versioninfo.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/versioninfo.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/versioninfo.c	2021-05-26 05:19:35.000000000 +0700
@@ -28,7 +28,7 @@
 #include "util_funcs/restart.h"
 #include "util_funcs.h" /* clear_cache */
 
-netsnmp_feature_require(clear_cache)
+netsnmp_feature_require(clear_cache);
 
 
 void
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/vmstat_linux.c net-snmp-5.9.1/agent/mibgroup/ucd-snmp/vmstat_linux.c
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/vmstat_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/vmstat_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -112,7 +112,7 @@
 #include "util_funcs/header_generic.h"
 #include "vmstat.h"
 
-netsnmp_feature_require(hardware_cpu_load)
+netsnmp_feature_require(hardware_cpu_load);
 
 
 FindVarMethod var_extensible_vmstat;
diff -urpN net-snmp-5.8/agent/mibgroup/ucd-snmp/vmstat_solaris2.h net-snmp-5.9.1/agent/mibgroup/ucd-snmp/vmstat_solaris2.h
--- net-snmp-5.8/agent/mibgroup/ucd-snmp/vmstat_solaris2.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/ucd-snmp/vmstat_solaris2.h	2021-05-26 05:19:35.000000000 +0700
@@ -18,7 +18,9 @@
 /*
  * Dependency requirements 
  */
-config_arch_require(solaris2, kernel_sunos5)
+#ifdef solaris2
+config_require(kernel_sunos5)
+#endif
 
     /*
      * Directive to include utility module 
diff -urpN net-snmp-5.8/agent/mibgroup/udp-mib/data_access/udp_endpoint_common.c net-snmp-5.9.1/agent/mibgroup/udp-mib/data_access/udp_endpoint_common.c
--- net-snmp-5.8/agent/mibgroup/udp-mib/data_access/udp_endpoint_common.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/udp-mib/data_access/udp_endpoint_common.c	2021-05-26 05:19:35.000000000 +0700
@@ -14,9 +14,9 @@
 
 #include "udp_endpoint_private.h"
 
-netsnmp_feature_child_of(udp_endpoint_common, libnetsnmpmibs)
+netsnmp_feature_child_of(udp_endpoint_common, libnetsnmpmibs);
 
-netsnmp_feature_child_of(udp_endpoint_entry_create, udp_endpoint_common)
+netsnmp_feature_child_of(udp_endpoint_entry_create, udp_endpoint_common);
 
 /**---------------------------------------------------------------------*/
 /*
@@ -88,6 +88,11 @@ netsnmp_access_udp_endpoint_container_lo
     return container;
 }
 
+static void _netsnmp_access_udp_endpoint_entry_free(void *data, void *context)
+{
+    netsnmp_access_udp_endpoint_entry_free(data);
+}
+
 void
 netsnmp_access_udp_endpoint_container_free(netsnmp_container *container,
                                            u_int free_flags)
@@ -104,9 +109,7 @@ netsnmp_access_udp_endpoint_container_fr
         /*
          * free all items.
          */
-        CONTAINER_CLEAR(container,
-                        (netsnmp_container_obj_func*)
-                        netsnmp_access_udp_endpoint_entry_free,
+        CONTAINER_CLEAR(container, _netsnmp_access_udp_endpoint_entry_free,
                         NULL);
     }
 
diff -urpN net-snmp-5.8/agent/mibgroup/udp-mib/data_access/udp_endpoint_freebsd4.c net-snmp-5.9.1/agent/mibgroup/udp-mib/data_access/udp_endpoint_freebsd4.c
--- net-snmp-5.8/agent/mibgroup/udp-mib/data_access/udp_endpoint_freebsd4.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/udp-mib/data_access/udp_endpoint_freebsd4.c	2021-05-26 05:19:35.000000000 +0700
@@ -168,9 +168,24 @@ _load(netsnmp_container *container, u_in
         }
 
         /** oddly enough, these appear to already be in network order */
+#if __FreeBSD_version >= 1200026
+        entry->loc_port = htons(pcb.inp_lport);
+        entry->rmt_port = htons(pcb.inp_fport);
+        
+        /** the addr string may need work */
+	if (pcb.inp_vflag & INP_IPV6) {
+	    entry->loc_addr_len = entry->rmt_addr_len = 16;
+	    memcpy(entry->loc_addr, &pcb.in6p_laddr, 16);
+	    memcpy(entry->rmt_addr, &pcb.in6p_faddr, 16);
+	}
+	else {
+	    entry->loc_addr_len = entry->rmt_addr_len = 4;
+	    memcpy(entry->loc_addr, &pcb.inp_laddr, 4);
+	    memcpy(entry->rmt_addr, &pcb.inp_faddr, 4);
+	}
+#else
         entry->loc_port = htons(pcb.xi_inp.inp_lport);
         entry->rmt_port = htons(pcb.xi_inp.inp_fport);
-        entry->pid = 0;
         
         /** the addr string may need work */
 #ifdef INP_ISIPV6
@@ -187,6 +202,8 @@ _load(netsnmp_container *container, u_in
 	    memcpy(entry->loc_addr, &pcb.xi_inp.inp_laddr, 4);
 	    memcpy(entry->rmt_addr, &pcb.xi_inp.inp_faddr, 4);
 	}
+#endif
+        entry->pid = 0;
 
         /*
          * add entry to container
diff -urpN net-snmp-5.8/agent/mibgroup/udp-mib/data_access/udp_endpoint_linux.c net-snmp-5.9.1/agent/mibgroup/udp-mib/data_access/udp_endpoint_linux.c
--- net-snmp-5.8/agent/mibgroup/udp-mib/data_access/udp_endpoint_linux.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/udp-mib/data_access/udp_endpoint_linux.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,8 +1,7 @@
 /*
  *  udpEndpointTable MIB architecture support
- *
- * $Id$
  */
+
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-features.h>
 #include <net-snmp/net-snmp-includes.h>
@@ -19,10 +18,11 @@
 #include "udp_endpoint_private.h"
 
 #include <fcntl.h>
+#include <stdint.h>
 
-netsnmp_feature_require(text_utils)
-netsnmp_feature_child_of(udp_endpoint_all, libnetsnmpmibs)
-netsnmp_feature_child_of(udp_endpoint_writable, udp_endpoint_all)
+netsnmp_feature_require(text_utils);
+netsnmp_feature_child_of(udp_endpoint_all, libnetsnmpmibs);
+netsnmp_feature_child_of(udp_endpoint_writable, udp_endpoint_all);
 
 static int _load4(netsnmp_container *container, u_int flags);
 #if defined (NETSNMP_ENABLE_IPV6)
diff -urpN net-snmp-5.8/agent/mibgroup/udp-mib/data_access/udp_endpoint_openbsd.c net-snmp-5.9.1/agent/mibgroup/udp-mib/data_access/udp_endpoint_openbsd.c
--- net-snmp-5.8/agent/mibgroup/udp-mib/data_access/udp_endpoint_openbsd.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/udp-mib/data_access/udp_endpoint_openbsd.c	2021-05-26 05:19:35.000000000 +0700
@@ -192,8 +192,8 @@ static int
 _load(netsnmp_container *container, u_int load_flags)
 {
     struct inpcbtable table;
-    struct inpcb   *head, *next, *prev;
-    struct inpcb   inpcb;
+    struct inpcb   *next, *prev;
+    struct inpcb   inpcb, previnpcb;
     netsnmp_udp_endpoint_entry  *entry;
     int      rc = 0;
 
@@ -205,22 +205,29 @@ _load(netsnmp_container *container, u_in
 	return -1;
     }
 
-    prev = (struct inpcb *)&CIRCLEQ_FIRST(&table.inpt_queue);
+    next = (struct inpcb *)&TAILQ_FIRST(&table.inpt_queue);
     prev = NULL;
-    head = next = CIRCLEQ_FIRST(&table.inpt_queue);
 
     while (next) {
 	NETSNMP_KLOOKUP(next, (char *)&inpcb, sizeof(inpcb));
-	if (prev && CIRCLEQ_PREV(&inpcb, inp_queue) != prev) {
-	    snmp_log(LOG_ERR,"udbtable link error\n");
-	    break;
+	if (prev != NULL) {
+		if (!NETSNMP_KLOOKUP(prev, (char *)&previnpcb,
+		    sizeof(previnpcb))) {
+			DEBUGMSGTL(("udp-mib/data_access/udpConn",
+			    "klookup previnpcb failed\n"));
+			break;
+		}
+		if (TAILQ_NEXT(&previnpcb, inp_queue) != next) {
+		    snmp_log(LOG_ERR,"udptable link error\n");
+		    break;
+		}
 	}
 	prev = next;
-	next = CIRCLEQ_NEXT(&inpcb, inp_queue);
+	next = TAILQ_NEXT(&inpcb, inp_queue);
 
 #if !defined(NETSNMP_ENABLE_IPV6)
         if (inpcb.inp_flags & INP_IPV6)
-            goto skip;
+            continue;
 #endif
         entry = netsnmp_access_udp_endpoint_entry_create();
         if (NULL == entry) {
@@ -250,11 +257,6 @@ _load(netsnmp_container *container, u_in
          */
         entry->index = CONTAINER_SIZE(container) + 1;
         CONTAINER_INSERT(container, entry);
-#if !defined(NETSNMP_ENABLE_IPV6)
-    skip:
-#endif
-	if (next == head)
-	    break;
     }
 
     if (rc < 0)
diff -urpN net-snmp-5.8/agent/mibgroup/udp-mib/data_access/udp_endpoint_solaris2.c net-snmp-5.9.1/agent/mibgroup/udp-mib/data_access/udp_endpoint_solaris2.c
--- net-snmp-5.8/agent/mibgroup/udp-mib/data_access/udp_endpoint_solaris2.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/udp-mib/data_access/udp_endpoint_solaris2.c	2021-05-26 05:19:35.000000000 +0700
@@ -11,9 +11,9 @@
 
 #include "kernel_sunos5.h"
 
-netsnmp_feature_require(netsnmp_access_udp_endpoint_entry_create)
-netsnmp_feature_child_of(udp_endpoint_all, libnetsnmpmibs)
-netsnmp_feature_child_of(udp_endpoint_writable, udp_endpoint_all)
+netsnmp_feature_require(netsnmp_access_udp_endpoint_entry_create);
+netsnmp_feature_child_of(udp_endpoint_all, libnetsnmpmibs);
+netsnmp_feature_child_of(udp_endpoint_writable, udp_endpoint_all);
 
 static int _load_udp_endpoint_table_v4(netsnmp_container *, int);
 #if defined(NETSNMP_ENABLE_IPV6) && defined(SOLARIS_HAVE_IPV6_MIB_SUPPORT)
diff -urpN net-snmp-5.8/agent/mibgroup/udp-mib/udpEndpointTable/udpEndpointTable.c net-snmp-5.9.1/agent/mibgroup/udp-mib/udpEndpointTable/udpEndpointTable.c
--- net-snmp-5.8/agent/mibgroup/udp-mib/udpEndpointTable/udpEndpointTable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/udp-mib/udpEndpointTable/udpEndpointTable.c	2021-05-26 05:19:35.000000000 +0700
@@ -243,9 +243,8 @@ udpEndpointTable_indexes_set_tbl_idx(udp
     /*
      * make sure there is enough space for udpEndpointLocalAddress data
      */
-    if ((NULL == tbl_idx->udpEndpointLocalAddress) ||
-        (tbl_idx->udpEndpointLocalAddress_len <
-         (udpEndpointLocalAddress_val_ptr_len))) {
+    if (tbl_idx->udpEndpointLocalAddress_len <
+        udpEndpointLocalAddress_val_ptr_len) {
         snmp_log(LOG_ERR, "not enough space for value\n");
         return MFD_ERROR;
     }
@@ -274,9 +273,8 @@ udpEndpointTable_indexes_set_tbl_idx(udp
     /*
      * make sure there is enough space for udpEndpointRemoteAddress data
      */
-    if ((NULL == tbl_idx->udpEndpointRemoteAddress) ||
-        (tbl_idx->udpEndpointRemoteAddress_len <
-         (udpEndpointRemoteAddress_val_ptr_len))) {
+    if (tbl_idx->udpEndpointRemoteAddress_len <
+        udpEndpointRemoteAddress_val_ptr_len) {
         snmp_log(LOG_ERR, "not enough space for value\n");
         return MFD_ERROR;
     }
diff -urpN net-snmp-5.8/agent/mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_interface.c net-snmp-5.9.1/agent/mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_interface.c
--- net-snmp-5.8/agent/mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_interface.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/udp-mib/udpEndpointTable/udpEndpointTable_interface.c	2021-05-26 05:19:35.000000000 +0700
@@ -47,17 +47,17 @@
 
 #include <ctype.h>
 
-netsnmp_feature_child_of(udpEndpointTable_external_access, libnetsnmpmibs)
+netsnmp_feature_child_of(udpEndpointTable_external_access, libnetsnmpmibs);
 
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(check_all_requests_error);
 
 
-netsnmp_feature_child_of(udpEndpointTable_container_size, udpEndpointTable_external_access)
-netsnmp_feature_child_of(udpEndpointTable_registration_set, udpEndpointTable_external_access)
-netsnmp_feature_child_of(udpEndpointTable_registration_get, udpEndpointTable_external_access)
-netsnmp_feature_child_of(udpEndpointTable_container_get, udpEndpointTable_external_access)
+netsnmp_feature_child_of(udpEndpointTable_container_size, udpEndpointTable_external_access);
+netsnmp_feature_child_of(udpEndpointTable_registration_set, udpEndpointTable_external_access);
+netsnmp_feature_child_of(udpEndpointTable_registration_get, udpEndpointTable_external_access);
+netsnmp_feature_child_of(udpEndpointTable_container_get, udpEndpointTable_external_access);
 
 /**********************************************************************
  **********************************************************************
diff -urpN net-snmp-5.8/agent/mibgroup/util_funcs/header_simple_table.c net-snmp-5.9.1/agent/mibgroup/util_funcs/header_simple_table.c
--- net-snmp-5.8/agent/mibgroup/util_funcs/header_simple_table.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/util_funcs/header_simple_table.c	2021-05-26 05:19:35.000000000 +0700
@@ -34,9 +34,9 @@
  *
  */
 int
-header_simple_table(struct variable *vp, oid * name, size_t * length,
-                    int exact, size_t * var_len,
-                    WriteMethod ** write_method, int max)
+header_simple_table(struct variable *vp, oid *name, size_t *length,
+                    int exact, size_t *var_len, WriteMethod **write_method,
+                    int max)
 {
     int             i, rtest;   /* Set to:      -1      If name < vp->name,
                                  *              1       If name > vp->name,
@@ -44,8 +44,7 @@ header_simple_table(struct variable *vp,
                                  */
     oid             newname[MAX_OID_LEN];
 
-    for (i = 0, rtest = 0;
-         i < (int) vp->namelen && i < (int) (*length) && !rtest; i++) {
+    for (i = 0, rtest = 0; i < vp->namelen && i < *length && !rtest; i++) {
         if (name[i] != vp->name[i]) {
             if (name[i] < vp->name[i])
                 rtest = -1;
@@ -53,9 +52,7 @@ header_simple_table(struct variable *vp,
                 rtest = 1;
         }
     }
-    if (rtest > 0 ||
-        (exact == 1
-         && (rtest || (int) *length != (int) (vp->namelen + 1)))) {
+    if (rtest > 0 || (exact == 1 && (rtest || *length != vp->namelen + 1))) {
         if (var_len)
             *var_len = 0;
         return MATCH_FAILED;
@@ -63,13 +60,13 @@ header_simple_table(struct variable *vp,
 
     memset(newname, 0, sizeof(newname));
 
-    if (((int) *length) <= (int) vp->namelen || rtest == -1) {
-        memmove(newname, vp->name, (int) vp->namelen * sizeof(oid));
+    if (*length <= vp->namelen || rtest == -1) {
+        memmove(newname, vp->name, vp->namelen * sizeof(oid));
         newname[vp->namelen] = 1;
         *length = vp->namelen + 1;
-    } else if (((int) *length) > (int) vp->namelen + 1) {       /* exact case checked earlier */
+    } else if (*length > vp->namelen + 1) {     /* exact case checked earlier */
         *length = vp->namelen + 1;
-        memmove(newname, name, (*length) * sizeof(oid));
+        memmove(newname, name, *length * sizeof(oid));
         if (name[*length - 1] < MAX_SUBID) {
             newname[*length - 1] = name[*length - 1] + 1;
         } else {
@@ -80,7 +77,7 @@ header_simple_table(struct variable *vp,
         }
     } else {
         *length = vp->namelen + 1;
-        memmove(newname, name, (*length) * sizeof(oid));
+        memmove(newname, name, *length * sizeof(oid));
         if (!exact) {
             if (name[*length - 1] < MAX_SUBID) {
                 newname[*length - 1] = name[*length - 1] + 1;
@@ -94,16 +91,16 @@ header_simple_table(struct variable *vp,
             newname[*length - 1] = name[*length - 1];
         }
     }
-    if ((max >= 0 && ((int)newname[*length - 1] > max)) ||
-               ( 0 == newname[*length - 1] )) {
+    if (*length && ((max >= 0 && newname[*length - 1] > (unsigned int)max) ||
+                    newname[*length - 1] == 0)) {
         if (var_len)
             *var_len = 0;
         return MATCH_FAILED;
     }
 
-    memmove(name, newname, (*length) * sizeof(oid));
+    memmove(name, newname, *length * sizeof(oid));
     if (write_method)
-        *write_method = (WriteMethod*)0;
+        *write_method = NULL;
     if (var_len)
         *var_len = sizeof(long);        /* default */
     return (MATCH_SUCCEEDED);
diff -urpN net-snmp-5.8/agent/mibgroup/util_funcs/restart.c net-snmp-5.9.1/agent/mibgroup/util_funcs/restart.c
--- net-snmp-5.8/agent/mibgroup/util_funcs/restart.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/util_funcs/restart.c	2021-05-26 05:19:35.000000000 +0700
@@ -15,10 +15,6 @@
 #endif
 #include <signal.h>
 
-#if HAVE_RAISE
-#define alarm raise
-#endif
-
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/library/snmp_logging.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
@@ -32,7 +28,8 @@
 
 char **argvrestartp, *argvrestartname, *argvrestart;
 
-RETSIGTYPE
+#ifdef SIGALRM
+static RETSIGTYPE
 restart_doit(int a)
 {
     char * name = netsnmp_ds_get_string(NETSNMP_DS_LIBRARY_ID,
@@ -69,6 +66,7 @@ restart_doit(int a)
     setPerrorstatus(argvrestartname);
 #endif
 }
+#endif
 
 int
 restart_hook(int action,
@@ -88,8 +86,8 @@ restart_hook(int action,
     if (tmp == 1 && action == COMMIT) {
 #ifdef SIGALRM
         signal(SIGALRM, restart_doit);
-#endif
         alarm(NETSNMP_RESTARTSLEEP);
+#endif
     }
     return SNMP_ERR_NOERROR;
 }
diff -urpN net-snmp-5.8/agent/mibgroup/util_funcs/restart.h net-snmp-5.9.1/agent/mibgroup/util_funcs/restart.h
--- net-snmp-5.8/agent/mibgroup/util_funcs/restart.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/util_funcs/restart.h	2021-05-26 05:19:35.000000000 +0700
@@ -7,7 +7,6 @@ extern "C" {
 
 extern char **argvrestartp, *argvrestartname, *argvrestart;
 
-RETSIGTYPE      restart_doit(int);
 WriteMethod     restart_hook;
 
 #ifdef __cplusplus
diff -urpN net-snmp-5.8/agent/mibgroup/util_funcs.c net-snmp-5.9.1/agent/mibgroup/util_funcs.c
--- net-snmp-5.8/agent/mibgroup/util_funcs.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/util_funcs.c	2021-05-26 05:19:35.000000000 +0700
@@ -20,6 +20,9 @@
 #if HAVE_IO_H
 #include <io.h>
 #endif
+#ifdef HAVE_SPAWN_H
+#include <spawn.h>
+#endif
 #include <stdio.h>
 #if HAVE_STDLIB_H
 #include <stdlib.h>
@@ -85,6 +88,19 @@
 #ifdef HAVE_SYS_STAT_H
 #include <sys/stat.h>
 #endif
+#ifdef HAVE_LINUX_ETHTOOL_H
+#include <sys/ioctl.h>
+#include <linux/if.h>
+#include <linux/sockios.h>
+#ifdef HAVE_LINUX_ETHTOOL_NEEDS_U64
+#include <linux/types.h>
+typedef __u64 u64;         /* hack, so we may include kernel's ethtool.h */
+typedef __u32 u32;         /* ditto */
+typedef __u16 u16;         /* ditto */
+typedef __u8 u8;           /* ditto */
+#endif
+#include <linux/ethtool.h>
+#endif /* HAVE_LINUX_ETHTOOL_H */
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 #include <net-snmp/library/snmp_logging.h>
@@ -103,23 +119,23 @@
 #define setPerrorstatus(x) snmp_log_perror(x)
 #endif
 
-netsnmp_feature_child_of(util_funcs, libnetsnmpmibs)
+netsnmp_feature_child_of(util_funcs, libnetsnmpmibs);
 
-netsnmp_feature_child_of(shell_command, util_funcs)
-netsnmp_feature_child_of(get_exten_instance, util_funcs)
-netsnmp_feature_child_of(clear_cache, util_funcs)
-netsnmp_feature_child_of(find_field, util_funcs)
-netsnmp_feature_child_of(parse_miboid, util_funcs)
-netsnmp_feature_child_of(string_append_int, util_funcs)
-netsnmp_feature_child_of(internal_mib_table, util_funcs)
+netsnmp_feature_child_of(shell_command, util_funcs);
+netsnmp_feature_child_of(get_exten_instance, util_funcs);
+netsnmp_feature_child_of(clear_cache, util_funcs);
+netsnmp_feature_child_of(find_field, util_funcs);
+netsnmp_feature_child_of(parse_miboid, util_funcs);
+netsnmp_feature_child_of(string_append_int, util_funcs);
+netsnmp_feature_child_of(internal_mib_table, util_funcs);
 
 #if defined(HAVE_LINUX_RTNETLINK_H)
-netsnmp_feature_child_of(prefix_info_all, util_funcs)
-netsnmp_feature_child_of(prefix_info, prefix_info_all)
-netsnmp_feature_child_of(update_prefix_info, prefix_info_all)
-netsnmp_feature_child_of(delete_prefix_info, prefix_info_all)
-netsnmp_feature_child_of(find_prefix_info, prefix_info_all)
-netsnmp_feature_child_of(create_prefix_info, prefix_info_all)
+netsnmp_feature_child_of(prefix_info_all, util_funcs);
+netsnmp_feature_child_of(prefix_info, prefix_info_all);
+netsnmp_feature_child_of(update_prefix_info, prefix_info_all);
+netsnmp_feature_child_of(delete_prefix_info, prefix_info_all);
+netsnmp_feature_child_of(find_prefix_info, prefix_info_all);
+netsnmp_feature_child_of(create_prefix_info, prefix_info_all);
 #endif /* HAVE_LINUX_RTNETLINK_H */
 
 #if defined(NETSNMP_EXCACHETIME) && defined(USING_UTILITIES_EXECUTE_MODULE) && defined(HAVE_EXECV)
@@ -283,7 +299,7 @@ get_exec_output(struct extensible *ex)
                 return -1;
         }
         if (cachebytes > 0)
-            write(cfd, (void *) cache, cachebytes);
+            NETSNMP_IGNORE_RESULT(write(cfd, cache, cachebytes));
         close(cfd);
 #ifdef NETSNMP_EXCACHETIME
         lastresult = ex->result;
@@ -298,9 +314,8 @@ get_exec_output(struct extensible *ex)
         return -1;
     }
     return (cfd);
-#else                           /* !HAVE_EXECV */
-#if defined(WIN32) && !defined(HAVE_EXECV)
-/* MSVC and MinGW.  Cygwin already works as it has execv and fork */
+#elif defined(HAVE__GET_OSFHANDLE) && defined(HAVE__OPEN_OSFHANDLE)
+    /* MSVC and MinGW32. Cygwin has execv() and fork(). */
     int         fd;   
     
     /* Reference:  MS tech note: 190351 */
@@ -393,73 +408,63 @@ get_exec_output(struct extensible *ex)
       return -1;
     }
     return fd;
-#endif                          /* WIN32 */
-#endif       /* HAVE_EXEC */
+#endif       /* HAVE_EXECV */
 #endif /* !defined(USING_UTILITIES_EXECUTE_MODULE) */
     return -1;
 }
-int
-get_exec_pipes(char *cmd, int *fdIn, int *fdOut, netsnmp_pid_t *pid)
+
+/*
+ * Split @cmd into words and return an array with pointers to these words.
+ * Store a pointer to the split command string into *@args. The caller must
+ * free both *@args and the returned pointer.
+ */
+static NETSNMP_ATTRIBUTE_UNUSED char **
+parse_cmd(char **args, const char *cmd)
 {
-/* 	Alexander Prömel, alexander@proemel.de 08/24/2006
-	The following code, is tested on picotux rev. 1.01.
-	I think, it will be better to put the named pipes, into /var/run or make it selectable via CONFIG file.
-	If the pipe file already exist, the creation will fail.
-	I put the pipes into /flash, the pipepath has to change in ucd-snmp/pass_persist.c too, if you change it here.
-*/
-#if HAVE_EXECV
-#ifdef __uClinux__ /* HAVE uClinux */
-	int in,out;
-	char fifo_in_path[256];
-	char fifo_out_path[256];
-	pid_t tpid;
-        
-    if ((tpid = vfork()) == 0) { /*temp child*/
-        execve(cmd, NULL,NULL);
-        perror(cmd);
-        exit(1);
-    } else { 
-		if(tpid > 0) {
-			/*initialize workspace*/
-			snprintf(fifo_in_path, 256, "/flash/cp_%d", tpid);
-			snprintf(fifo_out_path, 256, "/flash/pc_%d", tpid);
-
-			in = mkfifo(fifo_in_path, S_IRWXU);	/*Create Input Pipe, 700*/
-			if ( in ) {
-				perror("parent: inpipe");
-				exit(0);
-			}
-			out = mkfifo(fifo_out_path, S_IRWXU);	/*Create Output Pipe, 700*/
-			if ( out ) {
-				perror("parent: outpipe");
-				exit(0);
-			}
-						
-			in = open(fifo_in_path,O_RDONLY);	/*open the Input Pipe read Only*/
-			if(in < 0) {
-				perror("parent: input");
-				exit(0);
-			}
-			out = open(fifo_out_path,O_WRONLY); 	/*open the Output Pipe write Only*/
-			if(out < 0) {
-				perror("parent: output");
-				exit(0);
-			}
-			
-			*fdIn = in;	/*read*/
-			*fdOut = out;	/*write*/
-			*pid = tpid;	
-			return (1);     /* We are returning 0 for error... */
-		} else { /*pid < 0*/
-			setPerrorstatus("vfork");
-			return 0;
-		}
-
-    }
-#else /*HAVE x86*/
-    int             fd[2][2], i, cnt;
-    char            ctmp[STRMAX], *cptr1, *cptr2, argvs[STRMAX], **argv,
-        **aptr;
+    int             i, cnt;
+    const char     *cptr1;
+    char           *cptr2, **argv, **aptr;
+
+    *args = strdup(cmd);
+    if (!*args)
+        return NULL;
+    for (cnt = 1, cptr1 = cmd, cptr2 = *args; *cptr1 != '\0';
+         cptr2++, cptr1++) {
+        *cptr2 = *cptr1;
+        if (*cptr1 == ' ') {
+            *cptr2++ = '\0';
+            cptr1 = skip_white_const(cptr1);
+            if (!cptr1)
+                break;
+            *cptr2 = *cptr1;
+            if (*cptr1)
+                cnt++;
+        }
+    }
+    argv = malloc((cnt + 1) * sizeof(argv[0]));
+    if (argv == NULL) {
+        free(*args);
+        return NULL;
+    }
+    aptr = argv;
+    *aptr++ = *args;
+    for (cptr2 = *args, i = 1; i != cnt; cptr2++) {
+        if (*cptr2 == '\0') {
+            *aptr++ = cptr2 + 1;
+            i++;
+        }
+    }
+    *aptr++ = NULL;
+    return argv;
+}
+
+#if defined(HAVE_EXECV)
+static int
+get_exec_pipes_fork(const char *cmd, int *fdIn, int *fdOut, netsnmp_pid_t *pid)
+{
+    int             fd[2][2];
+    char           **argv, *args;
+
     /*
      * Setup our pipes 
      */
@@ -470,15 +475,13 @@ get_exec_pipes(char *cmd, int *fdIn, int
     if ((*pid = fork()) == 0) { /* First handle for the child */
         close(fd[0][1]);
         close(fd[1][0]);
-        close(0);
-        if (dup(fd[0][0]) != 0) {
-            setPerrorstatus("dup 0");
+        if (dup2(fd[0][0], STDIN_FILENO) < 0) {
+            setPerrorstatus("dup stdin");
             return 0;
         }
         close(fd[0][0]);
-        close(1);
-        if (dup(fd[1][1]) != 1) {
-            setPerrorstatus("dup 1");
+        if (dup2(fd[1][1], STDOUT_FILENO) < 0) {
+            setPerrorstatus("dup stdout");
             return 0;
         }
         close(fd[1][1]);
@@ -489,39 +492,19 @@ get_exec_pipes(char *cmd, int *fdIn, int
         /*
          * close all non-standard open file descriptors 
          */
-        netsnmp_close_fds(1);
-        (void) dup(1);          /* stderr */
+        netsnmp_close_fds(STDOUT_FILENO);
+        NETSNMP_IGNORE_RESULT(dup2(STDOUT_FILENO, STDERR_FILENO));
 
-        for (cnt = 1, cptr1 = cmd, cptr2 = argvs; *cptr1 != 0;
-             cptr2++, cptr1++) {
-            *cptr2 = *cptr1;
-            if (*cptr1 == ' ') {
-                *(cptr2++) = 0;
-                if ((cptr1 = skip_white(cptr1)) == NULL)
-                    break;
-                *cptr2 = *cptr1;
-                if (*cptr1 != 0)
-                    cnt++;
-            }
+        argv = parse_cmd(&args, cmd);
+        if (!argv) {
+            DEBUGMSGTL(("util_funcs", "get_exec_pipes(): argv == NULL\n"));
+            return 0;
         }
-        *cptr2 = 0;
-        *(cptr2 + 1) = 0;
-        argv = (char **) malloc((cnt + 2) * sizeof(char *));
-        if (argv == NULL)
-            return 0;           /* memory alloc error */
-        aptr = argv;
-        *(aptr++) = argvs;
-        for (cptr2 = argvs, i = 1; i != cnt; cptr2++)
-            if (*cptr2 == 0) {
-                *(aptr++) = cptr2 + 1;
-                i++;
-            }
-        while (*cptr2 != 0)
-            cptr2++;
-        *(aptr++) = NULL;
-        copy_nword(cmd, ctmp, sizeof(ctmp));
-        execv(ctmp, argv);
-        perror(ctmp);
+        DEBUGMSGTL(("util_funcs", "get_exec_pipes(): argv[0] = %s\n", argv[0]));
+        execv(argv[0], argv);
+        perror(argv[0]);
+        free(argv);
+        free(args);
         exit(1);
     } else {
         close(fd[0][0]);
@@ -536,10 +519,76 @@ get_exec_pipes(char *cmd, int *fdIn, int
         *fdOut = fd[0][1];
         return (1);             /* We are returning 0 for error... */
     }
-#endif				/* uClinux or x86 */
-#endif                          /* !HAVE_EXECV */
-#if defined(WIN32) && !defined (mingw32) && !defined(HAVE_EXECV)
-/* MSVC (MinGW not working but should use this code).  Cygwin already works as it has execv and fork */
+}
+#endif
+
+#if defined(HAVE_POSIX_SPAWN)
+static int
+NETSNMP_ATTRIBUTE_UNUSED
+get_exec_pipes_spawn(const char *cmd, int *fdIn, int *fdOut, netsnmp_pid_t *pid)
+{
+    int             fd[2][2], spawn_res;
+    char           **argv, *args;
+    posix_spawnattr_t attr;
+    posix_spawn_file_actions_t file_actions;
+
+    argv = parse_cmd(&args, cmd);
+    if (!argv) {
+        DEBUGMSGTL(("util_funcs", "get_exec_pipes(): argv == NULL\n"));
+        goto err;
+    }
+    if (pipe(fd[0])) {
+        setPerrorstatus("pipe 0");
+        goto free_argv;
+    }
+    if (pipe(fd[1])) {
+        setPerrorstatus("pipe 1");
+        goto close_pipe_0;
+    }
+    posix_spawnattr_init(&attr);
+    posix_spawn_file_actions_init(&file_actions);
+    posix_spawn_file_actions_addclose(&file_actions, fd[0][1]);
+    posix_spawn_file_actions_addclose(&file_actions, fd[1][0]);
+    posix_spawn_file_actions_adddup2(&file_actions,  fd[0][0], STDIN_FILENO);
+    posix_spawn_file_actions_addclose(&file_actions, fd[0][0]);
+    posix_spawn_file_actions_adddup2(&file_actions,  fd[1][1], STDOUT_FILENO);
+    posix_spawn_file_actions_addclose(&file_actions, fd[1][1]);
+    posix_spawn_file_actions_adddup2(&file_actions,  STDOUT_FILENO,
+                                     STDERR_FILENO);
+    spawn_res = posix_spawn(pid, argv[0], &file_actions, &attr, argv, NULL);
+    posix_spawn_file_actions_destroy(&file_actions);
+    posix_spawnattr_destroy(&attr);
+    if (spawn_res != 0) {
+        setPerrorstatus("posix_spawn");
+        goto close_pipe_1;
+    }
+    close(fd[0][0]);
+    close(fd[1][1]);
+    *fdIn = fd[1][0];
+    *fdOut = fd[0][1];
+    return 1;
+
+close_pipe_1:
+    close(fd[1][0]);
+    close(fd[1][1]);
+
+close_pipe_0:
+    close(fd[0][0]);
+    close(fd[0][1]);
+
+free_argv:
+    free(argv);
+
+err:
+    return 0;
+}
+#endif
+
+#if defined(HAVE__GET_OSFHANDLE) && defined(HAVE__OPEN_OSFHANDLE)
+static int
+get_exec_pipes_win32(const char *cmd, int *fdIn, int *fdOut, netsnmp_pid_t *pid)
+{
+    /* MSVC and MinGW32. Cygwin has execv() and fork(). */
     /* Reference:  MS tech note: 190351 */
     HANDLE hInputWriteTmp, hInputRead, hInputWrite = NULL;
     HANDLE hOutputReadTmp, hOutputRead, hOutputWrite = NULL;
@@ -556,12 +605,13 @@ get_exec_pipes(char *cmd, int *fdIn, int
     /* Child temporary output pipe with Inheritance on (sa.bInheritHandle is true) */    
     if (!CreatePipe(&hOutputReadTmp,&hOutputWrite,&sa,0)) {
       DEBUGMSGTL(("util_funcs", "get_exec_pipes CreatePipe ChildOut: %d\n",
-            GetLastError()));
+                  (unsigned int)GetLastError()));
       return 0;
     }
     /* Child temporary input pipe with Inheritance on (sa.bInheritHandle is true) */    
     if (!CreatePipe(&hInputRead,&hInputWriteTmp,&sa,0)) {
-      DEBUGMSGTL(("util_funcs", "get_exec_pipes CreatePipe ChildIn: %d\n", GetLastError()));
+        DEBUGMSGTL(("util_funcs", "get_exec_pipes CreatePipe ChildIn: %d\n",
+                    (unsigned int)GetLastError()));
       return 0;
     }
     
@@ -569,41 +619,50 @@ get_exec_pipes(char *cmd, int *fdIn, int
      * its stdout handles. */
     if (!DuplicateHandle(GetCurrentProcess(),hOutputWrite, GetCurrentProcess(),
           &hErrorWrite,0, TRUE,DUPLICATE_SAME_ACCESS)) {
-      DEBUGMSGTL(("util_funcs", "get_exec_pipes DuplicateHandle: %d\n", GetLastError()));
-      return 0;
+        DEBUGMSGTL(("util_funcs", "get_exec_pipes DuplicateHandle: %d\n",
+                    (unsigned int)GetLastError()));
+        return 0;
     }
 
     /* Create new copies of the input and output handles but set bInheritHandle to 
      * FALSE so the new handle can not be inherited.  Otherwise the handles can not
      * be closed.  */
-    if (!DuplicateHandle(GetCurrentProcess(), hOutputReadTmp, GetCurrentProcess(),
-          &hOutputRead, 0, FALSE, DUPLICATE_SAME_ACCESS)) {
-      DEBUGMSGTL(("util_funcs", "get_exec_pipes DupliateHandle ChildOut: %d\n", GetLastError()));
-      CloseHandle(hErrorWrite);
-      return 0;
+    if (!DuplicateHandle(GetCurrentProcess(), hOutputReadTmp,
+                         GetCurrentProcess(), &hOutputRead, 0, FALSE,
+                         DUPLICATE_SAME_ACCESS)) {
+        DEBUGMSGTL(("util_funcs",
+                    "get_exec_pipes DupliateHandle ChildOut: %d\n",
+                    (unsigned int)GetLastError()));
+        CloseHandle(hErrorWrite);
+        return 0;
     }   
     if (!DuplicateHandle(GetCurrentProcess(),hInputWriteTmp,
           GetCurrentProcess(), &hInputWrite, 0, FALSE, DUPLICATE_SAME_ACCESS)) {
-      DEBUGMSGTL(("util_funcs","get_exec_pipes DupliateHandle ChildIn: %d\n", GetLastError()));
-      CloseHandle(hErrorWrite);
-      CloseHandle(hOutputRead);
-      return 0;
+        DEBUGMSGTL(("util_funcs","get_exec_pipes DupliateHandle ChildIn: %d\n",
+                    (unsigned int)GetLastError()));
+        CloseHandle(hErrorWrite);
+        CloseHandle(hOutputRead);
+        return 0;
     }
 
     /* Close the temporary output and input handles */
     if (!CloseHandle(hOutputReadTmp)) {
-      DEBUGMSGTL(("util_funcs", "get_exec_pipes CloseHandle (hOutputReadTmp): %d\n", GetLastError()));
-      CloseHandle(hErrorWrite);
-      CloseHandle(hOutputRead);
-      CloseHandle(hInputWrite);
-      return 0;
+        DEBUGMSGTL(("util_funcs",
+                    "get_exec_pipes CloseHandle (hOutputReadTmp): %d\n",
+                    (unsigned int)GetLastError()));
+        CloseHandle(hErrorWrite);
+        CloseHandle(hOutputRead);
+        CloseHandle(hInputWrite);
+        return 0;
     }
     if (!CloseHandle(hInputWriteTmp)) {
-      DEBUGMSGTL(("util_funcs", "get_exec_pipes CloseHandle (hInputWriteTmp): %d\n", GetLastError()));
-      CloseHandle(hErrorWrite);
-      CloseHandle(hOutputRead);
-      CloseHandle(hInputWrite);
-      return 0;
+        DEBUGMSGTL(("util_funcs",
+                    "get_exec_pipes CloseHandle (hInputWriteTmp): %d\n",
+                    (unsigned int)GetLastError()));
+        CloseHandle(hErrorWrite);
+        CloseHandle(hOutputRead);
+        CloseHandle(hInputWrite);
+        return 0;
     }
     
     /* Associates a C run-time file descriptor with an existing operating-system file handle. */
@@ -623,12 +682,14 @@ get_exec_pipes(char *cmd, int *fdIn, int
     /* Launch the process that you want to redirect.  Example snmpd.conf pass_persist:
      * pass_persist    .1.3.6.1.4.1.2021.255  c:/perl/bin/perl c:/temp/pass_persisttest
     */
-    if (!CreateProcess(NULL, cmd, NULL, NULL, TRUE, CREATE_NEW_CONSOLE, NULL, NULL, &si, &pi)) {
-      DEBUGMSGTL(("util_funcs","get_exec_pipes CreateProcess:'%s' %d\n",cmd, GetLastError()));
-      CloseHandle(hErrorWrite);
-      CloseHandle(hOutputRead);
-      CloseHandle(hInputWrite);
-      return 0;
+    if (!CreateProcess(NULL, NETSNMP_REMOVE_CONST(char *, cmd), NULL, NULL,
+		       TRUE, CREATE_NEW_CONSOLE, NULL, NULL, &si, &pi)) {
+        DEBUGMSGTL(("util_funcs","get_exec_pipes CreateProcess:'%s' %d\n", cmd,
+                    (unsigned int)GetLastError()));
+        CloseHandle(hErrorWrite);
+        CloseHandle(hOutputRead);
+        CloseHandle(hInputWrite);
+        return 0;
     }
     
     DEBUGMSGTL(("util_funcs","child hProcess (stored in pid): %p\n", pi.hProcess));
@@ -639,7 +700,9 @@ get_exec_pipes(char *cmd, int *fdIn, int
 
     /* Cleanup */
     if (!CloseHandle(pi.hThread))
-      DEBUGMSGTL(("util_funcs","get_exec_pipes CloseHandle pi.hThread: %d\n",cmd));
+      DEBUGMSGTL(("util_funcs",
+		  "get_exec_pipes(%s) CloseHandle pi.hThread: %d\n",
+		  cmd, (unsigned int)GetLastError()));
 
    /* Close pipe handles to make sure that no handles to the write end of the
      * output pipe are maintained in this process or else the pipe will
@@ -648,19 +711,39 @@ get_exec_pipes(char *cmd, int *fdIn, int
      */
 
     if (!CloseHandle(hOutputWrite)){
-      DEBUGMSGTL(("util_funcs","get_exec_pipes CloseHandle hOutputWrite: %d\n",cmd, GetLastError()));
+      DEBUGMSGTL(("util_funcs",
+		  "get_exec_pipes(%s) CloseHandle hOutputWrite: %d\n",
+                  cmd, (unsigned int)GetLastError()));
       return 0;
     }
     if (!CloseHandle(hInputRead)) {
-      DEBUGMSGTL(("util_funcs","get_exec_pipes CloseHandle hInputRead: %d\n",cmd, GetLastError()));
+      DEBUGMSGTL(("util_funcs",
+		  "get_exec_pipes(%s) CloseHandle hInputRead: %d\n",
+                  cmd, (unsigned int)GetLastError()));
       return 0;
     }
     if (!CloseHandle(hErrorWrite)) {
-      DEBUGMSGTL(("util_funcs","get_exec_pipes CloseHandle hErrorWrite: %d\n",cmd, GetLastError()));
+      DEBUGMSGTL(("util_funcs",
+		  "get_exec_pipes(%s) CloseHandle hErrorWrite: %d\n",
+                  cmd, (unsigned int)GetLastError()));
       return 0;
     }
     return 1;
+}
 #endif                          /* WIN32 */
+
+int
+get_exec_pipes(const char *cmd, int *fdIn, int *fdOut, netsnmp_pid_t *pid)
+{
+#if defined(HAVE_EXECV)
+    return get_exec_pipes_fork(cmd, fdIn, fdOut, pid);
+#elif defined(HAVE_POSIX_SPAWN)
+    return get_exec_pipes_fork(cmd, fdIn, fdOut, pid);
+#elif defined(HAVE__GET_OSFHANDLE) && defined(HAVE__OPEN_OSFHANDLE)
+    return get_exec_pipes_win32(cmd, fdIn, fdOut, pid);
+#endif
+    DEBUGMSGTL(("util_funcs",
+                "get_exec_pipes() has not yet been implemented for this platform"));
     return 0;
 }
 
@@ -1119,7 +1202,7 @@ int net_snmp_delete_prefix_info(prefix_c
     for (temp_node = *head, prev_node = NULL; temp_node;
          prev_node = temp_node, temp_node = temp_node->next_info) {
 
-         if (temp_node->in6p && strcmp(temp_node->in6p, address) == 0) {
+         if (strcmp(temp_node->in6p, address) == 0) {
             if (prev_node)
                 prev_node->next_info = temp_node->next_info;
             else
@@ -1135,3 +1218,77 @@ int net_snmp_delete_prefix_info(prefix_c
 
 #endif /* HAVE_LINUX_RTNETLINK_H */
          
+/**
+ * netsnmp_get_link_settings
+ * @name
+ *
+ * @returns  0 success
+ * @returns -1 Both ETHTOOL_GLINKSETTINGS and ETHTOOL_GSET failed
+ * @returns -2 HAVE_LINUX_ETHTOOL_H is not defined
+ */
+int netsnmp_get_link_settings(struct netsnmp_linux_link_settings *nlls,
+                              int fd, const char *name)
+{
+    int err = -2;
+
+#ifdef HAVE_LINUX_ETHTOOL_H
+    struct ifreq ifr;
+
+    err = -1;
+    memset(&ifr, 0, sizeof(ifr));
+    strlcpy(ifr.ifr_name, name, sizeof(ifr.ifr_name));
+
+#ifdef ETHTOOL_GLINKSETTINGS
+    {
+        /*
+         * For Linux kernel v5.2 __ETHTOOL_LINK_MODE_MASK_NBITS == 67 or
+         * 3 32-bit words. Increase the 'nwords' constant if necessary.
+         */
+        enum { mask_nwords = 4 };
+        struct {
+            struct ethtool_link_settings elinkset;
+            uint32_t masks[3 * mask_nwords];
+        } data;
+
+        memset(&data, 0, sizeof(data));
+        data.elinkset.cmd = ETHTOOL_GLINKSETTINGS;
+        ifr.ifr_data = &data.elinkset;
+        err = ioctl(fd, SIOCETHTOOL, &ifr, name);
+        /*
+         * See also the struct ethtool_link_settings documentation in
+         * Linux kernel header file include/uapi/linux/ethtool.h.
+         */
+        if (data.elinkset.link_mode_masks_nwords < 0 &&
+            -data.elinkset.link_mode_masks_nwords <= mask_nwords) {
+            data.elinkset.link_mode_masks_nwords =
+                -data.elinkset.link_mode_masks_nwords;
+            err = ioctl(fd, SIOCETHTOOL, &ifr);
+        }
+        if (err >= 0) {
+            nlls->duplex = data.elinkset.duplex;
+            nlls->speed = data.elinkset.speed;
+        }
+    }
+#endif /* ETHTOOL_GLINKSETTINGS */
+
+    if (err < 0) {
+        struct ethtool_cmd edata;
+
+        memset(&edata, 0, sizeof(edata));
+        edata.cmd = ETHTOOL_GSET;
+        ifr.ifr_data = (char *)&edata;
+        err = ioctl(fd, SIOCETHTOOL, &ifr, name);
+        if (err >= 0) {
+            nlls->duplex = edata.duplex;
+            nlls->speed = edata.speed;
+#ifdef HAVE_STRUCT_ETHTOOL_CMD_SPEED_HI
+            nlls->speed |= edata.speed_hi << 16;
+#endif
+        } else {
+            err = -1;
+        }
+    }
+#endif /* HAVE_LINUX_ETHTOOL_H */
+
+    return err;
+}
diff -urpN net-snmp-5.8/agent/mibgroup/util_funcs.h net-snmp-5.9.1/agent/mibgroup/util_funcs.h
--- net-snmp-5.8/agent/mibgroup/util_funcs.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/util_funcs.h	2021-05-26 05:19:35.000000000 +0700
@@ -37,9 +37,11 @@ int             exec_command(struct exte
 struct extensible *get_exten_instance(struct extensible *, size_t);
 int             get_exec_output(struct extensible *);
 #if defined(WIN32) && !defined(cygwin)
-int             get_exec_pipes(char *cmd, int *fdIn, int *fdOut, HANDLE *pid);
+int             get_exec_pipes(const char *cmd, int *fdIn, int *fdOut,
+                               HANDLE *pid);
 #else
-int             get_exec_pipes(char *cmd, int *fdIn, int *fdOut, pid_t *pid);
+int             get_exec_pipes(const char *cmd, int *fdIn, int *fdOut,
+                               pid_t *pid);
 #endif
 WriteMethod     clear_cache;
 void            print_mib_oid(oid *, size_t);
@@ -67,6 +69,15 @@ int net_snmp_search_update_prefix_info(p
 int net_snmp_delete_prefix_info(prefix_cbx **head,
                                 char *address);
 #endif
+
+struct netsnmp_linux_link_settings {
+    uint32_t   speed;
+    uint8_t    duplex;
+};
+
+int netsnmp_get_link_settings(struct netsnmp_linux_link_settings *nlls,
+                              int fd, const char *name);
+
 #define NIP6(addr) \
         ntohs((addr).s6_addr16[0]), \
         ntohs((addr).s6_addr16[1]), \
diff -urpN net-snmp-5.8/agent/mibgroup/utilities/execute.c net-snmp-5.9.1/agent/mibgroup/utilities/execute.c
--- net-snmp-5.8/agent/mibgroup/utilities/execute.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/utilities/execute.c	2021-05-26 05:19:35.000000000 +0700
@@ -40,17 +40,27 @@
 #include "execute.h"
 #include "struct.h"
 
-#define setPerrorstatus(x) snmp_log_perror(x)
-
 #ifdef _MSC_VER
 #define popen  _popen
 #define pclose _pclose
 #endif
 
 
+/**
+ * Run a shell command by calling system() or popen().
+ *
+ * @command: Shell command to run.
+ * @input:   Data to send to stdin. May be NULL.
+ * @output:  Buffer in which to store the output written to stdout. May be NULL.
+ * @out_len: Size of the output buffer. The actual number of bytes written is
+ *           stored in *@out_len.
+ *
+ * @return >= 0 if the command has been executed; -1 if the command could not
+ *           be executed.
+ */
 int
-run_shell_command( char *command, char *input,
-                   char *output,  int *out_len)	/* Or realloc style ? */
+run_shell_command(const char *command, const char *input,
+                  char *output, int *out_len)
 {
 #if HAVE_SYSTEM
     int         result;    /* and the return value of the command */
@@ -67,12 +77,11 @@ run_shell_command( char *command, char *
      * Set up the command and run it.
      */
     if (input) {
-        FILE       *file;
-
         if (output) {
             const char *ifname;
             const char *ofname;    /* Filename for output redirection */
             char        shellline[STRMAX];   /* The full command to run */
+            FILE       *file;
 
             ifname = netsnmp_mktemp();
             if(NULL == ifname)
@@ -102,17 +111,23 @@ run_shell_command( char *command, char *
             if (out_len && *out_len != 0) {
                 int         fd;        /* For processing any output */
                 int         len = 0;
+
                 fd = open(ofname, O_RDONLY);
                 if(fd >= 0)
-                    len  = read( fd, output, *out_len-1 );
+                    len = read(fd, output, *out_len - 1);
                 *out_len = len;
-                if (len >= 0) output[len] = 0;
-                else output[0] = 0;
-                if (fd >= 0) close(fd);
+                if (len >= 0)
+                    output[len] = 0;
+                else
+                    output[0] = 0;
+                if (fd >= 0)
+                    close(fd);
             }
             unlink(ofname);
             unlink(ifname);
         } else {
+            FILE       *file;
+
             file = popen(command, "w");
             if (file) {
                 fwrite(input, 1, strlen(input), file);
@@ -132,8 +147,9 @@ run_shell_command( char *command, char *
                     output[0] = 0;
                 result = pclose(file);
             }
-        } else
+        } else {
             result = system(command);
+        }
     }
 
     return result;
@@ -142,42 +158,51 @@ run_shell_command( char *command, char *
 #endif
 }
 
-
+#if HAVE_EXECV
 /*
  * Split the given command up into separate tokens,
  * ready to be passed to 'execv'
  */
-char **
-tokenize_exec_command( char *command, int *argc )
+static char **
+tokenize_exec_command(const char *command, int *argc)
 {
     char ctmp[STRMAX];
-    char *cp;
+    const char *cp = command;
     char **argv;
     int  i;
 
-    argv = (char **) calloc(100, sizeof(char *));
-    cp = command;
-
-    for ( i=0; cp; i++ ) {
-        memset( ctmp, 0, STRMAX );
-        cp = copy_nword( cp, ctmp, STRMAX );
-        argv[i] = strdup( ctmp );
-        if (i == 99)
-            break;
-    }
-    if (cp) {
-        argv[i++] = strdup( cp );
+    argv = calloc(100, sizeof(char *));
+    if (!argv)
+        return argv;
+
+    for (i = 0; cp && i + 2 < 100; i++) {
+        cp = copy_nword_const(cp, ctmp, sizeof(ctmp));
+        argv[i] = strdup(ctmp);
     }
+    if (cp)
+        argv[i++] = strdup(cp);
     argv[i] = NULL;
     *argc = i;
 
     return argv;
 }
+#endif
 
-
+/**
+ * Run a command by calling execv().
+ *
+ * @command: Shell command to run.
+ * @input:   Data to send to stdin. May be NULL.
+ * @output:  Buffer in which to store the output written to stdout. May be NULL.
+ * @out_len: Size of the output buffer. The actual number of bytes written is
+ *           stored in *@out_len.
+ *
+ * @return >= 0 if the command has been executed; -1 if the command could not
+ *           be executed.
+ */
 int
-run_exec_command( char *command, char *input,
-                  char *output,  int  *out_len)	/* Or realloc style ? */
+run_exec_command(const char *command, const char *input,
+                 char *output, int *out_len)
 {
 #if HAVE_EXECV
     int ipipe[2];
@@ -189,8 +214,16 @@ run_exec_command( char *command, char *i
     int argc;
 
     DEBUGMSGTL(("run:exec", "running '%s'\n", command));
-    pipe(ipipe);
-    pipe(opipe);
+    if (pipe(ipipe) < 0) {
+        snmp_log_perror("pipe");
+        return -1;
+    }
+    if (pipe(opipe) < 0) {
+        snmp_log_perror("pipe");
+        close(ipipe[0]);
+        close(ipipe[1]);
+        return -1;
+    }
     if ((pid = fork()) == 0) {
         /*
          * Child process
@@ -200,18 +233,24 @@ run_exec_command( char *command, char *i
          * Set stdin/out/err to use the pipe
          *   and close everything else
          */
-        close(0);
-        dup(  ipipe[0]);
+        if (dup2(ipipe[0], STDIN_FILENO) < 0) {
+            snmp_log_perror("dup2(STDIN_FILENO)");
+            exit(1);
+        }
         close(ipipe[0]);
-	close(ipipe[1]);
+        close(ipipe[1]);
 
-        close(1);
-        dup(  opipe[1]);
+        if (dup2(opipe[1], STDOUT_FILENO) < 0) {
+            snmp_log_perror("dup2(STDOUT_FILENO)");
+            exit(1);
+        }
         close(opipe[0]);
         close(opipe[1]);
 
-        close(2);
-        dup(1);
+        if (dup2(STDOUT_FILENO, STDERR_FILENO) < 0) {
+            snmp_log_perror("dup2(STDERR_FILENO)");
+            exit(1);
+        }
 
         netsnmp_close_fds(2);
 
@@ -220,10 +259,15 @@ run_exec_command( char *command, char *i
          * This is being run in the child process,
          *   so will release resources when it terminates.
          */
-        argv = tokenize_exec_command( command, &argc );
-        execv( argv[0], argv );
-        perror( argv[0] );
-        exit(1);	/* End of child */
+        argv = tokenize_exec_command(command, &argc);
+        if (!argv)
+            exit(1);
+        execv(argv[0], argv);
+        snmp_log_perror(argv[0]);
+        for (i = 0; i < argc; i++)
+            free(argv[i]);
+        free(argv);
+        exit(1);        /* End of child */
 
     } else if (pid > 0) {
         char            cache[NETSNMP_MAXCACHESIZE];
@@ -238,17 +282,15 @@ run_exec_command( char *command, char *i
          */
 
         /*
-	 * Pass the input message (if any) to the child,
+         * Pass the input message (if any) to the child,
          * wait for the child to finish executing, and read
          *    any output into the output buffer (if provided)
          */
-	close(ipipe[0]);
-	close(opipe[1]);
-	if (input) {
-	   write(ipipe[1], input, strlen(input));
-	   close(ipipe[1]);	/* or flush? */
-        }
-	else close(ipipe[1]);
+        close(ipipe[0]);
+        close(opipe[1]);
+        if (input && write(ipipe[1], input, strlen(input)) < 0)
+            snmp_log_perror("write() to input pipe");
+        close(ipipe[1]);
 
         /*
          * child will block if it writes a lot of data and
@@ -281,19 +323,19 @@ run_exec_command( char *command, char *i
              * set up data for select
              */
             FD_ZERO(&readfds);
-            FD_SET(opipe[0],&readfds);
+            FD_SET(opipe[0], &readfds);
             timeout.tv_sec = 1;
             timeout.tv_usec = 0;
 
             DEBUGMSGTL(("verbose:run:exec", "    calling select\n"));
             count = select(numfds, &readfds, NULL, NULL, &timeout);
             if (count == -1) {
-                if (EAGAIN == errno)
+                if (EAGAIN == errno) {
                     continue;
-                else {
+                } else {
                     DEBUGMSGTL(("verbose:run:exec", "      errno %d\n",
                                 errno));
-                    setPerrorstatus("read");
+                    snmp_log_perror("read");
                     break;
                 }
             } else if (0 == count) {
@@ -301,7 +343,7 @@ run_exec_command( char *command, char *i
                 continue;
             }
 
-            if (! FD_ISSET(opipe[0], &readfds)) {
+            if (!FD_ISSET(opipe[0], &readfds)) {
                 DEBUGMSGTL(("verbose:run:exec", "    fd not ready!\n"));
                 continue;
             }
@@ -332,8 +374,7 @@ run_exec_command( char *command, char *i
                     waited = 1; /* don't wait again */
                     break;
                 }
-            }
-            else if (count > 0) {
+            } else if (count > 0) {
                 /*
                  * got some data. fix up offset, if needed.
                  */
@@ -348,14 +389,13 @@ run_exec_command( char *command, char *i
                     DEBUGMSGTL(("verbose:run:exec",
                                 "    %d left in buffer\n", (int)cache_size));
                 }
-            }
-            else if ((count == -1) && (EAGAIN != errno)) {
+            } else if (count == -1 && EAGAIN != errno) {
                 /*
                  * if error, break
                  */
                 DEBUGMSGTL(("verbose:run:exec", "      errno %d\n",
                             errno));
-                setPerrorstatus("read");
+                snmp_log_perror("read");
                 break;
             }
         }
@@ -374,7 +414,7 @@ run_exec_command( char *command, char *i
          * time. maybe start a time to wait(WNOHANG) once a second,
          * and late the agent continue?
          */
-        if ((!waited) && (waitpid(pid, &result, 0) < 0 )) {
+        if (!waited && waitpid(pid, &result, 0) < 0) {
             snmp_log_perror("waitpid");
             return -1;
         }
@@ -383,24 +423,24 @@ run_exec_command( char *command, char *i
          * null terminate any output
          */
         if (output) {
-	    output[offset] = 0;
-	    *out_len = offset;
+            output[offset] = 0;
+            *out_len = offset;
         }
         DEBUGMSGTL(("run:exec","  child %d finished. result=%d\n",
                     pid,result));
 
-	return WEXITSTATUS(result);
+        return WEXITSTATUS(result);
 
     } else {
         /*
          * Parent process - fork failed
          */
         snmp_log_perror("fork");
-	close(ipipe[0]);
-	close(ipipe[1]);
-	close(opipe[0]);
-	close(opipe[1]);
-	return -1;
+        close(ipipe[0]);
+        close(ipipe[1]);
+        close(opipe[0]);
+        close(opipe[1]);
+        return -1;
     }
     
 #else
diff -urpN net-snmp-5.8/agent/mibgroup/utilities/execute.h net-snmp-5.9.1/agent/mibgroup/utilities/execute.h
--- net-snmp-5.8/agent/mibgroup/utilities/execute.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/utilities/execute.h	2021-05-26 05:19:35.000000000 +0700
@@ -3,9 +3,9 @@
 
 config_belongs_in(agent_module)
 
-int run_shell_command(char *command, char *input,
-                      char *output,  int  *out_len);
-int run_exec_command( char *command, char *input,
-                      char *output,  int  *out_len);
+int run_shell_command(const char *command, const char *input,
+                      char *output, int *out_len);
+int run_exec_command(const char *command, const char *input,
+                     char *output, int *out_len);
 
 #endif /* _MIBGROUP_EXECUTE_H */
diff -urpN net-snmp-5.8/agent/mibgroup/utilities/iquery.c net-snmp-5.9.1/agent/mibgroup/utilities/iquery.c
--- net-snmp-5.8/agent/mibgroup/utilities/iquery.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/utilities/iquery.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,12 +13,12 @@
 #include "agentx/subagent.h"
 #include "utilities/iquery.h"
 
-netsnmp_feature_child_of(iquery_all, libnetsnmpmibs)
-netsnmp_feature_child_of(iquery, iquery_all)
-netsnmp_feature_child_of(iquery_community_session, iquery_all)
-netsnmp_feature_child_of(iquery_pdu_session, iquery_all)
+netsnmp_feature_child_of(iquery_all, libnetsnmpmibs);
+netsnmp_feature_child_of(iquery, iquery_all);
+netsnmp_feature_child_of(iquery_community_session, iquery_all);
+netsnmp_feature_child_of(iquery_pdu_session, iquery_all);
 
-netsnmp_feature_require(query_set_default_session)
+netsnmp_feature_require(query_set_default_session);
 
 #ifndef NETSNMP_FEATURE_REMOVE_IQUERY
 
diff -urpN net-snmp-5.8/agent/mibgroup/winExtDLL.c net-snmp-5.9.1/agent/mibgroup/winExtDLL.c
--- net-snmp-5.8/agent/mibgroup/winExtDLL.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/mibgroup/winExtDLL.c	2021-05-26 05:19:35.000000000 +0700
@@ -103,7 +103,7 @@
 #include "util_funcs.h"
 #include "winExtDLL.h"
 
-netsnmp_feature_require(oid_is_subtree)
+netsnmp_feature_require(oid_is_subtree);
 
 
 #define MAX_VALUE_NAME          16383
@@ -316,9 +316,8 @@ init_winExtDLL(void)
 
     GetVersionEx(&s_versioninfo);
 
-    IsWow64Process =
-      (pfIsWow64Process)GetProcAddress(GetModuleHandle("kernel32"),
-                                       "IsWow64Process");
+    IsWow64Process = (pfIsWow64Process)(uintptr_t)
+	GetProcAddress(GetModuleHandle("kernel32"), "IsWow64Process");
     if (IsWow64Process)
         (*IsWow64Process)(GetCurrentProcess(), &is_wow64_process);
 
@@ -378,19 +377,21 @@ init_winExtDLL(void)
         /*
          * Store DLL name and functions in s_extension_dll_info array. 
          */
-        ext_dll_info->pfSnmpExtensionInit = (PFNSNMPEXTENSIONINIT)
+        ext_dll_info->pfSnmpExtensionInit = (PFNSNMPEXTENSIONINIT)(uintptr_t)
             GetProcAddress(ext_dll_info->dll_handle, "SnmpExtensionInit");
-        ext_dll_info->pfSnmpExtensionInitEx = (PFNSNMPEXTENSIONINITEX)
+        ext_dll_info->pfSnmpExtensionInitEx =
+	    (PFNSNMPEXTENSIONINITEX)(uintptr_t)
             GetProcAddress(ext_dll_info->dll_handle,
                            "SnmpExtensionInitEx");
         ext_dll_info->pfSnmpExtensionClose = (PFNSNMPEXTENSIONCLOSE)
             GetProcAddress(ext_dll_info->dll_handle, "SnmpExtensionClose");
-        ext_dll_info->pfSnmpExtensionQuery = (PFNSNMPEXTENSIONQUERY)
+        ext_dll_info->pfSnmpExtensionQuery = (PFNSNMPEXTENSIONQUERY)(uintptr_t)
             GetProcAddress(ext_dll_info->dll_handle, "SnmpExtensionQuery");
-        ext_dll_info->pfSnmpExtensionQueryEx = (PFNSNMPEXTENSIONQUERYEX)
+        ext_dll_info->pfSnmpExtensionQueryEx =
+	    (PFNSNMPEXTENSIONQUERYEX)(uintptr_t)
             GetProcAddress(ext_dll_info->dll_handle,
                            "SnmpExtensionQueryEx");
-        ext_dll_info->pfSnmpExtensionTrap = (PFNSNMPEXTENSIONTRAP)
+        ext_dll_info->pfSnmpExtensionTrap = (PFNSNMPEXTENSIONTRAP)(uintptr_t)
             GetProcAddress(ext_dll_info->dll_handle, "SnmpExtensionTrap");
 
 
@@ -437,26 +438,9 @@ init_winExtDLL(void)
             ext_dll_info->pfSnmpExtensionInit(uptime_reference,
                                               &ext_dll_info->
                                               subagentTrapEvent, &view);
-
-        if (!result) {
-            DEBUGMSG(("winExtDLL",
-                      "init_winExtDLL: initialization of DLL %s failed.\n",
-                      ext_dll_info->dll_name));
-            /*
-             * At least on Windows 7 SnmpExtensionInit() in some extension
-             * agent DLLs returns "FALSE" although initialization
-             * succeeded. Hence ignore the SnmpExtensionInit() return value on
-             * Windows Vista and later.
-             */
-            if (s_versioninfo.dwMajorVersion < 6) {
-                snmp_log(LOG_ERR,
-                         "init_winExtDLL: initialization of DLL %s failed.\n",
-                         ext_dll_info->dll_name);
-                FreeLibrary(ext_dll_info->dll_handle);
-                ext_dll_info->dll_handle = 0;
-                continue;
-            }
-        }
+        DEBUGMSG(("winExtDLL",
+                  "init_winExtDLL: DLL %s initialization result %d\n",
+                  ext_dll_info->dll_name, result));
 
         if (ext_dll_info->subagentTrapEvent != NULL) {
             xarray_push_back(&s_trapevent,
@@ -466,35 +450,39 @@ init_winExtDLL(void)
 
         memset(&ext_dll_view_info, 0, sizeof(ext_dll_view_info));
         ext_dll_view_info.winextdll_info = ext_dll_info;
-        if (view.idLength == 0) {
-            DEBUGMSG(("winExtDLL",
-                      "init_winExtDLL: DLL %s did not register an OID range.\n",
-                      ext_dll_info->dll_name));
-            continue;
-        }
-        /*
-         * Skip the mib-2 system section on Windows Vista and later because
-         * at least on a 64-bit Windows 7 system all queries in that section
-         * fail with status "generic error".
-         */
-        if (s_versioninfo.dwMajorVersion >= 6
-            && snmp_oid_compare_w_n(view.ids, view.idLength, mibii_system_mib,
-                                    sizeof(mibii_system_mib) /
-                                    sizeof(mibii_system_mib[0])) == 0) {
-            DEBUGMSG(("winExtDLL",
-                      "init_winExtDLL: skipping system section of DLL %s.\n",
-                      ext_dll_info->dll_name));
-            continue;
+        DEBUGMSG(("winExtDLL",
+                  "init_winExtDLL: DLL %s view length %d\n",
+                  ext_dll_info->dll_name, view.idLength));
+        if (view.idLength) {
+            /*
+             * Skip the mib-2 system section on Windows Vista and later because
+             * at least on a 64-bit Windows 7 system all queries in that section
+             * fail with status "generic error".
+             */
+            if (s_versioninfo.dwMajorVersion >= 6
+                && snmp_oid_compare_w_n(view.ids, view.idLength,
+                                        mibii_system_mib,
+                                        sizeof(mibii_system_mib) /
+                                        sizeof(mibii_system_mib[0])) == 0) {
+                DEBUGMSG(("winExtDLL",
+                          "init_winExtDLL: skipping system section of DLL %s.\n",
+                          ext_dll_info->dll_name));
+            } else {
+                copy_oid_n_w(ext_dll_view_info.name,
+                             &ext_dll_view_info.name_length,
+                             view.ids, view.idLength);
+                xarray_push_back(&s_winextdll_view, &ext_dll_view_info);
+            }
         }
-        copy_oid_n_w(ext_dll_view_info.name, &ext_dll_view_info.name_length,
-                     view.ids, view.idLength);
-        xarray_push_back(&s_winextdll_view, &ext_dll_view_info);
 
         /*
          * Loop looking for more supported views. 
          */
         while (ext_dll_info->pfSnmpExtensionInitEx
                && ext_dll_info->pfSnmpExtensionInitEx(&view)) {
+            DEBUGMSG(("winExtDLL",
+                      "init_winExtDLL: DLL %s view length %d\n",
+                      ext_dll_info->dll_name, view.idLength));
             memset(&ext_dll_view_info, 0, sizeof(ext_dll_view_info));
             ext_dll_view_info.winextdll_info = ext_dll_info;
             copy_oid_n_w(ext_dll_view_info.name,
diff -urpN net-snmp-5.8/agent/netsnmp_close_fds.c net-snmp-5.9.1/agent/netsnmp_close_fds.c
--- net-snmp-5.8/agent/netsnmp_close_fds.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/netsnmp_close_fds.c	2021-05-26 05:19:35.000000000 +0700
@@ -16,13 +16,14 @@
 void netsnmp_close_fds(int fd)
 {
 #if defined(HAVE_FORK)
-    DIR            *dir;
-    struct dirent  *ent;
+    DIR            *dir NETSNMP_ATTRIBUTE_UNUSED;
+    struct dirent  *ent NETSNMP_ATTRIBUTE_UNUSED;
     int             i, largest_fd = -1;
 
     if (fd < -1)
         fd = -1;
 
+#ifdef __linux__
     if ((dir = opendir("/proc/self/fd"))) {
         while ((ent = readdir(dir))) {
             if (sscanf(ent->d_name, "%d", &i) == 1) {
@@ -31,8 +32,24 @@ void netsnmp_close_fds(int fd)
             }
         }
         closedir(dir);
-    } else {
+    }
+#elif defined(__FreeBSD__) || defined(__OpenBSD__)
+    if ((dir = opendir("/dev/fd"))) {
+        while ((ent = readdir(dir))) {
+            if (sscanf(ent->d_name, "%d", &i) == 1) {
+                if (i > largest_fd)
+                    largest_fd = i;
+            }
+        }
+        closedir(dir);
+    }
+#endif
+    if (largest_fd < 0) {
+#ifdef HAVE_GETDTABLESIZE
         largest_fd = getdtablesize() - 1;
+#else
+        largest_fd = sysconf(_SC_OPEN_MAX);
+#endif
     }
 
     for (i = largest_fd; i > fd && i >= 0; i--)
diff -urpN net-snmp-5.8/agent/snmp_agent.c net-snmp-5.9.1/agent/snmp_agent.c
--- net-snmp-5.8/agent/snmp_agent.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/snmp_agent.c	2021-05-26 05:19:35.000000000 +0700
@@ -111,23 +111,23 @@ int             deny_severity = LOG_WARN
 #include "smux/smux.h"
 #endif
 
-netsnmp_feature_child_of(snmp_agent, libnetsnmpagent)
-netsnmp_feature_child_of(agent_debugging_utilities, libnetsnmpagent)
+netsnmp_feature_child_of(snmp_agent, libnetsnmpagent);
+netsnmp_feature_child_of(agent_debugging_utilities, libnetsnmpagent);
 
-netsnmp_feature_child_of(allocate_globalcacheid, snmp_agent)
-netsnmp_feature_child_of(free_agent_snmp_session_by_session, snmp_agent)
-netsnmp_feature_child_of(check_all_requests_error, snmp_agent)
-netsnmp_feature_child_of(check_requests_error, snmp_agent)
-netsnmp_feature_child_of(request_set_error_idx, snmp_agent)
-netsnmp_feature_child_of(set_agent_uptime, snmp_agent)
-netsnmp_feature_child_of(agent_check_and_process, snmp_agent)
-
-netsnmp_feature_child_of(dump_sess_list, agent_debugging_utilities)
-
-netsnmp_feature_child_of(agent_remove_list_data, netsnmp_unused)
-netsnmp_feature_child_of(set_all_requests_error, netsnmp_unused)
-netsnmp_feature_child_of(addrcache_age, netsnmp_unused)
-netsnmp_feature_child_of(delete_subtree_cache, netsnmp_unused)
+netsnmp_feature_child_of(allocate_globalcacheid, snmp_agent);
+netsnmp_feature_child_of(free_agent_snmp_session_by_session, snmp_agent);
+netsnmp_feature_child_of(check_all_requests_error, snmp_agent);
+netsnmp_feature_child_of(check_requests_error, snmp_agent);
+netsnmp_feature_child_of(request_set_error_idx, snmp_agent);
+netsnmp_feature_child_of(set_agent_uptime, snmp_agent);
+netsnmp_feature_child_of(agent_check_and_process, snmp_agent);
+
+netsnmp_feature_child_of(dump_sess_list, agent_debugging_utilities);
+
+netsnmp_feature_child_of(agent_remove_list_data, netsnmp_unused);
+netsnmp_feature_child_of(set_all_requests_error, netsnmp_unused);
+netsnmp_feature_child_of(addrcache_age, netsnmp_unused);
+netsnmp_feature_child_of(delete_subtree_cache, netsnmp_unused);
 
 #ifndef NETSNMP_NO_PDU_STATS
 
@@ -1574,7 +1574,11 @@ init_agent_snmp_session(netsnmp_session
     DEBUGMSGTL(("snmp_agent","agent_sesion %8p created\n", asp));
     asp->session = session;
     asp->pdu = snmp_clone_pdu(pdu);
+    if (!asp->pdu)
+        goto err;
     asp->orig_pdu = snmp_clone_pdu(pdu);
+    if (!asp->orig_pdu)
+        goto err;
     asp->rw = READ;
     asp->exact = TRUE;
     asp->next = NULL;
@@ -1590,6 +1594,12 @@ init_agent_snmp_session(netsnmp_session
                 asp, asp->reqinfo));
 
     return asp;
+
+err:
+    snmp_free_pdu(asp->orig_pdu);
+    snmp_free_pdu(asp->pdu);
+    free(asp);
+    return NULL;
 }
 
 void
@@ -1604,6 +1614,7 @@ free_agent_snmp_session(netsnmp_agent_se
     
     DEBUGMSGTL(("verbose:asp", "asp %p reqinfo %p freed\n",
                 asp, asp->reqinfo));
+
     if (asp->orig_pdu)
         snmp_free_pdu(asp->orig_pdu);
     if (asp->pdu)
@@ -2458,7 +2469,7 @@ netsnmp_add_varbind_to_cache(netsnmp_age
                             asp->treecache_len);
                 if (asp->treecache == NULL)
                     return NULL;
-                memset(&(asp->treecache[cacheid]), 0x00,
+                memset(asp->treecache + cacheid, 0,
                        sizeof(netsnmp_tree_cache) * (CACHE_GROW_SIZE));
             }
             asp->treecache[cacheid].subtree = tp;
@@ -3757,9 +3768,7 @@ handle_pdu(netsnmp_agent_session *asp)
     case SNMP_MSG_INTERNAL_SET_RESERVE1:
 #endif /* NETSNMP_NO_WRITE_SUPPORT */
         asp->vbcount = count_varbinds(asp->pdu->variables);
-        if (asp->vbcount) /* efence doesn't like 0 size allocs */
-            asp->requests = (netsnmp_request_info *)
-                calloc(asp->vbcount, sizeof(netsnmp_request_info));
+        asp->requests = calloc(asp->vbcount, sizeof(netsnmp_request_info));
         /*
          * collect varbinds 
          */
diff -urpN net-snmp-5.8/agent/snmp_perl.c net-snmp-5.9.1/agent/snmp_perl.c
--- net-snmp-5.8/agent/snmp_perl.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/snmp_perl.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,7 +1,3 @@
-#if defined(_WIN32) && !defined(_WIN32_WINNT)
-#define _WIN32_WINNT 0x501
-#endif
-
 #include <EXTERN.h>
 #include "perl.h"
 
diff -urpN net-snmp-5.8/agent/snmp_vars.c net-snmp-5.9.1/agent/snmp_vars.c
--- net-snmp-5.8/agent/snmp_vars.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/snmp_vars.c	2021-05-26 05:19:35.000000000 +0700
@@ -292,9 +292,7 @@ init_agent(const char *app)
     netsnmp_ds_set_boolean(NETSNMP_DS_LIBRARY_ID, 
 			   NETSNMP_DS_LIB_ALARM_DONT_USE_SIG, 1);
 
-#ifdef HAVE_KMEM
     r = init_kmem("/dev/kmem") ? 0 : -EACCES;
-#endif
 
     setup_tree();
 
@@ -384,9 +382,7 @@ shutdown_agent(void) {
     clear_callback();
     shutdown_secmod();
     netsnmp_addrcache_destroy();
-#ifdef HAVE_KMEM
     free_kmem();
-#endif
 
     done_init_agent = 0;
 }
diff -urpN net-snmp-5.8/agent/snmpd.c net-snmp-5.9.1/agent/snmpd.c
--- net-snmp-5.8/agent/snmpd.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/agent/snmpd.c	2021-05-26 05:19:35.000000000 +0700
@@ -145,6 +145,8 @@
 #include <net-snmp/agent/table.h>
 #include <net-snmp/agent/table_iterator.h>
 
+#include "../snmplib/snmp_syslog.h"
+
 #include "mibgroup/util_funcs/restart.h"
 
 /*
@@ -163,9 +165,9 @@
 #include <net-snmp/library/sd-daemon.h>
 #endif
 
-netsnmp_feature_want(logging_file)
-netsnmp_feature_want(logging_stdio)
-netsnmp_feature_want(logging_syslog)
+netsnmp_feature_want(logging_file);
+netsnmp_feature_want(logging_stdio);
+netsnmp_feature_want(logging_syslog);
 
 /*
  * Globals.
@@ -207,44 +209,6 @@ static int      receive(void);
 static void     StopSnmpAgent(void);
 #endif
 
-/*
- * These definitions handle 4.2 systems without additional syslog facilities.
- */
-#ifndef LOG_CONS
-#define LOG_CONS	0       /* Don't bother if not defined... */
-#endif
-#ifndef LOG_PID
-#define LOG_PID		0       /* Don't bother if not defined... */
-#endif
-#ifndef LOG_LOCAL0
-#define LOG_LOCAL0	0
-#endif
-#ifndef LOG_LOCAL1
-#define LOG_LOCAL1	0
-#endif
-#ifndef LOG_LOCAL2
-#define LOG_LOCAL2	0
-#endif
-#ifndef LOG_LOCAL3
-#define LOG_LOCAL3	0
-#endif
-#ifndef LOG_LOCAL4
-#define LOG_LOCAL4	0
-#endif
-#ifndef LOG_LOCAL5
-#define LOG_LOCAL5	0
-#endif
-#ifndef LOG_LOCAL6
-#define LOG_LOCAL6	0
-#endif
-#ifndef LOG_LOCAL7
-#define LOG_LOCAL7	0
-#endif
-#ifndef LOG_DAEMON
-#define LOG_DAEMON	0
-#endif
-
-
 static void
 usage(char *prog)
 {
@@ -604,8 +568,7 @@ main(int argc, char *argv[])
                     fprintf(stderr, "Bad group id: %s\n", optarg);
                     goto out;
                 }
-                netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID, 
-				   NETSNMP_DS_AGENT_GROUPID, gid);
+                netsnmp_set_agent_group_id(gid);
             } else {
                 usage(argv[0]);
             }
@@ -783,8 +746,7 @@ main(int argc, char *argv[])
                     fprintf(stderr, "Bad user id: %s\n", optarg);
                     goto out;
                 }
-                netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID, 
-				   NETSNMP_DS_AGENT_USERID, uid);
+                netsnmp_set_agent_user_id(uid);
             } else {
                 usage(argv[0]);
             }
@@ -993,17 +955,13 @@ main(int argc, char *argv[])
             }
         } else {
             if ((PID = fdopen(fd, "w")) == NULL) {
+                close(fd);
                 snmp_log_perror(pid_file);
                 goto out;
             } else {
                 fprintf(PID, "%d\n", (int) getpid());
                 fclose(PID);
             }
-#ifndef _MSC_VER
-            /* The sequence open()/fdopen()/fclose()/close() makes MSVC crash,
-               hence skip the close() call when using the MSVC runtime. */
-            close(fd);
-#endif
         }
     }
 #endif
@@ -1023,7 +981,7 @@ main(int argc, char *argv[])
     
 #ifdef HAVE_CHOWN
     if ( uid != 0 || gid != 0 )
-        chown( persistent_dir, uid, gid );
+        NETSNMP_IGNORE_RESULT(chown(persistent_dir, uid, gid));
 #endif
 
 #ifdef HAVE_SETGID
@@ -1170,7 +1128,13 @@ static unsigned __stdcall wait_for_stdin
 static void create_stdin_waiter_thread(void)
 {
     netsnmp_assert(s_thread_handle == 0);
-    s_thread_handle = (HANDLE)_beginthreadex(0, 0, wait_for_stdin, 0, 0, &s_threadid);
+#ifdef HAVE__BEGINTHREADEX
+    s_thread_handle = (HANDLE)_beginthreadex(0, 0, wait_for_stdin, 0, 0,
+                                             &s_threadid);
+#else
+    s_thread_handle = (HANDLE)CreateThread(NULL, 0, wait_for_stdin, 0, 0,
+                                           &s_threadid);
+#endif
     netsnmp_assert(s_thread_handle != 0);
 }
 
@@ -1205,7 +1169,7 @@ receive(void)
     int             numfds;
     netsnmp_large_fd_set readfds, writefds, exceptfds;
     struct timeval  timeout, *tvp = &timeout;
-    int             count, block, i;
+    int             count, block, i, ret;
 #ifdef	USING_SMUX_MODULE
     int             sd;
 #endif                          /* USING_SMUX_MODULE */
@@ -1228,8 +1192,13 @@ receive(void)
      */
     while (netsnmp_running) {
         if (reconfig) {
-#if HAVE_SIGHOLD
-            sighold(SIGHUP);
+#if HAVE_SIGPROCMASK
+            sigset_t set;
+
+            sigemptyset(&set);
+            sigaddset(&set, SIGHUP);
+            ret = sigprocmask(SIG_BLOCK, &set, NULL);
+            netsnmp_assert(ret == 0);
 #endif
             reconfig = 0;
             snmp_log(LOG_INFO, "Reconfiguring daemon\n");
@@ -1240,8 +1209,9 @@ receive(void)
 		     netsnmp_get_version());
             update_config();
             send_easy_trap(SNMP_TRAP_ENTERPRISESPECIFIC, 3);
-#if HAVE_SIGHOLD
-            sigrelse(SIGHUP);
+#if HAVE_SIGPROCMASK
+            ret = sigprocmask(SIG_UNBLOCK, &set, NULL);
+            netsnmp_assert(ret == 0);
 #endif
         }
 
@@ -1452,9 +1422,8 @@ snmp_input(int op,
 * Invokes appropriate startup functions depending on the 
 * parameters passed
 *************************************************************/
-int
-    __cdecl
-_tmain(int argc, TCHAR * argv[])
+int __cdecl
+main(int argc, TCHAR * argv[])
 {
     /*
      * Define Service Name and Description, which appears in windows SCM 
@@ -1470,7 +1439,7 @@ _tmain(int argc, TCHAR * argv[])
     InputParams     InputOptions;
 
 
-    int             nRunType = RUN_AS_CONSOLE;
+    enum net_snmp_cmd_line_action nRunType = RUN_AS_CONSOLE;
     int             quiet = 0;
     
 #if 0
diff -urpN net-snmp-5.8/apps/Makefile.depend net-snmp-5.9.1/apps/Makefile.depend
--- net-snmp-5.8/apps/Makefile.depend	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/Makefile.depend	2021-05-26 05:19:35.000000000 +0700
@@ -1,6 +1,9 @@
 # DO NOT DELETE THIS LINE -- make depend depends on it.
 
 ./agentxtrap.lo: ../include/net-snmp/net-snmp-config.h
+./agentxtrap.lo: ../include/net-snmp/system/linux.h
+./agentxtrap.lo: ../include/net-snmp/system/sysv.h
+./agentxtrap.lo: ../include/net-snmp/system/generic.h
 ./agentxtrap.lo: ../include/net-snmp/machine/generic.h
 ./agentxtrap.lo: ../include/net-snmp/net-snmp-features.h
 ./agentxtrap.lo: ../include/net-snmp/net-snmp-includes.h
@@ -30,7 +33,9 @@
 ./agentxtrap.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./agentxtrap.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./agentxtrap.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./agentxtrap.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./agentxtrap.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./agentxtrap.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./agentxtrap.lo: ../include/net-snmp/library/ucd_compat.h
 ./agentxtrap.lo: ../include/net-snmp/library/mib.h
 ./agentxtrap.lo: ../include/net-snmp/mib_api.h
@@ -71,8 +76,8 @@
 ./agentxtrap.lo: ../include/net-snmp/library/lcd_time.h
 ./agentxtrap.lo: ../include/net-snmp/library/snmp_secmod.h
 ./agentxtrap.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./agentxtrap.lo: ../include/net-snmp/library/snmptsm.h
 ./agentxtrap.lo: ../include/net-snmp/library/snmpusm.h
+./agentxtrap.lo: ../include/net-snmp/library/snmptsm.h
 ./agentxtrap.lo: ../include/net-snmp/agent/ds_agent.h
 ./agentxtrap.lo: ../agent/agent_global_vars.h
 ./agentxtrap.lo: ../agent/mibgroup/agentx/agentx_config.h
@@ -107,7 +112,9 @@
 ./encode_keychange.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./encode_keychange.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./encode_keychange.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./encode_keychange.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./encode_keychange.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./encode_keychange.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./encode_keychange.lo: ../include/net-snmp/library/ucd_compat.h
 ./encode_keychange.lo: ../include/net-snmp/library/mib.h
 ./encode_keychange.lo: ../include/net-snmp/mib_api.h
@@ -148,8 +155,8 @@
 ./encode_keychange.lo: ../include/net-snmp/library/lcd_time.h
 ./encode_keychange.lo: ../include/net-snmp/library/snmp_secmod.h
 ./encode_keychange.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./encode_keychange.lo: ../include/net-snmp/library/snmptsm.h
 ./encode_keychange.lo: ../include/net-snmp/library/snmpusm.h
+./encode_keychange.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpbulkget.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpbulkget.lo: ../include/net-snmp/utilities.h ../include/net-snmp/types.h
 ./snmpbulkget.lo: ../include/net-snmp/library/oid.h
@@ -177,7 +184,9 @@
 ./snmpbulkget.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpbulkget.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpbulkget.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpbulkget.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpbulkget.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpbulkget.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpbulkget.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpbulkget.lo: ../include/net-snmp/library/mib.h
 ./snmpbulkget.lo: ../include/net-snmp/mib_api.h
@@ -218,8 +227,8 @@
 ./snmpbulkget.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpbulkget.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpbulkget.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpbulkget.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpbulkget.lo: ../include/net-snmp/library/snmpusm.h
+./snmpbulkget.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpbulkwalk.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpbulkwalk.lo: ../include/net-snmp/net-snmp-includes.h
 ./snmpbulkwalk.lo: ../include/net-snmp/definitions.h
@@ -248,7 +257,9 @@
 ./snmpbulkwalk.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpbulkwalk.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpbulkwalk.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpbulkwalk.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpbulkwalk.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpbulkwalk.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpbulkwalk.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpbulkwalk.lo: ../include/net-snmp/library/mib.h
 ./snmpbulkwalk.lo: ../include/net-snmp/mib_api.h
@@ -289,8 +300,8 @@
 ./snmpbulkwalk.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpbulkwalk.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpbulkwalk.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpbulkwalk.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpbulkwalk.lo: ../include/net-snmp/library/snmpusm.h
+./snmpbulkwalk.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpdelta.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpdelta.lo: ../include/net-snmp/net-snmp-includes.h
 ./snmpdelta.lo: ../include/net-snmp/definitions.h ../include/net-snmp/types.h
@@ -318,7 +329,9 @@
 ./snmpdelta.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpdelta.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpdelta.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpdelta.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpdelta.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpdelta.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpdelta.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpdelta.lo: ../include/net-snmp/library/mib.h
 ./snmpdelta.lo: ../include/net-snmp/mib_api.h
@@ -359,8 +372,8 @@
 ./snmpdelta.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpdelta.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpdelta.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpdelta.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpdelta.lo: ../include/net-snmp/library/snmpusm.h
+./snmpdelta.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpdf.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpdf.lo: ../include/net-snmp/net-snmp-includes.h
 ./snmpdf.lo: ../include/net-snmp/definitions.h ../include/net-snmp/types.h
@@ -387,7 +400,9 @@
 ./snmpdf.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpdf.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpdf.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpdf.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpdf.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpdf.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpdf.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpdf.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./snmpdf.lo: ../include/net-snmp/library/parse.h
@@ -426,8 +441,8 @@
 ./snmpdf.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpdf.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpdf.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpdf.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpdf.lo: ../include/net-snmp/library/snmpusm.h
+./snmpdf.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpget.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpget.lo: ../include/net-snmp/utilities.h ../include/net-snmp/types.h
 ./snmpget.lo: ../include/net-snmp/library/oid.h
@@ -455,7 +470,9 @@
 ./snmpget.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpget.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpget.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpget.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpget.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpget.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpget.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpget.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./snmpget.lo: ../include/net-snmp/library/parse.h
@@ -495,8 +512,8 @@
 ./snmpget.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpget.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpget.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpget.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpget.lo: ../include/net-snmp/library/snmpusm.h
+./snmpget.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpgetnext.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpgetnext.lo: ../include/net-snmp/net-snmp-includes.h
 ./snmpgetnext.lo: ../include/net-snmp/definitions.h
@@ -525,7 +542,9 @@
 ./snmpgetnext.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpgetnext.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpgetnext.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpgetnext.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpgetnext.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpgetnext.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpgetnext.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpgetnext.lo: ../include/net-snmp/library/mib.h
 ./snmpgetnext.lo: ../include/net-snmp/mib_api.h
@@ -566,8 +585,8 @@
 ./snmpgetnext.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpgetnext.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpgetnext.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpgetnext.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpgetnext.lo: ../include/net-snmp/library/snmpusm.h
+./snmpgetnext.lo: ../include/net-snmp/library/snmptsm.h
 ./snmppcap.lo: ../include/net-snmp/net-snmp-config.h
 ./snmppcap.lo: ../include/net-snmp/net-snmp-includes.h
 ./snmppcap.lo: ../include/net-snmp/definitions.h ../include/net-snmp/types.h
@@ -595,7 +614,9 @@
 ./snmppcap.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmppcap.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmppcap.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmppcap.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmppcap.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmppcap.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmppcap.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmppcap.lo: ../include/net-snmp/library/mib.h
 ./snmppcap.lo: ../include/net-snmp/mib_api.h
@@ -621,7 +642,8 @@
 ./snmppcap.lo: ../include/net-snmp/library/container_iterator.h
 ./snmppcap.lo: ../include/net-snmp/library/container.h
 ./snmppcap.lo: ../include/net-snmp/library/snmp_assert.h
-./snmppcap.lo: ../include/net-snmp/version.h ../include/net-snmp/config_api.h
+./snmppcap.lo: ../include/net-snmp/version.h
+./snmppcap.lo: ../include/net-snmp/config_api.h
 ./snmppcap.lo: ../include/net-snmp/library/read_config.h
 ./snmppcap.lo: ../include/net-snmp/library/default_store.h
 ./snmppcap.lo: ../include/net-snmp/library/snmp_parse_args.h
@@ -635,12 +657,13 @@
 ./snmppcap.lo: ../include/net-snmp/library/lcd_time.h
 ./snmppcap.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmppcap.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmppcap.lo: ../include/net-snmp/library/snmptsm.h
 ./snmppcap.lo: ../include/net-snmp/library/snmpusm.h
+./snmppcap.lo: ../include/net-snmp/library/snmptsm.h
 ./snmppcap.lo: ../include/net-snmp/library/large_fd_set.h
 ./snmpping.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpping.lo: ../include/net-snmp/net-snmp-includes.h
-./snmpping.lo: ../include/net-snmp/definitions.h ../include/net-snmp/types.h
+./snmpping.lo: ../include/net-snmp/definitions.h
+./snmpping.lo: ../include/net-snmp/types.h
 ./snmpping.lo: ../include/net-snmp/library/oid.h
 ./snmpping.lo: ../include/net-snmp/library/types.h
 ./snmpping.lo: ../include/net-snmp/library/snmp_api.h
@@ -665,7 +688,9 @@
 ./snmpping.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpping.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpping.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpping.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpping.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpping.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpping.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpping.lo: ../include/net-snmp/library/mib.h
 ./snmpping.lo: ../include/net-snmp/mib_api.h
@@ -691,7 +716,8 @@
 ./snmpping.lo: ../include/net-snmp/library/container_iterator.h
 ./snmpping.lo: ../include/net-snmp/library/container.h
 ./snmpping.lo: ../include/net-snmp/library/snmp_assert.h
-./snmpping.lo: ../include/net-snmp/version.h ../include/net-snmp/config_api.h
+./snmpping.lo: ../include/net-snmp/version.h
+./snmpping.lo: ../include/net-snmp/config_api.h
 ./snmpping.lo: ../include/net-snmp/library/read_config.h
 ./snmpping.lo: ../include/net-snmp/library/default_store.h
 ./snmpping.lo: ../include/net-snmp/library/snmp_parse_args.h
@@ -705,8 +731,8 @@
 ./snmpping.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpping.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpping.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpping.lo: ../include/net-snmp/library/snmptsm.h
-./snmpping.lo: ../include/net-snmp/library/snmpusm.h ../snmplib/inet_ntop.h
+./snmpping.lo: ../include/net-snmp/library/snmpusm.h
+./snmpping.lo: ../include/net-snmp/library/snmptsm.h ../snmplib/inet_ntop.h
 ./snmpps.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpps.lo: ../include/net-snmp/net-snmp-includes.h
 ./snmpps.lo: ../include/net-snmp/definitions.h ../include/net-snmp/types.h
@@ -733,7 +759,9 @@
 ./snmpps.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpps.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpps.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpps.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpps.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpps.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpps.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpps.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./snmpps.lo: ../include/net-snmp/library/parse.h
@@ -772,8 +800,8 @@
 ./snmpps.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpps.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpps.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpps.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpps.lo: ../include/net-snmp/library/snmpusm.h
+./snmpps.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpset.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpset.lo: ../include/net-snmp/net-snmp-includes.h
 ./snmpset.lo: ../include/net-snmp/definitions.h ../include/net-snmp/types.h
@@ -801,7 +829,9 @@
 ./snmpset.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpset.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpset.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpset.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpset.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpset.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpset.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpset.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./snmpset.lo: ../include/net-snmp/library/parse.h
@@ -840,8 +870,8 @@
 ./snmpset.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpset.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpset.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpset.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpset.lo: ../include/net-snmp/library/snmpusm.h
+./snmpset.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpstatus.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpstatus.lo: ../include/net-snmp/utilities.h ../include/net-snmp/types.h
 ./snmpstatus.lo: ../include/net-snmp/library/oid.h
@@ -869,7 +899,9 @@
 ./snmpstatus.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpstatus.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpstatus.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpstatus.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpstatus.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpstatus.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpstatus.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpstatus.lo: ../include/net-snmp/library/mib.h
 ./snmpstatus.lo: ../include/net-snmp/mib_api.h
@@ -910,8 +942,8 @@
 ./snmpstatus.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpstatus.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpstatus.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpstatus.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpstatus.lo: ../include/net-snmp/library/snmpusm.h
+./snmpstatus.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptable.lo: ../include/net-snmp/net-snmp-config.h
 ./snmptable.lo: ../include/net-snmp/net-snmp-includes.h
 ./snmptable.lo: ../include/net-snmp/definitions.h ../include/net-snmp/types.h
@@ -939,7 +971,9 @@
 ./snmptable.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmptable.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmptable.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmptable.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmptable.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmptable.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmptable.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmptable.lo: ../include/net-snmp/library/mib.h
 ./snmptable.lo: ../include/net-snmp/mib_api.h
@@ -980,8 +1014,8 @@
 ./snmptable.lo: ../include/net-snmp/library/lcd_time.h
 ./snmptable.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmptable.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmptable.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptable.lo: ../include/net-snmp/library/snmpusm.h
+./snmptable.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptest.lo: ../include/net-snmp/net-snmp-config.h
 ./snmptest.lo: ../include/net-snmp/net-snmp-includes.h
 ./snmptest.lo: ../include/net-snmp/definitions.h ../include/net-snmp/types.h
@@ -1009,7 +1043,9 @@
 ./snmptest.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmptest.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmptest.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmptest.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmptest.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmptest.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmptest.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmptest.lo: ../include/net-snmp/library/mib.h
 ./snmptest.lo: ../include/net-snmp/mib_api.h
@@ -1035,7 +1071,8 @@
 ./snmptest.lo: ../include/net-snmp/library/container_iterator.h
 ./snmptest.lo: ../include/net-snmp/library/container.h
 ./snmptest.lo: ../include/net-snmp/library/snmp_assert.h
-./snmptest.lo: ../include/net-snmp/version.h ../include/net-snmp/config_api.h
+./snmptest.lo: ../include/net-snmp/version.h
+./snmptest.lo: ../include/net-snmp/config_api.h
 ./snmptest.lo: ../include/net-snmp/library/read_config.h
 ./snmptest.lo: ../include/net-snmp/library/default_store.h
 ./snmptest.lo: ../include/net-snmp/library/snmp_parse_args.h
@@ -1049,8 +1086,8 @@
 ./snmptest.lo: ../include/net-snmp/library/lcd_time.h
 ./snmptest.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmptest.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmptest.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptest.lo: ../include/net-snmp/library/snmpusm.h
+./snmptest.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptls.lo: ../include/net-snmp/net-snmp-config.h
 ./snmptls.lo: ../include/net-snmp/net-snmp-features.h
 ./snmptls.lo: ../include/net-snmp/net-snmp-includes.h
@@ -1079,7 +1116,9 @@
 ./snmptls.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmptls.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmptls.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmptls.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmptls.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmptls.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmptls.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmptls.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./snmptls.lo: ../include/net-snmp/library/parse.h
@@ -1117,8 +1156,8 @@
 ./snmptls.lo: ../include/net-snmp/library/lcd_time.h
 ./snmptls.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmptls.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmptls.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptls.lo: ../include/net-snmp/library/snmpusm.h
+./snmptls.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptls.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./snmptls.lo: ../include/net-snmp/agent/mib_module_config.h
 ./snmptls.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -1189,7 +1228,9 @@
 ./snmptranslate.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmptranslate.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmptranslate.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmptranslate.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmptranslate.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmptranslate.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmptranslate.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmptranslate.lo: ../include/net-snmp/library/mib.h
 ./snmptranslate.lo: ../include/net-snmp/mib_api.h
@@ -1247,7 +1288,9 @@
 ./snmptrap.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmptrap.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmptrap.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmptrap.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmptrap.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmptrap.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmptrap.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmptrap.lo: ../include/net-snmp/library/mib.h
 ./snmptrap.lo: ../include/net-snmp/mib_api.h
@@ -1273,7 +1316,8 @@
 ./snmptrap.lo: ../include/net-snmp/library/container_iterator.h
 ./snmptrap.lo: ../include/net-snmp/library/container.h
 ./snmptrap.lo: ../include/net-snmp/library/snmp_assert.h
-./snmptrap.lo: ../include/net-snmp/version.h ../include/net-snmp/config_api.h
+./snmptrap.lo: ../include/net-snmp/version.h
+./snmptrap.lo: ../include/net-snmp/config_api.h
 ./snmptrap.lo: ../include/net-snmp/library/read_config.h
 ./snmptrap.lo: ../include/net-snmp/library/default_store.h
 ./snmptrap.lo: ../include/net-snmp/library/snmp_parse_args.h
@@ -1287,8 +1331,8 @@
 ./snmptrap.lo: ../include/net-snmp/library/lcd_time.h
 ./snmptrap.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmptrap.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmptrap.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptrap.lo: ../include/net-snmp/library/snmpusm.h
+./snmptrap.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptrapd.lo: ../include/net-snmp/net-snmp-config.h
 ./snmptrapd.lo: ../include/net-snmp/net-snmp-includes.h
 ./snmptrapd.lo: ../include/net-snmp/definitions.h ../include/net-snmp/types.h
@@ -1316,7 +1360,9 @@
 ./snmptrapd.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmptrapd.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmptrapd.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmptrapd.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmptrapd.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmptrapd.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmptrapd.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmptrapd.lo: ../include/net-snmp/library/mib.h
 ./snmptrapd.lo: ../include/net-snmp/mib_api.h
@@ -1357,8 +1403,8 @@
 ./snmptrapd.lo: ../include/net-snmp/library/lcd_time.h
 ./snmptrapd.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmptrapd.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmptrapd.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptrapd.lo: ../include/net-snmp/library/snmpusm.h
+./snmptrapd.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptrapd.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./snmptrapd.lo: ../include/net-snmp/agent/mib_module_config.h
 ./snmptrapd.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -1397,7 +1443,7 @@
 ./snmptrapd.lo: ../include/net-snmp/agent/mfd.h
 ./snmptrapd.lo: ../include/net-snmp/agent/snmp_get_statistic.h
 ./snmptrapd.lo: ../include/net-snmp/agent/netsnmp_close_fds.h
-./snmptrapd.lo: ../agent/agent_global_vars.h
+./snmptrapd.lo: ../snmplib/snmp_syslog.h ../agent/agent_global_vars.h
 ./snmptrapd.lo: ../agent/mibgroup/snmpv3/snmpEngine.h
 ./snmptrapd.lo: ../agent/mibgroup/snmpv3/usmUser.h
 ./snmptrapd.lo: ../agent/mibgroup/agent/nsVacmAccessTable.h
@@ -1436,7 +1482,9 @@
 ./snmptrapd_auth.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmptrapd_auth.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmptrapd_auth.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmptrapd_auth.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmptrapd_auth.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmptrapd_auth.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmptrapd_auth.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmptrapd_auth.lo: ../include/net-snmp/library/mib.h
 ./snmptrapd_auth.lo: ../include/net-snmp/mib_api.h
@@ -1477,8 +1525,8 @@
 ./snmptrapd_auth.lo: ../include/net-snmp/library/lcd_time.h
 ./snmptrapd_auth.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmptrapd_auth.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmptrapd_auth.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptrapd_auth.lo: ../include/net-snmp/library/snmpusm.h
+./snmptrapd_auth.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptrapd_auth.lo: snmptrapd_handlers.h snmptrapd_auth.h snmptrapd_ds.h
 ./snmptrapd_auth.lo: ../include/net-snmp/agent/agent_module_config.h
 ./snmptrapd_auth.lo: ../include/net-snmp/agent/mib_module_config.h
@@ -1513,7 +1561,9 @@
 ./snmptrapd_handlers.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmptrapd_handlers.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmptrapd_handlers.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmptrapd_handlers.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmptrapd_handlers.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmptrapd_handlers.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmptrapd_handlers.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmptrapd_handlers.lo: ../include/net-snmp/library/mib.h
 ./snmptrapd_handlers.lo: ../include/net-snmp/mib_api.h
@@ -1553,8 +1603,8 @@
 ./snmptrapd_handlers.lo: ../include/net-snmp/library/lcd_time.h
 ./snmptrapd_handlers.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmptrapd_handlers.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmptrapd_handlers.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptrapd_handlers.lo: ../include/net-snmp/library/snmpusm.h
+./snmptrapd_handlers.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptrapd_handlers.lo: ../include/net-snmp/agent/net-snmp-agent-includes.h
 ./snmptrapd_handlers.lo: ../include/net-snmp/agent/mib_module_config.h
 ./snmptrapd_handlers.lo: ../include/net-snmp/agent/agent_module_config.h
@@ -1624,7 +1674,9 @@
 ./snmptrapd_log.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmptrapd_log.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmptrapd_log.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmptrapd_log.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmptrapd_log.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmptrapd_log.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmptrapd_log.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmptrapd_log.lo: ../include/net-snmp/library/mib.h
 ./snmptrapd_log.lo: ../include/net-snmp/mib_api.h
@@ -1665,8 +1717,8 @@
 ./snmptrapd_log.lo: ../include/net-snmp/library/lcd_time.h
 ./snmptrapd_log.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmptrapd_log.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmptrapd_log.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptrapd_log.lo: ../include/net-snmp/library/snmpusm.h
+./snmptrapd_log.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptrapd_log.lo: snmptrapd_handlers.h snmptrapd_log.h snmptrapd_ds.h
 ./snmptrapd_sql.lo: ../include/net-snmp/net-snmp-config.h
 ./snmptrapd_sql.lo: ../include/net-snmp/net-snmp-features.h
@@ -1697,7 +1749,9 @@
 ./snmpusm.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpusm.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpusm.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpusm.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpusm.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpusm.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpusm.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpusm.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./snmpusm.lo: ../include/net-snmp/library/parse.h
@@ -1736,8 +1790,8 @@
 ./snmpusm.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpusm.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpusm.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpusm.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpusm.lo: ../include/net-snmp/library/snmpusm.h
+./snmpusm.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpusm.lo: ../include/net-snmp/library/snmp_openssl.h
 ./snmpvacm.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpvacm.lo: ../include/net-snmp/net-snmp-includes.h
@@ -1766,7 +1820,9 @@
 ./snmpvacm.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpvacm.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpvacm.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpvacm.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpvacm.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpvacm.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpvacm.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpvacm.lo: ../include/net-snmp/library/mib.h
 ./snmpvacm.lo: ../include/net-snmp/mib_api.h
@@ -1792,7 +1848,8 @@
 ./snmpvacm.lo: ../include/net-snmp/library/container_iterator.h
 ./snmpvacm.lo: ../include/net-snmp/library/container.h
 ./snmpvacm.lo: ../include/net-snmp/library/snmp_assert.h
-./snmpvacm.lo: ../include/net-snmp/version.h ../include/net-snmp/config_api.h
+./snmpvacm.lo: ../include/net-snmp/version.h
+./snmpvacm.lo: ../include/net-snmp/config_api.h
 ./snmpvacm.lo: ../include/net-snmp/library/read_config.h
 ./snmpvacm.lo: ../include/net-snmp/library/default_store.h
 ./snmpvacm.lo: ../include/net-snmp/library/snmp_parse_args.h
@@ -1806,8 +1863,8 @@
 ./snmpvacm.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpvacm.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpvacm.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpvacm.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpvacm.lo: ../include/net-snmp/library/snmpusm.h
+./snmpvacm.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpwalk.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpwalk.lo: ../include/net-snmp/net-snmp-includes.h
 ./snmpwalk.lo: ../include/net-snmp/definitions.h ../include/net-snmp/types.h
@@ -1835,7 +1892,9 @@
 ./snmpwalk.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpwalk.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpwalk.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpwalk.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpwalk.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpwalk.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpwalk.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpwalk.lo: ../include/net-snmp/library/mib.h
 ./snmpwalk.lo: ../include/net-snmp/mib_api.h
@@ -1861,7 +1920,8 @@
 ./snmpwalk.lo: ../include/net-snmp/library/container_iterator.h
 ./snmpwalk.lo: ../include/net-snmp/library/container.h
 ./snmpwalk.lo: ../include/net-snmp/library/snmp_assert.h
-./snmpwalk.lo: ../include/net-snmp/version.h ../include/net-snmp/config_api.h
+./snmpwalk.lo: ../include/net-snmp/version.h
+./snmpwalk.lo: ../include/net-snmp/config_api.h
 ./snmpwalk.lo: ../include/net-snmp/library/read_config.h
 ./snmpwalk.lo: ../include/net-snmp/library/default_store.h
 ./snmpwalk.lo: ../include/net-snmp/library/snmp_parse_args.h
@@ -1875,8 +1935,8 @@
 ./snmpwalk.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpwalk.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpwalk.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpwalk.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpwalk.lo: ../include/net-snmp/library/snmpusm.h
+./snmpwalk.lo: ../include/net-snmp/library/snmptsm.h
 ./sshtosnmp.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpnetstat/ffs.lo: ./snmpnetstat/ffs.h
 ./snmpnetstat/if.lo: ../include/net-snmp/net-snmp-config.h
@@ -1907,7 +1967,9 @@
 ./snmpnetstat/if.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpnetstat/if.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpnetstat/if.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpnetstat/if.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpnetstat/if.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpnetstat/if.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpnetstat/if.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpnetstat/if.lo: ../include/net-snmp/library/mib.h
 ./snmpnetstat/if.lo: ../include/net-snmp/mib_api.h
@@ -1948,8 +2010,8 @@
 ./snmpnetstat/if.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpnetstat/if.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpnetstat/if.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpnetstat/if.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/if.lo: ../include/net-snmp/library/snmpusm.h
+./snmpnetstat/if.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/if.lo: ./snmpnetstat/main.h
 ./snmpnetstat/if.lo: ./snmpnetstat/netstat.h
 ./snmpnetstat/inet.lo: ../include/net-snmp/net-snmp-config.h
@@ -1980,7 +2042,9 @@
 ./snmpnetstat/inet.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpnetstat/inet.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpnetstat/inet.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpnetstat/inet.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpnetstat/inet.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpnetstat/inet.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpnetstat/inet.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpnetstat/inet.lo: ../include/net-snmp/library/mib.h
 ./snmpnetstat/inet.lo: ../include/net-snmp/mib_api.h
@@ -2021,8 +2085,8 @@
 ./snmpnetstat/inet.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpnetstat/inet.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpnetstat/inet.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpnetstat/inet.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/inet.lo: ../include/net-snmp/library/snmpusm.h
+./snmpnetstat/inet.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/inet.lo: ./snmpnetstat/main.h ./snmpnetstat/netstat.h
 ./snmpnetstat/inet6.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpnetstat/inet6.lo: ../include/net-snmp/net-snmp-includes.h
@@ -2052,7 +2116,9 @@
 ./snmpnetstat/inet6.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpnetstat/inet6.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpnetstat/inet6.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpnetstat/inet6.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpnetstat/inet6.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpnetstat/inet6.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpnetstat/inet6.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpnetstat/inet6.lo: ../include/net-snmp/library/mib.h
 ./snmpnetstat/inet6.lo: ../include/net-snmp/mib_api.h
@@ -2093,8 +2159,8 @@
 ./snmpnetstat/inet6.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpnetstat/inet6.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpnetstat/inet6.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpnetstat/inet6.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/inet6.lo: ../include/net-snmp/library/snmpusm.h
+./snmpnetstat/inet6.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/inet6.lo: ./snmpnetstat/main.h ./snmpnetstat/netstat.h
 ./snmpnetstat/inetx.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpnetstat/inetx.lo: ../include/net-snmp/net-snmp-includes.h
@@ -2124,7 +2190,9 @@
 ./snmpnetstat/inetx.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpnetstat/inetx.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpnetstat/inetx.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpnetstat/inetx.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpnetstat/inetx.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpnetstat/inetx.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpnetstat/inetx.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpnetstat/inetx.lo: ../include/net-snmp/library/mib.h
 ./snmpnetstat/inetx.lo: ../include/net-snmp/mib_api.h
@@ -2165,8 +2233,8 @@
 ./snmpnetstat/inetx.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpnetstat/inetx.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpnetstat/inetx.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpnetstat/inetx.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/inetx.lo: ../include/net-snmp/library/snmpusm.h
+./snmpnetstat/inetx.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/inetx.lo: ./snmpnetstat/main.h ./snmpnetstat/netstat.h
 ./snmpnetstat/main.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpnetstat/main.lo: ../include/net-snmp/net-snmp-includes.h
@@ -2196,7 +2264,9 @@
 ./snmpnetstat/main.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpnetstat/main.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpnetstat/main.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpnetstat/main.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpnetstat/main.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpnetstat/main.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpnetstat/main.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpnetstat/main.lo: ../include/net-snmp/library/mib.h
 ./snmpnetstat/main.lo: ../include/net-snmp/mib_api.h
@@ -2237,8 +2307,8 @@
 ./snmpnetstat/main.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpnetstat/main.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpnetstat/main.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpnetstat/main.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/main.lo: ../include/net-snmp/library/snmpusm.h
+./snmpnetstat/main.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/main.lo: ./snmpnetstat/main.h ./snmpnetstat/netstat.h
 ./snmpnetstat/route.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpnetstat/route.lo: ../include/net-snmp/net-snmp-includes.h
@@ -2268,7 +2338,9 @@
 ./snmpnetstat/route.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpnetstat/route.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpnetstat/route.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpnetstat/route.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpnetstat/route.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpnetstat/route.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpnetstat/route.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpnetstat/route.lo: ../include/net-snmp/library/mib.h
 ./snmpnetstat/route.lo: ../include/net-snmp/mib_api.h
@@ -2309,8 +2381,8 @@
 ./snmpnetstat/route.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpnetstat/route.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpnetstat/route.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpnetstat/route.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/route.lo: ../include/net-snmp/library/snmpusm.h
+./snmpnetstat/route.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/route.lo: ./snmpnetstat/main.h ./snmpnetstat/netstat.h
 ./snmpnetstat/route.lo: ./snmpnetstat/ffs.h
 ./snmpnetstat/routex.lo: ../include/net-snmp/net-snmp-config.h
@@ -2341,7 +2413,9 @@
 ./snmpnetstat/routex.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpnetstat/routex.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpnetstat/routex.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpnetstat/routex.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpnetstat/routex.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpnetstat/routex.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpnetstat/routex.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpnetstat/routex.lo: ../include/net-snmp/library/mib.h
 ./snmpnetstat/routex.lo: ../include/net-snmp/mib_api.h
@@ -2382,8 +2456,8 @@
 ./snmpnetstat/routex.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpnetstat/routex.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpnetstat/routex.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpnetstat/routex.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/routex.lo: ../include/net-snmp/library/snmpusm.h
+./snmpnetstat/routex.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/routex.lo: ./snmpnetstat/main.h ./snmpnetstat/netstat.h
 ./snmpnetstat/winstub.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpnetstat/winstub.lo: ../include/net-snmp/net-snmp-includes.h
@@ -2413,7 +2487,9 @@
 ./snmpnetstat/winstub.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpnetstat/winstub.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpnetstat/winstub.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpnetstat/winstub.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpnetstat/winstub.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpnetstat/winstub.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpnetstat/winstub.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpnetstat/winstub.lo: ../include/net-snmp/library/mib.h
 ./snmpnetstat/winstub.lo: ../include/net-snmp/mib_api.h
@@ -2454,5 +2530,5 @@
 ./snmpnetstat/winstub.lo: ../include/net-snmp/library/lcd_time.h
 ./snmpnetstat/winstub.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmpnetstat/winstub.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmpnetstat/winstub.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpnetstat/winstub.lo: ../include/net-snmp/library/snmpusm.h
+./snmpnetstat/winstub.lo: ../include/net-snmp/library/snmptsm.h
diff -urpN net-snmp-5.8/apps/Makefile.in net-snmp-5.9.1/apps/Makefile.in
--- net-snmp-5.8/apps/Makefile.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/Makefile.in	2021-05-26 05:19:35.000000000 +0700
@@ -53,6 +53,8 @@ mysubdir=apps
 @NETSNMP_HAVE_AGENTX_LIBS_TRUE@AGENTXTRAP = agentxtrap$(EXEEXT)
 @NETSNMP_HAVE_AGENTX_LIBS_FALSE@AGENTXTRAP =
 
+INSTALLBINPROGS_LIBCURSES_TRUE = snmpps$(EXEEXT)
+
 INSTALLBINPROGS	= snmpget$(EXEEXT) 			\
 		snmpgetnext$(EXEEXT) 			\
 		$(SNMPSETINSTALLBINPROG)	        \
@@ -66,7 +68,7 @@ INSTALLBINPROGS	= snmpget$(EXEEXT) 			\
 		snmpdelta$(EXEEXT) 			\
 		snmptest$(EXEEXT)			\
 		snmpdf$(EXEEXT) 			\
-		snmpps$(EXEEXT) 			\
+		$(INSTALLBINPROGS_LIBCURSES_@HAVE_LIBCURSES@) \
 		$(SNMPPINGINSTALLBINPROG)               \
 		$(AGENTXTRAP)				\
 		$(SNMPVACMINSTALLBINPROG)	        \
@@ -149,8 +151,13 @@ FTOBJS=$(LIBTRAPD_FTS) \
 
 all: standardall
 
-OTHERINSTALL=snmpinforminstall snmptopinstall snmptrapdperlinstall
-OTHERUNINSTALL=snmpinformuninstall snmptopuninstall snmptrapdperluninstall
+OTHERINSTALL_LIBCURSES_TRUE=snmptopinstall
+OTHERUNINSTALL_LIBCURSES_TRUE=snmptopuninstall
+
+OTHERINSTALL=snmpinforminstall snmptrapdperlinstall		\
+	$(OTHERINSTALL_LIBCURSES_@HAVE_LIBCURSES@)
+OTHERUNINSTALL=snmpinformuninstall snmptrapdperluninstall	\
+	$(OTHERUNINSTALL_LIBCURSES_@HAVE_LIBCURSES@)
 
 #
 # build rules
@@ -230,7 +237,7 @@ snmppcap$(EXEEXT):    snmppcap.$(OSUFFIX
 	$(LINK) ${CFLAGS} -o $@ snmppcap.$(OSUFFIX) ${LDFLAGS} ${LIBS} -lpcap
 
 libnetsnmptrapd.$(LIB_EXTENSION)$(LIB_VERSION): $(LLIBTRAPD_OBJS)
-	$(LIB_LD_CMD) $@ ${LLIBTRAPD_OBJS} $(MIBLIB) $(USELIBS) $(PERLLDOPTS_FOR_LIBS) $(LIB_LD_LIBS)
+	$(LIB_LD_CMD) $@ ${LLIBTRAPD_OBJS} $(MIBLIB) $(USELIBS) $(PERLLDOPTS_FOR_LIBS) $(LDFLAGS)
 	$(RANLIB) $@
 
 snmpinforminstall:
diff -urpN net-snmp-5.8/apps/agentxtrap.c net-snmp-5.9.1/apps/agentxtrap.c
--- net-snmp-5.8/apps/agentxtrap.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/agentxtrap.c	2021-05-26 05:19:35.000000000 +0700
@@ -5,7 +5,7 @@
 #include <signal.h>
 #include <string.h>
 #ifdef HAVE_UNISTD_H
-#include <unistd.h> /* optind, optarg and optopt */
+#include <unistd.h>             /* optind, optarg and optopt */
 #endif
 
 #include <net-snmp/net-snmp-includes.h>
@@ -17,12 +17,12 @@
 #include "../agent/mibgroup/agentx/protocol.h"
 #include "../agent/mibgroup/agentx/subagent.h"
 
-netsnmp_feature_require(snmp_split_pdu)
-netsnmp_feature_require(snmp_reset_var_types)
+netsnmp_feature_require(snmp_split_pdu);
+netsnmp_feature_require(snmp_reset_var_types);
 
 
 static void
-usage(const char* progname)
+usage(const char *progname)
 {
     fprintf(stderr,
             "USAGE: %s [OPTIONS] TRAP-PARAMETERS\n"
@@ -36,8 +36,7 @@ usage(const char* progname)
     fprintf(stderr,
             "  -h\t\t\tdisplay this help message\n"
             "  -V\t\t\tdisplay package version number\n"
-            "  -m MIB[" ENV_SEPARATOR "...]\t\tload given list of MIBs (ALL loads "
-            "everything)\n"
+            "  -m MIB[" ENV_SEPARATOR "...]\t\tload given list of MIBs (ALL loads everything)\n"
             "  -M DIR[" ENV_SEPARATOR "...]\t\tlook in given list of directories for MIBs\n"
             "  -D[TOKEN[,...]]\tturn on debugging output for the specified "
             "TOKENs\n"
@@ -48,7 +47,7 @@ usage(const char* progname)
             "  -P MIBOPTS\t\tToggle various defaults controlling mib "
             "parsing:\n");
     snmp_mib_toggle_options_usage("\t\t\t  ", stderr);
-#endif /* NETSNMP_DISABLE_MIB_LOADING */
+#endif                          /* NETSNMP_DISABLE_MIB_LOADING */
     fprintf(stderr,
             "  -L LOGOPTS\t\tToggle various defaults controlling logging:\n");
     snmp_log_options_usage("\t\t\t  ", stderr);
@@ -63,36 +62,38 @@ usage(const char* progname)
 }
 
 struct tState_s;
-typedef const struct tState_s* tState;
+typedef const struct tState_s *tState;
 struct tState_s {
-    void (*entry)(tState self); /**<< State entry action */
-    void (*exit)(tState self); /**<< State exit action */
+    void            (*entry)(tState self);
+                                /**<< State entry action */
+    void            (*exit)(tState self);
+                                /**<< State exit action */
     /** Handler for AgentX-Response-PDU's */
-    void (*response)(tState self, netsnmp_pdu *res);
+    void            (*response)(tState self, netsnmp_pdu *res);
     /** State to change to if an AgentX timeout occurs or the timer runs out */
-    tState timeout;
-    void (*disconnect)(tState self); /**<< Handler for disconnect indications */
+    tState          timeout;
+    void            (*disconnect)(tState self);
+                                /**<< Handler for disconnect indications */
     /** Handler for Close-PDU indications */
-    void (*close)(tState self, netsnmp_pdu *res);
-    const char* name; /**<< Name of the current state */
-    int is_open; /**<< If the connection is open in this state */
+    void            (*close)(tState self, netsnmp_pdu *res);
+    const char     *name;       /**<< Name of the current state */
+    int             is_open;    /**<< If the connection is open in this state */
 };
 
-static tState state; /**<< Current state of the state machine */
-static tState next_state; /**<< Next state of the state machine */
-
-static const char  *context = NULL; /**<< Context that delivers the trap */
-static size_t       contextLen; /**<< Length of eventual context */
-static int          result = 1; /**<< Program return value */
-static netsnmp_pdu *pdu = NULL; /**<< The trap pdu that is to be sent */
+static tState   state;          /**<< Current state of the state machine */
+static tState   next_state;     /**<< Next state of the state machine */
+static const char *context;     /**<< Context that delivers the trap */
+static size_t   contextLen;     /**<< Length of eventual context */
+static int      result = 1;     /**<< Program return value */
+static netsnmp_pdu *pdu;        /**<< The trap pdu that is to be sent */
 /** The reference number of the next packet */
-static long         packetid = 0;
+static long     packetid;
 /** The session id of the session to the master */
-static long         session;
-static void        *sessp = NULL; /**<< The current communication session */
+static long     session;
+static void    *sessp;          /**<< The current communication session */
 
 #define STATE_CALL(method)                                              \
-    if(!state->method) {                                                \
+    if (!state->method) {                                               \
         snmp_log(LOG_ERR, "No " #method " method in %s, terminating\n", \
                  state->name);                                          \
         abort();                                                        \
@@ -103,7 +104,8 @@ static void
 change_state(tState new_state)
 {
     if (next_state && next_state != new_state)
-        DEBUGMSGTL(("process", "Ignore transition to %s\n", next_state->name));
+        DEBUGMSGTL(("process", "Ignore transition to %s\n",
+                    next_state->name));
     next_state = new_state;
 }
 
@@ -111,28 +113,30 @@ static int
 handle_agentx_response(int operation, netsnmp_session *sp, int reqid,
                        netsnmp_pdu *act, void *magic)
 {
-    switch(operation) {
+    switch (operation) {
     case NETSNMP_CALLBACK_OP_RECEIVED_MESSAGE:
-        if(act->command == AGENTX_MSG_CLEANUPSET) {
+        if (act->command == AGENTX_MSG_CLEANUPSET) {
             /* Do nothing - no response and no action as nothing get
              * allocated in any handler here
              */
-        } else if(act->command != AGENTX_MSG_RESPONSE) {
+        } else if (act->command != AGENTX_MSG_RESPONSE) {
             /* Copy the head to a response */
-            netsnmp_pdu* res = snmp_split_pdu(act, 0, 0);
+            netsnmp_pdu    *res = snmp_split_pdu(act, 0, 0);
             res->command = AGENTX_MSG_RESPONSE;
             if (act->sessid != session || !state->is_open)
                 res->errstat = AGENTX_ERR_NOT_OPEN;
-            if(res->errstat == AGENTX_ERR_NOERROR)
-                switch(act->command) {
+            if (res->errstat == AGENTX_ERR_NOERROR)
+                switch (act->command) {
                 case AGENTX_MSG_GET:
                     res->variables = snmp_clone_varbind(act->variables);
-                    snmp_reset_var_types(res->variables, SNMP_NOSUCHOBJECT);
+                    snmp_reset_var_types(res->variables,
+                                         SNMP_NOSUCHOBJECT);
                     break;
                 case AGENTX_MSG_GETNEXT:
                 case AGENTX_MSG_GETBULK:
                     res->variables = snmp_clone_varbind(act->variables);
-                    snmp_reset_var_types(res->variables, SNMP_ENDOFMIBVIEW);
+                    snmp_reset_var_types(res->variables,
+                                         SNMP_ENDOFMIBVIEW);
                     break;
                 case AGENTX_MSG_TESTSET:
                     res->errstat = SNMP_ERR_NOTWRITABLE;
@@ -153,9 +157,9 @@ handle_agentx_response(int operation, ne
                     res->errstat = AGENTX_ERR_PARSE_FAILED;
                     break;
                 }
-            if(snmp_send(sp, res) == 0)
+            if (snmp_send(sp, res) == 0)
                 snmp_free_pdu(res);
-            switch(act->command) {
+            switch (act->command) {
             case AGENTX_MSG_CLOSE:
                 /* Take action once the answer is sent! */
                 STATE_CALL(close)(state, act);
@@ -178,12 +182,12 @@ handle_agentx_response(int operation, ne
     return 0;
 }
 
-extern const struct tState_s Connecting;
-extern const struct tState_s Opening;
-extern const struct tState_s Notifying;
-extern const struct tState_s Closing;
-extern const struct tState_s Disconnecting;
-extern const struct tState_s Exit;
+static const struct tState_s Connecting;
+static const struct tState_s Opening;
+static const struct tState_s Notifying;
+static const struct tState_s Closing;
+static const struct tState_s Disconnecting;
+static const struct tState_s Exit;
 
 static void
 StateDisconnect(tState self)
@@ -195,7 +199,8 @@ StateDisconnect(tState self)
 static void
 StateClose(tState self, netsnmp_pdu *act)
 {
-    snmp_log(LOG_ERR, "Unexpected close with reason code %ld in state %s\n",
+    snmp_log(LOG_ERR,
+             "Unexpected close with reason code %ld in state %s\n",
              act->errstat, self->name);
     change_state(&Disconnecting);
 }
@@ -204,31 +209,32 @@ static void
 ConnectingEntry(tState self)
 {
     netsnmp_session init;
-    netsnmp_transport* t;
-    void* sess;
+    netsnmp_transport *t;
+    void           *sess;
 
-    if(sessp) {
+    if (sessp) {
         snmp_sess_close(sessp);
         sessp = NULL;
     }
 
     snmp_sess_init(&init);
     init.version = AGENTX_VERSION_1;
-    init.retries = 0; /* Retries are handled by the state machine */
+    init.retries = 0;           /* Retries are handled by the state machine */
     init.timeout = SNMP_DEFAULT_TIMEOUT;
     init.flags |= SNMP_FLAGS_STREAM_SOCKET;
     init.callback = handle_agentx_response;
     init.authenticator = NULL;
 
-    if(!(t = netsnmp_transport_open_client(
-             "agentx", netsnmp_ds_get_string(
-                 NETSNMP_DS_APPLICATION_ID, NETSNMP_DS_AGENT_X_SOCKET)))) {
+    if (!(t = netsnmp_transport_open_client("agentx",
+                                            netsnmp_ds_get_string
+                                            (NETSNMP_DS_APPLICATION_ID,
+                                             NETSNMP_DS_AGENT_X_SOCKET)))) {
         snmp_log(LOG_ERR, "Failed to connect to AgentX server\n");
         change_state(&Exit);
-    } else if(!(sess = snmp_sess_add_ex(
-                    &init, t, NULL, agentx_parse, NULL, NULL,
-                    agentx_realloc_build, agentx_check_packet, NULL))) {
-      snmp_log(LOG_ERR, "Failed to create session\n");
+    } else if (!(sess = snmp_sess_add_ex(&init, t, NULL, agentx_parse, NULL,
+                                         NULL, agentx_realloc_build,
+                                         agentx_check_packet, NULL))) {
+        snmp_log(LOG_ERR, "Failed to create session\n");
         change_state(&Exit);
     } else {
         sessp = sess;
@@ -236,7 +242,7 @@ ConnectingEntry(tState self)
     }
 }
 
-const struct tState_s Connecting = {
+static const struct tState_s Connecting = {
     ConnectingEntry,
     NULL,
     NULL,
@@ -247,13 +253,13 @@ const struct tState_s Connecting = {
     0
 };
 
-static netsnmp_pdu*
-pdu_create_opt_context(int command, const char* context, size_t len)
+static netsnmp_pdu *
+pdu_create_opt_context(int command, const char *context, size_t len)
 {
-    netsnmp_pdu* res = snmp_pdu_create(command);
+    netsnmp_pdu    *res = snmp_pdu_create(command);
     if (res)
         if (context) {
-            if (snmp_clone_mem((void**)&res->contextName, context, len)) {
+            if (snmp_clone_mem((void **) &res->contextName, context, len)) {
                 snmp_free_pdu(res);
                 res = NULL;
             } else
@@ -265,15 +271,15 @@ pdu_create_opt_context(int command, cons
 static void
 OpeningEntry(tState self)
 {
-    netsnmp_pdu* act =
+    netsnmp_pdu    *act =
         pdu_create_opt_context(AGENTX_MSG_OPEN, context, contextLen);
-    if(act) {
+    if (act) {
         act->sessid = 0;
         act->transid = 0;
         act->reqid = ++packetid;
         act->time = 0;
         snmp_pdu_add_variable(act, NULL, 0, ASN_OCTET_STR, NULL, 0);
-        if(snmp_sess_send(sessp, act) == 0)
+        if (snmp_sess_send(sessp, act) == 0)
             snmp_free_pdu(act);
     }
 }
@@ -281,7 +287,7 @@ OpeningEntry(tState self)
 static void
 OpeningRes(tState self, netsnmp_pdu *act)
 {
-    if(act->errstat == AGENTX_ERR_NOERROR) {
+    if (act->errstat == AGENTX_ERR_NOERROR) {
         session = act->sessid;
         change_state(&Notifying);
     } else {
@@ -290,7 +296,7 @@ OpeningRes(tState self, netsnmp_pdu *act
     }
 }
 
-const struct tState_s Opening = {
+static const struct tState_s Opening = {
     OpeningEntry,
     NULL,
     OpeningRes,
@@ -304,12 +310,12 @@ const struct tState_s Opening = {
 static void
 NotifyingEntry(tState self)
 {
-    netsnmp_pdu* act = snmp_clone_pdu(pdu);
-    if(act) {
+    netsnmp_pdu    *act = snmp_clone_pdu(pdu);
+    if (act) {
         act->sessid = session;
         act->transid = 0;
         act->reqid = ++packetid;
-        if(snmp_sess_send(sessp, act) == 0)
+        if (snmp_sess_send(sessp, act) == 0)
             snmp_free_pdu(act);
     }
 }
@@ -317,7 +323,7 @@ NotifyingEntry(tState self)
 static void
 NotifyingRes(tState self, netsnmp_pdu *act)
 {
-    if(act->errstat == AGENTX_ERR_NOERROR)
+    if (act->errstat == AGENTX_ERR_NOERROR)
         result = 0;
     else
         snmp_log(LOG_ERR, "Failed to send notification");
@@ -325,7 +331,7 @@ NotifyingRes(tState self, netsnmp_pdu *a
     change_state(&Closing);
 }
 
-const struct tState_s Notifying = {
+static const struct tState_s Notifying = {
     NotifyingEntry,
     NULL,
     NotifyingRes,
@@ -340,14 +346,14 @@ static void
 ClosingEntry(tState self)
 {
     /* CLOSE pdu->errstat */
-    netsnmp_pdu* act =
+    netsnmp_pdu    *act =
         pdu_create_opt_context(AGENTX_MSG_CLOSE, context, contextLen);
-    if(act) {
+    if (act) {
         act->sessid = session;
         act->transid = 0;
         act->reqid = ++packetid;
         act->errstat = AGENTX_CLOSE_SHUTDOWN;
-        if(snmp_sess_send(sessp, act) == 0)
+        if (snmp_sess_send(sessp, act) == 0)
             snmp_free_pdu(act);
     }
 }
@@ -355,7 +361,7 @@ ClosingEntry(tState self)
 static void
 ClosingRes(tState self, netsnmp_pdu *act)
 {
-    if(act->errstat != AGENTX_ERR_NOERROR) {
+    if (act->errstat != AGENTX_ERR_NOERROR) {
         snmp_log(LOG_ERR, "AgentX error status of %ld\n", act->errstat);
     }
     change_state(&Disconnecting);
@@ -373,7 +379,7 @@ ClosingClose(tState self, netsnmp_pdu *a
     change_state(&Disconnecting);
 }
 
-const struct tState_s Closing = {
+static const struct tState_s Closing = {
     ClosingEntry,
     NULL,
     ClosingRes,
@@ -392,7 +398,7 @@ DisconnectingEntry(tState self)
     change_state(&Exit);
 }
 
-const struct tState_s Disconnecting = {
+static const struct tState_s Disconnecting = {
     DisconnectingEntry,
     NULL,
     NULL,
@@ -403,7 +409,7 @@ const struct tState_s Disconnecting = {
     0
 };
 
-const struct tState_s Exit = {
+static const struct tState_s Exit = {
     NULL,
     NULL,
     NULL,
@@ -420,7 +426,7 @@ main(int argc, char *argv[])
     int             arg;
     char           *prognam;
     char           *cp = NULL;
-    const char*     sysUpTime = NULL;
+    const char     *sysUpTime = NULL;
 
     /* initialize tcpip, if necessary */
     SOCK_STARTUP;
@@ -434,9 +440,9 @@ main(int argc, char *argv[])
     putenv(strdup("POSIXLY_CORRECT=1"));
 
     netsnmp_ds_set_boolean(NETSNMP_DS_LIBRARY_ID,
-			   NETSNMP_DS_LIB_DISABLE_PERSISTENT_LOAD, 1);
+                           NETSNMP_DS_LIB_DISABLE_PERSISTENT_LOAD, 1);
     netsnmp_ds_set_boolean(NETSNMP_DS_LIBRARY_ID,
-			   NETSNMP_DS_LIB_DISABLE_PERSISTENT_SAVE, 1);
+                           NETSNMP_DS_LIB_DISABLE_PERSISTENT_SAVE, 1);
 
     while ((arg = getopt(argc, argv, ":Vhm:M:D:dP:L:U:c:x:")) != -1) {
         switch (arg) {
@@ -466,7 +472,8 @@ main(int argc, char *argv[])
             sysUpTime = optarg;
             break;
         case 'V':
-            fprintf(stderr, "NET-SNMP version: %s\n", netsnmp_get_version());
+            fprintf(stderr, "NET-SNMP version: %s\n",
+                    netsnmp_get_version());
             result = 0;
             goto out;
 #ifndef DISABLE_MIB_LOADING
@@ -478,7 +485,7 @@ main(int argc, char *argv[])
                 goto out;
             }
             break;
-#endif /* DISABLE_MIB_LOADING */
+#endif                          /* DISABLE_MIB_LOADING */
         case 'L':
             if (snmp_log_options(optarg, argc, argv) < 0)
                 goto out;
@@ -511,7 +518,8 @@ main(int argc, char *argv[])
     pdu = pdu_create_opt_context(AGENTX_MSG_NOTIFY, context, contextLen);
 
     if (sysUpTime)
-        snmp_add_var(pdu, sysuptime_oid, sysuptime_oid_len, 't', sysUpTime);
+        snmp_add_var(pdu, sysuptime_oid, sysuptime_oid_len, 't',
+                     sysUpTime);
 
     if (arg == argc) {
         fprintf(stderr, "Missing trap-oid parameter\n");
@@ -526,8 +534,8 @@ main(int argc, char *argv[])
     ++arg;
 
     while (arg < argc) {
-        oid    name[MAX_OID_LEN];
-        size_t name_length = MAX_OID_LEN;
+        oid             name[MAX_OID_LEN];
+        size_t          name_length = MAX_OID_LEN;
         arg += 3;
         if (arg > argc) {
             fprintf(stderr, "%s: Missing type/value for variable\n",
@@ -549,31 +557,37 @@ main(int argc, char *argv[])
 
     state = &Connecting;
     next_state = NULL;
-    if(state->entry) state->entry(state);
+    if (state->entry)
+        state->entry(state);
 
     /* main loop here... */
-    for(;;) {
-        int block = 1;
-        int numfds = 0;
-        int count;
-        fd_set fdset;
-        struct timeval timeout;
-
-        while(next_state) {
-            if(state->exit) state->exit(state);
+    for (;;) {
+        int             block = 1;
+        int             numfds = 0;
+        int             count;
+        fd_set          fdset;
+        struct timeval  timeout;
+        NETSNMP_SELECT_TIMEVAL timeout2;
+
+        while (next_state) {
+            if (state->exit)
+                state->exit(state);
             DEBUGMSGTL(("process", "State transition: %s -> %s\n",
                         state->name, next_state->name));
             state = next_state;
             next_state = NULL;
-            if(state->entry) state->entry(state);
+            if (state->entry)
+                state->entry(state);
         }
 
-        if(state == &Exit)
+        if (state == &Exit)
             break;
 
         FD_ZERO(&fdset);
         snmp_sess_select_info(sessp, &numfds, &fdset, &timeout, &block);
-        count = select(numfds, &fdset, NULL, NULL, !block ? &timeout : NULL);
+        timeout2.tv_sec = timeout.tv_sec;
+        timeout2.tv_usec = timeout.tv_usec;
+        count = select(numfds, &fdset, NULL, NULL, !block ? &timeout2 : NULL);
         if (count > 0)
             snmp_sess_read(sessp, &fdset);
         else if (count == 0)
diff -urpN net-snmp-5.8/apps/encode_keychange.c net-snmp-5.9.1/apps/encode_keychange.c
--- net-snmp-5.8/apps/encode_keychange.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/encode_keychange.c	2021-05-26 05:19:35.000000000 +0700
@@ -95,12 +95,12 @@ int             get_user_passphrases(voi
 int             snmp_ttyecho(const int fd, const int echo);
 char           *snmp_getpassphrase(const char *prompt, int fvisible);
 
-#ifdef WIN32
+#if defined(HAVE__CPUTS) && defined(HAVE__GETCH)
+#include <conio.h>
+#include <io.h>
 #define HAVE_GETPASS 1
-char           *getpass(const char *prompt);
-int             isatty(int);
-int             _cputs(const char *);
-int             _getch(void);
+#define isatty _isatty
+static char    *getpass(const char *prompt);
 #endif
 
 /*******************************************************************-o-******
@@ -758,8 +758,7 @@ snmp_getpassphrase(const char *prompt, i
 
 }                               /* end snmp_getpassphrase() */
 
-#ifdef WIN32
-
+#if defined(HAVE__CPUTS) && defined(HAVE__GETCH)
 int
 snmp_ttyecho(const int fd, const int echo)
 {
@@ -770,7 +769,7 @@ snmp_ttyecho(const int fd, const int ech
  * stops at the first newline, carrier return, or backspace.
  * WARNING! _getch does NOT read <Ctrl-C>
  */
-char           *
+static char    *
 getpass(const char *prompt)
 {
     static char     pbuf[128];
@@ -788,4 +787,4 @@ getpass(const char *prompt)
 
     return pbuf;
 }
-#endif                          /* WIN32 */
+#endif /* defined(HAVE__CPUTS) && defined(HAVE__GETCH) */
diff -urpN net-snmp-5.8/apps/snmpbulkwalk.c net-snmp-5.9.1/apps/snmpbulkwalk.c
--- net-snmp-5.8/apps/snmpbulkwalk.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpbulkwalk.c	2021-05-26 05:19:35.000000000 +0700
@@ -306,6 +306,7 @@ main(int argc, char *argv[])
                             && snmp_oid_compare(name, name_length,
                                                 vars->name,
                                                 vars->name_length) >= 0) {
+                            fflush(stdout);
                             fprintf(stderr, "Error: OID not increasing: ");
                             fprint_objid(stderr, name, name_length);
                             fprintf(stderr, " >= ");
diff -urpN net-snmp-5.8/apps/snmpdf.c net-snmp-5.9.1/apps/snmpdf.c
--- net-snmp-5.8/apps/snmpdf.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpdf.c	2021-05-26 05:19:35.000000000 +0700
@@ -146,6 +146,11 @@ add(netsnmp_pdu *pdu, const char *mibnod
         exit(1);
     }
 
+    if (base_length + indexlen > sizeof(base) / sizeof(base[0])) {
+        fprintf(stderr, "internal error for %s, giving up\n", mibnodename);
+        exit(1);
+    }
+
     if (index && indexlen) {
         memcpy(&(base[base_length]), index, indexlen * sizeof(oid));
         base_length += indexlen;
diff -urpN net-snmp-5.8/apps/snmpnetstat/Makefile.depend net-snmp-5.9.1/apps/snmpnetstat/Makefile.depend
--- net-snmp-5.8/apps/snmpnetstat/Makefile.depend	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpnetstat/Makefile.depend	2021-05-26 05:19:35.000000000 +0700
@@ -2,10 +2,12 @@
 
 ./ffs.lo: ffs.h
 ./if.lo: ../../include/net-snmp/net-snmp-config.h
+./if.lo: ../../include/net-snmp/system/linux.h
+./if.lo: ../../include/net-snmp/system/sysv.h
+./if.lo: ../../include/net-snmp/system/generic.h
 ./if.lo: ../../include/net-snmp/machine/generic.h
 ./if.lo: ../../include/net-snmp/net-snmp-includes.h
-./if.lo: ../../include/net-snmp/definitions.h
-./if.lo: ../../include/net-snmp/types.h
+./if.lo: ../../include/net-snmp/definitions.h ../../include/net-snmp/types.h
 ./if.lo: ../../include/net-snmp/library/oid.h
 ./if.lo: ../../include/net-snmp/library/types.h
 ./if.lo: ../../include/net-snmp/library/snmp_api.h
@@ -30,7 +32,9 @@
 ./if.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./if.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./if.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./if.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./if.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./if.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./if.lo: ../../include/net-snmp/library/ucd_compat.h
 ./if.lo: ../../include/net-snmp/library/mib.h
 ./if.lo: ../../include/net-snmp/mib_api.h
@@ -71,9 +75,10 @@
 ./if.lo: ../../include/net-snmp/library/lcd_time.h
 ./if.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./if.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./if.lo: ../../include/net-snmp/library/snmptsm.h
 ./if.lo: ../../include/net-snmp/library/snmpusm.h
-./if.lo: main.h netstat.h
+./if.lo: ../../include/net-snmp/library/snmptsm.h
+./if.lo: main.h
+./if.lo: netstat.h
 ./inet.lo: ../../include/net-snmp/net-snmp-config.h
 ./inet.lo: ../../include/net-snmp/net-snmp-includes.h
 ./inet.lo: ../../include/net-snmp/definitions.h
@@ -102,7 +107,9 @@
 ./inet.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./inet.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./inet.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./inet.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./inet.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./inet.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./inet.lo: ../../include/net-snmp/library/ucd_compat.h
 ./inet.lo: ../../include/net-snmp/library/mib.h
 ./inet.lo: ../../include/net-snmp/mib_api.h
@@ -143,8 +150,8 @@
 ./inet.lo: ../../include/net-snmp/library/lcd_time.h
 ./inet.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./inet.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./inet.lo: ../../include/net-snmp/library/snmptsm.h
-./inet.lo: ../../include/net-snmp/library/snmpusm.h main.h netstat.h
+./inet.lo: ../../include/net-snmp/library/snmpusm.h
+./inet.lo: ../../include/net-snmp/library/snmptsm.h main.h netstat.h
 ./inet6.lo: ../../include/net-snmp/net-snmp-config.h
 ./inet6.lo: ../../include/net-snmp/net-snmp-includes.h
 ./inet6.lo: ../../include/net-snmp/definitions.h
@@ -173,7 +180,9 @@
 ./inet6.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./inet6.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./inet6.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./inet6.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./inet6.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./inet6.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./inet6.lo: ../../include/net-snmp/library/ucd_compat.h
 ./inet6.lo: ../../include/net-snmp/library/mib.h
 ./inet6.lo: ../../include/net-snmp/mib_api.h
@@ -214,8 +223,8 @@
 ./inet6.lo: ../../include/net-snmp/library/lcd_time.h
 ./inet6.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./inet6.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./inet6.lo: ../../include/net-snmp/library/snmptsm.h
-./inet6.lo: ../../include/net-snmp/library/snmpusm.h main.h netstat.h
+./inet6.lo: ../../include/net-snmp/library/snmpusm.h
+./inet6.lo: ../../include/net-snmp/library/snmptsm.h main.h netstat.h
 ./inetx.lo: ../../include/net-snmp/net-snmp-config.h
 ./inetx.lo: ../../include/net-snmp/net-snmp-includes.h
 ./inetx.lo: ../../include/net-snmp/definitions.h
@@ -244,7 +253,9 @@
 ./inetx.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./inetx.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./inetx.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./inetx.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./inetx.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./inetx.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./inetx.lo: ../../include/net-snmp/library/ucd_compat.h
 ./inetx.lo: ../../include/net-snmp/library/mib.h
 ./inetx.lo: ../../include/net-snmp/mib_api.h
@@ -285,8 +296,8 @@
 ./inetx.lo: ../../include/net-snmp/library/lcd_time.h
 ./inetx.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./inetx.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./inetx.lo: ../../include/net-snmp/library/snmptsm.h
-./inetx.lo: ../../include/net-snmp/library/snmpusm.h main.h netstat.h
+./inetx.lo: ../../include/net-snmp/library/snmpusm.h
+./inetx.lo: ../../include/net-snmp/library/snmptsm.h main.h netstat.h
 ./main.lo: ../../include/net-snmp/net-snmp-config.h
 ./main.lo: ../../include/net-snmp/net-snmp-includes.h
 ./main.lo: ../../include/net-snmp/definitions.h
@@ -315,7 +326,9 @@
 ./main.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./main.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./main.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./main.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./main.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./main.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./main.lo: ../../include/net-snmp/library/ucd_compat.h
 ./main.lo: ../../include/net-snmp/library/mib.h
 ./main.lo: ../../include/net-snmp/mib_api.h
@@ -356,8 +369,8 @@
 ./main.lo: ../../include/net-snmp/library/lcd_time.h
 ./main.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./main.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./main.lo: ../../include/net-snmp/library/snmptsm.h
-./main.lo: ../../include/net-snmp/library/snmpusm.h main.h netstat.h
+./main.lo: ../../include/net-snmp/library/snmpusm.h
+./main.lo: ../../include/net-snmp/library/snmptsm.h main.h netstat.h
 ./route.lo: ../../include/net-snmp/net-snmp-config.h
 ./route.lo: ../../include/net-snmp/net-snmp-includes.h
 ./route.lo: ../../include/net-snmp/definitions.h
@@ -386,7 +399,9 @@
 ./route.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./route.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./route.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./route.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./route.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./route.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./route.lo: ../../include/net-snmp/library/ucd_compat.h
 ./route.lo: ../../include/net-snmp/library/mib.h
 ./route.lo: ../../include/net-snmp/mib_api.h
@@ -427,8 +442,8 @@
 ./route.lo: ../../include/net-snmp/library/lcd_time.h
 ./route.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./route.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./route.lo: ../../include/net-snmp/library/snmptsm.h
-./route.lo: ../../include/net-snmp/library/snmpusm.h main.h netstat.h ffs.h
+./route.lo: ../../include/net-snmp/library/snmpusm.h
+./route.lo: ../../include/net-snmp/library/snmptsm.h main.h netstat.h ffs.h
 ./routex.lo: ../../include/net-snmp/net-snmp-config.h
 ./routex.lo: ../../include/net-snmp/net-snmp-includes.h
 ./routex.lo: ../../include/net-snmp/definitions.h
@@ -457,7 +472,9 @@
 ./routex.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./routex.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./routex.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./routex.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./routex.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./routex.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./routex.lo: ../../include/net-snmp/library/ucd_compat.h
 ./routex.lo: ../../include/net-snmp/library/mib.h
 ./routex.lo: ../../include/net-snmp/mib_api.h
@@ -498,8 +515,8 @@
 ./routex.lo: ../../include/net-snmp/library/lcd_time.h
 ./routex.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./routex.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./routex.lo: ../../include/net-snmp/library/snmptsm.h
-./routex.lo: ../../include/net-snmp/library/snmpusm.h main.h netstat.h
+./routex.lo: ../../include/net-snmp/library/snmpusm.h
+./routex.lo: ../../include/net-snmp/library/snmptsm.h main.h netstat.h
 ./winstub.lo: ../../include/net-snmp/net-snmp-config.h
 ./winstub.lo: ../../include/net-snmp/net-snmp-includes.h
 ./winstub.lo: ../../include/net-snmp/definitions.h
@@ -528,7 +545,9 @@
 ./winstub.lo: ../../include/net-snmp/library/snmpTCPDomain.h
 ./winstub.lo: ../../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./winstub.lo: ../../include/net-snmp/library/snmpIPv6BaseDomain.h
+./winstub.lo: ../../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./winstub.lo: ../../include/net-snmp/library/snmpIPXDomain.h
+./winstub.lo: ../../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./winstub.lo: ../../include/net-snmp/library/ucd_compat.h
 ./winstub.lo: ../../include/net-snmp/library/mib.h
 ./winstub.lo: ../../include/net-snmp/mib_api.h
@@ -569,5 +588,5 @@
 ./winstub.lo: ../../include/net-snmp/library/lcd_time.h
 ./winstub.lo: ../../include/net-snmp/library/snmp_secmod.h
 ./winstub.lo: ../../include/net-snmp/library/snmpv3-security-includes.h
-./winstub.lo: ../../include/net-snmp/library/snmptsm.h
 ./winstub.lo: ../../include/net-snmp/library/snmpusm.h
+./winstub.lo: ../../include/net-snmp/library/snmptsm.h
diff -urpN net-snmp-5.8/apps/snmpnetstat/ffs.c net-snmp-5.9.1/apps/snmpnetstat/ffs.c
--- net-snmp-5.8/apps/snmpnetstat/ffs.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpnetstat/ffs.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,4 +1,6 @@
-/*	$OpenBSD: ffs.c,v 1.7 2005/08/08 08:05:37 espie Exp $	*/
+/*
+ * $OpenBSD: ffs.c,v 1.7 2005/08/08 08:05:37 espie Exp $
+ */
 
 /*
  * Public domain.
@@ -13,28 +15,28 @@
 int
 _ffs(int mask)
 {
-	int bit;
-	unsigned int r = mask;
-	static const signed char t[16] = {
-		-28, 1, 2, 1,
-		  3, 1, 2, 1,
-		  4, 1, 2, 1,
-		  3, 1, 2, 1
-	};
+    int             bit;
+    unsigned int    r = mask;
+    static const signed char t[16] = {
+        -28, 1, 2, 1,
+        3, 1, 2, 1,
+        4, 1, 2, 1,
+        3, 1, 2, 1
+    };
 
-	bit = 0;
-	if (!(r & 0xffff)) {
-		bit += 16;
-		r >>= 16;
-	}
-	if (!(r & 0xff)) {
-		bit += 8;
-		r >>= 8;
-	}
-	if (!(r & 0xf)) {
-		bit += 4;
-		r >>= 4;
-	}
+    bit = 0;
+    if (!(r & 0xffff)) {
+        bit += 16;
+        r >>= 16;
+    }
+    if (!(r & 0xff)) {
+        bit += 8;
+        r >>= 8;
+    }
+    if (!(r & 0xf)) {
+        bit += 4;
+        r >>= 4;
+    }
 
-	return (bit + t[ r & 0xf ]);
+    return (bit + t[r & 0xf]);
 }
diff -urpN net-snmp-5.8/apps/snmpnetstat/ffs.h net-snmp-5.9.1/apps/snmpnetstat/ffs.h
--- net-snmp-5.8/apps/snmpnetstat/ffs.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpnetstat/ffs.h	2021-05-26 05:19:35.000000000 +0700
@@ -1 +1 @@
-int _ffs(int mask);
+int             _ffs(int mask);
diff -urpN net-snmp-5.8/apps/snmpnetstat/if.c net-snmp-5.9.1/apps/snmpnetstat/if.c
--- net-snmp-5.8/apps/snmpnetstat/if.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpnetstat/if.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,9 +1,13 @@
-/*	$OpenBSD: if.c,v 1.42 2005/03/13 16:05:50 mpf Exp $	*/
-/*	$NetBSD: if.c,v 1.16.4.2 1996/06/07 21:46:46 thorpej Exp $	*/
+/*
+ * $OpenBSD: if.c,v 1.42 2005/03/13 16:05:50 mpf Exp $
+ */
+/*
+ * $NetBSD: if.c,v 1.16.4.2 1996/06/07 21:46:46 thorpej Exp $
+ */
 
 /*
  * Copyright (c) 1983, 1988, 1993
- *	The Regents of the University of California.  All rights reserved.
+ *      The Regents of the University of California.  All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
  * modification, are permitted provided that the following conditions
@@ -30,19 +34,10 @@
  * SUCH DAMAGE.
  */
 
-#ifdef  INHERITED_CODE
-#ifndef lint
-#if 0
-static char sccsid[] = "from: @(#)if.c	8.2 (Berkeley) 2/21/94";
-#else
-static char *rcsid = "$OpenBSD: if.c,v 1.42 2005/03/13 16:05:50 mpf Exp $";
-#endif
-#endif /* not lint */
-#endif
-
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-includes.h>
 
+#include <stdint.h>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -63,88 +58,112 @@ static char *rcsid = "$OpenBSD: if.c,v 1
 #define	YES	1
 #define	NO	0
 
-static void sidewaysintpr(u_int);
-static void timerSet(int interval_seconds);
-static void timerPause(void);
-
-    struct _if_info {
-        char            name[128];
-        char            descr[128];
-        char            ip[128], route[128];
-        int             mtu;
-        int             drops;
-        unsigned int    ifindex;
-                        /*
-                         * Save "expandable" fields as string values
-                         *  rather than integer statistics
-                         */
-        char            s_ipkts[20], s_ierrs[20];
-        char            s_opkts[20], s_oerrs[20];
-        char            s_ibytes[20], s_obytes[20];
-        char            s_outq[20];
-        unsigned long   ipkts, opkts;  /* Need to combine 2 MIB values */
-        int             operstatus;
-/*
-        u_long          netmask;
-        struct in_addr  ifip, ifroute;
- */
-        struct _if_info *next;
-    };
+static void     sidewaysintpr(u_int);
+
+struct _if_info {
+    char            name[128];
+    char            descr[128];
+    char            ip[128], route[128];
+    int             mtu;
+    int             drops;
+    unsigned int    ifindex;
+    /*
+     * Save "expandable" fields as string values
+     *  rather than integer statistics
+     */
+    char            s_ipkts[20], s_ierrs[20];
+    char            s_opkts[20], s_oerrs[20];
+    char            s_ibytes[20], s_obytes[20];
+    char            s_outq[20];
+    unsigned long   ipkts, opkts;       /* Need to combine 2 MIB values */
+    int             operstatus;
+    /*
+     * u_long          netmask;
+     * struct in_addr  ifip, ifroute;
+     */
+    struct _if_info *next;
+};
+
+
+static struct timeval deadline;
+
+static void
+timerSet(int interval_seconds)
+{
+    const struct timeval interval = { interval_seconds, 0 };
+
+    netsnmp_get_monotonic_clock(&deadline);
+    NETSNMP_TIMERADD(&deadline, &interval, &deadline);
+}
 
+static void
+timerPause(void)
+{
+    struct timeval  now, delta;
+
+    netsnmp_get_monotonic_clock(&now);
+    NETSNMP_TIMERSUB(&deadline, &now, &delta);
+    if (delta.tv_sec < 0)
+        return;
+#ifdef WIN32
+    Sleep(delta.tv_sec * 1000 + delta.tv_usec / 1000);
+#else
+    if (select(0, NULL, NULL, NULL, &delta) < 0)
+        snmp_perror("select");
+#endif
+}
 
 /*
  * Retrieve the interface addressing information
  * XXX - This could also be extended to handle non-IP interfaces
  */
 void
-_set_address( struct _if_info *cur_if )
+_set_address(struct _if_info *cur_if)
 {
-    oid    ipaddr_oid[] = { 1,3,6,1,2,1,4,20,1,0 };
-    size_t ipaddr_len   = OID_LENGTH( ipaddr_oid );
-    static netsnmp_variable_list *addr_if_var  =NULL;
-    static netsnmp_variable_list *addr_mask_var=NULL;
+    oid             ipaddr_oid[] = { 1, 3, 6, 1, 2, 1, 4, 20, 1, 0 };
+    size_t          ipaddr_len = OID_LENGTH(ipaddr_oid);
+    static netsnmp_variable_list *addr_if_var = NULL;
+    static netsnmp_variable_list *addr_mask_var = NULL;
     netsnmp_variable_list *vp, *vp2;
     union {
-        in_addr_t addr;
-        char      data[4];
+        in_addr_t       addr;
+        char            data[4];
     } tmpAddr;
-    char *cp;
-    in_addr_t ifAddr, mask;
+    char           *cp;
+    in_addr_t       ifAddr, mask;
 
-        /*
-         *  Note that this information only needs to be retrieved 
-         *    once, and can be re-used for subsequent calls.
-         */
-    if ( addr_if_var == NULL ) {
-        ipaddr_oid[ 9 ] = 2;  /* ipAdEntIfIndex */
-        snmp_varlist_add_variable( &addr_if_var, ipaddr_oid, ipaddr_len,
-                                   ASN_NULL, NULL,  0);
-        netsnmp_query_walk( addr_if_var, ss );
-
-        ipaddr_oid[ 9 ] = 3;  /* ipAdEntNetMask */
-        snmp_varlist_add_variable( &addr_mask_var, ipaddr_oid, ipaddr_len,
-                                   ASN_NULL, NULL,  0);
-        netsnmp_query_walk( addr_mask_var, ss );
+    /*
+     *  Note that this information only needs to be retrieved
+     *    once, and can be re-used for subsequent calls.
+     */
+    if (addr_if_var == NULL) {
+        ipaddr_oid[9] = 2;      /* ipAdEntIfIndex */
+        snmp_varlist_add_variable(&addr_if_var, ipaddr_oid, ipaddr_len,
+                                  ASN_NULL, NULL, 0);
+        netsnmp_query_walk(addr_if_var, ss);
+
+        ipaddr_oid[9] = 3;      /* ipAdEntNetMask */
+        snmp_varlist_add_variable(&addr_mask_var, ipaddr_oid, ipaddr_len,
+                                  ASN_NULL, NULL, 0);
+        netsnmp_query_walk(addr_mask_var, ss);
     }
 
     /*
      * Find the address row relevant to this interface
      */
-    for (vp=addr_if_var, vp2=addr_mask_var;  vp;
-         vp=vp->next_variable, vp2=vp2->next_variable) {
-        if ( vp->val.integer && *vp->val.integer == (int)cur_if->ifindex )
+    for (vp = addr_if_var, vp2 = addr_mask_var; vp;
+         vp = vp->next_variable, vp2 = vp2->next_variable) {
+        if (vp->val.integer && *vp->val.integer == (int) cur_if->ifindex)
             break;
     }
     if (vp2) {
         /*
          * Always want a numeric interface IP address
          */
-        snprintf( cur_if->ip, 128, "%" NETSNMP_PRIo "u.%" NETSNMP_PRIo "u."
-                  "%" NETSNMP_PRIo "u.%" NETSNMP_PRIo "u",
-                  vp2->name[10],
-                  vp2->name[11],
-                  vp2->name[12],
-                  vp2->name[13]);
+        snprintf(cur_if->ip, 128, "%" NETSNMP_PRIo "u.%" NETSNMP_PRIo "u."
+                 "%" NETSNMP_PRIo "u.%" NETSNMP_PRIo "u",
+                 vp2->name[10],
+                 vp2->name[11], vp2->name[12], vp2->name[13]);
 
         /*
          * But re-use the routing table utilities/code for
@@ -162,7 +181,7 @@ _set_address( struct _if_info *cur_if )
         cp[2] = (uint8_t) vp2->val.string[2];
         cp[3] = (uint8_t) vp2->val.string[3];
         mask = tmpAddr.addr;
-        snprintf( cur_if->route, 128, "%s", netname(ifAddr, mask));
+        snprintf(cur_if->route, 128, "%s", netname(ifAddr, mask));
     }
 }
 
@@ -173,57 +192,58 @@ _set_address( struct _if_info *cur_if )
 void
 intpr(int interval)
 {
-    oid    ifcol_oid[]  = { 1,3,6,1,2,1,2,2,1,0 };
-    size_t ifcol_len    = OID_LENGTH( ifcol_oid );
-    oid    ifxcol_oid[] = { 1,3,6,1,2,1,31,1,1,1,0 };
-    size_t ifxcol_len   = OID_LENGTH( ifxcol_oid );
+    oid             ifcol_oid[] = { 1, 3, 6, 1, 2, 1, 2, 2, 1, 0 };
+    size_t          ifcol_len = OID_LENGTH(ifcol_oid);
+    oid             ifxcol_oid[] = { 1, 3, 6, 1, 2, 1, 31, 1, 1, 1, 0 };
+    size_t          ifxcol_len = OID_LENGTH(ifxcol_oid);
 
     struct _if_info *if_head, *if_tail, *cur_if;
     netsnmp_variable_list *var, *vp;
-           /*
-            * Track maximum field widths, expanding as necessary
-            *   This is one reason why results can't be
-            *   displayed immediately they are retrieved.
-            */
-    int    max_name  = 4, max_ip    = 7, max_route = 7, max_outq  = 5;
-    int    max_ipkts = 5, max_ierrs = 5, max_opkts = 5, max_oerrs = 5;
-    int    max_ibytes = 6, max_obytes = 6;
-    int    i;
+    /*
+     * Track maximum field widths, expanding as necessary
+     *   This is one reason why results can't be
+     *   displayed immediately they are retrieved.
+     */
+    int             max_name = 4, max_ip = 7, max_route = 7, max_outq = 5;
+    int             max_ipkts = 5, max_ierrs = 5, max_opkts =
+        5, max_oerrs = 5;
+    int             max_ibytes = 6, max_obytes = 6;
+    int             i;
 
 
     if (interval) {
-        sidewaysintpr((unsigned)interval);
+        sidewaysintpr((unsigned) interval);
         return;
     }
 
-        /*
-         * The traditional "netstat -i" output combines information
-         *   from two SNMP tables:
-         *      ipAddrTable   (for the IP address/network)
-         *      ifTable       (for the interface statistics)
-         *
-         * The previous approach was to retrieve (and save) the
-         *   address information first. Then walk the main ifTable,
-         *   add the relevant stored addresses, and saving the
-         *   full information for each interface, before displaying 
-         *   the results as a separate pass.
-         *
-         * This code reverses this general structure, by first retrieving
-         *   (and storing) the interface statistics for the whole table,
-         *   then inserting the address information obtained from the
-         *   ipAddrTable, and finally displaying the results.
-         * Such an arrangement should make it easier to extend this
-         *   to handle non-IP interfaces (hence not in ipAddrTable)
-         */
+    /*
+     * The traditional "netstat -i" output combines information
+     *   from two SNMP tables:
+     *      ipAddrTable   (for the IP address/network)
+     *      ifTable       (for the interface statistics)
+     *
+     * The previous approach was to retrieve (and save) the
+     *   address information first. Then walk the main ifTable,
+     *   add the relevant stored addresses, and saving the
+     *   full information for each interface, before displaying
+     *   the results as a separate pass.
+     *
+     * This code reverses this general structure, by first retrieving
+     *   (and storing) the interface statistics for the whole table,
+     *   then inserting the address information obtained from the
+     *   ipAddrTable, and finally displaying the results.
+     * Such an arrangement should make it easier to extend this
+     *   to handle non-IP interfaces (hence not in ipAddrTable)
+     */
     if_head = NULL;
     if_tail = NULL;
-    var     = NULL;
+    var = NULL;
 
 #define ADD_IFVAR( x ) ifcol_oid[ ifcol_len-1 ] = x; \
     snmp_varlist_add_variable( &var, ifcol_oid, ifcol_len, ASN_NULL, NULL,  0)
-    ADD_IFVAR( 2 );                 /* ifName  */
-    ADD_IFVAR( 4 );                 /* ifMtu   */
-    ADD_IFVAR( 8 );                 /* ifOperStatus */
+    ADD_IFVAR(2);               /* ifName  */
+    ADD_IFVAR(4);               /* ifMtu   */
+    ADD_IFVAR(8);               /* ifOperStatus */
     /*
      * The Net/Open-BSD behaviour is to display *either* byte
      *   counts *or* packet/error counts (but not both). FreeBSD
@@ -236,142 +256,144 @@ intpr(int interval)
      * Or we could perhaps support both styles? :-)
      */
     if (bflag || oflag) {
-        ADD_IFVAR( 10 );            /* ifInOctets   */
-        ADD_IFVAR( 16 );            /* ifOutOctets  */
+        ADD_IFVAR(10);          /* ifInOctets   */
+        ADD_IFVAR(16);          /* ifOutOctets  */
     }
     if (!oflag) {
-        ADD_IFVAR( 11 );            /* ifInUcastPkts  */
-        ADD_IFVAR( 12 );            /* ifInNUcastPkts */
-        ADD_IFVAR( 14 );            /* ifInErrors     */
-        ADD_IFVAR( 17 );            /* ifOutUcastPkts */
-        ADD_IFVAR( 18 );            /* ifOutNUcastPkts */
-        ADD_IFVAR( 20 );            /* ifOutErrors    */
-        ADD_IFVAR( 21 );            /* ifOutQLen      */
+        ADD_IFVAR(11);          /* ifInUcastPkts  */
+        ADD_IFVAR(12);          /* ifInNUcastPkts */
+        ADD_IFVAR(14);          /* ifInErrors     */
+        ADD_IFVAR(17);          /* ifOutUcastPkts */
+        ADD_IFVAR(18);          /* ifOutNUcastPkts */
+        ADD_IFVAR(20);          /* ifOutErrors    */
+        ADD_IFVAR(21);          /* ifOutQLen      */
     }
 #if 0
     if (tflag) {
-        ADD_IFVAR( XX );            /* ??? */
+        ADD_IFVAR(XX);          /* ??? */
     }
 #endif
     if (dflag) {
-        ADD_IFVAR( 19 );            /* ifOutDiscards  */
+        ADD_IFVAR(19);          /* ifOutDiscards  */
     }
 #undef ADD_IFVAR
 #define ADD_IFXVAR( x ) ifxcol_oid[ ifxcol_len-1 ] = x; \
     snmp_varlist_add_variable( &var, ifxcol_oid, ifxcol_len, ASN_NULL, NULL,  0)
-    ADD_IFXVAR(1);                  /* ifName */
+    ADD_IFXVAR(1);              /* ifName */
 #undef ADD_IFXVAR
 
-        /*
-	 * Now walk the ifTable, creating a list of interfaces
-	 */
-    while ( 1 ) {
-        if (netsnmp_query_getnext( var, ss ) != SNMP_ERR_NOERROR)
+    /*
+     * Now walk the ifTable, creating a list of interfaces
+     */
+    while (1) {
+        if (netsnmp_query_getnext(var, ss) != SNMP_ERR_NOERROR)
             break;
-        if ((var->type & 0xF0) == 0x80)     /* Exception */
+        if ((var->type & 0xF0) == 0x80) /* Exception */
             break;
-        ifcol_oid[ ifcol_len-1 ] = 2;	/* ifDescr */
-        if ( snmp_oid_compare( ifcol_oid, ifcol_len,
-                               var->name, ifcol_len) != 0 )
-            break;    /* End of Table */
-        cur_if = SNMP_MALLOC_TYPEDEF( struct _if_info );
+        ifcol_oid[ifcol_len - 1] = 2;   /* ifDescr */
+        if (snmp_oid_compare(ifcol_oid, ifcol_len,
+                             var->name, ifcol_len) != 0)
+            break;              /* End of Table */
+        cur_if = SNMP_MALLOC_TYPEDEF(struct _if_info);
         if (!cur_if)
             break;
-        cur_if->ifindex = var->name[ var->name_length-1 ];
-        for ( vp=var; vp; vp=vp->next_variable ) {
-            if ((vp->type & 0xF0) == 0x80)     /* Exception */
+        cur_if->ifindex = var->name[var->name_length - 1];
+        for (vp = var; vp; vp = vp->next_variable) {
+            if ((vp->type & 0xF0) == 0x80)      /* Exception */
                 continue;
-            if ( ! vp->val.integer )
+            if (!vp->val.integer)
                 continue;
-            if ( var->name[ var->name_length-1 ] != cur_if->ifindex ) {
+            if (var->name[var->name_length - 1] != cur_if->ifindex) {
                 /*
                  * Inconsistent index information
                  * XXX - Try to recover ?
                  */
-                SNMP_FREE( cur_if );
-                break;    /* not for now, no */
+                SNMP_FREE(cur_if);
+                break;          /* not for now, no */
             }
-            switch ( vp->name[ var->name_length-2 ] ) {
-            case 2:     /* ifDescr */
+            switch (vp->name[var->name_length - 2]) {
+            case 2:            /* ifDescr */
                 if (vp->val_len >= sizeof(cur_if->name))
-                    vp->val_len  = sizeof(cur_if->name)-1;
-                memmove( cur_if->name, vp->val.string, vp->val_len );
+                    vp->val_len = sizeof(cur_if->name) - 1;
+                memmove(cur_if->name, vp->val.string, vp->val_len);
                 cur_if->name[vp->val_len] = 0;
-                memmove( cur_if->descr, vp->val.string, vp->val_len );
+                memmove(cur_if->descr, vp->val.string, vp->val_len);
                 cur_if->descr[vp->val_len] = 0;
                 break;
-            case 4:     /* ifMtu   */
+            case 4:            /* ifMtu   */
                 cur_if->mtu = *vp->val.integer;
                 break;
-            case 8:     /* ifOperStatus   */
+            case 8:            /* ifOperStatus   */
                 cur_if->operstatus = *vp->val.integer;
-                /* XXX - any special processing ?? */
+                /*
+                 * XXX - any special processing ??
+                 */
                 break;
-            case 10:	/* ifInOctets     */
+            case 10:           /* ifInOctets     */
                 sprintf(cur_if->s_ibytes, "%lu", *vp->val.integer);
                 i = strlen(cur_if->s_ibytes);
                 if (i > max_ibytes)
                     max_ibytes = i;
                 break;
-            case 11:	/* ifInUcastPkts  */
+            case 11:           /* ifInUcastPkts  */
                 cur_if->ipkts += *vp->val.integer;
                 sprintf(cur_if->s_ipkts, "%lu", cur_if->ipkts);
                 i = strlen(cur_if->s_ipkts);
                 if (i > max_ipkts)
                     max_ipkts = i;
                 break;
-            case 12:	/* ifInNUcastPkts  */
+            case 12:           /* ifInNUcastPkts  */
                 cur_if->ipkts += *vp->val.integer;
                 sprintf(cur_if->s_ipkts, "%lu", cur_if->ipkts);
                 i = strlen(cur_if->s_ipkts);
                 if (i > max_ipkts)
                     max_ipkts = i;
                 break;
-            case 14:	/* ifInErrors      */
+            case 14:           /* ifInErrors      */
                 sprintf(cur_if->s_ierrs, "%lu", *vp->val.integer);
                 i = strlen(cur_if->s_ierrs);
                 if (i > max_ierrs)
                     max_ierrs = i;
                 break;
-            case 16:	/* ifOutOctets      */
+            case 16:           /* ifOutOctets      */
                 sprintf(cur_if->s_obytes, "%lu", *vp->val.integer);
                 i = strlen(cur_if->s_obytes);
                 if (i > max_obytes)
                     max_obytes = i;
                 break;
-            case 17:	/* ifOutUcastPkts */
+            case 17:           /* ifOutUcastPkts */
                 cur_if->opkts += *vp->val.integer;
                 sprintf(cur_if->s_opkts, "%lu", cur_if->opkts);
                 i = strlen(cur_if->s_opkts);
                 if (i > max_opkts)
                     max_opkts = i;
                 break;
-            case 18:	/* ifOutNUcastPkts */
+            case 18:           /* ifOutNUcastPkts */
                 cur_if->opkts += *vp->val.integer;
                 sprintf(cur_if->s_opkts, "%lu", cur_if->opkts);
                 i = strlen(cur_if->s_opkts);
                 if (i > max_opkts)
                     max_opkts = i;
                 break;
-            case 19:    /* ifOutDiscards   */
+            case 19:           /* ifOutDiscards   */
                 cur_if->drops = *vp->val.integer;
                 break;
-            case 20:	/* ifOutErrors     */
+            case 20:           /* ifOutErrors     */
                 sprintf(cur_if->s_oerrs, "%lu", *vp->val.integer);
                 i = strlen(cur_if->s_oerrs);
                 if (i > max_oerrs)
                     max_oerrs = i;
                 break;
-            case 21:	/* ifOutQLen       */
+            case 21:           /* ifOutQLen       */
                 sprintf(cur_if->s_outq, "%lu", *vp->val.integer);
                 i = strlen(cur_if->s_outq);
                 if (i > max_outq)
                     max_outq = i;
                 break;
-            case 1:     /* ifName */
+            case 1:            /* ifName */
                 if (vp->val_len >= sizeof(cur_if->name))
-                    vp->val_len  = sizeof(cur_if->name)-1;
-                memmove( cur_if->name, vp->val.string, vp->val_len );
+                    vp->val_len = sizeof(cur_if->name) - 1;
+                memmove(cur_if->name, vp->val.string, vp->val_len);
                 cur_if->name[vp->val_len] = 0;
                 if ((i = strlen(cur_if->name) + 1) > max_name)
                     max_name = i;
@@ -387,22 +409,23 @@ intpr(int interval)
         /*
          * If we're to monitor a particular interface, then
          *   ignore all others.  It would be more efficient
-         *   to check this earlier (as part of processing 
+         *   to check this earlier (as part of processing
          *   the varbind list).  But performing this test here
          *   means we can recognise ifXTable names as well)
          */
-        if ( intrface && strcmp( cur_if->name, intrface) != 0 && strcmp( cur_if->descr, intrface) != 0) {
-            SNMP_FREE( cur_if );
+        if (intrface && strcmp(cur_if->name, intrface) != 0
+            && strcmp(cur_if->descr, intrface) != 0) {
+            SNMP_FREE(cur_if);
         }
 
         /*
          * Insert the IP address and network settings, and
          *   add the new _if_stat structure to the list.
          */
-        if ( cur_if ) {
+        if (cur_if) {
             if ((i = strlen(cur_if->name) + 1) > max_name)
                 max_name = i;
-            _set_address( cur_if );
+            _set_address(cur_if);
             i = strlen(cur_if->ip);
             if (i > max_ip)
                 max_ip = i;
@@ -410,104 +433,103 @@ intpr(int interval)
             if (i > max_route)
                 max_route = i;
 
-            if ( if_tail ) {
+            if (if_tail) {
                 if_tail->next = cur_if;
-                if_tail       = cur_if;
+                if_tail = cur_if;
             } else {
-                if_head       = cur_if;
-                if_tail       = cur_if;
+                if_head = cur_if;
+                if_tail = cur_if;
             }
         }
-    }   /* while (1) */
+    }                           /* while (1) */
     snmp_free_varbind(var);
 
-        /*
-         * Now display the specified results (in Free-BSD format)
-         *   setting the field widths appropriately....
-         */
+    /*
+     * Now display the specified results (in Free-BSD format)
+     *   setting the field widths appropriately....
+     */
     printf("%*.*s %5.5s %*.*s %*.*s",
-           -max_name,  max_name,  "Name", "Mtu",
-           -max_route, max_route, "Network",
-           -max_ip,    max_ip,    "Address");
+           -max_name, max_name, "Name", "Mtu",
+           -max_route, max_route, "Network", -max_ip, max_ip, "Address");
     if (oflag) {
-        printf(" %*s %*s", max_ibytes,  "Ibytes",
-                           max_obytes,  "Obytes");
+        printf(" %*s %*s", max_ibytes, "Ibytes", max_obytes, "Obytes");
     } else {
-        printf(" %*s %*s", max_ipkts,   "Ipkts",
-                           max_ierrs,   "Ierrs");
-        if (bflag) 
-            printf(" %*s", max_ibytes,  "Ibytes");
-
-        printf(" %*s %*s", max_opkts,   "Opkts",
-                           max_oerrs,   "Oerrs");
-        if (bflag) 
-            printf(" %*s", max_obytes,  "Obytes");
-
-        printf(" %*s",     max_outq,    "Queue");
-    }
- /* if (tflag)
-        printf(" %s", "Time");
-  */
+        printf(" %*s %*s", max_ipkts, "Ipkts", max_ierrs, "Ierrs");
+        if (bflag)
+            printf(" %*s", max_ibytes, "Ibytes");
+
+        printf(" %*s %*s", max_opkts, "Opkts", max_oerrs, "Oerrs");
+        if (bflag)
+            printf(" %*s", max_obytes, "Obytes");
+
+        printf(" %*s", max_outq, "Queue");
+    }
+    /*
+     * if (tflag)
+     * printf(" %s", "Time");
+     */
     if (dflag)
         printf(" %s", "Drop");
     putchar('\n');
 
-    for (cur_if = if_head; cur_if; cur_if=cur_if->next) {
+    for (cur_if = if_head; cur_if; cur_if = cur_if->next) {
         if (cur_if->name[0] == 0)
             continue;
-        printf( "%*.*s %5d", -max_name,  max_name,  cur_if->name, cur_if->mtu);
-        printf(" %*.*s",     -max_route, max_route, cur_if->route);
-        printf(" %*.*s",     -max_ip,    max_ip,    cur_if->ip);
+        printf("%*.*s %5d", -max_name, max_name, cur_if->name,
+               cur_if->mtu);
+        printf(" %*.*s", -max_route, max_route, cur_if->route);
+        printf(" %*.*s", -max_ip, max_ip, cur_if->ip);
 
         if (oflag) {
-            printf(" %*s %*s", max_ibytes,  cur_if->s_ibytes,
-                               max_obytes,  cur_if->s_obytes);
+            printf(" %*s %*s", max_ibytes, cur_if->s_ibytes,
+                   max_obytes, cur_if->s_obytes);
         } else {
-            printf(" %*s %*s", max_ipkts,   cur_if->s_ipkts,
-                               max_ierrs,   cur_if->s_ierrs);
-            if (bflag) 
-                printf(" %*s", max_ibytes,  cur_if->s_ibytes);
-    
-            printf(" %*s %*s", max_opkts,   cur_if->s_opkts,
-                               max_oerrs,   cur_if->s_oerrs);
-            if (bflag) 
-                printf(" %*s", max_obytes,  cur_if->s_obytes);
-            printf(" %*s",     max_outq,    cur_if->s_outq);
-        }
-     /* if (tflag)
-            printf(" %4d", cur_if->???);
-      */
+            printf(" %*s %*s", max_ipkts, cur_if->s_ipkts,
+                   max_ierrs, cur_if->s_ierrs);
+            if (bflag)
+                printf(" %*s", max_ibytes, cur_if->s_ibytes);
+
+            printf(" %*s %*s", max_opkts, cur_if->s_opkts,
+                   max_oerrs, cur_if->s_oerrs);
+            if (bflag)
+                printf(" %*s", max_obytes, cur_if->s_obytes);
+            printf(" %*s", max_outq, cur_if->s_outq);
+        }
+        /*
+         * if (tflag)
+         * printf(" %4d", cur_if->???);
+         */
         if (dflag)
             printf(" %4d", cur_if->drops);
         putchar('\n');
     }
 
-        /*
-         * ... and tidy up.
-         */
-    for (cur_if = if_head; cur_if; cur_if=if_head) {
-        if_head=cur_if->next;
+    /*
+     * ... and tidy up.
+     */
+    for (cur_if = if_head; cur_if; cur_if = if_head) {
+        if_head = cur_if->next;
         cur_if->next = NULL;
-        SNMP_FREE( cur_if );
+        SNMP_FREE(cur_if);
     }
 }
 
 
 #define	MAXIF	100
-struct	iftot {
-	char	ift_name[128];		/* interface name */
-        int     ifIndex;
-	u_long	ift_ip;			/* input packets */
-	u_long	ift_ib;			/* input bytes */
-	u_long	ift_ie;			/* input errors */
-	u_long	ift_op;			/* output packets */
-	u_long	ift_ob;			/* output bytes */
-	u_long	ift_oe;			/* output errors */
-	u_long	ift_co;			/* collisions */
-	u_long	ift_dr;			/* drops */
+struct iftot {
+    char            ift_name[128];      /* interface name */
+    int             ifIndex;
+    u_long          ift_ip;     /* input packets */
+    u_long          ift_ib;     /* input bytes */
+    u_long          ift_ie;     /* input errors */
+    u_long          ift_op;     /* output packets */
+    u_long          ift_ob;     /* output bytes */
+    u_long          ift_oe;     /* output errors */
+    u_long          ift_co;     /* collisions */
+    u_long          ift_dr;     /* drops */
 };
 
-int signalled;	/* set if alarm goes off "early" */
+int             signalled;      /* set if alarm goes off "early" */
 
 /*
  * Print a running summary of interface statistics.
@@ -532,66 +554,68 @@ sidewaysintpr(unsigned int interval)
      *   instance (including ifIndex), rather than just a
      *   column object OID, as with the one-shot code.
      */
-    oid    ifcol_oid[]  = { 1,3,6,1,2,1,2,2,1,0,0 };
-    size_t ifcol_len    = OID_LENGTH( ifcol_oid );
+    oid             ifcol_oid[] = { 1, 3, 6, 1, 2, 1, 2, 2, 1, 0, 0 };
+    size_t          ifcol_len = OID_LENGTH(ifcol_oid);
     netsnmp_variable_list *var, *vp;
-    struct iftot *ip  = NULL, *cur_if = NULL;    /* single I/F display */
-    struct iftot *sum = NULL, *total  = NULL;    /* overall summary    */
-    int    line;
-    int    first;
-    size_t i;
+    struct iftot   *ip = NULL, *cur_if = NULL;  /* single I/F display */
+    struct iftot   *sum = NULL, *total = NULL;  /* overall summary    */
+    int             line;
+    int             first;
+    size_t          i;
 
     var = NULL;
-    if ( intrface ) {
+    if (intrface) {
         /*
          * Locate the ifIndex of the interface to monitor,
          *   by walking the ifDescr column of the ifTable
          */
-        ifcol_oid[ ifcol_len-2 ] = 2;   /* ifDescr  */
-        snmp_varlist_add_variable( &var, ifcol_oid, ifcol_len-1,
-                                   ASN_NULL, NULL,  0);
+        ifcol_oid[ifcol_len - 2] = 2;   /* ifDescr  */
+        snmp_varlist_add_variable(&var, ifcol_oid, ifcol_len - 1,
+                                  ASN_NULL, NULL, 0);
         i = strlen(intrface);
-        netsnmp_query_walk( var, ss );
-        for (vp=var; vp; vp=vp->next_variable) {
-            if (strncmp(intrface, (char *)vp->val.string, i) == 0 &&
+        netsnmp_query_walk(var, ss);
+        for (vp = var; vp; vp = vp->next_variable) {
+            if (strncmp(intrface, (char *) vp->val.string, i) == 0 &&
                 i == vp->val_len)
-                break;  /* found requested interface */
+                break;          /* found requested interface */
         }
         /*
          * XXX - Might be worth searching ifName/ifAlias as well
          */
         if (!vp) {
-            oid    ifname_oid[]  = { 1,3,6,1,2,1,31,1,1,1,1,0 };
-            size_t ifname_len    = OID_LENGTH( ifname_oid );
-            snmp_free_var( var );
+            oid             ifname_oid[] =
+                { 1, 3, 6, 1, 2, 1, 31, 1, 1, 1, 1, 0 };
+            size_t          ifname_len = OID_LENGTH(ifname_oid);
+            snmp_free_var(var);
             var = NULL;
-            snmp_varlist_add_variable( &var, ifname_oid, ifname_len-1,
-                                       ASN_NULL, NULL,  0);
+            snmp_varlist_add_variable(&var, ifname_oid, ifname_len - 1,
+                                      ASN_NULL, NULL, 0);
             i = strlen(intrface);
-            netsnmp_query_walk( var, ss );
-            for (vp=var; vp; vp=vp->next_variable) {
-                if (strncmp(intrface, (char *)vp->val.string, i) == 0 &&
+            netsnmp_query_walk(var, ss);
+            for (vp = var; vp; vp = vp->next_variable) {
+                if (strncmp(intrface, (char *) vp->val.string, i) == 0 &&
                     i == vp->val_len)
-                    break;  /* found requested interface */
+                    break;      /* found requested interface */
             }
         }
         if (!vp) {
-            oid    ifalias_oid[]  = { 1,3,6,1,2,1,31,1,1,1,18,0 };
-            size_t ifalias_len    = OID_LENGTH( ifalias_oid );
-            snmp_free_var( var );
+            oid             ifalias_oid[] =
+                { 1, 3, 6, 1, 2, 1, 31, 1, 1, 1, 18, 0 };
+            size_t          ifalias_len = OID_LENGTH(ifalias_oid);
+            snmp_free_var(var);
             var = NULL;
-            snmp_varlist_add_variable( &var, ifalias_oid, ifalias_len-1,
-                                       ASN_NULL, NULL,  0);
+            snmp_varlist_add_variable(&var, ifalias_oid, ifalias_len - 1,
+                                      ASN_NULL, NULL, 0);
             i = strlen(intrface);
-            netsnmp_query_walk( var, ss );
-            for (vp=var; vp; vp=vp->next_variable) {
-                if (strncmp(intrface, (char *)vp->val.string, i) == 0 &&
+            netsnmp_query_walk(var, ss);
+            for (vp = var; vp; vp = vp->next_variable) {
+                if (strncmp(intrface, (char *) vp->val.string, i) == 0 &&
                     i == vp->val_len)
-                    break;  /* found requested interface */
+                    break;      /* found requested interface */
             }
         }
         if (!vp) {
-            fprintf(stderr, "%s: unknown interface\n", intrface );
+            fprintf(stderr, "%s: unknown interface\n", intrface);
             exit(1);
         }
 
@@ -599,62 +623,67 @@ sidewaysintpr(unsigned int interval)
          *  Prepare the current and previous 'iftot' structures,
          *    and set the ifIndex value in the OID buffer.
          */
-        ip     = SNMP_MALLOC_TYPEDEF( struct iftot );
-        cur_if = SNMP_MALLOC_TYPEDEF( struct iftot );
+        ip = SNMP_MALLOC_TYPEDEF(struct iftot);
+        cur_if = SNMP_MALLOC_TYPEDEF(struct iftot);
         if (!ip || !cur_if) {
             fprintf(stderr, "internal error\n");
             exit(1);
         }
-        ifcol_oid[ ifcol_len-1 ] = vp->name[ ifcol_len-1 ];
-        snmp_free_var( var );
+        ifcol_oid[ifcol_len - 1] = vp->name[ifcol_len - 1];
+        snmp_free_var(var);
         var = NULL;
     } else {
         /*
          *  Prepare the current and previous 'iftot' structures.
          *    (using different pointers, for consistency with *BSD code)
          */
-        sum   = SNMP_MALLOC_TYPEDEF( struct iftot );
-        total = SNMP_MALLOC_TYPEDEF( struct iftot );
+        sum = SNMP_MALLOC_TYPEDEF(struct iftot);
+        total = SNMP_MALLOC_TYPEDEF(struct iftot);
         if (!sum || !total) {
             fprintf(stderr, "internal error\n");
             exit(1);
         }
     }
 
-    timerSet( interval );
+    timerSet(interval);
     first = 1;
-banner:
-    printf( "%17s %14s %16s", "input",
-        intrface ? intrface : "(Total)", "output");
+  banner:
+    printf("%17s %14s %16s", "input",
+           intrface ? intrface : "(Total)", "output");
     putchar('\n');
-    printf( "%10s %5s %10s %10s %5s %10s %5s",
-        "packets", "errs", "bytes", "packets", "errs", "bytes", "colls");
+    printf("%10s %5s %10s %10s %5s %10s %5s",
+           "packets", "errs", "bytes", "packets", "errs", "bytes",
+           "colls");
     if (dflag)
-	printf(" %5.5s", "drops");
+        printf(" %5.5s", "drops");
     putchar('\n');
     fflush(stdout);
     line = 0;
-loop:
-    if ( intrface ) {
+  loop:
+    if (intrface) {
 #define ADD_IFVAR( x ) ifcol_oid[ ifcol_len-2 ] = x; \
     snmp_varlist_add_variable( &var, ifcol_oid, ifcol_len, ASN_NULL, NULL,  0)
-    /*  if (bflag) { */
-            ADD_IFVAR( 10 );        /* ifInOctets     */
-            ADD_IFVAR( 16 );        /* ifOutOctets    */
-    /*  } */
-        ADD_IFVAR( 11 );            /* ifInUcastPkts  */
-        ADD_IFVAR( 12 );            /* ifInNUcastPkts */
-        ADD_IFVAR( 14 );            /* ifInErrors     */
-        ADD_IFVAR( 17 );            /* ifOutUcastPkts */
-        ADD_IFVAR( 18 );            /* ifOutNUcastPkts */
-        ADD_IFVAR( 20 );            /* ifOutErrors    */
-        ADD_IFVAR( 21 );            /* ifOutQLen      */
+        /*
+         * if (bflag) {
+         */
+        ADD_IFVAR(10);          /* ifInOctets     */
+        ADD_IFVAR(16);          /* ifOutOctets    */
+        /*
+         * }
+         */
+        ADD_IFVAR(11);          /* ifInUcastPkts  */
+        ADD_IFVAR(12);          /* ifInNUcastPkts */
+        ADD_IFVAR(14);          /* ifInErrors     */
+        ADD_IFVAR(17);          /* ifOutUcastPkts */
+        ADD_IFVAR(18);          /* ifOutNUcastPkts */
+        ADD_IFVAR(20);          /* ifOutErrors    */
+        ADD_IFVAR(21);          /* ifOutQLen      */
         if (dflag) {
-            ADD_IFVAR( 19 );        /* ifOutDiscards  */
+            ADD_IFVAR(19);      /* ifOutDiscards  */
         }
 #undef ADD_IFVAR
 
-        netsnmp_query_get( var, ss );   /* Or parallel walk ?? */
+        netsnmp_query_get(var, ss);     /* Or parallel walk ?? */
         cur_if->ift_ip = 0;
         cur_if->ift_ib = 0;
         cur_if->ift_ie = 0;
@@ -663,142 +692,146 @@ loop:
         cur_if->ift_oe = 0;
         cur_if->ift_co = 0;
         cur_if->ift_dr = 0;
-        cur_if->ifIndex = var->name[ ifcol_len-1 ];
-        for (vp=var; vp; vp=vp->next_variable) {
+        cur_if->ifIndex = var->name[ifcol_len - 1];
+        for (vp = var; vp; vp = vp->next_variable) {
             if ((var->type & 0xF0) == 0x80)     /* Exception */
                 continue;
-            if ( ! vp->val.integer )
+            if (!vp->val.integer)
                 continue;
-            switch (vp->name[ifcol_len-2]) {
-            case 10:    /* ifInOctets */
+            switch (vp->name[ifcol_len - 2]) {
+            case 10:           /* ifInOctets */
                 cur_if->ift_ib = *vp->val.integer;
                 break;
-            case 11:    /* ifInUcastPkts */
+            case 11:           /* ifInUcastPkts */
                 cur_if->ift_ip += *vp->val.integer;
                 break;
-            case 12:    /* ifInNUcastPkts */
+            case 12:           /* ifInNUcastPkts */
                 cur_if->ift_ip += *vp->val.integer;
                 break;
-            case 14:    /* ifInErrors */
+            case 14:           /* ifInErrors */
                 cur_if->ift_ie = *vp->val.integer;
                 break;
-            case 16:    /* ifOutOctets */
+            case 16:           /* ifOutOctets */
                 cur_if->ift_ob = *vp->val.integer;
                 break;
-            case 17:    /* ifOutUcastPkts */
+            case 17:           /* ifOutUcastPkts */
                 cur_if->ift_op += *vp->val.integer;
                 break;
-            case 18:    /* ifOutNUcastPkts */
+            case 18:           /* ifOutNUcastPkts */
                 cur_if->ift_op += *vp->val.integer;
                 break;
-            case 19:    /* ifOutDiscards */
+            case 19:           /* ifOutDiscards */
                 cur_if->ift_dr = *vp->val.integer;
                 break;
-            case 20:    /* ifOutErrors */
+            case 20:           /* ifOutErrors */
                 cur_if->ift_oe = *vp->val.integer;
                 break;
-            case 21:    /* ifOutQLen */
+            case 21:           /* ifOutQLen */
                 cur_if->ift_co = *vp->val.integer;
                 break;
             }
         }
-        snmp_free_varbind( var );
+        snmp_free_varbind(var);
         var = NULL;
- 
+
         if (!first) {
- 	    printf("%10lu %5lu %10lu %10lu %5lu %10lu %5lu",
- 		cur_if->ift_ip - ip->ift_ip,
- 		cur_if->ift_ie - ip->ift_ie,
-		cur_if->ift_ib - ip->ift_ib,
-		cur_if->ift_op - ip->ift_op,
-		cur_if->ift_oe - ip->ift_oe,
-		cur_if->ift_ob - ip->ift_ob,
-		cur_if->ift_co - ip->ift_co);
-	    if (dflag)
-		printf(" %5lu", cur_if->ift_dr - ip->ift_dr);
+            printf("%10lu %5lu %10lu %10lu %5lu %10lu %5lu",
+                   cur_if->ift_ip - ip->ift_ip,
+                   cur_if->ift_ie - ip->ift_ie,
+                   cur_if->ift_ib - ip->ift_ib,
+                   cur_if->ift_op - ip->ift_op,
+                   cur_if->ift_oe - ip->ift_oe,
+                   cur_if->ift_ob - ip->ift_ob,
+                   cur_if->ift_co - ip->ift_co);
+            if (dflag)
+                printf(" %5lu", cur_if->ift_dr - ip->ift_dr);
             putchar('\n');
             fflush(stdout);
-	}
-	ip->ift_ip = cur_if->ift_ip;
-	ip->ift_ie = cur_if->ift_ie;
-	ip->ift_ib = cur_if->ift_ib;
-	ip->ift_op = cur_if->ift_op;
-	ip->ift_oe = cur_if->ift_oe;
-	ip->ift_ob = cur_if->ift_ob;
-	ip->ift_co = cur_if->ift_co;
-	ip->ift_dr = cur_if->ift_dr;
-    }  /* (single) interface */
+        }
+        ip->ift_ip = cur_if->ift_ip;
+        ip->ift_ie = cur_if->ift_ie;
+        ip->ift_ib = cur_if->ift_ib;
+        ip->ift_op = cur_if->ift_op;
+        ip->ift_oe = cur_if->ift_oe;
+        ip->ift_ob = cur_if->ift_ob;
+        ip->ift_co = cur_if->ift_co;
+        ip->ift_dr = cur_if->ift_dr;
+    }                           /* (single) interface */
     else {
-	sum->ift_ip = 0;
-	sum->ift_ib = 0;
-	sum->ift_ie = 0;
-	sum->ift_op = 0;
-	sum->ift_ob = 0;
-	sum->ift_oe = 0;
-	sum->ift_co = 0;
-	sum->ift_dr = 0;
+        sum->ift_ip = 0;
+        sum->ift_ib = 0;
+        sum->ift_ie = 0;
+        sum->ift_op = 0;
+        sum->ift_ob = 0;
+        sum->ift_oe = 0;
+        sum->ift_co = 0;
+        sum->ift_dr = 0;
 #define ADD_IFVAR( x ) ifcol_oid[ ifcol_len-2 ] = x; \
     snmp_varlist_add_variable( &var, ifcol_oid, ifcol_len-1, ASN_NULL, NULL,  0)
-        ADD_IFVAR( 11 );            /* ifInUcastPkts  */
-        ADD_IFVAR( 12 );            /* ifInNUcastPkts */
-        ADD_IFVAR( 14 );            /* ifInErrors     */
-        ADD_IFVAR( 17 );            /* ifOutUcastPkts */
-        ADD_IFVAR( 18 );            /* ifOutNUcastPkts */
-        ADD_IFVAR( 20 );            /* ifOutErrors    */
-        ADD_IFVAR( 21 );            /* ifOutQLen      */
-    /*  if (bflag) { */
-            ADD_IFVAR( 10 );        /* ifInOctets     */
-            ADD_IFVAR( 16 );        /* ifOutOctets    */
-    /*  } */
+        ADD_IFVAR(11);          /* ifInUcastPkts  */
+        ADD_IFVAR(12);          /* ifInNUcastPkts */
+        ADD_IFVAR(14);          /* ifInErrors     */
+        ADD_IFVAR(17);          /* ifOutUcastPkts */
+        ADD_IFVAR(18);          /* ifOutNUcastPkts */
+        ADD_IFVAR(20);          /* ifOutErrors    */
+        ADD_IFVAR(21);          /* ifOutQLen      */
+        /*
+         * if (bflag) {
+         */
+        ADD_IFVAR(10);          /* ifInOctets     */
+        ADD_IFVAR(16);          /* ifOutOctets    */
+        /*
+         * }
+         */
         if (dflag) {
-            ADD_IFVAR( 19 );        /* ifOutDiscards  */
+            ADD_IFVAR(19);      /* ifOutDiscards  */
         }
 #undef ADD_IFVAR
 
-        ifcol_oid[ ifcol_len-2 ] = 11;       /* ifInUcastPkts */
-        while ( 1 ) {
-            if (netsnmp_query_getnext( var, ss ) != SNMP_ERR_NOERROR)
+        ifcol_oid[ifcol_len - 2] = 11;  /* ifInUcastPkts */
+        while (1) {
+            if (netsnmp_query_getnext(var, ss) != SNMP_ERR_NOERROR)
                 break;
             if ((var->type & 0xF0) == 0x80)     /* Exception */
                 break;
-            if ( snmp_oid_compare( ifcol_oid, ifcol_len-2,
-                                   var->name, ifcol_len-2) != 0 )
-                break;    /* End of Table */
-            
-            for ( vp=var; vp; vp=vp->next_variable ) {
-                if ((vp->type & 0xF0) == 0x80)     /* Exception */
+            if (snmp_oid_compare(ifcol_oid, ifcol_len - 2,
+                                 var->name, ifcol_len - 2) != 0)
+                break;          /* End of Table */
+
+            for (vp = var; vp; vp = vp->next_variable) {
+                if ((vp->type & 0xF0) == 0x80)  /* Exception */
                     continue;
-                if ( ! vp->val.integer )
+                if (!vp->val.integer)
                     continue;
-                switch ( vp->name[ ifcol_len-2 ] ) {
-                case 10:    /* ifInOctets */
+                switch (vp->name[ifcol_len - 2]) {
+                case 10:       /* ifInOctets */
                     sum->ift_ib += *vp->val.integer;
                     break;
-                case 11:    /* ifInUcastPkts */
+                case 11:       /* ifInUcastPkts */
                     sum->ift_ip += *vp->val.integer;
                     break;
-                case 12:    /* ifInNUcastPkts */
+                case 12:       /* ifInNUcastPkts */
                     sum->ift_ip += *vp->val.integer;
                     break;
-                case 14:    /* ifInErrors */
+                case 14:       /* ifInErrors */
                     sum->ift_ie += *vp->val.integer;
                     break;
-                case 16:    /* ifOutOctets */
+                case 16:       /* ifOutOctets */
                     sum->ift_ob += *vp->val.integer;
                     break;
-                case 17:    /* ifOutUcastPkts */
+                case 17:       /* ifOutUcastPkts */
                     sum->ift_op += *vp->val.integer;
                     break;
-                case 18:    /* ifOutNUcastPkts */
+                case 18:       /* ifOutNUcastPkts */
                     sum->ift_op += *vp->val.integer;
                     break;
-                case 19:    /* ifOutDiscards */
+                case 19:       /* ifOutDiscards */
                     sum->ift_dr += *vp->val.integer;
                     break;
-                case 20:    /* ifOutErrors */
+                case 20:       /* ifOutErrors */
                     sum->ift_oe += *vp->val.integer;
                     break;
-                case 21:    /* ifOutQLen */
+                case 21:       /* ifOutQLen */
                     sum->ift_co += *vp->val.integer;
                     break;
                 }
@@ -806,123 +839,42 @@ loop:
             /*
              * Now loop to retrieve the next entry from the table.
              */
-        }   /* while (1) */
+        }                       /* while (1) */
 
-        snmp_free_varbind( var );
+        snmp_free_varbind(var);
         var = NULL;
- 
+
         if (!first) {
- 	    printf("%10lu %5lu %10lu %10lu %5lu %10lu %5lu",
- 		sum->ift_ip - total->ift_ip,
- 		sum->ift_ie - total->ift_ie,
-		sum->ift_ib - total->ift_ib,
-		sum->ift_op - total->ift_op,
-		sum->ift_oe - total->ift_oe,
-		sum->ift_ob - total->ift_ob,
-		sum->ift_co - total->ift_co);
-	    if (dflag)
-		printf(" %5lu", sum->ift_dr - total->ift_dr);
+            printf("%10lu %5lu %10lu %10lu %5lu %10lu %5lu",
+                   sum->ift_ip - total->ift_ip,
+                   sum->ift_ie - total->ift_ie,
+                   sum->ift_ib - total->ift_ib,
+                   sum->ift_op - total->ift_op,
+                   sum->ift_oe - total->ift_oe,
+                   sum->ift_ob - total->ift_ob,
+                   sum->ift_co - total->ift_co);
+            if (dflag)
+                printf(" %5lu", sum->ift_dr - total->ift_dr);
             putchar('\n');
             fflush(stdout);
-	}
-	total->ift_ip = sum->ift_ip;
-	total->ift_ie = sum->ift_ie;
-	total->ift_ib = sum->ift_ib;
-	total->ift_op = sum->ift_op;
-	total->ift_oe = sum->ift_oe;
-	total->ift_ob = sum->ift_ob;
-	total->ift_co = sum->ift_co;
-	total->ift_dr = sum->ift_dr;
-    }  /* overall summary */
+        }
+        total->ift_ip = sum->ift_ip;
+        total->ift_ie = sum->ift_ie;
+        total->ift_ib = sum->ift_ib;
+        total->ift_op = sum->ift_op;
+        total->ift_oe = sum->ift_oe;
+        total->ift_ob = sum->ift_ob;
+        total->ift_co = sum->ift_co;
+        total->ift_dr = sum->ift_dr;
+    }                           /* overall summary */
 
     timerPause();
     timerSet(interval);
     line++;
     first = 0;
     if (line == 21)
-    	goto banner;
+        goto banner;
     else
-    	goto loop;
+        goto loop;
     /*NOTREACHED*/
 }
-
-
-/*
- * timerSet sets or resets the timer to fire in "interval" seconds.
- * timerPause waits only if the timer has not fired.
- * timing precision is not considered important.
- */
-
-#if (defined(WIN32) || defined(cygwin))
-static int      sav_int;
-static time_t   timezup;
-static void
-timerSet(int interval_seconds)
-{
-    sav_int = interval_seconds;
-    timezup = time(0) + interval_seconds;
-}
-
-/*
- * you can do better than this ! 
- */
-static void
-timerPause(void)
-{
-    time_t          now;
-    while (time(&now) < timezup)
-#ifdef WIN32
-        Sleep(400);
-#else
-    {
-        struct timeval  tx;
-        tx.tv_sec = 0;
-        tx.tv_usec = 400 * 1000;        /* 400 milliseconds */
-        select(0, 0, 0, 0, &tx);
-    }
-#endif
-}
-
-#else
-
-/*
- * Called if an interval expires before sidewaysintpr has completed a loop.
- * Sets a flag to not wait for the alarm.
- */
-RETSIGTYPE
-catchalarm(int sig)
-{
-    signalled = YES;
-}
-
-static void
-timerSet(int interval_seconds)
-{
-#ifdef HAVE_SIGSET
-    (void) sigset(SIGALRM, catchalarm);
-#else
-    (void) signal(SIGALRM, catchalarm);
-#endif
-    signalled = NO;
-    (void) alarm(interval_seconds);
-}
-
-static void
-timerPause(void)
-{
-#ifdef HAVE_SIGHOLD
-    sighold(SIGALRM);
-    if (!signalled) {
-        sigpause(SIGALRM);
-    }
-#else
-    int             oldmask;
-    oldmask = sigblock(sigmask(SIGALRM));
-    if (!signalled) {
-        sigpause(0);
-    }
-    sigsetmask(oldmask);
-#endif
-}
-
-#endif                          /* !WIN32 && !cygwin */
diff -urpN net-snmp-5.8/apps/snmpnetstat/inet.c net-snmp-5.9.1/apps/snmpnetstat/inet.c
--- net-snmp-5.8/apps/snmpnetstat/inet.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpnetstat/inet.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,9 +1,13 @@
-/*	$OpenBSD: inet.c,v 1.92 2005/02/10 14:25:08 itojun Exp $	*/
-/*	$NetBSD: inet.c,v 1.14 1995/10/03 21:42:37 thorpej Exp $	*/
+/*
+ * $OpenBSD: inet.c,v 1.92 2005/02/10 14:25:08 itojun Exp $
+ */
+/*
+ * $NetBSD: inet.c,v 1.14 1995/10/03 21:42:37 thorpej Exp $
+ */
 
 /*
  * Copyright (c) 1983, 1988, 1993
- *	The Regents of the University of California.  All rights reserved.
+ *      The Regents of the University of California.  All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
  * modification, are permitted provided that the following conditions
@@ -30,18 +34,9 @@
  * SUCH DAMAGE.
  */
 
-#ifdef  INHERITED_CODE
-#ifndef lint
-#if 0
-static char sccsid[] = "from: @(#)inet.c	8.4 (Berkeley) 4/20/94";
-#else
-static const char *rcsid = "$OpenBSD: inet.c,v 1.92 2005/02/10 14:25:08 itojun Exp $";
-#endif
-#endif /* not lint */
-#endif
-
 #include <net-snmp/net-snmp-config.h>
 
+#include <stdint.h>
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -67,20 +62,20 @@ static const char *rcsid = "$OpenBSD: in
 #include "netstat.h"
 
 struct stat_table {
-    unsigned int  entry;      /* entry number in table */
+    unsigned int    entry;      /* entry number in table */
     /*
-     * format string to printf(description, value) 
-     * warning: the %d must be before the %s 
+     * format string to printf(description, value)
+     * warning: the %d must be before the %s
      */
     char            description[80];
 };
 
-static char *inetname(struct in_addr *);
+static char    *inetname(const struct in_addr *);
 
-	/*
-	 * Print a summary of connections related to
-	 *   an Internet protocol (kread-based) - Omitted
-	 */
+        /*
+         * Print a summary of connections related to
+         *   an Internet protocol (kread-based) - Omitted
+         */
 
 /*
  * Print a summary of TCP connections
@@ -101,87 +96,90 @@ const char     *tcpstates[] = {
     "CLOSING",
     "TIMEWAIT"
 };
+
 #define TCP_NSTATES 11
 
 static void
-tcpprotoprint_line(const char *name, netsnmp_variable_list *vp, int *first)
+tcpprotoprint_line(const char *name, netsnmp_variable_list * vp,
+                   int *first)
 {
-    int    state, width;
-    char  *cp;
+    int             state, width;
+    char           *cp;
     union {
-        struct in_addr addr;
-        char      data[4];
+        struct in_addr  addr;
+        char            data[4];
     } tmpAddr;
-    oid    localPort, remotePort;
-    struct in_addr localAddr, remoteAddr;
+    oid             localPort, remotePort;
+    struct in_addr  localAddr, remoteAddr;
+
+    state = *vp->val.integer;
+    if (!aflag && state == MIB_TCPCONNSTATE_LISTEN) {
+        return;
+    }
+
+    if (*first) {
+        printf("Active Internet (%s) Connections", name);
+        if (aflag)
+            printf(" (including servers)");
+        putchar('\n');
+        width = 27;
+        printf("%-5.5s %*.*s %*.*s %s\n",
+               "Proto", -width, width, "Local Address",
+               -width, width, "Remote Address", "(state)");
+        *first = 0;
+    }
 
-	state = *vp->val.integer;
-	if (!aflag && state == MIB_TCPCONNSTATE_LISTEN) {
-		return;
-	}
-
-	if (*first) {
-		printf("Active Internet (%s) Connections", name);
-		if (aflag)
-			printf(" (including servers)");
-		putchar('\n');
-		width = 27;
-		printf("%-5.5s %*.*s %*.*s %s\n",
-			   "Proto", -width, width, "Local Address",
-						-width, width, "Remote Address", "(state)");
-		*first = 0;
-	}
-	
-	/* Extract the local/remote information from the index values */
-	cp = tmpAddr.data;
-	cp[0] = (uint8_t) vp->name[10];
-	cp[1] = (uint8_t) vp->name[11];
-	cp[2] = (uint8_t) vp->name[12];
-	cp[3] = (uint8_t) vp->name[13];
-	localAddr.s_addr = tmpAddr.addr.s_addr;
-	localPort        = vp->name[ 14 ];
-	cp = tmpAddr.data;
-	cp[0] = (uint8_t) vp->name[15];
-	cp[1] = (uint8_t) vp->name[16];
-	cp[2] = (uint8_t) vp->name[17];
-	cp[3] = (uint8_t) vp->name[18];
-	remoteAddr.s_addr = tmpAddr.addr.s_addr;
-	remotePort        = vp->name[ 19 ];
-
-	printf("%-5.5s", name);
-	inetprint(&localAddr,  localPort,  name, 1);
-	inetprint(&remoteAddr, remotePort, name, 0);
-	if (state < 1 || state > TCP_NSTATES) {
-		printf(" %d\n", state );
-	} else {
-		printf(" %s\n", tcpstates[state]);
-	}
+    /*
+     * Extract the local/remote information from the index values
+     */
+    cp = tmpAddr.data;
+    cp[0] = (uint8_t) vp->name[10];
+    cp[1] = (uint8_t) vp->name[11];
+    cp[2] = (uint8_t) vp->name[12];
+    cp[3] = (uint8_t) vp->name[13];
+    localAddr.s_addr = tmpAddr.addr.s_addr;
+    localPort = vp->name[14];
+    cp = tmpAddr.data;
+    cp[0] = (uint8_t) vp->name[15];
+    cp[1] = (uint8_t) vp->name[16];
+    cp[2] = (uint8_t) vp->name[17];
+    cp[3] = (uint8_t) vp->name[18];
+    remoteAddr.s_addr = tmpAddr.addr.s_addr;
+    remotePort = vp->name[19];
+
+    printf("%-5.5s", name);
+    inetprint(&localAddr, localPort, name, 1);
+    inetprint(&remoteAddr, remotePort, name, 0);
+    if (state < 1 || state > TCP_NSTATES) {
+        printf(" %d\n", state);
+    } else {
+        printf(" %s\n", tcpstates[state]);
+    }
 }
 
 static void
-tcpprotopr_get(const char *name, oid *root, size_t root_len)
+tcpprotopr_get(const char *name, oid * root, size_t root_len)
 {
     netsnmp_variable_list *var, *vp;
-    int    first = 1;
+    int             first = 1;
 
     /*
      * Walking the tcpConnState column will provide all
      *   the necessary information.
      */
     var = NULL;
-    snmp_varlist_add_variable( &var, root, root_len,
-                                   ASN_NULL, NULL,  0);
+    snmp_varlist_add_variable(&var, root, root_len, ASN_NULL, NULL, 0);
     if (!var)
         return;
-    if (netsnmp_query_walk( var, ss ) != SNMP_ERR_NOERROR)
+    if (netsnmp_query_walk(var, ss) != SNMP_ERR_NOERROR)
+        return;
+    if ((var->type & 0xF0) == 0x80)     /* Exception */
         return;
-    if ((var->type & 0xF0) == 0x80)	/* Exception */
-	return;
 
-    for (vp = var; vp ; vp=vp->next_variable) {
+    for (vp = var; vp; vp = vp->next_variable) {
         tcpprotoprint_line(name, vp, &first);
     }
-    snmp_free_varbind( var );
+    snmp_free_varbind(var);
 }
 
 /*
@@ -192,37 +190,38 @@ void
 udpprotopr(const char *name)
 {
     netsnmp_variable_list *var, *vp;
-    oid    udpLocalAddress_oid[] = { 1,3,6,1,2,1,7,5,1,1 };
-    size_t udpLocalAddress_len   = OID_LENGTH( udpLocalAddress_oid );
+    oid             udpLocalAddress_oid[] =
+        { 1, 3, 6, 1, 2, 1, 7, 5, 1, 1 };
+    size_t          udpLocalAddress_len = OID_LENGTH(udpLocalAddress_oid);
     union {
-        struct in_addr addr;
-        char      data[4];
+        struct in_addr  addr;
+        char            data[4];
     } tmpAddr;
-    struct in_addr localAddr;
-    oid    localPort;
-    char  *cp;
+    struct in_addr  localAddr;
+    oid             localPort;
+    char           *cp;
 
     /*
      * Walking a single column of the udpTable will provide
      *   all the necessary information from the index values.
      */
     var = NULL;
-    snmp_varlist_add_variable( &var, udpLocalAddress_oid, udpLocalAddress_len,
-                                   ASN_NULL, NULL,  0);
+    snmp_varlist_add_variable(&var, udpLocalAddress_oid,
+                              udpLocalAddress_len, ASN_NULL, NULL, 0);
     if (!var)
         return;
-    if (netsnmp_query_walk( var, ss ) != SNMP_ERR_NOERROR) {
+    if (netsnmp_query_walk(var, ss) != SNMP_ERR_NOERROR) {
         snmp_free_varbind(var);
         return;
     }
-    if ((var->type & 0xF0) == 0x80) {	/* Exception */
+    if ((var->type & 0xF0) == 0x80) {   /* Exception */
         snmp_free_varbind(var);
         return;
     }
 
     printf("Active Internet (%s) Connections\n", name);
     printf("%-5.5s %-27.27s\n", "Proto", "Local Address");
-    for (vp = var; vp ; vp=vp->next_variable) {
+    for (vp = var; vp; vp = vp->next_variable) {
         printf("%-5.5s", name);
         /*
          * Extract the local port from the index values, but take
@@ -235,41 +234,41 @@ udpprotopr(const char *name)
         cp[2] = (uint8_t) vp->name[12];
         cp[3] = (uint8_t) vp->name[13];
         localAddr.s_addr = tmpAddr.addr.s_addr;
-        localPort        = vp->name[ 14 ];
+        localPort = vp->name[14];
         inetprint(&localAddr, localPort, name, 1);
         putchar('\n');
     }
-    snmp_free_varbind( var );
+    snmp_free_varbind(var);
 }
 
 void
-tcpprotopr_bulkget(const char *name, oid *root, size_t root_len)
+tcpprotopr_bulkget(const char *name, oid * root, size_t root_len)
 {
     netsnmp_variable_list *vp;
-	netsnmp_pdu    *pdu, *response;
+    netsnmp_pdu    *pdu, *response;
     oid             tcpConnState_oid[MAX_OID_LEN];
-	size_t          tcpConnState_len;
-    int    first = 1;
-    int    running = 1;
-    int    status;
+    size_t          tcpConnState_len;
+    int             first = 1;
+    int             running = 1;
+    int             status;
 
-	/*
+    /*
      * setup initial object name
      */
-	memmove(tcpConnState_oid, root, sizeof(oid) * root_len);
-	tcpConnState_len = root_len;
+    memmove(tcpConnState_oid, root, sizeof(oid) * root_len);
+    tcpConnState_len = root_len;
 
     /*
      * Walking the tcpConnState column will provide all
      *   the necessary information.
      */
-	while (running) {
+    while (running) {
         /*
          * create PDU for GETBULK request and add object name to request
          */
         pdu = snmp_pdu_create(SNMP_MSG_GETBULK);
         pdu->non_repeaters = 0;
-        pdu->max_repetitions = max_getbulk;    /* fill the packet */
+        pdu->max_repetitions = max_getbulk;     /* fill the packet */
         snmp_add_null_var(pdu, tcpConnState_oid, tcpConnState_len);
 
         /*
@@ -278,9 +277,10 @@ tcpprotopr_bulkget(const char *name, oid
         status = snmp_synch_response(ss, pdu, &response);
         if (status == STAT_SUCCESS) {
             if (response->errstat == SNMP_ERR_NOERROR) {
-				for (vp = response->variables; vp ; vp=vp->next_variable) {
+                for (vp = response->variables; vp; vp = vp->next_variable) {
                     if ((vp->name_length < root_len) ||
-							(memcmp(root, vp->name, sizeof(oid) * root_len) != 0)) {
+                        (memcmp(root, vp->name, sizeof(oid) * root_len) !=
+                         0)) {
                         /*
                          * not part of this subtree
                          */
@@ -292,7 +292,7 @@ tcpprotopr_bulkget(const char *name, oid
                         (vp->type != SNMP_NOSUCHOBJECT) &&
                         (vp->type != SNMP_NOSUCHINSTANCE)) {
 
-			tcpprotoprint_line(name, vp, &first);
+                        tcpprotoprint_line(name, vp, &first);
 
                         /*
                          * Check if last variable, and if so, save for next request.
@@ -308,7 +308,7 @@ tcpprotopr_bulkget(const char *name, oid
                          */
                         running = 0;
                     }
-				}
+                }
             } else {
                 /*
                  * error in response, print it
@@ -323,16 +323,16 @@ tcpprotopr_bulkget(const char *name, oid
 
         if (response) {
             snmp_free_pdu(response);
-		}
-	}
+        }
+    }
 }
 
 void
 tcpprotopr(const char *name)
 {
-    oid    tcpConnState_oid[] = { 1,3,6,1,2,1,6,13,1,1 };
-    size_t tcpConnState_len   = OID_LENGTH( tcpConnState_oid );
-    int    use_getbulk = 1;
+    oid             tcpConnState_oid[] = { 1, 3, 6, 1, 2, 1, 6, 13, 1, 1 };
+    size_t          tcpConnState_len = OID_LENGTH(tcpConnState_oid);
+    int             use_getbulk = 1;
 
 #ifndef NETSNMP_DISABLE_SNMPV1
     if (ss->version == SNMP_VERSION_1) {
@@ -341,48 +341,50 @@ tcpprotopr(const char *name)
 #endif
 
     if (use_getbulk) {
-	    tcpprotopr_bulkget(name, tcpConnState_oid, tcpConnState_len);
+        tcpprotopr_bulkget(name, tcpConnState_oid, tcpConnState_len);
     } else {
-	    tcpprotopr_get(name, tcpConnState_oid, tcpConnState_len);
+        tcpprotopr_get(name, tcpConnState_oid, tcpConnState_len);
     }
 }
 
 
-	/*********************
+        /*********************
 	 *
 	 *  Internet-protocol statistics
 	 *
 	 *********************/
 
 void
-_dump_stats( const char *name, oid *oid_buf, size_t buf_len,
-             struct stat_table *stable )
+_dump_stats(const char *name, oid * oid_buf, size_t buf_len,
+            struct stat_table *stable)
 {
     netsnmp_variable_list *var, *vp;
-    struct stat_table     *sp;
-    oid    stat;
+    struct stat_table *sp;
+    oid             stat;
 
     var = NULL;
-    for (sp=stable; sp->entry; sp++) {
-        oid_buf[buf_len-2] = sp->entry;
-        snmp_varlist_add_variable( &var, oid_buf, buf_len,
-                                   ASN_NULL, NULL,  0);
-    }
- 
-    if (netsnmp_query_get( var, ss ) != SNMP_ERR_NOERROR) {
-        /* Need to fix and re-try SNMPv1 errors */
-        snmp_free_varbind( var );
+    for (sp = stable; sp->entry; sp++) {
+        oid_buf[buf_len - 2] = sp->entry;
+        snmp_varlist_add_variable(&var, oid_buf, buf_len,
+                                  ASN_NULL, NULL, 0);
+    }
+
+    if (netsnmp_query_get(var, ss) != SNMP_ERR_NOERROR) {
+        /*
+         * Need to fix and re-try SNMPv1 errors
+         */
+        snmp_free_varbind(var);
         return;
     }
 
     printf("%s:\n", name);
-    sp=stable;
-    for (vp=var; vp; vp=vp->next_variable, sp++) {
+    sp = stable;
+    for (vp = var; vp; vp = vp->next_variable, sp++) {
         /*
          * Match the returned results against
          *   the original stats table.
          */
-        stat =  vp->name[buf_len-2];
+        stat = vp->name[buf_len - 2];
         while (sp->entry < stat) {
             sp++;
             if (sp->entry == 0)
@@ -391,20 +393,22 @@ _dump_stats( const char *name, oid *oid_
         if (sp->entry > stat)
             continue;
 
-        /* Skip exceptions or missing values */
-        if ( !vp->val.integer )
+        /*
+         * Skip exceptions or missing values
+         */
+        if (!vp->val.integer)
             continue;
         /*
          * If '-Cs' was specified twice,
          *   then only display non-zero stats.
          */
-        if ( *vp->val.integer > 0 || sflag == 1 ) {
+        if (*vp->val.integer > 0 || sflag == 1) {
             printf(sp->description, *vp->val.integer,
-                             plural(*vp->val.integer));
+                   plural(*vp->val.integer));
             putchar('\n');
         }
     }
-    snmp_free_varbind( var );
+    snmp_free_varbind(var);
 }
 
 
@@ -414,16 +418,16 @@ _dump_stats( const char *name, oid *oid_
 void
 ip_stats(const char *name)
 {
-    oid               ipstats_oid[] = { 1, 3, 6, 1, 2, 1, 4, 0, 0 };
-    size_t            ipstats_len   = OID_LENGTH( ipstats_oid );
+    oid             ipstats_oid[] = { 1, 3, 6, 1, 2, 1, 4, 0, 0 };
+    size_t          ipstats_len = OID_LENGTH(ipstats_oid);
     struct stat_table ipstats_tbl[] = {
-        { 3, "%14lu total datagram%s received"},
-        { 4, "%14lu datagram%s with header errors"},
-        { 5, "%14lu datagram%s with an invalid destination address"},
-        { 6, "%14lu datagram%s forwarded"},
-        { 7, "%14lu datagram%s with unknown protocol"},
-        { 8, "%14lu datagram%s discarded"},
-        { 9, "%14lu datagram%s delivered"},
+        {3, "%14lu total datagram%s received"},
+        {4, "%14lu datagram%s with header errors"},
+        {5, "%14lu datagram%s with an invalid destination address"},
+        {6, "%14lu datagram%s forwarded"},
+        {7, "%14lu datagram%s with unknown protocol"},
+        {8, "%14lu datagram%s discarded"},
+        {9, "%14lu datagram%s delivered"},
         {10, "%14lu output datagram request%s"},
         {11, "%14lu output datagram%s discarded"},
         {12, "%14lu datagram%s with no route"},
@@ -434,10 +438,10 @@ ip_stats(const char *name)
         {18, "%14lu fragmentation failure%s"},
         {19, "%14lu fragment%s created"},
         {23, "%14lu route%s discarded"},
-        { 0, ""}
+        {0, ""}
     };
 
-    _dump_stats( name, ipstats_oid, ipstats_len, ipstats_tbl );
+    _dump_stats(name, ipstats_oid, ipstats_len, ipstats_tbl);
 }
 
 
@@ -447,28 +451,28 @@ ip_stats(const char *name)
 void
 icmp_stats(const char *name)
 {
-    oid               icmpstats_oid[] = { 1, 3, 6, 1, 2, 1, 5, 0, 0 };
-    size_t            icmpstats_len   = OID_LENGTH( icmpstats_oid );
+    oid             icmpstats_oid[] = { 1, 3, 6, 1, 2, 1, 5, 0, 0 };
+    size_t          icmpstats_len = OID_LENGTH(icmpstats_oid);
     struct stat_table icmpstats_tbl[] = {
-        { 1, "%14lu total message%s received"},
-        { 2, "%14lu message%s dropped due to errors"},
+        {1, "%14lu total message%s received"},
+        {2, "%14lu message%s dropped due to errors"},
         {14, "%14lu ouput message request%s"},
         {15, "%14lu output message%s discarded"},
-        { 0, ""}
+        {0, ""}
     };
     struct stat_table icmp_inhistogram[] = {
-        { 3, "        Destination unreachable: %lu"},
-        { 4, "        Time Exceeded: %lu"},
-        { 5, "        Parameter Problem: %lu"},
-        { 6, "        Source Quench: %lu"},
-        { 7, "        Redirect: %lu"},
-        { 8, "        Echo Request: %lu"},
-        { 9, "        Echo Reply: %lu"},
+        {3, "        Destination unreachable: %lu"},
+        {4, "        Time Exceeded: %lu"},
+        {5, "        Parameter Problem: %lu"},
+        {6, "        Source Quench: %lu"},
+        {7, "        Redirect: %lu"},
+        {8, "        Echo Request: %lu"},
+        {9, "        Echo Reply: %lu"},
         {10, "        Timestamp Request: %lu"},
         {11, "        Timestamp Reply: %lu"},
         {12, "        Address Mask Request: %lu"},
         {13, "        Address Mask Reply: %lu"},
-        { 0, ""}
+        {0, ""}
     };
     struct stat_table icmp_outhistogram[] = {
         {16, "        Destination unreachable: %lu"},
@@ -485,11 +489,11 @@ icmp_stats(const char *name)
         {0, ""}
     };
 
-    _dump_stats( name, icmpstats_oid, icmpstats_len, icmpstats_tbl );
-    _dump_stats( "    Input Histogram",
-                       icmpstats_oid, icmpstats_len, icmp_inhistogram );
-    _dump_stats( "    Output Histogram",
-                       icmpstats_oid, icmpstats_len, icmp_outhistogram );
+    _dump_stats(name, icmpstats_oid, icmpstats_len, icmpstats_tbl);
+    _dump_stats("    Input Histogram",
+                icmpstats_oid, icmpstats_len, icmp_inhistogram);
+    _dump_stats("    Output Histogram",
+                icmpstats_oid, icmpstats_len, icmp_outhistogram);
 }
 
 
@@ -499,22 +503,22 @@ icmp_stats(const char *name)
 void
 tcp_stats(const char *name)
 {
-    oid               tcpstats_oid[] = { 1, 3, 6, 1, 2, 1, 6, 0, 0 };
-    size_t            tcpstats_len   = OID_LENGTH( tcpstats_oid );
+    oid             tcpstats_oid[] = { 1, 3, 6, 1, 2, 1, 6, 0, 0 };
+    size_t          tcpstats_len = OID_LENGTH(tcpstats_oid);
     struct stat_table tcpstats_tbl[] = {
-        { 5, "%14lu active open%s"},
-        { 6, "%14lu passive open%s"},
-        { 7, "%14lu failed attempt%s"},
-        { 8, "%14lu reset%s of established connections"},
-        { 9, "%14lu currently established connection%s"},
+        {5, "%14lu active open%s"},
+        {6, "%14lu passive open%s"},
+        {7, "%14lu failed attempt%s"},
+        {8, "%14lu reset%s of established connections"},
+        {9, "%14lu currently established connection%s"},
         {10, "%14lu segment%s received"},
         {11, "%14lu segment%s sent"},
         {12, "%14lu segment%s retransmitted"},
         {14, "%14lu invalid segment%s received"},
         {15, "%14lu reset%s sent"},
-        { 0, ""}
+        {0, ""}
     };
-    _dump_stats( "tcp", tcpstats_oid, tcpstats_len, tcpstats_tbl );
+    _dump_stats("tcp", tcpstats_oid, tcpstats_len, tcpstats_tbl);
 }
 
 
@@ -524,8 +528,8 @@ tcp_stats(const char *name)
 void
 udp_stats(const char *name)
 {
-    oid               udpstats_oid[] = { 1, 3, 6, 1, 2, 1, 7, 0, 0 };
-    size_t            udpstats_len   = OID_LENGTH( udpstats_oid );
+    oid             udpstats_oid[] = { 1, 3, 6, 1, 2, 1, 7, 0, 0 };
+    size_t          udpstats_len = OID_LENGTH(udpstats_oid);
     struct stat_table udpstats_tbl[] = {
         {1, "%14lu total datagram%s received"},
         {2, "%14lu datagram%s to invalid port"},
@@ -533,7 +537,7 @@ udp_stats(const char *name)
         {4, "%14lu output datagram request%s"},
         {0, ""}
     };
-    _dump_stats( "udp", udpstats_oid, udpstats_len, udpstats_tbl );
+    _dump_stats("udp", udpstats_oid, udpstats_len, udpstats_tbl);
 }
 
 
@@ -550,9 +554,9 @@ udp_stats(const char *name)
  *     Dump IPCOMP   statistics
  */
 
-	/*
-	 * Utility routines
-	 */
+        /*
+         * Utility routines
+         */
 
 /*
  * Translation of RPC service names - Omitted
@@ -563,30 +567,30 @@ udp_stats(const char *name)
  * If the nflag was specified, use numbers instead of names.
  */
 void
-inetprint(struct in_addr *in, int port, const char *proto, int local)
+inetprint(const struct in_addr *in, int port, const char *proto, int local)
 {
-	struct servent *sp = NULL;
-	char line[80], *cp;
-	int width = 27;
-
-	if (vflag)
-	    snprintf(line, sizeof line, "%s.", inetname(in));
-	else
-	    snprintf(line, sizeof line, "%.*s.", width-9, inetname(in));
-	cp = strchr(line, '\0');
-	if (!nflag && port)
-		sp = getservbyport(htons((uint16_t) port), proto);
-	if (sp || port == 0)
-		snprintf(cp, line + sizeof line - cp, vflag ? "%s" : "%.8s",
-		    sp ? sp->s_name : "*");
-     /*
-      * Translation of RPC service names - Omitted
-      */
-	else
-		snprintf(cp, line + sizeof line - cp, "%d", port);
-	if (vflag && width < strlen(line))
-	    width = strlen(line);
-	printf(" %-*.*s", width, width, line);
+    struct servent *sp = NULL;
+    char            line[80], *cp;
+    int             width = 27;
+
+    if (vflag)
+        snprintf(line, sizeof line, "%s.", inetname(in));
+    else
+        snprintf(line, sizeof line, "%.*s.", width - 9, inetname(in));
+    cp = strchr(line, '\0');
+    if (!nflag && port)
+        sp = getservbyport(htons((uint16_t) port), proto);
+    if (sp || port == 0)
+        snprintf(cp, line + sizeof line - cp, vflag ? "%s" : "%.8s",
+                 sp ? sp->s_name : "*");
+    /*
+     * Translation of RPC service names - Omitted
+     */
+    else
+        snprintf(cp, line + sizeof line - cp, "%d", port);
+    if (vflag && width < strlen(line))
+        width = strlen(line);
+    printf(" %-*.*s", width, width, line);
 }
 
 /*
@@ -594,67 +598,59 @@ inetprint(struct in_addr *in, int port,
  * If the nflag has been supplied, give
  * numeric value, otherwise try for symbolic name.
  */
-char *
-inetname(struct in_addr *inp)
+char           *
+inetname(const struct in_addr *inp)
 {
-	char *cp;
-	static char line[50];
-	struct hostent *hp;
-	struct netent *np;
-	static char domain[MAXHOSTNAMELEN];
-	static int first = 1;
-#if defined (WIN32) || defined (cygwin)
-        char host_temp[] = "localhost";
-#endif
+    char           *cp;
+    static char     line[50];
+    struct netent  *np;
+    static char     domain[MAXHOSTNAMELEN];
+    static int      first = 1;
+
+    if (first && !nflag) {
+        char            tmp[MAXHOSTNAMELEN];
+        first = 0;
+        if (gethostname(tmp, sizeof(tmp)) == 0 && (cp = strchr(tmp, '.')))
+            (void) strlcpy(domain, cp + 1, sizeof domain);
+        else
+            domain[0] = '\0';
+    }
+    if (inp->s_addr == INADDR_ANY) {
+        strlcpy(line, "*", sizeof(line));
+    } else {
+        char            host[16];
+
+        cp = NULL;
+        if (!nflag && inet_lnaof(*inp) == INADDR_ANY) {
+            np = getnetbyaddr(inet_netof(*inp), AF_INET);
+            if (np)
+                cp = np->n_name;
+        }
+        if (cp == NULL) {
+            struct sockaddr_in sin;
 
-	if (first && !nflag) {
-		char tmp[MAXHOSTNAMELEN];
-		first = 0;
-		if (gethostname(tmp, sizeof(tmp)) == 0 &&
-		    (cp = strchr(tmp, '.')))
-			(void) strlcpy(domain, cp + 1, sizeof domain);
-		else
-			domain[0] = '\0';
-	}
-	cp = NULL;
-	if (!nflag && inp->s_addr != INADDR_ANY) {
-		int net = inet_netof(*inp);
-		int lna = inet_lnaof(*inp);
-
-		if (lna == INADDR_ANY) {
-			np = getnetbyaddr(net, AF_INET);
-			if (np)
-				cp = np->n_name;
-		}
-		if (cp == NULL) {
-			hp = netsnmp_gethostbyaddr((char *)inp, sizeof (*inp),
-                                                   AF_INET);
-			if (hp) {
-				if ((cp = strchr(hp->h_name, '.')) &&
-				    !strcmp(cp + 1, domain))
-					*cp = '\0';
+            memset(&sin, 0, sizeof(sin));
+            sin.sin_family = AF_INET;
+            sin.sin_addr = *inp;
+            if (getnameinfo((struct sockaddr *) &sin, sizeof(sin),
+                            host, sizeof(host), NULL, 0,
+                            nflag ? NI_NUMERICHOST : 0) < 0)
+                strlcpy(host, "?", sizeof(host));
+            if ((cp = strchr(host, '.')) && !strcmp(cp + 1, domain))
+                *cp = '\0';
 #if defined (WIN32) || defined (cygwin)
-                                        /* Windows insists on returning the computer name for 127.0.0.1
-                                         * even if the hosts file lists something else such as 'localhost'.
-                                         * If we are trying to look up 127.0.0.1, just return 'localhost'   */
-                                        if (!strcmp(inet_ntoa(*inp),"127.0.0.1"))
-                                             cp = host_temp;
-                                        else
-#endif                                                                          
-				cp = hp->h_name;
-			}
-		}
-	}
-	if (inp->s_addr == INADDR_ANY)
-		snprintf(line, sizeof line, "*");
-	else if (cp)
-		snprintf(line, sizeof line, "%s", cp);
-	else {
-		inp->s_addr = ntohl(inp->s_addr);
-#define C(x)	(unsigned)((x) & 0xff)
-		snprintf(line, sizeof line, "%u.%u.%u.%u",
-		    C(inp->s_addr >> 24), C(inp->s_addr >> 16),
-		    C(inp->s_addr >> 8), C(inp->s_addr));
-	}
-	return (line);
+            /*
+             * Windows insists on returning the computer name for
+             * 127.0.0.1 even if the hosts file lists something
+             * else such as 'localhost'.  If we are trying to look
+             * up 127.0.0.1, just return 'localhost'.
+             */
+            if (inp->s_addr == htonl(INADDR_LOOPBACK))
+                strlcpy(host, "localhost", sizeof(host));
+#endif
+            cp = host;
+        }
+        strlcpy(line, cp, sizeof(line));
+    }
+    return line;
 }
diff -urpN net-snmp-5.8/apps/snmpnetstat/inet6.c net-snmp-5.9.1/apps/snmpnetstat/inet6.c
--- net-snmp-5.8/apps/snmpnetstat/inet6.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpnetstat/inet6.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,8 +1,12 @@
-/*	$OpenBSD: inet6.c,v 1.31 2004/11/17 01:47:20 itojun Exp $	*/
-/*	BSDI inet.c,v 2.3 1995/10/24 02:19:29 prb Exp	*/
+/*
+ * $OpenBSD: inet6.c,v 1.31 2004/11/17 01:47:20 itojun Exp $
+ */
+/*
+ * BSDI inet.c,v 2.3 1995/10/24 02:19:29 prb Exp
+ */
 /*
  * Copyright (c) 1983, 1988, 1993
- *	The Regents of the University of California.  All rights reserved.
+ *      The Regents of the University of California.  All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
  * modification, are permitted provided that the following conditions
@@ -29,17 +33,6 @@
  * SUCH DAMAGE.
  */
 
-#ifdef  INHERITED_CODE
-#ifndef lint
-#if 0
-static char sccsid[] = "@(#)inet.c	8.4 (Berkeley) 4/20/94";
-#else
-/*__RCSID("$OpenBSD: inet6.c,v 1.31 2004/11/17 01:47:20 itojun Exp $");*/
-/*__RCSID("KAME Id: inet6.c,v 1.10 2000/02/09 10:49:31 itojun Exp");*/
-#endif
-#endif /* not lint */
-#endif
-
 #include <net-snmp/net-snmp-config.h>
 
 #if HAVE_UNISTD_H
@@ -71,15 +64,15 @@ static char sccsid[] = "@(#)inet.c	8.4 (
 #include "netstat.h"
 
 struct stat_table {
-    unsigned int entry;      /* entry number in table */
+    unsigned int    entry;      /* entry number in table */
     /*
-     * format string to printf(description, value) 
-     * warning: the %d must be before the %s 
+     * format string to printf(description, value)
+     * warning: the %d must be before the %s
      */
     char            description[80];
 };
 
-static char *inet6name(const unsigned char *);
+static char    *inet6name(const struct in6_addr *);
 
 /*
  * Print a summary of TCPv6 connections
@@ -100,33 +93,35 @@ const char     *tcp6states[] = {
     "CLOSING",
     "TIMEWAIT"
 };
+
 #define TCP_NSTATES 11
 
 void
 tcp6protopr(const char *name)
 {
     netsnmp_variable_list *var, *vp;
-    oid    ipv6TcpConnState_oid[] = { 1,3,6,1,2,1,6,16,1,6 };
-    size_t ipv6TcpConnState_len   = OID_LENGTH( ipv6TcpConnState_oid );
-    int    state, i;
+    oid             ipv6TcpConnState_oid[] =
+        { 1, 3, 6, 1, 2, 1, 6, 16, 1, 6 };
+    size_t          ipv6TcpConnState_len =
+        OID_LENGTH(ipv6TcpConnState_oid);
+    int             state, i;
     unsigned char   localAddr[16], remoteAddr[16];
-    int    localPort,     remotePort,  ifIndex;
-    int    first = 1;
+    int             localPort, remotePort, ifIndex;
+    int             first = 1;
 
     /*
      * Walking the v6 tcpConnState column will provide all
      *   the necessary information.
      */
     var = NULL;
-    snmp_varlist_add_variable( &var, ipv6TcpConnState_oid,
-                                     ipv6TcpConnState_len,
-                                     ASN_NULL, NULL,  0);
-    if (netsnmp_query_walk( var, ss ) != SNMP_ERR_NOERROR)
+    snmp_varlist_add_variable(&var, ipv6TcpConnState_oid,
+                              ipv6TcpConnState_len, ASN_NULL, NULL, 0);
+    if (netsnmp_query_walk(var, ss) != SNMP_ERR_NOERROR)
         return;
-    if ((var->type & 0xF0) == 0x80)		/* exception */
+    if ((var->type & 0xF0) == 0x80)     /* exception */
         return;
 
-    for (vp = var; vp ; vp=vp->next_variable) {
+    for (vp = var; vp; vp = vp->next_variable) {
         state = *vp->val.integer;
         if (!aflag && state == MIB_TCPCONNSTATE_LISTEN)
             continue;
@@ -137,28 +132,31 @@ tcp6protopr(const char *name)
                 printf(" (including servers)");
             putchar('\n');
             printf("%-5.5s %-27.27s %-27.27s %4s %s\n",
-                   "Proto", "Local Address", "Remote Address", "I/F", "(state)");
+                   "Proto", "Local Address", "Remote Address", "I/F",
+                   "(state)");
             first = 0;
         }
-        
-        /* Extract the local/remote information from the index values */
-        for (i=0; i<16; i++)
-            localAddr[i]  = vp->name[ 10+i ];
-        localPort    = vp->name[ 26 ];
-        for (i=0; i<16; i++)
-            remoteAddr[i] = vp->name[ 27+i ];
-        remotePort   = vp->name[ 43 ];
-        ifIndex      = vp->name[ 44 ];
+
+        /*
+         * Extract the local/remote information from the index values
+         */
+        for (i = 0; i < 16; i++)
+            localAddr[i] = vp->name[10 + i];
+        localPort = vp->name[26];
+        for (i = 0; i < 16; i++)
+            remoteAddr[i] = vp->name[27 + i];
+        remotePort = vp->name[43];
+        ifIndex = vp->name[44];
 
         printf("%-5.5s", name);
-        inet6print(localAddr,  localPort,  name, 1);
-        inet6print(remoteAddr, remotePort, name, 0);
-        if ( state < 1 || state > TCP_NSTATES )
-            printf(" %4d %d\n", ifIndex, state );
+        inet6print((struct in6_addr *) localAddr, localPort, name, 1);
+        inet6print((struct in6_addr *) remoteAddr, remotePort, name, 0);
+        if (state < 1 || state > TCP_NSTATES)
+            printf(" %4d %d\n", ifIndex, state);
         else
-            printf(" %4d %s\n", ifIndex, tcp6states[ state ]);
+            printf(" %4d %s\n", ifIndex, tcp6states[state]);
     }
-    snmp_free_varbind( var );
+    snmp_free_varbind(var);
 }
 
 /*
@@ -169,42 +167,43 @@ void
 udp6protopr(const char *name)
 {
     netsnmp_variable_list *var, *vp;
-    oid    ipv6UdpLocalAddress_oid[] = { 1,3,6,1,2,1,7,6,1,1 };
-    size_t ipv6UdpLocalAddress_len   = OID_LENGTH( ipv6UdpLocalAddress_oid );
-    int    localPort, ifIndex;
+    oid             ipv6UdpLocalAddress_oid[] =
+        { 1, 3, 6, 1, 2, 1, 7, 6, 1, 1 };
+    size_t          ipv6UdpLocalAddress_len =
+        OID_LENGTH(ipv6UdpLocalAddress_oid);
+    int             localPort, ifIndex;
 
     /*
      * Walking a single column of the udpTable will provide
      *   all the necessary information from the index values.
      */
     var = NULL;
-    snmp_varlist_add_variable( &var, ipv6UdpLocalAddress_oid,
-                                     ipv6UdpLocalAddress_len,
-                                     ASN_NULL, NULL,  0);
-    if (netsnmp_query_walk( var, ss ) != SNMP_ERR_NOERROR)
+    snmp_varlist_add_variable(&var, ipv6UdpLocalAddress_oid,
+                              ipv6UdpLocalAddress_len, ASN_NULL, NULL, 0);
+    if (netsnmp_query_walk(var, ss) != SNMP_ERR_NOERROR)
         return;
-    if ((var->type & 0xF0) == 0x80)		/* exception */
+    if ((var->type & 0xF0) == 0x80)     /* exception */
         return;
 
     printf("Active Internet Connections\n");
     printf("%-5.5s %-27.27s %4s\n", "Proto", "Local Address", "I/F");
-    for (vp = var; vp ; vp=vp->next_variable) {
+    for (vp = var; vp; vp = vp->next_variable) {
         printf("%-5.5s", name);
         /*
          * Extract the local port from the index values, but take
          *   the IP address from the varbind value, (which is why
          *   we walked udpLocalAddress rather than udpLocalPort)
          */
-        localPort = vp->name[ vp->name_length-2 ];
-        ifIndex   = vp->name[ vp->name_length-1 ];
-        inet6print(vp->val.string, localPort, name, 1);
-        printf(" %4d\n", ifIndex );
+        localPort = vp->name[vp->name_length - 2];
+        ifIndex = vp->name[vp->name_length - 1];
+        inet6print((struct in6_addr *) vp->val.string, localPort, name, 1);
+        printf(" %4d\n", ifIndex);
     }
-    snmp_free_varbind( var );
+    snmp_free_varbind(var);
 }
 
 
-	/*********************
+        /*********************
 	 *
 	 *  IPv6 statistics
 	 *
@@ -217,68 +216,67 @@ udp6protopr(const char *name)
  *    than simply retrieving individual scalar values)
  */
 void
-_dump_v6stats( const char *name, oid *oid_buf, size_t buf_len,
-               struct stat_table *stable )
+_dump_v6stats(const char *name, oid * oid_buf, size_t buf_len,
+              struct stat_table *stable)
 {
     netsnmp_variable_list *var, *vp;
-    struct stat_table     *sp;
-    long   *stats;
-    oid stat;
-    unsigned int max_stat = 0;
-    int    active   = 0;
+    struct stat_table *sp;
+    long           *stats;
+    oid             stat;
+    unsigned int    max_stat = 0;
+    int             active = 0;
 
     var = NULL;
-    for (sp=stable; sp->entry; sp++) {
-        oid_buf[buf_len-1] = sp->entry;
+    for (sp = stable; sp->entry; sp++) {
+        oid_buf[buf_len - 1] = sp->entry;
         if (sp->entry > max_stat)
             max_stat = sp->entry;
-        snmp_varlist_add_variable( &var, oid_buf, buf_len,
-                                   ASN_NULL, NULL,  0);
+        snmp_varlist_add_variable(&var, oid_buf, buf_len,
+                                  ASN_NULL, NULL, 0);
     }
-    oid_buf[buf_len-1] = stable[0].entry;
-    stats = (long *)calloc(max_stat+1, sizeof(long));
-    
+    oid_buf[buf_len - 1] = stable[0].entry;
+    stats = (long *) calloc(max_stat + 1, sizeof(long));
+
     /*
      * Walk the specified column(s), and total the individual statistics
      */
     while (1) {
-        if (netsnmp_query_getnext( var, ss ) != SNMP_ERR_NOERROR)
+        if (netsnmp_query_getnext(var, ss) != SNMP_ERR_NOERROR)
             break;
-        if ((var->type & 0xF0) == 0x80)		/* exception */
+        if ((var->type & 0xF0) == 0x80) /* exception */
             break;
-        if ( snmp_oid_compare( oid_buf,   buf_len,
-                               var->name, buf_len) != 0 )
-            break;    /* End of Table */
-            
-        for ( vp=var; vp; vp=vp->next_variable ) {
-            stat = vp->name[ buf_len-1 ];
+        if (snmp_oid_compare(oid_buf, buf_len, var->name, buf_len) != 0)
+            break;              /* End of Table */
+
+        for (vp = var; vp; vp = vp->next_variable) {
+            stat = vp->name[buf_len - 1];
             stats[stat] += *vp->val.integer;
         }
-        active=1;
+        active = 1;
     }
     if (!active) {
-        free( stats );
-        snmp_free_varbind( var );
-        return;     /* No statistics to display */
+        free(stats);
+        snmp_free_varbind(var);
+        return;                 /* No statistics to display */
     }
 
     /*
      * Display the results
      */
     printf("%s:\n", name);
-    for (sp=stable; sp->entry; sp++) {
+    for (sp = stable; sp->entry; sp++) {
         /*
          * If '-Cs' was specified twice,
          *   then only display non-zero stats.
          */
-        if ( stats[sp->entry] > 0 || sflag == 1 ) {
+        if (stats[sp->entry] > 0 || sflag == 1) {
             printf(sp->description, stats[sp->entry],
-                             plural(stats[sp->entry]));
+                   plural(stats[sp->entry]));
             putchar('\n');
         }
     }
-    free( stats );
-    snmp_free_varbind( var );
+    free(stats);
+    snmp_free_varbind(var);
 }
 
 
@@ -288,18 +286,18 @@ _dump_v6stats( const char *name, oid *oi
 void
 ip6_stats(const char *name)
 {
-    oid               ip6stats_oid[] = { 1, 3, 6, 1, 2, 1, 55, 1, 6, 1, 0 };
-    size_t            ip6stats_len   = OID_LENGTH( ip6stats_oid );
+    oid             ip6stats_oid[] = { 1, 3, 6, 1, 2, 1, 55, 1, 6, 1, 0 };
+    size_t          ip6stats_len = OID_LENGTH(ip6stats_oid);
     struct stat_table ip6stats_tbl[] = {
-        { 1, "%14d total datagram%s received"},
-        { 2, "%14d datagram%s with header errors"},
-        { 3, "%14d oversized datagram%s"},
-        { 4, "%14d datagram%s with no route"},
-        { 5, "%14d datagram%s with an invalid destination address"},
-        { 6, "%14d datagram%s with unknown protocol"},
-        { 7, "%14d short datagram%s discarded"},
-        { 8, "%14d datagram%s discarded"},
-        { 9, "%14d datagram%s delivered"},
+        {1, "%14d total datagram%s received"},
+        {2, "%14d datagram%s with header errors"},
+        {3, "%14d oversized datagram%s"},
+        {4, "%14d datagram%s with no route"},
+        {5, "%14d datagram%s with an invalid destination address"},
+        {6, "%14d datagram%s with unknown protocol"},
+        {7, "%14d short datagram%s discarded"},
+        {8, "%14d datagram%s discarded"},
+        {9, "%14d datagram%s delivered"},
         {10, "%14d datagram%s forwarded"},
         {11, "%14d output datagram request%s"},
         {12, "%14d output datagram%s discarded"},
@@ -311,10 +309,10 @@ ip6_stats(const char *name)
         {18, "%14d reassembly failure%s"},
         {19, "%14d multicast datagram%s received"},
         {20, "%14d multicast datagram%s transmitted"},
-        { 0, ""}
+        {0, ""}
     };
 
-    _dump_v6stats( name, ip6stats_oid, ip6stats_len, ip6stats_tbl );
+    _dump_v6stats(name, ip6stats_oid, ip6stats_len, ip6stats_tbl);
 }
 
 /*
@@ -328,23 +326,24 @@ ip6_stats(const char *name)
 void
 icmp6_stats(const char *name)
 {
-    oid               icmp6stats_oid[] = { 1, 3, 6, 1, 2, 1, 56, 1, 1, 1, 0 };
-    size_t            icmp6stats_len   = OID_LENGTH( icmp6stats_oid );
+    oid             icmp6stats_oid[] =
+        { 1, 3, 6, 1, 2, 1, 56, 1, 1, 1, 0 };
+    size_t          icmp6stats_len = OID_LENGTH(icmp6stats_oid);
     struct stat_table icmp6stats_tbl[] = {
-        { 1, "%14d total message%s received"},
-        { 2, "%14d message%s dropped due to errors"},
+        {1, "%14d total message%s received"},
+        {2, "%14d message%s dropped due to errors"},
         {18, "%14d ouput message request%s"},
         {19, "%14d output message%s discarded"},
-        { 0, ""}
+        {0, ""}
     };
     struct stat_table icmp6_inhistogram[] = {
-        { 3, "        Destination unreachable: %d"},
-        { 4, "        Admin Prohibit: %d"},
-        { 5, "        Time Exceeded: %d"},
-        { 6, "        Parameter Problem: %d"},
-        { 7, "        Too Big: %d"},
-        { 8, "        Echo Request: %d"},
-        { 9, "        Echo Reply: %d"},
+        {3, "        Destination unreachable: %d"},
+        {4, "        Admin Prohibit: %d"},
+        {5, "        Time Exceeded: %d"},
+        {6, "        Parameter Problem: %d"},
+        {7, "        Too Big: %d"},
+        {8, "        Echo Request: %d"},
+        {9, "        Echo Reply: %d"},
         {10, "        Router Solicit: %d"},
         {11, "        Router Advert: %d"},
         {12, "        Neighbor Solicit: %d"},
@@ -353,7 +352,7 @@ icmp6_stats(const char *name)
         {15, "        Group Member Request: %d"},
         {16, "        Group Member Reply: %d"},
         {17, "        Group Member Reduce: %d"},
-        { 0, ""}
+        {0, ""}
     };
     struct stat_table icmp6_outhistogram[] = {
         {20, "        Destination unreachable: %d"},
@@ -374,11 +373,11 @@ icmp6_stats(const char *name)
         {0, ""}
     };
 
-    _dump_v6stats( name, icmp6stats_oid, icmp6stats_len, icmp6stats_tbl );
-    _dump_v6stats( "    Input Histogram",
-                         icmp6stats_oid, icmp6stats_len, icmp6_inhistogram );
-    _dump_v6stats( "    Output Histogram",
-                         icmp6stats_oid, icmp6stats_len, icmp6_outhistogram );
+    _dump_v6stats(name, icmp6stats_oid, icmp6stats_len, icmp6stats_tbl);
+    _dump_v6stats("    Input Histogram",
+                  icmp6stats_oid, icmp6stats_len, icmp6_inhistogram);
+    _dump_v6stats("    Output Histogram",
+                  icmp6stats_oid, icmp6stats_len, icmp6_outhistogram);
 }
 
 /*
@@ -400,7 +399,8 @@ icmp6_stats(const char *name)
  */
 
 void
-inet6print(unsigned char *in6, int port, const char *proto, int local)
+inet6print(const struct in6_addr *in6, int port, const char *proto,
+           int local)
 {
 
 #define GETSERVBYPORT6(port, proto, ret) do { \
@@ -412,30 +412,30 @@ inet6print(unsigned char *in6, int port,
 		(ret) = getservbyport((int)(port), (proto)); \
 	} while (0)
 
-	struct servent *sp = NULL;
-	char line[80], *cp;
-	int width = 27-9;
-	int len = sizeof line;
-
-	if (vflag && width < strlen(inet6name(in6)))
-		width = strlen(inet6name(in6));
-	snprintf(line, len, "%.*s.", width, inet6name(in6));
-	len -= strlen(line);
-	if (len <= 0)
-		goto bail;
-
-	cp = strchr(line, '\0');
-	if (!nflag && port && local)
-		GETSERVBYPORT6(htons(port), proto, sp);
-	if (sp || port == 0)
-		snprintf(cp, len, vflag ? "%s" : "%.8s", sp ? sp->s_name : "*");
-	else
-		snprintf(cp, len, "%d", port);
-	width = 27;
-	if (vflag && width < strlen(line))
-		width = strlen(line);
-bail:
-	printf(" %-*.*s", width, width, line);
+    struct servent *sp = NULL;
+    char            line[80], *cp;
+    int             width = 27 - 9;
+    int             len = sizeof line;
+
+    if (vflag && width < strlen(inet6name(in6)))
+        width = strlen(inet6name(in6));
+    snprintf(line, len, "%.*s.", width, inet6name(in6));
+    len -= strlen(line);
+    if (len <= 0)
+        goto bail;
+
+    cp = strchr(line, '\0');
+    if (!nflag && port && local)
+        GETSERVBYPORT6(htons(port), proto, sp);
+    if (sp || port == 0)
+        snprintf(cp, len, vflag ? "%s" : "%.8s", sp ? sp->s_name : "*");
+    else
+        snprintf(cp, len, "%d", port);
+    width = 27;
+    if (vflag && width < strlen(line))
+        width = strlen(line);
+  bail:
+    printf(" %-*.*s", width, width, line);
 }
 
 /*
@@ -444,68 +444,52 @@ bail:
  * numeric value, otherwise try for symbolic name.
  */
 
-char *
-inet6name(const unsigned char *in6)
+char           *
+inet6name(const struct in6_addr *in6p)
 {
-	char *cp;
-	static char line[NI_MAXHOST];
-	static char domain[MAXHOSTNAMELEN];
-	static int first = 1;
-#ifdef NETSNMP_ENABLE_IPV6
-	struct hostent *hp;
-	char hbuf[NI_MAXHOST];
-	const int niflag = NI_NUMERICHOST;
-	struct sockaddr_in6 sin6;
-	const struct in6_addr *in6p = (const struct in6_addr *)in6;
-#endif
-
-	if (first && !nflag) {
-		first = 0;
-		if (gethostname(line, sizeof(line)) == 0 &&
-		    (cp = strchr(line, '.')))
-			(void) strlcpy(domain, cp + 1, sizeof domain);
-		else
-			domain[0] = '\0';
-	}
+    char           *cp;
+    static char     line[NI_MAXHOST];
+    static char     domain[MAXHOSTNAMELEN];
+    static int      first = 1;
+
+    if (first && !nflag) {
+        first = 0;
+        if (gethostname(line, sizeof(line)) == 0 &&
+            (cp = strchr(line, '.')))
+            (void) strlcpy(domain, cp + 1, sizeof domain);
+        else
+            domain[0] = '\0';
+    }
 #ifdef NETSNMP_ENABLE_IPV6
-	cp = NULL;
-	if (!nflag && !IN6_IS_ADDR_UNSPECIFIED(in6p)) {
-		hp = netsnmp_gethostbyaddr((const char *)in6p, sizeof(*in6p),
-                                           AF_INET6);
-		if (hp) {
-			if ((cp = strchr(hp->h_name, '.')) &&
-			    !strcmp(cp + 1, domain))
-				*cp = 0;
-			cp = hp->h_name;
-		}
-	}
-	if (IN6_IS_ADDR_UNSPECIFIED(in6p))
-		strlcpy(line, "*", sizeof(line));
-	else if (cp)
-		strlcpy(line, cp, sizeof(line));
-	else {
-		memset(&sin6, 0, sizeof(sin6));
-/*		sin6.sin6_len = sizeof(sin6);   */
-		sin6.sin6_family = AF_INET6;
-		sin6.sin6_addr = *in6p;
+    if (IN6_IS_ADDR_UNSPECIFIED(in6p)) {
+        strlcpy(line, "*", sizeof(line));
+    } else {
+        struct sockaddr_in6 sin6;
+        char            hbuf[NI_MAXHOST];
+
+        memset(&sin6, 0, sizeof(sin6));
+        sin6.sin6_family = AF_INET6;
+        sin6.sin6_addr = *in6p;
 #ifdef __KAME__
-		if (IN6_IS_ADDR_LINKLOCAL(in6p) ||
-		    IN6_IS_ADDR_MC_LINKLOCAL(in6p)) {
-			sin6.sin6_scope_id =
-			    ntohs(*(const uint16_t *)&in6p->s6_addr[2]);
-			sin6.sin6_addr.s6_addr[2] = 0;
-			sin6.sin6_addr.s6_addr[3] = 0;
-		}
+        if (IN6_IS_ADDR_LINKLOCAL(in6p) || IN6_IS_ADDR_MC_LINKLOCAL(in6p)) {
+            sin6.sin6_scope_id =
+                ntohs(*(const uint16_t *) &in6p->s6_addr[2]);
+            sin6.sin6_addr.s6_addr[2] = 0;
+            sin6.sin6_addr.s6_addr[3] = 0;
+        }
 #endif
-		if (getnameinfo((struct sockaddr *)&sin6, sizeof(sin6),
-		    hbuf, sizeof(hbuf), NULL, 0, niflag) != 0)
-			strlcpy(hbuf, "?", sizeof hbuf);
-		strlcpy(line, hbuf, sizeof(line));
-	}
+        if (getnameinfo((struct sockaddr *) &sin6, sizeof(sin6),
+                        hbuf, sizeof(hbuf), NULL, 0,
+                        nflag ? NI_NUMERICHOST : 0) < 0)
+            strlcpy(hbuf, "?", sizeof(hbuf));
+        if ((cp = strchr(hbuf, '.')) && strcmp(cp + 1, domain) == 0)
+            *cp = 0;
+        strlcpy(line, hbuf, sizeof(line));
+    }
 #else
-	strlcpy(line, "[[XXX - inet6 address]]", sizeof(line));
+    strlcpy(line, "[[XXX - inet6 address]]", sizeof(line));
 #endif
-	return (line);
+    return (line);
 }
 
 #ifdef TCP6
diff -urpN net-snmp-5.8/apps/snmpnetstat/inetx.c net-snmp-5.9.1/apps/snmpnetstat/inetx.c
--- net-snmp-5.8/apps/snmpnetstat/inetx.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpnetstat/inetx.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,8 +1,12 @@
-/*	$OpenBSD: inet6.c,v 1.31 2004/11/17 01:47:20 itojun Exp $	*/
-/*	BSDI inet.c,v 2.3 1995/10/24 02:19:29 prb Exp	*/
+/*
+ * $OpenBSD: inet6.c,v 1.31 2004/11/17 01:47:20 itojun Exp $
+ */
+/*
+ * BSDI inet.c,v 2.3 1995/10/24 02:19:29 prb Exp
+ */
 /*
  * Copyright (c) 1983, 1988, 1993
- *	The Regents of the University of California.  All rights reserved.
+ *      The Regents of the University of California.  All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
  * modification, are permitted provided that the following conditions
@@ -29,17 +33,6 @@
  * SUCH DAMAGE.
  */
 
-#ifdef  INHERITED_CODE
-#ifndef lint
-#if 0
-static char sccsid[] = "@(#)inet.c	8.4 (Berkeley) 4/20/94";
-#else
-/*__RCSID("$OpenBSD: inet6.c,v 1.31 2004/11/17 01:47:20 itojun Exp $");*/
-/*__RCSID("KAME Id: inet6.c,v 1.10 2000/02/09 10:49:31 itojun Exp");*/
-#endif
-#endif /* not lint */
-#endif
-
 #include <net-snmp/net-snmp-config.h>
 
 #if HAVE_UNISTD_H
@@ -71,15 +64,16 @@ static char sccsid[] = "@(#)inet.c	8.4 (
 #include "netstat.h"
 
 struct stat_table {
-    unsigned int entry;      /* entry number in table */
+    unsigned int    entry;      /* entry number in table */
     /*
-     * format string to printf(description, value) 
-     * warning: the %d must be before the %s 
+     * format string to printf(description, value)
+     * warning: the %d must be before the %s
      */
     char            description[80];
 };
 
-void	inetxprint(int, struct sockaddr_in6 , int, const char *, int);
+void            inetxprint(int, struct sockaddr_in6, int, const char *,
+                           int);
 
 /*
  * Print a summary of TCP connections
@@ -100,110 +94,111 @@ const char     *tcpxstates[] = {
     "CLOSING",
     "TIMEWAIT"
 };
+
 #define TCP_NSTATES 11
 
 typedef struct {
-    int stat;
-    int hcstat;
-    const char *str;
+    int             stat;
+    int             hcstat;
+    const char     *str;
 } systemstats_t;
 
-systemstats_t systemstats[] = {
-    {  3,  4, "datagrams input" },
-    {  5,  6, "octets received" },
-    {  7,  0, "hdr errors input" },
-    {  8,  0, "no routes input" },
-    {  9,  0, "address errors input" },
-    { 10,  0, "unknown protocol input" },
-    { 12, 13, "input datagrams forwarded" },
-    { 11,  0, "truncated datagrams input" },
-    { 14,  0, "input reassembly required" },
-    { 15,  0, "input reassemled OK" },
-    { 16,  0, "input reassembly failed" },
-    { 17,  0, "input datagrams discarded" },
-    { 18, 19, "input datagrams received" },
-    { 20, 21, "output datagram requests" },
-    { 22,  0, "output no route" },
-    { 23, 24, "datagrams forwarded" },
-    { 25,  0, "output datagrams discarded" },
-    { 26,  0, "output datagrams fragmentation required" },
-    { 27,  0, "output datagrams fragmented" },
-    { 28,  0, "output fragmentation failed" },
-    { 29,  0, "fragments created" },
-    { 30, 31, "datagrams transmitted" },
-    { 32, 33, "octets transmitted" },
-    {  0 }
+systemstats_t   systemstats[] = {
+    {3, 4, "datagrams input"},
+    {5, 6, "octets received"},
+    {7, 0, "hdr errors input"},
+    {8, 0, "no routes input"},
+    {9, 0, "address errors input"},
+    {10, 0, "unknown protocol input"},
+    {12, 13, "input datagrams forwarded"},
+    {11, 0, "truncated datagrams input"},
+    {14, 0, "input reassembly required"},
+    {15, 0, "input reassemled OK"},
+    {16, 0, "input reassembly failed"},
+    {17, 0, "input datagrams discarded"},
+    {18, 19, "input datagrams received"},
+    {20, 21, "output datagram requests"},
+    {22, 0, "output no route"},
+    {23, 24, "datagrams forwarded"},
+    {25, 0, "output datagrams discarded"},
+    {26, 0, "output datagrams fragmentation required"},
+    {27, 0, "output datagrams fragmented"},
+    {28, 0, "output fragmentation failed"},
+    {29, 0, "fragments created"},
+    {30, 31, "datagrams transmitted"},
+    {32, 33, "octets transmitted"},
+    {0}
 };
 
-systemstats_t icmpstats[] = {
-    {  2,  0, "input messages" },
-    {  3,  0, "input errors" },
-    {  4,  0, "output messages" },
-    {  5,  0, "output errors" },
-    {  0 }
+systemstats_t   icmpstats[] = {
+    {2, 0, "input messages"},
+    {3, 0, "input errors"},
+    {4, 0, "output messages"},
+    {5, 0, "output errors"},
+    {0}
 };
 
 typedef struct {
-    int code;
-    const char *name;
+    int             code;
+    const char     *name;
 } codelist_t;
 
-codelist_t icmpcodes[] = {
-    {   0, "Echo reply" },
-    {   3, "Destination unreachable" },
-    {   4, "Source quench" },
-    {   5, "Redirect" },
-    {   6, "Alternate host address" },
-    {   8, "Echo request" },
-    {   9, "Router advertisement" },
-    {  10, "Router selection" },
-    {  11, "Time exceeded" },
-    {  12, "Parameter problem" },
-    {  13, "Timestamp request" },
-    {  14, "Timestamp reply" },
-    {  15, "Information request" },
-    {  16, "Information reply" },
-    {  17, "Address mask request" },
-    {  18, "Address mask reply" },
-    { 0 }
+codelist_t      icmpcodes[] = {
+    {0, "Echo reply"},
+    {3, "Destination unreachable"},
+    {4, "Source quench"},
+    {5, "Redirect"},
+    {6, "Alternate host address"},
+    {8, "Echo request"},
+    {9, "Router advertisement"},
+    {10, "Router selection"},
+    {11, "Time exceeded"},
+    {12, "Parameter problem"},
+    {13, "Timestamp request"},
+    {14, "Timestamp reply"},
+    {15, "Information request"},
+    {16, "Information reply"},
+    {17, "Address mask request"},
+    {18, "Address mask reply"},
+    {0}
 };
 
-codelist_t icmp6codes[] = {
-    {   1,   "Destination Unreachable" },
-    {   2,   "Packet Too Big" },
-    {   3,   "Time Exceeded" },
-    {   4,   "Parameter Problem" },
-    { 100,   "Private experimentation 100" },
-    { 101,   "Private experimentation 101" },
-    { 127,   "Reserved for expansion of ICMPv6 error messages" },
-    { 128,   "Echo Request" },
-    { 129,   "Echo Reply" },
-    { 130,   "Multicast Listener Query" },
-    { 131,   "Multicast Listener Report" },
-    { 132,   "Multicast Listener Done" },
-    { 133,   "Router Solicitation" },
-    { 134,   "Router Advertisement" },
-    { 135,   "Neighbor Solicitation" },
-    { 136,   "Neighbor Advertisement" },
-    { 137,   "Redirect Message" },
-    { 138,   "Router Renumbering" },
-    { 139,   "ICMP Node Information Query" },
-    { 140,   "ICMP Node Information Response" },
-    { 141,   "Inverse Neighbor Discovery Solicitation Message" },
-    { 142,   "Inverse Neighbor Discovery Advertisement Message" },
-    { 143,   "Version 2 Multicast Listener Report" },
-    { 144,   "Home Agent Address Discovery Request Message" },
-    { 145,   "Home Agent Address Discovery Reply Message" },
-    { 146,   "Mobile Prefix Solicitation" },
-    { 147,   "Mobile Prefix Advertisement" },
-    { 148,   "Certification Path Solicitation Message" },
-    { 149,   "Certification Path Advertisement Message" },
-    { 151,   "Multicast Router Advertisement" },
-    { 152,   "Multicast Router Solicitation" },
-    { 153,   "Multicast Router Termination" },
-    { 154,   "FMIPv6 Messages" },
-    { 155,   "RPL Control Message" },
-    { 0 }
+codelist_t      icmp6codes[] = {
+    {1, "Destination Unreachable"},
+    {2, "Packet Too Big"},
+    {3, "Time Exceeded"},
+    {4, "Parameter Problem"},
+    {100, "Private experimentation 100"},
+    {101, "Private experimentation 101"},
+    {127, "Reserved for expansion of ICMPv6 error messages"},
+    {128, "Echo Request"},
+    {129, "Echo Reply"},
+    {130, "Multicast Listener Query"},
+    {131, "Multicast Listener Report"},
+    {132, "Multicast Listener Done"},
+    {133, "Router Solicitation"},
+    {134, "Router Advertisement"},
+    {135, "Neighbor Solicitation"},
+    {136, "Neighbor Advertisement"},
+    {137, "Redirect Message"},
+    {138, "Router Renumbering"},
+    {139, "ICMP Node Information Query"},
+    {140, "ICMP Node Information Response"},
+    {141, "Inverse Neighbor Discovery Solicitation Message"},
+    {142, "Inverse Neighbor Discovery Advertisement Message"},
+    {143, "Version 2 Multicast Listener Report"},
+    {144, "Home Agent Address Discovery Request Message"},
+    {145, "Home Agent Address Discovery Reply Message"},
+    {146, "Mobile Prefix Solicitation"},
+    {147, "Mobile Prefix Advertisement"},
+    {148, "Certification Path Solicitation Message"},
+    {149, "Certification Path Advertisement Message"},
+    {151, "Multicast Router Advertisement"},
+    {152, "Multicast Router Solicitation"},
+    {153, "Multicast Router Termination"},
+    {154, "FMIPv6 Messages"},
+    {155, "RPL Control Message"},
+    {0}
 };
 
 
@@ -211,91 +206,100 @@ void
 tcpxprotopr(const char *name)
 {
     netsnmp_variable_list *var, *vp, *pvar;
-    oid    tcpConnectionState_oid[] = { 1,3,6,1,2,1,6,19,1,7 };
-    size_t tcpConnectionState_len   = OID_LENGTH( tcpConnectionState_oid );
-    int    state, i;
+    oid             tcpConnectionState_oid[] =
+        { 1, 3, 6, 1, 2, 1, 6, 19, 1, 7 };
+    size_t          tcpConnectionState_len =
+        OID_LENGTH(tcpConnectionState_oid);
+    int             state, i;
     struct sockaddr_in6 localAddr, remoteAddr;
-    int    localPort,     remotePort,  pid = 0;
-    int    localType,    remoteType, inx;
-    int    first = 1;
-    static int done = 0;
+    int             localPort, remotePort, pid = 0;
+    int             localType, remoteType, inx;
+    int             first = 1;
+    static int      done = 0;
 
-    if (done++) return;
+    if (done++)
+        return;
 
     /*
      * Walking the v6 tcpConnectionState column will provide all
      *   the necessary information.
      */
     var = NULL;
-    snmp_varlist_add_variable( &var, tcpConnectionState_oid,
-                                     tcpConnectionState_len,
-                                     ASN_NULL, NULL,  0);
-    if (netsnmp_query_walk( var, ss ) != SNMP_ERR_NOERROR) {
+    snmp_varlist_add_variable(&var, tcpConnectionState_oid,
+                              tcpConnectionState_len, ASN_NULL, NULL, 0);
+    if (netsnmp_query_walk(var, ss) != SNMP_ERR_NOERROR) {
         snmp_free_varbind(var);
         return;
     }
-    if ((var->type & 0xF0) == 0x80) {	/* Exception */
+    if ((var->type & 0xF0) == 0x80) {   /* Exception */
         snmp_free_varbind(var);
         return;
     }
 
-    for (vp = var; vp ; vp=vp->next_variable) {
-	char lname[5];
+    for (vp = var; vp; vp = vp->next_variable) {
+        char            lname[5];
         state = *vp->val.integer;
-	inx = tcpConnectionState_len;
-	pvar = NULL;
-
-	vp->name[inx-1] = 8;
-	snmp_varlist_add_variable( &pvar, vp->name, vp->name_length,
-					 ASN_NULL, NULL,  0);
-	if (netsnmp_query_get( pvar, ss ) != SNMP_ERR_NOERROR) {
-	    snmp_free_var( pvar );
-	    return;
-	}
-	if ((pvar->type & 0xF0) != 0x80)	/* Exception */
-	    pid = *pvar->val.integer;
-        
-        /* Extract the local/remote information from the index values */
-	localType = vp->name[inx++];
-	for (i = 0; i < vp->name[inx]; i++)
-	    localAddr.sin6_addr.s6_addr[i] = vp->name[inx+i+1];
-	inx += vp->name[inx] + 1;
-        localPort    = vp->name[inx++];
-	remoteType = vp->name[inx++];
-	for (i = 0; i < vp->name[inx]; i++)
-	    remoteAddr.sin6_addr.s6_addr[i] = vp->name[inx+i+1];
-	inx += vp->name[inx] + 1;
-        remotePort    = vp->name[inx++];
+        inx = tcpConnectionState_len;
+        pvar = NULL;
 
-	snmp_free_varbind(pvar);
+        vp->name[inx - 1] = 8;
+        snmp_varlist_add_variable(&pvar, vp->name, vp->name_length,
+                                  ASN_NULL, NULL, 0);
+        if (netsnmp_query_get(pvar, ss) != SNMP_ERR_NOERROR) {
+            snmp_free_var(pvar);
+            return;
+        }
+        if ((pvar->type & 0xF0) != 0x80)        /* Exception */
+            pid = *pvar->val.integer;
 
-	if (af == AF_INET && localType == 2) continue;
-	if (af == AF_INET6 && localType != 2) continue;
+        /*
+         * Extract the local/remote information from the index values
+         */
+        localType = vp->name[inx++];
+        for (i = 0; i < vp->name[inx]; i++)
+            localAddr.sin6_addr.s6_addr[i] = vp->name[inx + i + 1];
+        inx += vp->name[inx] + 1;
+        localPort = vp->name[inx++];
+        remoteType = vp->name[inx++];
+        for (i = 0; i < vp->name[inx]; i++)
+            remoteAddr.sin6_addr.s6_addr[i] = vp->name[inx + i + 1];
+        inx += vp->name[inx] + 1;
+        remotePort = vp->name[inx++];
+
+        snmp_free_varbind(pvar);
+
+        if (af == AF_INET && localType == 2)
+            continue;
+        if (af == AF_INET6 && localType != 2)
+            continue;
 
         if (first) {
             printf("Active Internet (%s) Connections", "tcp");
             putchar('\n');
             printf("%-5.5s %-27.27s %-27.27s %11.11s %5.5s\n",
-                   "Proto", "Local Address", "Remote Address", "State", "PID");
+                   "Proto", "Local Address", "Remote Address", "State",
+                   "PID");
             first = 0;
         }
 
-	strcpy(lname, "tcp");
-	if (localType == 2) lname[3] = '6';
-	else lname[3] = '4';
-	lname[4] = 0;
+        strcpy(lname, "tcp");
+        if (localType == 2)
+            lname[3] = '6';
+        else
+            lname[3] = '4';
+        lname[4] = 0;
         printf("%-5.5s", lname);
-        inetxprint(localType, localAddr,  localPort, "tcp", 1);
+        inetxprint(localType, localAddr, localPort, "tcp", 1);
         inetxprint(remoteType, remoteAddr, remotePort, "tcp", 0);
-        if ( state < 1 || state > TCP_NSTATES )
+        if (state < 1 || state > TCP_NSTATES)
             printf(" %11d %5d\n", state, pid);
         else
-            printf(" %11s %5d\n", tcpxstates[ state ], pid);
+            printf(" %11s %5d\n", tcpxstates[state], pid);
     }
-    snmp_free_varbind( var );
+    snmp_free_varbind(var);
 
     if (aflag)
-	listenxprotopr(name);
+        listenxprotopr(name);
 }
 
 /*
@@ -305,53 +309,58 @@ void
 listenxprotopr(const char *name)
 {
     netsnmp_variable_list *var, *vp;
-    oid    tcpListenerProcess_oid[] = { 1,3,6,1,2,1,6,20,1,4 };
-    size_t tcpListenerProcess_len   = OID_LENGTH( tcpListenerProcess_oid );
+    oid             tcpListenerProcess_oid[] =
+        { 1, 3, 6, 1, 2, 1, 6, 20, 1, 4 };
+    size_t          tcpListenerProcess_len =
+        OID_LENGTH(tcpListenerProcess_oid);
     struct sockaddr_in6 localAddr;
-    int    localType, localPort, pid;
-    int    i, inx;
+    int             localType, localPort, pid;
+    int             i, inx;
 
     /*
      * Walking a single column of the udpTable will provide
      *   all the necessary information from the index values.
      */
     var = NULL;
-    snmp_varlist_add_variable( &var, tcpListenerProcess_oid,
-                                     tcpListenerProcess_len,
-                                     ASN_NULL, NULL,  0);
-    if (netsnmp_query_walk( var, ss ) != SNMP_ERR_NOERROR)
+    snmp_varlist_add_variable(&var, tcpListenerProcess_oid,
+                              tcpListenerProcess_len, ASN_NULL, NULL, 0);
+    if (netsnmp_query_walk(var, ss) != SNMP_ERR_NOERROR)
         return;
-    if ((var->type & 0xF0) == 0x80)	/* Exception */
+    if ((var->type & 0xF0) == 0x80)     /* Exception */
         return;
 
     printf("Listening Internet (%s) Connections\n", "tcp");
     printf("%-5.5s %-27.27s %5s\n", "Proto", "Local Address", "PID");
-    for (vp = var; vp ; vp=vp->next_variable) {
-	char lname[5];
-	inx = tcpListenerProcess_len;
+    for (vp = var; vp; vp = vp->next_variable) {
+        char            lname[5];
+        inx = tcpListenerProcess_len;
         /*
          * Extract the local port from the index values, but take
          *   the IP address from the varbind value, (which is why
          *   we walked udpLocalAddress rather than udpLocalPort)
          */
-	localType = vp->name[inx++];
-	if (af == AF_INET && localType == 2) continue;
-	if (af == AF_INET6 && localType != 2) continue;
-
-	for (i = 0; i < vp->name[inx]; i++)
-	    localAddr.sin6_addr.s6_addr[i] = vp->name[inx+i+1];
-	inx += vp->name[inx]+1;
-        localPort = vp->name[ inx++ ];
-        pid   = *vp->val.integer;
-	strcpy(lname, "tcp");
-	if (localType == 2) lname[3] = '6';
-	else lname[3] = '4';
-	lname[4] = 0;
+        localType = vp->name[inx++];
+        if (af == AF_INET && localType == 2)
+            continue;
+        if (af == AF_INET6 && localType != 2)
+            continue;
+
+        for (i = 0; i < vp->name[inx]; i++)
+            localAddr.sin6_addr.s6_addr[i] = vp->name[inx + i + 1];
+        inx += vp->name[inx] + 1;
+        localPort = vp->name[inx++];
+        pid = *vp->val.integer;
+        strcpy(lname, "tcp");
+        if (localType == 2)
+            lname[3] = '6';
+        else
+            lname[3] = '4';
+        lname[4] = 0;
         printf("%-5.5s", lname);
         inetxprint(localType, localAddr, localPort, "tcp", 1);
         printf(" %5d\n", pid);
     }
-    snmp_free_varbind( var );
+    snmp_free_varbind(var);
 }
 
 /*
@@ -362,156 +371,165 @@ void
 udpxprotopr(const char *name)
 {
     netsnmp_variable_list *var, *vp;
-    oid    udpEndpointProcess_oid[] = { 1,3,6,1,2,1,7,7,1,8 };
-    size_t udpEndpointProcess_len   = OID_LENGTH( udpEndpointProcess_oid );
+    oid             udpEndpointProcess_oid[] =
+        { 1, 3, 6, 1, 2, 1, 7, 7, 1, 8 };
+    size_t          udpEndpointProcess_len =
+        OID_LENGTH(udpEndpointProcess_oid);
     struct sockaddr_in6 localAddr, remoteAddr;
-    int    localType, remoteType, localPort, remotePort, pid;
-    int    i, inx;
-    static int done = 0;
+    int             localType, remoteType, localPort, remotePort, pid;
+    int             i, inx;
+    static int      done = 0;
 
-    if (done++) return;
+    if (done++)
+        return;
 
     /*
      * Walking a single column of the udpTable will provide
      *   all the necessary information from the index values.
      */
     var = NULL;
-    snmp_varlist_add_variable( &var, udpEndpointProcess_oid,
-                                     udpEndpointProcess_len,
-                                     ASN_NULL, NULL,  0);
-    if (netsnmp_query_walk( var, ss ) != SNMP_ERR_NOERROR) {
-	snmp_free_varbind(var);
+    snmp_varlist_add_variable(&var, udpEndpointProcess_oid,
+                              udpEndpointProcess_len, ASN_NULL, NULL, 0);
+    if (netsnmp_query_walk(var, ss) != SNMP_ERR_NOERROR) {
+        snmp_free_varbind(var);
         return;
     }
-    if ((var->type & 0xF0) == 0x80) {	/* Exception */
-	snmp_free_varbind(var);
+    if ((var->type & 0xF0) == 0x80) {   /* Exception */
+        snmp_free_varbind(var);
         return;
     }
 
     printf("Active Internet (%s) Connections\n", "udp");
-    printf("%-5.5s %-27.27s %-27.27s %5s\n", "Proto", "Local Address", "Remote Address", "PID");
-    for (vp = var; vp ; vp=vp->next_variable) {
-        char lname[5];
-	inx = udpEndpointProcess_len;
+    printf("%-5.5s %-27.27s %-27.27s %5s\n", "Proto", "Local Address",
+           "Remote Address", "PID");
+    for (vp = var; vp; vp = vp->next_variable) {
+        char            lname[5];
+        inx = udpEndpointProcess_len;
         /*
          * Extract the local port from the index values, but take
          *   the IP address from the varbind value, (which is why
          *   we walked udpLocalAddress rather than udpLocalPort)
          */
-	localType = vp->name[inx++];
-	if (af == AF_INET && localType == 2) continue;
-	if (af == AF_INET6 && localType != 2) continue;
-	for (i = 0; i < vp->name[inx]; i++)
-	    localAddr.sin6_addr.s6_addr[i] = vp->name[inx+i+1];
-	inx += vp->name[inx]+1;
-        localPort = vp->name[ inx++ ];
-	remoteType = vp->name[inx++];
-	for (i = 0; i < vp->name[inx]; i++)
-	    remoteAddr.sin6_addr.s6_addr[i] = vp->name[inx+i+1];
-	inx += vp->name[inx]+1;
-        remotePort = vp->name[ inx++ ];
-        pid   = *vp->val.integer;
-	strcpy(lname, "udp");
-	if (localType == 2) lname[3] = '6';
-	else lname[3] = '4';
-	lname[4] = 0;
+        localType = vp->name[inx++];
+        if (af == AF_INET && localType == 2)
+            continue;
+        if (af == AF_INET6 && localType != 2)
+            continue;
+        for (i = 0; i < vp->name[inx]; i++)
+            localAddr.sin6_addr.s6_addr[i] = vp->name[inx + i + 1];
+        inx += vp->name[inx] + 1;
+        localPort = vp->name[inx++];
+        remoteType = vp->name[inx++];
+        for (i = 0; i < vp->name[inx]; i++)
+            remoteAddr.sin6_addr.s6_addr[i] = vp->name[inx + i + 1];
+        inx += vp->name[inx] + 1;
+        remotePort = vp->name[inx++];
+        pid = *vp->val.integer;
+        strcpy(lname, "udp");
+        if (localType == 2)
+            lname[3] = '6';
+        else
+            lname[3] = '4';
+        lname[4] = 0;
         printf("%-5.5s", lname);
         inetxprint(localType, localAddr, localPort, "udp", 1);
         inetxprint(remoteType, remoteAddr, remotePort, "udp", 1);
         printf(" %5d\n", pid);
     }
-    snmp_free_varbind( var );
+    snmp_free_varbind(var);
 }
 
 static void
-statsprint(const char *name, const systemstats_t *st, int proto,
-	const oid *tbl, size_t tbllen)
+statsprint(const char *name, const systemstats_t * st, int proto,
+           const oid * tbl, size_t tbllen)
 {
-    oid var[32];
-    size_t len;
+    oid             var[32];
+    size_t          len;
     netsnmp_variable_list *vb;
 
-    memcpy(var, tbl, tbllen*sizeof(oid));
-    var[tbllen+1] = proto;
-    len = tbllen+2;
+    memcpy(var, tbl, tbllen * sizeof(oid));
+    var[tbllen + 1] = proto;
+    len = tbllen + 2;
 
     printf("%s:\n", name);
     while (st->stat) {
-	vb = NULL;
-	if (st->hcstat) {
-	    var[tbllen] = st->hcstat;
-	    snmp_varlist_add_variable( &vb, var, len, ASN_NULL, NULL,  0);
-	    if (netsnmp_query_get( vb, ss ) != SNMP_ERR_NOERROR) {
-		snmp_free_var( vb );
-		vb = NULL;
-	    }
-	}
-	if (!vb) {
-	    var[tbllen] = st->stat;
-	    snmp_varlist_add_variable( &vb, var, len, ASN_NULL, NULL, 0);
-	    if (netsnmp_query_get( vb, ss ) != SNMP_ERR_NOERROR) {
-		snmp_free_var( vb );
-		vb = NULL;
-	    }
-	}
-	if (vb) {
-	    if (vb->type == ASN_COUNTER) {
-		if (*vb->val.integer > 0 || sflag == 1)
-		    printf("%14lu %s\n", *vb->val.integer, st->str);
-	    }
-	    else if (vb->type == ASN_COUNTER64) {
-		char a64buf[I64CHARSZ + 1];
-		printU64(a64buf, vb->val.counter64);
-		if (strcmp(a64buf, "0") != 0 || sflag == 1)
-		    printf("%14s %s\n", a64buf, st->str);
-	    }
-	    else
-		printf("%14s %s\n", "-", st->str);
-	    snmp_free_varbind(vb);
-	}
-	else {
-	    printf("%14s %s\n", "-", st->str);
-	}
-	st++;
+        vb = NULL;
+        if (st->hcstat) {
+            var[tbllen] = st->hcstat;
+            snmp_varlist_add_variable(&vb, var, len, ASN_NULL, NULL, 0);
+            if (netsnmp_query_get(vb, ss) != SNMP_ERR_NOERROR) {
+                snmp_free_var(vb);
+                vb = NULL;
+            }
+        }
+        if (!vb) {
+            var[tbllen] = st->stat;
+            snmp_varlist_add_variable(&vb, var, len, ASN_NULL, NULL, 0);
+            if (netsnmp_query_get(vb, ss) != SNMP_ERR_NOERROR) {
+                snmp_free_var(vb);
+                vb = NULL;
+            }
+        }
+        if (vb) {
+            if (vb->type == ASN_COUNTER) {
+                if (*vb->val.integer > 0 || sflag == 1)
+                    printf("%14lu %s\n", *vb->val.integer, st->str);
+            } else if (vb->type == ASN_COUNTER64) {
+                char            a64buf[I64CHARSZ + 1];
+                printU64(a64buf, vb->val.counter64);
+                if (strcmp(a64buf, "0") != 0 || sflag == 1)
+                    printf("%14s %s\n", a64buf, st->str);
+            } else
+                printf("%14s %s\n", "-", st->str);
+            snmp_free_varbind(vb);
+        } else {
+            printf("%14s %s\n", "-", st->str);
+        }
+        st++;
     }
 }
 
 static void
-prhisto(const char *name, const oid *var, size_t len, int ver, codelist_t *cs)
+prhisto(const char *name, const oid * var, size_t len, int ver,
+        codelist_t * cs)
 {
     netsnmp_variable_list *vb = NULL, *vp;
-    codelist_t *cp;
-    int code;
-    char nocode[32];
-
-    snmp_varlist_add_variable( &vb, var, len, ASN_NULL, NULL,  0);
-    if (netsnmp_query_walk( vb, ss ) != SNMP_ERR_NOERROR) {
-	snmp_free_var( vb );
-	return;
+    codelist_t     *cp;
+    int             code;
+    char            nocode[32];
+
+    snmp_varlist_add_variable(&vb, var, len, ASN_NULL, NULL, 0);
+    if (netsnmp_query_walk(vb, ss) != SNMP_ERR_NOERROR) {
+        snmp_free_var(vb);
+        return;
     }
     printf("     %s histogram:\n", name);
     printf("     %10s %10s %s\n", "input", "output", "type");
     for (code = 0; code < 256; code++) {
-	unsigned long inp = 0, out = 0;
-	int found = 0;
-	vp = vb;
-	while (vp && found != 2) {
-	    if (vp->name[11] == code && vp->name[10] == ver) {
-		if (vp->name[9] == 3) inp = *vp->val.integer;
-		else out = *vp->val.integer;
-		found++;
-	    }
-	    vp = vp->next_variable;
-	}
-	if (found) {
-	    cp = cs;
-	    while (cp->name && cp->code != code) cp++;
-	    if (inp || out || sflag == 1) {
-		if (!cp->code)
-		    snprintf(nocode, sizeof nocode, "type %d", code);
-		printf("     %10lu %10lu %s\n", inp, out, cp->name ? cp->name : nocode);
-	    }
-	}
+        unsigned long   inp = 0, out = 0;
+        int             found = 0;
+        vp = vb;
+        while (vp && found != 2) {
+            if (vp->name[11] == code && vp->name[10] == ver) {
+                if (vp->name[9] == 3)
+                    inp = *vp->val.integer;
+                else
+                    out = *vp->val.integer;
+                found++;
+            }
+            vp = vp->next_variable;
+        }
+        if (found) {
+            cp = cs;
+            while (cp->name && cp->code != code)
+                cp++;
+            if (inp || out || sflag == 1) {
+                if (!cp->code)
+                    snprintf(nocode, sizeof nocode, "type %d", code);
+                printf("     %10lu %10lu %s\n", inp, out,
+                       cp->name ? cp->name : nocode);
+            }
+        }
     }
     snmp_free_varbind(vb);
 }
@@ -519,39 +537,43 @@ prhisto(const char *name, const oid *var
 void
 ipx_stats(const char *name)
 {
-    oid ipsysstat_oid[] = { 1, 3, 6, 1, 2, 1, 4, 31, 1, 1 };
-    size_t ipsysstat_len = sizeof(ipsysstat_oid) / sizeof(ipsysstat_oid[0]);
-    static int first = 1;
+    oid             ipsysstat_oid[] = { 1, 3, 6, 1, 2, 1, 4, 31, 1, 1 };
+    size_t          ipsysstat_len =
+        sizeof(ipsysstat_oid) / sizeof(ipsysstat_oid[0]);
+    static int      first = 1;
 
-    if (!first) return;
+    if (!first)
+        return;
     first = 0;
 
     if (!name || strcmp(name, "ip") == 0)
-	statsprint("ip", systemstats, 1, ipsysstat_oid, ipsysstat_len);
+        statsprint("ip", systemstats, 1, ipsysstat_oid, ipsysstat_len);
     if (!name || strcmp(name, "ip6") == 0)
-	statsprint("ip6", systemstats, 2, ipsysstat_oid, ipsysstat_len);
+        statsprint("ip6", systemstats, 2, ipsysstat_oid, ipsysstat_len);
 }
 
 void
 icmpx_stats(const char *name)
 {
-    oid icmpstat_oid[] = { 1, 3, 6, 1, 2, 1, 5, 29, 1 };
-    size_t icmpstat_len = sizeof(icmpstat_oid) / sizeof(icmpstat_oid[0]);
-    oid icmpmsg_oid[] = { 1, 3, 6, 1, 2, 1, 5, 30, 1 };
-    size_t icmpmsg_len = sizeof(icmpmsg_oid) / sizeof(icmpmsg_oid[0]);
-    static int first = 1;
+    oid             icmpstat_oid[] = { 1, 3, 6, 1, 2, 1, 5, 29, 1 };
+    size_t          icmpstat_len =
+        sizeof(icmpstat_oid) / sizeof(icmpstat_oid[0]);
+    oid             icmpmsg_oid[] = { 1, 3, 6, 1, 2, 1, 5, 30, 1 };
+    size_t          icmpmsg_len =
+        sizeof(icmpmsg_oid) / sizeof(icmpmsg_oid[0]);
+    static int      first = 1;
 
     if (!first)
-	return;
+        return;
     first = 0;
 
     if (!name || strcmp(name, "icmp") == 0) {
-	statsprint("icmp", icmpstats, 1, icmpstat_oid, icmpstat_len);
-	prhisto("icmp", icmpmsg_oid, icmpmsg_len, 1, icmpcodes);
+        statsprint("icmp", icmpstats, 1, icmpstat_oid, icmpstat_len);
+        prhisto("icmp", icmpmsg_oid, icmpmsg_len, 1, icmpcodes);
     }
     if (!name || strcmp(name, "icmp6") == 0) {
-	statsprint("icmp6", icmpstats, 2, icmpstat_oid, icmpstat_len);
-	prhisto("icmp6", icmpmsg_oid, icmpmsg_len, 2, icmp6codes);
+        statsprint("icmp6", icmpstats, 2, icmpstat_oid, icmpstat_len);
+        prhisto("icmp6", icmpmsg_oid, icmpmsg_len, 2, icmp6codes);
     }
 }
 
@@ -559,17 +581,17 @@ icmpx_stats(const char *name)
 static void
 unknownprint(void)
 {
-    char line[80], *cp;
-    int width = 27;
+    char            line[80], *cp;
+    int             width = 27;
 
     if (vflag)
-	snprintf(line, sizeof line, "%s.", "*");
+        snprintf(line, sizeof line, "%s.", "*");
     else
-	snprintf(line, sizeof line, "%.*s.", width-9, "*");
+        snprintf(line, sizeof line, "%.*s.", width - 9, "*");
     cp = strchr(line, '\0');
     snprintf(cp, line + sizeof line - cp, vflag ? "%s" : "%.8s", "*");
     if (vflag && width < strlen(line))
-	width = strlen(line);
+        width = strlen(line);
     printf(" %-*.*s", width, width, line);
 }
 
@@ -579,14 +601,17 @@ unknownprint(void)
  */
 
 void
-inetxprint(int proto, struct sockaddr_in6 in6, int port, const char *name, int local)
+inetxprint(int proto, struct sockaddr_in6 in6, int port, const char *name,
+           int local)
 {
 
-	if (proto == 2)
-	    inet6print((u_char *)&in6.sin6_addr.s6_addr, port, name, local);
-	else if (proto == 1)
-	    inetprint((struct in_addr *)&in6.sin6_addr.s6_addr, port, name, local);
-	else if (proto == 0)
-	    unknownprint();
-	else abort();
+    if (proto == 2)
+        inet6print(&in6.sin6_addr, port, name, local);
+    else if (proto == 1)
+        inetprint((struct in_addr *) &in6.sin6_addr.s6_addr, port, name,
+                  local);
+    else if (proto == 0)
+        unknownprint();
+    else
+        abort();
 }
diff -urpN net-snmp-5.8/apps/snmpnetstat/main.c net-snmp-5.9.1/apps/snmpnetstat/main.c
--- net-snmp-5.8/apps/snmpnetstat/main.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpnetstat/main.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,9 +1,13 @@
-/*	$OpenBSD: main.c,v 1.52 2005/02/10 14:25:08 itojun Exp $	*/
-/*	$NetBSD: main.c,v 1.9 1996/05/07 02:55:02 thorpej Exp $	*/
+/*
+ * $OpenBSD: main.c,v 1.52 2005/02/10 14:25:08 itojun Exp $
+ */
+/*
+ * $NetBSD: main.c,v 1.9 1996/05/07 02:55:02 thorpej Exp $
+ */
 
 /*
  * Copyright (c) 1983, 1988, 1993
- *	Regents of the University of California.  All rights reserved.
+ *      Regents of the University of California.  All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
  * modification, are permitted provided that the following conditions
@@ -31,25 +35,17 @@
  */
 
 #ifndef lint
-char copyright[] =
-    "@(#) Copyright (c) 1983, 1988, 1993\n\
+char            copyright[] = "@(#) Copyright (c) 1983, 1988, 1993\n\
 	Regents of the University of California.  All rights reserved.\n";
-#endif /* not lint */
-
-#ifdef  INHERITED_CODE
-#ifndef lint
-#if 0
-static char sccsid[] = "from: @(#)main.c	8.4 (Berkeley) 3/1/94";
-#else
-static char *rcsid = "$OpenBSD: main.c,v 1.52 2005/02/10 14:25:08 itojun Exp $";
-#endif
-#endif /* not lint */
-#endif
+#endif                          /* not lint */
 
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/utilities.h>
 
+#if HAVE_UNISTD_H
+#include <unistd.h>
+#endif
 #if HAVE_NETDB_H
 #include <netdb.h>
 #endif
@@ -61,92 +57,100 @@ static char *rcsid = "$OpenBSD: main.c,v
 #include "winstub.h"
 #endif
 
-int	aflag;		/* show all sockets (including servers) */
-int	bflag;		/* show bytes instead of packets */
-int	dflag;		/* show i/f dropped packets */
-int	gflag;		/* show group (multicast) routing or stats */
-int	iflag;		/* show interfaces */
-int	lflag;		/* show routing table with use and ref */
-int	Lflag;		/* Legacy mibs */
-int	mflag;		/* show memory stats */
-int	nflag;		/* show addresses numerically */
-int	oflag;		/* Open/Net-BSD style octet output */
-int	pflag;		/* show given protocol */
-int	qflag;		/* only display non-zero values for output */
-int	rflag;		/* show routing tables (or routing stats) */
-int	Sflag;		/* show source address in routing table */
-int	sflag;		/* show protocol statistics */
-int	tflag;		/* show i/f watchdog timers */
-int	vflag;		/* be verbose */
-
-
-int	interval;	/* repeat interval for i/f stats */
-char	*intrface;	/* desired i/f for stats, or NULL for all i/fs */
-int	af;		/* address family */
-int     max_getbulk = 32;  /* specifies the max-repeaters value to use with GETBULK requests */
+int             aflag;          /* show all sockets (including servers) */
+int             bflag;          /* show bytes instead of packets */
+int             dflag;          /* show i/f dropped packets */
+int             gflag;          /* show group (multicast) routing or stats */
+int             iflag;          /* show interfaces */
+int             lflag;          /* show routing table with use and ref */
+int             Lflag;          /* Legacy mibs */
+int             mflag;          /* show memory stats */
+int             nflag;          /* show addresses numerically */
+int             oflag;          /* Open/Net-BSD style octet output */
+int             pflag;          /* show given protocol */
+int             qflag;          /* only display non-zero values for output */
+int             rflag;          /* show routing tables (or routing stats) */
+int             Sflag;          /* show source address in routing table */
+int             sflag;          /* show protocol statistics */
+int             tflag;          /* show i/f watchdog timers */
+int             vflag;          /* be verbose */
+
+
+int             interval;       /* repeat interval for i/f stats */
+char           *intrface;       /* desired i/f for stats, or NULL for all i/fs */
+int             af;             /* address family */
+int             max_getbulk = 32;       /* specifies the max-repeaters value to use with GETBULK requests */
 
-char    *progname = NULL;
-const char *pname;
+char           *progname = NULL;
+const char     *pname;
 /*
  * struct nlist nl[] - Omitted
  */
 
-typedef void (stringfun)(const char*);
+typedef void    (stringfun) (const char *);
 
 struct protox {
-    /* pr_index/pr_sindex - Omitted */
-    int		pr_wanted;	/* 1 if wanted, 0 otherwise */
-    stringfun	*pr_cblocks;	/* control blocks printing routine */
-    stringfun	*pr_stats;	/* statistics printing routine */
-    const char	*pr_name;	/* well-known name */
+    /*
+     * pr_index/pr_sindex - Omitted
+     */
+    int             pr_wanted;  /* 1 if wanted, 0 otherwise */
+    stringfun      *pr_cblocks; /* control blocks printing routine */
+    stringfun      *pr_stats;   /* statistics printing routine */
+    const char     *pr_name;    /* well-known name */
 };
 
-struct protox protox[] = {
-    { 1,	tcpprotopr,	tcp_stats,	"tcp" },
-    { 1,	udpprotopr,	udp_stats,	"udp" },
-
-    { 1,	(stringfun*)0,	ip_stats,	"ip" },	/* protopr Omitted */
-    { 1,	(stringfun*)0,	icmp_stats,	"icmp" },
-    /* igmp/ah/esp/ipencap/etherip/ipcomp/carp/pfsync/pim - Omitted */
-    { 0,	(stringfun*)0,	(stringfun*)0,	NULL }
+struct protox   protox[] = {
+    {1, tcpprotopr, tcp_stats, "tcp"},
+    {1, udpprotopr, udp_stats, "udp"},
+
+    {1, (stringfun *) 0, ip_stats, "ip"},       /* protopr Omitted */
+    {1, (stringfun *) 0, icmp_stats, "icmp"},
+    /*
+     * igmp/ah/esp/ipencap/etherip/ipcomp/carp/pfsync/pim - Omitted
+     */
+    {0, (stringfun *) 0, (stringfun *) 0, NULL}
 };
 
-struct protox ip6protox[] = {
-    { 1,	tcp6protopr,	(stringfun*)0,	"tcp6" },
-    { 1,	udp6protopr,	(stringfun*)0,	"udp6" },
-
-    { 1,	(stringfun*)0,	ip6_stats,	"ip6" },/* ip6protopr Omitted */
-    { 1,	(stringfun*)0,	icmp6_stats,	"icmp6" },
-    /* pim6/rip6 - Omitted */
-    { 0,	(stringfun*)0,	(stringfun*)0,	NULL }
+struct protox   ip6protox[] = {
+    {1, tcp6protopr, (stringfun *) 0, "tcp6"},
+    {1, udp6protopr, (stringfun *) 0, "udp6"},
+
+    {1, (stringfun *) 0, ip6_stats, "ip6"},     /* ip6protopr Omitted */
+    {1, (stringfun *) 0, icmp6_stats, "icmp6"},
+    /*
+     * pim6/rip6 - Omitted
+     */
+    {0, (stringfun *) 0, (stringfun *) 0, NULL}
 };
 
-struct protox ipxprotox[] = {
-    { 1,	tcpxprotopr,	tcp_stats,	"tcp" },
-    { 1,	udpxprotopr,	udp_stats,	"udp" },
-    { 1,	(stringfun*)0,	ipx_stats,	"ip" },/* ip6protopr Omitted */
-    { 1,	(stringfun*)0,	ipx_stats,	"ip6" },/* ip6protopr Omitted */
-    { 1,	(stringfun*)0,	icmpx_stats,	"icmp" },
-    { 1,	(stringfun*)0,	icmpx_stats,	"icmp6" },
-    { 0,	(stringfun*)0,	(stringfun*)0,	NULL }
+struct protox   ipxprotox[] = {
+    {1, tcpxprotopr, tcp_stats, "tcp"},
+    {1, udpxprotopr, udp_stats, "udp"},
+    {1, (stringfun *) 0, ipx_stats, "ip"},      /* ip6protopr Omitted */
+    {1, (stringfun *) 0, ipx_stats, "ip6"},     /* ip6protopr Omitted */
+    {1, (stringfun *) 0, icmpx_stats, "icmp"},
+    {1, (stringfun *) 0, icmpx_stats, "icmp6"},
+    {0, (stringfun *) 0, (stringfun *) 0, NULL}
 };
 
-/* {ipx,ns,atalk}protox Omitted */
+/*
+ * {ipx,ns,atalk}protox Omitted
+ */
 
-struct protox *protoprotox[] = {
+struct protox  *protoprotox[] = {
     protox, ip6protox, NULL
 };
 
-static void printproto(struct protox *, const char *);
-static void usage(void);
+static void     printproto(struct protox *, const char *);
+static void     usage(void);
 static struct protox *name2protox(const char *);
 static struct protox *knownname(const char *);
 
 netsnmp_session *ss;
-struct protox *tp = NULL; /* for printing cblocks & stats */
+struct protox  *tp = NULL;      /* for printing cblocks & stats */
 
 static void
-optProc( int argc, char *const *argv, int opt )
+optProc(int argc, char *const *argv, int opt)
 {
     switch (opt) {
     case 'C':
@@ -169,23 +173,23 @@ optProc( int argc, char *const *argv, in
                 else if (strcmp(optarg, "inet6") == 0)
                     af = AF_INET6;
                 /*
-                  else if (strcmp(optarg, "local") == 0)
-                  af = AF_LOCAL;
-                  else if (strcmp(optarg, "unix") == 0)
-                  af = AF_UNIX;
-                  else if (strcmp(optarg, "ipx") == 0)
-                  af = AF_IPX;
-                  else if (strcmp(optarg, "ns") == 0)
-                  af = AF_NS;
-                  else if (strcmp(optarg, "encap") == 0)
-                  af = PF_KEY;
-                  else if (strcmp(optarg, "atalk") == 0)
-                  af = AF_APPLETALK;
-                */
+                 * else if (strcmp(optarg, "local") == 0)
+                 * af = AF_LOCAL;
+                 * else if (strcmp(optarg, "unix") == 0)
+                 * af = AF_UNIX;
+                 * else if (strcmp(optarg, "ipx") == 0)
+                 * af = AF_IPX;
+                 * else if (strcmp(optarg, "ns") == 0)
+                 * af = AF_NS;
+                 * else if (strcmp(optarg, "encap") == 0)
+                 * af = PF_KEY;
+                 * else if (strcmp(optarg, "atalk") == 0)
+                 * af = AF_APPLETALK;
+                 */
                 else {
-                    (void)fprintf(stderr,
-                                  "%s: %s: unknown address family\n",
-                                  progname, optarg);
+                    (void) fprintf(stderr,
+                                   "%s: %s: unknown address family\n",
+                                   progname, optarg);
                     exit(1);
                 }
                 return;
@@ -204,49 +208,56 @@ optProc( int argc, char *const *argv, in
             case 'L':
                 Lflag = 1;
                 break;
-                /*  case 'L':		FreeBSD: Display listen queue lengths
-                    NetBSD:  Suppress link-level routes */
-                /*	case 'l':		OpenBSD: Wider IPv6 display
-                        Linux:   Listening sockets only
-			lflag = 1;
-			break;
-                        case 'M':		*BSD:    Memory image
-                        Linux:   Masqueraded connections
-			memf = optarg;
-			break;
-                */
+                /*
+                 * case 'L':            FreeBSD: Display listen queue lengths
+                 * NetBSD:  Suppress link-level routes
+                 */
+                /*
+                 * case 'l':            OpenBSD: Wider IPv6 display
+                 * Linux:   Listening sockets only
+                 * lflag = 1;
+                 * break;
+                 * case 'M':            *BSD:    Memory image
+                 * Linux:   Masqueraded connections
+                 * memf = optarg;
+                 * break;
+                 */
             case 'm':
                 mflag = 1;
                 break;
-                /*	case 'N':		*BSD:    Kernel image
-			nlistf = optarg;
-			break;
-                */
+                /*
+                 * case 'N':            *BSD:    Kernel image
+                 * nlistf = optarg;
+                 * break;
+                 */
             case 'n':
                 nflag = 1;
                 break;
             case 'o':
                 oflag = 1;
                 break;
-                /*  case 'P':		NetBSD:
-                    OpenBSD: dump PCB block */
+                /*
+                 * case 'P':            NetBSD:
+                 * OpenBSD: dump PCB block
+                 */
             case 'p':
                 if (!*optarg)
                     optarg = argv[optind++];
                 if ((tp = name2protox(optarg)) == NULL) {
-                    (void)fprintf(stderr,
-                                  "%s: %s: unknown protocol\n",
-                                  progname, optarg);
+                    (void) fprintf(stderr,
+                                   "%s: %s: unknown protocol\n",
+                                   progname, optarg);
                     exit(1);
                 }
                 pflag = 1;
                 pname = tp->pr_name;
                 return;
-                /*	case 'q':		NetBSD:  IRQ information
-                        OpenBSD: Suppress inactive I/Fs
-			qflag = 1;
-			break;
-                */
+                /*
+                 * case 'q':            NetBSD:  IRQ information
+                 * OpenBSD: Suppress inactive I/Fs
+                 * qflag = 1;
+                 * break;
+                 */
             case 'r':
                 rflag = 1;
                 break;
@@ -268,22 +279,23 @@ optProc( int argc, char *const *argv, in
                 }
                 optind++;
                 break;
-            case 'S':	     /* FreeBSD:
-                                NetBSD:  Semi-numeric display
-                                OpenBSD: Show route source selector */
+            case 'S':          /* FreeBSD:
+                                 * NetBSD:  Semi-numeric display
+                                 * OpenBSD: Show route source selector */
                 Sflag = 1;
                 break;
             case 's':
                 ++sflag;
                 break;
-                /*	case 't':		FreeBSD:
-                        OpenBSD: Display watchdog timers
-			tflag = 1;
-			break;
-                        case 'u':		OpenBSD: unix sockets only
-			af = AF_UNIX;
-			break;
-                */
+                /*
+                 * case 't':            FreeBSD:
+                 * OpenBSD: Display watchdog timers
+                 * tflag = 1;
+                 * break;
+                 * case 'u':            OpenBSD: unix sockets only
+                 * af = AF_UNIX;
+                 * break;
+                 */
             case 'v':
                 vflag = 1;
                 break;
@@ -299,21 +311,21 @@ optProc( int argc, char *const *argv, in
                 exit(1);
             }
         }
-        break;   /* End of '-Cx' switch */
+        break;                  /* End of '-Cx' switch */
 
         /*
          *  Backward compatability for the main display modes
          *    (where this doesn't clash with standard SNMP flags)
          */
     case 'i':
-	iflag = 1;
-	break;
+        iflag = 1;
+        break;
     case 'R':
-	rflag = 1;    /* -r sets the retry count */
-	break;
+        rflag = 1;              /* -r sets the retry count */
+        break;
     case 's':
-	++sflag;
-	break;
+        ++sflag;
+        break;
     }
 }
 
@@ -322,19 +334,19 @@ main(int argc, char *argv[])
 {
     netsnmp_session session;
     struct protoent *p;
-    char *cp;
-    int exit_code = 1;
+    char           *cp;
+    int             exit_code = 1;
 
     SOCK_STARTUP;
 
     af = AF_UNSPEC;
-    cp = strrchr( argv[0], '/' );
+    cp = strrchr(argv[0], '/');
     if (cp)
-        progname = cp+1;
+        progname = cp + 1;
     else
         progname = argv[0];
 
-    switch (snmp_parse_args( argc, argv, &session, "C:iRs", optProc)) {
+    switch (snmp_parse_args(argc, argv, &session, "C:iRs", optProc)) {
     case NETSNMP_PARSE_ARGS_ERROR:
         goto out;
     case NETSNMP_PARSE_ARGS_SUCCESS_EXIT:
@@ -375,9 +387,9 @@ main(int argc, char *argv[])
 #if 0
     if (mflag) {
         /*
-          mbpr(nl[N_MBSTAT].n_value, nl[N_MBPOOL].n_value,
-          nl[N_MCLPOOL].n_value);
-        */
+         * mbpr(nl[N_MBSTAT].n_value, nl[N_MBPOOL].n_value,
+         * nl[N_MCLPOOL].n_value);
+         */
         exit_code = 0;
         goto out;
     }
@@ -400,52 +412,55 @@ main(int argc, char *argv[])
     }
     if (rflag) {
         /*
-          if (sflag)
-          rt_stats();
-          else
-        */
+         * if (sflag)
+         * rt_stats();
+         * else
+         */
         if (Lflag || routexpr(af) == 0) {
-            if (route4pr(af) == 0 && af == AF_INET) routepr();
+            if (route4pr(af) == 0 && af == AF_INET)
+                routepr();
             route6pr(af);
         }
         exit_code = 0;
         goto out;
     }
     /*
-      if (gflag) {
-      if (sflag) {
-      if (af == AF_INET || af == AF_UNSPEC)
-      mrt_stats(nl[N_MRTPROTO].n_value,
-      nl[N_MRTSTAT].n_value);
-      #ifdef NETSNMP_ENABLE_IPV6
-      if (af == AF_INET6 || af == AF_UNSPEC)
-      mrt6_stats(nl[N_MRT6PROTO].n_value,
-      nl[N_MRT6STAT].n_value);
-      #endif
-      }
-      else {
-      if (af == AF_INET || af == AF_UNSPEC)
-      mroutepr(nl[N_MRTPROTO].n_value,
-      nl[N_MFCHASHTBL].n_value,
-      nl[N_MFCHASH].n_value,
-      nl[N_VIFTABLE].n_value);
-      #ifdef NETSNMP_ENABLE_IPV6
-      if (af == AF_INET6 || af == AF_UNSPEC)
-      mroute6pr(nl[N_MRT6PROTO].n_value,
-      nl[N_MF6CTABLE].n_value,
-      nl[N_MIF6TABLE].n_value);
-      #endif
-      }
-      exit_code = 0;
-      goto out;
-      }
-    */
+     * if (gflag) {
+     * if (sflag) {
+     * if (af == AF_INET || af == AF_UNSPEC)
+     * mrt_stats(nl[N_MRTPROTO].n_value,
+     * nl[N_MRTSTAT].n_value);
+     * #ifdef NETSNMP_ENABLE_IPV6
+     * if (af == AF_INET6 || af == AF_UNSPEC)
+     * mrt6_stats(nl[N_MRT6PROTO].n_value,
+     * nl[N_MRT6STAT].n_value);
+     * #endif
+     * }
+     * else {
+     * if (af == AF_INET || af == AF_UNSPEC)
+     * mroutepr(nl[N_MRTPROTO].n_value,
+     * nl[N_MFCHASHTBL].n_value,
+     * nl[N_MFCHASH].n_value,
+     * nl[N_VIFTABLE].n_value);
+     * #ifdef NETSNMP_ENABLE_IPV6
+     * if (af == AF_INET6 || af == AF_UNSPEC)
+     * mroute6pr(nl[N_MRT6PROTO].n_value,
+     * nl[N_MF6CTABLE].n_value,
+     * nl[N_MIF6TABLE].n_value);
+     * #endif
+     * }
+     * exit_code = 0;
+     * goto out;
+     * }
+     */
     setservent(1);
     if (Lflag) {
         switch (af) {
         case AF_UNSPEC:
             setprotoent(1);
-            /* ugh, this is O(MN) ... why do we do this? */
+            /*
+             * ugh, this is O(MN) ... why do we do this?
+             */
             while ((p = getprotoent())) {
                 for (tp = protox; tp->pr_name; tp++)
                     if (strcmp(tp->pr_name, p->p_name) == 0)
@@ -457,34 +472,35 @@ main(int argc, char *argv[])
         case AF_INET:
             for (tp = protox; tp->pr_name; tp++)
                 printproto(tp, tp->pr_name);
-	    /* FALL THROUGH */
+            /*
+             * FALL THROUGH
+             */
         case AF_INET6:
             for (tp = ip6protox; tp->pr_name; tp++)
                 printproto(tp, tp->pr_name);
         }
-    }
-    else {
+    } else {
         for (tp = ipxprotox; tp->pr_name; tp++)
-            if (!pname || strcmp(pname,tp->pr_name) == 0)
+            if (!pname || strcmp(pname, tp->pr_name) == 0)
                 printproto(tp, pname);
     }
     /*
-      if (af == AF_IPX || af == AF_UNSPEC)
-      for (tp = ipxprotox; tp->pr_name; tp++)
-      printproto(tp, tp->pr_name);
-      if (af == AF_NS || af == AF_UNSPEC)
-      for (tp = nsprotox; tp->pr_name; tp++)
-      printproto(tp, tp->pr_name);
-      if ((af == AF_UNIX || af == AF_UNSPEC) && !sflag)
-      unixpr(nl[N_UNIXSW].n_value);
-      if (af == AF_APPLETALK || af == AF_UNSPEC)
-      for (tp = atalkprotox; tp->pr_name; tp++)
-      printproto(tp, tp->pr_name);
-    */
+     * if (af == AF_IPX || af == AF_UNSPEC)
+     * for (tp = ipxprotox; tp->pr_name; tp++)
+     * printproto(tp, tp->pr_name);
+     * if (af == AF_NS || af == AF_UNSPEC)
+     * for (tp = nsprotox; tp->pr_name; tp++)
+     * printproto(tp, tp->pr_name);
+     * if ((af == AF_UNIX || af == AF_UNSPEC) && !sflag)
+     * unixpr(nl[N_UNIXSW].n_value);
+     * if (af == AF_APPLETALK || af == AF_UNSPEC)
+     * for (tp = atalkprotox; tp->pr_name; tp++)
+     * printproto(tp, tp->pr_name);
+     */
 
     exit_code = 0;
 
-out:
+  out:
     SOCK_CLEANUP;
     return exit_code;
 }
@@ -496,7 +512,7 @@ out:
 static void
 printproto(struct protox *tp, const char *name)
 {
-    void (*pr)(const char *);
+    void            (*pr)(const char *);
 
     if (sflag) {
         pr = tp->pr_stats;
@@ -504,14 +520,14 @@ printproto(struct protox *tp, const char
         pr = tp->pr_cblocks;
     }
     if (pr != NULL)
-        (*pr)(name);
+        (*pr) (name);
 }
 
 /*
  * Read kernel memory - Omitted
  */
 
-const char *
+const char     *
 plural(int n)
 {
     return (n != 1 ? "s" : "");
@@ -538,8 +554,8 @@ knownname(const char *name)
 static struct protox *
 name2protox(const char *name)
 {
-    struct protox *tp;
-    char **alias;			/* alias from p->aliases */
+    struct protox  *tp;
+    char          **alias;      /* alias from p->aliases */
     struct protoent *p;
 
     /*
@@ -549,9 +565,11 @@ name2protox(const char *name)
     if ((tp = knownname(name)))
         return (tp);
 
-    setprotoent(1);			/* make protocol lookup cheaper */
+    setprotoent(1);             /* make protocol lookup cheaper */
     while ((p = getprotoent())) {
-        /* netsnmp_assert: name not same as p->name */
+        /*
+         * netsnmp_assert: name not same as p->name
+         */
         for (alias = p->p_aliases; *alias; alias++)
             if (strcmp(name, *alias) == 0) {
                 endprotoent();
@@ -565,12 +583,16 @@ name2protox(const char *name)
 static void
 usage(void)
 {
-    (void)fprintf(stderr,
-                  "usage: %s [snmp_opts] [-Canv] [-Cf address_family]\n", progname);
-    (void)fprintf(stderr,
-                  "       %s [snmp_opts] [-Cibodnv] [-CI interface] [-Cw wait]\n", progname);
-    (void)fprintf(stderr,
-                  "       %s [snmp_opts] [-Cs[s]] [-Cp protocol]\n", progname);
-    (void)fprintf(stderr,
-                  "       %s [snmp_opts] [-Crnv] [-Cf address_family]\n", progname);
+    (void) fprintf(stderr,
+                   "usage: %s [snmp_opts] [-Canv] [-Cf address_family]\n",
+                   progname);
+    (void) fprintf(stderr,
+                   "       %s [snmp_opts] [-Cibodnv] [-CI interface] [-Cw wait]\n",
+                   progname);
+    (void) fprintf(stderr,
+                   "       %s [snmp_opts] [-Cs[s]] [-Cp protocol]\n",
+                   progname);
+    (void) fprintf(stderr,
+                   "       %s [snmp_opts] [-Crnv] [-Cf address_family]\n",
+                   progname);
 }
diff -urpN net-snmp-5.8/apps/snmpnetstat/main.h net-snmp-5.9.1/apps/snmpnetstat/main.h
--- net-snmp-5.8/apps/snmpnetstat/main.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpnetstat/main.h	2021-05-26 05:19:35.000000000 +0700
@@ -3,16 +3,16 @@
 #define MAXHOSTNAMELEN	64
 #endif
 
-extern  netsnmp_session *ss;
+extern netsnmp_session *ss;
 NETSNMP_IMPORT
-int netsnmp_query_get(    netsnmp_variable_list *list,
-                          netsnmp_session       *session);
+    int netsnmp_query_get(netsnmp_variable_list * list,
+                          netsnmp_session *session);
 NETSNMP_IMPORT
-int netsnmp_query_getnext(netsnmp_variable_list *list,
-                          netsnmp_session       *session);
+    int netsnmp_query_getnext(netsnmp_variable_list * list,
+                              netsnmp_session *session);
 NETSNMP_IMPORT
-int netsnmp_query_walk(   netsnmp_variable_list *list,
-                          netsnmp_session       *session);
+    int netsnmp_query_walk(netsnmp_variable_list * list,
+                           netsnmp_session *session);
 
 #ifndef AF_INET6
 #define AF_INET6	10
diff -urpN net-snmp-5.8/apps/snmpnetstat/netstat.h net-snmp-5.9.1/apps/snmpnetstat/netstat.h
--- net-snmp-5.8/apps/snmpnetstat/netstat.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpnetstat/netstat.h	2021-05-26 05:19:35.000000000 +0700
@@ -1,9 +1,13 @@
-/*	$OpenBSD: netstat.h,v 1.31 2005/02/10 14:25:08 itojun Exp $	*/
-/*	$NetBSD: netstat.h,v 1.6 1996/05/07 02:55:05 thorpej Exp $	*/
+/*
+ * $OpenBSD: netstat.h,v 1.31 2005/02/10 14:25:08 itojun Exp $
+ */
+/*
+ * $NetBSD: netstat.h,v 1.6 1996/05/07 02:55:05 thorpej Exp $
+ */
 
 /*
  * Copyright (c) 1992, 1993
- *	Regents of the University of California.  All rights reserved.
+ *      Regents of the University of California.  All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
  * modification, are permitted provided that the following conditions
@@ -29,77 +33,80 @@
  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
  * SUCH DAMAGE.
  *
- *	from: @(#)netstat.h	8.2 (Berkeley) 1/4/94
+ *      from: @(#)netstat.h     8.2 (Berkeley) 1/4/94
  */
 
 #ifdef HAVE_SYS_CDEFS_H
 #include <sys/cdefs.h>
 #endif
 
-/* What is the max length of a pointer printed with %p (including 0x)? */
+/*
+ * What is the max length of a pointer printed with %p (including 0x)?
+ */
 #define PLEN	(LONG_BIT / 4 + 2)
 
-extern int	aflag;		/* show all sockets (including servers) */
-extern int	bflag;		/* show bytes instead of packets */
-extern int	dflag;		/* show i/f dropped packets */
-extern int	gflag;		/* show group (multicast) routing or stats */
-extern int	iflag;		/* show interfaces */
-extern int	lflag;		/* show routing table with use and ref */
-extern int	Lflag;		/* Legacy mibs */
-extern int	mflag;		/* show memory stats */
-extern int	nflag;		/* show addresses numerically */
-extern int	oflag;		/* Open/Net-BSD style octet output */
-extern int	pflag;		/* show given protocol */
-extern int	qflag;		/* only display non-zero values for output */
-extern int	rflag;		/* show routing tables (or routing stats) */
-extern int	Sflag;		/* show source address in routing table */
-extern int	sflag;		/* show protocol statistics */
-extern int	tflag;		/* show i/f watchdog timers */
-extern int	vflag;		/* be verbose */
-
-extern int	interval;	/* repeat interval for i/f stats */
-
-extern char	*intrface;	/* desired i/f for stats, or NULL for all i/fs */
-
-extern int	af;		/* address family */
-extern int  max_getbulk;  /* specifies the max-repeaters value to use with GETBULK requests */
-
-extern	char *__progname; /* program name, from crt0.o */
-
-const char	*plural(int);
-
-void	tcpprotopr(const char *);
-void	udpprotopr(const char *);
-void	tcp_stats( const char *);
-void	udp_stats( const char *);
-void	ip_stats(  const char *);
-void	icmp_stats(const char *);
-
-void	tcp6protopr(const char *);
-void	udp6protopr(const char *);
-void	ip6_stats(  const char *);
-void	icmp6_stats(const char *);
-
-void	tcpxprotopr(const char *);
-void	udpxprotopr(const char *);
-void	listenxprotopr(const char *);
-void	ipx_stats(const char *);
-void	icmpx_stats(const char *);
-
-void	pr_rthdr(int);
-void	pr_encaphdr(void);
-void	pr_family(int);
-void	rt_stats(void);
-
-void    get_ifname(char *, int);
-char	*routename(in_addr_t);
-char	*netname(in_addr_t, in_addr_t);
-char	*ns_print(struct sockaddr *);
-void	routepr(void);
-int     route4pr(int);
-int     route6pr(int);
-int     routexpr(int);
-
-void	intpr(int);
-void	inetprint(struct in_addr *, int, const char *, int);
-void	inet6print(unsigned char *, int, const char *, int);
+extern int      aflag;          /* show all sockets (including servers) */
+extern int      bflag;          /* show bytes instead of packets */
+extern int      dflag;          /* show i/f dropped packets */
+extern int      gflag;          /* show group (multicast) routing or stats */
+extern int      iflag;          /* show interfaces */
+extern int      lflag;          /* show routing table with use and ref */
+extern int      Lflag;          /* Legacy mibs */
+extern int      mflag;          /* show memory stats */
+extern int      nflag;          /* show addresses numerically */
+extern int      oflag;          /* Open/Net-BSD style octet output */
+extern int      pflag;          /* show given protocol */
+extern int      qflag;          /* only display non-zero values for output */
+extern int      rflag;          /* show routing tables (or routing stats) */
+extern int      Sflag;          /* show source address in routing table */
+extern int      sflag;          /* show protocol statistics */
+extern int      tflag;          /* show i/f watchdog timers */
+extern int      vflag;          /* be verbose */
+
+extern int      interval;       /* repeat interval for i/f stats */
+
+extern char    *intrface;       /* desired i/f for stats, or NULL for all i/fs */
+
+extern int      af;             /* address family */
+extern int      max_getbulk;    /* specifies the max-repeaters value to use with GETBULK requests */
+
+extern char    *__progname;     /* program name, from crt0.o */
+
+const char     *plural(int);
+
+void            tcpprotopr(const char *);
+void            udpprotopr(const char *);
+void            tcp_stats(const char *);
+void            udp_stats(const char *);
+void            ip_stats(const char *);
+void            icmp_stats(const char *);
+
+void            tcp6protopr(const char *);
+void            udp6protopr(const char *);
+void            ip6_stats(const char *);
+void            icmp6_stats(const char *);
+
+void            tcpxprotopr(const char *);
+void            udpxprotopr(const char *);
+void            listenxprotopr(const char *);
+void            ipx_stats(const char *);
+void            icmpx_stats(const char *);
+
+void            pr_rthdr(int);
+void            pr_encaphdr(void);
+void            pr_family(int);
+void            rt_stats(void);
+
+void            get_ifname(char *, int);
+char           *routename(in_addr_t);
+char           *netname(in_addr_t, in_addr_t);
+char           *ns_print(struct sockaddr *);
+void            routepr(void);
+int             route4pr(int);
+int             route6pr(int);
+int             routexpr(int);
+
+void            intpr(int);
+void            inetprint(const struct in_addr *, int, const char *, int);
+void            inet6print(const struct in6_addr *, int, const char *,
+                           int);
diff -urpN net-snmp-5.8/apps/snmpnetstat/route.c net-snmp-5.9.1/apps/snmpnetstat/route.c
--- net-snmp-5.8/apps/snmpnetstat/route.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpnetstat/route.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,9 +1,13 @@
-/*	$OpenBSD: route.c,v 1.66 2004/11/17 01:47:20 itojun Exp $	*/
-/*	$NetBSD: route.c,v 1.15 1996/05/07 02:55:06 thorpej Exp $	*/
+/*
+ * $OpenBSD: route.c,v 1.66 2004/11/17 01:47:20 itojun Exp $
+ */
+/*
+ * $NetBSD: route.c,v 1.15 1996/05/07 02:55:06 thorpej Exp $
+ */
 
 /*
  * Copyright (c) 1983, 1988, 1993
- *	The Regents of the University of California.  All rights reserved.
+ *      The Regents of the University of California.  All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
  * modification, are permitted provided that the following conditions
@@ -30,16 +34,6 @@
  * SUCH DAMAGE.
  */
 
-#ifdef  INHERITED_CODE
-#ifndef lint
-#if 0
-static char sccsid[] = "from: @(#)route.c	8.3 (Berkeley) 3/9/94";
-#else
-static char *rcsid = "$OpenBSD: route.c,v 1.66 2004/11/17 01:47:20 itojun Exp $";
-#endif
-#endif /* not lint */
-#endif
-
 #include <net-snmp/net-snmp-config.h>
 
 #if HAVE_SYS_TYPES_H
@@ -92,7 +86,7 @@ struct route_entry {
     char            ifname[64];
 };
 
-void p_rtnode( struct route_entry *rp );
+void            p_rtnode(struct route_entry *rp);
 
 /*
  * Print routing tables.
@@ -100,80 +94,82 @@ void p_rtnode( struct route_entry *rp );
 void
 routepr(void)
 {
-    struct route_entry  route, *rp = &route;
-    oid    rtcol_oid[]  = { 1,3,6,1,2,1,4,21,1,0 };
-    size_t rtcol_len    = OID_LENGTH( rtcol_oid );
+    struct route_entry route, *rp = &route;
+    oid             rtcol_oid[] = { 1, 3, 6, 1, 2, 1, 4, 21, 1, 0 };
+    size_t          rtcol_len = OID_LENGTH(rtcol_oid);
     union {
-        in_addr_t addr;
-        char      data[4];
+        in_addr_t       addr;
+        char            data[4];
     } tmpAddr;
-    netsnmp_variable_list *var=NULL, *vp;
-    char  *cp;
-    
+    netsnmp_variable_list *var = NULL, *vp;
+    char           *cp;
+
     printf("Routing tables (ipRouteTable)\n");
     pr_rthdr(AF_INET);
 
 #define ADD_RTVAR( x ) rtcol_oid[ rtcol_len-1 ] = x; \
     snmp_varlist_add_variable( &var, rtcol_oid, rtcol_len, ASN_NULL, NULL,  0)
-    ADD_RTVAR( 2 );                 /* ipRouteIfIndex */
-    ADD_RTVAR( 7 );                 /* ipRouteNextHop */
-    ADD_RTVAR( 8 );                 /* ipRouteType    */
-    ADD_RTVAR( 9 );                 /* ipRouteProto   */
-    ADD_RTVAR( 11 );                /* ipRouteMask    */
+    ADD_RTVAR(2);               /* ipRouteIfIndex */
+    ADD_RTVAR(7);               /* ipRouteNextHop */
+    ADD_RTVAR(8);               /* ipRouteType    */
+    ADD_RTVAR(9);               /* ipRouteProto   */
+    ADD_RTVAR(11);              /* ipRouteMask    */
 #undef ADD_RTVAR
 
-        /*
-	 * Now walk the ipRouteTable, reporting the various route entries
-	 */
-    while ( 1 ) {
-        if (netsnmp_query_getnext( var, ss ) != SNMP_ERR_NOERROR)
+    /*
+     * Now walk the ipRouteTable, reporting the various route entries
+     */
+    while (1) {
+        if (netsnmp_query_getnext(var, ss) != SNMP_ERR_NOERROR)
             break;
-        rtcol_oid[ rtcol_len-1 ] = 2;	/* ifRouteIfIndex */
-        if ( snmp_oid_compare( rtcol_oid, rtcol_len,
-                               var->name, rtcol_len) != 0 )
-            break;    /* End of Table */
-	if (var->type == SNMP_NOSUCHOBJECT ||
-                var->type == SNMP_NOSUCHINSTANCE ||
-                var->type == SNMP_ENDOFMIBVIEW)
-	    break;
-        memset( &route, 0, sizeof( struct route_entry ));
-        /* Extract ipRouteDest index value */
+        rtcol_oid[rtcol_len - 1] = 2;   /* ifRouteIfIndex */
+        if (snmp_oid_compare(rtcol_oid, rtcol_len,
+                             var->name, rtcol_len) != 0)
+            break;              /* End of Table */
+        if (var->type == SNMP_NOSUCHOBJECT ||
+            var->type == SNMP_NOSUCHINSTANCE ||
+            var->type == SNMP_ENDOFMIBVIEW)
+            break;
+        memset(&route, 0, sizeof(struct route_entry));
+        /*
+         * Extract ipRouteDest index value
+         */
         cp = tmpAddr.data;
-        cp[0] = var->name[ 10 ] & 0xff;
-        cp[1] = var->name[ 11 ] & 0xff;
-        cp[2] = var->name[ 12 ] & 0xff;
-        cp[3] = var->name[ 13 ] & 0xff;
+        cp[0] = var->name[10] & 0xff;
+        cp[1] = var->name[11] & 0xff;
+        cp[2] = var->name[12] & 0xff;
+        cp[3] = var->name[13] & 0xff;
         rp->destination = tmpAddr.addr;
 
-        for ( vp=var; vp; vp=vp->next_variable ) {
-            switch ( vp->name[ 9 ] ) {
-            case 2:     /* ifRouteIfIndex */
-                rp->ifNumber  = *vp->val.integer;
+        for (vp = var; vp; vp = vp->next_variable) {
+            switch (vp->name[9]) {
+            case 2:            /* ifRouteIfIndex */
+                rp->ifNumber = *vp->val.integer;
                 rp->set_bits |= SET_IFNO;
                 break;
-            case 7:                 /* ipRouteNextHop */
+            case 7:            /* ipRouteNextHop */
                 memmove(&rp->gateway, vp->val.string, 4);
                 rp->set_bits |= SET_GWAY;
                 break;
-            case 8:                 /* ipRouteType    */
-                rp->type      = *vp->val.integer;
+            case 8:            /* ipRouteType    */
+                rp->type = *vp->val.integer;
                 rp->set_bits |= SET_TYPE;
                 break;
-            case 9:                 /* ipRouteProto   */
-                rp->proto     = *vp->val.integer;
+            case 9:            /* ipRouteProto   */
+                rp->proto = *vp->val.integer;
                 rp->set_bits |= SET_PRTO;
                 break;
-            case 11:                /* ipRouteMask    */
+            case 11:           /* ipRouteMask    */
                 memmove(&rp->mask, vp->val.string, 4);
                 rp->set_bits |= SET_MASK;
                 break;
             }
         }
         if (rp->set_bits != SET_ALL) {
-            continue;   /* Incomplete query */
+            continue;           /* Incomplete query */
         }
 
-        p_rtnode( rp );
+        p_rtnode(rp);
     }
 }
 
@@ -181,47 +177,47 @@ routepr(void)
 int
 route4pr(int af)
 {
-    struct route_entry  route, *rp = &route;
-    oid    rtcol_oid[]  = { 1,3,6,1,2,1,4,24,4,1,0 }; /* ipCidrRouteEntry */
-    size_t rtcol_len    = OID_LENGTH( rtcol_oid );
+    struct route_entry route, *rp = &route;
+    oid             rtcol_oid[] = { 1, 3, 6, 1, 2, 1, 4, 24, 4, 1, 0 }; /* ipCidrRouteEntry */
+    size_t          rtcol_len = OID_LENGTH(rtcol_oid);
     netsnmp_variable_list *var = NULL, *vp;
     union {
-        in_addr_t addr;
-        unsigned char data[4];
+        in_addr_t       addr;
+        unsigned char   data[4];
     } tmpAddr;
-    int printed = 0;
-    int hdr_af = AF_UNSPEC;
+    int             printed = 0;
+    int             hdr_af = AF_UNSPEC;
 
     if (af != AF_UNSPEC && af != AF_INET)
         return 0;
 
 #define ADD_RTVAR( x ) rtcol_oid[ rtcol_len-1 ] = x; \
     snmp_varlist_add_variable( &var, rtcol_oid, rtcol_len, ASN_NULL, NULL,  0)
-    ADD_RTVAR( 5 );                 /* ipCidrRouteIfIndex */
-    ADD_RTVAR( 6 );                 /* ipCidrRouteType    */
-    ADD_RTVAR( 7 );                 /* ipCidrRouteProto   */
+    ADD_RTVAR(5);               /* ipCidrRouteIfIndex */
+    ADD_RTVAR(6);               /* ipCidrRouteType    */
+    ADD_RTVAR(7);               /* ipCidrRouteProto   */
 #undef ADD_RTVAR
 
     /*
      * Now walk the ipCidrRouteTable, reporting the various route entries
      */
-    while ( 1 ) {
-        oid *op;
-        unsigned char *cp;
+    while (1) {
+        oid            *op;
+        unsigned char  *cp;
 
-        if (netsnmp_query_getnext( var, ss ) != SNMP_ERR_NOERROR)
+        if (netsnmp_query_getnext(var, ss) != SNMP_ERR_NOERROR)
             break;
-        rtcol_oid[ rtcol_len-1 ] = 5;        /* ipRouteIfIndex */
-        if ( snmp_oid_compare( rtcol_oid, rtcol_len,
-                               var->name, rtcol_len) != 0 )
-            break;    /* End of Table */
+        rtcol_oid[rtcol_len - 1] = 5;   /* ipRouteIfIndex */
+        if (snmp_oid_compare(rtcol_oid, rtcol_len,
+                             var->name, rtcol_len) != 0)
+            break;              /* End of Table */
         if (var->type == SNMP_NOSUCHOBJECT ||
-                var->type == SNMP_NOSUCHINSTANCE ||
-                var->type == SNMP_ENDOFMIBVIEW)
+            var->type == SNMP_NOSUCHINSTANCE ||
+            var->type == SNMP_ENDOFMIBVIEW)
             break;
-        memset( &route, 0, sizeof( struct route_entry ));
-	rp->af = AF_INET;
-	op = var->name+rtcol_len;
+        memset(&route, 0, sizeof(struct route_entry));
+        rp->af = AF_INET;
+        op = var->name + rtcol_len;
         cp = tmpAddr.data;
         cp[0] = *op++ & 0xff;
         cp[1] = *op++ & 0xff;
@@ -234,43 +230,43 @@ route4pr(int af)
         cp[2] = *op++ & 0xff;
         cp[3] = *op++ & 0xff;
         rp->mask = tmpAddr.addr;
-	op++; /* ipCidrRouteTos */
+        op++;                   /* ipCidrRouteTos */
         cp = tmpAddr.data;
         cp[0] = *op++ & 0xff;
         cp[1] = *op++ & 0xff;
         cp[2] = *op++ & 0xff;
         cp[3] = *op++ & 0xff;
         rp->gateway = tmpAddr.addr;
-	rp->set_bits = SET_MASK | SET_GWAY;
+        rp->set_bits = SET_MASK | SET_GWAY;
 
-        for ( vp=var; vp; vp=vp->next_variable ) {
-            switch ( vp->name[ rtcol_len - 1 ] ) {
-            case 5:     /* ipCidrRouteIfIndex */
-                rp->ifNumber  = *vp->val.integer;
+        for (vp = var; vp; vp = vp->next_variable) {
+            switch (vp->name[rtcol_len - 1]) {
+            case 5:            /* ipCidrRouteIfIndex */
+                rp->ifNumber = *vp->val.integer;
                 rp->set_bits |= SET_IFNO;
                 break;
-            case 6:     /* ipCidrRouteType    */
-                rp->type      = *vp->val.integer;
+            case 6:            /* ipCidrRouteType    */
+                rp->type = *vp->val.integer;
                 rp->set_bits |= SET_TYPE;
                 break;
-            case 7:     /* ipCidrRouteProto   */
-                rp->proto     = *vp->val.integer;
+            case 7:            /* ipCidrRouteProto   */
+                rp->proto = *vp->val.integer;
                 rp->set_bits |= SET_PRTO;
                 break;
             }
         }
         if (rp->set_bits != SET_ALL) {
-            continue;   /* Incomplete query */
+            continue;           /* Incomplete query */
         }
 
         if (hdr_af != rp->af) {
             if (hdr_af != AF_UNSPEC)
                 printf("\n");
             hdr_af = rp->af;
-	    printf("Routing tables (ipCidrRouteTable)\n");
+            printf("Routing tables (ipCidrRouteTable)\n");
             pr_rthdr(hdr_af);
         }
-        p_rtnode( rp );
+        p_rtnode(rp);
         printed++;
     }
     snmp_free_varbind(var);
@@ -287,12 +283,12 @@ struct iflist {
 void
 get_ifname(char *name, int ifIndex)
 {
-    oid    ifdescr_oid[]  = { 1,3,6,1,2,1,2,2,1,2,0 };
-    size_t ifdescr_len    = OID_LENGTH( ifdescr_oid );
-    oid    ifxcol_oid[] = { 1,3,6,1,2,1,31,1,1,1,1,0 };
-    size_t ifxcol_len   = OID_LENGTH( ifxcol_oid );
+    oid             ifdescr_oid[] = { 1, 3, 6, 1, 2, 1, 2, 2, 1, 2, 0 };
+    size_t          ifdescr_len = OID_LENGTH(ifdescr_oid);
+    oid             ifxcol_oid[] = { 1, 3, 6, 1, 2, 1, 31, 1, 1, 1, 1, 0 };
+    size_t          ifxcol_len = OID_LENGTH(ifxcol_oid);
     netsnmp_variable_list *var = NULL;
-    struct iflist         *ip;
+    struct iflist  *ip;
 
     for (ip = Iflist; ip; ip = ip->next) {
         if (ip->index == ifIndex)
@@ -309,50 +305,58 @@ get_ifname(char *name, int ifIndex)
     Iflist = ip;
     ip->index = ifIndex;
 
-    ifxcol_oid[ ifxcol_len-1 ] = ifIndex;
-    snmp_varlist_add_variable( &var, ifxcol_oid, ifxcol_len,
-                               ASN_NULL, NULL,  0);
-    if (netsnmp_query_get( var, ss ) == SNMP_ERR_NOERROR) {
+    ifxcol_oid[ifxcol_len - 1] = ifIndex;
+    snmp_varlist_add_variable(&var, ifxcol_oid, ifxcol_len,
+                              ASN_NULL, NULL, 0);
+    if (netsnmp_query_get(var, ss) == SNMP_ERR_NOERROR) {
         if (var->val_len >= sizeof(ip->name))
-            var->val_len  = sizeof(ip->name) - 1;
+            var->val_len = sizeof(ip->name) - 1;
         memmove(ip->name, var->val.string, var->val_len);
         ip->name[var->val_len] = '\0';
-	strcpy(name, ip->name);
-	snmp_free_varbind(var);
-	return;
+        strcpy(name, ip->name);
+        snmp_free_varbind(var);
+        return;
     }
 
-    ifdescr_oid[ ifdescr_len-1 ] = ifIndex;
-    snmp_varlist_add_variable( &var, ifdescr_oid, ifdescr_len,
-                               ASN_NULL, NULL,  0);
-    if (netsnmp_query_get( var, ss ) == SNMP_ERR_NOERROR) {
+    ifdescr_oid[ifdescr_len - 1] = ifIndex;
+    snmp_varlist_add_variable(&var, ifdescr_oid, ifdescr_len,
+                              ASN_NULL, NULL, 0);
+    if (netsnmp_query_get(var, ss) == SNMP_ERR_NOERROR) {
         if (var->val_len >= sizeof(ip->name))
-            var->val_len  = sizeof(ip->name) - 1;
+            var->val_len = sizeof(ip->name) - 1;
         memmove(ip->name, var->val.string, var->val_len);
         ip->name[var->val_len] = '\0';
-	snmp_free_varbind(var);
+        snmp_free_varbind(var);
     } else {
         sprintf(ip->name, "if%d", ifIndex);
     }
     strcpy(name, ip->name);
 }
 
-/* column widths; each followed by one space */
+/*
+ * column widths; each followed by one space
+ */
 #ifndef NETSNMP_ENABLE_IPV6
-#define	WID_DST(af)	26	/* width of destination column */
-#define	WID_GW(af)	18	/* width of gateway column */
+#define	WID_DST(af)	26      /* width of destination column */
+#define	WID_GW(af)	18      /* width of gateway column */
 #else
-/* width of destination/gateway column */
+/*
+ * width of destination/gateway column
+ */
 #if 1
-/* strlen("fe80::aaaa:bbbb:cccc:dddd@gif0") == 30, strlen("/128") == 4 */
+/*
+ * strlen("fe80::aaaa:bbbb:cccc:dddd@gif0") == 30, strlen("/128") == 4
+ */
 #define	WID_DST(af)	((af) == AF_INET6 ? (nflag ? 34 : 26) : 26)
 #define	WID_GW(af)	((af) == AF_INET6 ? (nflag ? 30 : 18) : 18)
 #else
-/* strlen("fe80::aaaa:bbbb:cccc:dddd") == 25, strlen("/128") == 4 */
+/*
+ * strlen("fe80::aaaa:bbbb:cccc:dddd") == 25, strlen("/128") == 4
+ */
 #define	WID_DST(af)	((af) == AF_INET6 ? (nflag ? 29 : 18) : 18)
 #define	WID_GW(af)	((af) == AF_INET6 ? (nflag ? 25 : 18) : 18)
 #endif
-#endif /* NETSNMP_ENABLE_IPV6 */
+#endif                          /* NETSNMP_ENABLE_IPV6 */
 
 /*
  * Print header for routing table columns.
@@ -360,247 +364,239 @@ get_ifname(char *name, int ifIndex)
 void
 pr_rthdr(int af)
 {
-   /*
-	if (Aflag)
-		printf("%-*.*s ", PLEN, PLEN, "Address");
-	if (Sflag)
-		printf("%-*.*s ",
-		    WID_DST(af), WID_DST(af), "Source");
-    */
-	printf("%-*.*s ",
-	    WID_DST(af), WID_DST(af), "Destination");
-	printf("%-*.*s %-6.6s  %s\n",
-	    WID_GW(af), WID_GW(af), "Gateway",
-	    "Flags", "Interface");
+    /*
+     * if (Aflag)
+     * printf("%-*.*s ", PLEN, PLEN, "Address");
+     * if (Sflag)
+     * printf("%-*.*s ",
+     * WID_DST(af), WID_DST(af), "Source");
+     */
+    printf("%-*.*s ", WID_DST(af), WID_DST(af), "Destination");
+    printf("%-*.*s %-6.6s  %s\n",
+           WID_GW(af), WID_GW(af), "Gateway", "Flags", "Interface");
 }
 
+#if 0
 /*
  * Print header for PF_KEY entries.
+ */
 void
 pr_encaphdr(void)
 {
-	if (Aflag)
-		printf("%-*s ", PLEN, "Address");
-	printf("%-18s %-5s %-18s %-5s %-5s %-22s\n",
-	    "Source", "Port", "Destination",
-	    "Port", "Proto", "SA(Address/Proto/Type/Direction)");
+    if (Aflag)
+        printf("%-*s ", PLEN, "Address");
+    printf("%-18s %-5s %-18s %-5s %-5s %-22s\n",
+           "Source", "Port", "Destination",
+           "Port", "Proto", "SA(Address/Proto/Type/Direction)");
 }
- */
+#endif
 
-char *
+char           *
 routename(in_addr_t in)
 {
-	char *cp;
-	static char line[MAXHOSTNAMELEN];
-	struct hostent *hp;
-	static char domain[MAXHOSTNAMELEN];
-	static int first = 1;
-
-	if (first) {
-		first = 0;
-		if (gethostname(line, sizeof line) == 0 &&
-		    (cp = strchr(line, '.')))
-			(void) strlcpy(domain, cp + 1, sizeof domain);
-		else
-			domain[0] = '\0';
-	}
-	cp = NULL;
-	if (!nflag) {
-		hp = netsnmp_gethostbyaddr((char *)&in, sizeof (struct in_addr),
-		    AF_INET);
-		if (hp) {
-			if ((cp = strchr(hp->h_name, '.')) &&
-			    !strcmp(cp + 1, domain))
-				*cp = '\0';
-			cp = hp->h_name;
-		}
-	}
-	if (cp) {
-		strlcpy(line, cp, sizeof(line));
-	} else {
-#define C(x)	(unsigned)((x) & 0xff)
-		in = ntohl(in);
-		snprintf(line, sizeof line, "%u.%u.%u.%u",
-		    C(in >> 24), C(in >> 16), C(in >> 8), C(in));
-	}
-	return (line);
+    char           *cp;
+    static char     line[MAXHOSTNAMELEN];
+    char            host[MAXHOSTNAMELEN];
+    static char     domain[MAXHOSTNAMELEN];
+    static int      first = 1;
+    struct sockaddr_in sin;
+
+    memset(&sin, 0, sizeof(sin));
+    if (first) {
+        first = 0;
+        if (gethostname(line, sizeof line) == 0 &&
+            (cp = strchr(line, '.')))
+            strlcpy(domain, cp + 1, sizeof domain);
+        else
+            domain[0] = '\0';
+    }
+    sin.sin_family = AF_INET;
+    sin.sin_addr.s_addr = in;
+    if (getnameinfo((struct sockaddr *) &sin, sizeof(sin), host,
+                    sizeof(host), NULL, 0, nflag ? NI_NUMERICHOST : 0) < 0)
+        strlcpy(host, "?", sizeof(host));
+    if ((cp = strchr(host, '.')) && strcmp(cp + 1, domain) == 0)
+        *cp = '\0';
+    strlcpy(line, host, sizeof(line));
+    return line;
 }
 
+#define C(x) (unsigned int)((x) & 0xffU)
 /*
  * Return the name of the network whose address is given.
  * The address is assumed to be that of a net or subnet, not a host.
  */
-char *
+char           *
 netname(in_addr_t in, in_addr_t mask)
 {
-	char *cp = NULL;
-	static char line[MAXHOSTNAMELEN];
-	struct netent *np = NULL;
-	int mbits;
-
-	in = ntohl(in);
-	mask = ntohl(mask);
-	if (!nflag && in != INADDR_ANY) {
-		if ((np = getnetbyaddr(in, AF_INET)) != NULL)
-			cp = np->n_name;
-	}
-	mbits = mask ? 33 - _ffs(mask) : 0;
-	if (cp) {
-		strlcpy(line, cp, sizeof(line));
-	} else if (mbits < 9)
-		snprintf(line, sizeof line, "%u/%d", C(in >> 24), mbits);
-	else if (mbits < 17)
-		snprintf(line, sizeof line, "%u.%u/%d",
-		    C(in >> 24) , C(in >> 16), mbits);
-	else if (mbits < 25)
-		snprintf(line, sizeof line, "%u.%u.%u/%d",
-		    C(in >> 24), C(in >> 16), C(in >> 8), mbits);
-	else
-		snprintf(line, sizeof line, "%u.%u.%u.%u/%d", C(in >> 24),
-		    C(in >> 16), C(in >> 8), C(in), mbits);
-	return (line);
+    char           *cp = NULL;
+    static char     line[MAXHOSTNAMELEN];
+    struct netent  *np = NULL;
+    int             mbits;
+
+    in = ntohl(in);
+    mask = ntohl(mask);
+    if (!nflag && in != INADDR_ANY) {
+        if ((np = getnetbyaddr(in, AF_INET)) != NULL)
+            cp = np->n_name;
+    }
+    mbits = mask ? 33 - _ffs(mask) : 0;
+    if (cp) {
+        strlcpy(line, cp, sizeof(line));
+    } else if (mbits < 9)
+        snprintf(line, sizeof line, "%u/%d", C(in >> 24), mbits);
+    else if (mbits < 17)
+        snprintf(line, sizeof line, "%u.%u/%d",
+                 C(in >> 24), C(in >> 16), mbits);
+    else if (mbits < 25)
+        snprintf(line, sizeof line, "%u.%u.%u/%d",
+                 C(in >> 24), C(in >> 16), C(in >> 8), mbits);
+    else
+        snprintf(line, sizeof line, "%u.%u.%u.%u/%d", C(in >> 24),
+                 C(in >> 16), C(in >> 8), C(in), mbits);
+    return (line);
 }
 
 #undef NETSNMP_ENABLE_IPV6
 #ifdef NETSNMP_ENABLE_IPV6
-char *
+char           *
 netname6(struct sockaddr_in6 *sa6, struct in6_addr *mask)
 {
-	static char line[MAXHOSTNAMELEN + 1];
-	struct sockaddr_in6 sin6;
-	u_char *p;
-	u_char *lim;
-	int masklen, final = 0, illegal = 0;
-	int i;
-	char hbuf[NI_MAXHOST];
-	int flag = 0;
-	int error;
-
-	sin6 = *sa6;
-
-	masklen = 0;
-	lim = (u_char *)(mask + 1);
-	i = 0;
-	if (mask) {
-		for (p = (u_char *)mask; p < lim; p++) {
-			if (final && *p) {
-				illegal++;
-				sin6.sin6_addr.s6_addr[i++] = 0x00;
-				continue;
-			}
-
-			switch (*p & 0xff) {
-			case 0xff:
-				masklen += 8;
-				break;
-			case 0xfe:
-				masklen += 7;
-				final++;
-				break;
-			case 0xfc:
-				masklen += 6;
-				final++;
-				break;
-			case 0xf8:
-				masklen += 5;
-				final++;
-				break;
-			case 0xf0:
-				masklen += 4;
-				final++;
-				break;
-			case 0xe0:
-				masklen += 3;
-				final++;
-				break;
-			case 0xc0:
-				masklen += 2;
-				final++;
-				break;
-			case 0x80:
-				masklen += 1;
-				final++;
-				break;
-			case 0x00:
-				final++;
-				break;
-			default:
-				final++;
-				illegal++;
-				break;
-			}
-
-			if (!illegal)
-				sin6.sin6_addr.s6_addr[i++] &= *p;
-			else
-				sin6.sin6_addr.s6_addr[i++] = 0x00;
-		}
-	} else
-		masklen = 128;
-
-	if (masklen == 0 && IN6_IS_ADDR_UNSPECIFIED(&sin6.sin6_addr))
-		return("default");
-
-	if (illegal)
-		fprintf(stderr, "illegal prefixlen\n");
-
-	if (nflag)
-		flag |= NI_NUMERICHOST;
-	error = getnameinfo((struct sockaddr *)&sin6, sin6.sin6_len,
-	    hbuf, sizeof(hbuf), NULL, 0, flag);
-	if (error)
-		snprintf(hbuf, sizeof(hbuf), "invalid");
+    static char     line[MAXHOSTNAMELEN + 1];
+    struct sockaddr_in6 sin6;
+    u_char         *p;
+    u_char         *lim;
+    int             masklen, final = 0, illegal = 0;
+    int             i;
+    char            hbuf[NI_MAXHOST];
+    int             flag = 0;
+    int             error;
+
+    sin6 = *sa6;
+
+    masklen = 0;
+    lim = (u_char *) (mask + 1);
+    i = 0;
+    if (mask) {
+        for (p = (u_char *) mask; p < lim; p++) {
+            if (final && *p) {
+                illegal++;
+                sin6.sin6_addr.s6_addr[i++] = 0x00;
+                continue;
+            }
+
+            switch (*p & 0xff) {
+            case 0xff:
+                masklen += 8;
+                break;
+            case 0xfe:
+                masklen += 7;
+                final++;
+                break;
+            case 0xfc:
+                masklen += 6;
+                final++;
+                break;
+            case 0xf8:
+                masklen += 5;
+                final++;
+                break;
+            case 0xf0:
+                masklen += 4;
+                final++;
+                break;
+            case 0xe0:
+                masklen += 3;
+                final++;
+                break;
+            case 0xc0:
+                masklen += 2;
+                final++;
+                break;
+            case 0x80:
+                masklen += 1;
+                final++;
+                break;
+            case 0x00:
+                final++;
+                break;
+            default:
+                final++;
+                illegal++;
+                break;
+            }
+
+            if (!illegal)
+                sin6.sin6_addr.s6_addr[i++] &= *p;
+            else
+                sin6.sin6_addr.s6_addr[i++] = 0x00;
+        }
+    } else
+        masklen = 128;
+
+    if (masklen == 0 && IN6_IS_ADDR_UNSPECIFIED(&sin6.sin6_addr))
+        return ("default");
+
+    if (illegal)
+        fprintf(stderr, "illegal prefixlen\n");
+
+    if (nflag)
+        flag |= NI_NUMERICHOST;
+    error = getnameinfo((struct sockaddr *) &sin6, sin6.sin6_len,
+                        hbuf, sizeof(hbuf), NULL, 0, flag);
+    if (error)
+        snprintf(hbuf, sizeof(hbuf), "invalid");
 
-	snprintf(line, sizeof(line), "%s/%d", hbuf, masklen);
-	return line;
+    snprintf(line, sizeof(line), "%s/%d", hbuf, masklen);
+    return line;
 }
 
-char *
+char           *
 routename6(struct sockaddr_in6 *sa6)
 {
-	static char line[NI_MAXHOST];
-	const int niflag = NI_NUMERICHOST;
+    static char     line[NI_MAXHOST];
+    const int       niflag = NI_NUMERICHOST;
 
-	if (getnameinfo((struct sockaddr *)sa6, sa6->sin6_len,
-	    line, sizeof(line), NULL, 0, niflag) != 0)
-		strlcpy(line, "", sizeof line);
-	return line;
+    if (getnameinfo((struct sockaddr *) sa6, sa6->sin6_len,
+                    line, sizeof(line), NULL, 0, niflag) != 0)
+        strlcpy(line, "", sizeof line);
+    return line;
 }
-#endif /*NETSNMP_ENABLE_IPV6*/
+#endif                          /*NETSNMP_ENABLE_IPV6 */
 
-char *
-s_rtflags( struct route_entry *rp )
+char           *
+s_rtflags(struct route_entry *rp)
 {
-    static char flag_buf[10];
-    char  *cp = flag_buf;
+    static char     flag_buf[10];
+    char           *cp = flag_buf;
 
     *cp++ = '<';
-    *cp++ = 'U';   /* route is in use */
-    if (rp->mask  == 0xffffffff)
-        *cp++ = 'H';   /* host */
+    *cp++ = 'U';                /* route is in use */
+    if (rp->mask == 0xffffffff)
+        *cp++ = 'H';            /* host */
     if (rp->proto == 4)
-        *cp++ = 'D';   /* ICMP redirect */
-    if (rp->type  == 4)
-        *cp++ = 'G';   /* remote destination/net */
+        *cp++ = 'D';            /* ICMP redirect */
+    if (rp->type == 4)
+        *cp++ = 'G';            /* remote destination/net */
     *cp++ = '>';
     *cp = 0;
     return flag_buf;
 }
 
 void
-p_rtnode( struct route_entry *rp )
+p_rtnode(struct route_entry *rp)
 {
     get_ifname(rp->ifname, rp->ifNumber);
     printf("%-*.*s ",
-	    WID_DST(AF_INET), WID_DST(AF_INET),
-            (rp->destination == INADDR_ANY) ? "default" :
-                (rp->set_bits & SET_MASK) ?
-                    (rp->mask == 0xffffffff ?
-                        routename(rp->destination) :
-                        netname(rp->destination, rp->mask)) :
-                    netname(rp->destination, 0L));
+           WID_DST(AF_INET), WID_DST(AF_INET),
+           (rp->destination == INADDR_ANY) ? "default" :
+           (rp->set_bits & SET_MASK) ?
+           (rp->mask == 0xffffffff ?
+            routename(rp->destination) :
+            netname(rp->destination, rp->mask)) :
+           netname(rp->destination, 0L));
     printf("%-*.*s %-6.6s  %s\n",
-	    WID_GW(af), WID_GW(af),
-	    rp->gateway ? routename(rp->gateway) : "*",
-            s_rtflags(rp), rp->ifname);
+           WID_GW(af), WID_GW(af),
+           rp->gateway ? routename(rp->gateway) : "*",
+           s_rtflags(rp), rp->ifname);
 }
diff -urpN net-snmp-5.8/apps/snmpnetstat/routex.c net-snmp-5.9.1/apps/snmpnetstat/routex.c
--- net-snmp-5.8/apps/snmpnetstat/routex.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpnetstat/routex.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,5 +1,9 @@
-/*        $OpenBSD: route.c,v 1.66 2004/11/17 01:47:20 itojun Exp $        */
-/*        $NetBSD: route.c,v 1.15 1996/05/07 02:55:06 thorpej Exp $        */
+/*
+ * $OpenBSD: route.c,v 1.66 2004/11/17 01:47:20 itojun Exp $
+ */
+/*
+ * $NetBSD: route.c,v 1.15 1996/05/07 02:55:06 thorpej Exp $
+ */
 
 /*
  * Copyright (c) 1983, 1988, 1993
@@ -30,16 +34,6 @@
  * SUCH DAMAGE.
  */
 
-#ifdef  INHERITED_CODE
-#ifndef lint
-#if 0
-static char sccsid[] = "from: @(#)route.c        8.3 (Berkeley) 3/9/94";
-#else
-static char *rcsid = "$OpenBSD: route.c,v 1.66 2004/11/17 01:47:20 itojun Exp $";
-#endif
-#endif /* not lint */
-#endif
-
 #include <net-snmp/net-snmp-config.h>
 
 #if HAVE_SYS_TYPES_H
@@ -55,6 +49,8 @@ static char *rcsid = "$OpenBSD: route.c,
 
 #include <net-snmp/net-snmp-includes.h>
 
+netsnmp_feature_require(sockaddr_size);
+
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
@@ -72,7 +68,9 @@ static char *rcsid = "$OpenBSD: route.c,
 #include "winstub.h"
 #endif
 
-/* inetCidrRouteTable */
+/*
+ * inetCidrRouteTable
+ */
 #define SET_IFNO 0x01
 #define SET_TYPE 0x02
 #define SET_PRTO 0x04
@@ -81,11 +79,15 @@ static char *rcsid = "$OpenBSD: route.c,
 #define SET_MET1 0x20
 #define SET_ALL  0x3f
 
-/* ip6RouteTable */
+/*
+ * ip6RouteTable
+ */
 #define SET_HOP     0x40
 #define SET_INVALID 0x80
 #define SET_ALL6    0x67
-/* not invalid, and only the columns that we fetch */
+/*
+ * not invalid, and only the columns that we fetch
+ */
 
 struct route_entry {
     int             af;
@@ -103,8 +105,8 @@ struct route_entry {
 };
 
 
-static void pr_rtxhdr(int af, const char *table);
-static void p_rtnodex( struct route_entry *rp );
+static void     pr_rtxhdr(int af, const char *table);
+static void     p_rtnodex(struct route_entry *rp);
 
 /*
  * Print routing tables.
@@ -112,121 +114,134 @@ static void p_rtnodex( struct route_entr
 int
 routexpr(int af)
 {
-    struct route_entry  route, *rp = &route;
-    oid    rtcol_oid[]  = { 1,3,6,1,2,1,4,24,7,1,0 }; /* inetCidrRouteEntry */
-    size_t rtcol_len    = OID_LENGTH( rtcol_oid );
+    struct route_entry route, *rp = &route;
+    oid             rtcol_oid[] = { 1, 3, 6, 1, 2, 1, 4, 24, 7, 1, 0 }; /* inetCidrRouteEntry */
+    size_t          rtcol_len = OID_LENGTH(rtcol_oid);
     netsnmp_variable_list *var = NULL, *vp;
-    int hdr_af = AF_UNSPEC;
-    int printed = 0;
+    int             hdr_af = AF_UNSPEC;
+    int             printed = 0;
 
 #define ADD_RTVAR( x ) rtcol_oid[ rtcol_len-1 ] = x; \
     snmp_varlist_add_variable( &var, rtcol_oid, rtcol_len, ASN_NULL, NULL,  0)
-    ADD_RTVAR( 7 );                 /* inetCidrRouteIfIndex */
-    ADD_RTVAR( 8 );                 /* inetCidrRouteType    */
-    ADD_RTVAR( 9 );                 /* inetCidrRouteProto   */
-    ADD_RTVAR( 10 );                /* inetCidrRouteAge   */
-    ADD_RTVAR( 11 );                /* inetCidrRouteNextHopAS   */
-    ADD_RTVAR( 12 );                /* inetCidrRouteMetric1   */
+    ADD_RTVAR(7);               /* inetCidrRouteIfIndex */
+    ADD_RTVAR(8);               /* inetCidrRouteType    */
+    ADD_RTVAR(9);               /* inetCidrRouteProto   */
+    ADD_RTVAR(10);              /* inetCidrRouteAge   */
+    ADD_RTVAR(11);              /* inetCidrRouteNextHopAS   */
+    ADD_RTVAR(12);              /* inetCidrRouteMetric1   */
 #undef ADD_RTVAR
 
     /*
      * Now walk the inetCidrRouteTable, reporting the various route entries
      */
-    while ( 1 ) {
-        oid *op;
-        unsigned char *cp;
-        int i;
+    while (1) {
+        oid            *op;
+        unsigned char  *cp;
+        int             i;
 
-        if (netsnmp_query_getnext( var, ss ) != SNMP_ERR_NOERROR)
+        if (netsnmp_query_getnext(var, ss) != SNMP_ERR_NOERROR)
             break;
-        rtcol_oid[ rtcol_len-1 ] = 7;        /* ifRouteIfIndex */
-        if ( snmp_oid_compare( rtcol_oid, rtcol_len,
-                               var->name, rtcol_len) != 0 )
-            break;    /* End of Table */
+        rtcol_oid[rtcol_len - 1] = 7;   /* ifRouteIfIndex */
+        if (snmp_oid_compare(rtcol_oid, rtcol_len,
+                             var->name, rtcol_len) != 0)
+            break;              /* End of Table */
         if (var->type == SNMP_NOSUCHOBJECT ||
-                var->type == SNMP_NOSUCHINSTANCE ||
-                var->type == SNMP_ENDOFMIBVIEW)
+            var->type == SNMP_NOSUCHINSTANCE ||
+            var->type == SNMP_ENDOFMIBVIEW)
             break;
-        memset( &route, 0, sizeof( struct route_entry ));
-        /* Extract inetCidrRouteDest, inetCidrRoutePfxLen,
-         * inetCidrRouteNextHop from index */
+        memset(&route, 0, sizeof(struct route_entry));
+        /*
+         * Extract inetCidrRouteDest, inetCidrRoutePfxLen,
+         * * inetCidrRouteNextHop from index
+         */
         switch (var->name[rtcol_len]) {
         case 1:
-            {   struct sockaddr_in *sin = (struct sockaddr_in *)&route.dst;
-                int len;
+            {
+                struct sockaddr_in *sin =
+                    (struct sockaddr_in *) &route.dst;
+                int             len;
                 route.af = AF_INET;
                 sin->sin_family = AF_INET;
-                op = var->name+rtcol_len+1;
+                op = var->name + rtcol_len + 1;
                 len = *op++;
-                cp = (unsigned char *)&sin->sin_addr;
-                for (i = 0; i < len; i++) *cp++ = *op++;
+                cp = (unsigned char *) &sin->sin_addr;
+                for (i = 0; i < len; i++)
+                    *cp++ = *op++;
                 route.mask = *op++;
-                op += *op+1;
-                op++; /* addrType */
-                op++; /* addrLen */
-                sin = (struct sockaddr_in *)&route.hop;
+                op += *op + 1;
+                op++;           /* addrType */
+                op++;           /* addrLen */
+                sin = (struct sockaddr_in *) &route.hop;
                 sin->sin_family = AF_INET;
-                cp = (unsigned char *)&sin->sin_addr;
-                for (i = 0; i < len; i++) *cp++ = *op++;
+                cp = (unsigned char *) &sin->sin_addr;
+                for (i = 0; i < len; i++)
+                    *cp++ = *op++;
                 break;
             }
         case 2:
-            {   struct sockaddr_in6 *sin6 = (struct sockaddr_in6 *)&route.dst;
-                int len;
+            {
+                struct sockaddr_in6 *sin6 =
+                    (struct sockaddr_in6 *) &route.dst;
+                int             len;
                 route.af = AF_INET6;
                 sin6->sin6_family = AF_INET6;
-                op = var->name+rtcol_len+1;
+                op = var->name + rtcol_len + 1;
                 len = *op++;
-                cp = (unsigned char *)&sin6->sin6_addr;
-                for (i = 0; i < len; i++) *cp++ = *op++;
+                cp = (unsigned char *) &sin6->sin6_addr;
+                for (i = 0; i < len; i++)
+                    *cp++ = *op++;
                 route.mask = *op++;
-                op += *op+1;
-                op++; /* addrType */
-                op++; /* addrLen */
-                sin6 = (struct sockaddr_in6 *)&route.hop;
+                op += *op + 1;
+                op++;           /* addrType */
+                op++;           /* addrLen */
+                sin6 = (struct sockaddr_in6 *) &route.hop;
                 sin6->sin6_family = AF_INET6;
-                cp = (unsigned char *)&sin6->sin6_addr;
-                for (i = 0; i < len; i++) *cp++ = *op++;
+                cp = (unsigned char *) &sin6->sin6_addr;
+                for (i = 0; i < len; i++)
+                    *cp++ = *op++;
                 break;
             }
         default:
-            fprintf(stderr, "Bad address type: %d\n", (int)var->name[rtcol_len]);
+            fprintf(stderr, "Bad address type: %d\n",
+                    (int) var->name[rtcol_len]);
             exit(1);
         }
-        /* Extract ipRouteDest index value */
-
-        for ( vp=var; vp; vp=vp->next_variable ) {
-            switch ( vp->name[ rtcol_len - 1 ] ) {
-            case 7:     /* inetCidrRouteIfIndex */
-                rp->ifNumber  = *vp->val.integer;
+        /*
+         * Extract ipRouteDest index value
+         */
+
+        for (vp = var; vp; vp = vp->next_variable) {
+            switch (vp->name[rtcol_len - 1]) {
+            case 7:            /* inetCidrRouteIfIndex */
+                rp->ifNumber = *vp->val.integer;
                 rp->set_bits |= SET_IFNO;
                 break;
-            case 8:     /* inetCidrRouteType    */
-                rp->type      = *vp->val.integer;
+            case 8:            /* inetCidrRouteType    */
+                rp->type = *vp->val.integer;
                 rp->set_bits |= SET_TYPE;
                 break;
-            case 9:     /* inetCidrRouteProto   */
-                rp->proto     = *vp->val.integer;
+            case 9:            /* inetCidrRouteProto   */
+                rp->proto = *vp->val.integer;
                 rp->set_bits |= SET_PRTO;
                 break;
-            case 10:     /* inetCidrRouteAge   */
-                rp->age     = *vp->val.integer;
+            case 10:           /* inetCidrRouteAge   */
+                rp->age = *vp->val.integer;
                 rp->set_bits |= SET_AGE;
                 break;
-            case 11:     /* inetCidrRouteNextHopAS   */
-                rp->as     = *vp->val.integer;
+            case 11:           /* inetCidrRouteNextHopAS   */
+                rp->as = *vp->val.integer;
                 rp->set_bits |= SET_AS;
                 break;
-            case 12:     /* inetCidrRouteMetric1   */
-                rp->metric1     = *vp->val.integer;
+            case 12:           /* inetCidrRouteMetric1   */
+                rp->metric1 = *vp->val.integer;
                 rp->set_bits |= SET_MET1;
                 break;
             }
         }
         if (rp->set_bits != SET_ALL) {
-            continue;   /* Incomplete query */
+            continue;           /* Incomplete query */
         }
-    
+
         if (af != AF_UNSPEC && rp->af != af)
             continue;
 
@@ -236,7 +251,7 @@ routexpr(int af)
             hdr_af = rp->af;
             pr_rtxhdr(hdr_af, "inetCidrRouteTable");
         }
-        p_rtnodex( rp );
+        p_rtnodex(rp);
         printed++;
     }
     snmp_free_varbind(var);
@@ -249,57 +264,58 @@ routexpr(int af)
 int
 route6pr(int af)
 {
-    struct route_entry  route, *rp = &route;
-    oid    rtcol_oid[]  = { 1,3,6,1,2,1,55,1,11,1,0 }; /* ipv6RouteEntry */
-    size_t rtcol_len    = OID_LENGTH( rtcol_oid );
+    struct route_entry route, *rp = &route;
+    oid             rtcol_oid[] = { 1, 3, 6, 1, 2, 1, 55, 1, 11, 1, 0 };        /* ipv6RouteEntry */
+    size_t          rtcol_len = OID_LENGTH(rtcol_oid);
     netsnmp_variable_list *var = NULL, *vp;
-    int printed = 0;
-    int hdr_af = AF_UNSPEC;
-    int i;
+    int             printed = 0;
+    int             hdr_af = AF_UNSPEC;
+    int             i;
 
     if (af != AF_UNSPEC && af != AF_INET6)
         return 0;
 
 #define ADD_RTVAR( x ) rtcol_oid[ rtcol_len-1 ] = x; \
     snmp_varlist_add_variable( &var, rtcol_oid, rtcol_len, ASN_NULL, NULL,  0)
-    ADD_RTVAR( 4 );                 /* ipv6RouteIfIndex */
-    ADD_RTVAR( 5 );                 /* ipv6RouteNextHop */
-    ADD_RTVAR( 6 );                 /* ipv6RouteType    */
-    ADD_RTVAR( 7 );                 /* ipv6RouteProto   */
-    ADD_RTVAR( 11 );                /* ipv6RouteMetric  */
-    ADD_RTVAR( 14 );                /* ipv6RouteValid   */
+    ADD_RTVAR(4);               /* ipv6RouteIfIndex */
+    ADD_RTVAR(5);               /* ipv6RouteNextHop */
+    ADD_RTVAR(6);               /* ipv6RouteType    */
+    ADD_RTVAR(7);               /* ipv6RouteProto   */
+    ADD_RTVAR(11);              /* ipv6RouteMetric  */
+    ADD_RTVAR(14);              /* ipv6RouteValid   */
 #undef ADD_RTVAR
 
     /*
      * Now walk the ipv6RouteTable, reporting the various route entries
      */
-    while ( 1 ) {
-        oid *op;
-        unsigned char *cp, *cp1;
-        struct sockaddr_in6 *sin6 = (struct sockaddr_in6 *)&route.dst;
+    while (1) {
+        oid            *op;
+        unsigned char  *cp, *cp1;
+        struct sockaddr_in6 *sin6 = (struct sockaddr_in6 *) &route.dst;
 
-        if (netsnmp_query_getnext( var, ss ) != SNMP_ERR_NOERROR)
+        if (netsnmp_query_getnext(var, ss) != SNMP_ERR_NOERROR)
             break;
-        rtcol_oid[ rtcol_len-1 ] = 4;        /* ipv6RouteIfIndex */
-        if ( snmp_oid_compare( rtcol_oid, rtcol_len,
-                               var->name, rtcol_len) != 0 )
-            break;    /* End of Table */
+        rtcol_oid[rtcol_len - 1] = 4;   /* ipv6RouteIfIndex */
+        if (snmp_oid_compare(rtcol_oid, rtcol_len,
+                             var->name, rtcol_len) != 0)
+            break;              /* End of Table */
         if (var->type == SNMP_NOSUCHOBJECT ||
-                var->type == SNMP_NOSUCHINSTANCE ||
-                var->type == SNMP_ENDOFMIBVIEW)
+            var->type == SNMP_NOSUCHINSTANCE ||
+            var->type == SNMP_ENDOFMIBVIEW)
             break;
-        memset( &route, 0, sizeof( struct route_entry ));
+        memset(&route, 0, sizeof(struct route_entry));
         rp->af = AF_INET6;
         sin6->sin6_family = AF_INET6;
-        op = var->name+rtcol_len;
-        cp = (unsigned char *)&sin6->sin6_addr;
-        for (i = 0; i < 16; i++) *cp++ = *op++;
+        op = var->name + rtcol_len;
+        cp = (unsigned char *) &sin6->sin6_addr;
+        for (i = 0; i < 16; i++)
+            *cp++ = *op++;
         route.mask = *op++;
 
-        for ( vp=var; vp; vp=vp->next_variable ) {
-            switch ( vp->name[ rtcol_len - 1 ] ) {
-            case 4:     /* ipv6RouteIfIndex  */
-                rp->ifNumber  = *vp->val.integer;
+        for (vp = var; vp; vp = vp->next_variable) {
+            switch (vp->name[rtcol_len - 1]) {
+            case 4:            /* ipv6RouteIfIndex  */
+                rp->ifNumber = *vp->val.integer;
                 /*
                  * This is, technically, an Ipv6IfIndex, which
                  * could maybe be different than the IfIndex
@@ -310,47 +326,52 @@ route6pr(int af)
                  */
                 rp->set_bits |= SET_IFNO;
                 break;
-            case 5:     /* ipv6RouteNextHop  */
-                cp1 = (unsigned char *)vp->val.string;
-                sin6 = (struct sockaddr_in6 *)&rp->hop;
+            case 5:            /* ipv6RouteNextHop  */
+                cp1 = (unsigned char *) vp->val.string;
+                sin6 = (struct sockaddr_in6 *) &rp->hop;
                 sin6->sin6_family = AF_INET6;
-                cp = (unsigned char *)&sin6->sin6_addr;
-                for (i = 0; i < 16; i++) *cp++ = *cp1++;
+                cp = (unsigned char *) &sin6->sin6_addr;
+                for (i = 0; i < 16; i++)
+                    *cp++ = *cp1++;
                 rp->set_bits |= SET_HOP;
-		break;
-            case 6:     /* ipv6RouteType     */
-                rp->type      = *vp->val.integer;
-                /* This enum maps to similar values in inetCidrRouteType */
+                break;
+            case 6:            /* ipv6RouteType     */
+                rp->type = *vp->val.integer;
+                /*
+                 * This enum maps to similar values in inetCidrRouteType
+                 */
                 rp->set_bits |= SET_TYPE;
                 break;
-            case 7:     /* ipv6RouteProtocol */
-                rp->proto     = *vp->val.integer;
-                /* TODO: this does not map directly to the
-                 * inetCidrRouteProtocol values.  If we use
-                 * rp->proto more, we will have to manage this. */
+            case 7:            /* ipv6RouteProtocol */
+                rp->proto = *vp->val.integer;
+                /*
+                 * TODO: this does not map directly to the
+                 * * inetCidrRouteProtocol values.  If we use
+                 * * rp->proto more, we will have to manage this.
+                 */
                 rp->set_bits |= SET_PRTO;
                 break;
-            case 11:    /* ipv6RouteMetric   */
-                rp->metric1   = *vp->val.integer;
+            case 11:           /* ipv6RouteMetric   */
+                rp->metric1 = *vp->val.integer;
                 rp->set_bits |= SET_MET1;
                 break;
-            case 14:    /* ipv6RouteValid    */
+            case 14:           /* ipv6RouteValid    */
                 if (*vp->val.integer == 2)
                     rp->set_bits |= SET_INVALID;
                 break;
             }
         }
         if (rp->set_bits != SET_ALL6) {
-            continue;   /* Incomplete query */
+            continue;           /* Incomplete query */
         }
-    
+
         if (hdr_af != rp->af) {
             if (hdr_af != AF_UNSPEC)
                 printf("\n");
             hdr_af = rp->af;
             pr_rtxhdr(AF_INET6, "ip6RouteTable");
         }
-        p_rtnodex( rp );
+        p_rtnodex(rp);
         printed++;
     }
     snmp_free_varbind(var);
@@ -358,16 +379,22 @@ route6pr(int af)
 }
 
 
-/* column widths; each followed by one space */
+/*
+ * column widths; each followed by one space
+ */
 #ifndef NETSNMP_ENABLE_IPV6
-#define        WID_DST(af)        26        /* width of destination column */
-#define        WID_GW(af)        18        /* width of gateway column */
+#define        WID_DST(af)        26    /* width of destination column */
+#define        WID_GW(af)        18     /* width of gateway column */
 #else
-/* width of destination/gateway column */
-/* strlen("fe80::aaaa:bbbb:cccc:dddd@gif0") == 30, strlen("/128") == 4 */
+/*
+ * width of destination/gateway column
+ */
+/*
+ * strlen("fe80::aaaa:bbbb:cccc:dddd@gif0") == 30, strlen("/128") == 4
+ */
 #define        WID_DST(af)        ((af) == AF_INET6 ? (nflag ? 34 : 26) : 26)
 #define        WID_GW(af)        ((af) == AF_INET6 ? (nflag ? 39 : 26) : 26)
-#endif /* NETSNMP_ENABLE_IPV6 */
+#endif                          /* NETSNMP_ENABLE_IPV6 */
 
 /*
  * Print header for routing table columns.
@@ -377,52 +404,54 @@ pr_rtxhdr(int af, const char *table)
 {
     switch (af) {
     case AF_INET:
-	printf("IPv4 Routing tables (inetCidrRouteTable)\n");
-	break;
+        printf("IPv4 Routing tables (inetCidrRouteTable)\n");
+        break;
     case AF_INET6:
-	printf("IPv6 Routing tables (%s)\n", table);
-	break;
+        printf("IPv6 Routing tables (%s)\n", table);
+        break;
     }
-    printf("%-*.*s ",
-	WID_DST(af), WID_DST(af), "Destination");
+    printf("%-*.*s ", WID_DST(af), WID_DST(af), "Destination");
     printf("%-*.*s %-6.6s  %s\n",
-	WID_GW(af), WID_GW(af), "Gateway",
-	"Flags", "Interface");
+           WID_GW(af), WID_GW(af), "Gateway", "Flags", "Interface");
 }
 
 #ifndef HAVE_INET_NTOP
-/* MSVC and MinGW */
+/*
+ * MSVC and MinGW
+ */
 #define inet_ntop netsnmp_inet_ntop
 static const char *
 netsnmp_inet_ntop(int af, const void *src, char *dst, size_t size)
 {
-    DWORD out_len = size;
+    DWORD           out_len = size;
 
     switch (af) {
     case AF_INET:
-	{
-	    struct sockaddr_in in;
+        {
+            struct sockaddr_in in;
 
-	    memset(&in, 0, sizeof(in));
-	    in.sin_family = af;
-	    memcpy(&in.sin_addr, src, 4);
-	    if (WSAAddressToString((struct sockaddr *)&in, sizeof(in), NULL, dst,
-				   &out_len) == 0)
-		return dst;
-	}
-	break;
+            memset(&in, 0, sizeof(in));
+            in.sin_family = af;
+            memcpy(&in.sin_addr, src, 4);
+            if (WSAAddressToString
+                ((struct sockaddr *) &in, sizeof(in), NULL, dst,
+                 &out_len) == 0)
+                return dst;
+        }
+        break;
     case AF_INET6:
-	{
-	    struct sockaddr_in6 in6;
+        {
+            struct sockaddr_in6 in6;
 
-	    memset(&in6, 0, sizeof(in6));
-	    in6.sin6_family = af;
-	    memcpy(&in6.sin6_addr, src, 16);
-	    if (WSAAddressToString((struct sockaddr *)&in6, sizeof(in6), NULL, dst,
-				   &out_len) == 0)
-		return dst;
-	}
-	break;
+            memset(&in6, 0, sizeof(in6));
+            in6.sin6_family = af;
+            memcpy(&in6.sin6_addr, src, 16);
+            if (WSAAddressToString
+                ((struct sockaddr *) &in6, sizeof(in6), NULL, dst,
+                 &out_len) == 0)
+                return dst;
+        }
+        break;
     }
     return NULL;
 }
@@ -432,129 +461,112 @@ netsnmp_inet_ntop(int af, const void *sr
  * Return the name of the network whose address is given.
  * The address is assumed to be that of a net or subnet, not a host.
  */
-static char *
+static char    *
 netxname(struct sockaddr_storage *in, int mask)
 {
-    static char host[MAXHOSTNAMELEN];
-    static char line[MAXHOSTNAMELEN];
-    struct sockaddr_in *sin = (struct sockaddr_in *)in;
-    struct sockaddr_in6 *sin6 = (struct sockaddr_in6 *)in;
+    static char     host[MAXHOSTNAMELEN];
+    static char     line[MAXHOSTNAMELEN];
+    struct sockaddr_in *sin = (struct sockaddr_in *) in;
+    struct sockaddr_in6 *sin6 = (struct sockaddr_in6 *) in;
 
     switch (in->ss_family) {
     case AF_INET:
         inet_ntop(in->ss_family, &sin->sin_addr, host, sizeof(host));
-        if (mask == 32) strcpy(line, host);
-        else snprintf(line, sizeof(line), "%s/%d", host, mask);
+        if (mask == 32)
+            strcpy(line, host);
+        else
+            snprintf(line, sizeof(line), "%s/%d", host, mask);
         break;
     case AF_INET6:
         inet_ntop(in->ss_family, &sin6->sin6_addr, host, sizeof(host));
-        if (mask == 128) strcpy(line, host);
-        else snprintf(line, sizeof(line), "%s/%d", host, mask);
+        if (mask == 128)
+            strcpy(line, host);
+        else
+            snprintf(line, sizeof(line), "%s/%d", host, mask);
         break;
     }
     return line;
 }
 
-static char *
-routexname(struct sockaddr_storage *in)
+static char    *
+routexname(const struct sockaddr_storage *in)
 {
-    char *cp;
-    static char line[MAXHOSTNAMELEN];
-    struct hostent *hp = NULL;
-    static char domain[MAXHOSTNAMELEN];
-    static int first = 1;
-    struct sockaddr_in *sin = (struct sockaddr_in *)in;
-    struct sockaddr_in6 *sin6 = (struct sockaddr_in6 *)in;
+    char           *cp;
+    static char     line[MAXHOSTNAMELEN];
+    char            name[MAXHOSTNAMELEN];
+    static char     domain[MAXHOSTNAMELEN];
+    static int      first = 1;
+    const struct sockaddr *sa = (const void *) in;
 
     if (first) {
         first = 0;
-        if (gethostname(line, sizeof line) == 0 &&
-            (cp = strchr(line, '.')))
-            (void) strlcpy(domain, cp + 1, sizeof domain);
+        if (gethostname(line, sizeof(line)) == 0
+            && (cp = strchr(line, '.')))
+            strlcpy(domain, cp + 1, sizeof(domain));
         else
             domain[0] = '\0';
     }
-    cp = NULL;
-    if (!nflag) {
-        switch (in->ss_family) {
-        case AF_INET:
-            hp = netsnmp_gethostbyaddr(&sin->sin_addr,
-                    sizeof (struct in_addr), AF_INET);
-            break;
-        case AF_INET6:
-            hp = netsnmp_gethostbyaddr(&sin6->sin6_addr,
-                    sizeof (struct in6_addr), AF_INET6);
-            break;
-        }
-        if (hp) {
-            if ((cp = strchr(hp->h_name, '.')) && !strcmp(cp + 1, domain))
-                *cp = '\0';
-            cp = hp->h_name;
-        }
-    }
-    if (cp) {
-        strlcpy(line, cp, sizeof(line));
-    } else {
-        switch (in->ss_family) {
-        case AF_INET:
-            inet_ntop(sin->sin_family, &sin->sin_addr, line, sizeof(line));
-            break;
-        case AF_INET6:
-            inet_ntop(sin6->sin6_family, &sin6->sin6_addr, line, sizeof(line));
-            break;
-        }
-    }
-    return (line);
+    if (getnameinfo(sa, netsnmp_sockaddr_size(sa), name, sizeof(name),
+                    NULL, 0, nflag ? NI_NUMERICHOST : 0) < 0)
+        strlcpy(name, "?", sizeof(name));
+    if ((cp = strchr(name, '.')) && strcmp(cp + 1, domain) == 0)
+        *cp = '\0';
+    strlcpy(line, name, sizeof(line));
+    return line;
 }
 
 
-static char *
-s_rtflagsx( struct route_entry *rp )
+static char    *
+s_rtflagsx(struct route_entry *rp)
 {
-    static char flag_buf[10];
-    char  *cp = flag_buf;
+    static char     flag_buf[10];
+    char           *cp = flag_buf;
 
     *cp++ = '<';
-    *cp++ = 'U';   /* route is in use */
+    *cp++ = 'U';                /* route is in use */
     if ((rp->af == AF_INET && rp->mask == 32) ||
-            (rp->af == AF_INET6 && rp->mask == 128))
-        *cp++ = 'H';   /* host */
+        (rp->af == AF_INET6 && rp->mask == 128))
+        *cp++ = 'H';            /* host */
     if (rp->proto == 4)
-        *cp++ = 'D';   /* ICMP redirect */
-    if (rp->type  == 4)
-        *cp++ = 'G';   /* remote destination/net */
+        *cp++ = 'D';            /* ICMP redirect */
+    if (rp->type == 4)
+        *cp++ = 'G';            /* remote destination/net */
     *cp++ = '>';
     *cp = 0;
     return flag_buf;
 }
 
 static void
-p_rtnodex( struct route_entry *rp )
+p_rtnodex(struct route_entry *rp)
 {
     get_ifname(rp->ifname, rp->ifNumber);
     if (rp->af == AF_INET) {
-        struct sockaddr_in *sin = (struct sockaddr_in *)&rp->dst;
+        struct sockaddr_in *sin = (struct sockaddr_in *) &rp->dst;
         printf("%-*s ",
-            WID_DST(AF_INET),
-                (sin->sin_addr.s_addr == INADDR_ANY) ? "default" :
-                (rp->mask == 32 ?
-                    routexname(&rp->dst) :
-                    netxname(&rp->dst, rp->mask)));
-    }
-    else if (rp->af == AF_INET6) {
+               WID_DST(AF_INET),
+               (sin->sin_addr.s_addr == INADDR_ANY) ? "default" :
+               (rp->mask == 32 ?
+                routexname(&rp->dst) : netxname(&rp->dst, rp->mask)));
+    } else if (rp->af == AF_INET6) {
         struct sockaddr_in6 *sin6 = (struct sockaddr_in6 *)&rp->dst;
-        struct in6_addr in6_addr_any = IN6ADDR_ANY_INIT;
+        struct in6_addr in6_addr_any;
+
+        memset(&in6_addr_any, 0, sizeof(in6_addr_any)); /*IN6ADDR_ANY_INIT */
         printf("%-*s ",
-            WID_DST(AF_INET6),
-                memcmp(&sin6->sin6_addr, &in6_addr_any, sizeof(in6_addr_any)) == 0 ? "default" :
-                (rp->mask == 128 ?
-                    routexname(&rp->dst) :
-                    netxname(&rp->dst, rp->mask)));
+               WID_DST(AF_INET6),
+               memcmp(&sin6->sin6_addr, &in6_addr_any,
+                      sizeof(in6_addr_any)) == 0 ? "default" : (rp->mask ==
+                                                                128 ?
+                                                                routexname
+                                                                (&rp->dst)
+                                                                :
+                                                                netxname
+                                                                (&rp->dst,
+                                                                 rp->mask)));
     }
     printf("%-*s %-6.6s  %s",
-        WID_GW(rp->af),
-        1 ? routexname(&rp->hop) : "*",
-        s_rtflagsx(rp), rp->ifname);
+           WID_GW(rp->af),
+           1 ? routexname(&rp->hop) : "*", s_rtflagsx(rp), rp->ifname);
     if ((rp->set_bits & SET_AS) && rp->as != 0)
         printf(" (AS %d)", rp->as);
     printf("\n");
diff -urpN net-snmp-5.8/apps/snmpnetstat/winstub.c net-snmp-5.9.1/apps/snmpnetstat/winstub.c
--- net-snmp-5.8/apps/snmpnetstat/winstub.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpnetstat/winstub.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,11 +1,11 @@
 /*
- * cheap and dirty network database lookup functions 
+ * cheap and dirty network database lookup functions
  */
 /*
- * uses local files only 
+ * uses local files only
  */
 /*
- * currently searches the protocols only 
+ * currently searches the protocols only
  */
 
 #include <net-snmp/net-snmp-config.h>
@@ -74,7 +74,7 @@ pre_env(void)
     if (cp) {
         ;
         /*
-         * printf ("Root is '%s'\n", cp); 
+         * printf ("Root is '%s'\n", cp);
          */
     } else
         cp = "C:\\WINNT";
@@ -102,7 +102,7 @@ pre_env(void)
 }
 
 /*
- * sets can open. ends must close. 
+ * sets can open. ends must close.
  */
 void
 endhostent(void)
@@ -171,16 +171,17 @@ setnetent(int stay_open)
 #define STRTOK_DELIMS " \t\n"
 
 /*
- * get next entry from data base file, or from NIS if possible. 
+ * get next entry from data base file, or from NIS if possible.
  */
 /*
- * returns 0 if there are no more entries to read. 
+ * returns 0 if there are no more entries to read.
  */
 struct hostent *
 gethostent(void)
 {
     return 0;
 }
+
 struct servent *
 getservent(void)
 {
@@ -195,7 +196,7 @@ getprotoent(void)
     static char    *ali[10];
     struct protoent *px = &spx;
     int             linecnt = 0;
-    char            *st;
+    char           *st;
 
     for (alp = ali; *alp; free(*alp), *alp = 0, alp++);
     if (px->p_name)
@@ -242,6 +243,7 @@ getprotoent(void)
 
     return 0;
 }
+
 struct netent  *
 getnetent(void)
 {
@@ -255,7 +257,7 @@ getnetbyaddr(long net, int type)
 }
 
 /*
- * Return the network number from an internet address 
+ * Return the network number from an internet address
  */
 u_long
 inet_netof(struct in_addr in)
@@ -273,7 +275,7 @@ inet_netof(struct in_addr in)
 }
 
 /*
- * Return the host number from an internet address 
+ * Return the host number from an internet address
  */
 u_long
 inet_lnaof(struct in_addr in)
@@ -285,7 +287,7 @@ inet_lnaof(struct in_addr in)
     if (0x80 == (ii & 0xc0))
         return (0x0000ffff & i);
     /*
-     * if (0xc0 == (ii & 0xe0)) 
+     * if (0xc0 == (ii & 0xe0))
      */
     return (0x000000ff & i);
 }
diff -urpN net-snmp-5.8/apps/snmpnetstat/winstub.h net-snmp-5.9.1/apps/snmpnetstat/winstub.h
--- net-snmp-5.8/apps/snmpnetstat/winstub.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpnetstat/winstub.h	2021-05-26 05:19:35.000000000 +0700
@@ -7,11 +7,11 @@
 #if (defined(WIN32) || defined(cygwin))
 
 /*
- * database access functions for host, services, protocols, networks 
+ * database access functions for host, services, protocols, networks
  */
 
 /*
- * sets can open. ends must close. 
+ * sets can open. ends must close.
  */
 void            sethostent(int stay_open);
 void            setservent(int stay_open);
@@ -23,10 +23,10 @@ void            endprotoent(void);
 void            endnetent(void);
 
 /*
- * get next entry from data base file, or from NIS if possible. 
+ * get next entry from data base file, or from NIS if possible.
  */
 /*
- * returns 0 if there are no more entries to read. 
+ * returns 0 if there are no more entries to read.
  */
 struct hostent *gethostent(void);
 struct servent *getservent(void);
@@ -36,12 +36,12 @@ struct netent  *getnetent(void);
 struct netent  *getnetbyaddr(long net, int type);
 
 /*
- * Return the network number from an internet address 
+ * Return the network number from an internet address
  */
 u_long          inet_netof(struct in_addr in);
 
 /*
- * Return the host number from an internet address 
+ * Return the host number from an internet address
  */
 u_long          inet_lnaof(struct in_addr in);
 
diff -urpN net-snmp-5.8/apps/snmpping.c net-snmp-5.9.1/apps/snmpping.c
--- net-snmp-5.8/apps/snmpping.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpping.c	2021-05-26 05:19:35.000000000 +0700
@@ -36,6 +36,9 @@
  * DAMAGE.
  */
 
+/* For getlogin() on MinGW */
+#define _POSIX
+
 #include <net-snmp/net-snmp-config.h>
 
 #include <signal.h>
@@ -53,6 +56,12 @@
 #if HAVE_NETDB_H
 #include <netdb.h>
 #endif
+#if HAVE_UNISTD_H
+#include <unistd.h>
+#endif
+#if HAVE_IO_H
+#include <io.h>
+#endif
 
 #include <math.h>
 
@@ -202,6 +211,11 @@ add_var(netsnmp_pdu *pdu, const char *mi
         exit(1);
     }
 
+    if (base_length + indexlen > sizeof(base) / sizeof(base[0])) {
+        fprintf(stderr, "internal error for %s, giving up\n", mibnodename);
+        exit(1);
+    }
+
     if (index && indexlen) {
         memcpy(&(base[base_length]), index, indexlen * sizeof(oid));
         base_length += indexlen;
@@ -557,7 +571,7 @@ out:
     return 0;
 }
 
-#ifdef WIN32
+#ifndef HAVE_GETLOGIN
 /* To do: port this function to the Win32 platform. */
 const char *getlogin(void)
 {
@@ -622,7 +636,7 @@ int main(int argc, char **argv)
         usernameLen = strlen(username);
     }
     if (1 /* !have-testname-arg */) {
-        snprintf(testname, sizeof(testname) - 1, "snmpping-%d", getpid());
+        snprintf(testname, sizeof(testname) - 1, "snmpping-%ld", (long)getpid());
         testname[32] = '\0';
         testnameLen = strlen(testname);
     }
diff -urpN net-snmp-5.8/apps/snmpps.c net-snmp-5.9.1/apps/snmpps.c
--- net-snmp-5.8/apps/snmpps.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpps.c	2021-05-26 05:19:35.000000000 +0700
@@ -196,6 +196,11 @@ add(netsnmp_pdu *pdu, const char *mibnod
         exit(1);
     }
 
+    if (base_length + indexlen > sizeof(base) / sizeof(base[0])) {
+        fprintf(stderr, "internal error for %s, giving up\n", mibnodename);
+        exit(1);
+    }
+
     if (index && indexlen) {
         memcpy(&(base[base_length]), index, indexlen * sizeof(oid));
         base_length += indexlen;
@@ -332,44 +337,52 @@ collect_perf(netsnmp_session *ss, struct
         proc.hrSWRunIndex = vlp->name[base_length];
 
         vlp2 = response->variables;
-        if (vlp2->type == SNMP_NOSUCHINSTANCE) goto next;
+        if (vlp2->type == SNMP_NOSUCHINSTANCE ||
+            vlp2->type == SNMP_NOSUCHOBJECT) goto next;
         len = vlp2->val_len;
         proc.hrSWRunName = malloc(len+1);
         memcpy(proc.hrSWRunName, vlp2->val.string, len);
         proc.hrSWRunName[len] = '\0';
 
         vlp2 = vlp2->next_variable;
-        if (vlp2->type == SNMP_NOSUCHINSTANCE) goto next;
+        if (vlp2->type == SNMP_NOSUCHINSTANCE ||
+            vlp2->type == SNMP_NOSUCHOBJECT) goto next;
         proc.hrSWRunID = *vlp2->val.integer;
 
         vlp2 = vlp2->next_variable;
-        if (vlp2->type == SNMP_NOSUCHINSTANCE) goto next;
+        if (vlp2->type == SNMP_NOSUCHINSTANCE ||
+            vlp2->type == SNMP_NOSUCHOBJECT) goto next;
         len = vlp2->val_len;
         proc.hrSWRunPath = malloc(len+1);
         memcpy(proc.hrSWRunPath, vlp2->val.string, len);
         proc.hrSWRunPath[len] = '\0';
 
         vlp2 = vlp2->next_variable;
-        if (vlp2->type == SNMP_NOSUCHINSTANCE) goto next;
+        if (vlp2->type == SNMP_NOSUCHINSTANCE ||
+            vlp2->type == SNMP_NOSUCHOBJECT) goto next;
         len = vlp2->val_len;
         proc.hrSWRunParameters = malloc(len+1);
         memcpy(proc.hrSWRunParameters, vlp2->val.string, len);
         proc.hrSWRunParameters[len] = '\0';
 
         vlp2 = vlp2->next_variable;
-        if (vlp2->type == SNMP_NOSUCHINSTANCE) goto next;
+        if (vlp2->type == SNMP_NOSUCHINSTANCE ||
+            vlp2->type == SNMP_NOSUCHOBJECT) goto next;
         proc.hrSWRunType = *vlp2->val.integer;
 
         vlp2 = vlp2->next_variable;
-        if (vlp2->type == SNMP_NOSUCHINSTANCE) goto next;
+        if (vlp2->type == SNMP_NOSUCHINSTANCE ||
+            vlp2->type == SNMP_NOSUCHOBJECT) goto next;
         proc.hrSWRunStatus = *vlp2->val.integer;
 
         vlp2 = vlp2->next_variable;
-        if (vlp2->type == SNMP_NOSUCHINSTANCE) goto next;
+        if (vlp2->type == SNMP_NOSUCHINSTANCE ||
+            vlp2->type == SNMP_NOSUCHOBJECT) goto next;
         proc.hrSWRunPerfCPU = *vlp2->val.integer;
 
         vlp2 = vlp2->next_variable;
-        if (vlp2->type == SNMP_NOSUCHINSTANCE) goto next;
+        if (vlp2->type == SNMP_NOSUCHINSTANCE ||
+            vlp2->type == SNMP_NOSUCHOBJECT) goto next;
         proc.hrSWRunPerfMem = *vlp2->val.integer;
 
         count++;
@@ -975,6 +988,8 @@ int snmptop(int argc, char **argv)
     }
     endwin();
 
+    free_perf(oproc, ocount);
+
     snmp_close(ss);
     SOCK_CLEANUP;
     return 0;
diff -urpN net-snmp-5.8/apps/snmpset.c net-snmp-5.9.1/apps/snmpset.c
--- net-snmp-5.8/apps/snmpset.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpset.c	2021-05-26 05:19:35.000000000 +0700
@@ -166,8 +166,8 @@ main(int argc, char *argv[])
      */
     for (; arg < argc; arg++) {
         DEBUGMSGTL(("snmp_parse_args", "handling (#%d): %s %s %s\n",
-                    arg,argv[arg], arg+1 < argc ? argv[arg+1] : NULL,
-                    arg+2 < argc ? argv[arg+2] : NULL));
+                    arg, argv[arg], arg+1 < argc ? argv[arg+1] : "",
+                    arg+2 < argc ? argv[arg+2] : ""));
         names[current_name++] = argv[arg++];
         if (arg < argc) {
             switch (*argv[arg]) {
diff -urpN net-snmp-5.8/apps/snmptable.c net-snmp-5.9.1/apps/snmptable.c
--- net-snmp-5.8/apps/snmptable.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmptable.c	2021-05-26 05:19:35.000000000 +0700
@@ -709,7 +709,6 @@ get_table_entries(netsnmp_session * ss)
                              vars->name_length)) {
                             break;
                         }
-                        i = vars->name_length - rootlen + 1;
                         if (localdebug || show_index) {
                             if (netsnmp_ds_get_boolean(NETSNMP_DS_LIBRARY_ID, 
                                               NETSNMP_DS_LIB_EXTENDED_INDEX)) {
@@ -753,6 +752,14 @@ get_table_entries(netsnmp_session * ss)
                     if (localdebug && buf) {
                         printf("%s => taken\n", buf);
                     }
+                    if (dp[col]) {
+                        fprintf(stderr, "OID not increasing: %s\n", buf);
+                        running = 0;
+                        vars = NULL;
+                        end_of_table = 1;
+                        exitval = 2;
+                        break;
+                    }
                     out_len = 0;
                     sprint_realloc_value((u_char **)&buf, &buf_len, &out_len, 1,
                                          vars->name, vars->name_length,
@@ -770,8 +777,11 @@ get_table_entries(netsnmp_session * ss)
                         column[col].width = i;
                     }
                 }
-                if (buf)
+                if (buf) {
                     free(buf);
+                    buf = NULL;
+                    buf_len = 0;
+                }
 
                 if (end_of_table) {
                     --entries;
@@ -779,8 +789,7 @@ get_table_entries(netsnmp_session * ss)
                      * not part of this subtree 
                      */
                     if (localdebug) {
-                        printf("End of table: %s\n",
-                               buf ? (char *) buf : "[NIL]");
+                        printf("End of table\n");
                     }
                     snmp_free_pdu(response);
                     running = 0;
@@ -967,6 +976,13 @@ getbulk_table_entries(netsnmp_session *
                             index_width = i;
                     }
                     dp = data + row * fields;
+                    if (dp[col]) {
+                        fprintf(stderr, "OID not increasing: %s\n", buf);
+                        exitval = 2;
+                        end_of_table = 1;
+                        running = 0;
+                        break;
+                    }
                     out_len = 0;
                     sprint_realloc_value((u_char **)&buf, &buf_len, &out_len, 1,
                                          vars->name, vars->name_length,
@@ -988,8 +1004,11 @@ getbulk_table_entries(netsnmp_session *
                     memcpy(name, last_var->name,
                            name_length * sizeof(oid));
                 }
-                if (buf)
+                if (buf) {
                     free(buf);
+                    buf = NULL;
+                    buf_len = 0;
+                }
             } else {
                 /*
                  * error in response, print it 
diff -urpN net-snmp-5.8/apps/snmptls.c net-snmp-5.9.1/apps/snmptls.c
--- net-snmp-5.8/apps/snmptls.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmptls.c	2021-05-26 05:19:35.000000000 +0700
@@ -9,10 +9,13 @@
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 
-netsnmp_feature_require(tls_fingerprint_build)
-netsnmp_feature_require(row_create)
+netsnmp_feature_require(tls_fingerprint_build);
+netsnmp_feature_require(row_create);
 
 #include <ctype.h>
+#if HAVE_UNISTD_H
+#include <unistd.h>
+#endif
 
 #include <openssl/ssl.h>
 #include <openssl/x509.h>
diff -urpN net-snmp-5.8/apps/snmptrap.c net-snmp-5.9.1/apps/snmptrap.c
--- net-snmp-5.8/apps/snmptrap.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmptrap.c	2021-05-26 05:19:35.000000000 +0700
@@ -214,6 +214,9 @@ main(int argc, char *argv[])
             session.engineBoots = 1;
         if (session.engineTime == 0)    /* not really correct, */
             session.engineTime = get_uptime();  /* but it'll work. Sort of. */
+
+        set_enginetime(session.securityEngineID, session.securityEngineIDLen,
+                       session.engineBoots, session.engineTime, TRUE);
     }
 
     ss = snmp_add(&session,
diff -urpN net-snmp-5.8/apps/snmptrapd.c net-snmp-5.9.1/apps/snmptrapd.c
--- net-snmp-5.8/apps/snmptrapd.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmptrapd.c	2021-05-26 05:19:35.000000000 +0700
@@ -98,6 +98,7 @@ SOFTWARE.
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 #include <net-snmp/library/fd_event_manager.h>
 #include <net-snmp/agent/netsnmp_close_fds.h>
+#include "../snmplib/snmp_syslog.h"
 #include "../agent_global_vars.h"
 #include "../agent/mibgroup/snmpv3/snmpEngine.h"
 #include "../agent/mibgroup/snmpv3/usmUser.h"
@@ -152,43 +153,6 @@ char           *trap1_fmt_str_remember =
 int             dofork = 1;
 
 /*
- * These definitions handle 4.2 systems without additional syslog facilities.
- */
-#ifndef LOG_CONS
-#define LOG_CONS	0       /* Don't bother if not defined... */
-#endif
-#ifndef LOG_PID
-#define LOG_PID		0       /* Don't bother if not defined... */
-#endif
-#ifndef LOG_LOCAL0
-#define LOG_LOCAL0	0
-#endif
-#ifndef LOG_LOCAL1
-#define LOG_LOCAL1	0
-#endif
-#ifndef LOG_LOCAL2
-#define LOG_LOCAL2	0
-#endif
-#ifndef LOG_LOCAL3
-#define LOG_LOCAL3	0
-#endif
-#ifndef LOG_LOCAL4
-#define LOG_LOCAL4	0
-#endif
-#ifndef LOG_LOCAL5
-#define LOG_LOCAL5	0
-#endif
-#ifndef LOG_LOCAL6
-#define LOG_LOCAL6	0
-#endif
-#ifndef LOG_LOCAL7
-#define LOG_LOCAL7	0
-#endif
-#ifndef LOG_DAEMON
-#define LOG_DAEMON	0
-#endif
-
-/*
  * Include an extra Facility variable to allow command line adjustment of
  * syslog destination 
  */
@@ -448,65 +412,6 @@ parse_config_pidFile(const char *token,
   pid_file = strdup (cptr);
 }
 
-#ifdef HAVE_UNISTD_H
-void
-parse_config_agentuser(const char *token, char *cptr)
-{
-    if (cptr[0] == '#') {
-        char           *ecp;
-        int             uid;
-
-        uid = strtoul(cptr + 1, &ecp, 10);
-        if (*ecp != 0) {
-            config_perror("Bad number");
-	} else {
-	    netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID, 
-			       NETSNMP_DS_AGENT_USERID, uid);
-	}
-#if defined(HAVE_GETPWNAM) && defined(HAVE_PWD_H)
-    } else {
-        struct passwd *info;
-
-        info = getpwnam(cptr);
-        if (info)
-            netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID, 
-                               NETSNMP_DS_AGENT_USERID, info->pw_uid);
-        else
-            config_perror("User not found in passwd database");
-        endpwent();
-#endif
-    }
-}
-
-void
-parse_config_agentgroup(const char *token, char *cptr)
-{
-    if (cptr[0] == '#') {
-        char           *ecp;
-        int             gid = strtoul(cptr + 1, &ecp, 10);
-
-        if (*ecp != 0) {
-            config_perror("Bad number");
-	} else {
-            netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID, 
-			       NETSNMP_DS_AGENT_GROUPID, gid);
-	}
-#if defined(HAVE_GETGRNAM) && defined(HAVE_GRP_H)
-    } else {
-        struct group   *info;
-
-        info = getgrnam(cptr);
-        if (info)
-            netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID, 
-                               NETSNMP_DS_AGENT_GROUPID, info->gr_gid);
-        else
-            config_perror("Group not found in group database");
-        endgrent();
-#endif
-    }
-}
-#endif
-
 void
 parse_config_doNotFork(const char *token, char *cptr)
 {
@@ -533,12 +438,22 @@ parse_config_outputOption(const char *to
   }
 }
 
+void
+parse_config_addForwarderInfo(const char *token, char *cptr)
+{
+    if (netsnmp_ds_parse_boolean(cptr) == 1) {
+        netsnmp_ds_set_boolean(NETSNMP_DS_LIBRARY_ID,
+                               NETSNMP_DS_LIB_ADD_FORWARDER_INFO, 1);
+    }
+}
+
 static void
 snmptrapd_main_loop(void)
 {
     int             count, numfds, block;
     fd_set          readfds,writefds,exceptfds;
-    struct timeval  timeout, *tvp;
+    struct timeval  timeout;
+    NETSNMP_SELECT_TIMEVAL timeout2;
 
     while (netsnmp_running) {
         if (reconfig) {
@@ -562,16 +477,16 @@ snmptrapd_main_loop(void)
         FD_ZERO(&writefds);
         FD_ZERO(&exceptfds);
         block = 0;
-        tvp = &timeout;
-        timerclear(tvp);
-        tvp->tv_sec = 5;
-        snmp_select_info(&numfds, &readfds, tvp, &block);
-        if (block == 1)
-            tvp = NULL;         /* block without timeout */
+        timerclear(&timeout);
+        timeout.tv_sec = 5;
+        snmp_select_info(&numfds, &readfds, &timeout, &block);
 #ifndef NETSNMP_FEATURE_REMOVE_FD_EVENT_MANAGER
         netsnmp_external_event_info(&numfds, &readfds, &writefds, &exceptfds);
 #endif /* NETSNMP_FEATURE_REMOVE_FD_EVENT_MANAGER */
-        count = select(numfds, &readfds, &writefds, &exceptfds, tvp);
+        timeout2.tv_sec = timeout.tv_sec;
+        timeout2.tv_usec = timeout.tv_usec;
+        count = select(numfds, &readfds, &writefds, &exceptfds,
+                       !block ? &timeout2 : NULL);
         if (count > 0) {
 #ifndef NETSNMP_FEATURE_REMOVE_FD_EVENT_MANAGER
             netsnmp_dispatch_external_events(&count, &readfds, &writefds,
@@ -693,11 +608,11 @@ main(int argc, char *argv[])
 #endif
 #ifdef HAVE_UNISTD_H
     register_config_handler("snmptrapd", "agentuser",
-                            parse_config_agentuser, NULL, "userid");
+                            netsnmp_parse_agent_user, NULL, "userid");
     register_config_handler("snmptrapd", "agentgroup",
-                            parse_config_agentgroup, NULL, "groupid");
+                            netsnmp_parse_agent_group, NULL, "groupid");
 #endif
-    
+
     register_config_handler("snmptrapd", "doNotFork",
                             parse_config_doNotFork, NULL, "(1|yes|true|0|no|false)");
 
@@ -707,6 +622,10 @@ main(int argc, char *argv[])
     register_config_handler("snmptrapd", "outputOption",
                             parse_config_outputOption, NULL, "string");
 
+    register_config_handler("snmptrapd", "addForwarderInfo",
+                            parse_config_addForwarderInfo, NULL,
+                            "(1|yes|true|0|no|false)");
+
 #ifndef NETSNMP_FEATURE_REMOVE_LOGGING_SYSLOG
 #ifdef WIN32
     snmp_log_syslogname(app_name_long);
@@ -794,8 +713,8 @@ main(int argc, char *argv[])
 #if HAVE_UNISTD_H
         case 'g':
             if (optarg != NULL) {
-                netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID, 
-				   NETSNMP_DS_AGENT_GROUPID, gid = atoi(optarg));
+                gid = atoi(optarg);
+                netsnmp_set_agent_group_id(gid);
             } else {
                 usage();
                 goto out;
@@ -924,8 +843,7 @@ main(int argc, char *argv[])
                     fprintf(stderr, "Bad user id: %s\n", optarg);
                     goto out;
                 }
-                netsnmp_ds_set_int(NETSNMP_DS_APPLICATION_ID, 
-				   NETSNMP_DS_AGENT_USERID, uid);
+                netsnmp_set_agent_user_id(uid);
             } else {
                 usage();
                 goto out;
@@ -1370,9 +1288,8 @@ trapd_update_config(void)
 * Invokes appropriate startup functions depending on the 
 * parameters passed
 *************************************************************/
-int
-    __cdecl
-_tmain(int argc, TCHAR * argv[])
+int __cdecl
+main(int argc, TCHAR * argv[])
 {
     /*
      * Define Service Name and Description, which appears in windows SCM 
@@ -1387,7 +1304,7 @@ _tmain(int argc, TCHAR * argv[])
 #endif
     InputParams     InputOptions;
 
-    int             nRunType = RUN_AS_CONSOLE;
+    enum net_snmp_cmd_line_action nRunType = RUN_AS_CONSOLE;
     int             quiet = 0;
 
     nRunType = ParseCmdLineForServiceOption(argc, argv, &quiet);
diff -urpN net-snmp-5.8/apps/snmptrapd_handlers.c net-snmp-5.9.1/apps/snmptrapd_handlers.c
--- net-snmp-5.8/apps/snmptrapd_handlers.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmptrapd_handlers.c	2021-05-26 05:19:35.000000000 +0700
@@ -15,6 +15,9 @@
 #endif
 #include <ctype.h>
 #include <sys/types.h>
+#if HAVE_ARPA_INET_H
+#include <arpa/inet.h>
+#endif
 #if HAVE_NETINET_IN_H
 #include <netinet/in.h>
 #endif
@@ -38,7 +41,7 @@
 #include "snmptrapd_log.h"
 #include "notification-log-mib/notification_log.h"
 
-netsnmp_feature_child_of(add_default_traphandler, snmptrapd)
+netsnmp_feature_child_of(add_default_traphandler, snmptrapd);
 
 char *syslog_format1 = NULL;
 char *syslog_format2 = NULL;
@@ -881,6 +884,121 @@ int axforward_handler( netsnmp_pdu
     return NETSNMPTRAPD_HANDLER_OK;
 }
 
+static int add_forwarder_info(netsnmp_pdu *pdu, netsnmp_pdu *pdu2)
+{
+    netsnmp_indexed_addr_pair *addr_pair1;
+    struct sockaddr_in *to1 = NULL;
+    struct sockaddr_in *to2 = NULL;
+    int            last_snmpTrapAddress_index = -1;
+    /* snmpTrapAddress_oid.0 is also defined as agentaddr_oid */
+    const oid      snmpTrapAddress_oid[]   = { 1,3,6,1,6,3,18,1,3};
+    /* each forwarder will add this OID with changed last index */
+    oid            forwarder_oid[]   =       { 1,3,6,1,6,3,18,1,3,0};
+    const size_t   snmpTrapAddress_oid_size = OID_LENGTH(snmpTrapAddress_oid);
+    const size_t   forwarder_oid_len = OID_LENGTH(forwarder_oid);
+    struct in_addr agent_addr;
+    struct in_addr my_ip_addr;
+
+    memset(&agent_addr, 0, sizeof(agent_addr));
+    memset(&my_ip_addr, 0, sizeof(my_ip_addr));
+
+    if (pdu && pdu->transport_data &&
+        pdu->transport_data_length == sizeof(*addr_pair1)) {
+        addr_pair1 = (netsnmp_indexed_addr_pair *)pdu->transport_data;
+
+        /*
+         * Get the IPv4 address of the host that this trap was sent from =
+         * last forwarder's IP address.
+         */
+        if (addr_pair1->remote_addr.sa.sa_family == AF_INET) {
+            to1 = (struct sockaddr_in *)&(addr_pair1->remote_addr);
+            agent_addr = to1->sin_addr;
+        }
+        /*
+         * Get the IPv4 address of the host that this trap was sent to =
+         * this forwarder's IP address.
+         */
+        if (addr_pair1->local_addr.sa.sa_family == AF_INET) {
+            to2 = (struct sockaddr_in *)&(addr_pair1->local_addr);
+            my_ip_addr = to2->sin_addr;
+        }
+    }
+
+    if (to1) {
+        netsnmp_variable_list *vblist = NULL;
+        netsnmp_variable_list *var = NULL;
+
+        if (*(in_addr_t *)pdu2->agent_addr == INADDR_ANY) {
+            /*
+             * there was no agent address defined in PDU. copy the forwarding
+             * agent IP address from the transport socket.
+             */
+            *(struct in_addr *)pdu2->agent_addr = agent_addr;
+        }
+
+        vblist = pdu2->variables;
+
+        /*
+         * Iterate over all varbinds in the PDU to see if it already has any
+         * forwarder information.
+         */
+        for (var = vblist; var; var = var->next_variable) {
+            if (snmp_oid_ncompare(var->name, var->name_length,
+                                  snmpTrapAddress_oid,
+                                  snmpTrapAddress_oid_size,
+                                  snmpTrapAddress_oid_size) == 0) {
+                int my_snmpTrapAddress_index =
+                    var->name[var->name_length - 1];
+
+                DEBUGMSGTL(("snmptrapd", "  my_snmpTrapAddress_index=%d, last_snmpTrapAddress_index=%d, my_ip_addr=%s\n",
+                            my_snmpTrapAddress_index,
+                            last_snmpTrapAddress_index,
+                            inet_ntoa(my_ip_addr)));
+
+                if (last_snmpTrapAddress_index < my_snmpTrapAddress_index)
+                    last_snmpTrapAddress_index = my_snmpTrapAddress_index;
+
+                /* Detect forwarding loop. */
+                if (var->val_len < 4) {
+                    snmp_log(LOG_ERR, "Length of IP address of OID .1.3.6.1.6.3.18.1.3.%d in PDU is less than %d bytes = %d\n",
+                             my_snmpTrapAddress_index, 4,
+                             (int)var->val_len);
+                } else {
+                    if (to2 &&
+                        memcmp(var->val.string, &my_ip_addr, 4) == 0) {
+                        snmp_log(LOG_ERR, "Forwarding loop detected, OID .1.3.6.1.6.3.18.1.3.%d already has this forwarder's IP address=%s, not forwarding this trap\n",
+                                 my_snmpTrapAddress_index,
+                                 inet_ntoa(my_ip_addr));
+                        return 0;
+                    }
+                    if (memcmp(var->val.string, &agent_addr, 4) == 0) {
+                        snmp_log(LOG_ERR, "Forwarding loop detected, OID .1.3.6.1.6.3.18.1.3.%d already has the sender's IP address=%s, not forwarding this trap\n",
+                                 my_snmpTrapAddress_index,
+                                 inet_ntoa(agent_addr));
+                        return 0;
+                    }
+                }
+            }
+        } /* for var in vblist */
+
+        DEBUGMSGTL(("snmptrapd",
+                    "  last_snmpTrapAddress_index=%d, adding index=%d\n",
+                    last_snmpTrapAddress_index, last_snmpTrapAddress_index+1));
+        /* Change the last index of this OID to the next avaiable number. */
+        forwarder_oid[forwarder_oid_len - 1] = last_snmpTrapAddress_index + 1;
+
+        /*
+         * Add forwarder IP address as OID to trap payload. Use the value
+         * from the transport, so if a v1 PDU is sent, the same IP is not
+         * duplicated you want every forwarder to add this OID with its
+         * own IP address.
+         */
+        snmp_pdu_add_variable(pdu2, forwarder_oid, forwarder_oid_len,
+                              ASN_IPADDRESS, (u_char *)&agent_addr, 4);
+    }
+    return 1;
+}
+
 /*
  *  Trap handler for forwarding to another destination
  */
@@ -912,6 +1030,14 @@ int   forward_handler( netsnmp_pdu
        INFORMS which may require engineID probing */
 
     pdu2 = snmp_clone_pdu(pdu);
+
+    if (netsnmp_ds_get_boolean(NETSNMP_DS_LIBRARY_ID,
+                               NETSNMP_DS_LIB_ADD_FORWARDER_INFO) &&
+        !add_forwarder_info(pdu, pdu2)) {
+        snmp_close(ss);
+        return NETSNMPTRAPD_HANDLER_FAIL;
+    }
+
     if (pdu2->transport_data) {
         free(pdu2->transport_data);
         pdu2->transport_data        = NULL;
diff -urpN net-snmp-5.8/apps/snmptrapd_handlers.h net-snmp-5.9.1/apps/snmptrapd_handlers.h
--- net-snmp-5.8/apps/snmptrapd_handlers.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmptrapd_handlers.h	2021-05-26 05:19:35.000000000 +0700
@@ -62,8 +62,6 @@ netsnmp_trapd_handler *netsnmp_add_traph
 netsnmp_trapd_handler *netsnmp_get_traphandler(oid *trapOid, int trapOidLen);
 
 const char *trap_description(int trap);
-void do_external(char *cmd, struct hostent *host,
-            netsnmp_pdu *pdu, netsnmp_transport *transport);
 int snmp_input(int op, netsnmp_session *session,
            int reqid, netsnmp_pdu *pdu, void *magic);
 
diff -urpN net-snmp-5.8/apps/snmptrapd_log.c net-snmp-5.9.1/apps/snmptrapd_log.c
--- net-snmp-5.8/apps/snmptrapd_log.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmptrapd_log.c	2021-05-26 05:19:35.000000000 +0700
@@ -587,6 +587,20 @@ realloc_handle_time_fmt(u_char ** buf, s
                                    (u_char **) & safe_bfr, options);
 }
 
+static
+void convert_agent_addr(struct in_addr agent_addr, char *name, size_t size)
+{
+    const int numeric = !netsnmp_ds_get_boolean(NETSNMP_DS_APPLICATION_ID,
+                                                NETSNMP_DS_APP_NUMERIC_IP);
+    struct sockaddr_in sin;
+
+    memset(&sin, 0, sizeof(sin));
+    sin.sin_family = AF_INET;
+    sin.sin_addr = agent_addr;
+    if (getnameinfo((struct sockaddr *)&sin, sizeof(sin), name, size, NULL, 0,
+                    numeric ? NI_NUMERICHOST : 0) < 0)
+        strlcpy(name, "?", sizeof(size));
+}
 
 static int
 realloc_handle_ip_fmt(u_char ** buf, size_t * buf_len, size_t * out_len,
@@ -609,7 +623,7 @@ realloc_handle_ip_fmt(u_char ** buf, siz
       */
 {
     struct in_addr *agent_inaddr = (struct in_addr *) pdu->agent_addr;
-    struct hostent *host = NULL;       /* corresponding host name */
+    char            host[16];                   /* corresponding host name */
     char            fmt_cmd = options->cmd;     /* what we're formatting */
     u_char         *temp_buf = NULL;
     size_t          temp_buf_len = 64, temp_out_len = 0;
@@ -642,26 +656,14 @@ realloc_handle_ip_fmt(u_char ** buf, siz
          * Try to resolve the agent_addr field as a hostname; fall back
          * to numerical address.  
          */
-        if (!netsnmp_ds_get_boolean(NETSNMP_DS_APPLICATION_ID, 
-                                    NETSNMP_DS_APP_NUMERIC_IP)) {
-            host = netsnmp_gethostbyaddr((char *) pdu->agent_addr, 4, AF_INET);
-        }
-        if (host != NULL) {
-            if (!snmp_strcat(&temp_buf, &temp_buf_len, &temp_out_len, 1,
-                             (const u_char *)host->h_name)) {
-                if (temp_buf != NULL) {
-                    free(temp_buf);
-                }
-                return 0;
-            }
-        } else {
-            if (!snmp_strcat(&temp_buf, &temp_buf_len, &temp_out_len, 1,
-                             (u_char *)inet_ntoa(*agent_inaddr))) {
-                if (temp_buf != NULL) {
-                    free(temp_buf);
-                }
-                return 0;
+        convert_agent_addr(*(struct in_addr *)pdu->agent_addr,
+                           host, sizeof(host));
+        if (!snmp_strcat(&temp_buf, &temp_buf_len, &temp_out_len, 1,
+                         (const u_char *)host)) {
+            if (temp_buf != NULL) {
+                free(temp_buf);
             }
+            return 0;
         }
         break;
 
@@ -1335,7 +1337,7 @@ realloc_format_plain_trap(u_char ** buf,
     struct tm      *now_parsed; /* time in struct format */
     char            safe_bfr[200];      /* holds other strings */
     struct in_addr *agent_inaddr = (struct in_addr *) pdu->agent_addr;
-    struct hostent *host = NULL;       /* host name */
+    char host[16];                      /* host name */
     netsnmp_variable_list *vars;        /* variables assoc with trap */
 
     if (buf == NULL) {
@@ -1362,36 +1364,18 @@ realloc_format_plain_trap(u_char ** buf,
     /*
      * Get info about the sender.  
      */
-    if (!netsnmp_ds_get_boolean(NETSNMP_DS_APPLICATION_ID, 
-                                NETSNMP_DS_APP_NUMERIC_IP)) {
-        host = netsnmp_gethostbyaddr((char *) pdu->agent_addr, 4, AF_INET);
-    }
-    if (host != (struct hostent *) NULL) {
-        if (!snmp_strcat
-            (buf, buf_len, out_len, allow_realloc,
-             (const u_char *) host->h_name)) {
-            return 0;
-        }
-        if (!snmp_strcat
-            (buf, buf_len, out_len, allow_realloc,
-             (const u_char *) " [")) {
-            return 0;
-        }
-        if (!snmp_strcat(buf, buf_len, out_len, allow_realloc,
-                         (const u_char *) inet_ntoa(*agent_inaddr))) {
-            return 0;
-        }
-        if (!snmp_strcat
-            (buf, buf_len, out_len, allow_realloc,
-             (const u_char *) "] ")) {
-            return 0;
-        }
-    } else {
-        if (!snmp_strcat(buf, buf_len, out_len, allow_realloc,
-                         (const u_char *) inet_ntoa(*agent_inaddr))) {
-            return 0;
-        }
-    }
+    convert_agent_addr(*(struct in_addr *)pdu->agent_addr, host, sizeof(host));
+    if (!snmp_strcat(buf, buf_len, out_len, allow_realloc, (u_char *)host))
+        return 0;
+    if (!snmp_strcat(buf, buf_len, out_len, allow_realloc,
+                      (const u_char *)" ["))
+        return 0;
+    if (!snmp_strcat(buf, buf_len, out_len, allow_realloc,
+                     (u_char *)inet_ntoa(*agent_inaddr)))
+        return 0;
+    if (!snmp_strcat(buf, buf_len, out_len, allow_realloc,
+                     (const u_char *)"] "))
+        return 0;
 
     /*
      * Append PDU transport info.  
diff -urpN net-snmp-5.8/apps/snmptrapd_sql.c net-snmp-5.9.1/apps/snmptrapd_sql.c
--- net-snmp-5.8/apps/snmptrapd_sql.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmptrapd_sql.c	2021-05-26 05:19:35.000000000 +0700
@@ -60,7 +60,7 @@
 #include "snmptrapd_log.h"
 #include "snmptrapd_sql.h"
 
-netsnmp_feature_require(container_fifo)
+netsnmp_feature_require(container_fifo);
 
 /*
  * define a structure to hold all the file globals
@@ -199,7 +199,7 @@ typedef struct sql_buf_t {
  * static bind structures, plus 2 static buffers to bind to.
  */
 static MYSQL_BIND _tbind[TBIND_MAX], _vbind[VBIND_MAX];
-static my_bool    _no_v3;
+static char       _no_v3;
 
 static void _sql_process_queue(u_int dontcare, void *meeither);
 
@@ -421,9 +421,6 @@ netsnmp_mysql_connect(void)
 int
 netsnmp_mysql_init(void)
 {
-    int not_argc = 0, i;
-    char *not_args[] = { NULL };
-    char **not_argv = not_args;
     netsnmp_trapd_handler *traph;
 
     DEBUGMSGTL(("sql:init","called\n"));
@@ -450,14 +447,22 @@ netsnmp_mysql_init(void)
     my_init();
 #endif
 
+#if !defined(HAVE_MYSQL_OPTIONS)
+    {
+    int not_argc = 0, i;
+    char *not_args[] = { NULL };
+    char **not_argv = not_args;
+
     /** load .my.cnf values */
 #if HAVE_MY_LOAD_DEFAULTS
     my_load_defaults ("my", _sql.groups, &not_argc, &not_argv, 0);
 #elif defined(HAVE_LOAD_DEFAULTS)
     load_defaults ("my", _sql.groups, &not_argc, &not_argv);
+#else
+#error Neither load_defaults() nor mysql_options() are available.
 #endif
 
-    for(i=0; i < not_argc; ++i) {
+    for (i = 0; i < not_argc; ++i) {
         if (NULL == not_argv[i])
             continue;
         if (strncmp(not_argv[i],"--password=",11) == 0)
@@ -475,6 +480,8 @@ netsnmp_mysql_init(void)
         else
             snmp_log(LOG_WARNING, "unknown argument[%d] %s\n", i, not_argv[i]);
     }
+    }
+#endif /* !defined(HAVE_MYSQL_OPTIONS) */
 
     /** init bind structures */
     memset(_tbind, 0x0, sizeof(_tbind));
@@ -554,7 +561,7 @@ netsnmp_mysql_init(void)
         return -1;
     }
 
-#if MYSQL_VERSION_ID >= 100000
+#if HAVE_MYSQL_OPTIONS
     mysql_options(_sql.conn, MYSQL_READ_DEFAULT_GROUP, "snmptrapd");
 #endif
 
diff -urpN net-snmp-5.8/apps/snmpusm.c net-snmp-5.9.1/apps/snmpusm.c
--- net-snmp-5.8/apps/snmpusm.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpusm.c	2021-05-26 05:19:35.000000000 +0700
@@ -17,6 +17,11 @@
  * distributed with the Net-SNMP package.
  */
 #include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/library/snmp_openssl.h>
+#if defined(HAVE_OPENSSL_DH_H) && defined(HAVE_LIBCRYPTO)
+#include <openssl/dh.h>
+#endif /* HAVE_OPENSSL_DH_H && HAVE_LIBCRYPTO */
 
 #if HAVE_STDLIB_H
 #include <stdlib.h>
@@ -55,13 +60,6 @@
 #include <arpa/inet.h>
 #endif
 
-#if defined(HAVE_OPENSSL_DH_H) && defined(HAVE_LIBCRYPTO)
-#include <openssl/dh.h>
-#endif /* HAVE_OPENSSL_DH_H && HAVE_LIBCRYPTO */
-
-#include <net-snmp/net-snmp-includes.h>
-#include <net-snmp/library/snmp_openssl.h>
-
 #define CMD_PASSWD_NAME    "passwd"
 #define CMD_PASSWD         1
 #define CMD_CREATE_NAME    "create"
diff -urpN net-snmp-5.8/apps/snmpwalk.c net-snmp-5.9.1/apps/snmpwalk.c
--- net-snmp-5.8/apps/snmpwalk.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/snmpwalk.c	2021-05-26 05:19:35.000000000 +0700
@@ -346,6 +346,7 @@ main(int argc, char *argv[])
                             && snmp_oid_compare(name, name_length,
                                                 vars->name,
                                                 vars->name_length) >= 0) {
+                            fflush(stdout);
                             fprintf(stderr, "Error: OID not increasing: ");
                             fprint_objid(stderr, name, name_length);
                             fprintf(stderr, " >= ");
diff -urpN net-snmp-5.8/apps/sshtosnmp.c net-snmp-5.9.1/apps/sshtosnmp.c
--- net-snmp-5.8/apps/sshtosnmp.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/apps/sshtosnmp.c	2021-05-26 05:19:35.000000000 +0700
@@ -123,24 +123,29 @@ main(int argc, char **argv) {
     /* send the prelim message and the credentials together using sendmsg() */
     {
         struct msghdr m;
-        struct {
-           struct cmsghdr cm;
-           struct ucred ouruser;
+        /*
+         * Ancillary data buffer, wrapped in a union in order to ensure it is
+         * suitably aligned.
+         */
+        union {
+            char buf[CMSG_SPACE(sizeof(struct ucred))];
+            struct cmsghdr cm;
         } cmsg;
+        struct ucred *const ouruser = (void *)CMSG_DATA(&cmsg.cm);
         struct iovec iov = { buf, buf_len };
 
         /* Make sure that even padding fields get initialized.*/
         memset(&cmsg, 0, sizeof(cmsg));
         memset(&m, 0, sizeof(m));
 
-        /* set up the basic message */
-        cmsg.cm.cmsg_len = sizeof(struct cmsghdr) + sizeof(struct ucred);
+        /* set up the message header */
+        cmsg.cm.cmsg_len = sizeof(cmsg);
         cmsg.cm.cmsg_level = SOL_SOCKET;
         cmsg.cm.cmsg_type = SCM_CREDENTIALS;
 
-        cmsg.ouruser.uid = getuid();
-        cmsg.ouruser.gid = getgid();
-        cmsg.ouruser.pid = getpid();
+        ouruser->uid = getuid();
+        ouruser->gid = getgid();
+        ouruser->pid = getpid();
 
         m.msg_iov               = &iov;
         m.msg_iovlen            = 1;
diff -urpN net-snmp-5.8/ci/before.sh net-snmp-5.9.1/ci/before.sh
--- net-snmp-5.8/ci/before.sh	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/ci/before.sh	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,38 @@
+#!/bin/sh
+
+# Instead of relying on the hosts file provided by the CI host, replace it.
+# See also
+# https://blog.justincarmony.com/2011/07/27/mac-os-x-lion-etc-hosts-bugs-and-dns-resolution/.
+sudo sh -c 'printf "127.0.0.1 ipv4-loopback\n::1 localhost ipv6-localhost ipv6-loopback\n" >/etc/hosts'
+
+case "${TRAVIS_OS_NAME}" in
+    linux)
+	sudo sh -c 'apt-get install -y libmariadbclient-dev || sudo apt-get install -y libmariadb-client-lgpl-dev'
+
+	# Add an IPv6 config - see the corresponding Travis issue
+	# https://github.com/travis-ci/travis-ci/issues/8361
+	sudo sh -c 'echo 0 > /proc/sys/net/ipv6/conf/all/disable_ipv6';;
+    osx)
+	# Upgrade openssl such that Net-SNMP can be built with Blumenthal
+	# AES support. Disabled because this upgrade takes long and even
+	# sometimes fails.
+	if false; then
+	    brew upgrade openssl
+	fi;;
+esac
+
+if [ -n "$CIRRUS_CI" ]; then
+    pkg install -y bash
+    pkg install -y gawk
+    pkg install -y krb5 krb5-appl krb5-devel
+    pkg install -y libssh2
+    #pkg install -y openssl111
+    pkg install -y perl5 perl5-devel p5-ExtUtils-MakeMaker
+    pkg install -y pkgconf
+    pkg install -y py27-setuptools
+    if [ ! -e /usr/bin/perl ]; then
+	ln -s /usr/local/bin/perl /usr/bin/perl
+    fi
+fi
+
+head -n 999 /etc/hosts
diff -urpN net-snmp-5.8/ci/build.bat net-snmp-5.9.1/ci/build.bat
--- net-snmp-5.8/ci/build.bat	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/ci/build.bat	2021-05-26 05:19:35.000000000 +0700
@@ -1,42 +1,92 @@
 echo "Build type %BUILD%"
 @echo on
+@rem dir /b /s "C:\Program Files (x86)" | findstr /i /e "\vcvars64.bat"
+set "VCVARSPATH=C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build"
 goto %BUILD%
 echo "Error: unknown build type %BUILD%"
 goto eof
 
 :MSVCDYNAMIC64
-call "ci\openssl.bat"
-call "C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" amd64
+call "%VCVARSPATH%\vcvars64.bat"
+call ci/perl.bat MSVC142
+if %errorlevel% neq 0 exit /b %errorlevel%
+set PATH=c:\perl-msvc\bin;%PATH%
 cd win32
-perl Configure --config=release --with-sdk --with-ipv6 --with-winextdll --linktype=dynamic --with-ssl --with-sslincdir=C:\OpenSSL-Win64\include --with-ssllibdir=C:\OpenSSL-Win64\lib\vc
-nmake
+perl Configure --config=release --enable-blumenthal-aes --with-sdk --with-ipv6 --with-winextdll --linktype=dynamic --with-ssl --with-sslincdir=C:\OpenSSL-Win64\include --with-ssllibdir=C:\OpenSSL-Win64\lib\vc
+if %errorlevel% neq 0 exit /b %errorlevel%
+nmake /nologo
+if %errorlevel% neq 0 exit /b %errorlevel%
+nmake /nologo perl
+if %errorlevel% neq 0 exit /b %errorlevel%
+nmake /nologo perl_test
+if %errorlevel% neq 0 exit /b %errorlevel%
+cd ..
 goto eof
 
 :MSVCSTATIC64
-call "ci\openssl.bat"
-call "C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" amd64
+call "%VCVARSPATH%\vcvars64.bat"
+call ci/perl.bat MSVC142
+if %errorlevel% neq 0 exit /b %errorlevel%
+set PATH=c:\perl-msvc\bin;%PATH%
 cd win32
-perl Configure --config=release --with-sdk --with-ipv6 --with-winextdll --linktype=static --with-ssl --with-sslincdir=C:\OpenSSL-Win64\include --with-ssllibdir=C:\OpenSSL-Win64\lib\vc
-
-nmake
+perl Configure --config=release --enable-blumenthal-aes --with-sdk --with-ipv6 --with-winextdll --linktype=static --with-ssl --with-sslincdir=C:\OpenSSL-Win64\include --with-ssllibdir=C:\OpenSSL-Win64\lib\vc
+if %errorlevel% neq 0 exit /b %errorlevel%
+nmake /nologo
+if %errorlevel% neq 0 exit /b %errorlevel%
+cd ..
+goto eof
+
+:INSTALLER
+call "%VCVARSPATH%\vcvars64.bat"
+call ci/perl.bat MSVC142
+if %errorlevel% neq 0 exit /b %errorlevel%
+set PATH=c:\perl-msvc\bin;%PATH%
+set OPENSSLDIR=C:\OpenSSL-Win64
+set PATH=%PATH%;C:\cygwin64\bin
+perl win32\dist\build-binary.pl
+if %errorlevel% neq 0 goto installer_build_error
+mkdir installer
+copy c:\usr\*.exe installer
+goto eof
+
+:installer_build_error
+set e=%errorlevel%
+type win32\make.out
+exit /b %e%
 goto eof
 
 :MinGW32
-REM to do - install MinGW32 first.
-C:\mingw\msys\1.0\usr\bin\bash --login -c 'set -x; cd "${APPVEYOR_BUILD_FOLDER}"; ci/build.sh'
+rem MinGW is not present in the Visual Studio 2017 image. See also
+rem https://www.appveyor.com/docs/windows-images-software/.
+if exist C:\mingw goto MinGW32-get
+mkdir C:\mingw
+curl --no-alpn -L "https://osdn.net/dl/mingw/mingw-get-0.6.3-mingw32-pre-20170905-1-bin.zip" -o C:\mingw\mingw-get.zip
+unzip C:\mingw\mingw-get.zip -d C:\mingw
+:MinGW32-get
+C:\mingw\bin\mingw-get install mingw32-binutils-bin mingw32-gcc-bin mingw32-gcc-dev mingw32-w32api-dev msys-autoconf-bin msys-automake-bin msys-bash-bin msys-core-bin msys-coreutils-bin msys-file-bin msys-gawk-bin msys-grep-bin msys-libncurses-dev msys-libopenssl-dev msys-m4-bin msys-make-bin msys-openssl-bin msys-perl-bin msys-sed-bin msys-tar-bin
+set MSYSTEM=MINGW32
+C:\mingw\msys\1.0\bin\bash --login -c 'set -x; cd "${APPVEYOR_BUILD_FOLDER}"; ci/build.sh'
+goto eof
+
+:MSYS2
+set MSYSTEM=MSYS
+C:\msys64\usr\bin\bash --login -c 'set -x; cd "${APPVEYOR_BUILD_FOLDER}"; ci/build.sh'
 goto eof
 
 :MinGW64
+set MSYSTEM=MINGW64
 C:\msys64\usr\bin\bash --login -c 'set -x; cd "${APPVEYOR_BUILD_FOLDER}"; ci/build.sh'
 goto eof
 
 :Cygwin32
 c:\cygwin\setup-x86.exe --quiet-mode --no-shortcuts --only-site --site "%CYG_MIRROR%" --packages openssl-devel > NUL
+c:\cygwin\setup-x86.exe --quiet-mode --no-shortcuts --only-site --site "%CYG_MIRROR%" --packages python38-devel > NUL
 c:\cygwin\bin\bash --login -c 'set -x; cd "${APPVEYOR_BUILD_FOLDER}"; ci/build.sh'
 goto eof
 
 :Cygwin64
 c:\cygwin64\setup-x86_64.exe --quiet-mode --no-shortcuts --only-site --site "%CYG_MIRROR%" --packages openssl-devel > NUL
+c:\cygwin64\setup-x86_64.exe --quiet-mode --no-shortcuts --only-site --site "%CYG_MIRROR%" --packages python38-devel > NUL
 c:\cygwin64\bin\bash --login -c 'set -x; cd "${APPVEYOR_BUILD_FOLDER}"; ci/build.sh'
 goto eof
 
diff -urpN net-snmp-5.8/ci/build.sh net-snmp-5.9.1/ci/build.sh
--- net-snmp-5.8/ci/build.sh	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/ci/build.sh	2021-05-26 05:19:35.000000000 +0700
@@ -1,21 +1,53 @@
-#!/bin/bash
+#!/usr/bin/env bash
 
 scriptdir="$(dirname "$0")"
 export NOAUTODEPS=1
 export SNMP_VERBOSE=1
-if [ -z "$OSTYPE" ]; then
-    case "$(uname)" in
-        Linux)  OSTYPE=linux;;
-        Darwin) OSTYPE=darwin;;
-        *)      OSTYPE="UNKNOWN:$(uname)";;
-    esac
-    export OSTYPE
-fi
-"${scriptdir}"/net-snmp-configure master || exit $?
-make -s                                  || exit $?
-[ "$OSTYPE" = cygwin ]			 && exit 0
+case "$(uname -a)" in
+    MSYS*|MINGW*)
+	pacman --noconfirm --remove mingw-w64-x86_64-gcc-ada
+	pacman --noconfirm --remove mingw-w64-x86_64-gcc-fortran
+	pacman --noconfirm --remove mingw-w64-x86_64-gcc-libgfortran
+	pacman --noconfirm --remove mingw-w64-x86_64-gcc-objc
+	pacman --noconfirm --sync --refresh
+	pacman --noconfirm --sync --needed diffutils
+	pacman --noconfirm --sync --needed make
+	pacman --noconfirm --sync --needed perl-ExtUtils-MakeMaker
+	pacman --noconfirm --sync --needed perl-Test-Harness
+	;;
+esac
+case "$(uname -a)" in
+    MSYS*x86_64*)
+	pacman --noconfirm --sync --needed openssl-devel
+	;;
+    MINGW64*)
+	pacman --noconfirm --sync --needed mingw-w64-x86_64-libmariadbclient
+	pacman --noconfirm --sync --needed mingw-w64-x86_64-gcc
+	pacman --noconfirm --sync --needed mingw-w64-x86_64-openssl
+	export PATH="/mingw64/bin:$PATH"
+	;;
+esac
+echo "compiler path: $(type -p gcc)"
+"${scriptdir}"/net-snmp-configure V5-8-patches || exit $?
+case "$MODE" in
+    mini*)
+	# Net-SNMP uses static dependencies, the Makefile.depend files have
+	# been generated for MODE=regular, net-snmp-features.h includes
+	# <net-snmp/library/features.h> in minimalist mode and that file is
+	# generated dynamically and is not in Makefile.depend. Hence disable
+	# parallel compilation for minimalist mode.
+	nproc=1;;
+    *)
+	if type nproc >&/dev/null; then
+	    nproc=$(nproc)
+	else
+	    nproc=1
+	fi;;
+esac
+make -s -j${nproc}                       || exit $?
 case "$MODE" in
     disable-set|mini*|read-only)
         exit 0;;
 esac
+[ -n "$APPVEYOR" ]			 && exit 0
 "${scriptdir}"/net-snmp-run-tests        || exit $?
diff -urpN net-snmp-5.8/ci/net-snmp-configure net-snmp-5.9.1/ci/net-snmp-configure
--- net-snmp-5.8/ci/net-snmp-configure	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/ci/net-snmp-configure	2021-05-26 05:19:35.000000000 +0700
@@ -1,5 +1,28 @@
 #!/usr/bin/env bash
 
+ssl_include_path() {
+    case "$(uname)" in
+	MINGW32*)
+	    echo /mingw32/include/openssl;;
+	MINGW64*)
+	    echo /mingw64/include/openssl;;
+	*)
+	    echo "${with_openssl:-/usr}/include/openssl"
+	    ;;
+    esac
+}
+
+freebsd_pkg_version() {
+    local pkg ver
+
+    for pkg in "$@"; do
+	ver=$(pkg info "$pkg" 2>/dev/null |
+		     sed -n 's/^Version[[:blank:]]*:[[:blank:]]*//p') &&
+	    [ -n "$ver" ] && echo "$ver" && return
+    done
+    return 1
+}
+
 branch_name="$1"
 shift
 
@@ -11,23 +34,112 @@ if [ "${branch_name#master}" != "${branc
 elif [ "${branch_name#V5-7-}" != "${branch_name}" ]; then
   is_5_7_or_above="true"
 fi
-case "${OSTYPE}" in
-    linux*)
-        opensslver="$(
-                for p in openssl-devel libopenssl-devel libressl-devel; do
-	            rpm -q --qf '%{version}\n' $p 2>/dev/null;
-                done;
-	        dpkg-query --show -f '${Version}\n' libssl-dev 2>/dev/null;
-	        pacman -Q openssl 2>&1 | sed -n 's/^openssl[[:blank:]]*//p'
-            )";;
-    *)
-	opensslver=1.0;;
+
+libatmver="$(for p in linux-atm-devel; do
+                rpm -q --qf '%{version}\n' $p 2>/dev/null |
+                  grep -v 'not installed';
+              done |
+              head -n1;
+	      for p in libatm1-dev; do
+	        dpkg-query --show -f '${Version}\n' $p 2>/dev/null;
+              done | grep -v '^$';
+              pacman -Q no-such-library 2>/dev/null |
+                sed -n 's/^[^[:blank:]]*[[:blank:]]*//p')"
+echo "libatmver=$libatmver"
+
+libmysqlver="$(for p in libmariadb-devel; do
+                rpm -q --qf '%{version}\n' $p 2>/dev/null |
+                  grep -v 'not installed';
+              done |
+              head -n1;
+	      for p in libmariadbclient-dev libmariadb-client-lgpl-dev; do
+	        dpkg-query --show -f '${Version}\n' $p 2>/dev/null;
+              done | grep -v '^$';
+              pacman -Q mingw-w64-x86_64-libmariadbclient 2>/dev/null |
+                sed -n 's/^[^[:blank:]]*[[:blank:]]*//p')"
+echo "libmysqlver=$libmysqlver"
+
+libsensorsver="$(for p in libsensors4-devel; do
+                rpm -q --qf '%{version}\n' $p 2>/dev/null |
+                  grep -v 'not installed';
+              done |
+              head -n1;
+	      for p in libsensors4-dev; do
+	        dpkg-query --show -f '${Version}\n' $p 2>/dev/null;
+              done | grep -v '^$';
+              pacman -Q no-such-package 2>/dev/null |
+                sed -n 's/^[^[:blank:]]*[[:blank:]]*//p')"
+echo "libsensorsver=$libsensorsver"
+
+if ! echo "$*" | grep -Eq 'with-openssl=(no|internal)|without-openssl'; then
+    case "$(uname -a)" in
+	FreeBSD*)
+	    opensslver="$(freebsd_pkg_version libressl-devel openssl111 openssl\
+	                  2>/dev/null)"
+	    if [ -z "$opensslver" ]; then
+		opensslver="$(openssl version 2>&1 |
+				{ read -r a b c; echo "$b"; })"
+	    fi
+	    ;;
+	Linux*)
+	    opensslver="$(
+	    for p in openssl-devel libopenssl-devel libressl-devel; do
+	      rpm -q --qf '%{version}\n' $p 2>/dev/null |
+                grep -v 'not installed';
+            done;
+	    dpkg-query --show -f '${Version}\n' libssl-dev 2>/dev/null;
+	    pacman -Q mingw-w64-x86_64-openssl 2>/dev/null |
+	      sed -n 's/^[^[:blank:]]*[[:blank:]]*//p')";;
+	MSYS*x86_64*)
+	    opensslver="$(pacman -Q openssl-devel 2>/dev/null |
+	      sed -n 's/^[^[:blank:]]*[[:blank:]]*//p')";;
+	MINGW64*)
+	    opensslver="$(pacman -Q mingw-w64-x86_64-openssl 2>/dev/null |
+	      sed -n 's/^[^[:blank:]]*[[:blank:]]*//p')";;
+	*)
+	    opensslver=1.0;;
+    esac
+fi
+if grep -q 'CentOS release 4' /etc/issue 2>/dev/null; then
+  opensslver=""
+fi
+echo "opensslver=$opensslver"
+
+case "$(uname)" in
+    FreeBSD*)
+	libssh2ver="$(freebsd_pkg_version libssh2 2>/dev/null)";;
+    Linux*)
+	libssh2ver="$(for p in openssh-devel libssh2-devel libssh-devel; do
+                rpm -q --qf '%{version}\n' $p 2>/dev/null |
+                  grep -v 'not installed';
+              done |
+              head -n1;
+              for p in libopenssh2 libssh2-1-dev libssh-dev; do
+                dpkg-query --show -f '${Version}\n' $p 2>/dev/null;
+              done | grep -v '^$';
+              pacman -Q mingw-w64-x86_64-libssh2 2>/dev/null |
+                sed -n 's/^[^[:blank:]]*[[:blank:]]*//p')"
+	;;
+esac
+echo "libssh2ver=$libssh2ver"
+
+case "$(uname)" in
+    FreeBSD*)
+	perldevver="$(freebsd_pkg_version perl5 2>/dev/null)";;
+    Linux*)
+	perldevver="$(for p in perl; do
+                rpm -q --qf '%{version}\n' $p 2>/dev/null |
+                  grep -v 'not installed';
+              done |
+              head -n1;
+	      for p in libperl-dev; do
+	        dpkg-query --show -f '${Version}\n' $p 2>/dev/null;
+              done | grep -v '^$';
+              pacman -Q mingw-w64-x86_64-perl 2>/dev/null |
+                sed -n 's/^[^[:blank:]]*[[:blank:]]*//p')"
+	;;
 esac
-opensshver="$({
-    rpm -q openssh-devel;
-    rpm -q libssh2-devel;
-    rpm -q libssh-devel; } 2>/dev/null |
-    sed -n 's/^.*ssh[0-9]*-devel-\([0-9a-z.]*\)-.*$/\1/p' | head -n1)"
+echo "perldevver=$perldevver"
 
 options=()
 options+=(--enable-developer)
@@ -36,13 +148,11 @@ options+=("--prefix=/usr/local/net-snmp-
 options+=("--with-cflags=$cflags")
 options+=(--with-defaults)
 transports=()
-[ "$opensshver" != "" ] && transports+=(SSH)
 # Mib names can be found as follows:
 # (cd agent/mibgroup &&
 # git grep -lE 'void[[:blank:]]*init_.*\(void\)|config_require\(' |
 #  sed -n 's/\.h$//p')
 mibs=()
-mibs+=(mibII)
 case "$MODE" in
     read-only)
         ;;
@@ -85,7 +195,6 @@ case "$(uname)" in
               mibs+=(hardware/cpu)
               mibs+=(hardware/fsys)
               mibs+=(hardware/memory)
-              mibs+=(hardware/sensors)
               mibs+=(host)
               mibs+=(ip-forward-mib)
               mibs+=(ip-mib/inetNetToMediaTable)
@@ -93,32 +202,43 @@ case "$(uname)" in
               mibs+=(ip-mib/ipv4InterfaceTable)
               mibs+=(ip-mib/ipv6InterfaceTable)
               mibs+=(ip-mib/ipv6ScopeZoneIndexTable)
-              mibs+=(mibII/ipAddr)
               mibs+=(mibII/mta_sendmail)
               mibs+=(misc/ipfwacc)
               mibs+=(sctp-mib)
               mibs+=(snmp-notification-mib)
-              [ "$opensslver" != "" ] && mibs+=(snmp-usm-dh-objects-mib)
               mibs+=(tcp-mib)
               mibs+=(testhandler)
-              [ "$opensslver" != "" ] && mibs+=(tlstm-mib tsm-mib)
               mibs+=(tunnel)
               mibs+=(ucd-snmp/diskio)
-              mibs+=(ucd-snmp/lmsensorsMib)
+	      if [ -n "$libsensorsver" ]; then
+		  mibs+=(hardware/sensors)
+		  mibs+=(ucd-snmp/lmsensorsMib)
+	      fi
               mibs+=(ucd-snmp/extensible)
               mibs+=(udp-mib)
 	      mibs+=(rmon-mib)
               ;;
       esac
-      options+=(--with-mysql)
-      options+=(--with-perl-modules)
-      transports+=(AAL5PVC)
+      # Disable MySQL support because of the following Perl test failure on
+      # Travis:
+      # t/1.t .. Can't load '/home/travis/build/bvanassche/net-snmp/perl/TrapReceiver/../blib/arch/auto/NetSNMP/TrapReceiver/TrapReceiver.so' for module NetSNMP::TrapReceiver: /home/travis/build/bvanassche/net-snmp/apps/.libs/libnetsnmptrapd.so.35: undefined symbol: mysql_sqlstate at /usr/lib/x86_64-linux-gnu/perl/5.22/DynaLoader.pm line 187.
+      # at t/1.t line 16.
+      if false && [ -n "$libmysqlver" ]; then
+	  options+=(--with-mysql)
+      fi
+      if [ -n "$perldevver" ]; then
+	  options+=(--with-perl-modules)
+      else
+	  options+=(--disable-embedded-perl --without-perl-modules)
+      fi
+      if [ -n "$libatmver" ]; then
+	  transports+=(AAL5PVC)
+      fi
       transports+=(IPX)
       transports+=(STD)
       $is_5_8_or_above && transports+=(UDPshared)
-      [ "$opensslver" = "" ] && options+=("--with-openssl=internal")
       options+=("--with-default-snmp-version=2")
-      { rpm -q python-setuptools >/dev/null 2>&1 || rpm -q python-devel >/dev/null 2>&1 || dpkg-query -l python-setuptools >/dev/null 2>&1; } && options+=(--with-python-modules)
+      options+=("--with-systemd")
       # Disabled modules because troublesome: Rmon ipfwchains/ipfwchains ucd-snmp/lmSensors
     ;;
   darwin*|Darwin*)
@@ -132,7 +252,6 @@ case "$(uname)" in
               mibs+=(mibII/mta_sendmail)
               mibs+=(misc/ipfwacc)
               mibs+=(snmp-notification-mib)
-              mibs+=(snmp-usm-dh-objects-mib)
               mibs+=(tcp-mib)
               mibs+=(ucd-snmp/diskio)
               mibs+=(ucd-snmp/extensible)
@@ -140,7 +259,6 @@ case "$(uname)" in
               mibs+=(Rmon)
               ;;
       esac
-      options+=(--with-python-modules)
       if [ "${TRAVIS_OS_NAME}" == "osx" ]; then
           options+=("--with-openssl=$(brew --prefix openssl)")
           # On Travis OS/X linking the Perl modules fails with "undefined symbol
@@ -148,34 +266,55 @@ case "$(uname)" in
           options+=(--disable-embedded-perl --without-perl-modules)
       fi
     ;;
+  FreeBSD*)
+      case "$MODE" in
+          mini*|read-only)
+              ;;
+          *)
+              mibs+=(disman/nslookup-mib)
+              mibs+=(host)
+              mibs+=(if-mib)
+              mibs+=(mibII/mta_sendmail)
+              mibs+=(misc/ipfwacc)
+              mibs+=(sctp-mib)
+              mibs+=(snmp-notification-mib)
+              mibs+=(tcp-mib)
+              mibs+=(ucd-snmp/diskio)
+              mibs+=(ucd-snmp/extensible)
+              mibs+=(udp-mib)
+              mibs+=(Rmon)
+              ;;
+      esac
+      options+=(--disable-embedded-perl --without-perl-modules)
+    ;;
   CYGWIN*)
       export ENV_SEPARATOR=":"
       mibs+=(ucd-snmp/extensible)
       mibs+=(winExtDLL)
-      # To do: avoid that the Net-SNMP headers trigger the following build
-      # failure: /usr/include/w32api/psdk_inc/_fd_types.h:100:2: warning: #warning "fd_set and associated macros have been defined in sys/types. This can cause runtime problems with W32 sockets" [-Wcpp]
-      # #warning "fd_set and associated macros have been defined in sys/types.
-      options+=("--with-openssl=internal")
-      if [ -n "$APPVEYOR" ]; then
-          # On Appveyor building the Perl modules fails as follows:
-          # /usr/lib/perl5/5.26/i686-cygwin-threads-64int/CORE/reentr.h:104:26: fatal error: crypt.h: No such file or directory
-          options+=(--disable-embedded-perl --without-perl-modules)
-      fi
+      options+=(--disable-embedded-perl --without-perl-modules)
     ;;
-  MINGW*|MSYS*)
+  MINGW*)
       options+=(--disable-embedded-perl)
-      if [ "$branch_name" != "V5-4-patches" ]; then
-	  options+=("--with-openssl=/c/OpenSSL")
-      fi
+      mibs+=(host)
       mibs+=(snmp-notification-mib)
       mibs+=(ucd-snmp/dlmod)
       mibs+=(ucd-snmp/extensible)
       mibs+=(winExtDLL)
       options+=(--without-perl-modules)
-      #options+=(--with-mibdirs="C:/usr/share/snmp/mibs")
-      if [ -n "$APPVEYOR" ]; then
-          options+=("--build=x86_64-pc-mingw32")
-      fi
+    ;;
+  MSYS*)
+      options+=(--disable-embedded-perl)
+      mibs+=(host)
+      mibs+=(snmp-notification-mib)
+      mibs+=(ucd-snmp/dlmod)
+      mibs+=(ucd-snmp/extensible)
+      mibs+=(winExtDLL)
+      options+=(--without-perl-modules)
+      # The config.guess script in the Net-SNMP source tree is too old to
+      # recognize the MSYS2 environment. Hence the explicit --build=... option.
+      # See also
+      # http://git.savannah.gnu.org/cgit/automake.git/tree/lib/config.guess.
+      options+=("--build=x86_64-pc-mingw32")
     ;;
   *)
     echo "Unknown OS $(uname)."
@@ -188,26 +327,59 @@ for o in "${options[@]}"; do
         with_openssl="${o#--with-openssl=}"
     fi
 done
-set -x
-if [ "$opensslver" != "" ] &&
-	grep -rqw BIO_dgram_get_peer "${with_openssl:-/usr}/include/openssl" 2>/dev/null
-then
-	transports+=(DTLSUDP)
-        # to do: figure out why one of the IPv6 TLSTCP test fails on Travis.
-        if [ "${TRAVIS_OS_NAME}" != linux ]; then
-	    transports+=(TLSTCP)
-        fi
-fi
-set +x
-if $is_5_8_or_above; then
-    [ -e "${with_openssl:-/usr}/openssl/aes.h" ] &&
-        [ -e "${with_openssl:-/usr}/openssl/evp.h" ] &&
-        options+=(--enable-blumenthal-aes)
+if [ "$opensslver" = "" ]; then
+    options+=("--with-openssl=internal")
+    with_openssl="internal"
+else
+    if grep -rqw BIO_dgram_get_peer "$(ssl_include_path)" 2>/dev/null; then
+	transports+=(DTLSUDP TLSTCP)
+    fi
+    if [ "$MODE" != "read-only" ]; then
+	# these MIB modules do not support read-only
+	if [ -e "$(ssl_include_path)/dh.h" ]; then
+	    mibs+=(snmp-usm-dh-objects-mib)
+	fi
+	if [ -e "$(ssl_include_path)/ssl.h" ]; then
+	    mibs+=(tlstm-mib)
+	fi
+	mibs+=(tsm-mib)
+    fi
+fi
+if [ "$with_openssl" != "internal" ] && $is_5_8_or_above &&
+       [ -e "$(ssl_include_path)/aes.h" ] &&
+       [ -e "$(ssl_include_path)/evp.h" ]; then
+       options+=(--enable-blumenthal-aes)
 fi
 security_modules=(usm tsm)
 if [ -e /usr/include/krb5.h ]; then
     security_modules+=(ksm)
 fi
+case "$(uname)" in
+    MSYS*|MINGW*)
+	# Do not enable Python support on MinGW32 nor for the MSYS build
+	# environment because the Python interpreter has been built on these
+	# environments with Visual C++. That compiler is incompatible with gcc.
+        ;;
+    Darwin*)
+	case "$(uname -r)" in
+	    11.*|12.*)
+		if python3 -c 'import setuptools' 1>/dev/null 2>&1; then
+		    options+=(--with-python-modules)
+		fi
+		;;
+	    *)
+		;;
+	esac
+	;;
+    *)
+	# Do not enable Python support for Cirrus CI because on Cirrus linking
+	# with Python fails as follows (this is probably a bug in Net-SNMP):
+	# /usr/bin/ld: /tmp/cirrus-ci-build/snmplib/.libs/libnetsnmp.a(snmp_client.o): relocation R_X86_64_32S against `a local symbol' can not be used when making a shared object; recompile with -fPIC
+	if python3 -c 'import setuptools' 1>/dev/null 2>&1 &&
+	       [ -z "$CIRRUS_CI" ]; then
+	    options+=(--with-python-modules)
+	fi
+    esac
 
 case "$MODE" in
     disable-set)
@@ -225,8 +397,8 @@ case "$MODE" in
         exit 1;;
 esac
 
+[ "${libssh2ver#2}" != "${libssh2ver}" ] && transports+=(SSH)
 set -x
-./configure "${options[@]}" --with-transports="${transports[*]}"	\
-            --with-security-modules="${security_modules[*]}"		\
+./configure "${options[@]}" --with-transports="${transports[*]}" \
+            --with-security-modules="${security_modules[*]}"	 \
 	    --with-mib-modules="${mibs[*]}" "$@"
-set +x
diff -urpN net-snmp-5.8/ci/net-snmp-run-perl-tests net-snmp-5.9.1/ci/net-snmp-run-perl-tests
--- net-snmp-5.8/ci/net-snmp-run-perl-tests	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/ci/net-snmp-run-perl-tests	2021-05-26 05:19:35.000000000 +0700
@@ -1,8 +1,6 @@
-#!/bin/bash
+#!/bin/sh
 
-# See also the output of the following command:
-# find -name '*.so' | sed 's/^\.\///;s/\/[^\/]*$//' | sort -u
-export LD_LIBRARY_PATH="$PWD/snmplib/.libs:$PWD/agent/helpers/.libs:$PWD/agent/.libs:$PWD/apps/.libs:" &&
+export LD_LIBRARY_PATH="$(find . -name '*.so' | grep -v NetSNMP/agent/default_store | sed 's,^\./,'"$PWD/"',;s,/[^/]*$,,' | sort -u | tr '\n' :)" &&
 make perlmakefiles &&
 cd perl &&
 make &&
diff -urpN net-snmp-5.8/ci/net-snmp-run-python-tests net-snmp-5.9.1/ci/net-snmp-run-python-tests
--- net-snmp-5.8/ci/net-snmp-run-python-tests	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/ci/net-snmp-run-python-tests	2021-05-26 05:19:35.000000000 +0700
@@ -1,4 +1,4 @@
-#!/bin/bash
+#!/bin/sh
 
 set -x
 killall snmpd
@@ -10,7 +10,10 @@ export PYTHONPATH=$PWD/python/netsnmp
 mkdir -p "$SNMP_PERSISTENT_DIR" || exit $?
 agent/snmpd -I-smux -r -f -Lo -c python/netsnmp/tests/snmpd.conf localhost:${SNMP_SNMPD_PORT} &
 pid=$!
+PYTHONPROG=$(sed -n 's/^S\["PYTHONPROG"\]="\(.*\)"$/\1/p' config.status) ||
+    exit $?
+[ -n "$PYTHONPROG" ] || exit $?
 cd python || exit $?
-python setup.py --basedir="$PWD/.." test || exit $?
+$PYTHONPROG setup.py --basedir="$PWD/.." test || exit $?
 kill $pid
 wait
diff -urpN net-snmp-5.8/ci/net-snmp-run-tests net-snmp-5.9.1/ci/net-snmp-run-tests
--- net-snmp-5.8/ci/net-snmp-run-tests	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/ci/net-snmp-run-tests	2021-05-26 05:19:35.000000000 +0700
@@ -1,37 +1,44 @@
-#!/bin/bash
+#!/bin/sh
 
 scriptdir="$(dirname "$0")"
 
-killall snmpd snmptrapd >&/dev/null
+killall snmpd snmptrapd >/dev/null 2>&1
 
 export SNMP_VERBOSE=1 &&
 export SNMP_SAVE_TMPDIR=1 &&
-export NETSNMP_DNS_WORKAROUND=1 &&
 make -s &&
 (
-      export PATH="$PWD/agent/.libs:$PWD/apps/.libs:$PWD:$PATH" &&
-      export LD_LIBRARY_PATH="$PWD/snmplib/.libs:$PWD/agent/.libs:$PWD/agent/helpers/.libs:$PWD/perl/blib/arch/auto/NetSNMP/default_store:$PWD/perl/blib/arch/auto/SNMP:$PWD/perl/blib/arch/auto/NetSNMP/ASN:$PWD/perl/blib/arch/auto/NetSNMP/OID:$PWD/perl/blib/arch/auto/NetSNMP/TrapReceiver:$PWD/perl/blib/arch/auto/NetSNMP/agent:$PWD/perl/blib/arch/auto/NetSNMP/agent/default_store:" &&
-      export PERL5LIB="$PWD/perl/blib/lib:$PWD/perl/blib/lib/NetSNMP:$PWD/perl/blib/lib/NetSNMP/agent" &&
       cd testing &&
       if [ -e RUNFULLTESTS ] &&
 	     perl -e 'require TAP::Harness;' >/dev/null 2>&1; then
-          if [ "${TRAVIS_OS_NAME}" == "osx" ]; then
+          if [ "${TRAVIS_OS_NAME}" = "osx" ]; then
               for g in default snmpv3 unit-tests; do
                   echo "==== Test group $g ===="
 	          ./RUNFULLTESTS -g $g || exit $?
                   echo "==== End of test group $g ===="
               done
+	  elif [ -n "${CIRRUS_CI}" ]; then
+              for g in default snmpv3 transports unit-tests; do
+                  echo "==== Test group $g ===="
+	          ./RUNFULLTESTS -g $g || exit $?
+                  echo "==== End of test group $g ===="
+              done
           else
-	      ./RUNFULLTESTS -g all
+	      ./RUNFULLTESTS -g all -e dtls -e tls
           fi
       else
 	  make -s test
       fi &&
       cd .. &&
-      if [ "${TRAVIS_OS_NAME}" != "osx" ]; then
+      if grep -q "PERLTARGS='perlmodules'" config.log; then
           "$scriptdir/net-snmp-run-perl-tests"
       fi
 ) &&
-if [ "${TRAVIS_OS_NAME}" != "osx" ]; then
+# Running the Python tests fails as follows on OS/X:
+# ImportError: dlopen(/Users/travis/build/bvanassche/net-snmp/python/netsnmp/client_intf.so, 2): Library not loaded: /usr/local/net-snmp-master/lib/libnetsnmp.35.dylib
+# Referenced from: /Users/travis/build/bvanassche/net-snmp/python/netsnmp/client_intf.so
+# Reason: image not found
+if grep -q with-python-modules config.log &&
+	[ "${TRAVIS_OS_NAME}" != "osx" ]; then
     "$scriptdir/net-snmp-run-python-tests"
 fi
diff -urpN net-snmp-5.8/ci/openssl.bat net-snmp-5.9.1/ci/openssl.bat
--- net-snmp-5.8/ci/openssl.bat	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/ci/openssl.bat	2021-05-26 05:19:35.000000000 +0700
@@ -1,3 +1,8 @@
 REM Download and install OpenSSL
-curl https://slproweb.com/download/Win64OpenSSL-1_1_0h.exe -o openssl.exe
-.\openssl.exe /suppressmsgboxes /silent /norestart /nocloseapplications
+rmdir /s /q C:\OpenSSL-Win32
+rmdir /s /q C:\OpenSSL-v11-Win32
+rmdir /s /q C:\OpenSSL-Win64
+rmdir /s /q C:\OpenSSL-v11-Win64
+curl https://slproweb.com/download/Win64OpenSSL-1_1_1k.exe -o openssl.exe
+.\openssl.exe /suppressmsgboxes /silent /norestart /nocloseapplications /log=openssl-installation-log.txt /dir=C:\OpenSSL-Win64
+rem type openssl-installation-log.txt
diff -urpN net-snmp-5.8/ci/perl.bat net-snmp-5.9.1/ci/perl.bat
--- net-snmp-5.8/ci/perl.bat	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/ci/perl.bat	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,50 @@
+REM Download and install Perl
+setlocal
+echo on
+if %1 == "" goto help
+set PERL_VERSION=5.31.10
+set INST_DRV=c:
+set INST_TOP=c:\perl-msvc
+rd /q /s %INST_TOP%
+curl https://www.cpan.org/src/5.0/perl-%PERL_VERSION%.tar.gz -o perl-%PERL_VERSION%.tar.gz
+if %errorlevel% neq 0 goto build_error
+tar xzf perl-%PERL_VERSION%.tar.gz
+if %errorlevel% neq 0 goto build_error
+cd perl-%PERL_VERSION%\win32
+if %errorlevel% neq 0 goto build_error
+(echo CCTYPE=%1 && echo INST_DRV=%INST_DRV% && echo INST_TOP=%INST_TOP% && type Makefile | findstr /r /v "^CCTYPE" | findstr /r /v "^INST_DRV" | findstr /r /v "^INST_TOP") > Makefile2
+if %errorlevel% neq 0 goto build_error
+del Makefile
+if %errorlevel% neq 0 goto build_error
+ren Makefile2 Makefile
+if %errorlevel% neq 0 goto build_error
+findstr /r "^CCTYPE" Makefile
+findstr /r "^INST_DRV" Makefile
+findstr /r "^INST_TOP" Makefile
+@rem For mt.exe
+@rem dir /b /s "C:\Program Files (x86)" | findstr /i /e "\mt.exe"
+set "PATH=%PATH%;C:\Program Files (x86)\Windows Kits\10\bin\10.0.18362.0\x64"
+nmake "BUILDOPTEXTRA=/wd4244 /wd4267"
+if %errorlevel% neq 0 goto build_error
+nmake install
+if %errorlevel% neq 0 goto build_error
+set PATH=%INST_TOP%\bin;%PATH%
+where perl
+perl -v
+cd ..\..
+set INST_DRV=
+set INST_TOP=
+goto done
+
+:build_error
+endlocal
+set e=%errorlevel%
+exit /b %e%
+
+:help
+endlocal
+echo "Compiler type argument has not been specified"
+exit /b 1
+
+:done
+endlocal
diff -urpN net-snmp-5.8/ci/test.bat net-snmp-5.9.1/ci/test.bat
--- net-snmp-5.8/ci/test.bat	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/ci/test.bat	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,35 @@
+@echo on
+goto %BUILD%
+echo "Error: unknown build type %BUILD%"
+goto eof
+
+:MSVCDYNAMIC64
+goto eof
+
+:MSVCSTATIC64
+goto eof
+
+:INSTALLER
+goto eof
+
+:MinGW32
+goto eof
+
+:MSYS2
+goto eof
+
+:MinGW64
+rem C:\msys64\usr\bin\bash --login -c 'set -x; cd "${APPVEYOR_BUILD_FOLDER}"; ci/net-snmp-run-tests'
+goto eof
+
+:Cygwin32
+goto eof
+c:\cygwin\bin\bash --login -c 'set -x; cd "${APPVEYOR_BUILD_FOLDER}"; ci/net-snmp-run-tests'
+goto eof
+
+:Cygwin64
+goto eof
+c:\cygwin64\bin\bash --login -c 'set -x; cd "${APPVEYOR_BUILD_FOLDER}"; ci/net-snmp-run-tests'
+goto eof
+
+:eof
diff -urpN net-snmp-5.8/config.guess net-snmp-5.9.1/config.guess
--- net-snmp-5.8/config.guess	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/config.guess	2021-05-26 05:19:35.000000000 +0700
@@ -1,14 +1,12 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
-#   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010
-#   Free Software Foundation, Inc.
+#   Copyright 1992-2020 Free Software Foundation, Inc.
 
-timestamp='2010-08-21'
+timestamp='2020-09-19'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
-# the Free Software Foundation; either version 2 of the License, or
+# the Free Software Foundation; either version 3 of the License, or
 # (at your option) any later version.
 #
 # This program is distributed in the hope that it will be useful, but
@@ -17,26 +15,22 @@ timestamp='2010-08-21'
 # General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston, MA
-# 02110-1301, USA.
+# along with this program; if not, see <https://www.gnu.org/licenses/>.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
 # configuration script generated by Autoconf, you may include it under
-# the same distribution terms that you use for the rest of that program.
-
-
-# Originally written by Per Bothner.  Please send patches (context
-# diff format) to <config-patches@gnu.org> and include a ChangeLog
-# entry.
+# the same distribution terms that you use for the rest of that
+# program.  This Exception is an additional permission under section 7
+# of the GNU General Public License, version 3 ("GPLv3").
 #
-# This script attempts to guess a canonical system name similar to
-# config.sub.  If it succeeds, it prints the system name on stdout, and
-# exits with 0.  Otherwise, it exits with 1.
+# Originally written by Per Bothner; maintained since 2000 by Ben Elliston.
 #
 # You can get the latest version of this script from:
-# http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD
+# https://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess
+#
+# Please send patches to <config-patches@gnu.org>.
+
 
 me=`echo "$0" | sed -e 's,.*/,,'`
 
@@ -45,7 +39,7 @@ Usage: $0 [OPTION]
 
 Output the configuration name of the system \`$me' is run on.
 
-Operation modes:
+Options:
   -h, --help         print this help, then exit
   -t, --time-stamp   print date of last modification, then exit
   -v, --version      print version number, then exit
@@ -56,9 +50,7 @@ version="\
 GNU config.guess ($timestamp)
 
 Originally written by Per Bothner.
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
-2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free
-Software Foundation, Inc.
+Copyright 1992-2020 Free Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
 warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
@@ -92,8 +84,6 @@ if test $# != 0; then
   exit 1
 fi
 
-trap 'exit 1' HUP INT TERM
-
 # CC_FOR_BUILD -- compiler used by this script. Note that the use of a
 # compiler to aid in system detection is discouraged as it requires
 # temporary files to be created and, as you can see below, it is a
@@ -104,34 +94,40 @@ trap 'exit 1' HUP INT TERM
 
 # Portable tmp directory creation inspired by the Autoconf team.
 
-set_cc_for_build='
-trap "exitcode=\$?; (rm -f \$tmpfiles 2>/dev/null; rmdir \$tmp 2>/dev/null) && exit \$exitcode" 0 ;
-trap "rm -f \$tmpfiles 2>/dev/null; rmdir \$tmp 2>/dev/null; exit 1" HUP INT PIPE TERM ;
-: ${TMPDIR=/tmp} ;
- { tmp=`(umask 077 && mktemp -d "$TMPDIR/cgXXXXXX") 2>/dev/null` && test -n "$tmp" && test -d "$tmp" ; } ||
- { test -n "$RANDOM" && tmp=$TMPDIR/cg$$-$RANDOM && (umask 077 && mkdir $tmp) ; } ||
- { tmp=$TMPDIR/cg-$$ && (umask 077 && mkdir $tmp) && echo "Warning: creating insecure temp directory" >&2 ; } ||
- { echo "$me: cannot create a temporary directory in $TMPDIR" >&2 ; exit 1 ; } ;
-dummy=$tmp/dummy ;
-tmpfiles="$dummy.c $dummy.o $dummy.rel $dummy" ;
-case $CC_FOR_BUILD,$HOST_CC,$CC in
- ,,)    echo "int x;" > $dummy.c ;
-	for c in cc gcc c89 c99 ; do
-	  if ($c -c -o $dummy.o $dummy.c) >/dev/null 2>&1 ; then
-	     CC_FOR_BUILD="$c"; break ;
-	  fi ;
-	done ;
-	if test x"$CC_FOR_BUILD" = x ; then
-	  CC_FOR_BUILD=no_compiler_found ;
-	fi
-	;;
- ,,*)   CC_FOR_BUILD=$CC ;;
- ,*,*)  CC_FOR_BUILD=$HOST_CC ;;
-esac ; set_cc_for_build= ;'
+tmp=
+# shellcheck disable=SC2172
+trap 'test -z "$tmp" || rm -fr "$tmp"' 0 1 2 13 15
+
+set_cc_for_build() {
+    # prevent multiple calls if $tmp is already set
+    test "$tmp" && return 0
+    : "${TMPDIR=/tmp}"
+    # shellcheck disable=SC2039
+    { tmp=`(umask 077 && mktemp -d "$TMPDIR/cgXXXXXX") 2>/dev/null` && test -n "$tmp" && test -d "$tmp" ; } ||
+	{ test -n "$RANDOM" && tmp=$TMPDIR/cg$$-$RANDOM && (umask 077 && mkdir "$tmp" 2>/dev/null) ; } ||
+	{ tmp=$TMPDIR/cg-$$ && (umask 077 && mkdir "$tmp" 2>/dev/null) && echo "Warning: creating insecure temp directory" >&2 ; } ||
+	{ echo "$me: cannot create a temporary directory in $TMPDIR" >&2 ; exit 1 ; }
+    dummy=$tmp/dummy
+    case ${CC_FOR_BUILD-},${HOST_CC-},${CC-} in
+	,,)    echo "int x;" > "$dummy.c"
+	       for driver in cc gcc c89 c99 ; do
+		   if ($driver -c -o "$dummy.o" "$dummy.c") >/dev/null 2>&1 ; then
+		       CC_FOR_BUILD="$driver"
+		       break
+		   fi
+	       done
+	       if test x"$CC_FOR_BUILD" = x ; then
+		   CC_FOR_BUILD=no_compiler_found
+	       fi
+	       ;;
+	,,*)   CC_FOR_BUILD=$CC ;;
+	,*,*)  CC_FOR_BUILD=$HOST_CC ;;
+    esac
+}
 
 # This is needed to find uname on a Pyramid OSx when run in the BSD universe.
 # (ghazi@noc.rutgers.edu 1994-08-24)
-if (test -f /.attbin/uname) >/dev/null 2>&1 ; then
+if test -f /.attbin/uname ; then
 	PATH=$PATH:/.attbin ; export PATH
 fi
 
@@ -140,12 +136,38 @@ UNAME_RELEASE=`(uname -r) 2>/dev/null` |
 UNAME_SYSTEM=`(uname -s) 2>/dev/null`  || UNAME_SYSTEM=unknown
 UNAME_VERSION=`(uname -v) 2>/dev/null` || UNAME_VERSION=unknown
 
+case "$UNAME_SYSTEM" in
+Linux|GNU|GNU/*)
+	# If the system lacks a compiler, then just pick glibc.
+	# We could probably try harder.
+	LIBC=gnu
+
+	set_cc_for_build
+	cat <<-EOF > "$dummy.c"
+	#include <features.h>
+	#if defined(__UCLIBC__)
+	LIBC=uclibc
+	#elif defined(__dietlibc__)
+	LIBC=dietlibc
+	#else
+	#include <stdarg.h>
+	#ifdef __DEFINED_va_list
+	LIBC=musl
+	#else
+	LIBC=gnu
+	#endif
+	#endif
+	EOF
+	eval "`$CC_FOR_BUILD -E "$dummy.c" 2>/dev/null | grep '^LIBC' | sed 's, ,,g'`"
+	;;
+esac
+
 # Note: order is significant - the case branches are not exclusive.
 
-case "${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}" in
+case "$UNAME_MACHINE:$UNAME_SYSTEM:$UNAME_RELEASE:$UNAME_VERSION" in
     *:NetBSD:*:*)
 	# NetBSD (nbsd) targets should (where applicable) match one or
-	# more of the tupples: *-*-netbsdelf*, *-*-netbsdaout*,
+	# more of the tuples: *-*-netbsdelf*, *-*-netbsdaout*,
 	# *-*-netbsdecoff* and *-*-netbsd*.  For targets that recently
 	# switched to ELF, *-*-netbsd* would select the old
 	# object file format.  This provides both forward
@@ -155,21 +177,31 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
 	# Note: NetBSD doesn't particularly care about the vendor
 	# portion of the name.  We always set it to "unknown".
 	sysctl="sysctl -n hw.machine_arch"
-	UNAME_MACHINE_ARCH=`(/sbin/$sysctl 2>/dev/null || \
-	    /usr/sbin/$sysctl 2>/dev/null || echo unknown)`
-	case "${UNAME_MACHINE_ARCH}" in
+	UNAME_MACHINE_ARCH=`(uname -p 2>/dev/null || \
+	    "/sbin/$sysctl" 2>/dev/null || \
+	    "/usr/sbin/$sysctl" 2>/dev/null || \
+	    echo unknown)`
+	case "$UNAME_MACHINE_ARCH" in
 	    armeb) machine=armeb-unknown ;;
 	    arm*) machine=arm-unknown ;;
 	    sh3el) machine=shl-unknown ;;
 	    sh3eb) machine=sh-unknown ;;
 	    sh5el) machine=sh5le-unknown ;;
-	    *) machine=${UNAME_MACHINE_ARCH}-unknown ;;
+	    earmv*)
+		arch=`echo "$UNAME_MACHINE_ARCH" | sed -e 's,^e\(armv[0-9]\).*$,\1,'`
+		endian=`echo "$UNAME_MACHINE_ARCH" | sed -ne 's,^.*\(eb\)$,\1,p'`
+		machine="${arch}${endian}"-unknown
+		;;
+	    *) machine="$UNAME_MACHINE_ARCH"-unknown ;;
 	esac
 	# The Operating System including object format, if it has switched
-	# to ELF recently, or will in the future.
-	case "${UNAME_MACHINE_ARCH}" in
+	# to ELF recently (or will in the future) and ABI.
+	case "$UNAME_MACHINE_ARCH" in
+	    earm*)
+		os=netbsdelf
+		;;
 	    arm*|i386|m68k|ns32k|sh3*|sparc|vax)
-		eval $set_cc_for_build
+		set_cc_for_build
 		if echo __ELF__ | $CC_FOR_BUILD -E - 2>/dev/null \
 			| grep -q __ELF__
 		then
@@ -181,7 +213,14 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
 		fi
 		;;
 	    *)
-	        os=netbsd
+		os=netbsd
+		;;
+	esac
+	# Determine ABI tags.
+	case "$UNAME_MACHINE_ARCH" in
+	    earm*)
+		expr='s/^earmv[0-9]/-eabi/;s/eb$//'
+		abi=`echo "$UNAME_MACHINE_ARCH" | sed -e "$expr"`
 		;;
 	esac
 	# The OS release
@@ -189,34 +228,60 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
 	# thus, need a distinct triplet. However, they do not need
 	# kernel version information, so it can be replaced with a
 	# suitable tag, in the style of linux-gnu.
-	case "${UNAME_VERSION}" in
+	case "$UNAME_VERSION" in
 	    Debian*)
 		release='-gnu'
 		;;
 	    *)
-		release=`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
+		release=`echo "$UNAME_RELEASE" | sed -e 's/[-_].*//' | cut -d. -f1,2`
 		;;
 	esac
 	# Since CPU_TYPE-MANUFACTURER-KERNEL-OPERATING_SYSTEM:
 	# contains redundant information, the shorter form:
 	# CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM is used.
-	echo "${machine}-${os}${release}"
+	echo "$machine-${os}${release}${abi-}"
+	exit ;;
+    *:Bitrig:*:*)
+	UNAME_MACHINE_ARCH=`arch | sed 's/Bitrig.//'`
+	echo "$UNAME_MACHINE_ARCH"-unknown-bitrig"$UNAME_RELEASE"
 	exit ;;
     *:OpenBSD:*:*)
 	UNAME_MACHINE_ARCH=`arch | sed 's/OpenBSD.//'`
-	echo ${UNAME_MACHINE_ARCH}-unknown-openbsd${UNAME_RELEASE}
+	echo "$UNAME_MACHINE_ARCH"-unknown-openbsd"$UNAME_RELEASE"
+	exit ;;
+    *:LibertyBSD:*:*)
+	UNAME_MACHINE_ARCH=`arch | sed 's/^.*BSD\.//'`
+	echo "$UNAME_MACHINE_ARCH"-unknown-libertybsd"$UNAME_RELEASE"
+	exit ;;
+    *:MidnightBSD:*:*)
+	echo "$UNAME_MACHINE"-unknown-midnightbsd"$UNAME_RELEASE"
 	exit ;;
     *:ekkoBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-ekkobsd${UNAME_RELEASE}
+	echo "$UNAME_MACHINE"-unknown-ekkobsd"$UNAME_RELEASE"
 	exit ;;
     *:SolidBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-solidbsd${UNAME_RELEASE}
+	echo "$UNAME_MACHINE"-unknown-solidbsd"$UNAME_RELEASE"
+	exit ;;
+    *:OS108:*:*)
+	echo "$UNAME_MACHINE"-unknown-os108_"$UNAME_RELEASE"
 	exit ;;
     macppc:MirBSD:*:*)
-	echo powerpc-unknown-mirbsd${UNAME_RELEASE}
+	echo powerpc-unknown-mirbsd"$UNAME_RELEASE"
 	exit ;;
     *:MirBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-mirbsd${UNAME_RELEASE}
+	echo "$UNAME_MACHINE"-unknown-mirbsd"$UNAME_RELEASE"
+	exit ;;
+    *:Sortix:*:*)
+	echo "$UNAME_MACHINE"-unknown-sortix
+	exit ;;
+    *:Twizzler:*:*)
+	echo "$UNAME_MACHINE"-unknown-twizzler
+	exit ;;
+    *:Redox:*:*)
+	echo "$UNAME_MACHINE"-unknown-redox
+	exit ;;
+    mips:OSF1:*.*)
+	echo mips-dec-osf1
 	exit ;;
     alpha:OSF1:*:*)
 	case $UNAME_RELEASE in
@@ -224,7 +289,7 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
 		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $3}'`
 		;;
 	*5.*)
-	        UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $4}'`
+		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $4}'`
 		;;
 	esac
 	# According to Compaq, /usr/sbin/psrinfo has been available on
@@ -234,60 +299,54 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
 	ALPHA_CPU_TYPE=`/usr/sbin/psrinfo -v | sed -n -e 's/^  The alpha \(.*\) processor.*$/\1/p' | head -n 1`
 	case "$ALPHA_CPU_TYPE" in
 	    "EV4 (21064)")
-		UNAME_MACHINE="alpha" ;;
+		UNAME_MACHINE=alpha ;;
 	    "EV4.5 (21064)")
-		UNAME_MACHINE="alpha" ;;
+		UNAME_MACHINE=alpha ;;
 	    "LCA4 (21066/21068)")
-		UNAME_MACHINE="alpha" ;;
+		UNAME_MACHINE=alpha ;;
 	    "EV5 (21164)")
-		UNAME_MACHINE="alphaev5" ;;
+		UNAME_MACHINE=alphaev5 ;;
 	    "EV5.6 (21164A)")
-		UNAME_MACHINE="alphaev56" ;;
+		UNAME_MACHINE=alphaev56 ;;
 	    "EV5.6 (21164PC)")
-		UNAME_MACHINE="alphapca56" ;;
+		UNAME_MACHINE=alphapca56 ;;
 	    "EV5.7 (21164PC)")
-		UNAME_MACHINE="alphapca57" ;;
+		UNAME_MACHINE=alphapca57 ;;
 	    "EV6 (21264)")
-		UNAME_MACHINE="alphaev6" ;;
+		UNAME_MACHINE=alphaev6 ;;
 	    "EV6.7 (21264A)")
-		UNAME_MACHINE="alphaev67" ;;
+		UNAME_MACHINE=alphaev67 ;;
 	    "EV6.8CB (21264C)")
-		UNAME_MACHINE="alphaev68" ;;
+		UNAME_MACHINE=alphaev68 ;;
 	    "EV6.8AL (21264B)")
-		UNAME_MACHINE="alphaev68" ;;
+		UNAME_MACHINE=alphaev68 ;;
 	    "EV6.8CX (21264D)")
-		UNAME_MACHINE="alphaev68" ;;
+		UNAME_MACHINE=alphaev68 ;;
 	    "EV6.9A (21264/EV69A)")
-		UNAME_MACHINE="alphaev69" ;;
+		UNAME_MACHINE=alphaev69 ;;
 	    "EV7 (21364)")
-		UNAME_MACHINE="alphaev7" ;;
+		UNAME_MACHINE=alphaev7 ;;
 	    "EV7.9 (21364A)")
-		UNAME_MACHINE="alphaev79" ;;
+		UNAME_MACHINE=alphaev79 ;;
 	esac
 	# A Pn.n version is a patched version.
 	# A Vn.n version is a released version.
 	# A Tn.n version is a released field test version.
 	# A Xn.n version is an unreleased experimental baselevel.
 	# 1.2 uses "1.2" for uname -r.
-	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[PVTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
-	exit ;;
-    Alpha\ *:Windows_NT*:*)
-	# How do we know it's Interix rather than the generic POSIX subsystem?
-	# Should we change UNAME_MACHINE based on the output of uname instead
-	# of the specific Alpha model?
-	echo alpha-pc-interix
-	exit ;;
-    21064:Windows_NT:50:3)
-	echo alpha-dec-winnt3.5
-	exit ;;
+	echo "$UNAME_MACHINE"-dec-osf"`echo "$UNAME_RELEASE" | sed -e 's/^[PVTX]//' | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz`"
+	# Reset EXIT trap before exiting to avoid spurious non-zero exit code.
+	exitcode=$?
+	trap '' 0
+	exit $exitcode ;;
     Amiga*:UNIX_System_V:4.0:*)
 	echo m68k-unknown-sysv4
 	exit ;;
     *:[Aa]miga[Oo][Ss]:*:*)
-	echo ${UNAME_MACHINE}-unknown-amigaos
+	echo "$UNAME_MACHINE"-unknown-amigaos
 	exit ;;
     *:[Mm]orph[Oo][Ss]:*:*)
-	echo ${UNAME_MACHINE}-unknown-morphos
+	echo "$UNAME_MACHINE"-unknown-morphos
 	exit ;;
     *:OS/390:*:*)
 	echo i370-ibm-openedition
@@ -296,12 +355,12 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
 	echo s390-ibm-zvmoe
 	exit ;;
     *:OS400:*:*)
-        echo powerpc-ibm-os400
+	echo powerpc-ibm-os400
 	exit ;;
     arm:RISC*:1.[012]*:*|arm:riscix:1.[012]*:*)
-	echo arm-acorn-riscix${UNAME_RELEASE}
+	echo arm-acorn-riscix"$UNAME_RELEASE"
 	exit ;;
-    arm:riscos:*:*|arm:RISCOS:*:*)
+    arm*:riscos:*:*|arm*:RISCOS:*:*)
 	echo arm-unknown-riscos
 	exit ;;
     SR2?01:HI-UX/MPP:*:* | SR8000:HI-UX/MPP:*:*)
@@ -326,38 +385,38 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
 	    sparc) echo sparc-icl-nx7; exit ;;
 	esac ;;
     s390x:SunOS:*:*)
-	echo ${UNAME_MACHINE}-ibm-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	echo "$UNAME_MACHINE"-ibm-solaris2"`echo "$UNAME_RELEASE" | sed -e 's/[^.]*//'`"
 	exit ;;
     sun4H:SunOS:5.*:*)
-	echo sparc-hal-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	echo sparc-hal-solaris2"`echo "$UNAME_RELEASE"|sed -e 's/[^.]*//'`"
 	exit ;;
     sun4*:SunOS:5.*:* | tadpole*:SunOS:5.*:*)
-	echo sparc-sun-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	echo sparc-sun-solaris2"`echo "$UNAME_RELEASE" | sed -e 's/[^.]*//'`"
 	exit ;;
     i86pc:AuroraUX:5.*:* | i86xen:AuroraUX:5.*:*)
-	echo i386-pc-auroraux${UNAME_RELEASE}
+	echo i386-pc-auroraux"$UNAME_RELEASE"
 	exit ;;
     i86pc:SunOS:5.*:* | i86xen:SunOS:5.*:*)
-	eval $set_cc_for_build
-	SUN_ARCH="i386"
+	set_cc_for_build
+	SUN_ARCH=i386
 	# If there is a compiler, see if it is configured for 64-bit objects.
 	# Note that the Sun cc does not turn __LP64__ into 1 like gcc does.
 	# This test works for both compilers.
-	if [ "$CC_FOR_BUILD" != 'no_compiler_found' ]; then
+	if test "$CC_FOR_BUILD" != no_compiler_found; then
 	    if (echo '#ifdef __amd64'; echo IS_64BIT_ARCH; echo '#endif') | \
-		(CCOPTS= $CC_FOR_BUILD -E - 2>/dev/null) | \
+		(CCOPTS="" $CC_FOR_BUILD -E - 2>/dev/null) | \
 		grep IS_64BIT_ARCH >/dev/null
 	    then
-		SUN_ARCH="x86_64"
+		SUN_ARCH=x86_64
 	    fi
 	fi
-	echo ${SUN_ARCH}-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	echo "$SUN_ARCH"-pc-solaris2"`echo "$UNAME_RELEASE"|sed -e 's/[^.]*//'`"
 	exit ;;
     sun4*:SunOS:6*:*)
 	# According to config.sub, this is the proper way to canonicalize
 	# SunOS6.  Hard to guess exactly what SunOS6 will be like, but
 	# it's likely to be more like Solaris than SunOS4.
-	echo sparc-sun-solaris3`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	echo sparc-sun-solaris3"`echo "$UNAME_RELEASE"|sed -e 's/[^.]*//'`"
 	exit ;;
     sun4*:SunOS:*:*)
 	case "`/usr/bin/arch -k`" in
@@ -366,25 +425,25 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
 		;;
 	esac
 	# Japanese Language versions have a version number like `4.1.3-JL'.
-	echo sparc-sun-sunos`echo ${UNAME_RELEASE}|sed -e 's/-/_/'`
+	echo sparc-sun-sunos"`echo "$UNAME_RELEASE"|sed -e 's/-/_/'`"
 	exit ;;
     sun3*:SunOS:*:*)
-	echo m68k-sun-sunos${UNAME_RELEASE}
+	echo m68k-sun-sunos"$UNAME_RELEASE"
 	exit ;;
     sun*:*:4.2BSD:*)
 	UNAME_RELEASE=`(sed 1q /etc/motd | awk '{print substr($5,1,3)}') 2>/dev/null`
-	test "x${UNAME_RELEASE}" = "x" && UNAME_RELEASE=3
+	test "x$UNAME_RELEASE" = x && UNAME_RELEASE=3
 	case "`/bin/arch`" in
 	    sun3)
-		echo m68k-sun-sunos${UNAME_RELEASE}
+		echo m68k-sun-sunos"$UNAME_RELEASE"
 		;;
 	    sun4)
-		echo sparc-sun-sunos${UNAME_RELEASE}
+		echo sparc-sun-sunos"$UNAME_RELEASE"
 		;;
 	esac
 	exit ;;
     aushp:SunOS:*:*)
-	echo sparc-auspex-sunos${UNAME_RELEASE}
+	echo sparc-auspex-sunos"$UNAME_RELEASE"
 	exit ;;
     # The situation for MiNT is a little confusing.  The machine name
     # can be virtually everything (everything which is not
@@ -395,44 +454,44 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
     # MiNT.  But MiNT is downward compatible to TOS, so this should
     # be no problem.
     atarist[e]:*MiNT:*:* | atarist[e]:*mint:*:* | atarist[e]:*TOS:*:*)
-        echo m68k-atari-mint${UNAME_RELEASE}
+	echo m68k-atari-mint"$UNAME_RELEASE"
 	exit ;;
     atari*:*MiNT:*:* | atari*:*mint:*:* | atarist[e]:*TOS:*:*)
-	echo m68k-atari-mint${UNAME_RELEASE}
-        exit ;;
+	echo m68k-atari-mint"$UNAME_RELEASE"
+	exit ;;
     *falcon*:*MiNT:*:* | *falcon*:*mint:*:* | *falcon*:*TOS:*:*)
-        echo m68k-atari-mint${UNAME_RELEASE}
+	echo m68k-atari-mint"$UNAME_RELEASE"
 	exit ;;
     milan*:*MiNT:*:* | milan*:*mint:*:* | *milan*:*TOS:*:*)
-        echo m68k-milan-mint${UNAME_RELEASE}
-        exit ;;
+	echo m68k-milan-mint"$UNAME_RELEASE"
+	exit ;;
     hades*:*MiNT:*:* | hades*:*mint:*:* | *hades*:*TOS:*:*)
-        echo m68k-hades-mint${UNAME_RELEASE}
-        exit ;;
+	echo m68k-hades-mint"$UNAME_RELEASE"
+	exit ;;
     *:*MiNT:*:* | *:*mint:*:* | *:*TOS:*:*)
-        echo m68k-unknown-mint${UNAME_RELEASE}
-        exit ;;
+	echo m68k-unknown-mint"$UNAME_RELEASE"
+	exit ;;
     m68k:machten:*:*)
-	echo m68k-apple-machten${UNAME_RELEASE}
+	echo m68k-apple-machten"$UNAME_RELEASE"
 	exit ;;
     powerpc:machten:*:*)
-	echo powerpc-apple-machten${UNAME_RELEASE}
+	echo powerpc-apple-machten"$UNAME_RELEASE"
 	exit ;;
     RISC*:Mach:*:*)
 	echo mips-dec-mach_bsd4.3
 	exit ;;
     RISC*:ULTRIX:*:*)
-	echo mips-dec-ultrix${UNAME_RELEASE}
+	echo mips-dec-ultrix"$UNAME_RELEASE"
 	exit ;;
     VAX*:ULTRIX*:*:*)
-	echo vax-dec-ultrix${UNAME_RELEASE}
+	echo vax-dec-ultrix"$UNAME_RELEASE"
 	exit ;;
     2020:CLIX:*:* | 2430:CLIX:*:*)
-	echo clipper-intergraph-clix${UNAME_RELEASE}
+	echo clipper-intergraph-clix"$UNAME_RELEASE"
 	exit ;;
     mips:*:*:UMIPS | mips:*:*:RISCos)
-	eval $set_cc_for_build
-	sed 's/^	//' << EOF >$dummy.c
+	set_cc_for_build
+	sed 's/^	//' << EOF > "$dummy.c"
 #ifdef __cplusplus
 #include <stdio.h>  /* for printf() prototype */
 	int main (int argc, char *argv[]) {
@@ -441,23 +500,23 @@ case "${UNAME_MACHINE}:${UNAME_SYSTEM}:$
 #endif
 	#if defined (host_mips) && defined (MIPSEB)
 	#if defined (SYSTYPE_SYSV)
-	  printf ("mips-mips-riscos%ssysv\n", argv[1]); exit (0);
+	  printf ("mips-mips-riscos%ssysv\\n", argv[1]); exit (0);
 	#endif
 	#if defined (SYSTYPE_SVR4)
-	  printf ("mips-mips-riscos%ssvr4\n", argv[1]); exit (0);
+	  printf ("mips-mips-riscos%ssvr4\\n", argv[1]); exit (0);
 	#endif
 	#if defined (SYSTYPE_BSD43) || defined(SYSTYPE_BSD)
-	  printf ("mips-mips-riscos%sbsd\n", argv[1]); exit (0);
+	  printf ("mips-mips-riscos%sbsd\\n", argv[1]); exit (0);
 	#endif
 	#endif
 	  exit (-1);
 	}
 EOF
-	$CC_FOR_BUILD -o $dummy $dummy.c &&
-	  dummyarg=`echo "${UNAME_RELEASE}" | sed -n 's/\([0-9]*\).*/\1/p'` &&
-	  SYSTEM_NAME=`$dummy $dummyarg` &&
+	$CC_FOR_BUILD -o "$dummy" "$dummy.c" &&
+	  dummyarg=`echo "$UNAME_RELEASE" | sed -n 's/\([0-9]*\).*/\1/p'` &&
+	  SYSTEM_NAME=`"$dummy" "$dummyarg"` &&
 	    { echo "$SYSTEM_NAME"; exit; }
-	echo mips-mips-riscos${UNAME_RELEASE}
+	echo mips-mips-riscos"$UNAME_RELEASE"
 	exit ;;
     Motorola:PowerMAX_OS:*:*)
 	echo powerpc-motorola-powermax
@@ -481,21 +540,21 @@ EOF
 	echo m88k-motorola-sysv3
 	exit ;;
     AViiON:dgux:*:*)
-        # DG/UX returns AViiON for all architectures
-        UNAME_PROCESSOR=`/usr/bin/uname -p`
-	if [ $UNAME_PROCESSOR = mc88100 ] || [ $UNAME_PROCESSOR = mc88110 ]
+	# DG/UX returns AViiON for all architectures
+	UNAME_PROCESSOR=`/usr/bin/uname -p`
+	if test "$UNAME_PROCESSOR" = mc88100 || test "$UNAME_PROCESSOR" = mc88110
 	then
-	    if [ ${TARGET_BINARY_INTERFACE}x = m88kdguxelfx ] || \
-	       [ ${TARGET_BINARY_INTERFACE}x = x ]
+	    if test "$TARGET_BINARY_INTERFACE"x = m88kdguxelfx || \
+	       test "$TARGET_BINARY_INTERFACE"x = x
 	    then
-		echo m88k-dg-dgux${UNAME_RELEASE}
+		echo m88k-dg-dgux"$UNAME_RELEASE"
 	    else
-		echo m88k-dg-dguxbcs${UNAME_RELEASE}
+		echo m88k-dg-dguxbcs"$UNAME_RELEASE"
 	    fi
 	else
-	    echo i586-dg-dgux${UNAME_RELEASE}
+	    echo i586-dg-dgux"$UNAME_RELEASE"
 	fi
- 	exit ;;
+	exit ;;
     M88*:DolphinOS:*:*)	# DolphinOS (SVR3)
 	echo m88k-dolphin-sysv3
 	exit ;;
@@ -510,7 +569,7 @@ EOF
 	echo m68k-tektronix-bsd
 	exit ;;
     *:IRIX*:*:*)
-	echo mips-sgi-irix`echo ${UNAME_RELEASE}|sed -e 's/-/_/g'`
+	echo mips-sgi-irix"`echo "$UNAME_RELEASE"|sed -e 's/-/_/g'`"
 	exit ;;
     ????????:AIX?:[12].1:2)   # AIX 2.2.1 or AIX 2.1.1 is RT/PC AIX.
 	echo romp-ibm-aix     # uname -m gives an 8 hex-code CPU id
@@ -519,17 +578,17 @@ EOF
 	echo i386-ibm-aix
 	exit ;;
     ia64:AIX:*:*)
-	if [ -x /usr/bin/oslevel ] ; then
+	if test -x /usr/bin/oslevel ; then
 		IBM_REV=`/usr/bin/oslevel`
 	else
-		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
+		IBM_REV="$UNAME_VERSION.$UNAME_RELEASE"
 	fi
-	echo ${UNAME_MACHINE}-ibm-aix${IBM_REV}
+	echo "$UNAME_MACHINE"-ibm-aix"$IBM_REV"
 	exit ;;
     *:AIX:2:3)
 	if grep bos325 /usr/include/stdio.h >/dev/null 2>&1; then
-		eval $set_cc_for_build
-		sed 's/^		//' << EOF >$dummy.c
+		set_cc_for_build
+		sed 's/^		//' << EOF > "$dummy.c"
 		#include <sys/systemcfg.h>
 
 		main()
@@ -540,7 +599,7 @@ EOF
 			exit(0);
 			}
 EOF
-		if $CC_FOR_BUILD -o $dummy $dummy.c && SYSTEM_NAME=`$dummy`
+		if $CC_FOR_BUILD -o "$dummy" "$dummy.c" && SYSTEM_NAME=`"$dummy"`
 		then
 			echo "$SYSTEM_NAME"
 		else
@@ -554,26 +613,27 @@ EOF
 	exit ;;
     *:AIX:*:[4567])
 	IBM_CPU_ID=`/usr/sbin/lsdev -C -c processor -S available | sed 1q | awk '{ print $1 }'`
-	if /usr/sbin/lsattr -El ${IBM_CPU_ID} | grep ' POWER' >/dev/null 2>&1; then
+	if /usr/sbin/lsattr -El "$IBM_CPU_ID" | grep ' POWER' >/dev/null 2>&1; then
 		IBM_ARCH=rs6000
 	else
 		IBM_ARCH=powerpc
 	fi
-	if [ -x /usr/bin/oslevel ] ; then
-		IBM_REV=`/usr/bin/oslevel`
+	if test -x /usr/bin/lslpp ; then
+		IBM_REV=`/usr/bin/lslpp -Lqc bos.rte.libc |
+			   awk -F: '{ print $3 }' | sed s/[0-9]*$/0/`
 	else
-		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
+		IBM_REV="$UNAME_VERSION.$UNAME_RELEASE"
 	fi
-	echo ${IBM_ARCH}-ibm-aix${IBM_REV}
+	echo "$IBM_ARCH"-ibm-aix"$IBM_REV"
 	exit ;;
     *:AIX:*:*)
 	echo rs6000-ibm-aix
 	exit ;;
-    ibmrt:4.4BSD:*|romp-ibm:BSD:*)
+    ibmrt:4.4BSD:*|romp-ibm:4.4BSD:*)
 	echo romp-ibm-bsd4.4
 	exit ;;
     ibmrt:*BSD:*|romp-ibm:BSD:*)            # covers RT/PC BSD and
-	echo romp-ibm-bsd${UNAME_RELEASE}   # 4.3 with uname added to
+	echo romp-ibm-bsd"$UNAME_RELEASE"   # 4.3 with uname added to
 	exit ;;                             # report: romp-ibm BSD 4.3
     *:BOSX:*:*)
 	echo rs6000-bull-bosx
@@ -588,67 +648,67 @@ EOF
 	echo m68k-hp-bsd4.4
 	exit ;;
     9000/[34678]??:HP-UX:*:*)
-	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
-	case "${UNAME_MACHINE}" in
-	    9000/31? )            HP_ARCH=m68000 ;;
-	    9000/[34]?? )         HP_ARCH=m68k ;;
+	HPUX_REV=`echo "$UNAME_RELEASE"|sed -e 's/[^.]*.[0B]*//'`
+	case "$UNAME_MACHINE" in
+	    9000/31?)            HP_ARCH=m68000 ;;
+	    9000/[34]??)         HP_ARCH=m68k ;;
 	    9000/[678][0-9][0-9])
-		if [ -x /usr/bin/getconf ]; then
+		if test -x /usr/bin/getconf; then
 		    sc_cpu_version=`/usr/bin/getconf SC_CPU_VERSION 2>/dev/null`
-                    sc_kernel_bits=`/usr/bin/getconf SC_KERNEL_BITS 2>/dev/null`
-                    case "${sc_cpu_version}" in
-                      523) HP_ARCH="hppa1.0" ;; # CPU_PA_RISC1_0
-                      528) HP_ARCH="hppa1.1" ;; # CPU_PA_RISC1_1
-                      532)                      # CPU_PA_RISC2_0
-                        case "${sc_kernel_bits}" in
-                          32) HP_ARCH="hppa2.0n" ;;
-                          64) HP_ARCH="hppa2.0w" ;;
-			  '') HP_ARCH="hppa2.0" ;;   # HP-UX 10.20
-                        esac ;;
-                    esac
+		    sc_kernel_bits=`/usr/bin/getconf SC_KERNEL_BITS 2>/dev/null`
+		    case "$sc_cpu_version" in
+		      523) HP_ARCH=hppa1.0 ;; # CPU_PA_RISC1_0
+		      528) HP_ARCH=hppa1.1 ;; # CPU_PA_RISC1_1
+		      532)                      # CPU_PA_RISC2_0
+			case "$sc_kernel_bits" in
+			  32) HP_ARCH=hppa2.0n ;;
+			  64) HP_ARCH=hppa2.0w ;;
+			  '') HP_ARCH=hppa2.0 ;;   # HP-UX 10.20
+			esac ;;
+		    esac
 		fi
-		if [ "${HP_ARCH}" = "" ]; then
-		    eval $set_cc_for_build
-		    sed 's/^              //' << EOF >$dummy.c
-
-              #define _HPUX_SOURCE
-              #include <stdlib.h>
-              #include <unistd.h>
-
-              int main ()
-              {
-              #if defined(_SC_KERNEL_BITS)
-                  long bits = sysconf(_SC_KERNEL_BITS);
-              #endif
-                  long cpu  = sysconf (_SC_CPU_VERSION);
-
-                  switch (cpu)
-              	{
-              	case CPU_PA_RISC1_0: puts ("hppa1.0"); break;
-              	case CPU_PA_RISC1_1: puts ("hppa1.1"); break;
-              	case CPU_PA_RISC2_0:
-              #if defined(_SC_KERNEL_BITS)
-              	    switch (bits)
-              		{
-              		case 64: puts ("hppa2.0w"); break;
-              		case 32: puts ("hppa2.0n"); break;
-              		default: puts ("hppa2.0"); break;
-              		} break;
-              #else  /* !defined(_SC_KERNEL_BITS) */
-              	    puts ("hppa2.0"); break;
-              #endif
-              	default: puts ("hppa1.0"); break;
-              	}
-                  exit (0);
-              }
+		if test "$HP_ARCH" = ""; then
+		    set_cc_for_build
+		    sed 's/^		//' << EOF > "$dummy.c"
+
+		#define _HPUX_SOURCE
+		#include <stdlib.h>
+		#include <unistd.h>
+
+		int main ()
+		{
+		#if defined(_SC_KERNEL_BITS)
+		    long bits = sysconf(_SC_KERNEL_BITS);
+		#endif
+		    long cpu  = sysconf (_SC_CPU_VERSION);
+
+		    switch (cpu)
+			{
+			case CPU_PA_RISC1_0: puts ("hppa1.0"); break;
+			case CPU_PA_RISC1_1: puts ("hppa1.1"); break;
+			case CPU_PA_RISC2_0:
+		#if defined(_SC_KERNEL_BITS)
+			    switch (bits)
+				{
+				case 64: puts ("hppa2.0w"); break;
+				case 32: puts ("hppa2.0n"); break;
+				default: puts ("hppa2.0"); break;
+				} break;
+		#else  /* !defined(_SC_KERNEL_BITS) */
+			    puts ("hppa2.0"); break;
+		#endif
+			default: puts ("hppa1.0"); break;
+			}
+		    exit (0);
+		}
 EOF
-		    (CCOPTS= $CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null) && HP_ARCH=`$dummy`
+		    (CCOPTS="" $CC_FOR_BUILD -o "$dummy" "$dummy.c" 2>/dev/null) && HP_ARCH=`"$dummy"`
 		    test -z "$HP_ARCH" && HP_ARCH=hppa
 		fi ;;
 	esac
-	if [ ${HP_ARCH} = "hppa2.0w" ]
+	if test "$HP_ARCH" = hppa2.0w
 	then
-	    eval $set_cc_for_build
+	    set_cc_for_build
 
 	    # hppa2.0w-hp-hpux* has a 64-bit kernel and a compiler generating
 	    # 32-bit code.  hppa64-hp-hpux* has the same kernel and a compiler
@@ -659,23 +719,23 @@ EOF
 	    # $ CC_FOR_BUILD="cc +DA2.0w" ./config.guess
 	    # => hppa64-hp-hpux11.23
 
-	    if echo __LP64__ | (CCOPTS= $CC_FOR_BUILD -E - 2>/dev/null) |
+	    if echo __LP64__ | (CCOPTS="" $CC_FOR_BUILD -E - 2>/dev/null) |
 		grep -q __LP64__
 	    then
-		HP_ARCH="hppa2.0w"
+		HP_ARCH=hppa2.0w
 	    else
-		HP_ARCH="hppa64"
+		HP_ARCH=hppa64
 	    fi
 	fi
-	echo ${HP_ARCH}-hp-hpux${HPUX_REV}
+	echo "$HP_ARCH"-hp-hpux"$HPUX_REV"
 	exit ;;
     ia64:HP-UX:*:*)
-	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
-	echo ia64-hp-hpux${HPUX_REV}
+	HPUX_REV=`echo "$UNAME_RELEASE"|sed -e 's/[^.]*.[0B]*//'`
+	echo ia64-hp-hpux"$HPUX_REV"
 	exit ;;
     3050*:HI-UX:*:*)
-	eval $set_cc_for_build
-	sed 's/^	//' << EOF >$dummy.c
+	set_cc_for_build
+	sed 's/^	//' << EOF > "$dummy.c"
 	#include <unistd.h>
 	int
 	main ()
@@ -700,11 +760,11 @@ EOF
 	  exit (0);
 	}
 EOF
-	$CC_FOR_BUILD -o $dummy $dummy.c && SYSTEM_NAME=`$dummy` &&
+	$CC_FOR_BUILD -o "$dummy" "$dummy.c" && SYSTEM_NAME=`"$dummy"` &&
 		{ echo "$SYSTEM_NAME"; exit; }
 	echo unknown-hitachi-hiuxwe2
 	exit ;;
-    9000/7??:4.3bsd:*:* | 9000/8?[79]:4.3bsd:*:* )
+    9000/7??:4.3bsd:*:* | 9000/8?[79]:4.3bsd:*:*)
 	echo hppa1.1-hp-bsd
 	exit ;;
     9000/8??:4.3bsd:*:*)
@@ -713,17 +773,17 @@ EOF
     *9??*:MPE/iX:*:* | *3000*:MPE/iX:*:*)
 	echo hppa1.0-hp-mpeix
 	exit ;;
-    hp7??:OSF1:*:* | hp8?[79]:OSF1:*:* )
+    hp7??:OSF1:*:* | hp8?[79]:OSF1:*:*)
 	echo hppa1.1-hp-osf
 	exit ;;
     hp8??:OSF1:*:*)
 	echo hppa1.0-hp-osf
 	exit ;;
     i*86:OSF1:*:*)
-	if [ -x /usr/sbin/sysversion ] ; then
-	    echo ${UNAME_MACHINE}-unknown-osf1mk
+	if test -x /usr/sbin/sysversion ; then
+	    echo "$UNAME_MACHINE"-unknown-osf1mk
 	else
-	    echo ${UNAME_MACHINE}-unknown-osf1
+	    echo "$UNAME_MACHINE"-unknown-osf1
 	fi
 	exit ;;
     parisc*:Lites*:*:*)
@@ -731,135 +791,140 @@ EOF
 	exit ;;
     C1*:ConvexOS:*:* | convex:ConvexOS:C1*:*)
 	echo c1-convex-bsd
-        exit ;;
+	exit ;;
     C2*:ConvexOS:*:* | convex:ConvexOS:C2*:*)
 	if getsysinfo -f scalar_acc
 	then echo c32-convex-bsd
 	else echo c2-convex-bsd
 	fi
-        exit ;;
+	exit ;;
     C34*:ConvexOS:*:* | convex:ConvexOS:C34*:*)
 	echo c34-convex-bsd
-        exit ;;
+	exit ;;
     C38*:ConvexOS:*:* | convex:ConvexOS:C38*:*)
 	echo c38-convex-bsd
-        exit ;;
+	exit ;;
     C4*:ConvexOS:*:* | convex:ConvexOS:C4*:*)
 	echo c4-convex-bsd
-        exit ;;
+	exit ;;
     CRAY*Y-MP:*:*:*)
-	echo ymp-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	echo ymp-cray-unicos"$UNAME_RELEASE" | sed -e 's/\.[^.]*$/.X/'
 	exit ;;
     CRAY*[A-Z]90:*:*:*)
-	echo ${UNAME_MACHINE}-cray-unicos${UNAME_RELEASE} \
+	echo "$UNAME_MACHINE"-cray-unicos"$UNAME_RELEASE" \
 	| sed -e 's/CRAY.*\([A-Z]90\)/\1/' \
 	      -e y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/ \
 	      -e 's/\.[^.]*$/.X/'
 	exit ;;
     CRAY*TS:*:*:*)
-	echo t90-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	echo t90-cray-unicos"$UNAME_RELEASE" | sed -e 's/\.[^.]*$/.X/'
 	exit ;;
     CRAY*T3E:*:*:*)
-	echo alphaev5-cray-unicosmk${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	echo alphaev5-cray-unicosmk"$UNAME_RELEASE" | sed -e 's/\.[^.]*$/.X/'
 	exit ;;
     CRAY*SV1:*:*:*)
-	echo sv1-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	echo sv1-cray-unicos"$UNAME_RELEASE" | sed -e 's/\.[^.]*$/.X/'
 	exit ;;
     *:UNICOS/mp:*:*)
-	echo craynv-cray-unicosmp${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	echo craynv-cray-unicosmp"$UNAME_RELEASE" | sed -e 's/\.[^.]*$/.X/'
 	exit ;;
     F30[01]:UNIX_System_V:*:* | F700:UNIX_System_V:*:*)
-	FUJITSU_PROC=`uname -m | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
-        FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
-        FUJITSU_REL=`echo ${UNAME_RELEASE} | sed -e 's/ /_/'`
-        echo "${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
-        exit ;;
+	FUJITSU_PROC=`uname -m | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz`
+	FUJITSU_SYS=`uname -p | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz | sed -e 's/\///'`
+	FUJITSU_REL=`echo "$UNAME_RELEASE" | sed -e 's/ /_/'`
+	echo "${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
+	exit ;;
     5000:UNIX_System_V:4.*:*)
-        FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
-        FUJITSU_REL=`echo ${UNAME_RELEASE} | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/ /_/'`
-        echo "sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
+	FUJITSU_SYS=`uname -p | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz | sed -e 's/\///'`
+	FUJITSU_REL=`echo "$UNAME_RELEASE" | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz | sed -e 's/ /_/'`
+	echo "sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
 	exit ;;
     i*86:BSD/386:*:* | i*86:BSD/OS:*:* | *:Ascend\ Embedded/OS:*:*)
-	echo ${UNAME_MACHINE}-pc-bsdi${UNAME_RELEASE}
+	echo "$UNAME_MACHINE"-pc-bsdi"$UNAME_RELEASE"
 	exit ;;
     sparc*:BSD/OS:*:*)
-	echo sparc-unknown-bsdi${UNAME_RELEASE}
+	echo sparc-unknown-bsdi"$UNAME_RELEASE"
 	exit ;;
     *:BSD/OS:*:*)
-	echo ${UNAME_MACHINE}-unknown-bsdi${UNAME_RELEASE}
+	echo "$UNAME_MACHINE"-unknown-bsdi"$UNAME_RELEASE"
+	exit ;;
+    arm:FreeBSD:*:*)
+	UNAME_PROCESSOR=`uname -p`
+	set_cc_for_build
+	if echo __ARM_PCS_VFP | $CC_FOR_BUILD -E - 2>/dev/null \
+	    | grep -q __ARM_PCS_VFP
+	then
+	    echo "${UNAME_PROCESSOR}"-unknown-freebsd"`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`"-gnueabi
+	else
+	    echo "${UNAME_PROCESSOR}"-unknown-freebsd"`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`"-gnueabihf
+	fi
 	exit ;;
     *:FreeBSD:*:*)
-	case ${UNAME_MACHINE} in
-	    pc98)
-		echo i386-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	UNAME_PROCESSOR=`/usr/bin/uname -p`
+	case "$UNAME_PROCESSOR" in
 	    amd64)
-		echo x86_64-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
-	    *)
-		echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+		UNAME_PROCESSOR=x86_64 ;;
+	    i386)
+		UNAME_PROCESSOR=i586 ;;
 	esac
+	echo "$UNAME_PROCESSOR"-unknown-freebsd"`echo "$UNAME_RELEASE"|sed -e 's/[-(].*//'`"
 	exit ;;
     i*:CYGWIN*:*)
-	echo ${UNAME_MACHINE}-pc-cygwin
+	echo "$UNAME_MACHINE"-pc-cygwin
+	exit ;;
+    *:MINGW64*:*)
+	echo "$UNAME_MACHINE"-pc-mingw64
 	exit ;;
     *:MINGW*:*)
-	echo ${UNAME_MACHINE}-pc-mingw32
+	echo "$UNAME_MACHINE"-pc-mingw32
 	exit ;;
-    i*:windows32*:*)
-    	# uname -m includes "-pc" on this system.
-    	echo ${UNAME_MACHINE}-mingw32
+    *:MSYS*:*)
+	echo "$UNAME_MACHINE"-pc-msys
 	exit ;;
     i*:PW*:*)
-	echo ${UNAME_MACHINE}-pc-pw32
+	echo "$UNAME_MACHINE"-pc-pw32
 	exit ;;
     *:Interix*:*)
-    	case ${UNAME_MACHINE} in
+	case "$UNAME_MACHINE" in
 	    x86)
-		echo i586-pc-interix${UNAME_RELEASE}
+		echo i586-pc-interix"$UNAME_RELEASE"
 		exit ;;
 	    authenticamd | genuineintel | EM64T)
-		echo x86_64-unknown-interix${UNAME_RELEASE}
+		echo x86_64-unknown-interix"$UNAME_RELEASE"
 		exit ;;
 	    IA64)
-		echo ia64-unknown-interix${UNAME_RELEASE}
+		echo ia64-unknown-interix"$UNAME_RELEASE"
 		exit ;;
 	esac ;;
-    [345]86:Windows_95:* | [345]86:Windows_98:* | [345]86:Windows_NT:*)
-	echo i${UNAME_MACHINE}-pc-mks
-	exit ;;
-    8664:Windows_NT:*)
-	echo x86_64-pc-mks
-	exit ;;
-    i*:Windows_NT*:* | Pentium*:Windows_NT*:*)
-	# How do we know it's Interix rather than the generic POSIX subsystem?
-	# It also conflicts with pre-2.0 versions of AT&T UWIN. Should we
-	# UNAME_MACHINE based on the output of uname instead of i386?
-	echo i586-pc-interix
-	exit ;;
     i*:UWIN*:*)
-	echo ${UNAME_MACHINE}-pc-uwin
+	echo "$UNAME_MACHINE"-pc-uwin
 	exit ;;
     amd64:CYGWIN*:*:* | x86_64:CYGWIN*:*:*)
-	echo x86_64-unknown-cygwin
-	exit ;;
-    p*:CYGWIN*:*)
-	echo powerpcle-unknown-cygwin
+	echo x86_64-pc-cygwin
 	exit ;;
     prep*:SunOS:5.*:*)
-	echo powerpcle-unknown-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	echo powerpcle-unknown-solaris2"`echo "$UNAME_RELEASE"|sed -e 's/[^.]*//'`"
 	exit ;;
     *:GNU:*:*)
 	# the GNU system
-	echo `echo ${UNAME_MACHINE}|sed -e 's,[-/].*$,,'`-unknown-gnu`echo ${UNAME_RELEASE}|sed -e 's,/.*$,,'`
+	echo "`echo "$UNAME_MACHINE"|sed -e 's,[-/].*$,,'`-unknown-$LIBC`echo "$UNAME_RELEASE"|sed -e 's,/.*$,,'`"
 	exit ;;
     *:GNU/*:*:*)
 	# other systems with GNU libc and userland
-	echo ${UNAME_MACHINE}-unknown-`echo ${UNAME_SYSTEM} | sed 's,^[^/]*/,,' | tr '[A-Z]' '[a-z]'``echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`-gnu
+	echo "$UNAME_MACHINE-unknown-`echo "$UNAME_SYSTEM" | sed 's,^[^/]*/,,' | tr "[:upper:]" "[:lower:]"``echo "$UNAME_RELEASE"|sed -e 's/[-(].*//'`-$LIBC"
+	exit ;;
+    *:Minix:*:*)
+	echo "$UNAME_MACHINE"-unknown-minix
 	exit ;;
-    i*86:Minix:*:*)
-	echo ${UNAME_MACHINE}-pc-minix
+    aarch64:Linux:*:*)
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
+	exit ;;
+    aarch64_be:Linux:*:*)
+	UNAME_MACHINE=aarch64_be
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     alpha:Linux:*:*)
-	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' < /proc/cpuinfo` in
+	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' /proc/cpuinfo 2>/dev/null` in
 	  EV5)   UNAME_MACHINE=alphaev5 ;;
 	  EV56)  UNAME_MACHINE=alphaev56 ;;
 	  PCA56) UNAME_MACHINE=alphapca56 ;;
@@ -867,118 +932,181 @@ EOF
 	  EV6)   UNAME_MACHINE=alphaev6 ;;
 	  EV67)  UNAME_MACHINE=alphaev67 ;;
 	  EV68*) UNAME_MACHINE=alphaev68 ;;
-        esac
+	esac
 	objdump --private-headers /bin/sh | grep -q ld.so.1
-	if test "$?" = 0 ; then LIBC="libc1" ; else LIBC="" ; fi
-	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
+	if test "$?" = 0 ; then LIBC=gnulibc1 ; fi
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
+	exit ;;
+    arc:Linux:*:* | arceb:Linux:*:*)
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     arm*:Linux:*:*)
-	eval $set_cc_for_build
+	set_cc_for_build
 	if echo __ARM_EABI__ | $CC_FOR_BUILD -E - 2>/dev/null \
 	    | grep -q __ARM_EABI__
 	then
-	    echo ${UNAME_MACHINE}-unknown-linux-gnu
+	    echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	else
-	    echo ${UNAME_MACHINE}-unknown-linux-gnueabi
+	    if echo __ARM_PCS_VFP | $CC_FOR_BUILD -E - 2>/dev/null \
+		| grep -q __ARM_PCS_VFP
+	    then
+		echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"eabi
+	    else
+		echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"eabihf
+	    fi
 	fi
 	exit ;;
     avr32*:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     cris:Linux:*:*)
-	echo cris-axis-linux-gnu
+	echo "$UNAME_MACHINE"-axis-linux-"$LIBC"
 	exit ;;
     crisv32:Linux:*:*)
-	echo crisv32-axis-linux-gnu
+	echo "$UNAME_MACHINE"-axis-linux-"$LIBC"
+	exit ;;
+    e2k:Linux:*:*)
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     frv:Linux:*:*)
-    	echo frv-unknown-linux-gnu
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
+	exit ;;
+    hexagon:Linux:*:*)
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     i*86:Linux:*:*)
-	LIBC=gnu
-	eval $set_cc_for_build
-	sed 's/^	//' << EOF >$dummy.c
-	#ifdef __dietlibc__
-	LIBC=dietlibc
-	#endif
-EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep '^LIBC'`
-	echo "${UNAME_MACHINE}-pc-linux-${LIBC}"
+	echo "$UNAME_MACHINE"-pc-linux-"$LIBC"
 	exit ;;
     ia64:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
+	exit ;;
+    k1om:Linux:*:*)
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     m32r*:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     m68*:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     mips:Linux:*:* | mips64:Linux:*:*)
-	eval $set_cc_for_build
-	sed 's/^	//' << EOF >$dummy.c
+	set_cc_for_build
+	IS_GLIBC=0
+	test x"${LIBC}" = xgnu && IS_GLIBC=1
+	sed 's/^	//' << EOF > "$dummy.c"
 	#undef CPU
-	#undef ${UNAME_MACHINE}
-	#undef ${UNAME_MACHINE}el
+	#undef mips
+	#undef mipsel
+	#undef mips64
+	#undef mips64el
+	#if ${IS_GLIBC} && defined(_ABI64)
+	LIBCABI=gnuabi64
+	#else
+	#if ${IS_GLIBC} && defined(_ABIN32)
+	LIBCABI=gnuabin32
+	#else
+	LIBCABI=${LIBC}
+	#endif
+	#endif
+
+	#if ${IS_GLIBC} && defined(__mips64) && defined(__mips_isa_rev) && __mips_isa_rev>=6
+	CPU=mipsisa64r6
+	#else
+	#if ${IS_GLIBC} && !defined(__mips64) && defined(__mips_isa_rev) && __mips_isa_rev>=6
+	CPU=mipsisa32r6
+	#else
+	#if defined(__mips64)
+	CPU=mips64
+	#else
+	CPU=mips
+	#endif
+	#endif
+	#endif
+
 	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
-	CPU=${UNAME_MACHINE}el
+	MIPS_ENDIAN=el
 	#else
 	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
-	CPU=${UNAME_MACHINE}
+	MIPS_ENDIAN=
 	#else
-	CPU=
+	MIPS_ENDIAN=
 	#endif
 	#endif
 EOF
-	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep '^CPU'`
-	test x"${CPU}" != x && { echo "${CPU}-unknown-linux-gnu"; exit; }
+	eval "`$CC_FOR_BUILD -E "$dummy.c" 2>/dev/null | grep '^CPU\|^MIPS_ENDIAN\|^LIBCABI'`"
+	test "x$CPU" != x && { echo "$CPU${MIPS_ENDIAN}-unknown-linux-$LIBCABI"; exit; }
 	;;
-    or32:Linux:*:*)
-	echo or32-unknown-linux-gnu
+    mips64el:Linux:*:*)
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
+	exit ;;
+    openrisc*:Linux:*:*)
+	echo or1k-unknown-linux-"$LIBC"
+	exit ;;
+    or32:Linux:*:* | or1k*:Linux:*:*)
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     padre:Linux:*:*)
-	echo sparc-unknown-linux-gnu
+	echo sparc-unknown-linux-"$LIBC"
 	exit ;;
     parisc64:Linux:*:* | hppa64:Linux:*:*)
-	echo hppa64-unknown-linux-gnu
+	echo hppa64-unknown-linux-"$LIBC"
 	exit ;;
     parisc:Linux:*:* | hppa:Linux:*:*)
 	# Look for CPU level
 	case `grep '^cpu[^a-z]*:' /proc/cpuinfo 2>/dev/null | cut -d' ' -f2` in
-	  PA7*) echo hppa1.1-unknown-linux-gnu ;;
-	  PA8*) echo hppa2.0-unknown-linux-gnu ;;
-	  *)    echo hppa-unknown-linux-gnu ;;
+	  PA7*) echo hppa1.1-unknown-linux-"$LIBC" ;;
+	  PA8*) echo hppa2.0-unknown-linux-"$LIBC" ;;
+	  *)    echo hppa-unknown-linux-"$LIBC" ;;
 	esac
 	exit ;;
     ppc64:Linux:*:*)
-	echo powerpc64-unknown-linux-gnu
+	echo powerpc64-unknown-linux-"$LIBC"
 	exit ;;
     ppc:Linux:*:*)
-	echo powerpc-unknown-linux-gnu
+	echo powerpc-unknown-linux-"$LIBC"
+	exit ;;
+    ppc64le:Linux:*:*)
+	echo powerpc64le-unknown-linux-"$LIBC"
+	exit ;;
+    ppcle:Linux:*:*)
+	echo powerpcle-unknown-linux-"$LIBC"
+	exit ;;
+    riscv32:Linux:*:* | riscv64:Linux:*:*)
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     s390:Linux:*:* | s390x:Linux:*:*)
-	echo ${UNAME_MACHINE}-ibm-linux
+	echo "$UNAME_MACHINE"-ibm-linux-"$LIBC"
 	exit ;;
     sh64*:Linux:*:*)
-    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     sh*:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     sparc:Linux:*:* | sparc64:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     tile*:Linux:*:*)
-	echo ${UNAME_MACHINE}-tilera-linux-gnu
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     vax:Linux:*:*)
-	echo ${UNAME_MACHINE}-dec-linux-gnu
+	echo "$UNAME_MACHINE"-dec-linux-"$LIBC"
 	exit ;;
     x86_64:Linux:*:*)
-	echo x86_64-unknown-linux-gnu
+	set_cc_for_build
+	LIBCABI=$LIBC
+	if test "$CC_FOR_BUILD" != no_compiler_found; then
+	    if (echo '#ifdef __ILP32__'; echo IS_X32; echo '#endif') | \
+		(CCOPTS="" $CC_FOR_BUILD -E - 2>/dev/null) | \
+		grep IS_X32 >/dev/null
+	    then
+		LIBCABI="$LIBC"x32
+	    fi
+	fi
+	echo "$UNAME_MACHINE"-pc-linux-"$LIBCABI"
 	exit ;;
     xtensa*:Linux:*:*)
-    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	echo "$UNAME_MACHINE"-unknown-linux-"$LIBC"
 	exit ;;
     i*86:DYNIX/ptx:4*:*)
 	# ptx 4.0 does uname -s correctly, with DYNIX/ptx in there.
@@ -987,54 +1115,54 @@ EOF
 	echo i386-sequent-sysv4
 	exit ;;
     i*86:UNIX_SV:4.2MP:2.*)
-        # Unixware is an offshoot of SVR4, but it has its own version
-        # number series starting with 2...
-        # I am not positive that other SVR4 systems won't match this,
+	# Unixware is an offshoot of SVR4, but it has its own version
+	# number series starting with 2...
+	# I am not positive that other SVR4 systems won't match this,
 	# I just have to hope.  -- rms.
-        # Use sysv4.2uw... so that sysv4* matches it.
-	echo ${UNAME_MACHINE}-pc-sysv4.2uw${UNAME_VERSION}
+	# Use sysv4.2uw... so that sysv4* matches it.
+	echo "$UNAME_MACHINE"-pc-sysv4.2uw"$UNAME_VERSION"
 	exit ;;
     i*86:OS/2:*:*)
 	# If we were able to find `uname', then EMX Unix compatibility
 	# is probably installed.
-	echo ${UNAME_MACHINE}-pc-os2-emx
+	echo "$UNAME_MACHINE"-pc-os2-emx
 	exit ;;
     i*86:XTS-300:*:STOP)
-	echo ${UNAME_MACHINE}-unknown-stop
+	echo "$UNAME_MACHINE"-unknown-stop
 	exit ;;
     i*86:atheos:*:*)
-	echo ${UNAME_MACHINE}-unknown-atheos
+	echo "$UNAME_MACHINE"-unknown-atheos
 	exit ;;
     i*86:syllable:*:*)
-	echo ${UNAME_MACHINE}-pc-syllable
+	echo "$UNAME_MACHINE"-pc-syllable
 	exit ;;
     i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.[02]*:*)
-	echo i386-unknown-lynxos${UNAME_RELEASE}
+	echo i386-unknown-lynxos"$UNAME_RELEASE"
 	exit ;;
     i*86:*DOS:*:*)
-	echo ${UNAME_MACHINE}-pc-msdosdjgpp
+	echo "$UNAME_MACHINE"-pc-msdosdjgpp
 	exit ;;
-    i*86:*:4.*:* | i*86:SYSTEM_V:4.*:*)
-	UNAME_REL=`echo ${UNAME_RELEASE} | sed 's/\/MP$//'`
+    i*86:*:4.*:*)
+	UNAME_REL=`echo "$UNAME_RELEASE" | sed 's/\/MP$//'`
 	if grep Novell /usr/include/link.h >/dev/null 2>/dev/null; then
-		echo ${UNAME_MACHINE}-univel-sysv${UNAME_REL}
+		echo "$UNAME_MACHINE"-univel-sysv"$UNAME_REL"
 	else
-		echo ${UNAME_MACHINE}-pc-sysv${UNAME_REL}
+		echo "$UNAME_MACHINE"-pc-sysv"$UNAME_REL"
 	fi
 	exit ;;
     i*86:*:5:[678]*)
-    	# UnixWare 7.x, OpenUNIX and OpenServer 6.
+	# UnixWare 7.x, OpenUNIX and OpenServer 6.
 	case `/bin/uname -X | grep "^Machine"` in
 	    *486*)	     UNAME_MACHINE=i486 ;;
 	    *Pentium)	     UNAME_MACHINE=i586 ;;
 	    *Pent*|*Celeron) UNAME_MACHINE=i686 ;;
 	esac
-	echo ${UNAME_MACHINE}-unknown-sysv${UNAME_RELEASE}${UNAME_SYSTEM}${UNAME_VERSION}
+	echo "$UNAME_MACHINE-unknown-sysv${UNAME_RELEASE}${UNAME_SYSTEM}${UNAME_VERSION}"
 	exit ;;
     i*86:*:3.2:*)
 	if test -f /usr/options/cb.name; then
 		UNAME_REL=`sed -n 's/.*Version //p' </usr/options/cb.name`
-		echo ${UNAME_MACHINE}-pc-isc$UNAME_REL
+		echo "$UNAME_MACHINE"-pc-isc"$UNAME_REL"
 	elif /bin/uname -X 2>/dev/null >/dev/null ; then
 		UNAME_REL=`(/bin/uname -X|grep Release|sed -e 's/.*= //')`
 		(/bin/uname -X|grep i80486 >/dev/null) && UNAME_MACHINE=i486
@@ -1044,20 +1172,20 @@ EOF
 			&& UNAME_MACHINE=i686
 		(/bin/uname -X|grep '^Machine.*Pentium Pro' >/dev/null) \
 			&& UNAME_MACHINE=i686
-		echo ${UNAME_MACHINE}-pc-sco$UNAME_REL
+		echo "$UNAME_MACHINE"-pc-sco"$UNAME_REL"
 	else
-		echo ${UNAME_MACHINE}-pc-sysv32
+		echo "$UNAME_MACHINE"-pc-sysv32
 	fi
 	exit ;;
     pc:*:*:*)
 	# Left here for compatibility:
-        # uname -m prints for DJGPP always 'pc', but it prints nothing about
-        # the processor, so we play safe by assuming i586.
+	# uname -m prints for DJGPP always 'pc', but it prints nothing about
+	# the processor, so we play safe by assuming i586.
 	# Note: whatever this is, it MUST be the same as what config.sub
-	# prints for the "djgpp" host, or else GDB configury will decide that
+	# prints for the "djgpp" host, or else GDB configure will decide that
 	# this is a cross-build.
 	echo i586-pc-msdosdjgpp
-        exit ;;
+	exit ;;
     Intel:Mach:3*:*)
 	echo i386-pc-mach3
 	exit ;;
@@ -1066,9 +1194,9 @@ EOF
 	exit ;;
     i860:*:4.*:*) # i860-SVR4
 	if grep Stardent /usr/include/sys/uadmin.h >/dev/null 2>&1 ; then
-	  echo i860-stardent-sysv${UNAME_RELEASE} # Stardent Vistra i860-SVR4
+	  echo i860-stardent-sysv"$UNAME_RELEASE" # Stardent Vistra i860-SVR4
 	else # Add other i860-SVR4 vendors below as they are discovered.
-	  echo i860-unknown-sysv${UNAME_RELEASE}  # Unknown i860-SVR4
+	  echo i860-unknown-sysv"$UNAME_RELEASE"  # Unknown i860-SVR4
 	fi
 	exit ;;
     mini*:CTIX:SYS*5:*)
@@ -1088,39 +1216,39 @@ EOF
 	test -r /etc/.relid \
 	&& OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' < /etc/.relid`
 	/bin/uname -p 2>/dev/null | grep 86 >/dev/null \
-	  && { echo i486-ncr-sysv4.3${OS_REL}; exit; }
+	  && { echo i486-ncr-sysv4.3"$OS_REL"; exit; }
 	/bin/uname -p 2>/dev/null | /bin/grep entium >/dev/null \
-	  && { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
+	  && { echo i586-ncr-sysv4.3"$OS_REL"; exit; } ;;
     3[34]??:*:4.0:* | 3[34]??,*:*:4.0:*)
-        /bin/uname -p 2>/dev/null | grep 86 >/dev/null \
-          && { echo i486-ncr-sysv4; exit; } ;;
+	/bin/uname -p 2>/dev/null | grep 86 >/dev/null \
+	  && { echo i486-ncr-sysv4; exit; } ;;
     NCR*:*:4.2:* | MPRAS*:*:4.2:*)
 	OS_REL='.3'
 	test -r /etc/.relid \
 	    && OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' < /etc/.relid`
 	/bin/uname -p 2>/dev/null | grep 86 >/dev/null \
-	    && { echo i486-ncr-sysv4.3${OS_REL}; exit; }
+	    && { echo i486-ncr-sysv4.3"$OS_REL"; exit; }
 	/bin/uname -p 2>/dev/null | /bin/grep entium >/dev/null \
-	    && { echo i586-ncr-sysv4.3${OS_REL}; exit; }
+	    && { echo i586-ncr-sysv4.3"$OS_REL"; exit; }
 	/bin/uname -p 2>/dev/null | /bin/grep pteron >/dev/null \
-	    && { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
+	    && { echo i586-ncr-sysv4.3"$OS_REL"; exit; } ;;
     m68*:LynxOS:2.*:* | m68*:LynxOS:3.0*:*)
-	echo m68k-unknown-lynxos${UNAME_RELEASE}
+	echo m68k-unknown-lynxos"$UNAME_RELEASE"
 	exit ;;
     mc68030:UNIX_System_V:4.*:*)
 	echo m68k-atari-sysv4
 	exit ;;
     TSUNAMI:LynxOS:2.*:*)
-	echo sparc-unknown-lynxos${UNAME_RELEASE}
+	echo sparc-unknown-lynxos"$UNAME_RELEASE"
 	exit ;;
     rs6000:LynxOS:2.*:*)
-	echo rs6000-unknown-lynxos${UNAME_RELEASE}
+	echo rs6000-unknown-lynxos"$UNAME_RELEASE"
 	exit ;;
     PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.[02]*:*)
-	echo powerpc-unknown-lynxos${UNAME_RELEASE}
+	echo powerpc-unknown-lynxos"$UNAME_RELEASE"
 	exit ;;
     SM[BE]S:UNIX_SV:*:*)
-	echo mips-dde-sysv${UNAME_RELEASE}
+	echo mips-dde-sysv"$UNAME_RELEASE"
 	exit ;;
     RM*:ReliantUNIX-*:*:*)
 	echo mips-sni-sysv4
@@ -1131,15 +1259,15 @@ EOF
     *:SINIX-*:*:*)
 	if uname -p 2>/dev/null >/dev/null ; then
 		UNAME_MACHINE=`(uname -p) 2>/dev/null`
-		echo ${UNAME_MACHINE}-sni-sysv4
+		echo "$UNAME_MACHINE"-sni-sysv4
 	else
 		echo ns32k-sni-sysv
 	fi
 	exit ;;
-    PENTIUM:*:4.0*:*) # Unisys `ClearPath HMP IX 4000' SVR4/MP effort
-                      # says <Richard.M.Bartel@ccMail.Census.GOV>
-        echo i586-unisys-sysv4
-        exit ;;
+    PENTIUM:*:4.0*:*)	# Unisys `ClearPath HMP IX 4000' SVR4/MP effort
+			# says <Richard.M.Bartel@ccMail.Census.GOV>
+	echo i586-unisys-sysv4
+	exit ;;
     *:UNIX_System_V:4*:FTX*)
 	# From Gerald Hewes <hewes@openmarket.com>.
 	# How about differentiating between stratus architectures? -djm
@@ -1151,25 +1279,25 @@ EOF
 	exit ;;
     i*86:VOS:*:*)
 	# From Paul.Green@stratus.com.
-	echo ${UNAME_MACHINE}-stratus-vos
+	echo "$UNAME_MACHINE"-stratus-vos
 	exit ;;
     *:VOS:*:*)
 	# From Paul.Green@stratus.com.
 	echo hppa1.1-stratus-vos
 	exit ;;
     mc68*:A/UX:*:*)
-	echo m68k-apple-aux${UNAME_RELEASE}
+	echo m68k-apple-aux"$UNAME_RELEASE"
 	exit ;;
     news*:NEWS-OS:6*:*)
 	echo mips-sony-newsos6
 	exit ;;
     R[34]000:*System_V*:*:* | R4000:UNIX_SYSV:*:* | R*000:UNIX_SV:*:*)
-	if [ -d /usr/nec ]; then
-	        echo mips-nec-sysv${UNAME_RELEASE}
+	if test -d /usr/nec; then
+		echo mips-nec-sysv"$UNAME_RELEASE"
 	else
-	        echo mips-unknown-sysv${UNAME_RELEASE}
+		echo mips-unknown-sysv"$UNAME_RELEASE"
 	fi
-        exit ;;
+	exit ;;
     BeBox:BeOS:*:*)	# BeOS running on hardware made by Be, PPC only.
 	echo powerpc-be-beos
 	exit ;;
@@ -1182,63 +1310,101 @@ EOF
     BePC:Haiku:*:*)	# Haiku running on Intel PC compatible.
 	echo i586-pc-haiku
 	exit ;;
+    x86_64:Haiku:*:*)
+	echo x86_64-unknown-haiku
+	exit ;;
     SX-4:SUPER-UX:*:*)
-	echo sx4-nec-superux${UNAME_RELEASE}
+	echo sx4-nec-superux"$UNAME_RELEASE"
 	exit ;;
     SX-5:SUPER-UX:*:*)
-	echo sx5-nec-superux${UNAME_RELEASE}
+	echo sx5-nec-superux"$UNAME_RELEASE"
 	exit ;;
     SX-6:SUPER-UX:*:*)
-	echo sx6-nec-superux${UNAME_RELEASE}
+	echo sx6-nec-superux"$UNAME_RELEASE"
 	exit ;;
     SX-7:SUPER-UX:*:*)
-	echo sx7-nec-superux${UNAME_RELEASE}
+	echo sx7-nec-superux"$UNAME_RELEASE"
 	exit ;;
     SX-8:SUPER-UX:*:*)
-	echo sx8-nec-superux${UNAME_RELEASE}
+	echo sx8-nec-superux"$UNAME_RELEASE"
 	exit ;;
     SX-8R:SUPER-UX:*:*)
-	echo sx8r-nec-superux${UNAME_RELEASE}
+	echo sx8r-nec-superux"$UNAME_RELEASE"
+	exit ;;
+    SX-ACE:SUPER-UX:*:*)
+	echo sxace-nec-superux"$UNAME_RELEASE"
 	exit ;;
     Power*:Rhapsody:*:*)
-	echo powerpc-apple-rhapsody${UNAME_RELEASE}
+	echo powerpc-apple-rhapsody"$UNAME_RELEASE"
 	exit ;;
     *:Rhapsody:*:*)
-	echo ${UNAME_MACHINE}-apple-rhapsody${UNAME_RELEASE}
+	echo "$UNAME_MACHINE"-apple-rhapsody"$UNAME_RELEASE"
+	exit ;;
+    arm64:Darwin:*:*)
+	echo aarch64-apple-darwin"$UNAME_RELEASE"
 	exit ;;
     *:Darwin:*:*)
-	UNAME_PROCESSOR=`uname -p` || UNAME_PROCESSOR=unknown
+	UNAME_PROCESSOR=`uname -p`
 	case $UNAME_PROCESSOR in
-	    i386)
-		eval $set_cc_for_build
-		if [ "$CC_FOR_BUILD" != 'no_compiler_found' ]; then
-		  if (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \
-		      (CCOPTS= $CC_FOR_BUILD -E - 2>/dev/null) | \
-		      grep IS_64BIT_ARCH >/dev/null
-		  then
-		      UNAME_PROCESSOR="x86_64"
-		  fi
-		fi ;;
 	    unknown) UNAME_PROCESSOR=powerpc ;;
 	esac
-	echo ${UNAME_PROCESSOR}-apple-darwin${UNAME_RELEASE}
+	if command -v xcode-select > /dev/null 2> /dev/null && \
+		! xcode-select --print-path > /dev/null 2> /dev/null ; then
+	    # Avoid executing cc if there is no toolchain installed as
+	    # cc will be a stub that puts up a graphical alert
+	    # prompting the user to install developer tools.
+	    CC_FOR_BUILD=no_compiler_found
+	else
+	    set_cc_for_build
+	fi
+	if test "$CC_FOR_BUILD" != no_compiler_found; then
+	    if (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \
+		   (CCOPTS="" $CC_FOR_BUILD -E - 2>/dev/null) | \
+		   grep IS_64BIT_ARCH >/dev/null
+	    then
+		case $UNAME_PROCESSOR in
+		    i386) UNAME_PROCESSOR=x86_64 ;;
+		    powerpc) UNAME_PROCESSOR=powerpc64 ;;
+		esac
+	    fi
+	    # On 10.4-10.6 one might compile for PowerPC via gcc -arch ppc
+	    if (echo '#ifdef __POWERPC__'; echo IS_PPC; echo '#endif') | \
+		   (CCOPTS="" $CC_FOR_BUILD -E - 2>/dev/null) | \
+		   grep IS_PPC >/dev/null
+	    then
+		UNAME_PROCESSOR=powerpc
+	    fi
+	elif test "$UNAME_PROCESSOR" = i386 ; then
+	    # uname -m returns i386 or x86_64
+	    UNAME_PROCESSOR=$UNAME_MACHINE
+	fi
+	echo "$UNAME_PROCESSOR"-apple-darwin"$UNAME_RELEASE"
 	exit ;;
     *:procnto*:*:* | *:QNX:[0123456789]*:*)
 	UNAME_PROCESSOR=`uname -p`
-	if test "$UNAME_PROCESSOR" = "x86"; then
+	if test "$UNAME_PROCESSOR" = x86; then
 		UNAME_PROCESSOR=i386
 		UNAME_MACHINE=pc
 	fi
-	echo ${UNAME_PROCESSOR}-${UNAME_MACHINE}-nto-qnx${UNAME_RELEASE}
+	echo "$UNAME_PROCESSOR"-"$UNAME_MACHINE"-nto-qnx"$UNAME_RELEASE"
 	exit ;;
     *:QNX:*:4*)
 	echo i386-pc-qnx
 	exit ;;
-    NSE-?:NONSTOP_KERNEL:*:*)
-	echo nse-tandem-nsk${UNAME_RELEASE}
+    NEO-*:NONSTOP_KERNEL:*:*)
+	echo neo-tandem-nsk"$UNAME_RELEASE"
 	exit ;;
-    NSR-?:NONSTOP_KERNEL:*:*)
-	echo nsr-tandem-nsk${UNAME_RELEASE}
+    NSE-*:NONSTOP_KERNEL:*:*)
+	echo nse-tandem-nsk"$UNAME_RELEASE"
+	exit ;;
+    NSR-*:NONSTOP_KERNEL:*:*)
+	echo nsr-tandem-nsk"$UNAME_RELEASE"
+	exit ;;
+    NSV-*:NONSTOP_KERNEL:*:*)
+	echo nsv-tandem-nsk"$UNAME_RELEASE"
+	exit ;;
+    NSX-*:NONSTOP_KERNEL:*:*)
+	echo nsx-tandem-nsk"$UNAME_RELEASE"
 	exit ;;
     *:NonStop-UX:*:*)
 	echo mips-compaq-nonstopux
@@ -1247,18 +1413,19 @@ EOF
 	echo bs2000-siemens-sysv
 	exit ;;
     DS/*:UNIX_System_V:*:*)
-	echo ${UNAME_MACHINE}-${UNAME_SYSTEM}-${UNAME_RELEASE}
+	echo "$UNAME_MACHINE"-"$UNAME_SYSTEM"-"$UNAME_RELEASE"
 	exit ;;
     *:Plan9:*:*)
 	# "uname -m" is not consistent, so use $cputype instead. 386
 	# is converted to i386 for consistency with other x86
 	# operating systems.
-	if test "$cputype" = "386"; then
+	# shellcheck disable=SC2154
+	if test "$cputype" = 386; then
 	    UNAME_MACHINE=i386
 	else
 	    UNAME_MACHINE="$cputype"
 	fi
-	echo ${UNAME_MACHINE}-unknown-plan9
+	echo "$UNAME_MACHINE"-unknown-plan9
 	exit ;;
     *:TOPS-10:*:*)
 	echo pdp10-unknown-tops10
@@ -1279,14 +1446,14 @@ EOF
 	echo pdp10-unknown-its
 	exit ;;
     SEI:*:*:SEIUX)
-        echo mips-sei-seiux${UNAME_RELEASE}
+	echo mips-sei-seiux"$UNAME_RELEASE"
 	exit ;;
     *:DragonFly:*:*)
-	echo ${UNAME_MACHINE}-unknown-dragonfly`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
+	echo "$UNAME_MACHINE"-unknown-dragonfly"`echo "$UNAME_RELEASE"|sed -e 's/[-(].*//'`"
 	exit ;;
     *:*VMS:*:*)
-    	UNAME_MACHINE=`(uname -p) 2>/dev/null`
-	case "${UNAME_MACHINE}" in
+	UNAME_MACHINE=`(uname -p) 2>/dev/null`
+	case "$UNAME_MACHINE" in
 	    A*) echo alpha-dec-vms ; exit ;;
 	    I*) echo ia64-dec-vms ; exit ;;
 	    V*) echo vax-dec-vms ; exit ;;
@@ -1295,24 +1462,39 @@ EOF
 	echo i386-pc-xenix
 	exit ;;
     i*86:skyos:*:*)
-	echo ${UNAME_MACHINE}-pc-skyos`echo ${UNAME_RELEASE}` | sed -e 's/ .*$//'
+	echo "$UNAME_MACHINE"-pc-skyos"`echo "$UNAME_RELEASE" | sed -e 's/ .*$//'`"
 	exit ;;
     i*86:rdos:*:*)
-	echo ${UNAME_MACHINE}-pc-rdos
+	echo "$UNAME_MACHINE"-pc-rdos
 	exit ;;
     i*86:AROS:*:*)
-	echo ${UNAME_MACHINE}-pc-aros
+	echo "$UNAME_MACHINE"-pc-aros
+	exit ;;
+    x86_64:VMkernel:*:*)
+	echo "$UNAME_MACHINE"-unknown-esx
+	exit ;;
+    amd64:Isilon\ OneFS:*:*)
+	echo x86_64-unknown-onefs
+	exit ;;
+    *:Unleashed:*:*)
+	echo "$UNAME_MACHINE"-unknown-unleashed"$UNAME_RELEASE"
 	exit ;;
 esac
 
-#echo '(No uname command or uname output not recognized.)' 1>&2
-#echo "${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}" 1>&2
-
-eval $set_cc_for_build
-cat >$dummy.c <<EOF
+# No uname command or uname output not recognized.
+set_cc_for_build
+cat > "$dummy.c" <<EOF
 #ifdef _SEQUENT_
-# include <sys/types.h>
-# include <sys/utsname.h>
+#include <sys/types.h>
+#include <sys/utsname.h>
+#endif
+#if defined(ultrix) || defined(_ultrix) || defined(__ultrix) || defined(__ultrix__)
+#if defined (vax) || defined (__vax) || defined (__vax__) || defined(mips) || defined(__mips) || defined(__mips__) || defined(MIPS) || defined(__MIPS__)
+#include <signal.h>
+#if defined(_SIZE_T_) || defined(SIGLOST)
+#include <sys/utsname.h>
+#endif
+#endif
 #endif
 main ()
 {
@@ -1325,22 +1507,14 @@ main ()
 #include <sys/param.h>
   printf ("m68k-sony-newsos%s\n",
 #ifdef NEWSOS4
-          "4"
+  "4"
 #else
-	  ""
+  ""
 #endif
-         ); exit (0);
+  ); exit (0);
 #endif
 #endif
 
-#if defined (__arm) && defined (__acorn) && defined (__unix)
-  printf ("arm-acorn-riscix\n"); exit (0);
-#endif
-
-#if defined (hp300) && !defined (hpux)
-  printf ("m68k-hp-bsd\n"); exit (0);
-#endif
-
 #if defined (NeXT)
 #if !defined (__ARCHITECTURE__)
 #define __ARCHITECTURE__ "m68k"
@@ -1380,39 +1554,54 @@ main ()
 #endif
 
 #if defined (_SEQUENT_)
-    struct utsname un;
-
-    uname(&un);
-
-    if (strncmp(un.version, "V2", 2) == 0) {
-	printf ("i386-sequent-ptx2\n"); exit (0);
-    }
-    if (strncmp(un.version, "V1", 2) == 0) { /* XXX is V1 correct? */
-	printf ("i386-sequent-ptx1\n"); exit (0);
-    }
-    printf ("i386-sequent-ptx\n"); exit (0);
+  struct utsname un;
 
+  uname(&un);
+  if (strncmp(un.version, "V2", 2) == 0) {
+    printf ("i386-sequent-ptx2\n"); exit (0);
+  }
+  if (strncmp(un.version, "V1", 2) == 0) { /* XXX is V1 correct? */
+    printf ("i386-sequent-ptx1\n"); exit (0);
+  }
+  printf ("i386-sequent-ptx\n"); exit (0);
 #endif
 
 #if defined (vax)
-# if !defined (ultrix)
-#  include <sys/param.h>
-#  if defined (BSD)
-#   if BSD == 43
-      printf ("vax-dec-bsd4.3\n"); exit (0);
-#   else
-#    if BSD == 199006
-      printf ("vax-dec-bsd4.3reno\n"); exit (0);
-#    else
-      printf ("vax-dec-bsd\n"); exit (0);
-#    endif
-#   endif
-#  else
-    printf ("vax-dec-bsd\n"); exit (0);
-#  endif
-# else
-    printf ("vax-dec-ultrix\n"); exit (0);
-# endif
+#if !defined (ultrix)
+#include <sys/param.h>
+#if defined (BSD)
+#if BSD == 43
+  printf ("vax-dec-bsd4.3\n"); exit (0);
+#else
+#if BSD == 199006
+  printf ("vax-dec-bsd4.3reno\n"); exit (0);
+#else
+  printf ("vax-dec-bsd\n"); exit (0);
+#endif
+#endif
+#else
+  printf ("vax-dec-bsd\n"); exit (0);
+#endif
+#else
+#if defined(_SIZE_T_) || defined(SIGLOST)
+  struct utsname un;
+  uname (&un);
+  printf ("vax-dec-ultrix%s\n", un.release); exit (0);
+#else
+  printf ("vax-dec-ultrix\n"); exit (0);
+#endif
+#endif
+#endif
+#if defined(ultrix) || defined(_ultrix) || defined(__ultrix) || defined(__ultrix__)
+#if defined(mips) || defined(__mips) || defined(__mips__) || defined(MIPS) || defined(__MIPS__)
+#if defined(_SIZE_T_) || defined(SIGLOST)
+  struct utsname *un;
+  uname (&un);
+  printf ("mips-dec-ultrix%s\n", un.release); exit (0);
+#else
+  printf ("mips-dec-ultrix\n"); exit (0);
+#endif
+#endif
 #endif
 
 #if defined (alliant) && defined (i860)
@@ -1423,54 +1612,44 @@ main ()
 }
 EOF
 
-$CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null && SYSTEM_NAME=`$dummy` &&
+$CC_FOR_BUILD -o "$dummy" "$dummy.c" 2>/dev/null && SYSTEM_NAME=`$dummy` &&
 	{ echo "$SYSTEM_NAME"; exit; }
 
 # Apollos put the system type in the environment.
+test -d /usr/apollo && { echo "$ISP-apollo-$SYSTYPE"; exit; }
 
-test -d /usr/apollo && { echo ${ISP}-apollo-${SYSTYPE}; exit; }
+echo "$0: unable to guess system type" >&2
 
-# Convex versions that predate uname can use getsysinfo(1)
+case "$UNAME_MACHINE:$UNAME_SYSTEM" in
+    mips:Linux | mips64:Linux)
+	# If we got here on MIPS GNU/Linux, output extra information.
+	cat >&2 <<EOF
 
-if [ -x /usr/convex/getsysinfo ]
-then
-    case `getsysinfo -f cpu_type` in
-    c1*)
-	echo c1-convex-bsd
-	exit ;;
-    c2*)
-	if getsysinfo -f scalar_acc
-	then echo c32-convex-bsd
-	else echo c2-convex-bsd
-	fi
-	exit ;;
-    c34*)
-	echo c34-convex-bsd
-	exit ;;
-    c38*)
-	echo c38-convex-bsd
-	exit ;;
-    c4*)
-	echo c4-convex-bsd
-	exit ;;
-    esac
-fi
+NOTE: MIPS GNU/Linux systems require a C compiler to fully recognize
+the system type. Please install a C compiler and try again.
+EOF
+	;;
+esac
 
 cat >&2 <<EOF
-$0: unable to guess system type
 
-This script, last modified $timestamp, has failed to recognize
-the operating system you are using. It is advised that you
-download the most up to date version of the config scripts from
+This script (version $timestamp), has failed to recognize the
+operating system you are using. If your script is old, overwrite *all*
+copies of config.guess and config.sub with the latest versions from:
 
-  http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD
+  https://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess
 and
-  http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD
+  https://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub
+EOF
 
-If the version you run ($0) is already up to date, please
-send the following data and any information you think might be
-pertinent to <config-patches@gnu.org> in order to provide the needed
-information to handle your system.
+year=`echo $timestamp | sed 's,-.*,,'`
+# shellcheck disable=SC2003
+if test "`expr "\`date +%Y\`" - "$year"`" -lt 3 ; then
+   cat >&2 <<EOF
+
+If $0 has already been updated, send the following data and any
+information you think might be pertinent to config-patches@gnu.org to
+provide the necessary information to handle your system.
 
 config.guess timestamp = $timestamp
 
@@ -1489,16 +1668,17 @@ hostinfo               = `(hostinfo) 2>/
 /usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null`
 /usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null`
 
-UNAME_MACHINE = ${UNAME_MACHINE}
-UNAME_RELEASE = ${UNAME_RELEASE}
-UNAME_SYSTEM  = ${UNAME_SYSTEM}
-UNAME_VERSION = ${UNAME_VERSION}
+UNAME_MACHINE = "$UNAME_MACHINE"
+UNAME_RELEASE = "$UNAME_RELEASE"
+UNAME_SYSTEM  = "$UNAME_SYSTEM"
+UNAME_VERSION = "$UNAME_VERSION"
 EOF
+fi
 
 exit 1
 
 # Local variables:
-# eval: (add-hook 'write-file-hooks 'time-stamp)
+# eval: (add-hook 'before-save-hook 'time-stamp)
 # time-stamp-start: "timestamp='"
 # time-stamp-format: "%:y-%02m-%02d"
 # time-stamp-end: "'"
diff -urpN net-snmp-5.8/configure net-snmp-5.9.1/configure
--- net-snmp-5.8/configure	2018-07-16 21:33:50.000000000 +0700
+++ net-snmp-5.9.1/configure	2021-05-26 05:19:37.000000000 +0700
@@ -1,14 +1,12 @@
 #! /bin/sh
 # From configure.ac Revision.
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.68 for Net-SNMP 5.8.
+# Generated by GNU Autoconf 2.69 for Net-SNMP 5.9.1.
 #
 # Report bugs to <net-snmp-coders@lists.sourceforge.net>.
 #
 #
-# Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-# 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free Software
-# Foundation, Inc.
+# Copyright (C) 1992-1996, 1998-2012 Free Software Foundation, Inc.
 #
 #
 # This configure script is free software; the Free Software Foundation
@@ -137,6 +135,31 @@ export LANGUAGE
 # CDPATH.
 (unset CDPATH) >/dev/null 2>&1 && unset CDPATH
 
+# Use a proper internal environment variable to ensure we don't fall
+  # into an infinite loop, continuously re-executing ourselves.
+  if test x"${_as_can_reexec}" != xno && test "x$CONFIG_SHELL" != x; then
+    _as_can_reexec=no; export _as_can_reexec;
+    # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+as_fn_exit 255
+  fi
+  # We don't want this to propagate to other subprocesses.
+          { _as_can_reexec=; unset _as_can_reexec;}
 if test "x$CONFIG_SHELL" = x; then
   as_bourne_compatible="if test -n \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
@@ -170,7 +193,8 @@ if ( set x; as_fn_ret_success y && test
 else
   exitcode=1; echo positional parameters were not saved.
 fi
-test x\$exitcode = x0 || exit 1"
+test x\$exitcode = x0 || exit 1
+test -x / || exit 1"
   as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
   as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
   eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
@@ -223,21 +247,25 @@ IFS=$as_save_IFS
 
 
       if test "x$CONFIG_SHELL" != x; then :
-  # We cannot yet assume a decent shell, so we have to provide a
-	# neutralization value for shells without unset; and this also
-	# works around shells that cannot unset nonexistent variables.
-	# Preserve -v and -x to the replacement shell.
-	BASH_ENV=/dev/null
-	ENV=/dev/null
-	(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
-	export CONFIG_SHELL
-	case $- in # ((((
-	  *v*x* | *x*v* ) as_opts=-vx ;;
-	  *v* ) as_opts=-v ;;
-	  *x* ) as_opts=-x ;;
-	  * ) as_opts= ;;
-	esac
-	exec "$CONFIG_SHELL" $as_opts "$as_myself" ${1+"$@"}
+  export CONFIG_SHELL
+             # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+exit 255
 fi
 
     if test x$as_have_required = xno; then :
@@ -340,6 +368,14 @@ $as_echo X"$as_dir" |
 
 
 } # as_fn_mkdir_p
+
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
 # as_fn_append VAR VALUE
 # ----------------------
 # Append the text in VALUE to the end of the definition contained in VAR. Take
@@ -461,6 +497,10 @@ as_cr_alnum=$as_cr_Letters$as_cr_digits
   chmod +x "$as_me.lineno" ||
     { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }
 
+  # If we had to re-execute with $CONFIG_SHELL, we're ensured to have
+  # already done that, so ensure we don't try to do so again and fall
+  # in an infinite loop.  This has already happened in practice.
+  _as_can_reexec=no; export _as_can_reexec
   # Don't try to exec as it changes $[0], causing all sort of problems
   # (the dirname of $[0] is not the place where we might find the
   # original and so on.  Autoconf is especially sensitive to this).
@@ -495,16 +535,16 @@ if (echo >conf$$.file) 2>/dev/null; then
     # ... but there are two gotchas:
     # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
     # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
+    # In both cases, we have to default to `cp -pR'.
     ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
+      as_ln_s='cp -pR'
   elif ln conf$$.file conf$$ 2>/dev/null; then
     as_ln_s=ln
   else
-    as_ln_s='cp -p'
+    as_ln_s='cp -pR'
   fi
 else
-  as_ln_s='cp -p'
+  as_ln_s='cp -pR'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
@@ -516,28 +556,8 @@ else
   as_mkdir_p=false
 fi
 
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in #(
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -571,8 +591,8 @@ MAKEFLAGS=
 # Identity of this package.
 PACKAGE_NAME='Net-SNMP'
 PACKAGE_TARNAME='net-snmp'
-PACKAGE_VERSION='5.8'
-PACKAGE_STRING='Net-SNMP 5.8'
+PACKAGE_VERSION='5.9.1'
+PACKAGE_STRING='Net-SNMP 5.9.1'
 PACKAGE_BUGREPORT='net-snmp-coders@lists.sourceforge.net'
 PACKAGE_URL=''
 
@@ -622,13 +642,11 @@ OTHERAGENTLIBLFTS
 OTHERAGENTLIBLOBJS
 OTHERAGENTLIBOBJS
 AGENTLIBS
-LMIBLIBS
 PSCMD
 LPSTAT_PATH
 LIBOBJS
 ALLOCA
 VAL_LIBS
-LAGENTLIBS
 LNETSNMPLIBS
 PYTHONFEATURES
 PYTHONARGS
@@ -646,6 +664,7 @@ PERLLDOPTS_FOR_LIBS
 EMBEDPERLUNINSTALL
 EMBEDPERLINSTALL
 LIBCURSES
+HAVE_LIBCURSES
 NETSNMP_BUILD_PCAP_PROG_FALSE
 NETSNMP_BUILD_PCAP_PROG_TRUE
 MYSQL_INCLUDES
@@ -673,6 +692,8 @@ NETSNMP_DEFAULT_MIBS
 ENV_SEPARATOR
 dllcleans
 default_mibs_install
+LMIBLIBS
+LAGENTLIBS
 krb5_config
 security_ftobj_list
 security_lobj_list
@@ -715,6 +736,8 @@ SNMPLIB_INCLUDES
 TOP_INCLUDES
 DEVFLAGS
 LIBTOOL_DEPS
+RC
+LT_SYS_LIBRARY_PATH
 OTOOL64
 OTOOL
 LIPO
@@ -859,10 +882,6 @@ with_ldflags
 enable_as_needed
 with_libs
 enable_silent_libtool
-with_dmalloc
-enable_dmalloc
-with_efence
-enable_efence
 with_rsaref
 enable_rsaref
 with_openssl
@@ -1054,6 +1073,7 @@ enable_shared
 enable_static
 with_pic
 enable_fast_install
+with_aix_soname
 with_gnu_ld
 with_sysroot
 enable_libtool_lock
@@ -1067,6 +1087,7 @@ LDFLAGS
 LIBS
 CPPFLAGS
 CPP
+LT_SYS_LIBRARY_PATH
 PKG_CONFIG
 PKG_CONFIG_PATH
 PKG_CONFIG_LIBDIR
@@ -1527,8 +1548,6 @@ target=$target_alias
 if test "x$host_alias" != x; then
   if test "x$build_alias" = x; then
     cross_compiling=maybe
-    $as_echo "$as_me: WARNING: if you wanted to set the --build type, don't use --host.
-    If a cross compiler is detected then cross compile mode will be used" >&2
   elif test "x$build_alias" != "x$host_alias"; then
     cross_compiling=yes
   fi
@@ -1614,7 +1633,7 @@ if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures Net-SNMP 5.8 to adapt to many kinds of systems.
+\`configure' configures Net-SNMP 5.9.1 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
@@ -1680,7 +1699,7 @@ fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of Net-SNMP 5.8:";;
+     short | recursive ) echo "Configuration of Net-SNMP 5.9.1:";;
    esac
   cat <<\_ACEOF
 
@@ -1780,8 +1799,6 @@ Compiler Options:
   --with-cflags=CFLAGS            use CFLAGS as compile time arguments.
   --with-ldflags=LDFLAGS          use LDFLAGS as link time arguments to ld.
   --with-libs=LIBS                use LIBS as link time arguments to ld.
-  --with-dmalloc=PATH     Use dmalloc library (www.dmalloc.com)
-  --with-efence                   Look for and use libefence (malloc).
   --with-rsaref=PATH              Look for librsaref in PATH/lib.
   --with-openssl=PATH             Look for openssl in PATH/lib,
                                   or PATH may be "internal" to build with
@@ -1801,7 +1818,7 @@ Compiler Options:
                                   libraries (eg, HPUX)
   --with-features-of=version
                           Compile in MIB modules and other features as if this
-                          was release "version" (default is 5.8).
+                          was release "version" (default is 5.9.1).
 
 Miscellaneous:
   --with-defaults         Use defaults for prompted values.
@@ -2026,11 +2043,14 @@ Network Buffers:
                           Mount table location. The default is to autodetect
                           this.
   --with-mysql            Include support for MySQL.
-  --with-pic              try to use only PIC/non-PIC objects [default=use
+  --with-pic[=PKGS]       try to use only PIC/non-PIC objects [default=use
                           both]
+  --with-aix-soname=aix|svr4|both
+                          shared library versioning (aka "SONAME") variant to
+                          provide on AIX, [default=aix].
   --with-gnu-ld           assume the C compiler uses GNU ld [default=no]
-  --with-sysroot=DIR Search for dependent libraries within DIR
-                        (or the compiler's sysroot if not specified).
+  --with-sysroot[=DIR]    Search for dependent libraries within DIR (or the
+                          compiler's sysroot if not specified).
 
 Some influential environment variables:
   CC          C compiler command
@@ -2041,6 +2061,8 @@ Some influential environment variables:
   CPPFLAGS    (Objective) C/C++ preprocessor flags, e.g. -I<include dir> if
               you have headers in a nonstandard directory <include dir>
   CPP         C preprocessor
+  LT_SYS_LIBRARY_PATH
+              User-defined run-time library search path.
   PKG_CONFIG  path to pkg-config utility
   PKG_CONFIG_PATH
               directories to add to pkg-config's search path
@@ -2116,10 +2138,10 @@ fi
 test -n "$ac_init_help" && exit $ac_status
 if $ac_init_version; then
   cat <<\_ACEOF
-Net-SNMP configure 5.8
-generated by GNU Autoconf 2.68
+Net-SNMP configure 5.9.1
+generated by GNU Autoconf 2.69
 
-Copyright (C) 2010 Free Software Foundation, Inc.
+Copyright (C) 2012 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
@@ -2396,7 +2418,7 @@ $as_echo "$ac_try_echo"; } >&5
 	 test ! -s conftest.err
        } && test -s conftest$ac_exeext && {
 	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
+	 test -x conftest$ac_exeext
        }; then :
   ac_retval=0
 else
@@ -2556,7 +2578,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) >= 0)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2572,7 +2595,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) <= $ac_mid)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2598,7 +2622,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) < 0)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2614,7 +2639,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) >= $ac_mid)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2648,7 +2674,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) <= $ac_mid)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2742,7 +2769,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(0 < ($ac_type) ((((($ac_type) 1 << N) << N) - 1) * 2 + 1))];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2758,7 +2786,8 @@ main ()
 {
 static int test_array [1 - 2 * !(($ac_type) ((((($ac_type) 1 << N) << N) - 1) * 2 + 1)
 		 < ($ac_type) ((((($ac_type) 1 << N) << N) - 1) * 2 + 2))];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2869,7 +2898,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !((($ac_type) -1 >> ($2 / 2 - 1)) >> ($2 / 2 - 1) == 3)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2947,8 +2977,8 @@ cat >config.log <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by Net-SNMP $as_me 5.8, which was
-generated by GNU Autoconf 2.68.  Invocation command line was
+It was created by Net-SNMP $as_me 5.9.1, which was
+generated by GNU Autoconf 2.69.  Invocation command line was
 
   $ $0 $@
 
@@ -3312,7 +3342,7 @@ ac_config_headers="$ac_config_headers in
 #
 
 cat >>confdefs.h <<_ACEOF
-#define NETSNMP_CONFIGURE_OPTIONS "$ac_configure_args"
+#define NETSNMP_CONFIGURE_OPTIONS "${NETSNMP_CONFIGURE_OPTIONS-$ac_configure_args}"
 _ACEOF
 
 CONFIGURE_OPTIONS="\"$ac_configure_args\""
@@ -3343,7 +3373,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3383,7 +3413,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3436,7 +3466,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3477,7 +3507,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
@@ -3535,7 +3565,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3579,7 +3609,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4025,8 +4055,7 @@ cat confdefs.h - <<_ACEOF >conftest.$ac_
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
+struct stat;
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
 struct buf { int x; };
 FILE * (*rcsopen) (struct buf *, struct stat *, int);
@@ -4266,7 +4295,7 @@ do
     for ac_prog in grep ggrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_GREP" && $as_test_x "$ac_path_GREP"; } || continue
+      as_fn_executable_p "$ac_path_GREP" || continue
 # Check for GNU ac_path_GREP and select it if it is found.
   # Check for GNU $ac_path_GREP
 case `"$ac_path_GREP" --version 2>&1` in
@@ -4332,7 +4361,7 @@ do
     for ac_prog in egrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_EGREP" && $as_test_x "$ac_path_EGREP"; } || continue
+      as_fn_executable_p "$ac_path_EGREP" || continue
 # Check for GNU ac_path_EGREP and select it if it is found.
   # Check for GNU $ac_path_EGREP
 case `"$ac_path_EGREP" --version 2>&1` in
@@ -4539,8 +4568,8 @@ else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
-#	  define __EXTENSIONS__ 1
-	  $ac_includes_default
+#         define __EXTENSIONS__ 1
+          $ac_includes_default
 int
 main ()
 {
@@ -4625,6 +4654,9 @@ fi
 if test "${with_endianness+set}" = set; then :
   withval=$with_endianness; if test $with_endianness != "big" -a $with_endianness != "little" ; then
        as_fn_error $? "Endianness must be big or little, not \"$with_endianness\"." "$LINENO" 5;
+     else
+       { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: --with-endianness is obsolete" >&5
+$as_echo "$as_me: WARNING: --with-endianness is obsolete" >&2;}
      fi
 
 fi
@@ -4669,30 +4701,6 @@ fi
 #   System: Library settings
 ##
 
-
-# Check whether --with-dmalloc was given.
-if test "${with_dmalloc+set}" = set; then :
-  withval=$with_dmalloc;
-fi
-
-   # Check whether --enable-dmalloc was given.
-if test "${enable_dmalloc+set}" = set; then :
-  enableval=$enable_dmalloc; as_fn_error $? "Invalid option. Use --with-dmalloc/--without-dmalloc instead" "$LINENO" 5
-fi
-
-
-
-# Check whether --with-efence was given.
-if test "${with_efence+set}" = set; then :
-  withval=$with_efence; use_efence="$withval"
-fi
-
-   # Check whether --enable-efence was given.
-if test "${enable_efence+set}" = set; then :
-  enableval=$enable_efence; as_fn_error $? "Invalid option. Use --with-efence/--without-efence instead" "$LINENO" 5
-fi
-
-
 tryrsaref=no
 
 # Check whether --with-rsaref was given.
@@ -7098,7 +7106,7 @@ do
     for ac_prog in egrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_EGREP" && $as_test_x "$ac_path_EGREP"; } || continue
+      as_fn_executable_p "$ac_path_EGREP" || continue
 # Check for GNU ac_path_EGREP and select it if it is found.
   # Check for GNU $ac_path_EGREP
 case `"$ac_path_EGREP" --version 2>&1` in
@@ -7162,7 +7170,7 @@ do
     for ac_prog in grep ggrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_GREP" && $as_test_x "$ac_path_GREP"; } || continue
+      as_fn_executable_p "$ac_path_GREP" || continue
 # Check for GNU ac_path_GREP and select it if it is found.
   # Check for GNU $ac_path_GREP
 case `"$ac_path_GREP" --version 2>&1` in
@@ -7275,7 +7283,7 @@ case $as_dir/ in #((
     # by default.
     for ac_prog in ginstall scoinst install; do
       for ac_exec_ext in '' $ac_executable_extensions; do
-	if { test -f "$as_dir/$ac_prog$ac_exec_ext" && $as_test_x "$as_dir/$ac_prog$ac_exec_ext"; }; then
+	if as_fn_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
 	  if test $ac_prog = install &&
 	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
 	    # AIX install.  It has an incompatible calling convention.
@@ -7395,7 +7403,7 @@ do
     for ac_prog in sed gsed; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_SED="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_SED" && $as_test_x "$ac_path_SED"; } || continue
+      as_fn_executable_p "$ac_path_SED" || continue
 # Check for GNU ac_path_SED and select it if it is found.
   # Check for GNU $ac_path_SED
 case `"$ac_path_SED" --version 2>&1` in
@@ -7461,7 +7469,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_FILE="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7512,7 +7520,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_FIND="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7554,7 +7562,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_WHOAMI="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7598,7 +7606,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_AUTOCONF="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7639,7 +7647,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_AUTOHEADER="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7680,7 +7688,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_PERLPROG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7720,7 +7728,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_PSPROG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7742,8 +7750,8 @@ $as_echo "no" >&6; }
 fi
 
 
-# Extract the first word of "python", so it can be a program name with args.
-set dummy python; ac_word=$2
+# Extract the first word of "python3", so it can be a program name with args.
+set dummy python3; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
 if ${ac_cv_path_PYTHONPROG+:} false; then :
@@ -7760,7 +7768,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_PYTHONPROG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7801,7 +7809,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_UNAMEPROG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7886,7 +7894,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7926,7 +7934,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7979,7 +7987,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8020,7 +8028,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
@@ -8078,7 +8086,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8122,7 +8130,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8318,8 +8326,7 @@ cat confdefs.h - <<_ACEOF >conftest.$ac_
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
+struct stat;
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
 struct buf { int x; };
 FILE * (*rcsopen) (struct buf *, struct stat *, int);
@@ -8555,11 +8562,11 @@ else
 int
 main ()
 {
-/* FIXME: Include the comments suggested by Paul. */
+
 #ifndef __cplusplus
-  /* Ultrix mips cc rejects this.  */
+  /* Ultrix mips cc rejects this sort of thing.  */
   typedef int charset[2];
-  const charset cs;
+  const charset cs = { 0, 0 };
   /* SunOS 4.1.1 cc rejects this.  */
   char const *const *pcpcc;
   char **ppc;
@@ -8576,8 +8583,9 @@ main ()
   ++pcpcc;
   ppc = (char**) pcpcc;
   pcpcc = (char const *const *) ppc;
-  { /* SCO 3.2v4 cc rejects this.  */
-    char *t;
+  { /* SCO 3.2v4 cc rejects this sort of thing.  */
+    char tx;
+    char *t = &tx;
     char const *s = 0 ? (char *) 0 : (char const *) 0;
 
     *t++ = 0;
@@ -8593,10 +8601,10 @@ main ()
     iptr p = 0;
     ++p;
   }
-  { /* AIX XL C 1.02.0.0 rejects this saying
+  { /* AIX XL C 1.02.0.0 rejects this sort of thing, saying
        "k.c", line 2.27: 1506-025 (S) Operand must be a modifiable lvalue. */
-    struct s { int j; const int *ap[3]; };
-    struct s *b; b->j = 5;
+    struct s { int j; const int *ap[3]; } bx;
+    struct s *b = &bx; b->j = 5;
   }
   { /* ULTRIX-32 V3.1 (Rev 9) vcc rejects this */
     const int foo = 10;
@@ -8678,8 +8686,8 @@ esac
 
 
 
-macro_version='2.4'
-macro_revision='1.3293'
+macro_version='2.4.6'
+macro_revision='2.4.6'
 
 
 
@@ -8693,7 +8701,7 @@ macro_revision='1.3293'
 
 
 
-ltmain="$ac_aux_dir/ltmain.sh"
+ltmain=$ac_aux_dir/ltmain.sh
 
 # Make sure we can run config.sub.
 $SHELL "$ac_aux_dir/config.sub" sun4 >/dev/null 2>&1 ||
@@ -8813,7 +8821,7 @@ func_echo_all ()
     $ECHO ""
 }
 
-case "$ECHO" in
+case $ECHO in
   printf*) { $as_echo "$as_me:${as_lineno-$LINENO}: result: printf" >&5
 $as_echo "printf" >&6; } ;;
   print*) { $as_echo "$as_me:${as_lineno-$LINENO}: result: print -r" >&5
@@ -8857,7 +8865,7 @@ do
     for ac_prog in sed gsed; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_SED="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_SED" && $as_test_x "$ac_path_SED"; } || continue
+      as_fn_executable_p "$ac_path_SED" || continue
 # Check for GNU ac_path_SED and select it if it is found.
   # Check for GNU $ac_path_SED
 case `"$ac_path_SED" --version 2>&1` in
@@ -8936,7 +8944,7 @@ do
     for ac_prog in fgrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_FGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_FGREP" && $as_test_x "$ac_path_FGREP"; } || continue
+      as_fn_executable_p "$ac_path_FGREP" || continue
 # Check for GNU ac_path_FGREP and select it if it is found.
   # Check for GNU $ac_path_FGREP
 case `"$ac_path_FGREP" --version 2>&1` in
@@ -9006,19 +9014,19 @@ test -z "$GREP" && GREP=grep
 
 # Check whether --with-gnu-ld was given.
 if test "${with_gnu_ld+set}" = set; then :
-  withval=$with_gnu_ld; test "$withval" = no || with_gnu_ld=yes
+  withval=$with_gnu_ld; test no = "$withval" || with_gnu_ld=yes
 else
   with_gnu_ld=no
 fi
 
 ac_prog=ld
-if test "$GCC" = yes; then
+if test yes = "$GCC"; then
   # Check if gcc -print-prog-name=ld gives a path.
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ld used by $CC" >&5
 $as_echo_n "checking for ld used by $CC... " >&6; }
   case $host in
   *-*-mingw*)
-    # gcc leaves a trailing carriage return which upsets mingw
+    # gcc leaves a trailing carriage return, which upsets mingw
     ac_prog=`($CC -print-prog-name=ld) 2>&5 | tr -d '\015'` ;;
   *)
     ac_prog=`($CC -print-prog-name=ld) 2>&5` ;;
@@ -9032,7 +9040,7 @@ $as_echo_n "checking for ld used by $CC.
       while $ECHO "$ac_prog" | $GREP "$re_direlt" > /dev/null 2>&1; do
 	ac_prog=`$ECHO $ac_prog| $SED "s%$re_direlt%/%"`
       done
-      test -z "$LD" && LD="$ac_prog"
+      test -z "$LD" && LD=$ac_prog
       ;;
   "")
     # If it fails, then pretend we aren't using GCC.
@@ -9043,7 +9051,7 @@ $as_echo_n "checking for ld used by $CC.
     with_gnu_ld=unknown
     ;;
   esac
-elif test "$with_gnu_ld" = yes; then
+elif test yes = "$with_gnu_ld"; then
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU ld" >&5
 $as_echo_n "checking for GNU ld... " >&6; }
 else
@@ -9054,32 +9062,32 @@ if ${lt_cv_path_LD+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   if test -z "$LD"; then
-  lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
+  lt_save_ifs=$IFS; IFS=$PATH_SEPARATOR
   for ac_dir in $PATH; do
-    IFS="$lt_save_ifs"
+    IFS=$lt_save_ifs
     test -z "$ac_dir" && ac_dir=.
     if test -f "$ac_dir/$ac_prog" || test -f "$ac_dir/$ac_prog$ac_exeext"; then
-      lt_cv_path_LD="$ac_dir/$ac_prog"
+      lt_cv_path_LD=$ac_dir/$ac_prog
       # Check to see if the program is GNU ld.  I'd rather use --version,
       # but apparently some variants of GNU ld only accept -v.
       # Break only if it was the GNU/non-GNU ld that we prefer.
       case `"$lt_cv_path_LD" -v 2>&1 </dev/null` in
       *GNU* | *'with BFD'*)
-	test "$with_gnu_ld" != no && break
+	test no != "$with_gnu_ld" && break
 	;;
       *)
-	test "$with_gnu_ld" != yes && break
+	test yes != "$with_gnu_ld" && break
 	;;
       esac
     fi
   done
-  IFS="$lt_save_ifs"
+  IFS=$lt_save_ifs
 else
-  lt_cv_path_LD="$LD" # Let the user override the test with a path.
+  lt_cv_path_LD=$LD # Let the user override the test with a path.
 fi
 fi
 
-LD="$lt_cv_path_LD"
+LD=$lt_cv_path_LD
 if test -n "$LD"; then
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LD" >&5
 $as_echo "$LD" >&6; }
@@ -9122,33 +9130,38 @@ if ${lt_cv_path_NM+:} false; then :
 else
   if test -n "$NM"; then
   # Let the user override the test.
-  lt_cv_path_NM="$NM"
+  lt_cv_path_NM=$NM
 else
-  lt_nm_to_check="${ac_tool_prefix}nm"
+  lt_nm_to_check=${ac_tool_prefix}nm
   if test -n "$ac_tool_prefix" && test "$build" = "$host"; then
     lt_nm_to_check="$lt_nm_to_check nm"
   fi
   for lt_tmp_nm in $lt_nm_to_check; do
-    lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
+    lt_save_ifs=$IFS; IFS=$PATH_SEPARATOR
     for ac_dir in $PATH /usr/ccs/bin/elf /usr/ccs/bin /usr/ucb /bin; do
-      IFS="$lt_save_ifs"
+      IFS=$lt_save_ifs
       test -z "$ac_dir" && ac_dir=.
-      tmp_nm="$ac_dir/$lt_tmp_nm"
-      if test -f "$tmp_nm" || test -f "$tmp_nm$ac_exeext" ; then
+      tmp_nm=$ac_dir/$lt_tmp_nm
+      if test -f "$tmp_nm" || test -f "$tmp_nm$ac_exeext"; then
 	# Check to see if the nm accepts a BSD-compat flag.
-	# Adding the `sed 1q' prevents false positives on HP-UX, which says:
+	# Adding the 'sed 1q' prevents false positives on HP-UX, which says:
 	#   nm: unknown option "B" ignored
 	# Tru64's nm complains that /dev/null is an invalid object file
-	case `"$tmp_nm" -B /dev/null 2>&1 | sed '1q'` in
-	*/dev/null* | *'Invalid file or object type'*)
+	# MSYS converts /dev/null to NUL, MinGW nm treats NUL as empty
+	case $build_os in
+	mingw*) lt_bad_file=conftest.nm/nofile ;;
+	*) lt_bad_file=/dev/null ;;
+	esac
+	case `"$tmp_nm" -B $lt_bad_file 2>&1 | sed '1q'` in
+	*$lt_bad_file* | *'Invalid file or object type'*)
 	  lt_cv_path_NM="$tmp_nm -B"
-	  break
+	  break 2
 	  ;;
 	*)
 	  case `"$tmp_nm" -p /dev/null 2>&1 | sed '1q'` in
 	  */dev/null*)
 	    lt_cv_path_NM="$tmp_nm -p"
-	    break
+	    break 2
 	    ;;
 	  *)
 	    lt_cv_path_NM=${lt_cv_path_NM="$tmp_nm"} # keep the first match, but
@@ -9159,15 +9172,15 @@ else
 	esac
       fi
     done
-    IFS="$lt_save_ifs"
+    IFS=$lt_save_ifs
   done
   : ${lt_cv_path_NM=no}
 fi
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_path_NM" >&5
 $as_echo "$lt_cv_path_NM" >&6; }
-if test "$lt_cv_path_NM" != "no"; then
-  NM="$lt_cv_path_NM"
+if test no != "$lt_cv_path_NM"; then
+  NM=$lt_cv_path_NM
 else
   # Didn't find any BSD compatible name lister, look for dumpbin.
   if test -n "$DUMPBIN"; then :
@@ -9192,7 +9205,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DUMPBIN="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -9236,7 +9249,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DUMPBIN="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -9273,9 +9286,9 @@ esac
   fi
 fi
 
-    case `$DUMPBIN -symbols /dev/null 2>&1 | sed '1q'` in
+    case `$DUMPBIN -symbols -headers /dev/null 2>&1 | sed '1q'` in
     *COFF*)
-      DUMPBIN="$DUMPBIN -symbols"
+      DUMPBIN="$DUMPBIN -symbols -headers"
       ;;
     *)
       DUMPBIN=:
@@ -9283,8 +9296,8 @@ fi
     esac
   fi
 
-  if test "$DUMPBIN" != ":"; then
-    NM="$DUMPBIN"
+  if test : != "$DUMPBIN"; then
+    NM=$DUMPBIN
   fi
 fi
 test -z "$NM" && NM=nm
@@ -9324,7 +9337,7 @@ if ${lt_cv_sys_max_cmd_len+:} false; the
   $as_echo_n "(cached) " >&6
 else
     i=0
-  teststring="ABCD"
+  teststring=ABCD
 
   case $build_os in
   msdosdjgpp*)
@@ -9364,7 +9377,7 @@ else
     lt_cv_sys_max_cmd_len=8192;
     ;;
 
-  netbsd* | freebsd* | openbsd* | darwin* | dragonfly*)
+  bitrig* | darwin* | dragonfly* | freebsd* | netbsd* | openbsd*)
     # This has been around since 386BSD, at least.  Likely further.
     if test -x /sbin/sysctl; then
       lt_cv_sys_max_cmd_len=`/sbin/sysctl -n kern.argmax`
@@ -9383,6 +9396,11 @@ else
     lt_cv_sys_max_cmd_len=196608
     ;;
 
+  os2*)
+    # The test takes a long time on OS/2.
+    lt_cv_sys_max_cmd_len=8192
+    ;;
+
   osf*)
     # Dr. Hans Ekkehard Plesser reports seeing a kernel panic running configure
     # due to this test when exec_disable_arg_limit is 1 on Tru64. It is not
@@ -9409,22 +9427,23 @@ else
     ;;
   *)
     lt_cv_sys_max_cmd_len=`(getconf ARG_MAX) 2> /dev/null`
-    if test -n "$lt_cv_sys_max_cmd_len"; then
+    if test -n "$lt_cv_sys_max_cmd_len" && \
+       test undefined != "$lt_cv_sys_max_cmd_len"; then
       lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \/ 4`
       lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \* 3`
     else
       # Make teststring a little bigger before we do anything with it.
       # a 1K string should be a reasonable start.
-      for i in 1 2 3 4 5 6 7 8 ; do
+      for i in 1 2 3 4 5 6 7 8; do
         teststring=$teststring$teststring
       done
       SHELL=${SHELL-${CONFIG_SHELL-/bin/sh}}
       # If test is not a shell built-in, we'll probably end up computing a
       # maximum length that is only half of the actual maximum length, but
       # we can't tell.
-      while { test "X"`func_fallback_echo "$teststring$teststring" 2>/dev/null` \
+      while { test X`env echo "$teststring$teststring" 2>/dev/null` \
 	         = "X$teststring$teststring"; } >/dev/null 2>&1 &&
-	      test $i != 17 # 1/2 MB should be enough
+	      test 17 != "$i" # 1/2 MB should be enough
       do
         i=`expr $i + 1`
         teststring=$teststring$teststring
@@ -9442,7 +9461,7 @@ else
 
 fi
 
-if test -n $lt_cv_sys_max_cmd_len ; then
+if test -n "$lt_cv_sys_max_cmd_len"; then
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_sys_max_cmd_len" >&5
 $as_echo "$lt_cv_sys_max_cmd_len" >&6; }
 else
@@ -9460,30 +9479,6 @@ max_cmd_len=$lt_cv_sys_max_cmd_len
 : ${MV="mv -f"}
 : ${RM="rm -f"}
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the shell understands some XSI constructs" >&5
-$as_echo_n "checking whether the shell understands some XSI constructs... " >&6; }
-# Try some XSI features
-xsi_shell=no
-( _lt_dummy="a/b/c"
-  test "${_lt_dummy##*/},${_lt_dummy%/*},${_lt_dummy#??}"${_lt_dummy%"$_lt_dummy"}, \
-      = c,a/b,b/c, \
-    && eval 'test $(( 1 + 1 )) -eq 2 \
-    && test "${#_lt_dummy}" -eq 5' ) >/dev/null 2>&1 \
-  && xsi_shell=yes
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $xsi_shell" >&5
-$as_echo "$xsi_shell" >&6; }
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the shell understands \"+=\"" >&5
-$as_echo_n "checking whether the shell understands \"+=\"... " >&6; }
-lt_shell_append=no
-( foo=bar; set foo baz; eval "$1+=\$2" && test "$foo" = barbaz ) \
-    >/dev/null 2>&1 \
-  && lt_shell_append=yes
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_shell_append" >&5
-$as_echo "$lt_shell_append" >&6; }
-
-
 if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
   lt_unset=unset
 else
@@ -9606,13 +9601,13 @@ esac
 reload_cmds='$LD$reload_flag -o $output$reload_objs'
 case $host_os in
   cygwin* | mingw* | pw32* | cegcc*)
-    if test "$GCC" != yes; then
+    if test yes != "$GCC"; then
       reload_cmds=false
     fi
     ;;
   darwin*)
-    if test "$GCC" = yes; then
-      reload_cmds='$LTCC $LTCFLAGS -nostdlib ${wl}-r -o $output$reload_objs'
+    if test yes = "$GCC"; then
+      reload_cmds='$LTCC $LTCFLAGS -nostdlib $wl-r -o $output$reload_objs'
     else
       reload_cmds='$LD$reload_flag -o $output$reload_objs'
     fi
@@ -9644,7 +9639,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OBJDUMP="${ac_tool_prefix}objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -9684,7 +9679,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OBJDUMP="objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -9737,13 +9732,13 @@ lt_cv_deplibs_check_method='unknown'
 # Need to set the preceding variable on all platforms that support
 # interlibrary dependencies.
 # 'none' -- dependencies not supported.
-# `unknown' -- same as none, but documents that we really don't know.
+# 'unknown' -- same as none, but documents that we really don't know.
 # 'pass_all' -- all dependencies passed with no checks.
 # 'test_compile' -- check by making test program.
 # 'file_magic [[regex]]' -- check by looking for files in library path
-# which responds to the $file_magic_cmd with a given extended regex.
-# If you have `file' or equivalent on your system and you're not sure
-# whether `pass_all' will *always* work, you probably want this one.
+# that responds to the $file_magic_cmd with a given extended regex.
+# If you have 'file' or equivalent on your system and you're not sure
+# whether 'pass_all' will *always* work, you probably want this one.
 
 case $host_os in
 aix[4-9]*)
@@ -9770,8 +9765,7 @@ mingw* | pw32*)
   # Base MSYS/MinGW do not provide the 'file' command needed by
   # func_win32_libid shell function, so use a weaker test based on 'objdump',
   # unless we find 'file', for example because we are cross-compiling.
-  # func_win32_libid assumes BSD nm, so disallow it if using MS dumpbin.
-  if ( test "$lt_cv_nm_interface" = "BSD nm" && file / ) >/dev/null 2>&1; then
+  if ( file / ) >/dev/null 2>&1; then
     lt_cv_deplibs_check_method='file_magic ^x86 archive import|^x86 DLL'
     lt_cv_file_magic_cmd='func_win32_libid'
   else
@@ -9807,10 +9801,6 @@ freebsd* | dragonfly*)
   fi
   ;;
 
-gnu*)
-  lt_cv_deplibs_check_method=pass_all
-  ;;
-
 haiku*)
   lt_cv_deplibs_check_method=pass_all
   ;;
@@ -9848,8 +9838,8 @@ irix5* | irix6* | nonstopux*)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-# This must be Linux ELF.
-linux* | k*bsd*-gnu | kopensolaris*-gnu)
+# This must be glibc/ELF.
+linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
@@ -9871,8 +9861,8 @@ newos6*)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-openbsd*)
-  if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+openbsd* | bitrig*)
+  if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`"; then
     lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|\.so|_pic\.a)$'
   else
     lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|_pic\.a)$'
@@ -9925,6 +9915,9 @@ sysv4 | sysv4.3*)
 tpf*)
   lt_cv_deplibs_check_method=pass_all
   ;;
+os2*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
 esac
 
 fi
@@ -9987,7 +9980,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DLLTOOL="${ac_tool_prefix}dlltool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -10027,7 +10020,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DLLTOOL="dlltool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -10079,8 +10072,8 @@ else
 
 case $host_os in
 cygwin* | mingw* | pw32* | cegcc*)
-  # two different shell functions defined in ltmain.sh
-  # decide which to use based on capabilities of $DLLTOOL
+  # two different shell functions defined in ltmain.sh;
+  # decide which one to use based on capabilities of $DLLTOOL
   case `$DLLTOOL --help 2>&1` in
   *--identify-strict*)
     lt_cv_sharedlib_from_linklib_cmd=func_cygming_dll_for_implib
@@ -10092,7 +10085,7 @@ cygwin* | mingw* | pw32* | cegcc*)
   ;;
 *)
   # fallback: assume linklib IS sharedlib
-  lt_cv_sharedlib_from_linklib_cmd="$ECHO"
+  lt_cv_sharedlib_from_linklib_cmd=$ECHO
   ;;
 esac
 
@@ -10127,7 +10120,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AR="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -10171,7 +10164,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_AR="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -10246,7 +10239,7 @@ if ac_fn_c_try_compile "$LINENO"; then :
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }
-      if test "$ac_status" -eq 0; then
+      if test 0 -eq "$ac_status"; then
 	# Ensure the archiver fails upon bogus file names.
 	rm -f conftest.$ac_objext libconftest.a
 	{ { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$lt_ar_try\""; } >&5
@@ -10254,7 +10247,7 @@ if ac_fn_c_try_compile "$LINENO"; then :
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }
-	if test "$ac_status" -ne 0; then
+	if test 0 -ne "$ac_status"; then
           lt_cv_ar_at_file=@
         fi
       fi
@@ -10267,7 +10260,7 @@ fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ar_at_file" >&5
 $as_echo "$lt_cv_ar_at_file" >&6; }
 
-if test "x$lt_cv_ar_at_file" = xno; then
+if test no = "$lt_cv_ar_at_file"; then
   archiver_list_spec=
 else
   archiver_list_spec=$lt_cv_ar_at_file
@@ -10296,7 +10289,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_STRIP="${ac_tool_prefix}strip"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -10336,7 +10329,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_STRIP="strip"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -10395,7 +10388,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -10435,7 +10428,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_RANLIB="ranlib"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -10484,14 +10477,14 @@ old_postuninstall_cmds=
 
 if test -n "$RANLIB"; then
   case $host_os in
-  openbsd*)
-    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB -t \$oldlib"
+  bitrig* | openbsd*)
+    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB -t \$tool_oldlib"
     ;;
   *)
-    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB \$oldlib"
+    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB \$tool_oldlib"
     ;;
   esac
-  old_archive_cmds="$old_archive_cmds~\$RANLIB \$oldlib"
+  old_archive_cmds="$old_archive_cmds~\$RANLIB \$tool_oldlib"
 fi
 
 case $host_os in
@@ -10539,7 +10532,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AWK="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -10616,7 +10609,7 @@ cygwin* | mingw* | pw32* | cegcc*)
   symcode='[ABCDGISTW]'
   ;;
 hpux*)
-  if test "$host_cpu" = ia64; then
+  if test ia64 = "$host_cpu"; then
     symcode='[ABCDEGRST]'
   fi
   ;;
@@ -10649,14 +10642,44 @@ case `$NM -V 2>&1` in
   symcode='[ABCDGIRSTW]' ;;
 esac
 
+if test "$lt_cv_nm_interface" = "MS dumpbin"; then
+  # Gets list of data symbols to import.
+  lt_cv_sys_global_symbol_to_import="sed -n -e 's/^I .* \(.*\)$/\1/p'"
+  # Adjust the below global symbol transforms to fixup imported variables.
+  lt_cdecl_hook=" -e 's/^I .* \(.*\)$/extern __declspec(dllimport) char \1;/p'"
+  lt_c_name_hook=" -e 's/^I .* \(.*\)$/  {\"\1\", (void *) 0},/p'"
+  lt_c_name_lib_hook="\
+  -e 's/^I .* \(lib.*\)$/  {\"\1\", (void *) 0},/p'\
+  -e 's/^I .* \(.*\)$/  {\"lib\1\", (void *) 0},/p'"
+else
+  # Disable hooks by default.
+  lt_cv_sys_global_symbol_to_import=
+  lt_cdecl_hook=
+  lt_c_name_hook=
+  lt_c_name_lib_hook=
+fi
+
 # Transform an extracted symbol line into a proper C declaration.
 # Some systems (esp. on ia64) link data and code symbols differently,
 # so use this general approach.
-lt_cv_sys_global_symbol_to_cdecl="sed -n -e 's/^T .* \(.*\)$/extern int \1();/p' -e 's/^$symcode* .* \(.*\)$/extern char \1;/p'"
+lt_cv_sys_global_symbol_to_cdecl="sed -n"\
+$lt_cdecl_hook\
+" -e 's/^T .* \(.*\)$/extern int \1();/p'"\
+" -e 's/^$symcode$symcode* .* \(.*\)$/extern char \1;/p'"
 
 # Transform an extracted symbol line into symbol name and symbol address
-lt_cv_sys_global_symbol_to_c_name_address="sed -n -e 's/^: \([^ ]*\)[ ]*$/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\"\2\", (void *) \&\2},/p'"
-lt_cv_sys_global_symbol_to_c_name_address_lib_prefix="sed -n -e 's/^: \([^ ]*\)[ ]*$/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([^ ]*\) \(lib[^ ]*\)$/  {\"\2\", (void *) \&\2},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\"lib\2\", (void *) \&\2},/p'"
+lt_cv_sys_global_symbol_to_c_name_address="sed -n"\
+$lt_c_name_hook\
+" -e 's/^: \(.*\) .*$/  {\"\1\", (void *) 0},/p'"\
+" -e 's/^$symcode$symcode* .* \(.*\)$/  {\"\1\", (void *) \&\1},/p'"
+
+# Transform an extracted symbol line into symbol name with lib prefix and
+# symbol address.
+lt_cv_sys_global_symbol_to_c_name_address_lib_prefix="sed -n"\
+$lt_c_name_lib_hook\
+" -e 's/^: \(.*\) .*$/  {\"\1\", (void *) 0},/p'"\
+" -e 's/^$symcode$symcode* .* \(lib.*\)$/  {\"\1\", (void *) \&\1},/p'"\
+" -e 's/^$symcode$symcode* .* \(.*\)$/  {\"lib\1\", (void *) \&\1},/p'"
 
 # Handle CRLF in mingw tool chain
 opt_cr=
@@ -10674,20 +10697,24 @@ for ac_symprfx in "" "_"; do
 
   # Write the raw and C identifiers.
   if test "$lt_cv_nm_interface" = "MS dumpbin"; then
-    # Fake it for dumpbin and say T for any non-static function
-    # and D for any global variable.
+    # Fake it for dumpbin and say T for any non-static function,
+    # D for any global variable and I for any imported variable.
     # Also find C++ and __fastcall symbols from MSVC++,
     # which start with @ or ?.
     lt_cv_sys_global_symbol_pipe="$AWK '"\
 "     {last_section=section; section=\$ 3};"\
+"     /^COFF SYMBOL TABLE/{for(i in hide) delete hide[i]};"\
 "     /Section length .*#relocs.*(pick any)/{hide[last_section]=1};"\
+"     /^ *Symbol name *: /{split(\$ 0,sn,\":\"); si=substr(sn[2],2)};"\
+"     /^ *Type *: code/{print \"T\",si,substr(si,length(prfx))};"\
+"     /^ *Type *: data/{print \"I\",si,substr(si,length(prfx))};"\
 "     \$ 0!~/External *\|/{next};"\
 "     / 0+ UNDEF /{next}; / UNDEF \([^|]\)*()/{next};"\
 "     {if(hide[section]) next};"\
-"     {f=0}; \$ 0~/\(\).*\|/{f=1}; {printf f ? \"T \" : \"D \"};"\
-"     {split(\$ 0, a, /\||\r/); split(a[2], s)};"\
-"     s[1]~/^[@?]/{print s[1], s[1]; next};"\
-"     s[1]~prfx {split(s[1],t,\"@\"); print t[1], substr(t[1],length(prfx))}"\
+"     {f=\"D\"}; \$ 0~/\(\).*\|/{f=\"T\"};"\
+"     {split(\$ 0,a,/\||\r/); split(a[2],s)};"\
+"     s[1]~/^[@?]/{print f,s[1],s[1]; next};"\
+"     s[1]~prfx {split(s[1],t,\"@\"); print f,t[1],substr(t[1],length(prfx))}"\
 "     ' prfx=^$ac_symprfx"
   else
     lt_cv_sys_global_symbol_pipe="sed -n -e 's/^.*[	 ]\($symcode$symcode*\)[	 ][	 ]*$ac_symprfx$sympat$opt_cr$/$symxfrm/p'"
@@ -10735,11 +10762,11 @@ _LT_EOF
 	if $GREP ' nm_test_func$' "$nlist" >/dev/null; then
 	  cat <<_LT_EOF > conftest.$ac_ext
 /* Keep this code in sync between libtool.m4, ltmain, lt_system.h, and tests.  */
-#if defined(_WIN32) || defined(__CYGWIN__) || defined(_WIN32_WCE)
-/* DATA imports from DLLs on WIN32 con't be const, because runtime
+#if defined _WIN32 || defined __CYGWIN__ || defined _WIN32_WCE
+/* DATA imports from DLLs on WIN32 can't be const, because runtime
    relocations are performed -- see ld's documentation on pseudo-relocs.  */
 # define LT_DLSYM_CONST
-#elif defined(__osf__)
+#elif defined __osf__
 /* This system does not cope well with relocations in const data.  */
 # define LT_DLSYM_CONST
 #else
@@ -10765,7 +10792,7 @@ lt__PROGRAM__LTX_preloaded_symbols[] =
 {
   { "@PROGRAM@", (void *) 0 },
 _LT_EOF
-	  $SED "s/^$symcode$symcode* \(.*\) \(.*\)$/  {\"\2\", (void *) \&\2},/" < "$nlist" | $GREP -v main >> conftest.$ac_ext
+	  $SED "s/^$symcode$symcode* .* \(.*\)$/  {\"\1\", (void *) \&\1},/" < "$nlist" | $GREP -v main >> conftest.$ac_ext
 	  cat <<\_LT_EOF >> conftest.$ac_ext
   {0, (void *) 0}
 };
@@ -10785,13 +10812,13 @@ _LT_EOF
 	  mv conftest.$ac_objext conftstm.$ac_objext
 	  lt_globsym_save_LIBS=$LIBS
 	  lt_globsym_save_CFLAGS=$CFLAGS
-	  LIBS="conftstm.$ac_objext"
+	  LIBS=conftstm.$ac_objext
 	  CFLAGS="$CFLAGS$lt_prog_compiler_no_builtin_flag"
 	  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_link\""; } >&5
   (eval $ac_link) 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; } && test -s conftest${ac_exeext}; then
+  test $ac_status = 0; } && test -s conftest$ac_exeext; then
 	    pipe_works=yes
 	  fi
 	  LIBS=$lt_globsym_save_LIBS
@@ -10812,7 +10839,7 @@ _LT_EOF
   rm -rf conftest* conftst*
 
   # Do not use the global_symbol_pipe unless it works.
-  if test "$pipe_works" = yes; then
+  if test yes = "$pipe_works"; then
     break
   else
     lt_cv_sys_global_symbol_pipe=
@@ -10865,6 +10892,16 @@ fi
 
 
 
+
+
+
+
+
+
+
+
+
+
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for sysroot" >&5
 $as_echo_n "checking for sysroot... " >&6; }
 
@@ -10877,9 +10914,9 @@ fi
 
 
 lt_sysroot=
-case ${with_sysroot} in #(
+case $with_sysroot in #(
  yes)
-   if test "$GCC" = yes; then
+   if test yes = "$GCC"; then
      lt_sysroot=`$CC --print-sysroot 2>/dev/null`
    fi
    ;; #(
@@ -10889,8 +10926,8 @@ case ${with_sysroot} in #(
  no|'')
    ;; #(
  *)
-   { $as_echo "$as_me:${as_lineno-$LINENO}: result: ${with_sysroot}" >&5
-$as_echo "${with_sysroot}" >&6; }
+   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $with_sysroot" >&5
+$as_echo "$with_sysroot" >&6; }
    as_fn_error $? "The sysroot must be an absolute path." "$LINENO" 5
    ;;
 esac
@@ -10902,18 +10939,99 @@ $as_echo "${lt_sysroot:-no}" >&6; }
 
 
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for a working dd" >&5
+$as_echo_n "checking for a working dd... " >&6; }
+if ${ac_cv_path_lt_DD+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  printf 0123456789abcdef0123456789abcdef >conftest.i
+cat conftest.i conftest.i >conftest2.i
+: ${lt_DD:=$DD}
+if test -z "$lt_DD"; then
+  ac_path_lt_DD_found=false
+  # Loop through the user's path and test for each of PROGNAME-LIST
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_prog in dd; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
+      ac_path_lt_DD="$as_dir/$ac_prog$ac_exec_ext"
+      as_fn_executable_p "$ac_path_lt_DD" || continue
+if "$ac_path_lt_DD" bs=32 count=1 <conftest2.i >conftest.out 2>/dev/null; then
+  cmp -s conftest.i conftest.out \
+  && ac_cv_path_lt_DD="$ac_path_lt_DD" ac_path_lt_DD_found=:
+fi
+      $ac_path_lt_DD_found && break 3
+    done
+  done
+  done
+IFS=$as_save_IFS
+  if test -z "$ac_cv_path_lt_DD"; then
+    :
+  fi
+else
+  ac_cv_path_lt_DD=$lt_DD
+fi
+
+rm -f conftest.i conftest2.i conftest.out
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_lt_DD" >&5
+$as_echo "$ac_cv_path_lt_DD" >&6; }
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to truncate binary pipes" >&5
+$as_echo_n "checking how to truncate binary pipes... " >&6; }
+if ${lt_cv_truncate_bin+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  printf 0123456789abcdef0123456789abcdef >conftest.i
+cat conftest.i conftest.i >conftest2.i
+lt_cv_truncate_bin=
+if "$ac_cv_path_lt_DD" bs=32 count=1 <conftest2.i >conftest.out 2>/dev/null; then
+  cmp -s conftest.i conftest.out \
+  && lt_cv_truncate_bin="$ac_cv_path_lt_DD bs=4096 count=1"
+fi
+rm -f conftest.i conftest2.i conftest.out
+test -z "$lt_cv_truncate_bin" && lt_cv_truncate_bin="$SED -e 4q"
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_truncate_bin" >&5
+$as_echo "$lt_cv_truncate_bin" >&6; }
+
+
+
+
+
+
+
+# Calculate cc_basename.  Skip known compiler wrappers and cross-prefix.
+func_cc_basename ()
+{
+    for cc_temp in $*""; do
+      case $cc_temp in
+        compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
+        distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
+        \-*) ;;
+        *) break;;
+      esac
+    done
+    func_cc_basename_result=`$ECHO "$cc_temp" | $SED "s%.*/%%; s%^$host_alias-%%"`
+}
+
 # Check whether --enable-libtool-lock was given.
 if test "${enable_libtool_lock+set}" = set; then :
   enableval=$enable_libtool_lock;
 fi
 
-test "x$enable_libtool_lock" != xno && enable_libtool_lock=yes
+test no = "$enable_libtool_lock" || enable_libtool_lock=yes
 
 # Some flags need to be propagated to the compiler or linker for good
 # libtool support.
 case $host in
 ia64-*-hpux*)
-  # Find out which ABI we are using.
+  # Find out what ABI is being produced by ac_compile, and set mode
+  # options accordingly.
   echo 'int i;' > conftest.$ac_ext
   if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
@@ -10922,24 +11040,25 @@ ia64-*-hpux*)
   test $ac_status = 0; }; then
     case `/usr/bin/file conftest.$ac_objext` in
       *ELF-32*)
-	HPUX_IA64_MODE="32"
+	HPUX_IA64_MODE=32
 	;;
       *ELF-64*)
-	HPUX_IA64_MODE="64"
+	HPUX_IA64_MODE=64
 	;;
     esac
   fi
   rm -rf conftest*
   ;;
 *-*-irix6*)
-  # Find out which ABI we are using.
+  # Find out what ABI is being produced by ac_compile, and set linker
+  # options accordingly.
   echo '#line '$LINENO' "configure"' > conftest.$ac_ext
   if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-    if test "$lt_cv_prog_gnu_ld" = yes; then
+    if test yes = "$lt_cv_prog_gnu_ld"; then
       case `/usr/bin/file conftest.$ac_objext` in
 	*32-bit*)
 	  LD="${LD-ld} -melf32bsmip"
@@ -10968,9 +11087,50 @@ ia64-*-hpux*)
   rm -rf conftest*
   ;;
 
-x86_64-*kfreebsd*-gnu|x86_64-*linux*|ppc*-*linux*|powerpc*-*linux*| \
+mips64*-*linux*)
+  # Find out what ABI is being produced by ac_compile, and set linker
+  # options accordingly.
+  echo '#line '$LINENO' "configure"' > conftest.$ac_ext
+  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+    emul=elf
+    case `/usr/bin/file conftest.$ac_objext` in
+      *32-bit*)
+	emul="${emul}32"
+	;;
+      *64-bit*)
+	emul="${emul}64"
+	;;
+    esac
+    case `/usr/bin/file conftest.$ac_objext` in
+      *MSB*)
+	emul="${emul}btsmip"
+	;;
+      *LSB*)
+	emul="${emul}ltsmip"
+	;;
+    esac
+    case `/usr/bin/file conftest.$ac_objext` in
+      *N32*)
+	emul="${emul}n32"
+	;;
+    esac
+    LD="${LD-ld} -m $emul"
+  fi
+  rm -rf conftest*
+  ;;
+
+x86_64-*kfreebsd*-gnu|x86_64-*linux*|powerpc*-*linux*| \
 s390*-*linux*|s390*-*tpf*|sparc*-*linux*)
-  # Find out which ABI we are using.
+  # Find out what ABI is being produced by ac_compile, and set linker
+  # options accordingly.  Note that the listed cases only cover the
+  # situations where additional linker options are needed (such as when
+  # doing 32-bit compilation for a host where ld defaults to 64-bit, or
+  # vice versa); the common cases where no linker options are needed do
+  # not appear in the list.
   echo 'int i;' > conftest.$ac_ext
   if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
@@ -10984,9 +11144,19 @@ s390*-*linux*|s390*-*tpf*|sparc*-*linux*
 	    LD="${LD-ld} -m elf_i386_fbsd"
 	    ;;
 	  x86_64-*linux*)
-	    LD="${LD-ld} -m elf_i386"
+	    case `/usr/bin/file conftest.o` in
+	      *x86-64*)
+		LD="${LD-ld} -m elf32_x86_64"
+		;;
+	      *)
+		LD="${LD-ld} -m elf_i386"
+		;;
+	    esac
+	    ;;
+	  powerpc64le-*linux*)
+	    LD="${LD-ld} -m elf32lppclinux"
 	    ;;
-	  ppc64-*linux*|powerpc64-*linux*)
+	  powerpc64-*linux*)
 	    LD="${LD-ld} -m elf32ppclinux"
 	    ;;
 	  s390x-*linux*)
@@ -11005,7 +11175,10 @@ s390*-*linux*|s390*-*tpf*|sparc*-*linux*
 	  x86_64-*linux*)
 	    LD="${LD-ld} -m elf_x86_64"
 	    ;;
-	  ppc*-*linux*|powerpc*-*linux*)
+	  powerpcle-*linux*)
+	    LD="${LD-ld} -m elf64lppc"
+	    ;;
+	  powerpc-*linux*)
 	    LD="${LD-ld} -m elf64ppc"
 	    ;;
 	  s390*-*linux*|s390*-*tpf*)
@@ -11023,7 +11196,7 @@ s390*-*linux*|s390*-*tpf*|sparc*-*linux*
 
 *-*-sco3.2v5*)
   # On SCO OpenServer 5, we need -belf to get full-featured binaries.
-  SAVE_CFLAGS="$CFLAGS"
+  SAVE_CFLAGS=$CFLAGS
   CFLAGS="$CFLAGS -belf"
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the C compiler needs -belf" >&5
 $as_echo_n "checking whether the C compiler needs -belf... " >&6; }
@@ -11063,13 +11236,14 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_cc_needs_belf" >&5
 $as_echo "$lt_cv_cc_needs_belf" >&6; }
-  if test x"$lt_cv_cc_needs_belf" != x"yes"; then
+  if test yes != "$lt_cv_cc_needs_belf"; then
     # this is probably gcc 2.8.0, egcs 1.0 or newer; no need for -belf
-    CFLAGS="$SAVE_CFLAGS"
+    CFLAGS=$SAVE_CFLAGS
   fi
   ;;
-sparc*-*solaris*)
-  # Find out which ABI we are using.
+*-*solaris*)
+  # Find out what ABI is being produced by ac_compile, and set linker
+  # options accordingly.
   echo 'int i;' > conftest.$ac_ext
   if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
   (eval $ac_compile) 2>&5
@@ -11079,7 +11253,20 @@ sparc*-*solaris*)
     case `/usr/bin/file conftest.o` in
     *64-bit*)
       case $lt_cv_prog_gnu_ld in
-      yes*) LD="${LD-ld} -m elf64_sparc" ;;
+      yes*)
+        case $host in
+        i?86-*-solaris*|x86_64-*-solaris*)
+          LD="${LD-ld} -m elf_x86_64"
+          ;;
+        sparc*-*-solaris*)
+          LD="${LD-ld} -m elf64_sparc"
+          ;;
+        esac
+        # GNU ld 2.21 introduced _sol2 emulations.  Use them if available.
+        if ${LD-ld} -V | grep _sol2 >/dev/null 2>&1; then
+          LD=${LD-ld}_sol2
+        fi
+        ;;
       *)
 	if ${LD-ld} -64 -r -o conftest2.o conftest.o >/dev/null 2>&1; then
 	  LD="${LD-ld} -64"
@@ -11093,7 +11280,7 @@ sparc*-*solaris*)
   ;;
 esac
 
-need_locks="$enable_libtool_lock"
+need_locks=$enable_libtool_lock
 
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}mt", so it can be a program name with args.
@@ -11112,7 +11299,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_MANIFEST_TOOL="${ac_tool_prefix}mt"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11152,7 +11339,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_MANIFEST_TOOL="mt"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11204,7 +11391,7 @@ else
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_path_mainfest_tool" >&5
 $as_echo "$lt_cv_path_mainfest_tool" >&6; }
-if test "x$lt_cv_path_mainfest_tool" != xyes; then
+if test yes != "$lt_cv_path_mainfest_tool"; then
   MANIFEST_TOOL=:
 fi
 
@@ -11232,7 +11419,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DSYMUTIL="${ac_tool_prefix}dsymutil"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11272,7 +11459,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DSYMUTIL="dsymutil"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11324,7 +11511,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_NMEDIT="${ac_tool_prefix}nmedit"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11364,7 +11551,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_NMEDIT="nmedit"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11416,7 +11603,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_LIPO="${ac_tool_prefix}lipo"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11456,7 +11643,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_LIPO="lipo"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11508,7 +11695,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OTOOL="${ac_tool_prefix}otool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11548,7 +11735,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OTOOL="otool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11600,7 +11787,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OTOOL64="${ac_tool_prefix}otool64"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11640,7 +11827,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OTOOL64="otool64"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11707,7 +11894,7 @@ if ${lt_cv_apple_cc_single_mod+:} false;
   $as_echo_n "(cached) " >&6
 else
   lt_cv_apple_cc_single_mod=no
-      if test -z "${LT_MULTI_MODULE}"; then
+      if test -z "$LT_MULTI_MODULE"; then
 	# By default we will add the -single_module flag. You can override
 	# by either setting the environment variable LT_MULTI_MODULE
 	# non-empty at configure time, or by adding -multi_module to the
@@ -11719,7 +11906,13 @@ else
 	$LTCC $LTCFLAGS $LDFLAGS -o libconftest.dylib \
 	  -dynamiclib -Wl,-single_module conftest.c 2>conftest.err
         _lt_result=$?
-	if test -f libconftest.dylib && test ! -s conftest.err && test $_lt_result = 0; then
+	# If there is a non-empty error log, and "single_module"
+	# appears in it, assume the flag caused a linker warning
+        if test -s conftest.err && $GREP single_module conftest.err; then
+	  cat conftest.err >&5
+	# Otherwise, if the output was created with a 0 exit code from
+	# the compiler, it worked.
+	elif test -f libconftest.dylib && test 0 = "$_lt_result"; then
 	  lt_cv_apple_cc_single_mod=yes
 	else
 	  cat conftest.err >&5
@@ -11730,6 +11923,7 @@ else
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_apple_cc_single_mod" >&5
 $as_echo "$lt_cv_apple_cc_single_mod" >&6; }
+
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for -exported_symbols_list linker flag" >&5
 $as_echo_n "checking for -exported_symbols_list linker flag... " >&6; }
 if ${lt_cv_ld_exported_symbols_list+:} false; then :
@@ -11757,11 +11951,12 @@ else
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
-	LDFLAGS="$save_LDFLAGS"
+	LDFLAGS=$save_LDFLAGS
 
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_ld_exported_symbols_list" >&5
 $as_echo "$lt_cv_ld_exported_symbols_list" >&6; }
+
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for -force_load linker flag" >&5
 $as_echo_n "checking for -force_load linker flag... " >&6; }
 if ${lt_cv_ld_force_load+:} false; then :
@@ -11783,7 +11978,9 @@ _LT_EOF
       echo "$LTCC $LTCFLAGS $LDFLAGS -o conftest conftest.c -Wl,-force_load,./libconftest.a" >&5
       $LTCC $LTCFLAGS $LDFLAGS -o conftest conftest.c -Wl,-force_load,./libconftest.a 2>conftest.err
       _lt_result=$?
-      if test -f conftest && test ! -s conftest.err && test $_lt_result = 0 && $GREP forced_load conftest 2>&1 >/dev/null; then
+      if test -s conftest.err && $GREP force_load conftest.err; then
+	cat conftest.err >&5
+      elif test -f conftest && test 0 = "$_lt_result" && $GREP forced_load conftest >/dev/null 2>&1; then
 	lt_cv_ld_force_load=yes
       else
 	cat conftest.err >&5
@@ -11796,32 +11993,32 @@ fi
 $as_echo "$lt_cv_ld_force_load" >&6; }
     case $host_os in
     rhapsody* | darwin1.[012])
-      _lt_dar_allow_undefined='${wl}-undefined ${wl}suppress' ;;
+      _lt_dar_allow_undefined='$wl-undefined ${wl}suppress' ;;
     darwin1.*)
-      _lt_dar_allow_undefined='${wl}-flat_namespace ${wl}-undefined ${wl}suppress' ;;
+      _lt_dar_allow_undefined='$wl-flat_namespace $wl-undefined ${wl}suppress' ;;
     darwin*) # darwin 5.x on
       # if running on 10.5 or later, the deployment target defaults
       # to the OS version, if on x86, and 10.4, the deployment
       # target defaults to 10.4. Don't you love it?
       case ${MACOSX_DEPLOYMENT_TARGET-10.0},$host in
 	10.0,*86*-darwin8*|10.0,*-darwin[91]*)
-	  _lt_dar_allow_undefined='${wl}-undefined ${wl}dynamic_lookup' ;;
-	10.[012]*)
-	  _lt_dar_allow_undefined='${wl}-flat_namespace ${wl}-undefined ${wl}suppress' ;;
+	  _lt_dar_allow_undefined='$wl-undefined ${wl}dynamic_lookup' ;;
+	10.[012][,.]*)
+	  _lt_dar_allow_undefined='$wl-flat_namespace $wl-undefined ${wl}suppress' ;;
 	10.*)
-	  _lt_dar_allow_undefined='${wl}-undefined ${wl}dynamic_lookup' ;;
+	  _lt_dar_allow_undefined='$wl-undefined ${wl}dynamic_lookup' ;;
       esac
     ;;
   esac
-    if test "$lt_cv_apple_cc_single_mod" = "yes"; then
+    if test yes = "$lt_cv_apple_cc_single_mod"; then
       _lt_dar_single_mod='$single_module'
     fi
-    if test "$lt_cv_ld_exported_symbols_list" = "yes"; then
-      _lt_dar_export_syms=' ${wl}-exported_symbols_list,$output_objdir/${libname}-symbols.expsym'
+    if test yes = "$lt_cv_ld_exported_symbols_list"; then
+      _lt_dar_export_syms=' $wl-exported_symbols_list,$output_objdir/$libname-symbols.expsym'
     else
-      _lt_dar_export_syms='~$NMEDIT -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      _lt_dar_export_syms='~$NMEDIT -s $output_objdir/$libname-symbols.expsym $lib'
     fi
-    if test "$DSYMUTIL" != ":" && test "$lt_cv_ld_force_load" = "no"; then
+    if test : != "$DSYMUTIL" && test no = "$lt_cv_ld_force_load"; then
       _lt_dsymutil='~$DSYMUTIL $lib || :'
     else
       _lt_dsymutil=
@@ -11829,6 +12026,41 @@ $as_echo "$lt_cv_ld_force_load" >&6; }
     ;;
   esac
 
+# func_munge_path_list VARIABLE PATH
+# -----------------------------------
+# VARIABLE is name of variable containing _space_ separated list of
+# directories to be munged by the contents of PATH, which is string
+# having a format:
+# "DIR[:DIR]:"
+#       string "DIR[ DIR]" will be prepended to VARIABLE
+# ":DIR[:DIR]"
+#       string "DIR[ DIR]" will be appended to VARIABLE
+# "DIRP[:DIRP]::[DIRA:]DIRA"
+#       string "DIRP[ DIRP]" will be prepended to VARIABLE and string
+#       "DIRA[ DIRA]" will be appended to VARIABLE
+# "DIR[:DIR]"
+#       VARIABLE will be replaced by "DIR[ DIR]"
+func_munge_path_list ()
+{
+    case x$2 in
+    x)
+        ;;
+    *:)
+        eval $1=\"`$ECHO $2 | $SED 's/:/ /g'` \$$1\"
+        ;;
+    x:*)
+        eval $1=\"\$$1 `$ECHO $2 | $SED 's/:/ /g'`\"
+        ;;
+    *::*)
+        eval $1=\"\$$1\ `$ECHO $2 | $SED -e 's/.*:://' -e 's/:/ /g'`\"
+        eval $1=\"`$ECHO $2 | $SED -e 's/::.*//' -e 's/:/ /g'`\ \$$1\"
+        ;;
+    *)
+        eval $1=\"`$ECHO $2 | $SED 's/:/ /g'`\"
+        ;;
+    esac
+}
+
 for ac_header in dlfcn.h
 do :
   ac_fn_c_check_header_compile "$LINENO" "dlfcn.h" "ac_cv_header_dlfcn_h" "$ac_includes_default
@@ -11868,7 +12100,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AS="${ac_tool_prefix}as"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11908,7 +12140,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_AS="as"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -11960,7 +12192,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DLLTOOL="${ac_tool_prefix}dlltool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -12000,7 +12232,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DLLTOOL="dlltool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -12052,7 +12284,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OBJDUMP="${ac_tool_prefix}objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -12092,7 +12324,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OBJDUMP="objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -12163,14 +12395,14 @@ if test "${enable_shared+set}" = set; th
     *)
       enable_shared=no
       # Look at the argument we got.  We use all the common list separators.
-      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      lt_save_ifs=$IFS; IFS=$IFS$PATH_SEPARATOR,
       for pkg in $enableval; do
-	IFS="$lt_save_ifs"
+	IFS=$lt_save_ifs
 	if test "X$pkg" = "X$p"; then
 	  enable_shared=yes
 	fi
       done
-      IFS="$lt_save_ifs"
+      IFS=$lt_save_ifs
       ;;
     esac
 else
@@ -12194,14 +12426,14 @@ if test "${enable_static+set}" = set; th
     *)
      enable_static=no
       # Look at the argument we got.  We use all the common list separators.
-      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      lt_save_ifs=$IFS; IFS=$IFS$PATH_SEPARATOR,
       for pkg in $enableval; do
-	IFS="$lt_save_ifs"
+	IFS=$lt_save_ifs
 	if test "X$pkg" = "X$p"; then
 	  enable_static=yes
 	fi
       done
-      IFS="$lt_save_ifs"
+      IFS=$lt_save_ifs
       ;;
     esac
 else
@@ -12219,14 +12451,27 @@ fi
 
 # Check whether --with-pic was given.
 if test "${with_pic+set}" = set; then :
-  withval=$with_pic; pic_mode="$withval"
+  withval=$with_pic; lt_p=${PACKAGE-default}
+    case $withval in
+    yes|no) pic_mode=$withval ;;
+    *)
+      pic_mode=default
+      # Look at the argument we got.  We use all the common list separators.
+      lt_save_ifs=$IFS; IFS=$IFS$PATH_SEPARATOR,
+      for lt_pkg in $withval; do
+	IFS=$lt_save_ifs
+	if test "X$lt_pkg" = "X$lt_p"; then
+	  pic_mode=yes
+	fi
+      done
+      IFS=$lt_save_ifs
+      ;;
+    esac
 else
   pic_mode=default
 fi
 
 
-test -z "$pic_mode" && pic_mode=default
-
 
 
 
@@ -12242,14 +12487,14 @@ if test "${enable_fast_install+set}" = s
     *)
       enable_fast_install=no
       # Look at the argument we got.  We use all the common list separators.
-      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      lt_save_ifs=$IFS; IFS=$IFS$PATH_SEPARATOR,
       for pkg in $enableval; do
-	IFS="$lt_save_ifs"
+	IFS=$lt_save_ifs
 	if test "X$pkg" = "X$p"; then
 	  enable_fast_install=yes
 	fi
       done
-      IFS="$lt_save_ifs"
+      IFS=$lt_save_ifs
       ;;
     esac
 else
@@ -12263,11 +12508,63 @@ fi
 
 
 
+  shared_archive_member_spec=
+case $host,$enable_shared in
+power*-*-aix[5-9]*,yes)
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking which variant of shared library versioning to provide" >&5
+$as_echo_n "checking which variant of shared library versioning to provide... " >&6; }
+
+# Check whether --with-aix-soname was given.
+if test "${with_aix_soname+set}" = set; then :
+  withval=$with_aix_soname; case $withval in
+    aix|svr4|both)
+      ;;
+    *)
+      as_fn_error $? "Unknown argument to --with-aix-soname" "$LINENO" 5
+      ;;
+    esac
+    lt_cv_with_aix_soname=$with_aix_soname
+else
+  if ${lt_cv_with_aix_soname+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_with_aix_soname=aix
+fi
+
+    with_aix_soname=$lt_cv_with_aix_soname
+fi
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $with_aix_soname" >&5
+$as_echo "$with_aix_soname" >&6; }
+  if test aix != "$with_aix_soname"; then
+    # For the AIX way of multilib, we name the shared archive member
+    # based on the bitwidth used, traditionally 'shr.o' or 'shr_64.o',
+    # and 'shr.imp' or 'shr_64.imp', respectively, for the Import File.
+    # Even when GNU compilers ignore OBJECT_MODE but need '-maix64' flag,
+    # the AIX toolchain works better with OBJECT_MODE set (default 32).
+    if test 64 = "${OBJECT_MODE-32}"; then
+      shared_archive_member_spec=shr_64
+    else
+      shared_archive_member_spec=shr
+    fi
+  fi
+  ;;
+*)
+  with_aix_soname=aix
+  ;;
+esac
+
+
+
+
+
+
+
 
 
 
 # This can be used to rebuild libtool when needed
-LIBTOOL_DEPS="$ltmain"
+LIBTOOL_DEPS=$ltmain
 
 # Always use our own libtool.
 LIBTOOL='$(SHELL) $(top_builddir)/libtool'
@@ -12297,6 +12594,10 @@ LIBTOOL='$(SHELL) $(top_builddir)/libtoo
 
 
 
+
+
+
+
 test -z "$LN_S" && LN_S="ln -s"
 
 
@@ -12312,7 +12613,7 @@ test -z "$LN_S" && LN_S="ln -s"
 
 
 
-if test -n "${ZSH_VERSION+set}" ; then
+if test -n "${ZSH_VERSION+set}"; then
    setopt NO_GLOB_SUBST
 fi
 
@@ -12351,7 +12652,7 @@ aix3*)
   # AIX sometimes has problems with the GCC collect2 program.  For some
   # reason, if we set the COLLECT_NAMES environment variable, the problems
   # vanish in a puff of smoke.
-  if test "X${COLLECT_NAMES+set}" != Xset; then
+  if test set != "${COLLECT_NAMES+set}"; then
     COLLECT_NAMES=
     export COLLECT_NAMES
   fi
@@ -12362,14 +12663,14 @@ esac
 ofile=libtool
 can_build_shared=yes
 
-# All known linkers require a `.a' archive for static linking (except MSVC,
+# All known linkers require a '.a' archive for static linking (except MSVC,
 # which needs '.lib').
 libext=a
 
-with_gnu_ld="$lt_cv_prog_gnu_ld"
+with_gnu_ld=$lt_cv_prog_gnu_ld
 
-old_CC="$CC"
-old_CFLAGS="$CFLAGS"
+old_CC=$CC
+old_CFLAGS=$CFLAGS
 
 # Set sane defaults for various variables
 test -z "$CC" && CC=cc
@@ -12378,15 +12679,8 @@ test -z "$LTCFLAGS" && LTCFLAGS=$CFLAGS
 test -z "$LD" && LD=ld
 test -z "$ac_objext" && ac_objext=o
 
-for cc_temp in $compiler""; do
-  case $cc_temp in
-    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
-    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
-    \-*) ;;
-    *) break;;
-  esac
-done
-cc_basename=`$ECHO "$cc_temp" | $SED "s%.*/%%; s%^$host_alias-%%"`
+func_cc_basename $compiler
+cc_basename=$func_cc_basename_result
 
 
 # Only perform the check for file, if the check method requires it
@@ -12401,22 +12695,22 @@ if ${lt_cv_path_MAGIC_CMD+:} false; then
 else
   case $MAGIC_CMD in
 [\\/*] |  ?:[\\/]*)
-  lt_cv_path_MAGIC_CMD="$MAGIC_CMD" # Let the user override the test with a path.
+  lt_cv_path_MAGIC_CMD=$MAGIC_CMD # Let the user override the test with a path.
   ;;
 *)
-  lt_save_MAGIC_CMD="$MAGIC_CMD"
-  lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
+  lt_save_MAGIC_CMD=$MAGIC_CMD
+  lt_save_ifs=$IFS; IFS=$PATH_SEPARATOR
   ac_dummy="/usr/bin$PATH_SEPARATOR$PATH"
   for ac_dir in $ac_dummy; do
-    IFS="$lt_save_ifs"
+    IFS=$lt_save_ifs
     test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/${ac_tool_prefix}file; then
-      lt_cv_path_MAGIC_CMD="$ac_dir/${ac_tool_prefix}file"
+    if test -f "$ac_dir/${ac_tool_prefix}file"; then
+      lt_cv_path_MAGIC_CMD=$ac_dir/"${ac_tool_prefix}file"
       if test -n "$file_magic_test_file"; then
 	case $deplibs_check_method in
 	"file_magic "*)
 	  file_magic_regex=`expr "$deplibs_check_method" : "file_magic \(.*\)"`
-	  MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
+	  MAGIC_CMD=$lt_cv_path_MAGIC_CMD
 	  if eval $file_magic_cmd \$file_magic_test_file 2> /dev/null |
 	    $EGREP "$file_magic_regex" > /dev/null; then
 	    :
@@ -12439,13 +12733,13 @@ _LT_EOF
       break
     fi
   done
-  IFS="$lt_save_ifs"
-  MAGIC_CMD="$lt_save_MAGIC_CMD"
+  IFS=$lt_save_ifs
+  MAGIC_CMD=$lt_save_MAGIC_CMD
   ;;
 esac
 fi
 
-MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
+MAGIC_CMD=$lt_cv_path_MAGIC_CMD
 if test -n "$MAGIC_CMD"; then
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MAGIC_CMD" >&5
 $as_echo "$MAGIC_CMD" >&6; }
@@ -12467,22 +12761,22 @@ if ${lt_cv_path_MAGIC_CMD+:} false; then
 else
   case $MAGIC_CMD in
 [\\/*] |  ?:[\\/]*)
-  lt_cv_path_MAGIC_CMD="$MAGIC_CMD" # Let the user override the test with a path.
+  lt_cv_path_MAGIC_CMD=$MAGIC_CMD # Let the user override the test with a path.
   ;;
 *)
-  lt_save_MAGIC_CMD="$MAGIC_CMD"
-  lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
+  lt_save_MAGIC_CMD=$MAGIC_CMD
+  lt_save_ifs=$IFS; IFS=$PATH_SEPARATOR
   ac_dummy="/usr/bin$PATH_SEPARATOR$PATH"
   for ac_dir in $ac_dummy; do
-    IFS="$lt_save_ifs"
+    IFS=$lt_save_ifs
     test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/file; then
-      lt_cv_path_MAGIC_CMD="$ac_dir/file"
+    if test -f "$ac_dir/file"; then
+      lt_cv_path_MAGIC_CMD=$ac_dir/"file"
       if test -n "$file_magic_test_file"; then
 	case $deplibs_check_method in
 	"file_magic "*)
 	  file_magic_regex=`expr "$deplibs_check_method" : "file_magic \(.*\)"`
-	  MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
+	  MAGIC_CMD=$lt_cv_path_MAGIC_CMD
 	  if eval $file_magic_cmd \$file_magic_test_file 2> /dev/null |
 	    $EGREP "$file_magic_regex" > /dev/null; then
 	    :
@@ -12505,13 +12799,13 @@ _LT_EOF
       break
     fi
   done
-  IFS="$lt_save_ifs"
-  MAGIC_CMD="$lt_save_MAGIC_CMD"
+  IFS=$lt_save_ifs
+  MAGIC_CMD=$lt_save_MAGIC_CMD
   ;;
 esac
 fi
 
-MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
+MAGIC_CMD=$lt_cv_path_MAGIC_CMD
 if test -n "$MAGIC_CMD"; then
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MAGIC_CMD" >&5
 $as_echo "$MAGIC_CMD" >&6; }
@@ -12532,7 +12826,7 @@ esac
 
 # Use C for the default configuration in the libtool script
 
-lt_save_CC="$CC"
+lt_save_CC=$CC
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
@@ -12594,7 +12888,7 @@ if test -n "$compiler"; then
 
 lt_prog_compiler_no_builtin_flag=
 
-if test "$GCC" = yes; then
+if test yes = "$GCC"; then
   case $cc_basename in
   nvcc*)
     lt_prog_compiler_no_builtin_flag=' -Xcompiler -fno-builtin' ;;
@@ -12610,7 +12904,7 @@ else
   lt_cv_prog_compiler_rtti_exceptions=no
    ac_outfile=conftest.$ac_objext
    echo "$lt_simple_compile_test_code" > conftest.$ac_ext
-   lt_compiler_flag="-fno-rtti -fno-exceptions"
+   lt_compiler_flag="-fno-rtti -fno-exceptions"  ## exclude from sc_useless_quotes_in_assignment
    # Insert the option either (1) after the last *FLAGS variable, or
    # (2) before a word containing "conftest.", or (3) at the end.
    # Note that $ac_compile itself does not contain backslashes and begins
@@ -12640,7 +12934,7 @@ fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_rtti_exceptions" >&5
 $as_echo "$lt_cv_prog_compiler_rtti_exceptions" >&6; }
 
-if test x"$lt_cv_prog_compiler_rtti_exceptions" = xyes; then
+if test yes = "$lt_cv_prog_compiler_rtti_exceptions"; then
     lt_prog_compiler_no_builtin_flag="$lt_prog_compiler_no_builtin_flag -fno-rtti -fno-exceptions"
 else
     :
@@ -12658,17 +12952,18 @@ lt_prog_compiler_pic=
 lt_prog_compiler_static=
 
 
-  if test "$GCC" = yes; then
+  if test yes = "$GCC"; then
     lt_prog_compiler_wl='-Wl,'
     lt_prog_compiler_static='-static'
 
     case $host_os in
       aix*)
       # All AIX code is PIC.
-      if test "$host_cpu" = ia64; then
+      if test ia64 = "$host_cpu"; then
 	# AIX 5 now supports IA64 processor
 	lt_prog_compiler_static='-Bstatic'
       fi
+      lt_prog_compiler_pic='-fPIC'
       ;;
 
     amigaos*)
@@ -12679,8 +12974,8 @@ lt_prog_compiler_static=
         ;;
       m68k)
             # FIXME: we need at least 68020 code to build shared libraries, but
-            # adding the `-m68020' flag to GCC prevents building anything better,
-            # like `-m68040'.
+            # adding the '-m68020' flag to GCC prevents building anything better,
+            # like '-m68040'.
             lt_prog_compiler_pic='-m68020 -resident32 -malways-restore-a4'
         ;;
       esac
@@ -12696,6 +12991,11 @@ lt_prog_compiler_static=
       # Although the cygwin gcc ignores -fPIC, still need this for old-style
       # (--disable-auto-import) libraries
       lt_prog_compiler_pic='-DDLL_EXPORT'
+      case $host_os in
+      os2*)
+	lt_prog_compiler_static='$wl-static'
+	;;
+      esac
       ;;
 
     darwin* | rhapsody*)
@@ -12756,7 +13056,9 @@ lt_prog_compiler_static=
     case $cc_basename in
     nvcc*) # Cuda Compiler Driver 2.2
       lt_prog_compiler_wl='-Xlinker '
-      lt_prog_compiler_pic='-Xcompiler -fPIC'
+      if test -n "$lt_prog_compiler_pic"; then
+        lt_prog_compiler_pic="-Xcompiler $lt_prog_compiler_pic"
+      fi
       ;;
     esac
   else
@@ -12764,7 +13066,7 @@ lt_prog_compiler_static=
     case $host_os in
     aix*)
       lt_prog_compiler_wl='-Wl,'
-      if test "$host_cpu" = ia64; then
+      if test ia64 = "$host_cpu"; then
 	# AIX 5 now supports IA64 processor
 	lt_prog_compiler_static='-Bstatic'
       else
@@ -12772,10 +13074,29 @@ lt_prog_compiler_static=
       fi
       ;;
 
+    darwin* | rhapsody*)
+      # PIC is the default on this platform
+      # Common symbols not allowed in MH_DYLIB files
+      lt_prog_compiler_pic='-fno-common'
+      case $cc_basename in
+      nagfor*)
+        # NAG Fortran compiler
+        lt_prog_compiler_wl='-Wl,-Wl,,'
+        lt_prog_compiler_pic='-PIC'
+        lt_prog_compiler_static='-Bstatic'
+        ;;
+      esac
+      ;;
+
     mingw* | cygwin* | pw32* | os2* | cegcc*)
       # This hack is so that the source file can tell whether it is being
       # built for inclusion in a dll (and should export symbols for example).
       lt_prog_compiler_pic='-DDLL_EXPORT'
+      case $host_os in
+      os2*)
+	lt_prog_compiler_static='$wl-static'
+	;;
+      esac
       ;;
 
     hpux9* | hpux10* | hpux11*)
@@ -12791,7 +13112,7 @@ lt_prog_compiler_static=
 	;;
       esac
       # Is there a better lt_prog_compiler_static that works with the bundled CC?
-      lt_prog_compiler_static='${wl}-a ${wl}archive'
+      lt_prog_compiler_static='$wl-a ${wl}archive'
       ;;
 
     irix5* | irix6* | nonstopux*)
@@ -12800,9 +13121,9 @@ lt_prog_compiler_static=
       lt_prog_compiler_static='-non_shared'
       ;;
 
-    linux* | k*bsd*-gnu | kopensolaris*-gnu)
+    linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
       case $cc_basename in
-      # old Intel for x86_64 which still supported -KPIC.
+      # old Intel for x86_64, which still supported -KPIC.
       ecc*)
 	lt_prog_compiler_wl='-Wl,'
 	lt_prog_compiler_pic='-KPIC'
@@ -12827,6 +13148,12 @@ lt_prog_compiler_static=
 	lt_prog_compiler_pic='-PIC'
 	lt_prog_compiler_static='-Bstatic'
 	;;
+      tcc*)
+	# Fabrice Bellard et al's Tiny C Compiler
+	lt_prog_compiler_wl='-Wl,'
+	lt_prog_compiler_pic='-fPIC'
+	lt_prog_compiler_static='-static'
+	;;
       pgcc* | pgf77* | pgf90* | pgf95* | pgfortran*)
         # Portland Group compilers (*not* the Pentium gcc compiler,
 	# which looks to be a dead project)
@@ -12847,18 +13174,33 @@ lt_prog_compiler_static=
 	;;
       *)
 	case `$CC -V 2>&1 | sed 5q` in
-	*Sun\ F* | *Sun*Fortran*)
+	*Sun\ Ceres\ Fortran* | *Sun*Fortran*\ [1-7].* | *Sun*Fortran*\ 8.[0-3]*)
 	  # Sun Fortran 8.3 passes all unrecognized flags to the linker
 	  lt_prog_compiler_pic='-KPIC'
 	  lt_prog_compiler_static='-Bstatic'
 	  lt_prog_compiler_wl=''
 	  ;;
+	*Sun\ F* | *Sun*Fortran*)
+	  lt_prog_compiler_pic='-KPIC'
+	  lt_prog_compiler_static='-Bstatic'
+	  lt_prog_compiler_wl='-Qoption ld '
+	  ;;
 	*Sun\ C*)
 	  # Sun C 5.9
 	  lt_prog_compiler_pic='-KPIC'
 	  lt_prog_compiler_static='-Bstatic'
 	  lt_prog_compiler_wl='-Wl,'
 	  ;;
+        *Intel*\ [CF]*Compiler*)
+	  lt_prog_compiler_wl='-Wl,'
+	  lt_prog_compiler_pic='-fPIC'
+	  lt_prog_compiler_static='-static'
+	  ;;
+	*Portland\ Group*)
+	  lt_prog_compiler_wl='-Wl,'
+	  lt_prog_compiler_pic='-fpic'
+	  lt_prog_compiler_static='-Bstatic'
+	  ;;
 	esac
 	;;
       esac
@@ -12909,7 +13251,7 @@ lt_prog_compiler_static=
       ;;
 
     sysv4*MP*)
-      if test -d /usr/nec ;then
+      if test -d /usr/nec; then
 	lt_prog_compiler_pic='-Kconform_pic'
 	lt_prog_compiler_static='-Bstatic'
       fi
@@ -12938,7 +13280,7 @@ lt_prog_compiler_static=
   fi
 
 case $host_os in
-  # For platforms which do not support PIC, -DPIC is meaningless:
+  # For platforms that do not support PIC, -DPIC is meaningless:
   *djgpp*)
     lt_prog_compiler_pic=
     ;;
@@ -12970,7 +13312,7 @@ else
   lt_cv_prog_compiler_pic_works=no
    ac_outfile=conftest.$ac_objext
    echo "$lt_simple_compile_test_code" > conftest.$ac_ext
-   lt_compiler_flag="$lt_prog_compiler_pic -DPIC"
+   lt_compiler_flag="$lt_prog_compiler_pic -DPIC"  ## exclude from sc_useless_quotes_in_assignment
    # Insert the option either (1) after the last *FLAGS variable, or
    # (2) before a word containing "conftest.", or (3) at the end.
    # Note that $ac_compile itself does not contain backslashes and begins
@@ -13000,7 +13342,7 @@ fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_pic_works" >&5
 $as_echo "$lt_cv_prog_compiler_pic_works" >&6; }
 
-if test x"$lt_cv_prog_compiler_pic_works" = xyes; then
+if test yes = "$lt_cv_prog_compiler_pic_works"; then
     case $lt_prog_compiler_pic in
      "" | " "*) ;;
      *) lt_prog_compiler_pic=" $lt_prog_compiler_pic" ;;
@@ -13032,7 +13374,7 @@ if ${lt_cv_prog_compiler_static_works+:}
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler_static_works=no
-   save_LDFLAGS="$LDFLAGS"
+   save_LDFLAGS=$LDFLAGS
    LDFLAGS="$LDFLAGS $lt_tmp_static_flag"
    echo "$lt_simple_link_test_code" > conftest.$ac_ext
    if (eval $ac_link 2>conftest.err) && test -s conftest$ac_exeext; then
@@ -13051,13 +13393,13 @@ else
      fi
    fi
    $RM -r conftest*
-   LDFLAGS="$save_LDFLAGS"
+   LDFLAGS=$save_LDFLAGS
 
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_static_works" >&5
 $as_echo "$lt_cv_prog_compiler_static_works" >&6; }
 
-if test x"$lt_cv_prog_compiler_static_works" = xyes; then
+if test yes = "$lt_cv_prog_compiler_static_works"; then
     :
 else
     lt_prog_compiler_static=
@@ -13177,8 +13519,8 @@ $as_echo "$lt_cv_prog_compiler_c_o" >&6;
 
 
 
-hard_links="nottested"
-if test "$lt_cv_prog_compiler_c_o" = no && test "$need_locks" != no; then
+hard_links=nottested
+if test no = "$lt_cv_prog_compiler_c_o" && test no != "$need_locks"; then
   # do not overwrite the value of need_locks provided by the user
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking if we can lock with hard links" >&5
 $as_echo_n "checking if we can lock with hard links... " >&6; }
@@ -13190,9 +13532,9 @@ $as_echo_n "checking if we can lock with
   ln conftest.a conftest.b 2>/dev/null && hard_links=no
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $hard_links" >&5
 $as_echo "$hard_links" >&6; }
-  if test "$hard_links" = no; then
-    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
-$as_echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
+  if test no = "$hard_links"; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: '$CC' does not support '-c -o', so 'make -j' may be unsafe" >&5
+$as_echo "$as_me: WARNING: '$CC' does not support '-c -o', so 'make -j' may be unsafe" >&2;}
     need_locks=warn
   fi
 else
@@ -13220,7 +13562,6 @@ $as_echo_n "checking whether the $compil
   hardcode_direct=no
   hardcode_direct_absolute=no
   hardcode_libdir_flag_spec=
-  hardcode_libdir_flag_spec_ld=
   hardcode_libdir_separator=
   hardcode_minus_L=no
   hardcode_shlibpath_var=unsupported
@@ -13236,9 +13577,9 @@ $as_echo_n "checking whether the $compil
   # included in the symbol list
   include_expsyms=
   # exclude_expsyms can be an extended regexp of symbols to exclude
-  # it will be wrapped by ` (' and `)$', so one must not match beginning or
-  # end of line.  Example: `a|bc|.*d.*' will exclude the symbols `a' and `bc',
-  # as well as any symbol that contains `d'.
+  # it will be wrapped by ' (' and ')$', so one must not match beginning or
+  # end of line.  Example: 'a|bc|.*d.*' will exclude the symbols 'a' and 'bc',
+  # as well as any symbol that contains 'd'.
   exclude_expsyms='_GLOBAL_OFFSET_TABLE_|_GLOBAL__F[ID]_.*'
   # Although _GLOBAL_OFFSET_TABLE_ is a valid symbol C name, most a.out
   # platforms (ab)use it in PIC code, but their linkers get confused if
@@ -13253,7 +13594,7 @@ $as_echo_n "checking whether the $compil
     # FIXME: the MSVC++ port hasn't been tested in a loooong time
     # When not using gcc, we currently assume that we are using
     # Microsoft Visual C++.
-    if test "$GCC" != yes; then
+    if test yes != "$GCC"; then
       with_gnu_ld=no
     fi
     ;;
@@ -13261,7 +13602,7 @@ $as_echo_n "checking whether the $compil
     # we just hope/assume this is gcc and not c89 (= MSVC++)
     with_gnu_ld=yes
     ;;
-  openbsd*)
+  openbsd* | bitrig*)
     with_gnu_ld=no
     ;;
   esac
@@ -13271,7 +13612,7 @@ $as_echo_n "checking whether the $compil
   # On some targets, GNU ld is compatible enough with the native linker
   # that we're better off using the native interface for both.
   lt_use_gnu_ld_interface=no
-  if test "$with_gnu_ld" = yes; then
+  if test yes = "$with_gnu_ld"; then
     case $host_os in
       aix*)
 	# The AIX port of GNU ld has always aspired to compatibility
@@ -13293,24 +13634,24 @@ $as_echo_n "checking whether the $compil
     esac
   fi
 
-  if test "$lt_use_gnu_ld_interface" = yes; then
+  if test yes = "$lt_use_gnu_ld_interface"; then
     # If archive_cmds runs LD, not CC, wlarc should be empty
-    wlarc='${wl}'
+    wlarc='$wl'
 
     # Set some defaults for GNU ld with shared library support. These
     # are reset later if shared libraries are not supported. Putting them
     # here allows them to be overridden if necessary.
     runpath_var=LD_RUN_PATH
-    hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
-    export_dynamic_flag_spec='${wl}--export-dynamic'
+    hardcode_libdir_flag_spec='$wl-rpath $wl$libdir'
+    export_dynamic_flag_spec='$wl--export-dynamic'
     # ancient GNU ld didn't support --whole-archive et. al.
     if $LD --help 2>&1 | $GREP 'no-whole-archive' > /dev/null; then
-      whole_archive_flag_spec="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
+      whole_archive_flag_spec=$wlarc'--whole-archive$convenience '$wlarc'--no-whole-archive'
     else
       whole_archive_flag_spec=
     fi
     supports_anon_versioning=no
-    case `$LD -v 2>&1` in
+    case `$LD -v | $SED -e 's/(^)\+)\s\+//' 2>&1` in
       *GNU\ gold*) supports_anon_versioning=yes ;;
       *\ [01].* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions < 2.11
       *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
@@ -13323,7 +13664,7 @@ $as_echo_n "checking whether the $compil
     case $host_os in
     aix[3-9]*)
       # On AIX/PPC, the GNU linker is very broken
-      if test "$host_cpu" != ia64; then
+      if test ia64 != "$host_cpu"; then
 	ld_shlibs=no
 	cat <<_LT_EOF 1>&2
 
@@ -13342,7 +13683,7 @@ _LT_EOF
       case $host_cpu in
       powerpc)
             # see comment about AmigaOS4 .so support
-            archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+            archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
             archive_expsym_cmds=''
         ;;
       m68k)
@@ -13358,7 +13699,7 @@ _LT_EOF
 	allow_undefined_flag=unsupported
 	# Joseph Beckenbach <jrb3@best.com> says some releases of gcc
 	# support --undefined.  This deserves some investigation.  FIXME
-	archive_cmds='$CC -nostart $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	archive_cmds='$CC -nostart $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
       else
 	ld_shlibs=no
       fi
@@ -13368,7 +13709,7 @@ _LT_EOF
       # _LT_TAGVAR(hardcode_libdir_flag_spec, ) is actually meaningless,
       # as there is no search path for DLLs.
       hardcode_libdir_flag_spec='-L$libdir'
-      export_dynamic_flag_spec='${wl}--export-all-symbols'
+      export_dynamic_flag_spec='$wl--export-all-symbols'
       allow_undefined_flag=unsupported
       always_export_symbols=no
       enable_shared_with_static_runtimes=yes
@@ -13376,61 +13717,89 @@ _LT_EOF
       exclude_expsyms='[_]+GLOBAL_OFFSET_TABLE_|[_]+GLOBAL__[FID]_.*|[_]+head_[A-Za-z0-9_]+_dll|[A-Za-z0-9_]+_dll_iname'
 
       if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
-        archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
-	# If the export-symbols file already is a .def file (1st line
-	# is EXPORTS), use it as is; otherwise, prepend...
-	archive_expsym_cmds='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
-	  cp $export_symbols $output_objdir/$soname.def;
-	else
-	  echo EXPORTS > $output_objdir/$soname.def;
-	  cat $export_symbols >> $output_objdir/$soname.def;
-	fi~
-	$CC -shared $output_objdir/$soname.def $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+        archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname $wl--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+	# If the export-symbols file already is a .def file, use it as
+	# is; otherwise, prepend EXPORTS...
+	archive_expsym_cmds='if   test DEF = "`$SED -n     -e '\''s/^[	 ]*//'\''     -e '\''/^\(;.*\)*$/d'\''     -e '\''s/^\(EXPORTS\|LIBRARY\)\([	 ].*\)*$/DEF/p'\''     -e q     $export_symbols`" ; then
+          cp $export_symbols $output_objdir/$soname.def;
+        else
+          echo EXPORTS > $output_objdir/$soname.def;
+          cat $export_symbols >> $output_objdir/$soname.def;
+        fi~
+        $CC -shared $output_objdir/$soname.def $libobjs $deplibs $compiler_flags -o $output_objdir/$soname $wl--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
       else
 	ld_shlibs=no
       fi
       ;;
 
     haiku*)
-      archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
       link_all_deplibs=yes
       ;;
 
+    os2*)
+      hardcode_libdir_flag_spec='-L$libdir'
+      hardcode_minus_L=yes
+      allow_undefined_flag=unsupported
+      shrext_cmds=.dll
+      archive_cmds='$ECHO "LIBRARY ${soname%$shared_ext} INITINSTANCE TERMINSTANCE" > $output_objdir/$libname.def~
+	$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~
+	$ECHO "DATA MULTIPLE NONSHARED" >> $output_objdir/$libname.def~
+	$ECHO EXPORTS >> $output_objdir/$libname.def~
+	emxexp $libobjs | $SED /"_DLL_InitTerm"/d >> $output_objdir/$libname.def~
+	$CC -Zdll -Zcrtdll -o $output_objdir/$soname $libobjs $deplibs $compiler_flags $output_objdir/$libname.def~
+	emximp -o $lib $output_objdir/$libname.def'
+      archive_expsym_cmds='$ECHO "LIBRARY ${soname%$shared_ext} INITINSTANCE TERMINSTANCE" > $output_objdir/$libname.def~
+	$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~
+	$ECHO "DATA MULTIPLE NONSHARED" >> $output_objdir/$libname.def~
+	$ECHO EXPORTS >> $output_objdir/$libname.def~
+	prefix_cmds="$SED"~
+	if test EXPORTS = "`$SED 1q $export_symbols`"; then
+	  prefix_cmds="$prefix_cmds -e 1d";
+	fi~
+	prefix_cmds="$prefix_cmds -e \"s/^\(.*\)$/_\1/g\""~
+	cat $export_symbols | $prefix_cmds >> $output_objdir/$libname.def~
+	$CC -Zdll -Zcrtdll -o $output_objdir/$soname $libobjs $deplibs $compiler_flags $output_objdir/$libname.def~
+	emximp -o $lib $output_objdir/$libname.def'
+      old_archive_From_new_cmds='emximp -o $output_objdir/${libname}_dll.a $output_objdir/$libname.def'
+      enable_shared_with_static_runtimes=yes
+      ;;
+
     interix[3-9]*)
       hardcode_direct=no
       hardcode_shlibpath_var=no
-      hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
-      export_dynamic_flag_spec='${wl}-E'
+      hardcode_libdir_flag_spec='$wl-rpath,$libdir'
+      export_dynamic_flag_spec='$wl-E'
       # Hack: On Interix 3.x, we cannot compile PIC because of a broken gcc.
       # Instead, shared libraries are loaded at an image base (0x10000000 by
       # default) and relocated if they conflict, which is a slow very memory
       # consuming and fragmenting process.  To avoid this, we pick a random,
       # 256 KiB-aligned image base between 0x50000000 and 0x6FFC0000 at link
       # time.  Moving up from 0x10000000 also allows more sbrk(2) space.
-      archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
-      archive_expsym_cmds='sed "s,^,_," $export_symbols >$output_objdir/$soname.expsym~$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--retain-symbols-file,$output_objdir/$soname.expsym ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
+      archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-h,$soname $wl--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
+      archive_expsym_cmds='sed "s|^|_|" $export_symbols >$output_objdir/$soname.expsym~$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-h,$soname $wl--retain-symbols-file,$output_objdir/$soname.expsym $wl--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
       ;;
 
     gnu* | linux* | tpf* | k*bsd*-gnu | kopensolaris*-gnu)
       tmp_diet=no
-      if test "$host_os" = linux-dietlibc; then
+      if test linux-dietlibc = "$host_os"; then
 	case $cc_basename in
 	  diet\ *) tmp_diet=yes;;	# linux-dietlibc with static linking (!diet-dyn)
 	esac
       fi
       if $LD --help 2>&1 | $EGREP ': supported targets:.* elf' > /dev/null \
-	 && test "$tmp_diet" = no
+	 && test no = "$tmp_diet"
       then
 	tmp_addflag=' $pic_flag'
 	tmp_sharedflag='-shared'
 	case $cc_basename,$host_cpu in
         pgcc*)				# Portland Group C compiler
-	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  whole_archive_flag_spec='$wl--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` $wl--no-whole-archive'
 	  tmp_addflag=' $pic_flag'
 	  ;;
 	pgf77* | pgf90* | pgf95* | pgfortran*)
 					# Portland Group f77 and f90 compilers
-	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  whole_archive_flag_spec='$wl--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` $wl--no-whole-archive'
 	  tmp_addflag=' $pic_flag -Mnomain' ;;
 	ecc*,ia64* | icc*,ia64*)	# Intel C compiler on ia64
 	  tmp_addflag=' -i_dynamic' ;;
@@ -13441,43 +13810,47 @@ _LT_EOF
 	lf95*)				# Lahey Fortran 8.1
 	  whole_archive_flag_spec=
 	  tmp_sharedflag='--shared' ;;
+        nagfor*)                        # NAGFOR 5.3
+          tmp_sharedflag='-Wl,-shared' ;;
 	xl[cC]* | bgxl[cC]* | mpixl[cC]*) # IBM XL C 8.0 on PPC (deal with xlf below)
 	  tmp_sharedflag='-qmkshrobj'
 	  tmp_addflag= ;;
 	nvcc*)	# Cuda Compiler Driver 2.2
-	  whole_archive_flag_spec='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  whole_archive_flag_spec='$wl--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` $wl--no-whole-archive'
 	  compiler_needs_object=yes
 	  ;;
 	esac
 	case `$CC -V 2>&1 | sed 5q` in
 	*Sun\ C*)			# Sun C 5.9
-	  whole_archive_flag_spec='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  whole_archive_flag_spec='$wl--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` $wl--no-whole-archive'
 	  compiler_needs_object=yes
 	  tmp_sharedflag='-G' ;;
 	*Sun\ F*)			# Sun Fortran 8.3
 	  tmp_sharedflag='-G' ;;
 	esac
-	archive_cmds='$CC '"$tmp_sharedflag""$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	archive_cmds='$CC '"$tmp_sharedflag""$tmp_addflag"' $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
 
-        if test "x$supports_anon_versioning" = xyes; then
+        if test yes = "$supports_anon_versioning"; then
           archive_expsym_cmds='echo "{ global:" > $output_objdir/$libname.ver~
-	    cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
-	    echo "local: *; };" >> $output_objdir/$libname.ver~
-	    $CC '"$tmp_sharedflag""$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
+            cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
+            echo "local: *; };" >> $output_objdir/$libname.ver~
+            $CC '"$tmp_sharedflag""$tmp_addflag"' $libobjs $deplibs $compiler_flags $wl-soname $wl$soname $wl-version-script $wl$output_objdir/$libname.ver -o $lib'
         fi
 
 	case $cc_basename in
+	tcc*)
+	  export_dynamic_flag_spec='-rdynamic'
+	  ;;
 	xlf* | bgf* | bgxlf* | mpixlf*)
 	  # IBM XL Fortran 10.1 on PPC cannot create shared libs itself
 	  whole_archive_flag_spec='--whole-archive$convenience --no-whole-archive'
-	  hardcode_libdir_flag_spec=
-	  hardcode_libdir_flag_spec_ld='-rpath $libdir'
+	  hardcode_libdir_flag_spec='$wl-rpath $wl$libdir'
 	  archive_cmds='$LD -shared $libobjs $deplibs $linker_flags -soname $soname -o $lib'
-	  if test "x$supports_anon_versioning" = xyes; then
+	  if test yes = "$supports_anon_versioning"; then
 	    archive_expsym_cmds='echo "{ global:" > $output_objdir/$libname.ver~
-	      cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
-	      echo "local: *; };" >> $output_objdir/$libname.ver~
-	      $LD -shared $libobjs $deplibs $linker_flags -soname $soname -version-script $output_objdir/$libname.ver -o $lib'
+              cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
+              echo "local: *; };" >> $output_objdir/$libname.ver~
+              $LD -shared $libobjs $deplibs $linker_flags -soname $soname -version-script $output_objdir/$libname.ver -o $lib'
 	  fi
 	  ;;
 	esac
@@ -13491,8 +13864,8 @@ _LT_EOF
 	archive_cmds='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
 	wlarc=
       else
-	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
+	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname $wl-retain-symbols-file $wl$export_symbols -o $lib'
       fi
       ;;
 
@@ -13510,8 +13883,8 @@ _LT_EOF
 
 _LT_EOF
       elif $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
+	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname $wl-retain-symbols-file $wl$export_symbols -o $lib'
       else
 	ld_shlibs=no
       fi
@@ -13523,7 +13896,7 @@ _LT_EOF
 	ld_shlibs=no
 	cat <<_LT_EOF 1>&2
 
-*** Warning: Releases of the GNU linker prior to 2.16.91.0.3 can not
+*** Warning: Releases of the GNU linker prior to 2.16.91.0.3 cannot
 *** reliably create shared libraries on SCO systems.  Therefore, libtool
 *** is disabling shared libraries support.  We urge you to upgrade GNU
 *** binutils to release 2.16.91.0.3 or newer.  Another option is to modify
@@ -13538,9 +13911,9 @@ _LT_EOF
 	  # DT_RUNPATH tag from executables and libraries.  But doing so
 	  # requires that you compile everything twice, which is a pain.
 	  if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	    hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
-	    archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	    archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	    hardcode_libdir_flag_spec='$wl-rpath $wl$libdir'
+	    archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
+	    archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags $wl-soname $wl$soname $wl-retain-symbols-file $wl$export_symbols -o $lib'
 	  else
 	    ld_shlibs=no
 	  fi
@@ -13557,15 +13930,15 @@ _LT_EOF
 
     *)
       if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
+	archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname $wl-retain-symbols-file $wl$export_symbols -o $lib'
       else
 	ld_shlibs=no
       fi
       ;;
     esac
 
-    if test "$ld_shlibs" = no; then
+    if test no = "$ld_shlibs"; then
       runpath_var=
       hardcode_libdir_flag_spec=
       export_dynamic_flag_spec=
@@ -13581,7 +13954,7 @@ _LT_EOF
       # Note: this linker hardcodes the directories in LIBPATH if there
       # are no directories specified by -L.
       hardcode_minus_L=yes
-      if test "$GCC" = yes && test -z "$lt_prog_compiler_static"; then
+      if test yes = "$GCC" && test -z "$lt_prog_compiler_static"; then
 	# Neither direct hardcoding nor static linking is supported with a
 	# broken collect2.
 	hardcode_direct=unsupported
@@ -13589,34 +13962,57 @@ _LT_EOF
       ;;
 
     aix[4-9]*)
-      if test "$host_cpu" = ia64; then
+      if test ia64 = "$host_cpu"; then
 	# On IA64, the linker does run time linking by default, so we don't
 	# have to do anything special.
 	aix_use_runtimelinking=no
 	exp_sym_flag='-Bexport'
-	no_entry_flag=""
+	no_entry_flag=
       else
 	# If we're using GNU nm, then we don't want the "-C" option.
-	# -C means demangle to AIX nm, but means don't demangle with GNU nm
-	# Also, AIX nm treats weak defined symbols like other global
-	# defined symbols, whereas GNU nm marks them as "W".
+	# -C means demangle to GNU nm, but means don't demangle to AIX nm.
+	# Without the "-l" option, or with the "-B" option, AIX nm treats
+	# weak defined symbols like other global defined symbols, whereas
+	# GNU nm marks them as "W".
+	# While the 'weak' keyword is ignored in the Export File, we need
+	# it in the Import File for the 'aix-soname' feature, so we have
+	# to replace the "-B" option with "-P" for AIX nm.
 	if $NM -V 2>&1 | $GREP 'GNU' > /dev/null; then
-	  export_symbols_cmds='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+	  export_symbols_cmds='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && (substr(\$ 3,1,1) != ".")) { if (\$ 2 == "W") { print \$ 3 " weak" } else { print \$ 3 } } }'\'' | sort -u > $export_symbols'
 	else
-	  export_symbols_cmds='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+	  export_symbols_cmds='`func_echo_all $NM | $SED -e '\''s/B\([^B]*\)$/P\1/'\''` -PCpgl $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W") || (\$ 2 == "V") || (\$ 2 == "Z")) && (substr(\$ 1,1,1) != ".")) { if ((\$ 2 == "W") || (\$ 2 == "V") || (\$ 2 == "Z")) { print \$ 1 " weak" } else { print \$ 1 } } }'\'' | sort -u > $export_symbols'
 	fi
 	aix_use_runtimelinking=no
 
 	# Test if we are trying to use run time linking or normal
 	# AIX style linking. If -brtl is somewhere in LDFLAGS, we
-	# need to do runtime linking.
+	# have runtime linking enabled, and use it for executables.
+	# For shared libraries, we enable/disable runtime linking
+	# depending on the kind of the shared library created -
+	# when "with_aix_soname,aix_use_runtimelinking" is:
+	# "aix,no"   lib.a(lib.so.V) shared, rtl:no,  for executables
+	# "aix,yes"  lib.so          shared, rtl:yes, for executables
+	#            lib.a           static archive
+	# "both,no"  lib.so.V(shr.o) shared, rtl:yes
+	#            lib.a(lib.so.V) shared, rtl:no,  for executables
+	# "both,yes" lib.so.V(shr.o) shared, rtl:yes, for executables
+	#            lib.a(lib.so.V) shared, rtl:no
+	# "svr4,*"   lib.so.V(shr.o) shared, rtl:yes, for executables
+	#            lib.a           static archive
 	case $host_os in aix4.[23]|aix4.[23].*|aix[5-9]*)
 	  for ld_flag in $LDFLAGS; do
-	  if (test $ld_flag = "-brtl" || test $ld_flag = "-Wl,-brtl"); then
+	  if (test x-brtl = "x$ld_flag" || test x-Wl,-brtl = "x$ld_flag"); then
 	    aix_use_runtimelinking=yes
 	    break
 	  fi
 	  done
+	  if test svr4,no = "$with_aix_soname,$aix_use_runtimelinking"; then
+	    # With aix-soname=svr4, we create the lib.so.V shared archives only,
+	    # so we don't have lib.a shared libs to link our executables.
+	    # We have to force runtime linking in this case.
+	    aix_use_runtimelinking=yes
+	    LDFLAGS="$LDFLAGS -Wl,-brtl"
+	  fi
 	  ;;
 	esac
 
@@ -13635,13 +14031,21 @@ _LT_EOF
       hardcode_direct_absolute=yes
       hardcode_libdir_separator=':'
       link_all_deplibs=yes
-      file_list_spec='${wl}-f,'
+      file_list_spec='$wl-f,'
+      case $with_aix_soname,$aix_use_runtimelinking in
+      aix,*) ;; # traditional, no import file
+      svr4,* | *,yes) # use import file
+	# The Import File defines what to hardcode.
+	hardcode_direct=no
+	hardcode_direct_absolute=no
+	;;
+      esac
 
-      if test "$GCC" = yes; then
+      if test yes = "$GCC"; then
 	case $host_os in aix4.[012]|aix4.[012].*)
 	# We only want to do this on AIX 4.2 and lower, the check
 	# below for broken collect2 doesn't work under 4.3+
-	  collect2name=`${CC} -print-prog-name=collect2`
+	  collect2name=`$CC -print-prog-name=collect2`
 	  if test -f "$collect2name" &&
 	   strings "$collect2name" | $GREP resolve_lib_name >/dev/null
 	  then
@@ -13660,35 +14064,42 @@ _LT_EOF
 	  ;;
 	esac
 	shared_flag='-shared'
-	if test "$aix_use_runtimelinking" = yes; then
-	  shared_flag="$shared_flag "'${wl}-G'
+	if test yes = "$aix_use_runtimelinking"; then
+	  shared_flag="$shared_flag "'$wl-G'
 	fi
+	# Need to ensure runtime linking is disabled for the traditional
+	# shared library, or the linker may eventually find shared libraries
+	# /with/ Import File - we do not want to mix them.
+	shared_flag_aix='-shared'
+	shared_flag_svr4='-shared $wl-G'
       else
 	# not using gcc
-	if test "$host_cpu" = ia64; then
+	if test ia64 = "$host_cpu"; then
 	# VisualAge C++, Version 5.5 for AIX 5L for IA-64, Beta 3 Release
 	# chokes on -Wl,-G. The following line is correct:
 	  shared_flag='-G'
 	else
-	  if test "$aix_use_runtimelinking" = yes; then
-	    shared_flag='${wl}-G'
+	  if test yes = "$aix_use_runtimelinking"; then
+	    shared_flag='$wl-G'
 	  else
-	    shared_flag='${wl}-bM:SRE'
+	    shared_flag='$wl-bM:SRE'
 	  fi
+	  shared_flag_aix='$wl-bM:SRE'
+	  shared_flag_svr4='$wl-G'
 	fi
       fi
 
-      export_dynamic_flag_spec='${wl}-bexpall'
+      export_dynamic_flag_spec='$wl-bexpall'
       # It seems that -bexpall does not export symbols beginning with
       # underscore (_), so it is better to generate a list of symbols to export.
       always_export_symbols=yes
-      if test "$aix_use_runtimelinking" = yes; then
+      if test aix,yes = "$with_aix_soname,$aix_use_runtimelinking"; then
 	# Warning - without using the other runtime loading flags (-brtl),
 	# -berok will link without error, but may produce a broken library.
 	allow_undefined_flag='-berok'
         # Determine the default libpath from the value encoded in an
         # empty executable.
-        if test "${lt_cv_aix_libpath+set}" = set; then
+        if test set = "${lt_cv_aix_libpath+set}"; then
   aix_libpath=$lt_cv_aix_libpath
 else
   if ${lt_cv_aix_libpath_+:} false; then :
@@ -13723,7 +14134,7 @@ fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
   if test -z "$lt_cv_aix_libpath_"; then
-    lt_cv_aix_libpath_="/usr/lib:/lib"
+    lt_cv_aix_libpath_=/usr/lib:/lib
   fi
 
 fi
@@ -13731,17 +14142,17 @@ fi
   aix_libpath=$lt_cv_aix_libpath_
 fi
 
-        hardcode_libdir_flag_spec='${wl}-blibpath:$libdir:'"$aix_libpath"
-        archive_expsym_cmds='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then func_echo_all "${wl}${allow_undefined_flag}"; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
+        hardcode_libdir_flag_spec='$wl-blibpath:$libdir:'"$aix_libpath"
+        archive_expsym_cmds='$CC -o $output_objdir/$soname $libobjs $deplibs $wl'$no_entry_flag' $compiler_flags `if test -n "$allow_undefined_flag"; then func_echo_all "$wl$allow_undefined_flag"; else :; fi` $wl'$exp_sym_flag:\$export_symbols' '$shared_flag
       else
-	if test "$host_cpu" = ia64; then
-	  hardcode_libdir_flag_spec='${wl}-R $libdir:/usr/lib:/lib'
+	if test ia64 = "$host_cpu"; then
+	  hardcode_libdir_flag_spec='$wl-R $libdir:/usr/lib:/lib'
 	  allow_undefined_flag="-z nodefs"
-	  archive_expsym_cmds="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags ${wl}${allow_undefined_flag} '"\${wl}$exp_sym_flag:\$export_symbols"
+	  archive_expsym_cmds="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs '"\$wl$no_entry_flag"' $compiler_flags $wl$allow_undefined_flag '"\$wl$exp_sym_flag:\$export_symbols"
 	else
 	 # Determine the default libpath from the value encoded in an
 	 # empty executable.
-	 if test "${lt_cv_aix_libpath+set}" = set; then
+	 if test set = "${lt_cv_aix_libpath+set}"; then
   aix_libpath=$lt_cv_aix_libpath
 else
   if ${lt_cv_aix_libpath_+:} false; then :
@@ -13776,7 +14187,7 @@ fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
   if test -z "$lt_cv_aix_libpath_"; then
-    lt_cv_aix_libpath_="/usr/lib:/lib"
+    lt_cv_aix_libpath_=/usr/lib:/lib
   fi
 
 fi
@@ -13784,21 +14195,33 @@ fi
   aix_libpath=$lt_cv_aix_libpath_
 fi
 
-	 hardcode_libdir_flag_spec='${wl}-blibpath:$libdir:'"$aix_libpath"
+	 hardcode_libdir_flag_spec='$wl-blibpath:$libdir:'"$aix_libpath"
 	  # Warning - without using the other run time loading flags,
 	  # -berok will link without error, but may produce a broken library.
-	  no_undefined_flag=' ${wl}-bernotok'
-	  allow_undefined_flag=' ${wl}-berok'
-	  if test "$with_gnu_ld" = yes; then
+	  no_undefined_flag=' $wl-bernotok'
+	  allow_undefined_flag=' $wl-berok'
+	  if test yes = "$with_gnu_ld"; then
 	    # We only use this code for GNU lds that support --whole-archive.
-	    whole_archive_flag_spec='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
+	    whole_archive_flag_spec='$wl--whole-archive$convenience $wl--no-whole-archive'
 	  else
 	    # Exported symbols can be pulled into shared objects from archives
 	    whole_archive_flag_spec='$convenience'
 	  fi
 	  archive_cmds_need_lc=yes
-	  # This is similar to how AIX traditionally builds its shared libraries.
-	  archive_expsym_cmds="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs ${wl}-bnoentry $compiler_flags ${wl}-bE:$export_symbols${allow_undefined_flag}~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
+	  archive_expsym_cmds='$RM -r $output_objdir/$realname.d~$MKDIR $output_objdir/$realname.d'
+	  # -brtl affects multiple linker settings, -berok does not and is overridden later
+	  compiler_flags_filtered='`func_echo_all "$compiler_flags " | $SED -e "s%-brtl\\([, ]\\)%-berok\\1%g"`'
+	  if test svr4 != "$with_aix_soname"; then
+	    # This is similar to how AIX traditionally builds its shared libraries.
+	    archive_expsym_cmds="$archive_expsym_cmds"'~$CC '$shared_flag_aix' -o $output_objdir/$realname.d/$soname $libobjs $deplibs $wl-bnoentry '$compiler_flags_filtered'$wl-bE:$export_symbols$allow_undefined_flag~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$realname.d/$soname'
+	  fi
+	  if test aix != "$with_aix_soname"; then
+	    archive_expsym_cmds="$archive_expsym_cmds"'~$CC '$shared_flag_svr4' -o $output_objdir/$realname.d/$shared_archive_member_spec.o $libobjs $deplibs $wl-bnoentry '$compiler_flags_filtered'$wl-bE:$export_symbols$allow_undefined_flag~$STRIP -e $output_objdir/$realname.d/$shared_archive_member_spec.o~( func_echo_all "#! $soname($shared_archive_member_spec.o)"; if test shr_64 = "$shared_archive_member_spec"; then func_echo_all "# 64"; else func_echo_all "# 32"; fi; cat $export_symbols ) > $output_objdir/$realname.d/$shared_archive_member_spec.imp~$AR $AR_FLAGS $output_objdir/$soname $output_objdir/$realname.d/$shared_archive_member_spec.o $output_objdir/$realname.d/$shared_archive_member_spec.imp'
+	  else
+	    # used by -dlpreopen to get the symbols
+	    archive_expsym_cmds="$archive_expsym_cmds"'~$MV  $output_objdir/$realname.d/$soname $output_objdir'
+	  fi
+	  archive_expsym_cmds="$archive_expsym_cmds"'~$RM -r $output_objdir/$realname.d'
 	fi
       fi
       ;;
@@ -13807,7 +14230,7 @@ fi
       case $host_cpu in
       powerpc)
             # see comment about AmigaOS4 .so support
-            archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+            archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
             archive_expsym_cmds=''
         ;;
       m68k)
@@ -13837,35 +14260,37 @@ fi
 	# Tell ltmain to make .lib files, not .a files.
 	libext=lib
 	# Tell ltmain to make .dll files, not .so files.
-	shrext_cmds=".dll"
+	shrext_cmds=.dll
 	# FIXME: Setting linknames here is a bad hack.
-	archive_cmds='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-dll~linknames='
-	archive_expsym_cmds='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
-	    sed -n -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' -e '1\\\!p' < $export_symbols > $output_objdir/$soname.exp;
-	  else
-	    sed -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' < $export_symbols > $output_objdir/$soname.exp;
-	  fi~
-	  $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
-	  linknames='
+	archive_cmds='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~linknames='
+	archive_expsym_cmds='if   test DEF = "`$SED -n     -e '\''s/^[	 ]*//'\''     -e '\''/^\(;.*\)*$/d'\''     -e '\''s/^\(EXPORTS\|LIBRARY\)\([	 ].*\)*$/DEF/p'\''     -e q     $export_symbols`" ; then
+            cp "$export_symbols" "$output_objdir/$soname.def";
+            echo "$tool_output_objdir$soname.def" > "$output_objdir/$soname.exp";
+          else
+            $SED -e '\''s/^/-link -EXPORT:/'\'' < $export_symbols > $output_objdir/$soname.exp;
+          fi~
+          $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
+          linknames='
 	# The linker will not automatically build a static lib if we build a DLL.
 	# _LT_TAGVAR(old_archive_from_new_cmds, )='true'
 	enable_shared_with_static_runtimes=yes
+	exclude_expsyms='_NULL_IMPORT_DESCRIPTOR|_IMPORT_DESCRIPTOR_.*'
 	export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS][ ]/s/.*[ ]\([^ ]*\)/\1,DATA/'\'' | $SED -e '\''/^[AITW][ ]/s/.*[ ]//'\'' | sort | uniq > $export_symbols'
 	# Don't use ranlib
 	old_postinstall_cmds='chmod 644 $oldlib'
 	postlink_cmds='lt_outputfile="@OUTPUT@"~
-	  lt_tool_outputfile="@TOOL_OUTPUT@"~
-	  case $lt_outputfile in
-	    *.exe|*.EXE) ;;
-	    *)
-	      lt_outputfile="$lt_outputfile.exe"
-	      lt_tool_outputfile="$lt_tool_outputfile.exe"
-	      ;;
-	  esac~
-	  if test "$MANIFEST_TOOL" != ":" && test -f "$lt_outputfile.manifest"; then
-	    $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
-	    $RM "$lt_outputfile.manifest";
-	  fi'
+          lt_tool_outputfile="@TOOL_OUTPUT@"~
+          case $lt_outputfile in
+            *.exe|*.EXE) ;;
+            *)
+              lt_outputfile=$lt_outputfile.exe
+              lt_tool_outputfile=$lt_tool_outputfile.exe
+              ;;
+          esac~
+          if test : != "$MANIFEST_TOOL" && test -f "$lt_outputfile.manifest"; then
+            $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
+            $RM "$lt_outputfile.manifest";
+          fi'
 	;;
       *)
 	# Assume MSVC wrapper
@@ -13874,7 +14299,7 @@ fi
 	# Tell ltmain to make .lib files, not .a files.
 	libext=lib
 	# Tell ltmain to make .dll files, not .so files.
-	shrext_cmds=".dll"
+	shrext_cmds=.dll
 	# FIXME: Setting linknames here is a bad hack.
 	archive_cmds='$CC -o $lib $libobjs $compiler_flags `func_echo_all "$deplibs" | $SED '\''s/ -lc$//'\''` -link -dll~linknames='
 	# The linker will automatically build a .lib file if we build a DLL.
@@ -13893,23 +14318,24 @@ fi
   hardcode_direct=no
   hardcode_automatic=yes
   hardcode_shlibpath_var=unsupported
-  if test "$lt_cv_ld_force_load" = "yes"; then
-    whole_archive_flag_spec='`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience ${wl}-force_load,$conv\"; done; func_echo_all \"$new_convenience\"`'
+  if test yes = "$lt_cv_ld_force_load"; then
+    whole_archive_flag_spec='`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience $wl-force_load,$conv\"; done; func_echo_all \"$new_convenience\"`'
+
   else
     whole_archive_flag_spec=''
   fi
   link_all_deplibs=yes
-  allow_undefined_flag="$_lt_dar_allow_undefined"
+  allow_undefined_flag=$_lt_dar_allow_undefined
   case $cc_basename in
-     ifort*) _lt_dar_can_shared=yes ;;
+     ifort*|nagfor*) _lt_dar_can_shared=yes ;;
      *) _lt_dar_can_shared=$GCC ;;
   esac
-  if test "$_lt_dar_can_shared" = "yes"; then
+  if test yes = "$_lt_dar_can_shared"; then
     output_verbose_link_cmd=func_echo_all
-    archive_cmds="\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring $_lt_dar_single_mod${_lt_dsymutil}"
-    module_cmds="\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dsymutil}"
-    archive_expsym_cmds="sed 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring ${_lt_dar_single_mod}${_lt_dar_export_syms}${_lt_dsymutil}"
-    module_expsym_cmds="sed -e 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dar_export_syms}${_lt_dsymutil}"
+    archive_cmds="\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring $_lt_dar_single_mod$_lt_dsymutil"
+    module_cmds="\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags$_lt_dsymutil"
+    archive_expsym_cmds="sed 's|^|_|' < \$export_symbols > \$output_objdir/\$libname-symbols.expsym~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring $_lt_dar_single_mod$_lt_dar_export_syms$_lt_dsymutil"
+    module_expsym_cmds="sed -e 's|^|_|' < \$export_symbols > \$output_objdir/\$libname-symbols.expsym~\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags$_lt_dar_export_syms$_lt_dsymutil"
 
   else
   ld_shlibs=no
@@ -13923,10 +14349,6 @@ fi
       hardcode_shlibpath_var=no
       ;;
 
-    freebsd1*)
-      ld_shlibs=no
-      ;;
-
     # FreeBSD 2.2.[012] allows us to include c++rt0.o to get C++ constructor
     # support.  Future versions do this automatically, but an explicit c++rt0.o
     # does not break anything, and helps significantly (at the cost of a little
@@ -13939,7 +14361,7 @@ fi
       ;;
 
     # Unfortunately, older versions of FreeBSD 2 do not have this feature.
-    freebsd2*)
+    freebsd2.*)
       archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
       hardcode_direct=yes
       hardcode_minus_L=yes
@@ -13955,34 +14377,33 @@ fi
       ;;
 
     hpux9*)
-      if test "$GCC" = yes; then
-	archive_cmds='$RM $output_objdir/$soname~$CC -shared $pic_flag ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+      if test yes = "$GCC"; then
+	archive_cmds='$RM $output_objdir/$soname~$CC -shared $pic_flag $wl+b $wl$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test "x$output_objdir/$soname" = "x$lib" || mv $output_objdir/$soname $lib'
       else
-	archive_cmds='$RM $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+	archive_cmds='$RM $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test "x$output_objdir/$soname" = "x$lib" || mv $output_objdir/$soname $lib'
       fi
-      hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
+      hardcode_libdir_flag_spec='$wl+b $wl$libdir'
       hardcode_libdir_separator=:
       hardcode_direct=yes
 
       # hardcode_minus_L: Not really in the search PATH,
       # but as the default location of the library.
       hardcode_minus_L=yes
-      export_dynamic_flag_spec='${wl}-E'
+      export_dynamic_flag_spec='$wl-E'
       ;;
 
     hpux10*)
-      if test "$GCC" = yes && test "$with_gnu_ld" = no; then
-	archive_cmds='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+      if test yes,no = "$GCC,$with_gnu_ld"; then
+	archive_cmds='$CC -shared $pic_flag $wl+h $wl$soname $wl+b $wl$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
       else
 	archive_cmds='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'
       fi
-      if test "$with_gnu_ld" = no; then
-	hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
-	hardcode_libdir_flag_spec_ld='+b $libdir'
+      if test no = "$with_gnu_ld"; then
+	hardcode_libdir_flag_spec='$wl+b $wl$libdir'
 	hardcode_libdir_separator=:
 	hardcode_direct=yes
 	hardcode_direct_absolute=yes
-	export_dynamic_flag_spec='${wl}-E'
+	export_dynamic_flag_spec='$wl-E'
 	# hardcode_minus_L: Not really in the search PATH,
 	# but as the default location of the library.
 	hardcode_minus_L=yes
@@ -13990,25 +14411,25 @@ fi
       ;;
 
     hpux11*)
-      if test "$GCC" = yes && test "$with_gnu_ld" = no; then
+      if test yes,no = "$GCC,$with_gnu_ld"; then
 	case $host_cpu in
 	hppa*64*)
-	  archive_cmds='$CC -shared ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  archive_cmds='$CC -shared $wl+h $wl$soname -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	ia64*)
-	  archive_cmds='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
+	  archive_cmds='$CC -shared $pic_flag $wl+h $wl$soname $wl+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	*)
-	  archive_cmds='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+	  archive_cmds='$CC -shared $pic_flag $wl+h $wl$soname $wl+b $wl$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	esac
       else
 	case $host_cpu in
 	hppa*64*)
-	  archive_cmds='$CC -b ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  archive_cmds='$CC -b $wl+h $wl$soname -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	ia64*)
-	  archive_cmds='$CC -b ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
+	  archive_cmds='$CC -b $wl+h $wl$soname $wl+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	*)
 
@@ -14020,7 +14441,7 @@ if ${lt_cv_prog_compiler__b+:} false; th
   $as_echo_n "(cached) " >&6
 else
   lt_cv_prog_compiler__b=no
-   save_LDFLAGS="$LDFLAGS"
+   save_LDFLAGS=$LDFLAGS
    LDFLAGS="$LDFLAGS -b"
    echo "$lt_simple_link_test_code" > conftest.$ac_ext
    if (eval $ac_link 2>conftest.err) && test -s conftest$ac_exeext; then
@@ -14039,14 +14460,14 @@ else
      fi
    fi
    $RM -r conftest*
-   LDFLAGS="$save_LDFLAGS"
+   LDFLAGS=$save_LDFLAGS
 
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler__b" >&5
 $as_echo "$lt_cv_prog_compiler__b" >&6; }
 
-if test x"$lt_cv_prog_compiler__b" = xyes; then
-    archive_cmds='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+if test yes = "$lt_cv_prog_compiler__b"; then
+    archive_cmds='$CC -b $wl+h $wl$soname $wl+b $wl$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
 else
     archive_cmds='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'
 fi
@@ -14054,8 +14475,8 @@ fi
 	  ;;
 	esac
       fi
-      if test "$with_gnu_ld" = no; then
-	hardcode_libdir_flag_spec='${wl}+b ${wl}$libdir'
+      if test no = "$with_gnu_ld"; then
+	hardcode_libdir_flag_spec='$wl+b $wl$libdir'
 	hardcode_libdir_separator=:
 
 	case $host_cpu in
@@ -14066,7 +14487,7 @@ fi
 	*)
 	  hardcode_direct=yes
 	  hardcode_direct_absolute=yes
-	  export_dynamic_flag_spec='${wl}-E'
+	  export_dynamic_flag_spec='$wl-E'
 
 	  # hardcode_minus_L: Not really in the search PATH,
 	  # but as the default location of the library.
@@ -14077,8 +14498,8 @@ fi
       ;;
 
     irix5* | irix6* | nonstopux*)
-      if test "$GCC" = yes; then
-	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+      if test yes = "$GCC"; then
+	archive_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname `test -n "$verstring" && func_echo_all "$wl-set_version $wl$verstring"` $wl-update_registry $wl$output_objdir/so_locations -o $lib'
 	# Try to use the -exported_symbol ld option, if it does not
 	# work, assume that -exports_file does not work either and
 	# implicitly export all symbols.
@@ -14088,8 +14509,8 @@ $as_echo_n "checking whether the $host_o
 if ${lt_cv_irix_exported_symbol+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  save_LDFLAGS="$LDFLAGS"
-	   LDFLAGS="$LDFLAGS -shared ${wl}-exported_symbol ${wl}foo ${wl}-update_registry ${wl}/dev/null"
+  save_LDFLAGS=$LDFLAGS
+	   LDFLAGS="$LDFLAGS -shared $wl-exported_symbol ${wl}foo $wl-update_registry $wl/dev/null"
 	   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 int foo (void) { return 0; }
@@ -14101,24 +14522,34 @@ else
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
-           LDFLAGS="$save_LDFLAGS"
+           LDFLAGS=$save_LDFLAGS
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_irix_exported_symbol" >&5
 $as_echo "$lt_cv_irix_exported_symbol" >&6; }
-	if test "$lt_cv_irix_exported_symbol" = yes; then
-          archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations ${wl}-exports_file ${wl}$export_symbols -o $lib'
+	if test yes = "$lt_cv_irix_exported_symbol"; then
+          archive_expsym_cmds='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname `test -n "$verstring" && func_echo_all "$wl-set_version $wl$verstring"` $wl-update_registry $wl$output_objdir/so_locations $wl-exports_file $wl$export_symbols -o $lib'
 	fi
       else
-	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
-	archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -exports_file $export_symbols -o $lib'
+	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry $output_objdir/so_locations -o $lib'
+	archive_expsym_cmds='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry $output_objdir/so_locations -exports_file $export_symbols -o $lib'
       fi
       archive_cmds_need_lc='no'
-      hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
+      hardcode_libdir_flag_spec='$wl-rpath $wl$libdir'
       hardcode_libdir_separator=:
       inherit_rpath=yes
       link_all_deplibs=yes
       ;;
 
+    linux*)
+      case $cc_basename in
+      tcc*)
+	# Fabrice Bellard et al's Tiny C Compiler
+	ld_shlibs=yes
+	archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
+	;;
+      esac
+      ;;
+
     netbsd*)
       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
 	archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
@@ -14133,7 +14564,7 @@ $as_echo "$lt_cv_irix_exported_symbol" >
     newsos6)
       archive_cmds='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
       hardcode_direct=yes
-      hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
+      hardcode_libdir_flag_spec='$wl-rpath $wl$libdir'
       hardcode_libdir_separator=:
       hardcode_shlibpath_var=no
       ;;
@@ -14141,27 +14572,19 @@ $as_echo "$lt_cv_irix_exported_symbol" >
     *nto* | *qnx*)
       ;;
 
-    openbsd*)
+    openbsd* | bitrig*)
       if test -f /usr/libexec/ld.so; then
 	hardcode_direct=yes
 	hardcode_shlibpath_var=no
 	hardcode_direct_absolute=yes
-	if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+	if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`"; then
 	  archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
-	  archive_expsym_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-retain-symbols-file,$export_symbols'
-	  hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
-	  export_dynamic_flag_spec='${wl}-E'
+	  archive_expsym_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags $wl-retain-symbols-file,$export_symbols'
+	  hardcode_libdir_flag_spec='$wl-rpath,$libdir'
+	  export_dynamic_flag_spec='$wl-E'
 	else
-	  case $host_os in
-	   openbsd[01].* | openbsd2.[0-7] | openbsd2.[0-7].*)
-	     archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
-	     hardcode_libdir_flag_spec='-R$libdir'
-	     ;;
-	   *)
-	     archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
-	     hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
-	     ;;
-	  esac
+	  archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
+	  hardcode_libdir_flag_spec='$wl-rpath,$libdir'
 	fi
       else
 	ld_shlibs=no
@@ -14172,33 +14595,53 @@ $as_echo "$lt_cv_irix_exported_symbol" >
       hardcode_libdir_flag_spec='-L$libdir'
       hardcode_minus_L=yes
       allow_undefined_flag=unsupported
-      archive_cmds='$ECHO "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~echo DATA >> $output_objdir/$libname.def~echo " SINGLE NONSHARED" >> $output_objdir/$libname.def~echo EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
-      old_archive_from_new_cmds='emximp -o $output_objdir/$libname.a $output_objdir/$libname.def'
+      shrext_cmds=.dll
+      archive_cmds='$ECHO "LIBRARY ${soname%$shared_ext} INITINSTANCE TERMINSTANCE" > $output_objdir/$libname.def~
+	$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~
+	$ECHO "DATA MULTIPLE NONSHARED" >> $output_objdir/$libname.def~
+	$ECHO EXPORTS >> $output_objdir/$libname.def~
+	emxexp $libobjs | $SED /"_DLL_InitTerm"/d >> $output_objdir/$libname.def~
+	$CC -Zdll -Zcrtdll -o $output_objdir/$soname $libobjs $deplibs $compiler_flags $output_objdir/$libname.def~
+	emximp -o $lib $output_objdir/$libname.def'
+      archive_expsym_cmds='$ECHO "LIBRARY ${soname%$shared_ext} INITINSTANCE TERMINSTANCE" > $output_objdir/$libname.def~
+	$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~
+	$ECHO "DATA MULTIPLE NONSHARED" >> $output_objdir/$libname.def~
+	$ECHO EXPORTS >> $output_objdir/$libname.def~
+	prefix_cmds="$SED"~
+	if test EXPORTS = "`$SED 1q $export_symbols`"; then
+	  prefix_cmds="$prefix_cmds -e 1d";
+	fi~
+	prefix_cmds="$prefix_cmds -e \"s/^\(.*\)$/_\1/g\""~
+	cat $export_symbols | $prefix_cmds >> $output_objdir/$libname.def~
+	$CC -Zdll -Zcrtdll -o $output_objdir/$soname $libobjs $deplibs $compiler_flags $output_objdir/$libname.def~
+	emximp -o $lib $output_objdir/$libname.def'
+      old_archive_From_new_cmds='emximp -o $output_objdir/${libname}_dll.a $output_objdir/$libname.def'
+      enable_shared_with_static_runtimes=yes
       ;;
 
     osf3*)
-      if test "$GCC" = yes; then
-	allow_undefined_flag=' ${wl}-expect_unresolved ${wl}\*'
-	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+      if test yes = "$GCC"; then
+	allow_undefined_flag=' $wl-expect_unresolved $wl\*'
+	archive_cmds='$CC -shared$allow_undefined_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname `test -n "$verstring" && func_echo_all "$wl-set_version $wl$verstring"` $wl-update_registry $wl$output_objdir/so_locations -o $lib'
       else
 	allow_undefined_flag=' -expect_unresolved \*'
-	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+	archive_cmds='$CC -shared$allow_undefined_flag $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry $output_objdir/so_locations -o $lib'
       fi
       archive_cmds_need_lc='no'
-      hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
+      hardcode_libdir_flag_spec='$wl-rpath $wl$libdir'
       hardcode_libdir_separator=:
       ;;
 
     osf4* | osf5*)	# as osf3* with the addition of -msym flag
-      if test "$GCC" = yes; then
-	allow_undefined_flag=' ${wl}-expect_unresolved ${wl}\*'
-	archive_cmds='$CC -shared${allow_undefined_flag} $pic_flag $libobjs $deplibs $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
-	hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
+      if test yes = "$GCC"; then
+	allow_undefined_flag=' $wl-expect_unresolved $wl\*'
+	archive_cmds='$CC -shared$allow_undefined_flag $pic_flag $libobjs $deplibs $compiler_flags $wl-msym $wl-soname $wl$soname `test -n "$verstring" && func_echo_all "$wl-set_version $wl$verstring"` $wl-update_registry $wl$output_objdir/so_locations -o $lib'
+	hardcode_libdir_flag_spec='$wl-rpath $wl$libdir'
       else
 	allow_undefined_flag=' -expect_unresolved \*'
-	archive_cmds='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+	archive_cmds='$CC -shared$allow_undefined_flag $libobjs $deplibs $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry $output_objdir/so_locations -o $lib'
 	archive_expsym_cmds='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done; printf "%s\\n" "-hidden">> $lib.exp~
-	$CC -shared${allow_undefined_flag} ${wl}-input ${wl}$lib.exp $compiler_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib~$RM $lib.exp'
+          $CC -shared$allow_undefined_flag $wl-input $wl$lib.exp $compiler_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry $output_objdir/so_locations -o $lib~$RM $lib.exp'
 
 	# Both c and cxx compiler support -rpath directly
 	hardcode_libdir_flag_spec='-rpath $libdir'
@@ -14209,24 +14652,24 @@ $as_echo "$lt_cv_irix_exported_symbol" >
 
     solaris*)
       no_undefined_flag=' -z defs'
-      if test "$GCC" = yes; then
-	wlarc='${wl}'
-	archive_cmds='$CC -shared $pic_flag ${wl}-z ${wl}text ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
+      if test yes = "$GCC"; then
+	wlarc='$wl'
+	archive_cmds='$CC -shared $pic_flag $wl-z ${wl}text $wl-h $wl$soname -o $lib $libobjs $deplibs $compiler_flags'
 	archive_expsym_cmds='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-	  $CC -shared $pic_flag ${wl}-z ${wl}text ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
+          $CC -shared $pic_flag $wl-z ${wl}text $wl-M $wl$lib.exp $wl-h $wl$soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
       else
 	case `$CC -V 2>&1` in
 	*"Compilers 5.0"*)
 	  wlarc=''
-	  archive_cmds='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
+	  archive_cmds='$LD -G$allow_undefined_flag -h $soname -o $lib $libobjs $deplibs $linker_flags'
 	  archive_expsym_cmds='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-	  $LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$RM $lib.exp'
+            $LD -G$allow_undefined_flag -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$RM $lib.exp'
 	  ;;
 	*)
-	  wlarc='${wl}'
-	  archive_cmds='$CC -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $compiler_flags'
+	  wlarc='$wl'
+	  archive_cmds='$CC -G$allow_undefined_flag -h $soname -o $lib $libobjs $deplibs $compiler_flags'
 	  archive_expsym_cmds='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-	  $CC -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
+            $CC -G$allow_undefined_flag -M $lib.exp -h $soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
 	  ;;
 	esac
       fi
@@ -14236,11 +14679,11 @@ $as_echo "$lt_cv_irix_exported_symbol" >
       solaris2.[0-5] | solaris2.[0-5].*) ;;
       *)
 	# The compiler driver will combine and reorder linker options,
-	# but understands `-z linker_flag'.  GCC discards it without `$wl',
+	# but understands '-z linker_flag'.  GCC discards it without '$wl',
 	# but is careful enough not to reorder.
 	# Supported since Solaris 2.6 (maybe 2.5.1?)
-	if test "$GCC" = yes; then
-	  whole_archive_flag_spec='${wl}-z ${wl}allextract$convenience ${wl}-z ${wl}defaultextract'
+	if test yes = "$GCC"; then
+	  whole_archive_flag_spec='$wl-z ${wl}allextract$convenience $wl-z ${wl}defaultextract'
 	else
 	  whole_archive_flag_spec='-z allextract$convenience -z defaultextract'
 	fi
@@ -14250,10 +14693,10 @@ $as_echo "$lt_cv_irix_exported_symbol" >
       ;;
 
     sunos4*)
-      if test "x$host_vendor" = xsequent; then
+      if test sequent = "$host_vendor"; then
 	# Use $CC to link under sequent, because it throws in some extra .o
 	# files that make .init and .fini sections work.
-	archive_cmds='$CC -G ${wl}-h $soname -o $lib $libobjs $deplibs $compiler_flags'
+	archive_cmds='$CC -G $wl-h $soname -o $lib $libobjs $deplibs $compiler_flags'
       else
 	archive_cmds='$LD -assert pure-text -Bstatic -o $lib $libobjs $deplibs $linker_flags'
       fi
@@ -14302,43 +14745,43 @@ $as_echo "$lt_cv_irix_exported_symbol" >
       ;;
 
     sysv4*uw2* | sysv5OpenUNIX* | sysv5UnixWare7.[01].[10]* | unixware7* | sco3.2v5.0.[024]*)
-      no_undefined_flag='${wl}-z,text'
+      no_undefined_flag='$wl-z,text'
       archive_cmds_need_lc=no
       hardcode_shlibpath_var=no
       runpath_var='LD_RUN_PATH'
 
-      if test "$GCC" = yes; then
-	archive_cmds='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds='$CC -shared ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+      if test yes = "$GCC"; then
+	archive_cmds='$CC -shared $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	archive_expsym_cmds='$CC -shared $wl-Bexport:$export_symbols $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
       else
-	archive_cmds='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	archive_cmds='$CC -G $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	archive_expsym_cmds='$CC -G $wl-Bexport:$export_symbols $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
       fi
       ;;
 
     sysv5* | sco3.2v5* | sco5v6*)
-      # Note: We can NOT use -z defs as we might desire, because we do not
+      # Note: We CANNOT use -z defs as we might desire, because we do not
       # link with -lc, and that would cause any symbols used from libc to
       # always be unresolved, which means just about no library would
       # ever link correctly.  If we're not using GNU ld we use -z text
       # though, which does catch some bad symbols but isn't as heavy-handed
       # as -z defs.
-      no_undefined_flag='${wl}-z,text'
-      allow_undefined_flag='${wl}-z,nodefs'
+      no_undefined_flag='$wl-z,text'
+      allow_undefined_flag='$wl-z,nodefs'
       archive_cmds_need_lc=no
       hardcode_shlibpath_var=no
-      hardcode_libdir_flag_spec='${wl}-R,$libdir'
+      hardcode_libdir_flag_spec='$wl-R,$libdir'
       hardcode_libdir_separator=':'
       link_all_deplibs=yes
-      export_dynamic_flag_spec='${wl}-Bexport'
+      export_dynamic_flag_spec='$wl-Bexport'
       runpath_var='LD_RUN_PATH'
 
-      if test "$GCC" = yes; then
-	archive_cmds='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds='$CC -shared ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+      if test yes = "$GCC"; then
+	archive_cmds='$CC -shared $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	archive_expsym_cmds='$CC -shared $wl-Bexport:$export_symbols $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
       else
-	archive_cmds='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	archive_expsym_cmds='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	archive_cmds='$CC -G $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	archive_expsym_cmds='$CC -G $wl-Bexport:$export_symbols $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
       fi
       ;;
 
@@ -14353,10 +14796,10 @@ $as_echo "$lt_cv_irix_exported_symbol" >
       ;;
     esac
 
-    if test x$host_vendor = xsni; then
+    if test sni = "$host_vendor"; then
       case $host in
       sysv4 | sysv4.2uw2* | sysv4.3* | sysv5*)
-	export_dynamic_flag_spec='${wl}-Blargedynsym'
+	export_dynamic_flag_spec='$wl-Blargedynsym'
 	;;
       esac
     fi
@@ -14364,7 +14807,7 @@ $as_echo "$lt_cv_irix_exported_symbol" >
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ld_shlibs" >&5
 $as_echo "$ld_shlibs" >&6; }
-test "$ld_shlibs" = no && can_build_shared=no
+test no = "$ld_shlibs" && can_build_shared=no
 
 with_gnu_ld=$with_gnu_ld
 
@@ -14390,7 +14833,7 @@ x|xyes)
   # Assume -lc should be added
   archive_cmds_need_lc=yes
 
-  if test "$enable_shared" = yes && test "$GCC" = yes; then
+  if test yes,yes = "$GCC,$enable_shared"; then
     case $archive_cmds in
     *'~'*)
       # FIXME: we may have to deal with multi-command sequences.
@@ -14602,22 +15045,17 @@ esac
 
 
 
-
-
-
-
-
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking dynamic linker characteristics" >&5
 $as_echo_n "checking dynamic linker characteristics... " >&6; }
 
-if test "$GCC" = yes; then
+if test yes = "$GCC"; then
   case $host_os in
-    darwin*) lt_awk_arg="/^libraries:/,/LR/" ;;
-    *) lt_awk_arg="/^libraries:/" ;;
+    darwin*) lt_awk_arg='/^libraries:/,/LR/' ;;
+    *) lt_awk_arg='/^libraries:/' ;;
   esac
   case $host_os in
-    mingw* | cegcc*) lt_sed_strip_eq="s,=\([A-Za-z]:\),\1,g" ;;
-    *) lt_sed_strip_eq="s,=/,/,g" ;;
+    mingw* | cegcc*) lt_sed_strip_eq='s|=\([A-Za-z]:\)|\1|g' ;;
+    *) lt_sed_strip_eq='s|=/|/|g' ;;
   esac
   lt_search_path_spec=`$CC -print-search-dirs | awk $lt_awk_arg | $SED -e "s/^libraries://" -e $lt_sed_strip_eq`
   case $lt_search_path_spec in
@@ -14633,28 +15071,35 @@ if test "$GCC" = yes; then
     ;;
   esac
   # Ok, now we have the path, separated by spaces, we can step through it
-  # and add multilib dir if necessary.
+  # and add multilib dir if necessary...
   lt_tmp_lt_search_path_spec=
-  lt_multi_os_dir=`$CC $CPPFLAGS $CFLAGS $LDFLAGS -print-multi-os-directory 2>/dev/null`
+  lt_multi_os_dir=/`$CC $CPPFLAGS $CFLAGS $LDFLAGS -print-multi-os-directory 2>/dev/null`
+  # ...but if some path component already ends with the multilib dir we assume
+  # that all is fine and trust -print-search-dirs as is (GCC 4.2? or newer).
+  case "$lt_multi_os_dir; $lt_search_path_spec " in
+  "/; "* | "/.; "* | "/./; "* | *"$lt_multi_os_dir "* | *"$lt_multi_os_dir/ "*)
+    lt_multi_os_dir=
+    ;;
+  esac
   for lt_sys_path in $lt_search_path_spec; do
-    if test -d "$lt_sys_path/$lt_multi_os_dir"; then
-      lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path/$lt_multi_os_dir"
-    else
+    if test -d "$lt_sys_path$lt_multi_os_dir"; then
+      lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path$lt_multi_os_dir"
+    elif test -n "$lt_multi_os_dir"; then
       test -d "$lt_sys_path" && \
 	lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path"
     fi
   done
   lt_search_path_spec=`$ECHO "$lt_tmp_lt_search_path_spec" | awk '
-BEGIN {RS=" "; FS="/|\n";} {
-  lt_foo="";
-  lt_count=0;
+BEGIN {RS = " "; FS = "/|\n";} {
+  lt_foo = "";
+  lt_count = 0;
   for (lt_i = NF; lt_i > 0; lt_i--) {
     if ($lt_i != "" && $lt_i != ".") {
       if ($lt_i == "..") {
         lt_count++;
       } else {
         if (lt_count == 0) {
-          lt_foo="/" $lt_i lt_foo;
+          lt_foo = "/" $lt_i lt_foo;
         } else {
           lt_count--;
         }
@@ -14668,7 +15113,7 @@ BEGIN {RS=" "; FS="/|\n";} {
   # for these hosts.
   case $host_os in
     mingw* | cegcc*) lt_search_path_spec=`$ECHO "$lt_search_path_spec" |\
-      $SED 's,/\([A-Za-z]:\),\1,g'` ;;
+      $SED 's|/\([A-Za-z]:\)|\1|g'` ;;
   esac
   sys_lib_search_path_spec=`$ECHO "$lt_search_path_spec" | $lt_NL2SP`
 else
@@ -14677,7 +15122,7 @@ fi
 library_names_spec=
 libname_spec='lib$name'
 soname_spec=
-shrext_cmds=".so"
+shrext_cmds=.so
 postinstall_cmds=
 postuninstall_cmds=
 finish_cmds=
@@ -14694,56 +15139,108 @@ hardcode_into_libs=no
 # flags to be left without arguments
 need_version=unknown
 
+
+
 case $host_os in
 aix3*)
-  version_type=linux
-  library_names_spec='${libname}${release}${shared_ext}$versuffix $libname.a'
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='$libname$release$shared_ext$versuffix $libname.a'
   shlibpath_var=LIBPATH
 
   # AIX 3 has no versioning support, so we append a major version to the name.
-  soname_spec='${libname}${release}${shared_ext}$major'
+  soname_spec='$libname$release$shared_ext$major'
   ;;
 
 aix[4-9]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   hardcode_into_libs=yes
-  if test "$host_cpu" = ia64; then
+  if test ia64 = "$host_cpu"; then
     # AIX 5 supports IA64
-    library_names_spec='${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext}$versuffix $libname${shared_ext}'
+    library_names_spec='$libname$release$shared_ext$major $libname$release$shared_ext$versuffix $libname$shared_ext'
     shlibpath_var=LD_LIBRARY_PATH
   else
     # With GCC up to 2.95.x, collect2 would create an import file
     # for dependence libraries.  The import file would start with
-    # the line `#! .'.  This would cause the generated library to
-    # depend on `.', always an invalid library.  This was fixed in
+    # the line '#! .'.  This would cause the generated library to
+    # depend on '.', always an invalid library.  This was fixed in
     # development snapshots of GCC prior to 3.0.
     case $host_os in
       aix4 | aix4.[01] | aix4.[01].*)
       if { echo '#if __GNUC__ > 2 || (__GNUC__ == 2 && __GNUC_MINOR__ >= 97)'
 	   echo ' yes '
-	   echo '#endif'; } | ${CC} -E - | $GREP yes > /dev/null; then
+	   echo '#endif'; } | $CC -E - | $GREP yes > /dev/null; then
 	:
       else
 	can_build_shared=no
       fi
       ;;
     esac
-    # AIX (on Power*) has no versioning support, so currently we can not hardcode correct
+    # Using Import Files as archive members, it is possible to support
+    # filename-based versioning of shared library archives on AIX. While
+    # this would work for both with and without runtime linking, it will
+    # prevent static linking of such archives. So we do filename-based
+    # shared library versioning with .so extension only, which is used
+    # when both runtime linking and shared linking is enabled.
+    # Unfortunately, runtime linking may impact performance, so we do
+    # not want this to be the default eventually. Also, we use the
+    # versioned .so libs for executables only if there is the -brtl
+    # linker flag in LDFLAGS as well, or --with-aix-soname=svr4 only.
+    # To allow for filename-based versioning support, we need to create
+    # libNAME.so.V as an archive file, containing:
+    # *) an Import File, referring to the versioned filename of the
+    #    archive as well as the shared archive member, telling the
+    #    bitwidth (32 or 64) of that shared object, and providing the
+    #    list of exported symbols of that shared object, eventually
+    #    decorated with the 'weak' keyword
+    # *) the shared object with the F_LOADONLY flag set, to really avoid
+    #    it being seen by the linker.
+    # At run time we better use the real file rather than another symlink,
+    # but for link time we create the symlink libNAME.so -> libNAME.so.V
+
+    case $with_aix_soname,$aix_use_runtimelinking in
+    # AIX (on Power*) has no versioning support, so currently we cannot hardcode correct
     # soname into executable. Probably we can add versioning support to
     # collect2, so additional links can be useful in future.
-    if test "$aix_use_runtimelinking" = yes; then
+    aix,yes) # traditional libtool
+      dynamic_linker='AIX unversionable lib.so'
       # If using run time linking (on AIX 4.2 or later) use lib<name>.so
       # instead of lib<name>.a to let people know that these are not
       # typical AIX shared libraries.
-      library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-    else
+      library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+      ;;
+    aix,no) # traditional AIX only
+      dynamic_linker='AIX lib.a(lib.so.V)'
       # We preserve .a as extension for shared libraries through AIX4.2
       # and later when we are not doing run time linking.
-      library_names_spec='${libname}${release}.a $libname.a'
-      soname_spec='${libname}${release}${shared_ext}$major'
-    fi
+      library_names_spec='$libname$release.a $libname.a'
+      soname_spec='$libname$release$shared_ext$major'
+      ;;
+    svr4,*) # full svr4 only
+      dynamic_linker="AIX lib.so.V($shared_archive_member_spec.o)"
+      library_names_spec='$libname$release$shared_ext$major $libname$shared_ext'
+      # We do not specify a path in Import Files, so LIBPATH fires.
+      shlibpath_overrides_runpath=yes
+      ;;
+    *,yes) # both, prefer svr4
+      dynamic_linker="AIX lib.so.V($shared_archive_member_spec.o), lib.a(lib.so.V)"
+      library_names_spec='$libname$release$shared_ext$major $libname$shared_ext'
+      # unpreferred sharedlib libNAME.a needs extra handling
+      postinstall_cmds='test -n "$linkname" || linkname="$realname"~func_stripname "" ".so" "$linkname"~$install_shared_prog "$dir/$func_stripname_result.$libext" "$destdir/$func_stripname_result.$libext"~test -z "$tstripme" || test -z "$striplib" || $striplib "$destdir/$func_stripname_result.$libext"'
+      postuninstall_cmds='for n in $library_names $old_library; do :; done~func_stripname "" ".so" "$n"~test "$func_stripname_result" = "$n" || func_append rmfiles " $odir/$func_stripname_result.$libext"'
+      # We do not specify a path in Import Files, so LIBPATH fires.
+      shlibpath_overrides_runpath=yes
+      ;;
+    *,no) # both, prefer aix
+      dynamic_linker="AIX lib.a(lib.so.V), lib.so.V($shared_archive_member_spec.o)"
+      library_names_spec='$libname$release.a $libname.a'
+      soname_spec='$libname$release$shared_ext$major'
+      # unpreferred sharedlib libNAME.so.V and symlink libNAME.so need extra handling
+      postinstall_cmds='test -z "$dlname" || $install_shared_prog $dir/$dlname $destdir/$dlname~test -z "$tstripme" || test -z "$striplib" || $striplib $destdir/$dlname~test -n "$linkname" || linkname=$realname~func_stripname "" ".a" "$linkname"~(cd "$destdir" && $LN_S -f $dlname $func_stripname_result.so)'
+      postuninstall_cmds='test -z "$dlname" || func_append rmfiles " $odir/$dlname"~for n in $old_library $library_names; do :; done~func_stripname "" ".a" "$n"~func_append rmfiles " $odir/$func_stripname_result.so"'
+      ;;
+    esac
     shlibpath_var=LIBPATH
   fi
   ;;
@@ -14753,27 +15250,27 @@ amigaos*)
   powerpc)
     # Since July 2007 AmigaOS4 officially supports .so libraries.
     # When compiling the executable, add -use-dynld -Lsobjs: to the compileline.
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+    library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
     ;;
   m68k)
     library_names_spec='$libname.ixlibrary $libname.a'
     # Create ${libname}_ixlibrary.a entries in /sys/libs.
-    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`func_echo_all "$lib" | $SED '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
+    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`func_echo_all "$lib" | $SED '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
     ;;
   esac
   ;;
 
 beos*)
-  library_names_spec='${libname}${shared_ext}'
+  library_names_spec='$libname$shared_ext'
   dynamic_linker="$host_os ld.so"
   shlibpath_var=LIBRARY_PATH
   ;;
 
 bsdi[45]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   finish_cmds='PATH="\$PATH:/sbin" ldconfig $libdir'
   shlibpath_var=LD_LIBRARY_PATH
   sys_lib_search_path_spec="/shlib /usr/lib /usr/X11/lib /usr/contrib/lib /lib /usr/local/lib"
@@ -14785,7 +15282,7 @@ bsdi[45]*)
 
 cygwin* | mingw* | pw32* | cegcc*)
   version_type=windows
-  shrext_cmds=".dll"
+  shrext_cmds=.dll
   need_version=no
   need_lib_prefix=no
 
@@ -14794,8 +15291,8 @@ cygwin* | mingw* | pw32* | cegcc*)
     # gcc
     library_names_spec='$libname.dll.a'
     # DLL is installed to $(libdir)/../bin by postinstall_cmds
-    postinstall_cmds='base_file=`basename \${file}`~
-      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
+    postinstall_cmds='base_file=`basename \$file`~
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\$base_file'\''i; echo \$dlname'\''`~
       dldir=$destdir/`dirname \$dlpath`~
       test -d \$dldir || mkdir -p \$dldir~
       $install_prog $dir/$dlname \$dldir/$dlname~
@@ -14811,17 +15308,17 @@ cygwin* | mingw* | pw32* | cegcc*)
     case $host_os in
     cygwin*)
       # Cygwin DLLs use 'cyg' prefix rather than 'lib'
-      soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+      soname_spec='`echo $libname | sed -e 's/^lib/cyg/'``echo $release | $SED -e 's/[.]/-/g'`$versuffix$shared_ext'
 
       sys_lib_search_path_spec="$sys_lib_search_path_spec /usr/lib/w32api"
       ;;
     mingw* | cegcc*)
       # MinGW DLLs use traditional 'lib' prefix
-      soname_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+      soname_spec='$libname`echo $release | $SED -e 's/[.]/-/g'`$versuffix$shared_ext'
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
-      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+      library_names_spec='`echo $libname | sed -e 's/^lib/pw/'``echo $release | $SED -e 's/[.]/-/g'`$versuffix$shared_ext'
       ;;
     esac
     dynamic_linker='Win32 ld.exe'
@@ -14830,8 +15327,8 @@ cygwin* | mingw* | pw32* | cegcc*)
   *,cl*)
     # Native MSVC
     libname_spec='$name'
-    soname_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
-    library_names_spec='${libname}.dll.lib'
+    soname_spec='$libname`echo $release | $SED -e 's/[.]/-/g'`$versuffix$shared_ext'
+    library_names_spec='$libname.dll.lib'
 
     case $build_os in
     mingw*)
@@ -14858,7 +15355,7 @@ cygwin* | mingw* | pw32* | cegcc*)
       sys_lib_search_path_spec=`cygpath --path --unix "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
       ;;
     *)
-      sys_lib_search_path_spec="$LIB"
+      sys_lib_search_path_spec=$LIB
       if $ECHO "$sys_lib_search_path_spec" | $GREP ';[c-zC-Z]:/' >/dev/null; then
         # It is most probably a Windows format PATH.
         sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
@@ -14871,8 +15368,8 @@ cygwin* | mingw* | pw32* | cegcc*)
     esac
 
     # DLL is installed to $(libdir)/../bin by postinstall_cmds
-    postinstall_cmds='base_file=`basename \${file}`~
-      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
+    postinstall_cmds='base_file=`basename \$file`~
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\$base_file'\''i; echo \$dlname'\''`~
       dldir=$destdir/`dirname \$dlpath`~
       test -d \$dldir || mkdir -p \$dldir~
       $install_prog $dir/$dlname \$dldir/$dlname'
@@ -14885,7 +15382,7 @@ cygwin* | mingw* | pw32* | cegcc*)
 
   *)
     # Assume MSVC wrapper
-    library_names_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext} $libname.lib'
+    library_names_spec='$libname`echo $release | $SED -e 's/[.]/-/g'`$versuffix$shared_ext $libname.lib'
     dynamic_linker='Win32 ld.exe'
     ;;
   esac
@@ -14898,8 +15395,8 @@ darwin* | rhapsody*)
   version_type=darwin
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${major}$shared_ext ${libname}$shared_ext'
-  soname_spec='${libname}${release}${major}$shared_ext'
+  library_names_spec='$libname$release$major$shared_ext $libname$shared_ext'
+  soname_spec='$libname$release$major$shared_ext'
   shlibpath_overrides_runpath=yes
   shlibpath_var=DYLD_LIBRARY_PATH
   shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
@@ -14909,18 +15406,14 @@ darwin* | rhapsody*)
   ;;
 
 dgux*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname$shared_ext'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   shlibpath_var=LD_LIBRARY_PATH
   ;;
 
-freebsd1*)
-  dynamic_linker=no
-  ;;
-
 freebsd* | dragonfly*)
   # DragonFly does not have aout.  When/if they implement a new
   # versioning mechanism, adjust this.
@@ -14928,25 +15421,26 @@ freebsd* | dragonfly*)
     objformat=`/usr/bin/objformat`
   else
     case $host_os in
-    freebsd[123]*) objformat=aout ;;
+    freebsd[23].*) objformat=aout ;;
     *) objformat=elf ;;
     esac
   fi
   version_type=freebsd-$objformat
   case $version_type in
     freebsd-elf*)
-      library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext} $libname${shared_ext}'
+      library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+      soname_spec='$libname$release$shared_ext$major'
       need_version=no
       need_lib_prefix=no
       ;;
     freebsd-*)
-      library_names_spec='${libname}${release}${shared_ext}$versuffix $libname${shared_ext}$versuffix'
+      library_names_spec='$libname$release$shared_ext$versuffix $libname$shared_ext$versuffix'
       need_version=yes
       ;;
   esac
   shlibpath_var=LD_LIBRARY_PATH
   case $host_os in
-  freebsd2*)
+  freebsd2.*)
     shlibpath_overrides_runpath=yes
     ;;
   freebsd3.[01]* | freebsdelf3.[01]*)
@@ -14965,25 +15459,15 @@ freebsd* | dragonfly*)
   esac
   ;;
 
-gnu*)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  hardcode_into_libs=yes
-  ;;
-
 haiku*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   dynamic_linker="$host_os runtime_loader"
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   shlibpath_var=LIBRARY_PATH
-  shlibpath_overrides_runpath=yes
+  shlibpath_overrides_runpath=no
   sys_lib_dlsearch_path_spec='/boot/home/config/lib /boot/common/lib /boot/system/lib'
   hardcode_into_libs=yes
   ;;
@@ -15001,14 +15485,15 @@ hpux9* | hpux10* | hpux11*)
     dynamic_linker="$host_os dld.so"
     shlibpath_var=LD_LIBRARY_PATH
     shlibpath_overrides_runpath=yes # Unless +noenvvar is specified.
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-    soname_spec='${libname}${release}${shared_ext}$major'
-    if test "X$HPUX_IA64_MODE" = X32; then
+    library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+    soname_spec='$libname$release$shared_ext$major'
+    if test 32 = "$HPUX_IA64_MODE"; then
       sys_lib_search_path_spec="/usr/lib/hpux32 /usr/local/lib/hpux32 /usr/local/lib"
+      sys_lib_dlsearch_path_spec=/usr/lib/hpux32
     else
       sys_lib_search_path_spec="/usr/lib/hpux64 /usr/local/lib/hpux64"
+      sys_lib_dlsearch_path_spec=/usr/lib/hpux64
     fi
-    sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
     ;;
   hppa*64*)
     shrext_cmds='.sl'
@@ -15016,8 +15501,8 @@ hpux9* | hpux10* | hpux11*)
     dynamic_linker="$host_os dld.sl"
     shlibpath_var=LD_LIBRARY_PATH # How should we handle SHLIB_PATH
     shlibpath_overrides_runpath=yes # Unless +noenvvar is specified.
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-    soname_spec='${libname}${release}${shared_ext}$major'
+    library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+    soname_spec='$libname$release$shared_ext$major'
     sys_lib_search_path_spec="/usr/lib/pa20_64 /usr/ccs/lib/pa20_64"
     sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
     ;;
@@ -15026,8 +15511,8 @@ hpux9* | hpux10* | hpux11*)
     dynamic_linker="$host_os dld.sl"
     shlibpath_var=SHLIB_PATH
     shlibpath_overrides_runpath=no # +s is required to enable SHLIB_PATH
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-    soname_spec='${libname}${release}${shared_ext}$major'
+    library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+    soname_spec='$libname$release$shared_ext$major'
     ;;
   esac
   # HP-UX runs *really* slowly unless shared libraries are mode 555, ...
@@ -15037,11 +15522,11 @@ hpux9* | hpux10* | hpux11*)
   ;;
 
 interix[3-9]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   dynamic_linker='Interix 3.x ld.so.1 (PE, like ELF)'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=no
@@ -15052,16 +15537,16 @@ irix5* | irix6* | nonstopux*)
   case $host_os in
     nonstopux*) version_type=nonstopux ;;
     *)
-	if test "$lt_cv_prog_gnu_ld" = yes; then
-		version_type=linux
+	if test yes = "$lt_cv_prog_gnu_ld"; then
+		version_type=linux # correct to gnu/linux during the next big refactor
 	else
 		version_type=irix
 	fi ;;
   esac
   need_lib_prefix=no
   need_version=no
-  soname_spec='${libname}${release}${shared_ext}$major'
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext} $libname${shared_ext}'
+  soname_spec='$libname$release$shared_ext$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$release$shared_ext $libname$shared_ext'
   case $host_os in
   irix5* | nonstopux*)
     libsuff= shlibsuff=
@@ -15080,8 +15565,8 @@ irix5* | irix6* | nonstopux*)
   esac
   shlibpath_var=LD_LIBRARY${shlibsuff}_PATH
   shlibpath_overrides_runpath=no
-  sys_lib_search_path_spec="/usr/lib${libsuff} /lib${libsuff} /usr/local/lib${libsuff}"
-  sys_lib_dlsearch_path_spec="/usr/lib${libsuff} /lib${libsuff}"
+  sys_lib_search_path_spec="/usr/lib$libsuff /lib$libsuff /usr/local/lib$libsuff"
+  sys_lib_dlsearch_path_spec="/usr/lib$libsuff /lib$libsuff"
   hardcode_into_libs=yes
   ;;
 
@@ -15090,13 +15575,33 @@ linux*oldld* | linux*aout* | linux*coff*
   dynamic_linker=no
   ;;
 
-# This must be Linux ELF.
-linux* | k*bsd*-gnu | kopensolaris*-gnu)
-  version_type=linux
+linux*android*)
+  version_type=none # Android doesn't support versioned libraries.
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext'
+  soname_spec='$libname$release$shared_ext'
+  finish_cmds=
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+
+  # This implies no fast_install, which is unacceptable.
+  # Some rework will be needed to allow for fast_install
+  # before this can be enabled.
+  hardcode_into_libs=yes
+
+  dynamic_linker='Android linker'
+  # Don't embed -rpath directories since the linker doesn't support them.
+  hardcode_libdir_flag_spec='-L$libdir'
+  ;;
+
+# This must be glibc/ELF.
+linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   finish_cmds='PATH="\$PATH:/sbin" ldconfig -n $libdir'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=no
@@ -15140,7 +15645,12 @@ fi
   # before this can be enabled.
   hardcode_into_libs=yes
 
-  # Append ld.so.conf contents to the search path
+  # Ideally, we could use ldconfig to report *all* directores which are
+  # searched for libraries, however this is still not possible.  Aside from not
+  # being certain /sbin/ldconfig is available, command
+  # 'ldconfig -N -X -v | grep ^/' on 64bit Fedora does not report /usr/lib64,
+  # even though it is searched at run-time.  Try to do the best guess by
+  # appending ld.so.conf contents (and includes) to the search path.
   if test -f /etc/ld.so.conf; then
     lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s 2>/dev/null", \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;/^[	 ]*hwcap[	 ]/d;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;s/"//g;/^$/d' | tr '\n' ' '`
     sys_lib_dlsearch_path_spec="/lib /usr/lib $lt_ld_extra"
@@ -15160,12 +15670,12 @@ netbsd*)
   need_lib_prefix=no
   need_version=no
   if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
+    library_names_spec='$libname$release$shared_ext$versuffix $libname$shared_ext$versuffix'
     finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
     dynamic_linker='NetBSD (a.out) ld.so'
   else
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-    soname_spec='${libname}${release}${shared_ext}$major'
+    library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+    soname_spec='$libname$release$shared_ext$major'
     dynamic_linker='NetBSD ld.elf_so'
   fi
   shlibpath_var=LD_LIBRARY_PATH
@@ -15174,8 +15684,8 @@ netbsd*)
   ;;
 
 newsos6)
-  version_type=linux
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
   ;;
@@ -15184,58 +15694,68 @@ newsos6)
   version_type=qnx
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=no
   hardcode_into_libs=yes
   dynamic_linker='ldqnx.so'
   ;;
 
-openbsd*)
+openbsd* | bitrig*)
   version_type=sunos
-  sys_lib_dlsearch_path_spec="/usr/lib"
+  sys_lib_dlsearch_path_spec=/usr/lib
   need_lib_prefix=no
-  # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
-  case $host_os in
-    openbsd3.3 | openbsd3.3.*)	need_version=yes ;;
-    *)				need_version=no  ;;
-  esac
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
-  finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
-  shlibpath_var=LD_LIBRARY_PATH
-  if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
-    case $host_os in
-      openbsd2.[89] | openbsd2.[89].*)
-	shlibpath_overrides_runpath=no
-	;;
-      *)
-	shlibpath_overrides_runpath=yes
-	;;
-      esac
+  if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`"; then
+    need_version=no
   else
-    shlibpath_overrides_runpath=yes
+    need_version=yes
   fi
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$shared_ext$versuffix'
+  finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
   ;;
 
 os2*)
   libname_spec='$name'
-  shrext_cmds=".dll"
+  version_type=windows
+  shrext_cmds=.dll
+  need_version=no
   need_lib_prefix=no
-  library_names_spec='$libname${shared_ext} $libname.a'
+  # OS/2 can only load a DLL with a base name of 8 characters or less.
+  soname_spec='`test -n "$os2dllname" && libname="$os2dllname";
+    v=$($ECHO $release$versuffix | tr -d .-);
+    n=$($ECHO $libname | cut -b -$((8 - ${#v})) | tr . _);
+    $ECHO $n$v`$shared_ext'
+  library_names_spec='${libname}_dll.$libext'
   dynamic_linker='OS/2 ld.exe'
-  shlibpath_var=LIBPATH
+  shlibpath_var=BEGINLIBPATH
+  sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib"
+  sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
+  postinstall_cmds='base_file=`basename \$file`~
+    dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\$base_file'\''i; $ECHO \$dlname'\''`~
+    dldir=$destdir/`dirname \$dlpath`~
+    test -d \$dldir || mkdir -p \$dldir~
+    $install_prog $dir/$dlname \$dldir/$dlname~
+    chmod a+x \$dldir/$dlname~
+    if test -n '\''$stripme'\'' && test -n '\''$striplib'\''; then
+      eval '\''$striplib \$dldir/$dlname'\'' || exit \$?;
+    fi'
+  postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; $ECHO \$dlname'\''`~
+    dlpath=$dir/\$dldll~
+    $RM \$dlpath'
   ;;
 
 osf3* | osf4* | osf5*)
   version_type=osf
   need_lib_prefix=no
   need_version=no
-  soname_spec='${libname}${release}${shared_ext}$major'
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='$libname$release$shared_ext$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
   shlibpath_var=LD_LIBRARY_PATH
   sys_lib_search_path_spec="/usr/shlib /usr/ccs/lib /usr/lib/cmplrs/cc /usr/lib /usr/local/lib /var/shlib"
-  sys_lib_dlsearch_path_spec="$sys_lib_search_path_spec"
+  sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
   ;;
 
 rdos*)
@@ -15243,11 +15763,11 @@ rdos*)
   ;;
 
 solaris*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
   hardcode_into_libs=yes
@@ -15257,20 +15777,20 @@ solaris*)
 
 sunos4*)
   version_type=sunos
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$shared_ext$versuffix'
   finish_cmds='PATH="\$PATH:/usr/etc" ldconfig $libdir'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
-  if test "$with_gnu_ld" = yes; then
+  if test yes = "$with_gnu_ld"; then
     need_lib_prefix=no
   fi
   need_version=yes
   ;;
 
 sysv4 | sysv4.3*)
-  version_type=linux
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   shlibpath_var=LD_LIBRARY_PATH
   case $host_vendor in
     sni)
@@ -15291,24 +15811,24 @@ sysv4 | sysv4.3*)
   ;;
 
 sysv4*MP*)
-  if test -d /usr/nec ;then
-    version_type=linux
-    library_names_spec='$libname${shared_ext}.$versuffix $libname${shared_ext}.$major $libname${shared_ext}'
-    soname_spec='$libname${shared_ext}.$major'
+  if test -d /usr/nec; then
+    version_type=linux # correct to gnu/linux during the next big refactor
+    library_names_spec='$libname$shared_ext.$versuffix $libname$shared_ext.$major $libname$shared_ext'
+    soname_spec='$libname$shared_ext.$major'
     shlibpath_var=LD_LIBRARY_PATH
   fi
   ;;
 
 sysv5* | sco3.2v5* | sco5v6* | unixware* | OpenUNIX* | sysv4*uw2*)
-  version_type=freebsd-elf
+  version_type=sco
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext} $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
   hardcode_into_libs=yes
-  if test "$with_gnu_ld" = yes; then
+  if test yes = "$with_gnu_ld"; then
     sys_lib_search_path_spec='/usr/local/lib /usr/gnu/lib /usr/ccs/lib /usr/lib /lib'
   else
     sys_lib_search_path_spec='/usr/ccs/lib /usr/lib'
@@ -15323,19 +15843,19 @@ sysv5* | sco3.2v5* | sco5v6* | unixware*
 
 tpf*)
   # TPF is a cross-target only.  Preferred cross-host = GNU/Linux.
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=no
   hardcode_into_libs=yes
   ;;
 
 uts4*)
-  version_type=linux
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   shlibpath_var=LD_LIBRARY_PATH
   ;;
 
@@ -15345,20 +15865,35 @@ uts4*)
 esac
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $dynamic_linker" >&5
 $as_echo "$dynamic_linker" >&6; }
-test "$dynamic_linker" = no && can_build_shared=no
+test no = "$dynamic_linker" && can_build_shared=no
 
 variables_saved_for_relink="PATH $shlibpath_var $runpath_var"
-if test "$GCC" = yes; then
+if test yes = "$GCC"; then
   variables_saved_for_relink="$variables_saved_for_relink GCC_EXEC_PREFIX COMPILER_PATH LIBRARY_PATH"
 fi
 
-if test "${lt_cv_sys_lib_search_path_spec+set}" = set; then
-  sys_lib_search_path_spec="$lt_cv_sys_lib_search_path_spec"
+if test set = "${lt_cv_sys_lib_search_path_spec+set}"; then
+  sys_lib_search_path_spec=$lt_cv_sys_lib_search_path_spec
 fi
-if test "${lt_cv_sys_lib_dlsearch_path_spec+set}" = set; then
-  sys_lib_dlsearch_path_spec="$lt_cv_sys_lib_dlsearch_path_spec"
+
+if test set = "${lt_cv_sys_lib_dlsearch_path_spec+set}"; then
+  sys_lib_dlsearch_path_spec=$lt_cv_sys_lib_dlsearch_path_spec
 fi
 
+# remember unaugmented sys_lib_dlsearch_path content for libtool script decls...
+configure_time_dlsearch_path=$sys_lib_dlsearch_path_spec
+
+# ... but it needs LT_SYS_LIBRARY_PATH munging for other configure-time code
+func_munge_path_list sys_lib_dlsearch_path_spec "$LT_SYS_LIBRARY_PATH"
+
+# to be used as default LT_SYS_LIBRARY_PATH value in generated libtool
+configure_time_lt_sys_library_path=$LT_SYS_LIBRARY_PATH
+
+
+
+
+
+
 
 
 
@@ -15455,15 +15990,15 @@ $as_echo_n "checking how to hardcode lib
 hardcode_action=
 if test -n "$hardcode_libdir_flag_spec" ||
    test -n "$runpath_var" ||
-   test "X$hardcode_automatic" = "Xyes" ; then
+   test yes = "$hardcode_automatic"; then
 
   # We can hardcode non-existent directories.
-  if test "$hardcode_direct" != no &&
+  if test no != "$hardcode_direct" &&
      # If the only mechanism to avoid hardcoding is shlibpath_var, we
      # have to relink, otherwise we might link with an installed library
      # when we should be linking with a yet-to-be-installed one
-     ## test "$_LT_TAGVAR(hardcode_shlibpath_var, )" != no &&
-     test "$hardcode_minus_L" != no; then
+     ## test no != "$_LT_TAGVAR(hardcode_shlibpath_var, )" &&
+     test no != "$hardcode_minus_L"; then
     # Linking always hardcodes the temporary library directory.
     hardcode_action=relink
   else
@@ -15478,12 +16013,12 @@ fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $hardcode_action" >&5
 $as_echo "$hardcode_action" >&6; }
 
-if test "$hardcode_action" = relink ||
-   test "$inherit_rpath" = yes; then
+if test relink = "$hardcode_action" ||
+   test yes = "$inherit_rpath"; then
   # Fast installation is not supported
   enable_fast_install=no
-elif test "$shlibpath_overrides_runpath" = yes ||
-     test "$enable_shared" = no; then
+elif test yes = "$shlibpath_overrides_runpath" ||
+     test no = "$enable_shared"; then
   # Fast installation is not necessary
   enable_fast_install=needless
 fi
@@ -15493,7 +16028,7 @@ fi
 
 
 
-  if test "x$enable_dlopen" != xyes; then
+  if test yes != "$enable_dlopen"; then
   enable_dlopen=unknown
   enable_dlopen_self=unknown
   enable_dlopen_self_static=unknown
@@ -15503,23 +16038,23 @@ else
 
   case $host_os in
   beos*)
-    lt_cv_dlopen="load_add_on"
+    lt_cv_dlopen=load_add_on
     lt_cv_dlopen_libs=
     lt_cv_dlopen_self=yes
     ;;
 
   mingw* | pw32* | cegcc*)
-    lt_cv_dlopen="LoadLibrary"
+    lt_cv_dlopen=LoadLibrary
     lt_cv_dlopen_libs=
     ;;
 
   cygwin*)
-    lt_cv_dlopen="dlopen"
+    lt_cv_dlopen=dlopen
     lt_cv_dlopen_libs=
     ;;
 
   darwin*)
-  # if libdl is installed we need to link against it
+    # if libdl is installed we need to link against it
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
 $as_echo_n "checking for dlopen in -ldl... " >&6; }
 if ${ac_cv_lib_dl_dlopen+:} false; then :
@@ -15557,10 +16092,10 @@ fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
 $as_echo "$ac_cv_lib_dl_dlopen" >&6; }
 if test "x$ac_cv_lib_dl_dlopen" = xyes; then :
-  lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"
+  lt_cv_dlopen=dlopen lt_cv_dlopen_libs=-ldl
 else
 
-    lt_cv_dlopen="dyld"
+    lt_cv_dlopen=dyld
     lt_cv_dlopen_libs=
     lt_cv_dlopen_self=yes
 
@@ -15568,10 +16103,18 @@ fi
 
     ;;
 
+  tpf*)
+    # Don't try to run any link tests for TPF.  We know it's impossible
+    # because TPF is a cross-compiler, and we know how we open DSOs.
+    lt_cv_dlopen=dlopen
+    lt_cv_dlopen_libs=
+    lt_cv_dlopen_self=no
+    ;;
+
   *)
     ac_fn_c_check_func "$LINENO" "shl_load" "ac_cv_func_shl_load"
 if test "x$ac_cv_func_shl_load" = xyes; then :
-  lt_cv_dlopen="shl_load"
+  lt_cv_dlopen=shl_load
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for shl_load in -ldld" >&5
 $as_echo_n "checking for shl_load in -ldld... " >&6; }
@@ -15610,11 +16153,11 @@ fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dld_shl_load" >&5
 $as_echo "$ac_cv_lib_dld_shl_load" >&6; }
 if test "x$ac_cv_lib_dld_shl_load" = xyes; then :
-  lt_cv_dlopen="shl_load" lt_cv_dlopen_libs="-ldld"
+  lt_cv_dlopen=shl_load lt_cv_dlopen_libs=-ldld
 else
   ac_fn_c_check_func "$LINENO" "dlopen" "ac_cv_func_dlopen"
 if test "x$ac_cv_func_dlopen" = xyes; then :
-  lt_cv_dlopen="dlopen"
+  lt_cv_dlopen=dlopen
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
 $as_echo_n "checking for dlopen in -ldl... " >&6; }
@@ -15653,7 +16196,7 @@ fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen" >&5
 $as_echo "$ac_cv_lib_dl_dlopen" >&6; }
 if test "x$ac_cv_lib_dl_dlopen" = xyes; then :
-  lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"
+  lt_cv_dlopen=dlopen lt_cv_dlopen_libs=-ldl
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -lsvld" >&5
 $as_echo_n "checking for dlopen in -lsvld... " >&6; }
@@ -15692,7 +16235,7 @@ fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_svld_dlopen" >&5
 $as_echo "$ac_cv_lib_svld_dlopen" >&6; }
 if test "x$ac_cv_lib_svld_dlopen" = xyes; then :
-  lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-lsvld"
+  lt_cv_dlopen=dlopen lt_cv_dlopen_libs=-lsvld
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dld_link in -ldld" >&5
 $as_echo_n "checking for dld_link in -ldld... " >&6; }
@@ -15731,7 +16274,7 @@ fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dld_dld_link" >&5
 $as_echo "$ac_cv_lib_dld_dld_link" >&6; }
 if test "x$ac_cv_lib_dld_dld_link" = xyes; then :
-  lt_cv_dlopen="dld_link" lt_cv_dlopen_libs="-ldld"
+  lt_cv_dlopen=dld_link lt_cv_dlopen_libs=-ldld
 fi
 
 
@@ -15752,21 +16295,21 @@ fi
     ;;
   esac
 
-  if test "x$lt_cv_dlopen" != xno; then
-    enable_dlopen=yes
-  else
+  if test no = "$lt_cv_dlopen"; then
     enable_dlopen=no
+  else
+    enable_dlopen=yes
   fi
 
   case $lt_cv_dlopen in
   dlopen)
-    save_CPPFLAGS="$CPPFLAGS"
-    test "x$ac_cv_header_dlfcn_h" = xyes && CPPFLAGS="$CPPFLAGS -DHAVE_DLFCN_H"
+    save_CPPFLAGS=$CPPFLAGS
+    test yes = "$ac_cv_header_dlfcn_h" && CPPFLAGS="$CPPFLAGS -DHAVE_DLFCN_H"
 
-    save_LDFLAGS="$LDFLAGS"
+    save_LDFLAGS=$LDFLAGS
     wl=$lt_prog_compiler_wl eval LDFLAGS=\"\$LDFLAGS $export_dynamic_flag_spec\"
 
-    save_LIBS="$LIBS"
+    save_LIBS=$LIBS
     LIBS="$lt_cv_dlopen_libs $LIBS"
 
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether a program can dlopen itself" >&5
@@ -15774,7 +16317,7 @@ $as_echo_n "checking whether a program c
 if ${lt_cv_dlopen_self+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  	  if test "$cross_compiling" = yes; then :
+  	  if test yes = "$cross_compiling"; then :
   lt_cv_dlopen_self=cross
 else
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
@@ -15821,9 +16364,9 @@ else
 #  endif
 #endif
 
-/* When -fvisbility=hidden is used, assume the code has been annotated
+/* When -fvisibility=hidden is used, assume the code has been annotated
    correspondingly for the symbols needed.  */
-#if defined(__GNUC__) && (((__GNUC__ == 3) && (__GNUC_MINOR__ >= 3)) || (__GNUC__ > 3))
+#if defined __GNUC__ && (((__GNUC__ == 3) && (__GNUC_MINOR__ >= 3)) || (__GNUC__ > 3))
 int fnord () __attribute__((visibility("default")));
 #endif
 
@@ -15853,7 +16396,7 @@ _LT_EOF
   (eval $ac_link) 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; } && test -s conftest${ac_exeext} 2>/dev/null; then
+  test $ac_status = 0; } && test -s "conftest$ac_exeext" 2>/dev/null; then
     (./conftest; exit; ) >&5 2>/dev/null
     lt_status=$?
     case x$lt_status in
@@ -15873,14 +16416,14 @@ fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_dlopen_self" >&5
 $as_echo "$lt_cv_dlopen_self" >&6; }
 
-    if test "x$lt_cv_dlopen_self" = xyes; then
+    if test yes = "$lt_cv_dlopen_self"; then
       wl=$lt_prog_compiler_wl eval LDFLAGS=\"\$LDFLAGS $lt_prog_compiler_static\"
       { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether a statically linked program can dlopen itself" >&5
 $as_echo_n "checking whether a statically linked program can dlopen itself... " >&6; }
 if ${lt_cv_dlopen_self_static+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  	  if test "$cross_compiling" = yes; then :
+  	  if test yes = "$cross_compiling"; then :
   lt_cv_dlopen_self_static=cross
 else
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
@@ -15927,9 +16470,9 @@ else
 #  endif
 #endif
 
-/* When -fvisbility=hidden is used, assume the code has been annotated
+/* When -fvisibility=hidden is used, assume the code has been annotated
    correspondingly for the symbols needed.  */
-#if defined(__GNUC__) && (((__GNUC__ == 3) && (__GNUC_MINOR__ >= 3)) || (__GNUC__ > 3))
+#if defined __GNUC__ && (((__GNUC__ == 3) && (__GNUC_MINOR__ >= 3)) || (__GNUC__ > 3))
 int fnord () __attribute__((visibility("default")));
 #endif
 
@@ -15959,7 +16502,7 @@ _LT_EOF
   (eval $ac_link) 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; } && test -s conftest${ac_exeext} 2>/dev/null; then
+  test $ac_status = 0; } && test -s "conftest$ac_exeext" 2>/dev/null; then
     (./conftest; exit; ) >&5 2>/dev/null
     lt_status=$?
     case x$lt_status in
@@ -15980,9 +16523,9 @@ fi
 $as_echo "$lt_cv_dlopen_self_static" >&6; }
     fi
 
-    CPPFLAGS="$save_CPPFLAGS"
-    LDFLAGS="$save_LDFLAGS"
-    LIBS="$save_LIBS"
+    CPPFLAGS=$save_CPPFLAGS
+    LDFLAGS=$save_LDFLAGS
+    LIBS=$save_LIBS
     ;;
   esac
 
@@ -16026,7 +16569,7 @@ else
 # FIXME - insert some real tests, host_os isn't really good enough
   case $host_os in
   darwin*)
-    if test -n "$STRIP" ; then
+    if test -n "$STRIP"; then
       striplib="$STRIP -x"
       old_striplib="$STRIP -S"
       { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
@@ -16054,7 +16597,7 @@ fi
 
 
 
-  # Report which library types will actually be built
+  # Report what library types will actually be built
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking if libtool supports shared libraries" >&5
 $as_echo_n "checking if libtool supports shared libraries... " >&6; }
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $can_build_shared" >&5
@@ -16062,13 +16605,13 @@ $as_echo "$can_build_shared" >&6; }
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build shared libraries" >&5
 $as_echo_n "checking whether to build shared libraries... " >&6; }
-  test "$can_build_shared" = "no" && enable_shared=no
+  test no = "$can_build_shared" && enable_shared=no
 
   # On AIX, shared libraries and static libraries use the same namespace, and
   # are all built from PIC.
   case $host_os in
   aix3*)
-    test "$enable_shared" = yes && enable_static=no
+    test yes = "$enable_shared" && enable_static=no
     if test -n "$RANLIB"; then
       archive_cmds="$archive_cmds~\$RANLIB \$lib"
       postinstall_cmds='$RANLIB $lib'
@@ -16076,8 +16619,12 @@ $as_echo_n "checking whether to build sh
     ;;
 
   aix[4-9]*)
-    if test "$host_cpu" != ia64 && test "$aix_use_runtimelinking" = no ; then
-      test "$enable_shared" = yes && enable_static=no
+    if test ia64 != "$host_cpu"; then
+      case $enable_shared,$with_aix_soname,$aix_use_runtimelinking in
+      yes,aix,yes) ;;			# shared object as lib.so file only
+      yes,svr4,*) ;;			# shared object as lib.so archive member only
+      yes,*) enable_static=no ;;	# shared object in lib.a archive as well
+      esac
     fi
     ;;
   esac
@@ -16087,7 +16634,7 @@ $as_echo "$enable_shared" >&6; }
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether to build static libraries" >&5
 $as_echo_n "checking whether to build static libraries... " >&6; }
   # Make sure either enable_shared or enable_static is yes.
-  test "$enable_shared" = yes || enable_static=yes
+  test yes = "$enable_shared" || enable_static=yes
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $enable_static" >&5
 $as_echo "$enable_static" >&6; }
 
@@ -16101,7 +16648,9 @@ ac_compile='$CC -c $CFLAGS $CPPFLAGS con
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-CC="$lt_save_CC"
+CC=$lt_save_CC
+
+
 
 
 
@@ -16123,6 +16672,176 @@ CC="$lt_save_CC"
 # Only expand once:
 
 
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}windres", so it can be a program name with args.
+set dummy ${ac_tool_prefix}windres; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_RC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$RC"; then
+  ac_cv_prog_RC="$RC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_RC="${ac_tool_prefix}windres"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+RC=$ac_cv_prog_RC
+if test -n "$RC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $RC" >&5
+$as_echo "$RC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test -z "$ac_cv_prog_RC"; then
+  ac_ct_RC=$RC
+  # Extract the first word of "windres", so it can be a program name with args.
+set dummy windres; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_ac_ct_RC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$ac_ct_RC"; then
+  ac_cv_prog_ac_ct_RC="$ac_ct_RC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_RC="windres"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+ac_ct_RC=$ac_cv_prog_ac_ct_RC
+if test -n "$ac_ct_RC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_RC" >&5
+$as_echo "$ac_ct_RC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_ct_RC" = x; then
+    RC=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    RC=$ac_ct_RC
+  fi
+else
+  RC="$ac_cv_prog_RC"
+fi
+
+
+
+
+# Source file extension for RC test sources.
+ac_ext=rc
+
+# Object file extension for compiled RC test sources.
+objext=o
+objext_RC=$objext
+
+# Code to be used in simple compile tests
+lt_simple_compile_test_code='sample MENU { MENUITEM "&Soup", 100, CHECKED }'
+
+# Code to be used in simple link tests
+lt_simple_link_test_code=$lt_simple_compile_test_code
+
+# ltmain only uses $CC for tagged configurations so make sure $CC is set.
+
+
+
+
+
+
+# If no C compiler was specified, use CC.
+LTCC=${LTCC-"$CC"}
+
+# If no C compiler flags were specified, use CFLAGS.
+LTCFLAGS=${LTCFLAGS-"$CFLAGS"}
+
+# Allow CC to be a program name with arguments.
+compiler=$CC
+
+
+# save warnings/boilerplate of simple test code
+ac_outfile=conftest.$ac_objext
+echo "$lt_simple_compile_test_code" >conftest.$ac_ext
+eval "$ac_compile" 2>&1 >/dev/null | $SED '/^$/d; /^ *+/d' >conftest.err
+_lt_compiler_boilerplate=`cat conftest.err`
+$RM conftest*
+
+ac_outfile=conftest.$ac_objext
+echo "$lt_simple_link_test_code" >conftest.$ac_ext
+eval "$ac_link" 2>&1 >/dev/null | $SED '/^$/d; /^ *+/d' >conftest.err
+_lt_linker_boilerplate=`cat conftest.err`
+$RM -r conftest*
+
+
+# Allow CC to be a program name with arguments.
+lt_save_CC=$CC
+lt_save_CFLAGS=$CFLAGS
+lt_save_GCC=$GCC
+GCC=
+CC=${RC-"windres"}
+CFLAGS=
+compiler=$CC
+compiler_RC=$CC
+func_cc_basename $compiler
+cc_basename=$func_cc_basename_result
+
+lt_cv_prog_compiler_c_o_RC=yes
+
+if test -n "$compiler"; then
+  :
+
+
+
+fi
+
+GCC=$lt_save_GCC
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+CC=$lt_save_CC
+CFLAGS=$lt_save_CFLAGS
+
 
 
 
@@ -16136,17 +16855,16 @@ CC="$lt_save_CC"
 if test "x$developer" != "xno" -a -f $srcdir/remove-files; then
     developer="yes"
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for developer gcc flags" >&5
-$as_echo_n "checking for developer gcc flags... " >&6; }
 if test "x$developer" = "xyes" -a "x$GCC" = "xyes"; then
-
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for developer gcc flags" >&5
+$as_echo_n "checking for developer gcc flags... " >&6; }
     #       WWWXXX - strict type checking
     #
     netsnmp_save_CFLAGS="$CFLAGS"
     for opt in -Wall -Wextra -Wstrict-prototypes -Wwrite-strings -Wcast-qual \
         -Wimplicit-fallthrough=2 -Wlogical-op                                \
         -Wno-format-truncation -Wno-missing-field-initializers               \
-        -Wno-sign-compare -Wno-unused-parameter -Wno-type-limits
+        -Wno-sign-compare -Wno-unused-parameter
     do
       { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the compiler supports $opt" >&5
 $as_echo_n "checking whether the compiler supports $opt... " >&6; }
@@ -16182,12 +16900,11 @@ rm -f core conftest.err conftest.$ac_obj
     conftest$ac_exeext conftest.$ac_ext
       CFLAGS="$netsnmp_save_CFLAGS"
     done
-
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $DEVFLAGS" >&5
+$as_echo "$DEVFLAGS" >&6; }
 else
     DEVFLAGS=""
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $DEVFLAGS" >&5
-$as_echo "$DEVFLAGS" >&6; }
 
 
 
@@ -16286,22 +17003,28 @@ EOF
 
 # Avoid conflicts on Cygwin between <windows.h> and the openssl header files.
 case x$target_os in
-     xcygwin*)
+     xcygwin*|xmingw32*)
         CPPFLAGS="-DVC_EXTRALEAN -DWIN32_LEAN_AND_MEAN $CPPFLAGS";;
 esac
 
+
 #
-#    Whether or not Cygwin's ld recognizes the flag -no-undefined.
+#    Whether the linker supports the flag -Wl,-no-undefined. Do not use
+#    -Wl,-no-undefined on OpenBSD because it breaks linking of shared
+#    libraries. Use -Wl,-no-undefined on all other platforms such that
+#    undefined symbols are detected at compile time instead of at runtime.
 #
 
 case x$target_os in
-xcygwin*)
-  saved_LDFLAGS=$LDFLAGS
-
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the linker supports -no-undefined" >&5
-$as_echo_n "checking whether the linker supports -no-undefined... " >&6; }
-  LDFLAGS="$saved_LDFLAGS -Wl,-no-undefined"
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+  xopenbsd*)
+    ;;
+  *)
+    if ! echo "$CFLAGS" | grep -q -- -fsanitize=; then
+      saved_LDFLAGS=$LDFLAGS
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the linker supports -Wl,-no-undefined" >&5
+$as_echo_n "checking whether the linker supports -Wl,-no-undefined... " >&6; }
+      LDFLAGS="$saved_LDFLAGS -Wl,-no-undefined"
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
@@ -16314,30 +17037,27 @@ main ()
 _ACEOF
 if ac_fn_c_try_link "$LINENO"; then :
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; };                   LD_NO_UNDEFINED=-no-undefined
+$as_echo "yes" >&6; }; 		      LD_NO_UNDEFINED=-Wl,-no-undefined
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
+      LDFLAGS="$saved_LDFLAGS"
 
-  LDFLAGS="$saved_LDFLAGS"
-  ;;
+    fi
+    ;;
 esac
 
 
-
-
 #
 #   Socket library: either 'default' (non-MinGW) or 'winsock2' (MinGW).
 #
 case x$target_os in
   xmingw*)
     with_socklib=winsock2
-    if test "x$enable_ipv6" = "xyes"; then
-      CFLAGS="-D_WIN32_WINNT=0x0501 $CFLAGS"
-    fi
+    CPPFLAGS="-D_WIN32_WINNT=0xffff -DWIN32 $CPPFLAGS"
     ;;
   *)
     with_socklib=default;;
@@ -16491,7 +17211,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_CCPATH="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -16666,7 +17386,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_DPKG_QUERY_PATH="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -17108,7 +17828,12 @@ fi
 fi
         #  <dirent.h>, <sys/ndir.h>, <sys/dir.h> & <ndir.h>
 #  Apps:
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for sys/wait.h that is POSIX.1 compatible" >&5
+# Don't use <sys/wait.h> when using Windows sockets
+case x$with_socklib in
+  xwinsock2)
+    ;;
+  *)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for sys/wait.h that is POSIX.1 compatible" >&5
 $as_echo_n "checking for sys/wait.h that is POSIX.1 compatible... " >&6; }
 if ${ac_cv_header_sys_wait_h+:} false; then :
   $as_echo_n "(cached) " >&6
@@ -17148,7 +17873,8 @@ if test $ac_cv_header_sys_wait_h = yes;
 $as_echo "#define HAVE_SYS_WAIT_H 1" >>confdefs.h
 
 fi
-      #  <sys/wait.h>
+  #  <sys/wait.h>
+esac
 
 # allow for quick module/library/etc processing checks
 if test "x$NETSNMP_QUICK_CHECK" = "x" ; then
@@ -17157,7 +17883,7 @@ if test "x$NETSNMP_QUICK_CHECK" = "x" ;
 #   Stand-alone headers:
 ##
 #  Core:
-for ac_header in getopt.h   pthread.h  regex.h                        string.h   syslog.h   unistd.h                       stdint.h   inttypes.h                                sys/param.h                          sys/select.h                         sys/socket.h                         sys/syslog.h                         sys/time.h                           sys/timeb.h                          sys/un.h
+for ac_header in getopt.h   pthread.h  regex.h                        string.h   syslog.h   unistd.h                       stdint.h   inttypes.h                                process.h                            sys/param.h                          sys/select.h                         sys/syslog.h                         sys/time.h                           sys/timeb.h
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
@@ -17193,7 +17919,7 @@ done
 
 
 #  Library:
-for ac_header in fcntl.h    io.h       kstat.h                                   limits.h   locale.h                                    sys/file.h       sys/ioctl.h                           sys/sockio.h     sys/stat.h                            sys/systemcfg.h  sys/systeminfo.h                      sys/times.h      sys/uio.h                             sys/utsname.h                        netipx/ipx.h
+for ac_header in crt_externs.h                                          fcntl.h    io.h       kstat.h                          limits.h   locale.h                                    mach-o/dyld.h                                          sys/file.h       sys/ioctl.h                           sys/sockio.h     sys/stat.h                            sys/systemcfg.h  sys/systeminfo.h                      sys/times.h      sys/uio.h                             sys/utsname.h                        netipx/ipx.h
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
@@ -17208,7 +17934,7 @@ done
 
 
 #  Agent:
-for ac_header in dlfcn.h    err.h      fcntl.h    fstab.h                                   grp.h      io.h                                      ioctls.h   kstat.h    kvm.h      limits.h                                  mntent.h   mtab.h                                               pkglocs.h             pwd.h                                     com_err.h             et/com_err.h                              utmpx.h    utsname.h
+for ac_header in dlfcn.h    err.h      fcntl.h    fstab.h                                   grp.h      io.h                                      ioctls.h   kstat.h    kvm.h      limits.h                                  mntent.h   mtab.h                                    pkglocs.h  pwd.h      spawn.h                                              com_err.h             et/com_err.h                              utmpx.h    utsname.h
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
@@ -17236,7 +17962,7 @@ fi
 done
 
 
-for ac_header in asm/page.h asm/types.h                                 inet/mib2.h                                            linux/hdreg.h linux/tasks.h                            machine/param.h                                        netinet/tcp_fsm.h                                      ufs/fs.h                                               uvm/uvm_extern.h uvm/uvm_param.h                       vm/vm.h vm/vm_extern.h vm/vm_param.h
+for ac_header in asm/page.h asm/types.h                                 inet/mib2.h                                            linux/hdreg.h linux/tasks.h                            machine/param.h                                        ufs/fs.h                                               uvm/uvm_extern.h uvm/uvm_param.h                       vm/vm.h vm/vm_extern.h vm/vm_param.h
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
@@ -17251,7 +17977,7 @@ done
 
 
 #  Apps:
-for ac_header in fcntl.h    grp.h      pwd.h                        sys/cdefs.h   sys/ioctl.h                          sys/socket.h  sys/sockio.h                         sys/time.h
+for ac_header in fcntl.h    grp.h      pwd.h                        sys/cdefs.h   sys/ioctl.h                          sys/time.h
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
@@ -17384,8 +18110,7 @@ done
 
 #       requiring <sys/param.h>                         (FreeBSD)
 #
-#  Core:      (? Tested above? )
-for ac_header in stdlib.h
+for ac_header in malloc.h        osreldate.h                                     machine/types.h                   sys/dkstat.h    sys/conf.h    sys/mbuf.h                        sys/mount.h     sys/proc.h    sys/queue.h                       sys/user.h
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "
@@ -17406,52 +18131,28 @@ fi
 
 done
 
-#
-#  Library:
-for ac_header in malloc.h        net/if_dl.h   sys/sysctl.h
-do :
-  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "
-#if HAVE_SYS_TYPES_H
-#include <sys/types.h>
-#endif
-#if HAVE_SYS_PARAM_H
-#include <sys/param.h>
-#endif
-
-"
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
-
-fi
-
-done
 
-#
-#  Agent:
-for ac_header in malloc.h        osreldate.h                                     machine/types.h net/if_dl.h   net/if_types.h                    sys/dkstat.h    sys/conf.h    sys/mbuf.h                        sys/mount.h     sys/proc.h    sys/queue.h                       sys/sysctl.h    sys/user.h
+case "$target_os" in
+    linux*)
+	# <sys/sysctl.h> is considered deprecated on Linux and including that
+	# header file triggers a compiler warning. See also
+	# https://savannah.gnu.org/forum/forum.php?forum_id=9515.
+        ;;
+    *)
+	for ac_header in sys/sysctl.h
 do :
-  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "
-#if HAVE_SYS_TYPES_H
-#include <sys/types.h>
-#endif
-#if HAVE_SYS_PARAM_H
-#include <sys/param.h>
-#endif
-
-"
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  ac_fn_c_check_header_mongrel "$LINENO" "sys/sysctl.h" "ac_cv_header_sys_sysctl_h" "$ac_includes_default"
+if test "x$ac_cv_header_sys_sysctl_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+#define HAVE_SYS_SYSCTL_H 1
 _ACEOF
 
 fi
 
 done
 
+        ;;
+esac
 
 #       requiring <sys/sema.h>                          (IRIX 6.5)
 #  Agent:
@@ -17487,28 +18188,6 @@ fi
 done
 
 
-#       requiring <sys/socket.h>                        (Solaris 9)
-#  Agent:
-#
-for ac_header in sys/socketvar.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "sys/socketvar.h" "ac_cv_header_sys_socketvar_h" "$ac_includes_default
-
-#if HAVE_SYS_SOCKET_H
-#include <sys/socket.h>
-#endif
-
-"
-if test "x$ac_cv_header_sys_socketvar_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_SYS_SOCKETVAR_H 1
-_ACEOF
-
-fi
-
-done
-
-
 #       requiring _KMEMUSER and <sys/types.h>           (BSDi3/IRIX)
 #  Agent:
 #
@@ -17649,70 +18328,18 @@ fi
 done
 
 
-
-#       Network headers
-#  Core or Library/Agent/Apps:
 #
-for ac_header in arpa/inet.h        net/if.h                               netinet/in.h       netdb.h
-do :
-  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "
-#if HAVE_SYS_TYPES_H
-#include <sys/types.h>
-#endif
-#if HAVE_SYS_TIMEOUT_H
-#include <sys/timeout.h>
-#endif
-#if HAVE_SYS_SOCKET_H
-#include <sys/socket.h>
-#endif
-#if HAVE_SYS_SOCKETVAR_H
-#include <sys/socketvar.h>
-#endif
-#if HAVE_ARPA_INET_H
-#include <arpa/inet.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-#include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-#include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IP_H
-#include <netinet/ip.h>
-#endif
-#if HAVE_NET_IF_H
-#include <net/if.h>
-#endif
-#if HAVE_NETINET_IP_VAR_H
-#include <netinet/ip_var.h>
-#endif
-#if HAVE_NETINET_IP_ICMP_H
-#include <netinet/ip_icmp.h>
-#endif
-#if HAVE_NETINET_TCP_H
-#include <netinet/tcp.h>
-#endif
-#if HAVE_NETINET_UDP_H
-#include <netinet/udp.h>
-#endif
-#if HAVE_NETINET_TCP_TIMER_H
-#include <netinet/tcp_timer.h>
-#endif
-
-"
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
-
-fi
+# Avoid that on MinGW any networking headers get included that are
+# incompatible with <winsock2.h> by only testing for certain headers if not
+# building for one of these two platforms.
+#
 
-done
+case x$with_socklib in
+  xwinsock2)
+    ;;
+  *)
 
-#
-#  Agent:
-for ac_header in net/if_arp.h       net/if_mib.h         net/if_var.h                       netinet/if_ether.h netinet/in_systm.h   netinet/in_var.h                   netinet/ip.h       netinet/ip_icmp.h                                       netinet/icmp_var.h netinet/ip_var.h                                        netinet/tcp.h      netinet/tcp_timer.h  netinet/tcp_var.h                  netinet/tcpip.h    netinet/udp.h        netinet/udp_var.h                  net/route.h        netinet/icmp6.h
+for ac_header in sys/socket.h                 sys/un.h                 netinet/tcp_fsm.h                 sys/sockio.h                 sys/socketvar.h                 net/if_dl.h                 net/if_types.h                 arpa/inet.h                 net/if.h                 netinet/in.h                 netdb.h                 net/if_arp.h                 net/if_mib.h                 net/if_var.h                 netinet/if_ether.h                 netinet/in_systm.h                 netinet/in_var.h                 netinet/ip.h                 netinet/ip_icmp.h                 netinet/icmp_var.h                 netinet/ip_var.h                 netinet/tcp.h                 netinet/tcp_timer.h                 netinet/tcp_var.h                 netinet/tcpip.h                 netinet/udp.h                 netinet/udp_var.h                 net/route.h                 netinet/icmp6.h                 netinet/in_pcb.h                 netinet/ip6.h                 netinet6/in6_var.h                 netinet6/in6_pcb.h                 netinet6/ip6_var.h                 netinet6/nd6.h                 netinet6/tcp6.h                 netinet6/tcp6_fsm.h                 netinet6/tcp6_timer.h                 netinet6/tcp6_var.h
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "
@@ -17743,6 +18370,9 @@ ac_fn_c_check_header_compile "$LINENO" "
 #if HAVE_NETINET_IP_H
 #include <netinet/ip.h>
 #endif
+#if HAVE_NETINET_IP_H
+#include <netinet/ip_icmp.h>
+#endif
 #if HAVE_NET_IF_H
 #include <net/if.h>
 #endif
@@ -17764,56 +18394,12 @@ ac_fn_c_check_header_compile "$LINENO" "
 #if HAVE_NETINET_TCP_TIMER_H
 #include <netinet/tcp_timer.h>
 #endif
-#if HAVE_NETINET_ICMP6_H
-#include <netinet/icmp6.h>
-#endif
-
-"
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
-
-fi
-
-done
-
-
-#       KAME (IPv6) headers
-#  Agent:
-#
-# KAME
-for ac_header in netinet/ip6.h                                                 netinet6/in6_var.h    netinet6/in6_pcb.h                      netinet6/ip6_var.h    netinet6/nd6.h                          netinet6/tcp6.h       netinet6/tcp6_fsm.h                     netinet6/tcp6_timer.h netinet6/tcp6_var.h
-do :
-  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "
-#if HAVE_SYS_PARAM_H
-#include <sys/param.h>
-#endif
-#if HAVE_SYS_TYPES_H
-#include <sys/types.h>
-#endif
-#if HAVE_SYS_QUEUE_H
-#include <sys/queue.h>
-#endif
-#if HAVE_SYS_SOCKET_H
-#include <sys/socket.h>
-#endif
-#if HAVE_NET_IF_H
-#include <net/if.h>
-#endif
-#if HAVE_NET_IF_VAR_H
-#include <net/if_var.h>
-#endif
-#if HAVE_NET_ROUTE_H
-#include <net/route.h>
-#endif
-#if HAVE_NETINET_IN_H
-#include <netinet/in.h>
-#endif
 #if HAVE_NETINET_IP6_H
 #include <netinet/ip6.h>
 #endif
+#if HAVE_NETINET_ICMP6_H
+#include <netinet/icmp6.h>
+#endif
 
 "
 if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
@@ -17826,53 +18412,7 @@ fi
 done
 
 
-#       requiring <netinet/in.h>                        (OpenBSD 2.6)
-#  Agent:
-#
-for ac_header in netinet/in_pcb.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "netinet/in_pcb.h" "ac_cv_header_netinet_in_pcb_h" "
-#if HAVE_SYS_PARAM_H
-#include <sys/param.h>
-#endif
-#if HAVE_SYS_TYPES_H
-#include <sys/types.h>
-#endif
-#if HAVE_SYS_TIMEOUT_H
-#include <sys/timeout.h>
-#endif
-#if HAVE_SYS_SOCKET_H
-#include <sys/socket.h>
-#endif
-#if HAVE_SYS_SOCKETVAR_H
-#include <sys/socketvar.h>
-#endif
-#if HAVE_NETINET_IN_H
-#include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-#include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IP_H
-#include <netinet/ip.h>
-#endif
-#if HAVE_NET_ROUTE_H
-#include <net/route.h>
-#endif
-#if HAVE_ARPA_INET_H
-#include <arpa/inet.h>
-#endif
-
-"
-if test "x$ac_cv_header_netinet_in_pcb_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NETINET_IN_PCB_H 1
-_ACEOF
-
-fi
-
-done
-
+esac
 
 ##
 #   Pre-requisite on specific types
@@ -18013,8 +18553,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_pkginfo_LMIBLIBS" >&5
 $as_echo "$netsnmp_cv_func_pkginfo_LMIBLIBS" >&6; }
- if test "${netsnmp_cv_func_pkginfo_LMIBLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_pkginfo_LMIBLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_pkginfo_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_pkginfo_LMIBLIBS}" != "xnone required" ; then
        LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -18102,8 +18642,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_pkg_init_LIBS" >&5
 $as_echo "$netsnmp_cv_func_pkg_init_LIBS" >&6; }
- if test "${netsnmp_cv_func_pkg_init_LIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_pkg_init_LIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_pkg_init_LIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_pkg_init_LIBS}" != "xnone required" ; then
        LIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -18198,8 +18738,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_pkg_init_LIBS" >&5
 $as_echo "$netsnmp_cv_func_pkg_init_LIBS" >&6; }
- if test "${netsnmp_cv_func_pkg_init_LIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_pkg_init_LIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_pkg_init_LIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_pkg_init_LIBS}" != "xnone required" ; then
        LIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -18303,8 +18843,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_perfstat_cpu_total_LMIBLIBS" >&5
 $as_echo "$netsnmp_cv_func_perfstat_cpu_total_LMIBLIBS" >&6; }
- if test "${netsnmp_cv_func_perfstat_cpu_total_LMIBLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_perfstat_cpu_total_LMIBLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_perfstat_cpu_total_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_perfstat_cpu_total_LMIBLIBS}" != "xnone required" ; then
        LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -18393,8 +18933,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_open_mib_LMIBLIBS" >&5
 $as_echo "$netsnmp_cv_func_open_mib_LMIBLIBS" >&6; }
- if test "${netsnmp_cv_func_open_mib_LMIBLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_open_mib_LMIBLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_open_mib_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_open_mib_LMIBLIBS}" != "xnone required" ; then
        LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -18430,6 +18970,24 @@ fi
 done
 
 
+for ac_header in lm.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "lm.h" "ac_cv_header_lm_h" "
+#ifdef HAVE_WINDOWS_H
+#include <windows.h>
+#endif
+
+"
+if test "x$ac_cv_header_lm_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LM_H 1
+_ACEOF
+ LAGENTLIBS="$LAGENTLIBS -lnetapi32"
+fi
+
+done
+
+
 #       for MIB-2 info                                  (MinGW)
 #  Core:
 #
@@ -18437,7 +18995,8 @@ if test x$with_socklib = xwinsock2; then
   for ac_header in winsock.h winsock2.h ws2tcpip.h
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "#include <windows.h>
+"
 if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
@@ -18979,12 +19538,14 @@ _ACEOF
 esac
 
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for long long int" >&5
-$as_echo_n "checking for long long int... " >&6; }
-if ${ac_cv_type_long_long_int+:} false; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for unsigned long long int" >&5
+$as_echo_n "checking for unsigned long long int... " >&6; }
+if ${ac_cv_type_unsigned_long_long_int+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+  ac_cv_type_unsigned_long_long_int=yes
+     if test "x${ac_cv_prog_cc_c99-no}" = xno; then
+       cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
   /* For now, do not test the preprocessor; as of 2007 there are too many
@@ -19017,37 +19578,64 @@ main ()
 
 _ACEOF
 if ac_fn_c_try_link "$LINENO"; then :
-  			if test "$cross_compiling" = yes; then :
+
+else
+  ac_cv_type_unsigned_long_long_int=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+     fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_type_unsigned_long_long_int" >&5
+$as_echo "$ac_cv_type_unsigned_long_long_int" >&6; }
+  if test $ac_cv_type_unsigned_long_long_int = yes; then
+
+$as_echo "#define HAVE_UNSIGNED_LONG_LONG_INT 1" >>confdefs.h
+
+  fi
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for long long int" >&5
+$as_echo_n "checking for long long int... " >&6; }
+if ${ac_cv_type_long_long_int+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
   ac_cv_type_long_long_int=yes
+      if test "x${ac_cv_prog_cc_c99-no}" = xno; then
+	ac_cv_type_long_long_int=$ac_cv_type_unsigned_long_long_int
+	if test $ac_cv_type_long_long_int = yes; then
+	  	  	  	  if test "$cross_compiling" = yes; then :
+  :
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <limits.h>
-	       #ifndef LLONG_MAX
-	       # define HALF \
-			(1LL << (sizeof (long long int) * CHAR_BIT - 2))
-	       # define LLONG_MAX (HALF - 1 + HALF)
-	       #endif
+		 #ifndef LLONG_MAX
+		 # define HALF \
+			  (1LL << (sizeof (long long int) * CHAR_BIT - 2))
+		 # define LLONG_MAX (HALF - 1 + HALF)
+		 #endif
 int
 main ()
 {
 long long int n = 1;
-	       int i;
-	       for (i = 0; ; i++)
-		 {
-		   long long int m = n << i;
-		   if (m >> i != n)
-		     return 1;
-		   if (LLONG_MAX / 2 < m)
-		     break;
-		 }
-	       return 0;
+		 int i;
+		 for (i = 0; ; i++)
+		   {
+		     long long int m = n << i;
+		     if (m >> i != n)
+		       return 1;
+		     if (LLONG_MAX / 2 < m)
+		       break;
+		   }
+		 return 0;
   ;
   return 0;
 }
 _ACEOF
 if ac_fn_c_try_run "$LINENO"; then :
-  ac_cv_type_long_long_int=yes
+
 else
   ac_cv_type_long_long_int=no
 fi
@@ -19055,11 +19643,8 @@ rm -f core *.core core.conftest.* gmon.o
   conftest.$ac_objext conftest.beam conftest.$ac_ext
 fi
 
-else
-  ac_cv_type_long_long_int=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
+	fi
+      fi
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_type_long_long_int" >&5
 $as_echo "$ac_cv_type_long_long_int" >&6; }
@@ -19143,60 +19728,6 @@ _ACEOF
   esac
 
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for unsigned long long int" >&5
-$as_echo_n "checking for unsigned long long int... " >&6; }
-if ${ac_cv_type_unsigned_long_long_int+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-  /* For now, do not test the preprocessor; as of 2007 there are too many
-	 implementations with broken preprocessors.  Perhaps this can
-	 be revisited in 2012.  In the meantime, code should not expect
-	 #if to work with literals wider than 32 bits.  */
-      /* Test literals.  */
-      long long int ll = 9223372036854775807ll;
-      long long int nll = -9223372036854775807LL;
-      unsigned long long int ull = 18446744073709551615ULL;
-      /* Test constant expressions.   */
-      typedef int a[((-9223372036854775807LL < 0 && 0 < 9223372036854775807ll)
-		     ? 1 : -1)];
-      typedef int b[(18446744073709551615ULL <= (unsigned long long int) -1
-		     ? 1 : -1)];
-      int i = 63;
-int
-main ()
-{
-/* Test availability of runtime routines for shift and division.  */
-      long long int llmax = 9223372036854775807ll;
-      unsigned long long int ullmax = 18446744073709551615ull;
-      return ((ll << 63) | (ll >> 63) | (ll < i) | (ll > i)
-	      | (llmax / ll) | (llmax % ll)
-	      | (ull << 63) | (ull >> 63) | (ull << i) | (ull >> i)
-	      | (ullmax / ull) | (ullmax % ull));
-  ;
-  return 0;
-}
-
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_type_unsigned_long_long_int=yes
-else
-  ac_cv_type_unsigned_long_long_int=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_type_unsigned_long_long_int" >&5
-$as_echo "$ac_cv_type_unsigned_long_long_int" >&6; }
-  if test $ac_cv_type_unsigned_long_long_int = yes; then
-
-$as_echo "#define HAVE_UNSIGNED_LONG_LONG_INT 1" >>confdefs.h
-
-  fi
-
-
 
   ac_fn_c_check_type "$LINENO" "uintmax_t" "ac_cv_type_uintmax_t" "$ac_includes_default"
 if test "x$ac_cv_type_uintmax_t" = xyes; then :
@@ -19230,7 +19761,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(sizeof (void *) <= sizeof ($ac_type))];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -19266,7 +19798,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(sizeof (void *) <= sizeof ($ac_type))];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -19343,6 +19876,25 @@ fi
 #         the later 'config_types' sub-script
 #
 
+#  Darwin: check whether or not struct in_ifaddr is available.
+#
+#
+ac_fn_c_check_member "$LINENO" "struct in_ifaddr" "ia_subnetmask" "ac_cv_member_struct_in_ifaddr_ia_subnetmask" "
+#ifdef HAVE_NETINET_IN_VAR_H
+#include <netinet/in_var.h>
+#endif
+
+"
+if test "x$ac_cv_member_struct_in_ifaddr_ia_subnetmask" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_IN_IFADDR_IA_SUBNETMASK 1
+_ACEOF
+
+
+fi
+
+
 
 ##
 #   Determine the IPv6 stack type
@@ -19353,14 +19905,13 @@ fi
 #
 
 if test "x$enable_ipv6" = "xyes"; then
-	v6type=unknown
 	v6lib=none
 	v6trylibc=no
 
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking ipv6 stack type" >&5
 $as_echo_n "checking ipv6 stack type... " >&6; }
-	for i in v6d toshiba kame inria zeta linux-glibc linux-inet6 cygwin winsock2 generic; do
-		case $i in
+	for v6type in v6d toshiba kame zeta generic; do
+		case $v6type in
 		v6d)
 			cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
@@ -19372,7 +19923,7 @@ yes
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
   $EGREP "yes" >/dev/null 2>&1; then :
-  v6type=$i; v6lib=v6;
+  v6lib=v6;
 				v6libdir=/usr/local/v6/lib;
 				CFLAGS="-I/usr/local/v6/include $CFLAGS"
 fi
@@ -19390,7 +19941,7 @@ yes
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
   $EGREP "yes" >/dev/null 2>&1; then :
-  v6type=$i; v6lib=inet6;
+  v6lib=inet6;
 				v6libdir=/usr/local/v6/lib;
 				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"
 fi
@@ -19408,7 +19959,7 @@ yes
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
   $EGREP "yes" >/dev/null 2>&1; then :
-  v6type=$i; v6lib=inet6;
+  v6lib=inet6;
 				v6libdir=/usr/local/v6/lib;
 				v6trylibc=yes;
 				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"
@@ -19416,117 +19967,34 @@ fi
 rm -f conftest*
 
 			;;
-		inria)
-			cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include <netinet/in.h>
-#ifdef IPV6_INRIA_VERSION
-yes
-#endif
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "yes" >/dev/null 2>&1; then :
-  v6type=$i;
-				v6lib=dummy;
-				v6libdir=none;
-				v6trylibc=yes;
-				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"
-fi
-rm -f conftest*
-
-			;;
 		zeta)
 			cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 #include <sys/param.h>
 #ifdef _ZETA_MINAMI_INET6
-A
 yes
 #endif
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
   $EGREP "yes" >/dev/null 2>&1; then :
-  v6type=$i; v6lib=inet6;
+  v6lib=inet6;
 				v6libdir=/usr/local/v6/lib;
 				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"
 fi
 rm -f conftest*
 
 			;;
-		linux-glibc)
-			cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include <features.h>
-#if defined(__GLIBC__) && ((__GLIBC__ == 2 && __GLIBC_MINOR__ >= 1) || (__GLIBC_ > 2))
-yes
-#endif
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "yes" >/dev/null 2>&1; then :
-  v6type=$i;
-				v6lib=dummy;
-				v6libdir=none;
-				v6trylibc=yes;
-				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"
-fi
-rm -f conftest*
-
-			;;
-		linux-inet6)
-			if test -d /usr/inet6; then
-				v6type=$i
-				v6lib=inet6
-				v6libdir=/usr/inet6/lib
-				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"
-			fi
-			;;
-		cygwin)
-			cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include <netinet/in.h>
-#ifdef _CYGWIN_IN6_H
-yes
-#endif
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "yes" >/dev/null 2>&1; then :
-  v6type=$i;
-				v6lib=dummy;
-				v6libdir=none
-				v6trylibc=yes;
-				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"
-fi
-rm -f conftest*
-
-                       ;;
-		winsock2)
-			cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include <ws2tcpip.h>
-#if defined(_WS2TCPIP_H)
-yes
-#endif
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "yes" >/dev/null 2>&1; then :
-  v6type=$i;
-				v6lib=dummy;
-				v6libdir=none
-				v6trylibc=yes;
-				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"
-fi
-rm -f conftest*
-
-			;;
 		generic)
                         { $as_echo "$as_me:${as_lineno-$LINENO}: result: postponed" >&5
 $as_echo "postponed" >&6; }
-			ac_fn_c_check_member "$LINENO" "struct sockaddr_in6" "sin6_addr" "ac_cv_member_struct_sockaddr_in6_sin6_addr" "
+                        ac_fn_c_check_member "$LINENO" "struct sockaddr_in6" "sin6_addr" "ac_cv_member_struct_sockaddr_in6_sin6_addr" "
+#ifdef HAVE_WINSOCK2_H
+#include <winsock2.h>
+#ifdef HAVE_WS2TCPIP_H
+#include <ws2tcpip.h>
+#endif
+#endif
 $ac_includes_default
 #ifdef HAVE_SYS_PARAM_H
 #include <sys/param.h>
@@ -19546,7 +20014,6 @@ fi
 	                { $as_echo "$as_me:${as_lineno-$LINENO}: checking ipv6 stack type" >&5
 $as_echo_n "checking ipv6 stack type... " >&6; }
                         if test "x$ac_cv_member_struct_sockaddr_in6_sin6_addr" = "xyes"; then
-				v6type=$i
 				v6lib=dummy
 				v6libdir=none
 				v6trylibc=yes
@@ -19554,7 +20021,7 @@ $as_echo_n "checking ipv6 stack type...
                         fi
 			;;
 		esac
-		if test "$v6type" != "unknown"; then
+		if test "$v6lib" != "none"; then
 			break
 		fi
 	done
@@ -19574,6 +20041,7 @@ $as_echo "\"$v6type, $enable_ipv6, using
 			exit 1
 		fi
 	else
+		v6type="unknown"
 		enable_ipv6="no"
 		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: \"$v6type, $enable_ipv6\"" >&5
 $as_echo "\"$v6type, $enable_ipv6\"" >&6; }
@@ -19637,7 +20105,7 @@ if test "x$PARTIALTARGETOS" = "xmingw32"
 fi
 
 # Linux systemd
-if test "x$with_systemd" == "xyes"; then
+if test "x$with_systemd" = "xyes"; then
   other_src_list="$other_src_list sd-daemon.c"
   other_objs_list="$other_objs_list sd-daemon.o"
   other_lobjs_list="$other_lobjs_list sd-daemon.lo"
@@ -19955,6 +20423,9 @@ EOF
 rebuilt_new_with_security=
 already_checked_krb5=no
 
+netsnmp_save_LIBS=$LIBS
+CRYPTO_LIBS=""
+
 for sec in $new_with_security
 do
   if test "x$sec" = "xksm"; then
@@ -19993,7 +20464,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_krb5_config="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -20018,8 +20489,11 @@ fi
 
 
     if test no != $krb5_config; then
+
       CPPFLAGS="$CPPFLAGS `$krb5_config --cflags`"
-      LIBS="$LIBS `$krb5_config --libs`"
+      CRYPTO_LIBS="$CRYPTO_LIBS `$krb5_config --libs |
+				 $SED 's/-flto=[^[:blank:]]*//g'`"
+
     elif test $krb5path != no; then
 
   if test "x$krb5path" != x -a -d $krb5path; then
@@ -20044,19 +20518,18 @@ fi
 
     fi
 
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for krb5" >&5
-$as_echo_n "checking for krb5... " >&6; }
-    if ${ac_cv_have_krb5+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for krb5_init_context in -lkrb5" >&5
-$as_echo_n "checking for krb5_init_context in -lkrb5... " >&6; }
-if ${ac_cv_lib_krb5_krb5_init_context+:} false; then :
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing krb5_init_context" >&5
+$as_echo_n "checking for library containing krb5_init_context... " >&6; }
+if ${netsnmp_cv_func_krb5_init_context_CRYPTO_LIBS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lkrb5  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+  netsnmp_func_search_save_LIBS="$LIBS"
+     netsnmp_target_val="$CRYPTO_LIBS"
+          netsnmp_temp_LIBS="${netsnmp_target_val}  ${LIBS}"
+     netsnmp_result=no
+     LIBS="${netsnmp_temp_LIBS}"
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -20075,27 +20548,130 @@ return krb5_init_context ();
 }
 _ACEOF
 if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_krb5_krb5_init_context=yes
+  netsnmp_result="none required"
 else
-  ac_cv_lib_krb5_krb5_init_context=no
+  for netsnmp_cur_lib in krb5 ; do
+              LIBS="-l${netsnmp_cur_lib} ${netsnmp_temp_LIBS}"
+              cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char krb5_init_context ();
+int
+main ()
+{
+return krb5_init_context ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  netsnmp_result=-l${netsnmp_cur_lib}
+                   break
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+          done
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+     LIBS="${netsnmp_func_search_save_LIBS}"
+     netsnmp_cv_func_krb5_init_context_CRYPTO_LIBS="${netsnmp_result}"
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_krb5_krb5_init_context" >&5
-$as_echo "$ac_cv_lib_krb5_krb5_init_context" >&6; }
-if test "x$ac_cv_lib_krb5_krb5_init_context" = xyes; then :
-  ac_cv_have_krb5=yes
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_krb5_init_context_CRYPTO_LIBS" >&5
+$as_echo "$netsnmp_cv_func_krb5_init_context_CRYPTO_LIBS" >&6; }
+ if test "x${netsnmp_cv_func_krb5_init_context_CRYPTO_LIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_krb5_init_context_CRYPTO_LIBS}" != "xnone required" ; then
+       CRYPTO_LIBS="${netsnmp_result} ${netsnmp_target_val}"
+    fi
+    ac_cv_have_krb5=yes
+ else
+    ac_cv_have_krb5=no
+ fi
+
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing error_message" >&5
+$as_echo_n "checking for library containing error_message... " >&6; }
+if ${netsnmp_cv_func_error_message_CRYPTO_LIBS+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  netsnmp_func_search_save_LIBS="$LIBS"
+     netsnmp_target_val="$CRYPTO_LIBS"
+          netsnmp_temp_LIBS="${netsnmp_target_val}  ${LIBS}"
+     netsnmp_result=no
+     LIBS="${netsnmp_temp_LIBS}"
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char error_message ();
+int
+main ()
+{
+return error_message ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  netsnmp_result="none required"
 else
-  ac_cv_have_krb5=no
+  for netsnmp_cur_lib in com_err ; do
+              LIBS="-l${netsnmp_cur_lib} ${netsnmp_temp_LIBS}"
+              cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char error_message ();
+int
+main ()
+{
+return error_message ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  netsnmp_result=-l${netsnmp_cur_lib}
+                   break
 fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+          done
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+     LIBS="${netsnmp_func_search_save_LIBS}"
+     netsnmp_cv_func_error_message_CRYPTO_LIBS="${netsnmp_result}"
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_error_message_CRYPTO_LIBS" >&5
+$as_echo "$netsnmp_cv_func_error_message_CRYPTO_LIBS" >&6; }
+ if test "x${netsnmp_cv_func_error_message_CRYPTO_LIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_error_message_CRYPTO_LIBS}" != "xnone required" ; then
+       CRYPTO_LIBS="${netsnmp_result} ${netsnmp_target_val}"
+    fi
 
 
-fi
+ fi
 
 
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for krb5" >&5
+$as_echo_n "checking for krb5... " >&6; }
     if test $ac_cv_have_krb5 = no; then
       if test "x$askedkrb5" = "xyes"; then
 	as_fn_error $? "Asked to use krb5 but I couldn't find it." "$LINENO" 5
@@ -20141,25 +20717,27 @@ $as_echo "$ac_cv_heimdal" >&6; }
 $as_echo "#define NETSNMP_USE_KERBEROS_HEIMDAL 1" >>confdefs.h
 
       if test no = $krb5_config; then
-	LIBS="$LIBS -lkrb5 -lasn1 -lcom_err -lroken"
+	CRYPTO_LIBS="$CRYPTO_LIBS -lkrb5 -lasn1 -lcom_err -lroken"
       fi
     elif test no = $krb5_config; then
-	LIBS="$LIBS -lkrb5 -lcom_err"
+	CRYPTO_LIBS="$CRYPTO_LIBS -lkrb5 -lcom_err"
     fi
 
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see which crypto API we need to use" >&5
-$as_echo_n "checking to see which crypto API we need to use... " >&6; }
     if ${ac_cv_NETSNMP_USE_KERBEROS_MIT+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for krb5_init_context in -lk5crypto" >&5
-$as_echo_n "checking for krb5_init_context in -lk5crypto... " >&6; }
-if ${ac_cv_lib_k5crypto_krb5_init_context+:} false; then :
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing krb5_init_context" >&5
+$as_echo_n "checking for library containing krb5_init_context... " >&6; }
+if ${netsnmp_cv_func_krb5_init_context_CRYPTO_LIBS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lk5crypto  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+  netsnmp_func_search_save_LIBS="$LIBS"
+     netsnmp_target_val="$CRYPTO_LIBS"
+          netsnmp_temp_LIBS="${netsnmp_target_val}  ${LIBS}"
+     netsnmp_result=no
+     LIBS="${netsnmp_temp_LIBS}"
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -20178,40 +20756,158 @@ return krb5_init_context ();
 }
 _ACEOF
 if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_k5crypto_krb5_init_context=yes
+  netsnmp_result="none required"
 else
-  ac_cv_lib_k5crypto_krb5_init_context=no
+  for netsnmp_cur_lib in k5crypto ; do
+              LIBS="-l${netsnmp_cur_lib} ${netsnmp_temp_LIBS}"
+              cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char krb5_init_context ();
+int
+main ()
+{
+return krb5_init_context ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  netsnmp_result=-l${netsnmp_cur_lib}
+                   break
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+          done
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+     LIBS="${netsnmp_func_search_save_LIBS}"
+     netsnmp_cv_func_krb5_init_context_CRYPTO_LIBS="${netsnmp_result}"
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_k5crypto_krb5_init_context" >&5
-$as_echo "$ac_cv_lib_k5crypto_krb5_init_context" >&6; }
-if test "x$ac_cv_lib_k5crypto_krb5_init_context" = xyes; then :
-  ac_cv_NETSNMP_USE_KERBEROS_MIT=yes
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_krb5_init_context_CRYPTO_LIBS" >&5
+$as_echo "$netsnmp_cv_func_krb5_init_context_CRYPTO_LIBS" >&6; }
+ if test "x${netsnmp_cv_func_krb5_init_context_CRYPTO_LIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_krb5_init_context_CRYPTO_LIBS}" != "xnone required" ; then
+       CRYPTO_LIBS="${netsnmp_result} ${netsnmp_target_val}"
+    fi
+    ac_cv_NETSNMP_USE_KERBEROS_MIT=yes
+ else
+    ac_cv_NETSNMP_USE_KERBEROS_MIT=no
+ fi
+
+
+fi
+
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing krb5_c_keyed_checksum_types" >&5
+$as_echo_n "checking for library containing krb5_c_keyed_checksum_types... " >&6; }
+if ${netsnmp_cv_func_krb5_c_keyed_checksum_types_CRYPTO_LIBS+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  ac_cv_NETSNMP_USE_KERBEROS_MIT=no
+  netsnmp_func_search_save_LIBS="$LIBS"
+     netsnmp_target_val="$CRYPTO_LIBS"
+          netsnmp_temp_LIBS="${netsnmp_target_val}  ${LIBS}"
+     netsnmp_result=no
+     LIBS="${netsnmp_temp_LIBS}"
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char krb5_c_keyed_checksum_types ();
+int
+main ()
+{
+return krb5_c_keyed_checksum_types ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  netsnmp_result="none required"
+else
+  for netsnmp_cur_lib in k5crypto ; do
+              LIBS="-l${netsnmp_cur_lib} ${netsnmp_temp_LIBS}"
+              cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char krb5_c_keyed_checksum_types ();
+int
+main ()
+{
+return krb5_c_keyed_checksum_types ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  netsnmp_result=-l${netsnmp_cur_lib}
+                   break
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+          done
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+     LIBS="${netsnmp_func_search_save_LIBS}"
+     netsnmp_cv_func_krb5_c_keyed_checksum_types_CRYPTO_LIBS="${netsnmp_result}"
 fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_krb5_c_keyed_checksum_types_CRYPTO_LIBS" >&5
+$as_echo "$netsnmp_cv_func_krb5_c_keyed_checksum_types_CRYPTO_LIBS" >&6; }
+ if test "x${netsnmp_cv_func_krb5_c_keyed_checksum_types_CRYPTO_LIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_krb5_c_keyed_checksum_types_CRYPTO_LIBS}" != "xnone required" ; then
+       CRYPTO_LIBS="${netsnmp_result} ${netsnmp_target_val}"
+    fi
+
+
+ fi
+
+
+    ac_fn_c_check_member "$LINENO" "krb5_keyblock" "enctype" "ac_cv_member_krb5_keyblock_enctype" "#include <krb5.h>
+"
+if test "x$ac_cv_member_krb5_keyblock_enctype" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_KRB5_KEYBLOCK_ENCTYPE 1
+_ACEOF
 
 
+else
+  ac_cv_NETSNMP_USE_KERBEROS_MIT=no
 fi
 
 
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see which crypto API we need to use" >&5
+$as_echo_n "checking to see which crypto API we need to use... " >&6; }
     if test yes = $ac_cv_NETSNMP_USE_KERBEROS_MIT; then
       { $as_echo "$as_me:${as_lineno-$LINENO}: result: new MIT crypto API" >&5
 $as_echo "new MIT crypto API" >&6; }
 
 $as_echo "#define NETSNMP_USE_KERBEROS_MIT 1" >>confdefs.h
 
-      if test no = $krb5_config; then
-	LIBS="$LIBS -lk5crypto"
-      fi
     else
       { $as_echo "$as_me:${as_lineno-$LINENO}: result: old MIT crypto API" >&5
 $as_echo "old MIT crypto API" >&6; }
     fi
+    LIBS="$CRYPTO_LIBS $netsnmp_save_LIBS"
     for ac_func in krb5_auth_con_getsendsubkey krb5_auth_con_getrecvsubkey
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
@@ -20227,6 +20923,9 @@ done
   fi
 done
 
+LNETSNMPLIBS="$LNETSNMPLIBS $CRYPTO_LIBS"
+LIBS=$netsnmp_save_LIBS
+
 new_with_security=$rebuilt_new_with_security
 
 #
@@ -20466,8 +21165,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_rpmGetPath__rpmlibs" >&5
 $as_echo "$netsnmp_cv_func_rpmGetPath__rpmlibs" >&6; }
- if test "${netsnmp_cv_func_rpmGetPath__rpmlibs}" != "no" ; then
-    if test "${netsnmp_cv_func_rpmGetPath__rpmlibs}" != "none required" ; then
+ if test "x${netsnmp_cv_func_rpmGetPath__rpmlibs}" != "xno" ; then
+    if test "x${netsnmp_cv_func_rpmGetPath__rpmlibs}" != "xnone required" ; then
        _rpmlibs="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -20543,8 +21242,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_rpmdbOpen__rpmlibs" >&5
 $as_echo "$netsnmp_cv_func_rpmdbOpen__rpmlibs" >&6; }
- if test "${netsnmp_cv_func_rpmdbOpen__rpmlibs}" != "no" ; then
-    if test "${netsnmp_cv_func_rpmdbOpen__rpmlibs}" != "none required" ; then
+ if test "x${netsnmp_cv_func_rpmdbOpen__rpmlibs}" != "xno" ; then
+    if test "x${netsnmp_cv_func_rpmdbOpen__rpmlibs}" != "xnone required" ; then
        _rpmlibs="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -20619,8 +21318,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_rpmReadConfigFiles__rpmlibs" >&5
 $as_echo "$netsnmp_cv_func_rpmReadConfigFiles__rpmlibs" >&6; }
- if test "${netsnmp_cv_func_rpmReadConfigFiles__rpmlibs}" != "no" ; then
-    if test "${netsnmp_cv_func_rpmReadConfigFiles__rpmlibs}" != "none required" ; then
+ if test "x${netsnmp_cv_func_rpmReadConfigFiles__rpmlibs}" != "xno" ; then
+    if test "x${netsnmp_cv_func_rpmReadConfigFiles__rpmlibs}" != "xnone required" ; then
        _rpmlibs="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -20673,8 +21372,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_headerGet_LIBS" >&5
 $as_echo "$netsnmp_cv_func_headerGet_LIBS" >&6; }
- if test "${netsnmp_cv_func_headerGet_LIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_headerGet_LIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_headerGet_LIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_headerGet_LIBS}" != "xnone required" ; then
        LIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -20906,13 +21605,18 @@ done
 #
 # diskIOLAx requires exp which may require -lm
 #
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing exp" >&5
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing exp" >&5
 $as_echo_n "checking for library containing exp... " >&6; }
-if ${ac_cv_search_exp+:} false; then :
+if ${netsnmp_cv_func_exp_LMIBLIBS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  ac_func_search_save_LIBS=$LIBS
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+  netsnmp_func_search_save_LIBS="$LIBS"
+     netsnmp_target_val="$LMIBLIBS"
+          netsnmp_temp_LIBS="${netsnmp_target_val}  ${LIBS}"
+     netsnmp_result=no
+     LIBS="${netsnmp_temp_LIBS}"
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -20930,37 +21634,51 @@ return exp ();
   return 0;
 }
 _ACEOF
-for ac_lib in '' m; do
-  if test -z "$ac_lib"; then
-    ac_res="none required"
-  else
-    ac_res=-l$ac_lib
-    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
-  fi
-  if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_search_exp=$ac_res
+if ac_fn_c_try_link "$LINENO"; then :
+  netsnmp_result="none required"
+else
+  for netsnmp_cur_lib in m ; do
+              LIBS="-l${netsnmp_cur_lib} ${netsnmp_temp_LIBS}"
+              cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char exp ();
+int
+main ()
+{
+return exp ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  netsnmp_result=-l${netsnmp_cur_lib}
+                   break
 fi
 rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext
-  if ${ac_cv_search_exp+:} false; then :
-  break
-fi
-done
-if ${ac_cv_search_exp+:} false; then :
-
-else
-  ac_cv_search_exp=no
+    conftest$ac_exeext conftest.$ac_ext
+          done
 fi
-rm conftest.$ac_ext
-LIBS=$ac_func_search_save_LIBS
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+     LIBS="${netsnmp_func_search_save_LIBS}"
+     netsnmp_cv_func_exp_LMIBLIBS="${netsnmp_result}"
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_exp" >&5
-$as_echo "$ac_cv_search_exp" >&6; }
-ac_res=$ac_cv_search_exp
-if test "$ac_res" != no; then :
-  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_exp_LMIBLIBS" >&5
+$as_echo "$netsnmp_cv_func_exp_LMIBLIBS" >&6; }
+ if test "x${netsnmp_cv_func_exp_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_exp_LMIBLIBS}" != "xnone required" ; then
+       LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
+    fi
 
-fi
+
+ fi
 
 
 #
@@ -21033,8 +21751,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_kvm_read_LAGENTLIBS" >&5
 $as_echo "$netsnmp_cv_func_kvm_read_LAGENTLIBS" >&6; }
- if test "${netsnmp_cv_func_kvm_read_LAGENTLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_kvm_read_LAGENTLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_kvm_read_LAGENTLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_kvm_read_LAGENTLIBS}" != "xnone required" ; then
        LAGENTLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -21108,8 +21826,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_kvm_openfiles_LAGENTLIBS" >&5
 $as_echo "$netsnmp_cv_func_kvm_openfiles_LAGENTLIBS" >&6; }
- if test "${netsnmp_cv_func_kvm_openfiles_LAGENTLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_kvm_openfiles_LAGENTLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_kvm_openfiles_LAGENTLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_kvm_openfiles_LAGENTLIBS}" != "xnone required" ; then
        LAGENTLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -21183,8 +21901,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_kvm_getprocs_LMIBLIBS" >&5
 $as_echo "$netsnmp_cv_func_kvm_getprocs_LMIBLIBS" >&6; }
- if test "${netsnmp_cv_func_kvm_getprocs_LMIBLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_kvm_getprocs_LMIBLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_kvm_getprocs_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_kvm_getprocs_LMIBLIBS}" != "xnone required" ; then
        LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -21258,8 +21976,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_kvm_getproc2_LMIBLIBS" >&5
 $as_echo "$netsnmp_cv_func_kvm_getproc2_LMIBLIBS" >&6; }
- if test "${netsnmp_cv_func_kvm_getproc2_LMIBLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_kvm_getproc2_LMIBLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_kvm_getproc2_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_kvm_getproc2_LMIBLIBS}" != "xnone required" ; then
        LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -21333,8 +22051,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_kvm_getfiles_LMIBLIBS" >&5
 $as_echo "$netsnmp_cv_func_kvm_getfiles_LMIBLIBS" >&6; }
- if test "${netsnmp_cv_func_kvm_getfiles_LMIBLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_kvm_getfiles_LMIBLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_kvm_getfiles_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_kvm_getfiles_LMIBLIBS}" != "xnone required" ; then
        LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -21408,8 +22126,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_kvm_getfile2_LMIBLIBS" >&5
 $as_echo "$netsnmp_cv_func_kvm_getfile2_LMIBLIBS" >&6; }
- if test "${netsnmp_cv_func_kvm_getfile2_LMIBLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_kvm_getfile2_LMIBLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_kvm_getfile2_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_kvm_getfile2_LMIBLIBS}" != "xnone required" ; then
        LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -21483,8 +22201,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_kvm_getswapinfo_LMIBLIBS" >&5
 $as_echo "$netsnmp_cv_func_kvm_getswapinfo_LMIBLIBS" >&6; }
- if test "${netsnmp_cv_func_kvm_getswapinfo_LMIBLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_kvm_getswapinfo_LMIBLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_kvm_getswapinfo_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_kvm_getswapinfo_LMIBLIBS}" != "xnone required" ; then
        LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -21577,8 +22295,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_dlopen_LMIBLIBS" >&5
 $as_echo "$netsnmp_cv_func_dlopen_LMIBLIBS" >&6; }
- if test "${netsnmp_cv_func_dlopen_LMIBLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_dlopen_LMIBLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_dlopen_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_dlopen_LMIBLIBS}" != "xnone required" ; then
        LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -21603,22 +22321,22 @@ LIBS="$netsnmp_save_LIBS"
 #
 #   regex in process table
 #
-ac_fn_c_check_header_mongrel "$LINENO" "pcre.h" "ac_cv_header_pcre_h" "$ac_includes_default"
+if test "x$with_pcre" != "xno"; then
+  ac_fn_c_check_header_mongrel "$LINENO" "pcre.h" "ac_cv_header_pcre_h" "$ac_includes_default"
 if test "x$ac_cv_header_pcre_h" = xyes; then :
 
 
 $as_echo "#define HAVE_PCRE_H 1" >>confdefs.h
 
-    pcre_h=yes
+      pcre_h=yes
 
 else
-
-    pcre_h=no
-
+  pcre_h=no
 
 fi
 
 
+fi
 if test "x$pcreheader_h" = "xno" -o "x$pcre_h" = "xno" ; then
   if test "x$with_pcre" = "xyes" ; then
     as_fn_error $? "Could not find the pcre header file needed and was specifically asked to use pcre support" "$LINENO" 5
@@ -21630,16 +22348,14 @@ fi
 #
 # pcre libraries only needed for the ucd process agent mib software
 #
-if test "x$with_pcre" != "xno"; then
-  _pcrelibs=""
 
  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing pcre_exec" >&5
 $as_echo_n "checking for library containing pcre_exec... " >&6; }
-if ${netsnmp_cv_func_pcre_exec__pcrelibs+:} false; then :
+if ${netsnmp_cv_func_pcre_exec_LAGENTLIBS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   netsnmp_func_search_save_LIBS="$LIBS"
-     netsnmp_target_val="$_pcrelibs"
+     netsnmp_target_val="$LAGENTLIBS"
           netsnmp_temp_LIBS="${netsnmp_target_val}  ${LIBS}"
      netsnmp_result=no
      LIBS="${netsnmp_temp_LIBS}"
@@ -21695,23 +22411,22 @@ fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
      LIBS="${netsnmp_func_search_save_LIBS}"
-     netsnmp_cv_func_pcre_exec__pcrelibs="${netsnmp_result}"
+     netsnmp_cv_func_pcre_exec_LAGENTLIBS="${netsnmp_result}"
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_pcre_exec__pcrelibs" >&5
-$as_echo "$netsnmp_cv_func_pcre_exec__pcrelibs" >&6; }
- if test "${netsnmp_cv_func_pcre_exec__pcrelibs}" != "no" ; then
-    if test "${netsnmp_cv_func_pcre_exec__pcrelibs}" != "none required" ; then
-       _pcrelibs="${netsnmp_result} ${netsnmp_target_val}"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_pcre_exec_LAGENTLIBS" >&5
+$as_echo "$netsnmp_cv_func_pcre_exec_LAGENTLIBS" >&6; }
+ if test "x${netsnmp_cv_func_pcre_exec_LAGENTLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_pcre_exec_LAGENTLIBS}" != "xnone required" ; then
+       LAGENTLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
+  LMIBLIBS="$LMIBLIBS -lpcre"
+
 
  fi
 
-  if test "x$_pcrelibs" != "x"; then
-    LAGENTLIBS="$LAGENTLIBS $_pcrelibs"
-    LMIBLIBS="$LMIBLIBS $_pcrelibs"
-  fi
-fi
+
+
 
 # -*- autoconf -*-
 #
@@ -22754,157 +23469,6 @@ fi
 #   Simple checks:
 ##
 
-# AC_CHECK_LIB(des, main)
-# AC_CHECK_LIB(m,   asin)
-
-#   dmalloc
-#
-if test "${with_dmalloc+set}" = set; then
-   if test "$with_dmalloc" = yes -a -d $with_dmalloc ; then
-
-  if test "x$with_dmalloc" != x -a -d $with_dmalloc; then
-     if test -d $with_dmalloc/lib; then
-       LDFLAGS="-L$with_dmalloc/lib $LDFLAGS"
-     fi
-     if test -d $with_dmalloc/include; then
-	CPPFLAGS="-I$with_dmalloc/include $CPPFLAGS"
-     fi
-  fi
-
-   fi
-   for ac_header in dmalloc.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "dmalloc.h" "ac_cv_header_dmalloc_h" "$ac_includes_default"
-if test "x$ac_cv_header_dmalloc_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_DMALLOC_H 1
-_ACEOF
-
-fi
-
-done
-
-   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing dmalloc_message" >&5
-$as_echo_n "checking for library containing dmalloc_message... " >&6; }
-if ${ac_cv_search_dmalloc_message+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_func_search_save_LIBS=$LIBS
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char dmalloc_message ();
-int
-main ()
-{
-return dmalloc_message ();
-  ;
-  return 0;
-}
-_ACEOF
-for ac_lib in '' dmalloc; do
-  if test -z "$ac_lib"; then
-    ac_res="none required"
-  else
-    ac_res=-l$ac_lib
-    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
-  fi
-  if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_search_dmalloc_message=$ac_res
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext
-  if ${ac_cv_search_dmalloc_message+:} false; then :
-  break
-fi
-done
-if ${ac_cv_search_dmalloc_message+:} false; then :
-
-else
-  ac_cv_search_dmalloc_message=no
-fi
-rm conftest.$ac_ext
-LIBS=$ac_func_search_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_dmalloc_message" >&5
-$as_echo "$ac_cv_search_dmalloc_message" >&6; }
-ac_res=$ac_cv_search_dmalloc_message
-if test "$ac_res" != no; then :
-  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
-
-fi
-
-fi
-
-#   EFence
-#       (This used to be on by default for developer checkout)
-#
-if test "x$use_efence" = "xyes"; then
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing EF_Exit" >&5
-$as_echo_n "checking for library containing EF_Exit... " >&6; }
-if ${ac_cv_search_EF_Exit+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_func_search_save_LIBS=$LIBS
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char EF_Exit ();
-int
-main ()
-{
-return EF_Exit ();
-  ;
-  return 0;
-}
-_ACEOF
-for ac_lib in '' efence; do
-  if test -z "$ac_lib"; then
-    ac_res="none required"
-  else
-    ac_res=-l$ac_lib
-    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
-  fi
-  if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_search_EF_Exit=$ac_res
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext
-  if ${ac_cv_search_EF_Exit+:} false; then :
-  break
-fi
-done
-if ${ac_cv_search_EF_Exit+:} false; then :
-
-else
-  ac_cv_search_EF_Exit=no
-fi
-rm conftest.$ac_ext
-LIBS=$ac_func_search_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_EF_Exit" >&5
-$as_echo "$ac_cv_search_EF_Exit" >&6; }
-ac_res=$ac_cv_search_EF_Exit
-if test "$ac_res" != no; then :
-  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
-
-fi
-
-fi
-
-
 #   ELF libraries
 #       Typically used for 'nlist'  (needed for uptime)
 #
@@ -23379,6 +23943,40 @@ fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for MIB_IF_TABLE2" >&5
+$as_echo_n "checking for MIB_IF_TABLE2... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+  #define _WIN32_WINNT 0xffff
+  #include <winsock2.h>
+  #include <ws2tcpip.h>
+  #include <iphlpapi.h>
+
+int
+main ()
+{
+
+  return sizeof(MIB_IF_TABLE2)
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+
+$as_echo "#define HAVE_MIB_IF_TABLE2 1" >>confdefs.h
+
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
 
 #   libregex                                            (MinGW)
 #
@@ -23608,8 +24206,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_clock_gettime_LNETSNMPLIBS" >&5
 $as_echo "$netsnmp_cv_func_clock_gettime_LNETSNMPLIBS" >&6; }
- if test "${netsnmp_cv_func_clock_gettime_LNETSNMPLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_clock_gettime_LNETSNMPLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_clock_gettime_LNETSNMPLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_clock_gettime_LNETSNMPLIBS}" != "xnone required" ; then
        LNETSNMPLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -23698,8 +24296,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_getdevs_LMIBLIBS" >&5
 $as_echo "$netsnmp_cv_func_getdevs_LMIBLIBS" >&6; }
- if test "${netsnmp_cv_func_getdevs_LMIBLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_getdevs_LMIBLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_getdevs_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_getdevs_LMIBLIBS}" != "xnone required" ; then
        LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -23775,8 +24373,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_devstat_getdevs_LMIBLIBS" >&5
 $as_echo "$netsnmp_cv_func_devstat_getdevs_LMIBLIBS" >&6; }
- if test "${netsnmp_cv_func_devstat_getdevs_LMIBLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_devstat_getdevs_LMIBLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_devstat_getdevs_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_devstat_getdevs_LMIBLIBS}" != "xnone required" ; then
        LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -23857,8 +24455,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_pci_lookup_name_LMIBLIBS" >&5
 $as_echo "$netsnmp_cv_func_pci_lookup_name_LMIBLIBS" >&6; }
- if test "${netsnmp_cv_func_pci_lookup_name_LMIBLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_pci_lookup_name_LMIBLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_pci_lookup_name_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_pci_lookup_name_LMIBLIBS}" != "xnone required" ; then
        LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -23975,8 +24573,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_sensors_get_detected_chips_LMIBLIBS" >&5
 $as_echo "$netsnmp_cv_func_sensors_get_detected_chips_LMIBLIBS" >&6; }
- if test "${netsnmp_cv_func_sensors_get_detected_chips_LMIBLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_sensors_get_detected_chips_LMIBLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_sensors_get_detected_chips_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_sensors_get_detected_chips_LMIBLIBS}" != "xnone required" ; then
        LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -24039,7 +24637,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -24082,7 +24680,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_ac_pt_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -24237,12 +24835,12 @@ fi
 
  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing nl_connect" >&5
 $as_echo_n "checking for library containing nl_connect... " >&6; }
-if ${netsnmp_cv_func_nl_connect_LIBS+:} false; then :
+if ${netsnmp_cv_func_nl_connect_LMIBLIBS+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   netsnmp_func_search_save_LIBS="$LIBS"
-     netsnmp_target_val="$LIBS"
-          netsnmp_temp_LIBS=" ${LIBS}"
+     netsnmp_target_val="$LMIBLIBS"
+          netsnmp_temp_LIBS="${netsnmp_target_val}  ${LIBS}"
      netsnmp_result=no
      LIBS="${netsnmp_temp_LIBS}"
      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -24297,13 +24895,13 @@ fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
      LIBS="${netsnmp_func_search_save_LIBS}"
-     netsnmp_cv_func_nl_connect_LIBS="${netsnmp_result}"
+     netsnmp_cv_func_nl_connect_LMIBLIBS="${netsnmp_result}"
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_nl_connect_LIBS" >&5
-$as_echo "$netsnmp_cv_func_nl_connect_LIBS" >&6; }
- if test "${netsnmp_cv_func_nl_connect_LIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_nl_connect_LIBS}" != "none required" ; then
-       LIBS="${netsnmp_result} ${netsnmp_target_val}"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_nl_connect_LMIBLIBS" >&5
+$as_echo "$netsnmp_cv_func_nl_connect_LMIBLIBS" >&6; }
+ if test "x${netsnmp_cv_func_nl_connect_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_nl_connect_LMIBLIBS}" != "xnone required" ; then
+       LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
     for ac_header in netlink/netlink.h
 do :
@@ -24390,8 +24988,8 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_nl_connect_LMIBLIBS" >&5
 $as_echo "$netsnmp_cv_func_nl_connect_LMIBLIBS" >&6; }
- if test "${netsnmp_cv_func_nl_connect_LMIBLIBS}" != "no" ; then
-    if test "${netsnmp_cv_func_nl_connect_LMIBLIBS}" != "none required" ; then
+ if test "x${netsnmp_cv_func_nl_connect_LMIBLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_nl_connect_LMIBLIBS}" != "xnone required" ; then
        LMIBLIBS="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
@@ -24711,7 +25309,7 @@ _ACEOF
         fi
         netsnmp_save_LIBS="$LIBS"
         LIBS="-lssl"
-        for ac_func in TLS_method TLSv1_method DTLS_method DTLSv1_method                       SSL_library_init SSL_load_error_strings
+        for ac_func in TLS_method TLSv1_method DTLS_method DTLSv1_method                       SSL_library_init SSL_load_error_strings		       ERR_get_error_all
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
@@ -24841,28 +25439,6 @@ if test "x$ac_cv_lib_pkcs11_C_Initialize
 fi
 
 fi
-if test "x$TLSPROG" = "xyes"; then
-   ac_fn_c_check_decl "$LINENO" "EVP_sha224" "ac_cv_have_decl_EVP_sha224" "#include <openssl/evp.h>
-"
-if test "x$ac_cv_have_decl_EVP_sha224" = xyes; then :
-
-$as_echo "#define HAVE_EVP_SHA224 /**/" >>confdefs.h
-
-else
-  :
-fi
-
-   ac_fn_c_check_decl "$LINENO" "EVP_sha384" "ac_cv_have_decl_EVP_sha384" "#include <openssl/evp.h>
-"
-if test "x$ac_cv_have_decl_EVP_sha384" = xyes; then :
-
-$as_echo "#define HAVE_EVP_SHA384 /**/" >>confdefs.h
-
-else
-  :
-fi
-
-fi
 
 LIBS=$NONAGENTLIBS	 # restore old libraries
 if test "x$SSHPROG" = "xyes"; then
@@ -25072,7 +25648,7 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
-  LAGENTLIBS="$_wraplibs"
+  LAGENTLIBS="$LAGENTLIBS $_wraplibs"
   CPPFLAGS=${_cppflags}
   LDFLAGS=${_ldflags}
   LIBS=${_libs}
@@ -25103,7 +25679,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_MYSQLCONFIG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -25144,11 +25720,18 @@ else
 fi
 
 
-  ac_fn_c_check_header_mongrel "$LINENO" "my_global.h my_sys.h" "ac_cv_header_my_global_h_my_sys_h" "$ac_includes_default"
-if test "x$ac_cv_header_my_global_h_my_sys_h" = xyes; then :
+  for ac_header in my_global.h my_sys.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
 
 fi
 
+done
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether MY_INIT() works" >&5
 $as_echo_n "checking whether MY_INIT() works... " >&6; }
@@ -25214,19 +25797,17 @@ $as_echo "no" >&6; }
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
-  ac_fn_c_check_func "$LINENO" "mysql_init" "ac_cv_func_mysql_init"
-if test "x$ac_cv_func_mysql_init" = xyes; then :
-
-$as_echo "#define HAVE_MYSQL_INIT 1" >>confdefs.h
-
-fi
-
-  ac_fn_c_check_func "$LINENO" "load_defaults" "ac_cv_func_load_defaults"
-if test "x$ac_cv_func_load_defaults" = xyes; then :
-
-$as_echo "#define HAVE_LOAD_DEFAULTS 1" >>confdefs.h
+  for ac_func in load_defaults mysql_init mysql_options
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
 
 fi
+done
 
   CPPFLAGS="${_cppflags}"
   LIBS="${_libs}"
@@ -25327,30 +25908,6 @@ fi
 done
 
 
-for ac_header in curses.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "curses.h" "ac_cv_header_curses_h" "$ac_includes_default"
-if test "x$ac_cv_header_curses_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_CURSES_H 1
-_ACEOF
-
-fi
-
-done
-
-for ac_header in ncurses/curses.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "ncurses/curses.h" "ac_cv_header_ncurses_curses_h" "$ac_includes_default"
-if test "x$ac_cv_header_ncurses_curses_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NCURSES_CURSES_H 1
-_ACEOF
-
-fi
-
-done
-
 
  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing endwin" >&5
 $as_echo_n "checking for library containing endwin... " >&6; }
@@ -25418,62 +25975,80 @@ rm -f core conftest.err conftest.$ac_obj
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_endwin_LIBCURSES" >&5
 $as_echo "$netsnmp_cv_func_endwin_LIBCURSES" >&6; }
- if test "${netsnmp_cv_func_endwin_LIBCURSES}" != "no" ; then
-    if test "${netsnmp_cv_func_endwin_LIBCURSES}" != "none required" ; then
+ if test "x${netsnmp_cv_func_endwin_LIBCURSES}" != "xno" ; then
+    if test "x${netsnmp_cv_func_endwin_LIBCURSES}" != "xnone required" ; then
        LIBCURSES="${netsnmp_result} ${netsnmp_target_val}"
     fi
 
+  for ac_header in curses.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "curses.h" "ac_cv_header_curses_h" "$ac_includes_default"
+if test "x$ac_cv_header_curses_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_CURSES_H 1
+_ACEOF
+
+fi
 
+done
+
+  for ac_header in ncurses/curses.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "ncurses/curses.h" "ac_cv_header_ncurses_curses_h" "$ac_includes_default"
+if test "x$ac_cv_header_ncurses_curses_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NCURSES_CURSES_H 1
+_ACEOF
+
+fi
+
+done
+
+  HAVE_LIBCURSES=TRUE
+ else
+    HAVE_LIBCURSES=FALSE
  fi
 
 
 
+
 #   libm for ceil
 #
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ceil without -lm" >&5
-$as_echo_n "checking for ceil without -lm... " >&6; }
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-  #include <math.h>
+ { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing ceil" >&5
+$as_echo_n "checking for library containing ceil... " >&6; }
+if ${netsnmp_cv_func_ceil_LNETSNMPLIBS+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  netsnmp_func_search_save_LIBS="$LIBS"
+     netsnmp_target_val="$LNETSNMPLIBS"
+          netsnmp_temp_LIBS="${netsnmp_target_val}  ${LIBS}"
+     netsnmp_result=no
+     LIBS="${netsnmp_temp_LIBS}"
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char ceil ();
 int
 main ()
 {
-
-  ceil((double)2.4);
-
+return ceil ();
   ;
   return 0;
 }
 _ACEOF
 if ac_fn_c_try_link "$LINENO"; then :
-
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; };
-  # Keep LIBS.
-  need_ceil_lib="no"
-  true
-
-else
-
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-  need_ceil_lib="yes"
-  # Restore LIBS.
-
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-
-if test "${need_ceil_lib}" = yes; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing ceil" >&5
-$as_echo_n "checking for library containing ceil... " >&6; }
-if ${ac_cv_search_ceil+:} false; then :
-  $as_echo_n "(cached) " >&6
+  netsnmp_result="none required"
 else
-  ac_func_search_save_LIBS=$LIBS
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+  for netsnmp_cur_lib in m ; do
+              LIBS="-l${netsnmp_cur_lib} ${netsnmp_temp_LIBS}"
+              cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
@@ -25491,39 +26066,29 @@ return ceil ();
   return 0;
 }
 _ACEOF
-for ac_lib in '' m; do
-  if test -z "$ac_lib"; then
-    ac_res="none required"
-  else
-    ac_res=-l$ac_lib
-    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
-  fi
-  if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_search_ceil=$ac_res
+if ac_fn_c_try_link "$LINENO"; then :
+  netsnmp_result=-l${netsnmp_cur_lib}
+                   break
 fi
 rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext
-  if ${ac_cv_search_ceil+:} false; then :
-  break
-fi
-done
-if ${ac_cv_search_ceil+:} false; then :
-
-else
-  ac_cv_search_ceil=no
+    conftest$ac_exeext conftest.$ac_ext
+          done
 fi
-rm conftest.$ac_ext
-LIBS=$ac_func_search_save_LIBS
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+     LIBS="${netsnmp_func_search_save_LIBS}"
+     netsnmp_cv_func_ceil_LNETSNMPLIBS="${netsnmp_result}"
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_ceil" >&5
-$as_echo "$ac_cv_search_ceil" >&6; }
-ac_res=$ac_cv_search_ceil
-if test "$ac_res" != no; then :
-  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_func_ceil_LNETSNMPLIBS" >&5
+$as_echo "$netsnmp_cv_func_ceil_LNETSNMPLIBS" >&6; }
+ if test "x${netsnmp_cv_func_ceil_LNETSNMPLIBS}" != "xno" ; then
+    if test "x${netsnmp_cv_func_ceil_LNETSNMPLIBS}" != "xnone required" ; then
+       LNETSNMPLIBS="${netsnmp_result} ${netsnmp_target_val}"
+    fi
 
-fi
 
-fi
+ fi
+
 
 cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -26138,7 +26703,13 @@ $as_echo "#define NETSNMP_USE_INTERNAL_C
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: Internal Crypto Support" >&5
 $as_echo "Internal Crypto Support" >&6; }
 elif test "x$useopenssl" != "xno" ; then
-    authmodes="MD5 SHA1 SHA512 SHA384 SHA256 SHA192"
+    authmodes="MD5 SHA1"
+    if test "x$ac_cv_func_EVP_sha224" = xyes; then
+        authmodes="$authmodes SHA224 SHA256"
+    fi
+    if test "x$ac_cv_func_EVP_sha384" = xyes; then
+        authmodes="$authmodes SHA384 SHA512"
+    fi
     if test "x$enable_privacy" != "xno" ; then
         if test "x$ac_cv_header_openssl_aes_h" = "xyes" ; then
             encrmodes="DES AES"
@@ -26177,6 +26748,13 @@ fi
 if test "x$enable_md5" = "xno"; then
     authmodes=`echo $authmodes | $SED 's/MD5 *//;'`
 fi
+if test "x$ac_cv_func_AES_cfb128_encrypt" = xyes ||
+   test "x$CRYPTO" = xinternal; then
+    encrmodes="$encrmodes AES128"
+    if test "x$aes_capable" = "xyes"; then
+        encrmodes="$encrmodes AES192 AES192C AES256 AES256C"
+    fi
+fi
 
 
 
@@ -26552,17 +27130,24 @@ _ACEOF
 #   More complex checks:
 ##
 
-#   Check for 'socklen_t'                           (HP-UX)
+#   Check for 'socklen_t', 'in_addr_t' and 'ssize_t'.
 #
 ac_fn_c_check_type "$LINENO" "socklen_t" "ac_cv_type_socklen_t" "
-#include <sys/types.h>
-#if STDC_HEADERS
+#if defined(HAVE_WINSOCK2_H) && defined(HAVE_WS2TCPIP_H)
+#include <winsock2.h>
+#include <ws2tcpip.h>
+#endif
 #include <stdlib.h>
 #include <stddef.h>
+#ifdef HAVE_SYS_TYPES_H
+#include <sys/types.h>
 #endif
 #ifdef HAVE_SYS_SOCKET_H
 #include <sys/socket.h>
 #endif
+#ifdef HAVE_NETINET_IN_H
+#include <netinet/in.h>
+#endif
 "
 if test "x$ac_cv_type_socklen_t" = xyes; then :
 
@@ -26572,17 +27157,18 @@ _ACEOF
 
 
 fi
-
-
-
-#   Check for 'in_addr_t'
-#       May be in <netinet/in.h>                        (AIX)
-#
 ac_fn_c_check_type "$LINENO" "in_addr_t" "ac_cv_type_in_addr_t" "
-#include <sys/types.h>
-#if STDC_HEADERS
+#if defined(HAVE_WINSOCK2_H) && defined(HAVE_WS2TCPIP_H)
+#include <winsock2.h>
+#include <ws2tcpip.h>
+#endif
 #include <stdlib.h>
 #include <stddef.h>
+#ifdef HAVE_SYS_TYPES_H
+#include <sys/types.h>
+#endif
+#ifdef HAVE_SYS_SOCKET_H
+#include <sys/socket.h>
 #endif
 #ifdef HAVE_NETINET_IN_H
 #include <netinet/in.h>
@@ -26596,17 +27182,21 @@ _ACEOF
 
 
 fi
-
-
-
-#   Check for 'ssize_t'
-#       Not necessarily in <sys/types.h>                (older MinGW)
-#
 ac_fn_c_check_type "$LINENO" "ssize_t" "ac_cv_type_ssize_t" "
-#include <sys/types.h>
-#if STDC_HEADERS
+#if defined(HAVE_WINSOCK2_H) && defined(HAVE_WS2TCPIP_H)
+#include <winsock2.h>
+#include <ws2tcpip.h>
+#endif
 #include <stdlib.h>
 #include <stddef.h>
+#ifdef HAVE_SYS_TYPES_H
+#include <sys/types.h>
+#endif
+#ifdef HAVE_SYS_SOCKET_H
+#include <sys/socket.h>
+#endif
+#ifdef HAVE_NETINET_IN_H
+#include <netinet/in.h>
 #endif
 "
 if test "x$ac_cv_type_ssize_t" = xyes; then :
@@ -26619,246 +27209,107 @@ _ACEOF
 fi
 
 
-# -*- autoconf -*-
-#########################################
-##
-# Miscellaneous checks
-##
-#########################################
+if test "x$ac_cv_type_in_addr_t" != xyes; then
 
-##
-#   Compilation characteristics
-##
+$as_echo "#define in_addr_t unsigned long" >>confdefs.h
 
-#       Byte order
-#
-if test "$with_endianness" = "big"; then
-    ac_cv_c_bigendian=yes
-elif test "$with_endianness" = "little" ; then
-    ac_cv_c_bigendian=no
 fi
- { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether byte ordering is bigendian" >&5
-$as_echo_n "checking whether byte ordering is bigendian... " >&6; }
-if ${ac_cv_c_bigendian+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_c_bigendian=unknown
-    # See if we're dealing with a universal compiler.
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#ifndef __APPLE_CC__
-	       not a universal capable compiler
-	     #endif
-	     typedef int dummy;
 
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-
-	# Check for potential -arch flags.  It is not universal unless
-	# there are at least two -arch flags with different values.
-	ac_arch=
-	ac_prev=
-	for ac_word in $CC $CFLAGS $CPPFLAGS $LDFLAGS; do
-	 if test -n "$ac_prev"; then
-	   case $ac_word in
-	     i?86 | x86_64 | ppc | ppc64)
-	       if test -z "$ac_arch" || test "$ac_arch" = "$ac_word"; then
-		 ac_arch=$ac_word
-	       else
-		 ac_cv_c_bigendian=universal
-		 break
-	       fi
-	       ;;
-	   esac
-	   ac_prev=
-	 elif test "x$ac_word" = "x-arch"; then
-	   ac_prev=arch
-	 fi
-       done
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-    if test $ac_cv_c_bigendian = unknown; then
-      # See if sys/param.h defines the BYTE_ORDER macro.
-      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <sys/types.h>
-	     #include <sys/param.h>
+#
+# Check for the type of the fifth argument of select()
+#
 
-int
-main ()
-{
-#if ! (defined BYTE_ORDER && defined BIG_ENDIAN \
-		     && defined LITTLE_ENDIAN && BYTE_ORDER && BIG_ENDIAN \
-		     && LITTLE_ENDIAN)
-	      bogus endian macros
-	     #endif
+netsnmp_save_CFLAGS=$CFLAGS
+CFLAGS="$CFLAGS -Werror"
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  # It does; now see whether it defined to BIG_ENDIAN or not.
-	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for the type of the fifth argument of select()" >&5
+$as_echo_n "checking for the type of the fifth argument of select()... " >&6; }
+arg_type=void
+for t in "struct timeval" "struct __ms_timeval"; do
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <sys/types.h>
-		#include <sys/param.h>
+
+#if defined(HAVE_WINSOCK2_H) && defined(HAVE_WS2TCPIP_H)
+#include <winsock2.h>
+#include <ws2tcpip.h>
+#else
+#ifdef HAVE_SYS_SELECT_H
+#include <sys/select.h>
+#endif
+#endif
+#include <stddef.h>
 
 int
 main ()
 {
-#if BYTE_ORDER != BIG_ENDIAN
-		 not big endian
-		#endif
-
+return select(0, NULL, NULL, NULL, ($t *)NULL)
   ;
   return 0;
 }
 _ACEOF
 if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_c_bigendian=yes
-else
-  ac_cv_c_bigendian=no
+  arg_type=$t; break
 fi
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-    fi
-    if test $ac_cv_c_bigendian = unknown; then
-      # See if <limits.h> defines _LITTLE_ENDIAN or _BIG_ENDIAN (e.g., Solaris).
-      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <limits.h>
-
-int
-main ()
-{
-#if ! (defined _LITTLE_ENDIAN || defined _BIG_ENDIAN)
-	      bogus endian macros
-	     #endif
+done
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: ${arg_type}" >&5
+$as_echo "${arg_type}" >&6; }
 
-  ;
-  return 0;
-}
+cat >>confdefs.h <<_ACEOF
+#define NETSNMP_SELECT_TIMEVAL ${arg_type}
 _ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  # It does; now see whether it defined to _BIG_ENDIAN or not.
-	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <limits.h>
 
-int
-main ()
-{
-#ifndef _BIG_ENDIAN
-		 not big endian
-		#endif
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_c_bigendian=yes
-else
-  ac_cv_c_bigendian=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-    fi
-    if test $ac_cv_c_bigendian = unknown; then
-      # Compile a test program.
-      if test "$cross_compiling" = yes; then :
-  # Try to guess by grepping values from an object file.
-	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for the type of the third argument of ioctlsocket()" >&5
+$as_echo_n "checking for the type of the third argument of ioctlsocket()... " >&6; }
+arg_type=void
+for t in "unsigned int" "unsigned long"; do
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-short int ascii_mm[] =
-		  { 0x4249, 0x4765, 0x6E44, 0x6961, 0x6E53, 0x7953, 0 };
-		short int ascii_ii[] =
-		  { 0x694C, 0x5454, 0x656C, 0x6E45, 0x6944, 0x6E61, 0 };
-		int use_ascii (int i) {
-		  return ascii_mm[i] + ascii_ii[i];
-		}
-		short int ebcdic_ii[] =
-		  { 0x89D3, 0xE3E3, 0x8593, 0x95C5, 0x89C4, 0x9581, 0 };
-		short int ebcdic_mm[] =
-		  { 0xC2C9, 0xC785, 0x95C4, 0x8981, 0x95E2, 0xA8E2, 0 };
-		int use_ebcdic (int i) {
-		  return ebcdic_mm[i] + ebcdic_ii[i];
-		}
-		extern int foo;
+
+#if defined(HAVE_WINSOCK2_H) && defined(HAVE_WS2TCPIP_H)
+#include <winsock2.h>
+#include <ws2tcpip.h>
+#else
+#ifdef HAVE_SYS_SELECT_H
+#include <sys/select.h>
+#endif
+#endif
+#include <stddef.h>
 
 int
 main ()
 {
-return use_ascii (foo) == use_ebcdic (foo);
+return ioctlsocket(0, 0, ($t *)NULL)
   ;
   return 0;
 }
 _ACEOF
 if ac_fn_c_try_compile "$LINENO"; then :
-  if grep BIGenDianSyS conftest.$ac_objext >/dev/null; then
-	      ac_cv_c_bigendian=yes
-	    fi
-	    if grep LiTTleEnDian conftest.$ac_objext >/dev/null ; then
-	      if test "$ac_cv_c_bigendian" = unknown; then
-		ac_cv_c_bigendian=no
-	      else
-		# finding both strings is unlikely to happen, but who knows?
-		ac_cv_c_bigendian=unknown
-	      fi
-	    fi
+  arg_type=$t; break
 fi
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-
-	     /* Are we little or big endian?  From Harbison&Steele.  */
-	     union
-	     {
-	       long int l;
-	       char c[sizeof (long int)];
-	     } u;
-	     u.l = 1;
-	     return u.c[sizeof (long int) - 1] == 1;
+done
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: ${arg_type}" >&5
+$as_echo "${arg_type}" >&6; }
 
-  ;
-  return 0;
-}
+cat >>confdefs.h <<_ACEOF
+#define NETSNMP_IOCTLSOCKET_ARG ${arg_type}
 _ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-  ac_cv_c_bigendian=no
-else
-  ac_cv_c_bigendian=yes
-fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
-fi
 
-    fi
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_bigendian" >&5
-$as_echo "$ac_cv_c_bigendian" >&6; }
- case $ac_cv_c_bigendian in #(
-   yes)
-     $as_echo "#define WORDS_BIGENDIAN 1" >>confdefs.h
-;; #(
-   no)
-      ;; #(
-   universal)
 
-$as_echo "#define AC_APPLE_UNIVERSAL_BUILD 1" >>confdefs.h
+CFLAGS=$netsnmp_save_CFLAGS
+
+# -*- autoconf -*-
+#########################################
+##
+# Miscellaneous checks
+##
+#########################################
 
-     ;; #(
-   *)
-     as_fn_error $? "Failed to figure out host endianness, please use --with-endianness to specify it." "$LINENO" 5 ;;
- esac
+##
+#   Compilation characteristics
+##
 
 
 cat >confcache <<\_ACEOF
@@ -27123,23 +27574,20 @@ else
 /* end confdefs.h.  */
 $ac_includes_default
 int
-find_stack_direction ()
+find_stack_direction (int *addr, int depth)
 {
-  static char *addr = 0;
-  auto char dummy;
-  if (addr == 0)
-    {
-      addr = &dummy;
-      return find_stack_direction ();
-    }
-  else
-    return (&dummy > addr) ? 1 : -1;
+  int dir, dummy = 0;
+  if (! addr)
+    addr = &dummy;
+  *addr = addr < &dummy ? 1 : addr == &dummy ? 0 : -1;
+  dir = depth ? find_stack_direction (addr, depth - 1) : 0;
+  return dir + dummy;
 }
 
 int
-main ()
+main (int argc, char **argv)
 {
-  return find_stack_direction () < 0;
+  return find_stack_direction (0, argc + !argv + 20) < 0;
 }
 _ACEOF
 if ac_fn_c_try_run "$LINENO"; then :
@@ -27204,77 +27652,6 @@ $as_echo "$ac_cv_prog_gcc_traditional" >
 fi
 
 
-if test "$cross_compiling" = yes -a "${ac_cv_func_memcmp_working+set}" != set
-then
-  # Cross-compiling and ac_cv_func_memcmp_working has not been set - assume
-  # that memcmp() is available.
-  ac_cv_func_memcmp_working=yes
-else
-  # Native compilation - test for the availability of memcmp().
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working memcmp" >&5
-$as_echo_n "checking for working memcmp... " >&6; }
-if ${ac_cv_func_memcmp_working+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test "$cross_compiling" = yes; then :
-  ac_cv_func_memcmp_working=no
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-
-  /* Some versions of memcmp are not 8-bit clean.  */
-  char c0 = '\100', c1 = '\200', c2 = '\201';
-  if (memcmp(&c0, &c2, 1) >= 0 || memcmp(&c1, &c2, 1) >= 0)
-    return 1;
-
-  /* The Next x86 OpenStep bug shows up only when comparing 16 bytes
-     or more and with at least one buffer not starting on a 4-byte boundary.
-     William Lewis provided this test program.   */
-  {
-    char foo[21];
-    char bar[21];
-    int i;
-    for (i = 0; i < 4; i++)
-      {
-	char *a = foo + i;
-	char *b = bar + i;
-	strcpy (a, "--------01111111");
-	strcpy (b, "--------10000000");
-	if (memcmp (a, b, 16) >= 0)
-	  return 1;
-      }
-    return 0;
-  }
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-  ac_cv_func_memcmp_working=yes
-else
-  ac_cv_func_memcmp_working=no
-fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
-fi
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_func_memcmp_working" >&5
-$as_echo "$ac_cv_func_memcmp_working" >&6; }
-test $ac_cv_func_memcmp_working = no && case " $LIBOBJS " in
-  *" memcmp.$ac_objext "* ) ;;
-  *) LIBOBJS="$LIBOBJS memcmp.$ac_objext"
- ;;
-esac
-
-
-fi
-
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking return type of signal handlers" >&5
 $as_echo_n "checking return type of signal handlers... " >&6; }
 if ${ac_cv_type_signal+:} false; then :
@@ -27313,7 +27690,7 @@ _ACEOF
 #   Stand-alone function checks:
 ##
 #  Core:
-for ac_func in rand   random srand srandom lrand48 srand48                signal sigset
+for ac_func in rand   random srand srandom lrand48 srand48
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
@@ -27327,7 +27704,7 @@ done
 
 
 #  Library:
-for ac_func in asprintf                                                         closedir        fgetc_unlocked  flockfile                        fork            funlockfile     getipnodebyname                  gettimeofday    if_nametoindex  mkstemp                          opendir         readdir         regcomp                          setenv          setitimer       setlocale                        setsid          snprintf        strcasestr                       strdup          strerror        strncasecmp                      sysconf         times           vsnprintf
+for ac_func in asprintf        closedir        fgetc_unlocked                   flockfile       funlockfile     getipnodebyname                  gettimeofday    getlogin                                         if_nametoindex  mkstemp                                          opendir         readdir         regcomp                          setenv          setitimer       setlocale                        setsid          snprintf        strcasestr                       strdup          strerror        strncasecmp                      sysconf         times           vsnprintf
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
@@ -27340,10 +27717,66 @@ fi
 done
 
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for _NSGetArgv()" >&5
+$as_echo_n "checking for _NSGetArgv()... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <crt_externs.h>
+int
+main ()
+{
+return _NSGetArgv
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+
+$as_echo "#define HAVE__NSGETARGV 1" >>confdefs.h
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for _NSGetExecutablePath()" >&5
+$as_echo_n "checking for _NSGetExecutablePath()... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <mach-o/dyld.h>
+int
+main ()
+{
+return _NSGetExecutablePath
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+
+$as_echo "#define HAVE__NSGETEXECUTABLEPATH 1" >>confdefs.h
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
 # IPv4/IPv6 function checks. AC_CHECK_FUNC() can't find these on MinGW
 # since these functions have the __cdecl calling convention on MinGW.
-case x$target_os in
-  xmingw*)
+case x$with_socklib in
+  xwinsock2)
     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <winsock2.h>
@@ -27432,7 +27865,7 @@ main ()
 }
 _ACEOF
 if ac_fn_c_try_link "$LINENO"; then :
-   ac_cv_func_gethostaddr=yes
+   ac_cv_func_gethostbyaddr=yes
       $as_echo  "#define HAVE_GETHOSTBYADDR 1" >>confdefs.h
 
 fi
@@ -27460,7 +27893,9 @@ rm -f core conftest.err conftest.$ac_obj
     ;;
 
   *)
-    for ac_func in closesocket gai_strerror getaddrinfo gethostbyname gethostbyname2 gethostname gethostbyaddr
+    # Do not use fork() nor any related function when using Windows sockets
+    # because Windows sockets are not compatible with fork().
+    for ac_func in execv fork signal sigset uname posix_spawn waitpid                   closesocket gai_strerror getaddrinfo gethostbyname                   gethostbyname2 gethostname gethostbyaddr                   inet_ntop inet_pton
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
@@ -27475,42 +27910,154 @@ done
     ;;
 esac
 
+# Check for MSVC functions.
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for _beginthreadex()" >&5
+$as_echo_n "checking for _beginthreadex()... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+#include <stddef.h>
+#include <process.h>
 
-ac_fn_c_check_func "$LINENO" "getopt" "ac_cv_func_getopt"
-if test "x$ac_cv_func_getopt" = xyes; then :
-  $as_echo "#define HAVE_GETOPT 1" >>confdefs.h
+int
+main ()
+{
+ _beginthreadex(NULL, 0, NULL, NULL, 0, NULL);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+
+$as_echo "#define HAVE__BEGINTHREADEX 1" >>confdefs.h
 
 else
-  case " $LIBOBJS " in
-  *" getopt.$ac_objext "* ) ;;
-  *) LIBOBJS="$LIBOBJS getopt.$ac_objext"
- ;;
-esac
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for _cputs()" >&5
+$as_echo_n "checking for _cputs()... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <conio.h>
+int
+main ()
+{
+ _cputs(0);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+
+$as_echo "#define HAVE__CPUTS 1" >>confdefs.h
+
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for _get_osfhandle()" >&5
+$as_echo_n "checking for _get_osfhandle()... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <io.h>
+int
+main ()
+{
+ _get_osfhandle(0);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 
+$as_echo "#define HAVE__GET_OSFHANDLE 1" >>confdefs.h
+
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for _getch()" >&5
+$as_echo_n "checking for _getch()... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <conio.h>
+int
+main ()
+{
+ return _getch();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
 
-ac_fn_c_check_func "$LINENO" "inet_ntop" "ac_cv_func_inet_ntop"
-if test "x$ac_cv_func_inet_ntop" = xyes; then :
-  $as_echo "#define HAVE_INET_NTOP 1" >>confdefs.h
+$as_echo "#define HAVE__GETCH 1" >>confdefs.h
 
 else
-  case " $LIBOBJS " in
-  *" inet_ntop.$ac_objext "* ) ;;
-  *) LIBOBJS="$LIBOBJS inet_ntop.$ac_objext"
- ;;
-esac
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for _open_osfhandle()" >&5
+$as_echo_n "checking for _open_osfhandle()... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stddef.h>
+#include <io.h>
 
+int
+main ()
+{
+ _open_osfhandle(NULL, 0);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+
+$as_echo "#define HAVE__OPEN_OSFHANDLE 1" >>confdefs.h
+
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
 
-ac_fn_c_check_func "$LINENO" "inet_pton" "ac_cv_func_inet_pton"
-if test "x$ac_cv_func_inet_pton" = xyes; then :
-  $as_echo "#define HAVE_INET_PTON 1" >>confdefs.h
+
+
+
+ac_fn_c_check_func "$LINENO" "getopt" "ac_cv_func_getopt"
+if test "x$ac_cv_func_getopt" = xyes; then :
+  $as_echo "#define HAVE_GETOPT 1" >>confdefs.h
 
 else
   case " $LIBOBJS " in
-  *" inet_pton.$ac_objext "* ) ;;
-  *) LIBOBJS="$LIBOBJS inet_pton.$ac_objext"
+  *" getopt.$ac_objext "* ) ;;
+  *) LIBOBJS="$LIBOBJS getopt.$ac_objext"
  ;;
 esac
 
@@ -27597,7 +28144,21 @@ fi
 
 
 #  Agent:
-for ac_func in cgetnext        chown          execv                           forkall         fsync                                          gai_strerror    getgrnam                                       gethostname     getloadavg                                     getpid          getpwnam                                       hasmntopt       initgroups                                     if_nameindex    if_indextoname if_nametoindex                  localtime_r     mkstemp        mktime                          poll            regcomp                                        setgid          setgroups                                      setmntent       setuid                                         sigaction       sigblock      sighold                          sigprocmask                                                    statfs          statvfs       stime                            strncasecmp     system                                         uname           usleep
+for ac_func in cgetnext        chown          endfsent                        forkall         fsync          gai_strerror                    getfsent        getgrnam       gethostname                     getloadavg      getmntent      getmntinfo                      getpid          getpwnam                                       hasmntopt       initgroups                                     if_nameindex    if_indextoname if_nametoindex                  localtime_r     mkstemp        mktime                          poll            regcomp        setfsent                        setgid          setgroups                                      setmntent       setuid                                         sigaction       sigblock      sigprocmask                      statfs          statvfs       stime                            strncasecmp     system        usleep
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+done
+
+
+# Agent, Darwin (Apple):
+for ac_func in vm_region vm_region_64
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
@@ -27686,12 +28247,12 @@ else
 #ifdef HAVE_SYS_FS_TYPES_H
 #include <sys/fs_types.h>
 #endif
-main ()
+int main ()
 {
 struct fs_data fsd;
 /* Ultrix's statfs returns 1 for success,
    0 for not mounted, -1 for failure.  */
-exit (statfs (".", &fsd) != 1);
+return statfs (".", &fsd) != 1;
 }
 _ACEOF
 if ac_fn_c_try_run "$LINENO"; then :
@@ -27865,93 +28426,22 @@ fi
 #   Check how to print a size_t variable
 ##
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking the underlying type of a size_t" >&5
-$as_echo_n "checking the underlying type of a size_t... " >&6; }
+case x${host_cpu}-${host_vendor}-${host_os} in
+  x*mingw*)
+    # MinGW or MinGW-w64.
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking the underlying type of size_t" >&5
+$as_echo_n "checking the underlying type of size_t... " >&6; }
 if ${netsnmp_cv_size_t_type+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if [ x$netsnmp_cv_size_t_type = x ] ; then
-         cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-extern unsigned int variable;
-extern size_t variable;
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  netsnmp_cv_size_t_type="int"
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-     fi
-    if [ x$netsnmp_cv_size_t_type = x ] ; then
-         cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-extern unsigned long variable;
-extern size_t variable;
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  netsnmp_cv_size_t_type="long"
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-     fi
-    if [ x$netsnmp_cv_size_t_type = x ] ; then
-         cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+  for TYPE in int long "long long" short char; do
+        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-$ac_includes_default
-extern unsigned long long variable;
-extern size_t variable;
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  netsnmp_cv_size_t_type="long long"
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-     fi
-    if [ x$netsnmp_cv_size_t_type = x ] ; then
-         cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-extern unsigned short variable;
-extern size_t variable;
-int
-main ()
-{
+            $ac_includes_default
+            extern unsigned $TYPE variable;
+            extern size_t variable;
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  netsnmp_cv_size_t_type="short"
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-     fi
-    if [ x$netsnmp_cv_size_t_type = x ] ; then
-         cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-extern unsigned char variable;
-extern size_t variable;
 int
 main ()
 {
@@ -27961,156 +28451,39 @@ main ()
 }
 _ACEOF
 if ac_fn_c_try_compile "$LINENO"; then :
-  netsnmp_cv_size_t_type="char"
+  netsnmp_cv_size_t_type="$TYPE"
 fi
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-     fi
-
+        if test "x$netsnmp_cv_size_t_type" != x; then break; fi
+      done
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_size_t_type" >&5
 $as_echo "$netsnmp_cv_size_t_type" >&6; }
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to printf a size_t" >&5
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to printf a size_t" >&5
 $as_echo_n "checking how to printf a size_t... " >&6; }
-case "$netsnmp_cv_size_t_type" in
-    char|short|int) netsnmp_PRIz="" ;;
-    long) netsnmp_PRIz="l" ;;
-    "long long") netsnmp_PRIz="ll" ;;
-    *) as_fn_error $? "underlying type of size_t not known" "$LINENO" 5 ;;
+    case "$netsnmp_cv_size_t_type" in
+      char|short|int)
+        netsnmp_PRIz="";;
+      long)
+        netsnmp_PRIz="l";;
+      "long long")
+        netsnmp_PRIz="I64";;
+      *)
+        as_fn_error $? "underlying type of size_t not known" "$LINENO" 5;;
+    esac
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_PRIz" >&5
+$as_echo "$netsnmp_PRIz" >&6; };;
+  *)
+    # Unix or Cygwin.
+    netsnmp_PRIz="z";;
 esac
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_PRIz" >&5
-$as_echo "$netsnmp_PRIz" >&6; }
 
 cat >>confdefs.h <<_ACEOF
 #define NETSNMP_PRIz "$netsnmp_PRIz"
 _ACEOF
 
 
-##
-#   Check how to print a uint32_t variable
-##
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking the underlying type of an uint32_t" >&5
-$as_echo_n "checking the underlying type of an uint32_t... " >&6; }
-if ${netsnmp_cv_uint32_t_type+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if [ x$netsnmp_cv_uint32_t_type = x ] ; then
-         cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-extern unsigned char variable;
-extern uint32_t variable;
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  netsnmp_cv_uint32_t_type="char"
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-     fi
-    if [ x$netsnmp_cv_uint32_t_type = x ] ; then
-         cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-extern unsigned short variable;
-extern uint32_t variable;
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  netsnmp_cv_uint32_t_type="short"
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-     fi
-    if [ x$netsnmp_cv_uint32_t_type = x ] ; then
-         cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-extern unsigned int variable;
-extern uint32_t variable;
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  netsnmp_cv_uint32_t_type="int"
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-     fi
-    if [ x$netsnmp_cv_uint32_t_type = x ] ; then
-         cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-extern unsigned long variable;
-extern uint32_t variable;
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  netsnmp_cv_uint32_t_type="long"
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-     fi
-    if [ x$netsnmp_cv_uint32_t_type = x ] ; then
-         cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-extern unsigned long long variable;
-extern uint32_t variable;
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  netsnmp_cv_uint32_t_type="long long"
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-     fi
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_cv_uint32_t_type" >&5
-$as_echo "$netsnmp_cv_uint32_t_type" >&6; }
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to printf a uint32_t" >&5
-$as_echo_n "checking how to printf a uint32_t... " >&6; }
-case "$netsnmp_cv_uint32_t_type" in
-    char|short|int) netsnmp_PRI32="" ;;
-    long) netsnmp_PRI32="l" ;;
-    "long long") netsnmp_PRI32="ll" ;;
-    *) as_fn_error $? "underlying type of uint32_t not known" "$LINENO" 5 ;;
-esac
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $netsnmp_PRI32" >&5
-$as_echo "$netsnmp_PRI32" >&6; }
-
-cat >>confdefs.h <<_ACEOF
-#define NETSNMP_PRI32 "$netsnmp_PRI32"
-_ACEOF
-
-
 # check to see if the openssl is good enough for DTLS
 # (BIO_dgram_get_peer is a macro, not a true function)
 if echo " $transport_result_list " | $GREP "DTLS" > /dev/null; then
@@ -29117,7 +29490,7 @@ _ACEOF
 
 
 fi
-ac_fn_c_check_member "$LINENO" "struct time" "tm_isdst" "ac_cv_member_struct_time_tm_isdst" "
+ac_fn_c_check_member "$LINENO" "struct tm" "tm_isdst" "ac_cv_member_struct_tm_tm_isdst" "
     $ac_includes_default
 
 #if TIME_WITH_SYS_TIME
@@ -29132,19 +29505,64 @@ ac_fn_c_check_member "$LINENO" "struct t
 #endif
 
 "
-if test "x$ac_cv_member_struct_time_tm_isdst" = xyes; then :
+if test "x$ac_cv_member_struct_tm_tm_isdst" = xyes; then :
 
 cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_TIME_TM_ISDST 1
+#define HAVE_STRUCT_TM_TM_ISDST 1
 _ACEOF
 
 
 fi
 
 
-#       extern timezone
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking extern timezone" >&5
-$as_echo_n "checking extern timezone... " >&6; }
+ac_fn_c_check_decl "$LINENO" "daylight" "ac_cv_have_decl_daylight" "
+#if TIME_WITH_SYS_TIME
+# include <sys/time.h>
+# include <time.h>
+#else
+# if HAVE_SYS_TIME_H
+#  include <sys/time.h>
+# else
+#  include <time.h>
+# endif
+#endif
+
+"
+if test "x$ac_cv_have_decl_daylight" = xyes; then :
+  ac_have_decl=1
+else
+  ac_have_decl=0
+fi
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_DECL_DAYLIGHT $ac_have_decl
+_ACEOF
+ac_fn_c_check_decl "$LINENO" "timezone" "ac_cv_have_decl_timezone" "
+#if TIME_WITH_SYS_TIME
+# include <sys/time.h>
+# include <time.h>
+#else
+# if HAVE_SYS_TIME_H
+#  include <sys/time.h>
+# else
+#  include <time.h>
+# endif
+#endif
+
+"
+if test "x$ac_cv_have_decl_timezone" = xyes; then :
+  ac_have_decl=1
+else
+  ac_have_decl=0
+fi
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_DECL_TIMEZONE $ac_have_decl
+_ACEOF
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether timezone is a scalar" >&5
+$as_echo_n "checking whether timezone is a scalar... " >&6; }
 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
@@ -29163,28 +29581,24 @@ int
 main ()
 {
 
-  return timezone;
+int a[2];
+return &a[timezone] != NULL;
 
   ;
   return 0;
 }
 _ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+if ac_fn_c_try_compile "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
-$as_echo "#define HAVE_TIMEZONE_VARIABLE 1" >>confdefs.h
-
+$as_echo "#define HAVE_SCALAR_TIMEZONE 1" >>confdefs.h
 
 else
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 #       struct timezone
 #   Library:
@@ -30970,33 +31384,6 @@ _ACEOF
 
 
 
-#       /dev/kmem existence
-#	    used in agent only
-#
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for /dev/kmem" >&5
-$as_echo_n "checking for /dev/kmem... " >&6; }
-if ${ac_cv_HAVE_KMEM+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test $CDEV_TEST_FLAG /dev/kmem; then
-        ac_cv_HAVE_KMEM="/dev/kmem"
-    fi
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_HAVE_KMEM" >&5
-$as_echo "$ac_cv_HAVE_KMEM" >&6; }
-#
-#  Note that it's OK if this device is not found
-#
-if test "x$ac_cv_HAVE_KMEM" = "x/dev/kmem"; then
-
-cat >>confdefs.h <<_ACEOF
-#define HAVE_KMEM "$ac_cv_HAVE_KMEM"
-_ACEOF
-
-fi
-
-
 #       Swap device Location
 #           (/dev/dmem or /dev/drum)
 #	    used in agent only
@@ -31079,7 +31466,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_LPSTAT_PATH="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -31234,7 +31621,8 @@ else
 # include <sys/sysctl.h>
 #endif
 
-main() {
+int main(int argc, char **argv)
+{
   int                 mib[2];
   size_t              len;
   struct timeval boottime;
@@ -31243,11 +31631,7 @@ main() {
   mib[1] = KERN_BOOTTIME;
 
   len = sizeof(boottime);
-  sysctl(mib, 2, &boottime, &len, NULL, NULL);
-  if (boottime.tv_sec != 0)
-    exit(0);
-  else
-    exit(1);
+  return 1 - (sysctl(mib, 2, &boottime, &len, NULL, 0) == 0 && boottime.tv_sec);
 }
 
 _ACEOF
@@ -31443,6 +31827,59 @@ And this can be very slow." >&2;}
     ;;
 esac
 
+#   Check whether SO_BINDTODEVICE is available.
+#
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for SO_BINDTODEVICE" >&5
+$as_echo_n "checking for SO_BINDTODEVICE... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <sys/types.h>
+#include <sys/socket.h>
+
+int
+main ()
+{
+
+return SO_BINDTODEVICE
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+
+$as_echo "#define HAVE_SO_BINDTODEVICE 1" >>confdefs.h
+
+ { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+#   Check whether struct in_pktinfo.ipi_spec_dst is available.
+#
+
+ac_fn_c_check_member "$LINENO" "struct in_pktinfo" "ipi_spec_dst" "ac_cv_member_struct_in_pktinfo_ipi_spec_dst" "
+#include <sys/types.h>
+#include <sys/socket.h>
+#include <netinet/in.h>
+
+"
+if test "x$ac_cv_member_struct_in_pktinfo_ipi_spec_dst" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_IN_PKTINFO_IPI_SPEC_DST 1
+_ACEOF
+
+
+fi
+
+
 #   Check whether IP_PKTINFO is usable.
 #
 
@@ -31460,6 +31897,7 @@ else
 #include <sys/types.h>
 #include <sys/socket.h>
 #include <netinet/in.h>
+#include <arpa/inet.h> /* inet_ntoa() */
 
 int
 main ()
@@ -31532,6 +31970,7 @@ else
 #include <sys/types.h>
 #include <sys/socket.h>
 #include <netinet/in.h>
+#include <arpa/inet.h> /* inet_ntoa() */
 
 int
 main ()
@@ -31717,6 +32156,8 @@ ac_config_files="$ac_config_files net-sn
 
 ac_config_files="$ac_config_files net-snmp-create-v3-user:net-snmp-create-v3-user.in"
 
+ac_config_files="$ac_config_files netsnmp.pc:netsnmp.pc.in netsnmp-agent.pc:netsnmp-agent.pc.in"
+
 ac_config_files="$ac_config_files dist/generation-scripts/gen-variables:dist/generation-scripts/gen-variables.in"
 
 ac_config_files="$ac_config_files local/snmpconf"
@@ -31844,7 +32285,6 @@ LTLIBOBJS=$ac_ltlibobjs
 
 
 
-
 : "${CONFIG_STATUS=./config.status}"
 ac_write_fail=0
 ac_clean_files_save=$ac_clean_files
@@ -32142,16 +32582,16 @@ if (echo >conf$$.file) 2>/dev/null; then
     # ... but there are two gotchas:
     # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
     # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
+    # In both cases, we have to default to `cp -pR'.
     ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
+      as_ln_s='cp -pR'
   elif ln conf$$.file conf$$ 2>/dev/null; then
     as_ln_s=ln
   else
-    as_ln_s='cp -p'
+    as_ln_s='cp -pR'
   fi
 else
-  as_ln_s='cp -p'
+  as_ln_s='cp -pR'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
@@ -32211,28 +32651,16 @@ else
   as_mkdir_p=false
 fi
 
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in #(
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
+
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -32253,8 +32681,8 @@ cat >>$CONFIG_STATUS <<\_ACEOF || ac_wri
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
-This file was extended by Net-SNMP $as_me 5.8, which was
-generated by GNU Autoconf 2.68.  Invocation command line was
+This file was extended by Net-SNMP $as_me 5.9.1, which was
+generated by GNU Autoconf 2.69.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -32319,11 +32747,11 @@ _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
-Net-SNMP config.status 5.8
-configured by $0, generated by GNU Autoconf 2.68,
+Net-SNMP config.status 5.9.1
+configured by $0, generated by GNU Autoconf 2.69,
   with options \\"\$ac_cs_config\\"
 
-Copyright (C) 2010 Free Software Foundation, Inc.
+Copyright (C) 2012 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
 
@@ -32413,7 +32841,7 @@ fi
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 if \$ac_cs_recheck; then
-  set X '$SHELL' '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
+  set X $SHELL '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
   shift
   \$as_echo "running CONFIG_SHELL=$SHELL \$*" >&6
   CONFIG_SHELL='$SHELL'
@@ -32455,8 +32883,10 @@ enable_shared='`$ECHO "$enable_shared" |
 enable_static='`$ECHO "$enable_static" | $SED "$delay_single_quote_subst"`'
 pic_mode='`$ECHO "$pic_mode" | $SED "$delay_single_quote_subst"`'
 enable_fast_install='`$ECHO "$enable_fast_install" | $SED "$delay_single_quote_subst"`'
+shared_archive_member_spec='`$ECHO "$shared_archive_member_spec" | $SED "$delay_single_quote_subst"`'
 SHELL='`$ECHO "$SHELL" | $SED "$delay_single_quote_subst"`'
 ECHO='`$ECHO "$ECHO" | $SED "$delay_single_quote_subst"`'
+PATH_SEPARATOR='`$ECHO "$PATH_SEPARATOR" | $SED "$delay_single_quote_subst"`'
 host_alias='`$ECHO "$host_alias" | $SED "$delay_single_quote_subst"`'
 host='`$ECHO "$host" | $SED "$delay_single_quote_subst"`'
 host_os='`$ECHO "$host_os" | $SED "$delay_single_quote_subst"`'
@@ -32501,10 +32931,13 @@ compiler='`$ECHO "$compiler" | $SED "$de
 GCC='`$ECHO "$GCC" | $SED "$delay_single_quote_subst"`'
 lt_cv_sys_global_symbol_pipe='`$ECHO "$lt_cv_sys_global_symbol_pipe" | $SED "$delay_single_quote_subst"`'
 lt_cv_sys_global_symbol_to_cdecl='`$ECHO "$lt_cv_sys_global_symbol_to_cdecl" | $SED "$delay_single_quote_subst"`'
+lt_cv_sys_global_symbol_to_import='`$ECHO "$lt_cv_sys_global_symbol_to_import" | $SED "$delay_single_quote_subst"`'
 lt_cv_sys_global_symbol_to_c_name_address='`$ECHO "$lt_cv_sys_global_symbol_to_c_name_address" | $SED "$delay_single_quote_subst"`'
 lt_cv_sys_global_symbol_to_c_name_address_lib_prefix='`$ECHO "$lt_cv_sys_global_symbol_to_c_name_address_lib_prefix" | $SED "$delay_single_quote_subst"`'
+lt_cv_nm_interface='`$ECHO "$lt_cv_nm_interface" | $SED "$delay_single_quote_subst"`'
 nm_file_list_spec='`$ECHO "$nm_file_list_spec" | $SED "$delay_single_quote_subst"`'
 lt_sysroot='`$ECHO "$lt_sysroot" | $SED "$delay_single_quote_subst"`'
+lt_cv_truncate_bin='`$ECHO "$lt_cv_truncate_bin" | $SED "$delay_single_quote_subst"`'
 objdir='`$ECHO "$objdir" | $SED "$delay_single_quote_subst"`'
 MAGIC_CMD='`$ECHO "$MAGIC_CMD" | $SED "$delay_single_quote_subst"`'
 lt_prog_compiler_no_builtin_flag='`$ECHO "$lt_prog_compiler_no_builtin_flag" | $SED "$delay_single_quote_subst"`'
@@ -32537,7 +32970,6 @@ with_gnu_ld='`$ECHO "$with_gnu_ld" | $SE
 allow_undefined_flag='`$ECHO "$allow_undefined_flag" | $SED "$delay_single_quote_subst"`'
 no_undefined_flag='`$ECHO "$no_undefined_flag" | $SED "$delay_single_quote_subst"`'
 hardcode_libdir_flag_spec='`$ECHO "$hardcode_libdir_flag_spec" | $SED "$delay_single_quote_subst"`'
-hardcode_libdir_flag_spec_ld='`$ECHO "$hardcode_libdir_flag_spec_ld" | $SED "$delay_single_quote_subst"`'
 hardcode_libdir_separator='`$ECHO "$hardcode_libdir_separator" | $SED "$delay_single_quote_subst"`'
 hardcode_direct='`$ECHO "$hardcode_direct" | $SED "$delay_single_quote_subst"`'
 hardcode_direct_absolute='`$ECHO "$hardcode_direct_absolute" | $SED "$delay_single_quote_subst"`'
@@ -32570,13 +33002,56 @@ finish_cmds='`$ECHO "$finish_cmds" | $SE
 finish_eval='`$ECHO "$finish_eval" | $SED "$delay_single_quote_subst"`'
 hardcode_into_libs='`$ECHO "$hardcode_into_libs" | $SED "$delay_single_quote_subst"`'
 sys_lib_search_path_spec='`$ECHO "$sys_lib_search_path_spec" | $SED "$delay_single_quote_subst"`'
-sys_lib_dlsearch_path_spec='`$ECHO "$sys_lib_dlsearch_path_spec" | $SED "$delay_single_quote_subst"`'
+configure_time_dlsearch_path='`$ECHO "$configure_time_dlsearch_path" | $SED "$delay_single_quote_subst"`'
+configure_time_lt_sys_library_path='`$ECHO "$configure_time_lt_sys_library_path" | $SED "$delay_single_quote_subst"`'
 hardcode_action='`$ECHO "$hardcode_action" | $SED "$delay_single_quote_subst"`'
 enable_dlopen='`$ECHO "$enable_dlopen" | $SED "$delay_single_quote_subst"`'
 enable_dlopen_self='`$ECHO "$enable_dlopen_self" | $SED "$delay_single_quote_subst"`'
 enable_dlopen_self_static='`$ECHO "$enable_dlopen_self_static" | $SED "$delay_single_quote_subst"`'
 old_striplib='`$ECHO "$old_striplib" | $SED "$delay_single_quote_subst"`'
 striplib='`$ECHO "$striplib" | $SED "$delay_single_quote_subst"`'
+LD_RC='`$ECHO "$LD_RC" | $SED "$delay_single_quote_subst"`'
+reload_flag_RC='`$ECHO "$reload_flag_RC" | $SED "$delay_single_quote_subst"`'
+reload_cmds_RC='`$ECHO "$reload_cmds_RC" | $SED "$delay_single_quote_subst"`'
+old_archive_cmds_RC='`$ECHO "$old_archive_cmds_RC" | $SED "$delay_single_quote_subst"`'
+compiler_RC='`$ECHO "$compiler_RC" | $SED "$delay_single_quote_subst"`'
+GCC_RC='`$ECHO "$GCC_RC" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_no_builtin_flag_RC='`$ECHO "$lt_prog_compiler_no_builtin_flag_RC" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_pic_RC='`$ECHO "$lt_prog_compiler_pic_RC" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_wl_RC='`$ECHO "$lt_prog_compiler_wl_RC" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_static_RC='`$ECHO "$lt_prog_compiler_static_RC" | $SED "$delay_single_quote_subst"`'
+lt_cv_prog_compiler_c_o_RC='`$ECHO "$lt_cv_prog_compiler_c_o_RC" | $SED "$delay_single_quote_subst"`'
+archive_cmds_need_lc_RC='`$ECHO "$archive_cmds_need_lc_RC" | $SED "$delay_single_quote_subst"`'
+enable_shared_with_static_runtimes_RC='`$ECHO "$enable_shared_with_static_runtimes_RC" | $SED "$delay_single_quote_subst"`'
+export_dynamic_flag_spec_RC='`$ECHO "$export_dynamic_flag_spec_RC" | $SED "$delay_single_quote_subst"`'
+whole_archive_flag_spec_RC='`$ECHO "$whole_archive_flag_spec_RC" | $SED "$delay_single_quote_subst"`'
+compiler_needs_object_RC='`$ECHO "$compiler_needs_object_RC" | $SED "$delay_single_quote_subst"`'
+old_archive_from_new_cmds_RC='`$ECHO "$old_archive_from_new_cmds_RC" | $SED "$delay_single_quote_subst"`'
+old_archive_from_expsyms_cmds_RC='`$ECHO "$old_archive_from_expsyms_cmds_RC" | $SED "$delay_single_quote_subst"`'
+archive_cmds_RC='`$ECHO "$archive_cmds_RC" | $SED "$delay_single_quote_subst"`'
+archive_expsym_cmds_RC='`$ECHO "$archive_expsym_cmds_RC" | $SED "$delay_single_quote_subst"`'
+module_cmds_RC='`$ECHO "$module_cmds_RC" | $SED "$delay_single_quote_subst"`'
+module_expsym_cmds_RC='`$ECHO "$module_expsym_cmds_RC" | $SED "$delay_single_quote_subst"`'
+with_gnu_ld_RC='`$ECHO "$with_gnu_ld_RC" | $SED "$delay_single_quote_subst"`'
+allow_undefined_flag_RC='`$ECHO "$allow_undefined_flag_RC" | $SED "$delay_single_quote_subst"`'
+no_undefined_flag_RC='`$ECHO "$no_undefined_flag_RC" | $SED "$delay_single_quote_subst"`'
+hardcode_libdir_flag_spec_RC='`$ECHO "$hardcode_libdir_flag_spec_RC" | $SED "$delay_single_quote_subst"`'
+hardcode_libdir_separator_RC='`$ECHO "$hardcode_libdir_separator_RC" | $SED "$delay_single_quote_subst"`'
+hardcode_direct_RC='`$ECHO "$hardcode_direct_RC" | $SED "$delay_single_quote_subst"`'
+hardcode_direct_absolute_RC='`$ECHO "$hardcode_direct_absolute_RC" | $SED "$delay_single_quote_subst"`'
+hardcode_minus_L_RC='`$ECHO "$hardcode_minus_L_RC" | $SED "$delay_single_quote_subst"`'
+hardcode_shlibpath_var_RC='`$ECHO "$hardcode_shlibpath_var_RC" | $SED "$delay_single_quote_subst"`'
+hardcode_automatic_RC='`$ECHO "$hardcode_automatic_RC" | $SED "$delay_single_quote_subst"`'
+inherit_rpath_RC='`$ECHO "$inherit_rpath_RC" | $SED "$delay_single_quote_subst"`'
+link_all_deplibs_RC='`$ECHO "$link_all_deplibs_RC" | $SED "$delay_single_quote_subst"`'
+always_export_symbols_RC='`$ECHO "$always_export_symbols_RC" | $SED "$delay_single_quote_subst"`'
+export_symbols_cmds_RC='`$ECHO "$export_symbols_cmds_RC" | $SED "$delay_single_quote_subst"`'
+exclude_expsyms_RC='`$ECHO "$exclude_expsyms_RC" | $SED "$delay_single_quote_subst"`'
+include_expsyms_RC='`$ECHO "$include_expsyms_RC" | $SED "$delay_single_quote_subst"`'
+prelink_cmds_RC='`$ECHO "$prelink_cmds_RC" | $SED "$delay_single_quote_subst"`'
+postlink_cmds_RC='`$ECHO "$postlink_cmds_RC" | $SED "$delay_single_quote_subst"`'
+file_list_spec_RC='`$ECHO "$file_list_spec_RC" | $SED "$delay_single_quote_subst"`'
+hardcode_action_RC='`$ECHO "$hardcode_action_RC" | $SED "$delay_single_quote_subst"`'
 
 LTCC='$LTCC'
 LTCFLAGS='$LTCFLAGS'
@@ -32596,6 +33071,7 @@ DLLTOOL \
 OBJDUMP \
 SHELL \
 ECHO \
+PATH_SEPARATOR \
 SED \
 GREP \
 EGREP \
@@ -32621,9 +33097,12 @@ CFLAGS \
 compiler \
 lt_cv_sys_global_symbol_pipe \
 lt_cv_sys_global_symbol_to_cdecl \
+lt_cv_sys_global_symbol_to_import \
 lt_cv_sys_global_symbol_to_c_name_address \
 lt_cv_sys_global_symbol_to_c_name_address_lib_prefix \
+lt_cv_nm_interface \
 nm_file_list_spec \
+lt_cv_truncate_bin \
 lt_prog_compiler_no_builtin_flag \
 lt_prog_compiler_pic \
 lt_prog_compiler_wl \
@@ -32644,7 +33123,6 @@ with_gnu_ld \
 allow_undefined_flag \
 no_undefined_flag \
 hardcode_libdir_flag_spec \
-hardcode_libdir_flag_spec_ld \
 hardcode_libdir_separator \
 exclude_expsyms \
 include_expsyms \
@@ -32656,10 +33134,29 @@ soname_spec \
 install_override_mode \
 finish_eval \
 old_striplib \
-striplib; do
+striplib \
+LD_RC \
+reload_flag_RC \
+compiler_RC \
+lt_prog_compiler_no_builtin_flag_RC \
+lt_prog_compiler_pic_RC \
+lt_prog_compiler_wl_RC \
+lt_prog_compiler_static_RC \
+lt_cv_prog_compiler_c_o_RC \
+export_dynamic_flag_spec_RC \
+whole_archive_flag_spec_RC \
+compiler_needs_object_RC \
+with_gnu_ld_RC \
+allow_undefined_flag_RC \
+no_undefined_flag_RC \
+hardcode_libdir_flag_spec_RC \
+hardcode_libdir_separator_RC \
+exclude_expsyms_RC \
+include_expsyms_RC \
+file_list_spec_RC; do
     case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
     *[\\\\\\\`\\"\\\$]*)
-      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED \\"\\\$sed_quote_subst\\"\\\`\\\\\\""
+      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED \\"\\\$sed_quote_subst\\"\\\`\\\\\\"" ## exclude from sc_prohibit_nested_quotes
       ;;
     *)
       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
@@ -32686,10 +33183,22 @@ postinstall_cmds \
 postuninstall_cmds \
 finish_cmds \
 sys_lib_search_path_spec \
-sys_lib_dlsearch_path_spec; do
+configure_time_dlsearch_path \
+configure_time_lt_sys_library_path \
+reload_cmds_RC \
+old_archive_cmds_RC \
+old_archive_from_new_cmds_RC \
+old_archive_from_expsyms_cmds_RC \
+archive_cmds_RC \
+archive_expsym_cmds_RC \
+module_cmds_RC \
+module_expsym_cmds_RC \
+export_symbols_cmds_RC \
+prelink_cmds_RC \
+postlink_cmds_RC; do
     case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
     *[\\\\\\\`\\"\\\$]*)
-      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED -e \\"\\\$double_quote_subst\\" -e \\"\\\$sed_quote_subst\\" -e \\"\\\$delay_variable_subst\\"\\\`\\\\\\""
+      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED -e \\"\\\$double_quote_subst\\" -e \\"\\\$sed_quote_subst\\" -e \\"\\\$delay_variable_subst\\"\\\`\\\\\\"" ## exclude from sc_prohibit_nested_quotes
       ;;
     *)
       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
@@ -32698,25 +33207,24 @@ sys_lib_dlsearch_path_spec; do
 done
 
 ac_aux_dir='$ac_aux_dir'
-xsi_shell='$xsi_shell'
-lt_shell_append='$lt_shell_append'
 
-# See if we are running on zsh, and set the options which allow our
+# See if we are running on zsh, and set the options that allow our
 # commands through without removal of \ escapes INIT.
-if test -n "\${ZSH_VERSION+set}" ; then
+if test -n "\${ZSH_VERSION+set}"; then
    setopt NO_GLOB_SUBST
 fi
 
 
     PACKAGE='$PACKAGE'
     VERSION='$VERSION'
-    TIMESTAMP='$TIMESTAMP'
     RM='$RM'
     ofile='$ofile'
 
 
 
 
+
+
 _ACEOF
 
 cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
@@ -32740,6 +33248,8 @@ do
     "mibs/Makefile") CONFIG_FILES="$CONFIG_FILES mibs/Makefile:Makefile.top:mibs/Makefile.in:Makefile.rules" ;;
     "net-snmp-config") CONFIG_FILES="$CONFIG_FILES net-snmp-config:net-snmp-config.in" ;;
     "net-snmp-create-v3-user") CONFIG_FILES="$CONFIG_FILES net-snmp-create-v3-user:net-snmp-create-v3-user.in" ;;
+    "netsnmp.pc") CONFIG_FILES="$CONFIG_FILES netsnmp.pc:netsnmp.pc.in" ;;
+    "netsnmp-agent.pc") CONFIG_FILES="$CONFIG_FILES netsnmp-agent.pc:netsnmp-agent.pc.in" ;;
     "dist/generation-scripts/gen-variables") CONFIG_FILES="$CONFIG_FILES dist/generation-scripts/gen-variables:dist/generation-scripts/gen-variables.in" ;;
     "local/snmpconf") CONFIG_FILES="$CONFIG_FILES local/snmpconf" ;;
     "default") CONFIG_COMMANDS="$CONFIG_COMMANDS default" ;;
@@ -33339,55 +33849,53 @@ $as_echo "$as_me: executing $ac_file com
   case $ac_file$ac_mode in
     "libtool":C)
 
-    # See if we are running on zsh, and set the options which allow our
+    # See if we are running on zsh, and set the options that allow our
     # commands through without removal of \ escapes.
-    if test -n "${ZSH_VERSION+set}" ; then
+    if test -n "${ZSH_VERSION+set}"; then
       setopt NO_GLOB_SUBST
     fi
 
-    cfgfile="${ofile}T"
+    cfgfile=${ofile}T
     trap "$RM \"$cfgfile\"; exit 1" 1 2 15
     $RM "$cfgfile"
 
     cat <<_LT_EOF >> "$cfgfile"
 #! $SHELL
-
-# `$ECHO "$ofile" | sed 's%^.*/%%'` - Provide generalized library-building support services.
-# Generated automatically by $as_me ($PACKAGE$TIMESTAMP) $VERSION
+# Generated automatically by $as_me ($PACKAGE) $VERSION
 # Libtool was configured on host `(hostname || uname -n) 2>/dev/null | sed 1q`:
 # NOTE: Changes made to this file will be lost: look at ltmain.sh.
+
+# Provide generalized library-building support services.
+# Written by Gordon Matzigkeit, 1996
+
+# Copyright (C) 2014 Free Software Foundation, Inc.
+# This is free software; see the source for copying conditions.  There is NO
+# warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+
+# GNU Libtool is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of of the License, or
+# (at your option) any later version.
+#
+# As a special exception to the GNU General Public License, if you
+# distribute this file as part of a program or library that is built
+# using GNU Libtool, you may include this file under the  same
+# distribution terms that you use for the rest of that program.
 #
-#   Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005,
-#                 2006, 2007, 2008, 2009, 2010 Free Software Foundation,
-#                 Inc.
-#   Written by Gordon Matzigkeit, 1996
-#
-#   This file is part of GNU Libtool.
-#
-# GNU Libtool is free software; you can redistribute it and/or
-# modify it under the terms of the GNU General Public License as
-# published by the Free Software Foundation; either version 2 of
-# the License, or (at your option) any later version.
-#
-# As a special exception to the GNU General Public License,
-# if you distribute this file as part of a program or library that
-# is built using GNU Libtool, you may include this file under the
-# same distribution terms that you use for the rest of that program.
-#
-# GNU Libtool is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# GNU Libtool is distributed in the hope that it will be useful, but
+# WITHOUT ANY WARRANTY; without even the implied warranty of
 # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 # GNU General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
-# along with GNU Libtool; see the file COPYING.  If not, a copy
-# can be downloaded from http://www.gnu.org/licenses/gpl.html, or
-# obtained by writing to the Free Software Foundation, Inc.,
-# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+# along with this program.  If not, see <http://www.gnu.org/licenses/>.
 
 
 # The names of the tagged configurations supported by this script.
-available_tags=""
+available_tags='RC '
+
+# Configured defaults for sys_lib_dlsearch_path munging.
+: \${LT_SYS_LIBRARY_PATH="$configure_time_lt_sys_library_path"}
 
 # ### BEGIN LIBTOOL CONFIG
 
@@ -33416,12 +33924,18 @@ pic_mode=$pic_mode
 # Whether or not to optimize for fast installation.
 fast_install=$enable_fast_install
 
+# Shared archive member basename,for filename based shared library versioning on AIX.
+shared_archive_member_spec=$shared_archive_member_spec
+
 # Shell to use when invoking shell scripts.
 SHELL=$lt_SHELL
 
 # An echo program that protects backslashes.
 ECHO=$lt_ECHO
 
+# The PATH separator for the build system.
+PATH_SEPARATOR=$lt_PATH_SEPARATOR
+
 # The host system.
 host_alias=$host_alias
 host=$host
@@ -33524,18 +34038,27 @@ global_symbol_pipe=$lt_lt_cv_sys_global_
 # Transform the output of nm in a proper C declaration.
 global_symbol_to_cdecl=$lt_lt_cv_sys_global_symbol_to_cdecl
 
+# Transform the output of nm into a list of symbols to manually relocate.
+global_symbol_to_import=$lt_lt_cv_sys_global_symbol_to_import
+
 # Transform the output of nm in a C name address pair.
 global_symbol_to_c_name_address=$lt_lt_cv_sys_global_symbol_to_c_name_address
 
 # Transform the output of nm in a C name address pair when lib prefix is needed.
 global_symbol_to_c_name_address_lib_prefix=$lt_lt_cv_sys_global_symbol_to_c_name_address_lib_prefix
 
+# The name lister interface.
+nm_interface=$lt_lt_cv_nm_interface
+
 # Specify filename containing input files for \$NM.
 nm_file_list_spec=$lt_nm_file_list_spec
 
-# The root where to search for dependent libraries,and in which our libraries should be installed.
+# The root where to search for dependent libraries,and where our libraries should be installed.
 lt_sysroot=$lt_sysroot
 
+# Command to truncate a binary pipe.
+lt_truncate_bin=$lt_lt_cv_truncate_bin
+
 # The name of the directory that contains temporary libtool files.
 objdir=$objdir
 
@@ -33626,8 +34149,11 @@ hardcode_into_libs=$hardcode_into_libs
 # Compile-time system search path for libraries.
 sys_lib_search_path_spec=$lt_sys_lib_search_path_spec
 
-# Run-time system search path for libraries.
-sys_lib_dlsearch_path_spec=$lt_sys_lib_dlsearch_path_spec
+# Detected run-time system search path for libraries.
+sys_lib_dlsearch_path_spec=$lt_configure_time_dlsearch_path
+
+# Explicit LT_SYS_LIBRARY_PATH set during ./configure time.
+configure_time_lt_sys_library_path=$lt_configure_time_lt_sys_library_path
 
 # Whether dlopen is supported.
 dlopen_support=$enable_dlopen
@@ -33717,20 +34243,16 @@ no_undefined_flag=$lt_no_undefined_flag
 # This must work even if \$libdir does not exist
 hardcode_libdir_flag_spec=$lt_hardcode_libdir_flag_spec
 
-# If ld is used when linking, flag to hardcode \$libdir into a binary
-# during linking.  This must work even if \$libdir does not exist.
-hardcode_libdir_flag_spec_ld=$lt_hardcode_libdir_flag_spec_ld
-
 # Whether we need a single "-rpath" flag with a separated argument.
 hardcode_libdir_separator=$lt_hardcode_libdir_separator
 
-# Set to "yes" if using DIR/libNAME\${shared_ext} during linking hardcodes
+# Set to "yes" if using DIR/libNAME\$shared_ext during linking hardcodes
 # DIR into the resulting binary.
 hardcode_direct=$hardcode_direct
 
-# Set to "yes" if using DIR/libNAME\${shared_ext} during linking hardcodes
+# Set to "yes" if using DIR/libNAME\$shared_ext during linking hardcodes
 # DIR into the resulting binary and the resulting library dependency is
-# "absolute",i.e impossible to change by setting \${shlibpath_var} if the
+# "absolute",i.e impossible to change by setting \$shlibpath_var if the
 # library is relocated.
 hardcode_direct_absolute=$hardcode_direct_absolute
 
@@ -33782,13 +34304,72 @@ hardcode_action=$hardcode_action
 
 _LT_EOF
 
+    cat <<'_LT_EOF' >> "$cfgfile"
+
+# ### BEGIN FUNCTIONS SHARED WITH CONFIGURE
+
+# func_munge_path_list VARIABLE PATH
+# -----------------------------------
+# VARIABLE is name of variable containing _space_ separated list of
+# directories to be munged by the contents of PATH, which is string
+# having a format:
+# "DIR[:DIR]:"
+#       string "DIR[ DIR]" will be prepended to VARIABLE
+# ":DIR[:DIR]"
+#       string "DIR[ DIR]" will be appended to VARIABLE
+# "DIRP[:DIRP]::[DIRA:]DIRA"
+#       string "DIRP[ DIRP]" will be prepended to VARIABLE and string
+#       "DIRA[ DIRA]" will be appended to VARIABLE
+# "DIR[:DIR]"
+#       VARIABLE will be replaced by "DIR[ DIR]"
+func_munge_path_list ()
+{
+    case x$2 in
+    x)
+        ;;
+    *:)
+        eval $1=\"`$ECHO $2 | $SED 's/:/ /g'` \$$1\"
+        ;;
+    x:*)
+        eval $1=\"\$$1 `$ECHO $2 | $SED 's/:/ /g'`\"
+        ;;
+    *::*)
+        eval $1=\"\$$1\ `$ECHO $2 | $SED -e 's/.*:://' -e 's/:/ /g'`\"
+        eval $1=\"`$ECHO $2 | $SED -e 's/::.*//' -e 's/:/ /g'`\ \$$1\"
+        ;;
+    *)
+        eval $1=\"`$ECHO $2 | $SED 's/:/ /g'`\"
+        ;;
+    esac
+}
+
+
+# Calculate cc_basename.  Skip known compiler wrappers and cross-prefix.
+func_cc_basename ()
+{
+    for cc_temp in $*""; do
+      case $cc_temp in
+        compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
+        distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
+        \-*) ;;
+        *) break;;
+      esac
+    done
+    func_cc_basename_result=`$ECHO "$cc_temp" | $SED "s%.*/%%; s%^$host_alias-%%"`
+}
+
+
+# ### END FUNCTIONS SHARED WITH CONFIGURE
+
+_LT_EOF
+
   case $host_os in
   aix3*)
     cat <<\_LT_EOF >> "$cfgfile"
 # AIX sometimes has problems with the GCC collect2 program.  For some
 # reason, if we set the COLLECT_NAMES environment variable, the problems
 # vanish in a puff of smoke.
-if test "X${COLLECT_NAMES+set}" != Xset; then
+if test set != "${COLLECT_NAMES+set}"; then
   COLLECT_NAMES=
   export COLLECT_NAMES
 fi
@@ -33797,7 +34378,7 @@ _LT_EOF
   esac
 
 
-ltmain="$ac_aux_dir/ltmain.sh"
+ltmain=$ac_aux_dir/ltmain.sh
 
 
   # We use sed instead of cat because bash on DJGPP gets confused if
@@ -33807,169 +34388,149 @@ ltmain="$ac_aux_dir/ltmain.sh"
   sed '$q' "$ltmain" >> "$cfgfile" \
      || (rm -f "$cfgfile"; exit 1)
 
-  if test x"$xsi_shell" = xyes; then
-  sed -e '/^func_dirname ()$/,/^} # func_dirname /c\
-func_dirname ()\
-{\
-\    case ${1} in\
-\      */*) func_dirname_result="${1%/*}${2}" ;;\
-\      *  ) func_dirname_result="${3}" ;;\
-\    esac\
-} # Extended-shell func_dirname implementation' "$cfgfile" > $cfgfile.tmp \
-  && mv -f "$cfgfile.tmp" "$cfgfile" \
-    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-test 0 -eq $? || _lt_function_replace_fail=:
-
-
-  sed -e '/^func_basename ()$/,/^} # func_basename /c\
-func_basename ()\
-{\
-\    func_basename_result="${1##*/}"\
-} # Extended-shell func_basename implementation' "$cfgfile" > $cfgfile.tmp \
-  && mv -f "$cfgfile.tmp" "$cfgfile" \
-    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-test 0 -eq $? || _lt_function_replace_fail=:
-
-
-  sed -e '/^func_dirname_and_basename ()$/,/^} # func_dirname_and_basename /c\
-func_dirname_and_basename ()\
-{\
-\    case ${1} in\
-\      */*) func_dirname_result="${1%/*}${2}" ;;\
-\      *  ) func_dirname_result="${3}" ;;\
-\    esac\
-\    func_basename_result="${1##*/}"\
-} # Extended-shell func_dirname_and_basename implementation' "$cfgfile" > $cfgfile.tmp \
-  && mv -f "$cfgfile.tmp" "$cfgfile" \
-    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-test 0 -eq $? || _lt_function_replace_fail=:
-
-
-  sed -e '/^func_stripname ()$/,/^} # func_stripname /c\
-func_stripname ()\
-{\
-\    # pdksh 5.2.14 does not do ${X%$Y} correctly if both X and Y are\
-\    # positional parameters, so assign one to ordinary parameter first.\
-\    func_stripname_result=${3}\
-\    func_stripname_result=${func_stripname_result#"${1}"}\
-\    func_stripname_result=${func_stripname_result%"${2}"}\
-} # Extended-shell func_stripname implementation' "$cfgfile" > $cfgfile.tmp \
-  && mv -f "$cfgfile.tmp" "$cfgfile" \
-    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-test 0 -eq $? || _lt_function_replace_fail=:
-
-
-  sed -e '/^func_split_long_opt ()$/,/^} # func_split_long_opt /c\
-func_split_long_opt ()\
-{\
-\    func_split_long_opt_name=${1%%=*}\
-\    func_split_long_opt_arg=${1#*=}\
-} # Extended-shell func_split_long_opt implementation' "$cfgfile" > $cfgfile.tmp \
-  && mv -f "$cfgfile.tmp" "$cfgfile" \
-    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-test 0 -eq $? || _lt_function_replace_fail=:
-
-
-  sed -e '/^func_split_short_opt ()$/,/^} # func_split_short_opt /c\
-func_split_short_opt ()\
-{\
-\    func_split_short_opt_arg=${1#??}\
-\    func_split_short_opt_name=${1%"$func_split_short_opt_arg"}\
-} # Extended-shell func_split_short_opt implementation' "$cfgfile" > $cfgfile.tmp \
-  && mv -f "$cfgfile.tmp" "$cfgfile" \
-    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-test 0 -eq $? || _lt_function_replace_fail=:
-
-
-  sed -e '/^func_lo2o ()$/,/^} # func_lo2o /c\
-func_lo2o ()\
-{\
-\    case ${1} in\
-\      *.lo) func_lo2o_result=${1%.lo}.${objext} ;;\
-\      *)    func_lo2o_result=${1} ;;\
-\    esac\
-} # Extended-shell func_lo2o implementation' "$cfgfile" > $cfgfile.tmp \
-  && mv -f "$cfgfile.tmp" "$cfgfile" \
-    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-test 0 -eq $? || _lt_function_replace_fail=:
-
-
-  sed -e '/^func_xform ()$/,/^} # func_xform /c\
-func_xform ()\
-{\
-    func_xform_result=${1%.*}.lo\
-} # Extended-shell func_xform implementation' "$cfgfile" > $cfgfile.tmp \
-  && mv -f "$cfgfile.tmp" "$cfgfile" \
-    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-test 0 -eq $? || _lt_function_replace_fail=:
-
-
-  sed -e '/^func_arith ()$/,/^} # func_arith /c\
-func_arith ()\
-{\
-    func_arith_result=$(( $* ))\
-} # Extended-shell func_arith implementation' "$cfgfile" > $cfgfile.tmp \
-  && mv -f "$cfgfile.tmp" "$cfgfile" \
-    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-test 0 -eq $? || _lt_function_replace_fail=:
-
-
-  sed -e '/^func_len ()$/,/^} # func_len /c\
-func_len ()\
-{\
-    func_len_result=${#1}\
-} # Extended-shell func_len implementation' "$cfgfile" > $cfgfile.tmp \
-  && mv -f "$cfgfile.tmp" "$cfgfile" \
-    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-test 0 -eq $? || _lt_function_replace_fail=:
-
-fi
-
-if test x"$lt_shell_append" = xyes; then
-  sed -e '/^func_append ()$/,/^} # func_append /c\
-func_append ()\
-{\
-    eval "${1}+=\\${2}"\
-} # Extended-shell func_append implementation' "$cfgfile" > $cfgfile.tmp \
-  && mv -f "$cfgfile.tmp" "$cfgfile" \
-    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-test 0 -eq $? || _lt_function_replace_fail=:
-
-
-  sed -e '/^func_append_quoted ()$/,/^} # func_append_quoted /c\
-func_append_quoted ()\
-{\
-\    func_quote_for_eval "${2}"\
-\    eval "${1}+=\\\\ \\$func_quote_for_eval_result"\
-} # Extended-shell func_append_quoted implementation' "$cfgfile" > $cfgfile.tmp \
-  && mv -f "$cfgfile.tmp" "$cfgfile" \
-    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-test 0 -eq $? || _lt_function_replace_fail=:
-
-
-  # Save a `func_append' function call where possible by direct use of '+='
-  sed -e 's%func_append \([a-zA-Z_]\{1,\}\) "%\1+="%g' $cfgfile > $cfgfile.tmp \
-    && mv -f "$cfgfile.tmp" "$cfgfile" \
-      || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-  test 0 -eq $? || _lt_function_replace_fail=:
-else
-  # Save a `func_append' function call even when '+=' is not available
-  sed -e 's%func_append \([a-zA-Z_]\{1,\}\) "%\1="$\1%g' $cfgfile > $cfgfile.tmp \
-    && mv -f "$cfgfile.tmp" "$cfgfile" \
-      || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-  test 0 -eq $? || _lt_function_replace_fail=:
-fi
-
-if test x"$_lt_function_replace_fail" = x":"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Unable to substitute extended shell functions in $ofile" >&5
-$as_echo "$as_me: WARNING: Unable to substitute extended shell functions in $ofile" >&2;}
-fi
-
-
    mv -f "$cfgfile" "$ofile" ||
     (rm -f "$ofile" && cp "$cfgfile" "$ofile" && rm -f "$cfgfile")
   chmod +x "$ofile"
 
+
+    cat <<_LT_EOF >> "$ofile"
+
+# ### BEGIN LIBTOOL TAG CONFIG: RC
+
+# The linker used to build libraries.
+LD=$lt_LD_RC
+
+# How to create reloadable object files.
+reload_flag=$lt_reload_flag_RC
+reload_cmds=$lt_reload_cmds_RC
+
+# Commands used to build an old-style archive.
+old_archive_cmds=$lt_old_archive_cmds_RC
+
+# A language specific compiler.
+CC=$lt_compiler_RC
+
+# Is the compiler the GNU compiler?
+with_gcc=$GCC_RC
+
+# Compiler flag to turn off builtin functions.
+no_builtin_flag=$lt_lt_prog_compiler_no_builtin_flag_RC
+
+# Additional compiler flags for building library objects.
+pic_flag=$lt_lt_prog_compiler_pic_RC
+
+# How to pass a linker flag through the compiler.
+wl=$lt_lt_prog_compiler_wl_RC
+
+# Compiler flag to prevent dynamic linking.
+link_static_flag=$lt_lt_prog_compiler_static_RC
+
+# Does compiler simultaneously support -c and -o options?
+compiler_c_o=$lt_lt_cv_prog_compiler_c_o_RC
+
+# Whether or not to add -lc for building shared libraries.
+build_libtool_need_lc=$archive_cmds_need_lc_RC
+
+# Whether or not to disallow shared libs when runtime libs are static.
+allow_libtool_libs_with_static_runtimes=$enable_shared_with_static_runtimes_RC
+
+# Compiler flag to allow reflexive dlopens.
+export_dynamic_flag_spec=$lt_export_dynamic_flag_spec_RC
+
+# Compiler flag to generate shared objects directly from archives.
+whole_archive_flag_spec=$lt_whole_archive_flag_spec_RC
+
+# Whether the compiler copes with passing no objects directly.
+compiler_needs_object=$lt_compiler_needs_object_RC
+
+# Create an old-style archive from a shared archive.
+old_archive_from_new_cmds=$lt_old_archive_from_new_cmds_RC
+
+# Create a temporary old-style archive to link instead of a shared archive.
+old_archive_from_expsyms_cmds=$lt_old_archive_from_expsyms_cmds_RC
+
+# Commands used to build a shared archive.
+archive_cmds=$lt_archive_cmds_RC
+archive_expsym_cmds=$lt_archive_expsym_cmds_RC
+
+# Commands used to build a loadable module if different from building
+# a shared archive.
+module_cmds=$lt_module_cmds_RC
+module_expsym_cmds=$lt_module_expsym_cmds_RC
+
+# Whether we are building with GNU ld or not.
+with_gnu_ld=$lt_with_gnu_ld_RC
+
+# Flag that allows shared libraries with undefined symbols to be built.
+allow_undefined_flag=$lt_allow_undefined_flag_RC
+
+# Flag that enforces no undefined symbols.
+no_undefined_flag=$lt_no_undefined_flag_RC
+
+# Flag to hardcode \$libdir into a binary during linking.
+# This must work even if \$libdir does not exist
+hardcode_libdir_flag_spec=$lt_hardcode_libdir_flag_spec_RC
+
+# Whether we need a single "-rpath" flag with a separated argument.
+hardcode_libdir_separator=$lt_hardcode_libdir_separator_RC
+
+# Set to "yes" if using DIR/libNAME\$shared_ext during linking hardcodes
+# DIR into the resulting binary.
+hardcode_direct=$hardcode_direct_RC
+
+# Set to "yes" if using DIR/libNAME\$shared_ext during linking hardcodes
+# DIR into the resulting binary and the resulting library dependency is
+# "absolute",i.e impossible to change by setting \$shlibpath_var if the
+# library is relocated.
+hardcode_direct_absolute=$hardcode_direct_absolute_RC
+
+# Set to "yes" if using the -LDIR flag during linking hardcodes DIR
+# into the resulting binary.
+hardcode_minus_L=$hardcode_minus_L_RC
+
+# Set to "yes" if using SHLIBPATH_VAR=DIR during linking hardcodes DIR
+# into the resulting binary.
+hardcode_shlibpath_var=$hardcode_shlibpath_var_RC
+
+# Set to "yes" if building a shared library automatically hardcodes DIR
+# into the library and all subsequent libraries and executables linked
+# against it.
+hardcode_automatic=$hardcode_automatic_RC
+
+# Set to yes if linker adds runtime paths of dependent libraries
+# to runtime path list.
+inherit_rpath=$inherit_rpath_RC
+
+# Whether libtool must link a program against all its dependency libraries.
+link_all_deplibs=$link_all_deplibs_RC
+
+# Set to "yes" if exported symbols are required.
+always_export_symbols=$always_export_symbols_RC
+
+# The commands to list exported symbols.
+export_symbols_cmds=$lt_export_symbols_cmds_RC
+
+# Symbols that should not be listed in the preloaded symbols.
+exclude_expsyms=$lt_exclude_expsyms_RC
+
+# Symbols that must always be exported.
+include_expsyms=$lt_include_expsyms_RC
+
+# Commands necessary for linking programs (against libraries) with templates.
+prelink_cmds=$lt_prelink_cmds_RC
+
+# Commands necessary for finishing linking programs.
+postlink_cmds=$lt_postlink_cmds_RC
+
+# Specify filename containing input files.
+file_list_spec=$lt_file_list_spec_RC
+
+# How to hardcode a shared library path into an executable.
+hardcode_action=$hardcode_action_RC
+
+# ### END LIBTOOL TAG CONFIG: RC
+_LT_EOF
+
  ;;
     "net-snmp-config":F) chmod +x net-snmp-config ;;
     "net-snmp-create-v3-user":F) chmod +x net-snmp-create-v3-user ;;
diff -urpN net-snmp-5.8/configure.ac net-snmp-5.9.1/configure.ac
--- net-snmp-5.8/configure.ac	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.ac	2021-05-26 05:19:35.000000000 +0700
@@ -15,7 +15,7 @@
 #
 # Process this file with autoconf to produce a configure script.
 #
-AC_INIT([Net-SNMP], [5.8], [net-snmp-coders@lists.sourceforge.net])
+AC_INIT([Net-SNMP], [5.9.1], [net-snmp-coders@lists.sourceforge.net])
 AC_PREREQ([2.63])
 AC_CONFIG_SRCDIR([agent/snmpd.c])
 AC_REVISION([$Revision$])
@@ -28,7 +28,7 @@ AC_MSG_CACHE_INIT()
 #
 # save the configure arguments
 #
-AC_DEFINE_UNQUOTED(NETSNMP_CONFIGURE_OPTIONS,"$ac_configure_args",
+AC_DEFINE_UNQUOTED(NETSNMP_CONFIGURE_OPTIONS,"${NETSNMP_CONFIGURE_OPTIONS-$ac_configure_args}",
   [configure options specified])
 CONFIGURE_OPTIONS="\"$ac_configure_args\""
 AC_SUBST(CONFIGURE_OPTIONS)
@@ -118,6 +118,7 @@ AC_CONFIG_FILES([net-snmp-config:net-snm
 		[chmod +x net-snmp-config])
 AC_CONFIG_FILES([net-snmp-create-v3-user:net-snmp-create-v3-user.in],
 		[chmod +x net-snmp-create-v3-user])
+AC_CONFIG_FILES([netsnmp.pc:netsnmp.pc.in netsnmp-agent.pc:netsnmp-agent.pc.in])
 AC_CONFIG_FILES([dist/generation-scripts/gen-variables:dist/generation-scripts/gen-variables.in])
 AC_CONFIG_FILES([local/snmpconf])
 
diff -urpN net-snmp-5.8/configure.d/config_modules_lib net-snmp-5.9.1/configure.d/config_modules_lib
--- net-snmp-5.8/configure.d/config_modules_lib	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.d/config_modules_lib	2021-05-26 05:19:35.000000000 +0700
@@ -54,7 +54,7 @@ if test "x$PARTIALTARGETOS" = "xmingw32"
 fi
 
 # Linux systemd
-if test "x$with_systemd" == "xyes"; then
+if test "x$with_systemd" = "xyes"; then
   other_src_list="$other_src_list sd-daemon.c"
   other_objs_list="$other_objs_list sd-daemon.o"
   other_lobjs_list="$other_lobjs_list sd-daemon.lo"
@@ -142,6 +142,9 @@ AC_MSG_CACHE_ADD(SNMPv3 Security Modules
 rebuilt_new_with_security=
 already_checked_krb5=no
 
+netsnmp_save_LIBS=$LIBS
+CRYPTO_LIBS=""
+
 for sec in $new_with_security
 do
   if test "x$sec" = "xksm"; then
@@ -163,21 +166,24 @@ do
     AC_PATH_PROG([krb5_config],krb5-config,[no],$krb5path/bin:$PATH)
 
     if test no != $krb5_config; then
+      [
       CPPFLAGS="$CPPFLAGS `$krb5_config --cflags`"
-      LIBS="$LIBS `$krb5_config --libs`"
+      CRYPTO_LIBS="$CRYPTO_LIBS `$krb5_config --libs |
+				 $SED 's/-flto=[^[:blank:]]*//g'`"
+      ]
     elif test $krb5path != no; then
       AC_ADD_SEARCH_PATH($krb5path)
     else
       AC_ADD_SEARCH_PATH(/usr/kerberos)
     fi
 
-    AC_MSG_CHECKING([for krb5])
-    AC_CACHE_VAL(ac_cv_have_krb5,
-      AC_CHECK_LIB(krb5, krb5_init_context,
-	ac_cv_have_krb5=yes, ac_cv_have_krb5=no
-      )
-    )
+    NETSNMP_SEARCH_LIBS([krb5_init_context], [krb5],
+                        [ac_cv_have_krb5=yes], [ac_cv_have_krb5=no], [],
+                        [CRYPTO_LIBS])
+    NETSNMP_SEARCH_LIBS([error_message], [com_err], [], [], [],
+                        [CRYPTO_LIBS])
 
+    AC_MSG_CHECKING([for krb5])
     if test $ac_cv_have_krb5 = no; then
       if test "x$askedkrb5" = "xyes"; then
 	AC_MSG_ERROR(Asked to use krb5 but I couldn't find it.)
@@ -202,33 +208,41 @@ do
       AC_DEFINE(NETSNMP_USE_KERBEROS_HEIMDAL, 1,
         [Define this if you're using Heimdal Kerberos])
       if test no = $krb5_config; then
-	LIBS="$LIBS -lkrb5 -lasn1 -lcom_err -lroken"
+	CRYPTO_LIBS="$CRYPTO_LIBS -lkrb5 -lasn1 -lcom_err -lroken"
       fi
     elif test no = $krb5_config; then
-	LIBS="$LIBS -lkrb5 -lcom_err"
+	CRYPTO_LIBS="$CRYPTO_LIBS -lkrb5 -lcom_err"
     fi
 
-    AC_MSG_CHECKING([to see which crypto API we need to use])
     AC_CACHE_VAL(ac_cv_NETSNMP_USE_KERBEROS_MIT,
-      AC_CHECK_LIB(k5crypto, krb5_init_context,
-	ac_cv_NETSNMP_USE_KERBEROS_MIT=yes, ac_cv_NETSNMP_USE_KERBEROS_MIT=no
-      )
+      NETSNMP_SEARCH_LIBS([krb5_init_context], [k5crypto],
+                          [ac_cv_NETSNMP_USE_KERBEROS_MIT=yes],
+                          [ac_cv_NETSNMP_USE_KERBEROS_MIT=no], [],
+                          [CRYPTO_LIBS])
     )
+    NETSNMP_SEARCH_LIBS([krb5_c_keyed_checksum_types], [k5crypto], [], [], [],
+                        [CRYPTO_LIBS])
 
+    AC_CHECK_MEMBERS([krb5_keyblock.enctype], [],
+                     [ac_cv_NETSNMP_USE_KERBEROS_MIT=no],
+                     [[#include <krb5.h>]])
+
+    AC_MSG_CHECKING([to see which crypto API we need to use])
     if test yes = $ac_cv_NETSNMP_USE_KERBEROS_MIT; then
       AC_MSG_RESULT(new MIT crypto API)
       AC_DEFINE(NETSNMP_USE_KERBEROS_MIT, 1,
         [Define this if we're using the new MIT crypto API])
-      if test no = $krb5_config; then
-	LIBS="$LIBS -lk5crypto"
-      fi
     else
       AC_MSG_RESULT(old MIT crypto API)
     fi
+    LIBS="$CRYPTO_LIBS $netsnmp_save_LIBS"
     AC_CHECK_FUNCS([krb5_auth_con_getsendsubkey krb5_auth_con_getrecvsubkey])
   fi
 done
 
+LNETSNMPLIBS="$LNETSNMPLIBS $CRYPTO_LIBS"
+LIBS=$netsnmp_save_LIBS
+
 new_with_security=$rebuilt_new_with_security
 
 #
diff -urpN net-snmp-5.8/configure.d/config_net_snmp_config_h net-snmp-5.9.1/configure.d/config_net_snmp_config_h
--- net-snmp-5.8/configure.d/config_net_snmp_config_h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.d/config_net_snmp_config_h	2021-05-26 05:19:35.000000000 +0700
@@ -56,6 +56,33 @@ AH_BOTTOM([/* end of definitions added b
 
 #endif /* NETSNMP_NO_AUTOCONF_DEFINITIONS */
 
+/*
+ * Note: GCC 4.6 added __BYTE_ORDER__, __ORDER_BIG_ENDIAN__,
+ * __ORDER_LITTLE_ENDIAN__ and __ORDER_PDP_ENDIAN__ in SVN r165881. For older
+ * gcc versions and also for other compilers, determine the endianness using
+ * an expression that can be evaluated at compile time. To do: add support for
+ * other compilers than gcc that do not support statement expressions.
+ */
+#if defined(__BYTE_ORDER__)
+# if __BYTE_ORDER__ == __ORDER_BIG_ENDIAN__
+#  define NETSNMP_BIGENDIAN 1
+# elif __BYTE_ORDER__ == __ORDER_LITTLE_ENDIAN__
+#  define NETSNMP_BIGENDIAN 0
+# else
+#  error Unknown byte order
+# endif
+#else
+# define NETSNMP_BIGENDIAN                              \
+    (__extension__                                      \
+     ({                                                 \
+         union { unsigned long l; unsigned char c; } u; \
+                                                        \
+         u.l = 1;                                       \
+         u.c == 0;                                      \
+     })                                                 \
+    )
+#endif
+
 
 
 
diff -urpN net-snmp-5.8/configure.d/config_os_functions net-snmp-5.9.1/configure.d/config_os_functions
--- net-snmp-5.8/configure.d/config_os_functions	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.d/config_os_functions	2021-05-26 05:19:35.000000000 +0700
@@ -16,40 +16,49 @@
 AC_FUNC_ALLOCA          #  alloca()
 AC_PROG_GCC_TRADITIONAL
 
-if test "$cross_compiling" = yes -a "${ac_cv_func_memcmp_working+set}" != set
-then
-  # Cross-compiling and ac_cv_func_memcmp_working has not been set - assume
-  # that memcmp() is available.
-  ac_cv_func_memcmp_working=yes
-else
-  # Native compilation - test for the availability of memcmp().
-  AC_FUNC_MEMCMP
-fi
-
 AC_TYPE_SIGNAL
 
 ##
 #   Stand-alone function checks:
 ##
 #  Core:
-AC_CHECK_FUNCS([rand   random srand srandom lrand48 srand48] dnl
-               [signal sigset                              ] )
+AC_CHECK_FUNCS([rand   random srand srandom lrand48 srand48])
 
 #  Library:
-AC_CHECK_FUNCS([asprintf                                         ] dnl
-               [closedir        fgetc_unlocked  flockfile        ] dnl
-               [fork            funlockfile     getipnodebyname  ] dnl
-               [gettimeofday    if_nametoindex  mkstemp          ] dnl
+AC_CHECK_FUNCS([asprintf        closedir        fgetc_unlocked   ] dnl
+               [flockfile       funlockfile     getipnodebyname  ] dnl
+               [gettimeofday    getlogin                         ] dnl
+               [if_nametoindex  mkstemp                          ] dnl
                [opendir         readdir         regcomp          ] dnl
                [setenv          setitimer       setlocale        ] dnl
                [setsid          snprintf        strcasestr       ] dnl
                [strdup          strerror        strncasecmp      ] dnl
                [sysconf         times           vsnprintf        ] )
 
+AC_MSG_CHECKING([for _NSGetArgv()])
+AC_LINK_IFELSE(
+  [AC_LANG_PROGRAM([#include <crt_externs.h>], [return _NSGetArgv])],
+  [AC_DEFINE([HAVE__NSGETARGV], [1],
+    [Define to 1 if you have the `_NSGetArgv' function.])
+    AC_MSG_RESULT([yes])
+  ],
+  [AC_MSG_RESULT([no])]
+)
+
+AC_MSG_CHECKING([for _NSGetExecutablePath()])
+AC_LINK_IFELSE(
+  [AC_LANG_PROGRAM([#include <mach-o/dyld.h>], [return _NSGetExecutablePath])],
+  [AC_DEFINE([HAVE__NSGETEXECUTABLEPATH], [1],
+    [Define to 1 if you have the `_NSGetExecutablePath' function.])
+    AC_MSG_RESULT([yes])
+  ],
+  [AC_MSG_RESULT([no])]
+)
+
 # IPv4/IPv6 function checks. AC_CHECK_FUNC() can't find these on MinGW
 # since these functions have the __cdecl calling convention on MinGW.
-case x$target_os in
-  xmingw*)
+case x$with_socklib in
+  xwinsock2)
     AC_LINK_IFELSE([AC_LANG_PROGRAM([#include <winsock2.h>],
     [ closesocket(0); ])],
     [ ac_cv_func_closesocket=yes
@@ -76,7 +85,7 @@ case x$target_os in
 
     AC_LINK_IFELSE([AC_LANG_PROGRAM([#include <winsock2.h>],
     [ gethostbyaddr(NULL); ])],
-    [ ac_cv_func_gethostaddr=yes
+    [ ac_cv_func_gethostbyaddr=yes
       AS_ECHO "#define HAVE_GETHOSTBYADDR 1" >>confdefs.h
     ], [ ])
 
@@ -88,33 +97,82 @@ case x$target_os in
     ;;
 
   *)
-    AC_CHECK_FUNCS([closesocket gai_strerror getaddrinfo gethostbyname gethostbyname2 gethostname gethostbyaddr])
+    # Do not use fork() nor any related function when using Windows sockets
+    # because Windows sockets are not compatible with fork().
+    AC_CHECK_FUNCS([execv fork signal sigset uname posix_spawn waitpid]dnl
+                   [closesocket gai_strerror getaddrinfo gethostbyname]dnl
+                   [gethostbyname2 gethostname gethostbyaddr]dnl
+                   [inet_ntop inet_pton])
     ;;
 esac
 
+# Check for MSVC functions.
+AC_MSG_CHECKING([for _beginthreadex()])
+AC_LINK_IFELSE([AC_LANG_PROGRAM([
+#include <stddef.h>
+#include <process.h>
+], [ _beginthreadex(NULL, 0, NULL, NULL, 0, NULL); ])],
+[AC_MSG_RESULT([yes])
+ AC_DEFINE([HAVE__BEGINTHREADEX], [1],
+           [Define if _beginthreadex() is defined in <process.h>])],
+[AC_MSG_RESULT([no])])
+
+AC_MSG_CHECKING([for _cputs()])
+AC_LINK_IFELSE([AC_LANG_PROGRAM([#include <conio.h>],[ _cputs(0); ])],
+[AC_MSG_RESULT([yes])
+ AC_DEFINE([HAVE__CPUTS], [1],
+           [Define if _cputs() is defined in <conio.h>])],
+[AC_MSG_RESULT([no])])
+
+AC_MSG_CHECKING([for _get_osfhandle()])
+AC_LINK_IFELSE([AC_LANG_PROGRAM([#include <io.h>],[ _get_osfhandle(0); ])],
+[AC_MSG_RESULT([yes])
+ AC_DEFINE([HAVE__GET_OSFHANDLE], [1],
+           [Define if _get_osfhandle() is defined in <io.h>])],
+[AC_MSG_RESULT([no])])
+
+AC_MSG_CHECKING([for _getch()])
+AC_LINK_IFELSE([AC_LANG_PROGRAM([#include <conio.h>],[ return _getch(); ])],
+[AC_MSG_RESULT([yes])
+ AC_DEFINE([HAVE__GETCH], [1],
+           [Define if _getch() is defined in <conio.h>])],
+[AC_MSG_RESULT([no])])
+
+AC_MSG_CHECKING([for _open_osfhandle()])
+AC_LINK_IFELSE([AC_LANG_PROGRAM([
+#include <stddef.h>
+#include <io.h>
+], [ _open_osfhandle(NULL, 0); ])],
+[AC_MSG_RESULT([yes])
+ AC_DEFINE([HAVE__OPEN_OSFHANDLE], [1],
+           [Define if _open_osfhandle() is defined in <io.h>])],
+[AC_MSG_RESULT([no])])
+
+
 AC_CONFIG_LIBOBJ_DIR([snmplib])
 
-AC_REPLACE_FUNCS([getopt        inet_ntop     inet_pton        ] dnl
+AC_REPLACE_FUNCS([getopt                                       ] dnl
                  [strlcat       strlcpy       strtok_r         ] dnl
                  [strtol        strtoul       strtoull         ] )
 
 #  Agent:
-AC_CHECK_FUNCS([cgetnext        chown          execv           ] dnl
-               [forkall         fsync                          ] dnl
-               [gai_strerror    getgrnam                       ] dnl
-               [gethostname     getloadavg                     ] dnl
+AC_CHECK_FUNCS([cgetnext        chown          endfsent        ] dnl
+               [forkall         fsync          gai_strerror    ] dnl
+               [getfsent        getgrnam       gethostname     ] dnl
+               [getloadavg      getmntent      getmntinfo      ] dnl
                [getpid          getpwnam                       ] dnl
                [hasmntopt       initgroups                     ] dnl
                [if_nameindex    if_indextoname if_nametoindex  ] dnl
                [localtime_r     mkstemp        mktime          ] dnl
-               [poll            regcomp                        ] dnl
+               [poll            regcomp        setfsent        ] dnl
                [setgid          setgroups                      ] dnl
                [setmntent       setuid                         ] dnl
-               [sigaction       sigblock      sighold          ] dnl
-               [sigprocmask                                    ] dnl
+               [sigaction       sigblock      sigprocmask      ] dnl
                [statfs          statvfs       stime            ] dnl
-               [strncasecmp     system                         ] dnl
-               [uname           usleep                         ] )
+               [strncasecmp     system        usleep           ] )
+
+# Agent, Darwin (Apple):
+AC_CHECK_FUNCS([vm_region vm_region_64])
 
 #  Apps:
 AC_CHECK_FUNCS([getdtablesize                                  ] dnl
@@ -158,12 +216,12 @@ AC_CACHE_VAL(
 #ifdef HAVE_SYS_FS_TYPES_H
 #include <sys/fs_types.h>
 #endif
-main ()
+int main ()
 {
 struct fs_data fsd;
 /* Ultrix's statfs returns 1 for success,
    0 for not mounted, -1 for failure.  */
-exit (statfs (".", &fsd) != 1);
+return statfs (".", &fsd) != 1;
 }]])],
     [fu_cv_sys_stat_fs_data=yes],
     [fu_cv_sys_stat_fs_data=no],
@@ -257,62 +315,42 @@ fi
 #   Check how to print a size_t variable
 ##
 
-AC_CACHE_CHECK(
-    [the underlying type of a size_t],
-    netsnmp_cv_size_t_type,
-    [m4_foreach([TYPE], [[int],[long],[long long],[short],[char]],
-     [if [[ x$netsnmp_cv_size_t_type = x ]] ; then
-         AC_COMPILE_IFELSE(
-	     [AC_LANG_PROGRAM(
-[AC_INCLUDES_DEFAULT()
-extern unsigned TYPE variable;
-extern size_t variable;],
-                 [])],
-             [netsnmp_cv_size_t_type="TYPE"])
-     fi
-    ])])
-
-AC_MSG_CHECKING([how to printf a size_t])
-case "$netsnmp_cv_size_t_type" in
-    char|short|int) netsnmp_PRIz="" ;;
-    long) netsnmp_PRIz="l" ;;
-    "long long") netsnmp_PRIz="ll" ;;
-    *) AC_MSG_ERROR([underlying type of size_t not known]) ;;
+case x${host_cpu}-${host_vendor}-${host_os} in
+  x*mingw*)
+    # MinGW or MinGW-w64.
+    AC_CACHE_CHECK(
+      [the underlying type of size_t],
+      [netsnmp_cv_size_t_type],
+      [for TYPE in int long "long long" short char; do
+        AC_COMPILE_IFELSE(
+          [AC_LANG_PROGRAM([
+            AC_INCLUDES_DEFAULT()
+            extern unsigned $TYPE variable;
+            extern size_t variable;
+          ], [])],
+          [netsnmp_cv_size_t_type="$TYPE"])
+        if test "x$netsnmp_cv_size_t_type" != x; then break; fi
+      done])
+
+    AC_MSG_CHECKING([how to printf a size_t])
+    case "$netsnmp_cv_size_t_type" in
+      char|short|int)
+        netsnmp_PRIz="";;
+      long)
+        netsnmp_PRIz="l";;
+      "long long")
+        netsnmp_PRIz="I64";;
+      *)
+        AC_MSG_ERROR([underlying type of size_t not known]);;
+    esac
+    AC_MSG_RESULT([$netsnmp_PRIz]);;
+  *)
+    # Unix or Cygwin.
+    netsnmp_PRIz="z";;
 esac
-AC_MSG_RESULT($netsnmp_PRIz)
 AC_DEFINE_UNQUOTED([NETSNMP_PRIz], ["$netsnmp_PRIz"],
                    [Size prefix to use to printf a size_t or ssize_t])
 
-##
-#   Check how to print a uint32_t variable
-##
-
-AC_CACHE_CHECK(
-    [the underlying type of an uint32_t],
-    netsnmp_cv_uint32_t_type,
-    [m4_foreach([TYPE], [[char],[short],[int],[long],[long long]],
-     [if [[ x$netsnmp_cv_uint32_t_type = x ]] ; then
-         AC_COMPILE_IFELSE(
-	     [AC_LANG_PROGRAM(
-[AC_INCLUDES_DEFAULT()
-extern unsigned TYPE variable;
-extern uint32_t variable;],
-                 [])],
-             [netsnmp_cv_uint32_t_type="TYPE"])
-     fi
-    ])])
-
-AC_MSG_CHECKING([how to printf a uint32_t])
-case "$netsnmp_cv_uint32_t_type" in
-    char|short|int) netsnmp_PRI32="" ;;
-    long) netsnmp_PRI32="l" ;;
-    "long long") netsnmp_PRI32="ll" ;;
-    *) AC_MSG_ERROR([underlying type of uint32_t not known]) ;;
-esac
-AC_MSG_RESULT($netsnmp_PRI32)
-AC_DEFINE_UNQUOTED([NETSNMP_PRI32], ["$netsnmp_PRI32"],
-                   [Size prefix to use to printf a uint32_t])
-
 # check to see if the openssl is good enough for DTLS
 # (BIO_dgram_get_peer is a macro, not a true function)
 if echo " $transport_result_list " | $GREP "DTLS" > /dev/null; then
diff -urpN net-snmp-5.8/configure.d/config_os_headers net-snmp-5.9.1/configure.d/config_os_headers
--- net-snmp-5.8/configure.d/config_os_headers	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.d/config_os_headers	2021-05-26 05:19:35.000000000 +0700
@@ -11,7 +11,13 @@
 AC_HEADER_STDC          #  <stdlib.h>, <stdarg.h>,   <string.h>  & <float.h>
 AC_HEADER_DIRENT        #  <dirent.h>, <sys/ndir.h>, <sys/dir.h> & <ndir.h>
 #  Apps:
-AC_HEADER_SYS_WAIT      #  <sys/wait.h>
+# Don't use <sys/wait.h> when using Windows sockets
+case x$with_socklib in
+  xwinsock2)
+    ;;
+  *)
+    AC_HEADER_SYS_WAIT  #  <sys/wait.h>
+esac
 
 # allow for quick module/library/etc processing checks
 if test "x$NETSNMP_QUICK_CHECK" = "x" ; then
@@ -23,13 +29,12 @@ if test "x$NETSNMP_QUICK_CHECK" = "x" ;
 AC_CHECK_HEADERS([getopt.h   pthread.h  regex.h      ] dnl
                  [string.h   syslog.h   unistd.h     ] dnl
                  [stdint.h   inttypes.h              ] dnl
+                 [process.h          ] dnl
                  [sys/param.h        ] dnl
                  [sys/select.h       ] dnl
-                 [sys/socket.h       ] dnl
                  [sys/syslog.h       ] dnl
                  [sys/time.h         ] dnl
-                 [sys/timeb.h        ] dnl
-                 [sys/un.h           ])
+                 [sys/timeb.h        ])
 
 #  Library and Agent:
 AC_CHECK_HEADERS([nlist.h],,,[
@@ -41,8 +46,10 @@ AC_INCLUDES_DEFAULT
 ]])
 
 #  Library:
-AC_CHECK_HEADERS([fcntl.h    io.h       kstat.h                 ] dnl
+AC_CHECK_HEADERS([crt_externs.h                        ] dnl
+                 [fcntl.h    io.h       kstat.h        ] dnl
                  [limits.h   locale.h                  ] dnl
+                 [mach-o/dyld.h                        ] dnl
                  [sys/file.h       sys/ioctl.h         ] dnl
                  [sys/sockio.h     sys/stat.h          ] dnl
                  [sys/systemcfg.h  sys/systeminfo.h    ] dnl
@@ -55,7 +62,7 @@ AC_CHECK_HEADERS([dlfcn.h    err.h
                  [           grp.h      io.h                    ] dnl
                  [ioctls.h   kstat.h    kvm.h      limits.h     ] dnl
                  [           mntent.h   mtab.h                  ] dnl
-                 [           pkglocs.h             pwd.h        ] dnl
+                 [pkglocs.h  pwd.h      spawn.h                 ] dnl
                  [           com_err.h             et/com_err.h ] dnl
                  [           utmpx.h    utsname.h               ])
 
@@ -73,7 +80,6 @@ AC_CHECK_HEADERS([asm/page.h asm/types.h
                  [inet/mib2.h                          ] dnl
                  [linux/hdreg.h linux/tasks.h          ] dnl
                  [machine/param.h                      ] dnl
-                 [netinet/tcp_fsm.h                    ] dnl
                  [ufs/fs.h                             ] dnl
                  [uvm/uvm_extern.h uvm/uvm_param.h     ] dnl
                  [vm/vm.h vm/vm_extern.h vm/vm_param.h ])
@@ -81,7 +87,6 @@ AC_CHECK_HEADERS([asm/page.h asm/types.h
 #  Apps:
 AC_CHECK_HEADERS([fcntl.h    grp.h      pwd.h      ] dnl
                  [sys/cdefs.h   sys/ioctl.h        ] dnl
-                 [sys/socket.h  sys/sockio.h       ] dnl
                  [sys/time.h                       ])
 
 #  Not-Used:
@@ -125,34 +130,11 @@ AC_CHECK_HEADERS(sys/swap.h,,,
 
 #       requiring <sys/param.h>                         (FreeBSD)
 #
-#  Core:      (? Tested above? )
-AC_CHECK_HEADERS([stdlib.h  ],,,
-    [[
-#if HAVE_SYS_TYPES_H
-#include <sys/types.h>
-#endif
-#if HAVE_SYS_PARAM_H
-#include <sys/param.h>
-#endif
-    ]])
-#
-#  Library:
-AC_CHECK_HEADERS([malloc.h        net/if_dl.h   sys/sysctl.h    ],,,
-    [[
-#if HAVE_SYS_TYPES_H
-#include <sys/types.h>
-#endif
-#if HAVE_SYS_PARAM_H
-#include <sys/param.h>
-#endif
-    ]])
-#
-#  Agent:
 AC_CHECK_HEADERS([malloc.h        osreldate.h                   ] dnl
-                 [machine/types.h net/if_dl.h   net/if_types.h  ] dnl
+                 [machine/types.h ] dnl
                  [sys/dkstat.h    sys/conf.h    sys/mbuf.h      ] dnl
                  [sys/mount.h     sys/proc.h    sys/queue.h     ] dnl
-                 [sys/sysctl.h    sys/user.h                    ],,,
+                 [sys/user.h                                    ],,,
     [[
 #if HAVE_SYS_TYPES_H
 #include <sys/types.h>
@@ -162,6 +144,17 @@ AC_CHECK_HEADERS([malloc.h        osreld
 #endif
     ]])
 
+case "$target_os" in
+    linux*)
+	# <sys/sysctl.h> is considered deprecated on Linux and including that
+	# header file triggers a compiler warning. See also
+	# https://savannah.gnu.org/forum/forum.php?forum_id=9515.
+        ;;
+    *)
+	AC_CHECK_HEADERS([sys/sysctl.h])
+        ;;
+esac
+
 #       requiring <sys/sema.h>                          (IRIX 6.5)
 #  Agent:
 #
@@ -174,17 +167,6 @@ AC_CHECK_HEADERS(sys/hashing.h,,,
 #endif
     ])
 
-#       requiring <sys/socket.h>                        (Solaris 9)
-#  Agent:
-#
-AC_CHECK_HEADERS(sys/socketvar.h,,,
-    AC_INCLUDES_DEFAULT([])
-    [
-#if HAVE_SYS_SOCKET_H
-#include <sys/socket.h>
-#endif
-    ])
-
 #       requiring _KMEMUSER and <sys/types.h>           (BSDi3/IRIX)
 #  Agent:
 #
@@ -257,65 +239,57 @@ AC_CHECK_HEADERS([linux/netlink.h  linux
 #endif
     ]])
 
-
-#       Network headers
-#  Core or Library/Agent/Apps:
-#
-AC_CHECK_HEADERS([arpa/inet.h        net/if.h             ] dnl
-                 [netinet/in.h       netdb.h              ],,,
-    [[
-#if HAVE_SYS_TYPES_H
-#include <sys/types.h>
-#endif
-#if HAVE_SYS_TIMEOUT_H
-#include <sys/timeout.h>
-#endif
-#if HAVE_SYS_SOCKET_H
-#include <sys/socket.h>
-#endif
-#if HAVE_SYS_SOCKETVAR_H
-#include <sys/socketvar.h>
-#endif
-#if HAVE_ARPA_INET_H
-#include <arpa/inet.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-#include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-#include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IP_H
-#include <netinet/ip.h>
-#endif
-#if HAVE_NET_IF_H
-#include <net/if.h>
-#endif
-#if HAVE_NETINET_IP_VAR_H
-#include <netinet/ip_var.h>
-#endif
-#if HAVE_NETINET_IP_ICMP_H
-#include <netinet/ip_icmp.h>
-#endif
-#if HAVE_NETINET_TCP_H
-#include <netinet/tcp.h>
-#endif
-#if HAVE_NETINET_UDP_H
-#include <netinet/udp.h>
-#endif
-#if HAVE_NETINET_TCP_TIMER_H
-#include <netinet/tcp_timer.h>
-#endif
-    ]])
 #
-#  Agent:
-AC_CHECK_HEADERS([net/if_arp.h       net/if_mib.h         net/if_var.h     ] dnl
-                 [netinet/if_ether.h netinet/in_systm.h   netinet/in_var.h ] dnl
-                 [netinet/ip.h       netinet/ip_icmp.h                     ] dnl
-                 [netinet/icmp_var.h netinet/ip_var.h                      ] dnl
-                 [netinet/tcp.h      netinet/tcp_timer.h  netinet/tcp_var.h] dnl
-                 [netinet/tcpip.h    netinet/udp.h        netinet/udp_var.h] dnl
-                 [net/route.h        netinet/icmp6.h                       ],,,
+# Avoid that on MinGW any networking headers get included that are
+# incompatible with <winsock2.h> by only testing for certain headers if not
+# building for one of these two platforms.
+#
+
+case x$with_socklib in
+  xwinsock2)
+    ;;
+  *)
+
+AC_CHECK_HEADERS([sys/socket.h]dnl
+                 [sys/un.h]dnl
+                 [netinet/tcp_fsm.h]dnl
+                 [sys/sockio.h]dnl
+                 [sys/socketvar.h]dnl
+                 [net/if_dl.h]dnl
+                 [net/if_types.h]dnl
+                 [arpa/inet.h]dnl
+                 [net/if.h]dnl
+                 [netinet/in.h]dnl
+                 [netdb.h]dnl
+                 [net/if_arp.h]dnl
+                 [net/if_mib.h]dnl
+                 [net/if_var.h]dnl
+                 [netinet/if_ether.h]dnl
+                 [netinet/in_systm.h]dnl
+                 [netinet/in_var.h]dnl
+                 [netinet/ip.h]dnl
+                 [netinet/ip_icmp.h]dnl
+                 [netinet/icmp_var.h]dnl
+                 [netinet/ip_var.h]dnl
+                 [netinet/tcp.h]dnl
+                 [netinet/tcp_timer.h]dnl
+                 [netinet/tcp_var.h]dnl
+                 [netinet/tcpip.h]dnl
+                 [netinet/udp.h]dnl
+                 [netinet/udp_var.h]dnl
+                 [net/route.h]dnl
+                 [netinet/icmp6.h]dnl
+                 [netinet/in_pcb.h]dnl
+                 [netinet/ip6.h]dnl
+                 [netinet6/in6_var.h]dnl
+                 [netinet6/in6_pcb.h]dnl
+                 [netinet6/ip6_var.h]dnl
+                 [netinet6/nd6.h]dnl
+                 [netinet6/tcp6.h]dnl
+                 [netinet6/tcp6_fsm.h]dnl
+                 [netinet6/tcp6_timer.h]dnl
+                 [netinet6/tcp6_var.h]dnl
+                 ,,,
     [[
 #if HAVE_SYS_PARAM_H
 #include <sys/param.h>
@@ -344,6 +318,9 @@ AC_CHECK_HEADERS([net/if_arp.h       net
 #if HAVE_NETINET_IP_H
 #include <netinet/ip.h>
 #endif
+#if HAVE_NETINET_IP_H
+#include <netinet/ip_icmp.h>
+#endif
 #if HAVE_NET_IF_H
 #include <net/if.h>
 #endif
@@ -365,87 +342,16 @@ AC_CHECK_HEADERS([net/if_arp.h       net
 #if HAVE_NETINET_TCP_TIMER_H
 #include <netinet/tcp_timer.h>
 #endif
-#if HAVE_NETINET_ICMP6_H
-#include <netinet/icmp6.h>
-#endif
-    ]])
-
-#       KAME (IPv6) headers
-#  Agent:
-#
-# KAME
-AC_CHECK_HEADERS([netinet/ip6.h                               ] dnl
-                 [netinet6/in6_var.h    netinet6/in6_pcb.h    ] dnl
-                 [netinet6/ip6_var.h    netinet6/nd6.h        ] dnl
-                 [netinet6/tcp6.h       netinet6/tcp6_fsm.h   ] dnl
-                 [netinet6/tcp6_timer.h netinet6/tcp6_var.h],,,
-    [[
-#if HAVE_SYS_PARAM_H
-#include <sys/param.h>
-#endif
-#if HAVE_SYS_TYPES_H
-#include <sys/types.h>
-#endif
-#if HAVE_SYS_QUEUE_H
-#include <sys/queue.h>
-#endif
-#if HAVE_SYS_SOCKET_H
-#include <sys/socket.h>
-#endif
-#if HAVE_NET_IF_H
-#include <net/if.h>
-#endif
-#if HAVE_NET_IF_VAR_H
-#include <net/if_var.h>
-#endif
-#if HAVE_NET_ROUTE_H
-#include <net/route.h>
-#endif
-#if HAVE_NETINET_IN_H
-#include <netinet/in.h>
-#endif
 #if HAVE_NETINET_IP6_H
 #include <netinet/ip6.h>
 #endif
-    ]])
-
-#       requiring <netinet/in.h>                        (OpenBSD 2.6)
-#  Agent:
-#
-AC_CHECK_HEADERS(netinet/in_pcb.h,,,
-    [[
-#if HAVE_SYS_PARAM_H
-#include <sys/param.h>
-#endif
-#if HAVE_SYS_TYPES_H
-#include <sys/types.h>
-#endif
-#if HAVE_SYS_TIMEOUT_H
-#include <sys/timeout.h>
-#endif
-#if HAVE_SYS_SOCKET_H
-#include <sys/socket.h>
-#endif
-#if HAVE_SYS_SOCKETVAR_H
-#include <sys/socketvar.h>
-#endif
-#if HAVE_NETINET_IN_H
-#include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-#include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IP_H
-#include <netinet/ip.h>
-#endif
-#if HAVE_NET_ROUTE_H
-#include <net/route.h>
-#endif
-#if HAVE_ARPA_INET_H
-#include <arpa/inet.h>
+#if HAVE_NETINET_ICMP6_H
+#include <netinet/icmp6.h>
 #endif
     ]])
 
+esac
+
 ##
 #   Pre-requisite on specific types
 ##
@@ -538,11 +444,17 @@ AC_CHECK_HEADERS([windows.h iphlpapi.h],
 #endif
 ])
 
+AC_CHECK_HEADERS([lm.h], [LAGENTLIBS="$LAGENTLIBS -lnetapi32"], [], [
+#ifdef HAVE_WINDOWS_H
+#include <windows.h>
+#endif
+])
+
 #       for MIB-2 info                                  (MinGW)
 #  Core:
 #
 if test x$with_socklib = xwinsock2; then
-  AC_CHECK_HEADERS([winsock.h winsock2.h ws2tcpip.h])
+  AC_CHECK_HEADERS([winsock.h winsock2.h ws2tcpip.h],,,[#include <windows.h>])
 fi
 
 #
diff -urpN net-snmp-5.8/configure.d/config_os_libs1 net-snmp-5.9.1/configure.d/config_os_libs1
--- net-snmp-5.8/configure.d/config_os_libs1	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.d/config_os_libs1	2021-05-26 05:19:35.000000000 +0700
@@ -68,7 +68,7 @@ AC_CHECK_FUNCS(kinfo_get_cpus)
 #
 # diskIOLAx requires exp which may require -lm
 #
-AC_SEARCH_LIBS(exp, [m])
+NETSNMP_SEARCH_LIBS([exp], [m],,,, [LMIBLIBS])
 
 #
 #   libkvm
@@ -97,15 +97,14 @@ LIBS="$netsnmp_save_LIBS"
 #
 #   regex in process table
 #
-AC_CHECK_HEADER([pcre.h], 
-  [
-    AC_DEFINE([HAVE_PCRE_H], [1], [Define to 1 if you have <pcre.h>.])
-    pcre_h=yes
-  ],
-  [
-    pcre_h=no
-  ]
-)
+if test "x$with_pcre" != "xno"; then
+  AC_CHECK_HEADER([pcre.h], [
+      AC_DEFINE([HAVE_PCRE_H], [1], [Define to 1 if you have <pcre.h>.])
+      pcre_h=yes
+    ],
+    [pcre_h=no]
+  )
+fi
 if test "x$pcreheader_h" = "xno" -o "x$pcre_h" = "xno" ; then
   if test "x$with_pcre" = "xyes" ; then
     AC_MSG_ERROR([Could not find the pcre header file needed and was specifically asked to use pcre support])
@@ -117,11 +116,8 @@ fi
 #
 # pcre libraries only needed for the ucd process agent mib software
 #
-if test "x$with_pcre" != "xno"; then
-  _pcrelibs=""
-  NETSNMP_SEARCH_LIBS([pcre_exec], [pcre],,,, _pcrelibs)
-  if test "x$_pcrelibs" != "x"; then
-    LAGENTLIBS="$LAGENTLIBS $_pcrelibs"
-    LMIBLIBS="$LMIBLIBS $_pcrelibs"
-  fi
-fi
+NETSNMP_SEARCH_LIBS([pcre_exec], [pcre], [
+  LMIBLIBS="$LMIBLIBS -lpcre"
+  ],,, LAGENTLIBS)
+AC_SUBST(LAGENTLIBS)
+AC_SUBST(LMIBLIBS)
diff -urpN net-snmp-5.8/configure.d/config_os_libs2 net-snmp-5.9.1/configure.d/config_os_libs2
--- net-snmp-5.8/configure.d/config_os_libs2	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.d/config_os_libs2	2021-05-26 05:19:35.000000000 +0700
@@ -16,27 +16,6 @@
 #   Simple checks:
 ##
 
-# AC_CHECK_LIB(des, main)
-# AC_CHECK_LIB(m,   asin)
-
-#   dmalloc
-#
-if test "${with_dmalloc+set}" = set; then
-   if test "$with_dmalloc" = yes -a -d $with_dmalloc ; then
-       AC_ADD_SEARCH_PATH($with_dmalloc)
-   fi
-   AC_CHECK_HEADERS([dmalloc.h])
-   AC_SEARCH_LIBS([dmalloc_message], [dmalloc])
-fi
-
-#   EFence
-#       (This used to be on by default for developer checkout)
-#
-if test "x$use_efence" = "xyes"; then
-    AC_SEARCH_LIBS([EF_Exit], [efence])
-fi
-
-
 #   ELF libraries
 #       Typically used for 'nlist'  (needed for uptime)
 #
@@ -114,6 +93,20 @@ AC_LINK_IFELSE([AC_LANG_PROGRAM([
   esac
 ])
 
+AC_MSG_CHECKING([for MIB_IF_TABLE2])
+AC_LINK_IFELSE([AC_LANG_PROGRAM([
+  #define _WIN32_WINNT 0xffff
+  #include <winsock2.h>
+  #include <ws2tcpip.h>
+  #include <iphlpapi.h>
+],[
+  return sizeof(MIB_IF_TABLE2)
+])],[
+  AC_MSG_RESULT([yes])
+  AC_DEFINE([HAVE_MIB_IF_TABLE2], 1,
+    [Define if MIB_IF_TABLE2 is available])],
+  [AC_MSG_RESULT([no])])
+
 
 #   libregex                                            (MinGW)
 #
@@ -258,7 +251,7 @@ if test "x$with_nl" != "xno"; then
         NETSNMP_SEARCH_LIBS(nl_connect, nl-3,
             [AC_CHECK_HEADERS(netlink/netlink.h)
             EXTERNAL_MIBGROUP_INCLUDES="$EXTERNAL_MIBGROUP_INCLUDES ${LIBNL3_CFLAGS}"],
-            [CPPFLAGS="$netsnmp_save_CPPFLAGS"], [], [], [LMIBLIBS])
+            [CPPFLAGS="$netsnmp_save_CPPFLAGS"], [], [LMIBLIBS])
         if test "x$ac_cv_header_netlink_netlink_h" != xyes; then
             NETSNMP_SEARCH_LIBS(nl_connect, nl, [
                 AC_CHECK_HEADERS(netlink/netlink.h)], [], [], LMIBLIBS)
@@ -347,7 +340,8 @@ if test "x$tryopenssl" != "xno" -a "x$tr
         netsnmp_save_LIBS="$LIBS"
         LIBS="-lssl"
         AC_CHECK_FUNCS([TLS_method TLSv1_method DTLS_method DTLSv1_method]dnl
-                       [SSL_library_init SSL_load_error_strings])
+                       [SSL_library_init SSL_load_error_strings]dnl
+		       [ERR_get_error_all])
         LIBS="$netsnmp_save_LIBS"
         if echo " $transport_result_list " | $GREP "DTLS" > /dev/null; then
 	    if test x$ac_cv_func_DTLSv1_method = xyes -o \
@@ -385,16 +379,6 @@ elif test "x$askedpkcs" = "xyes"; then
         AC_DEFINE(HAVE_LIBPKCS11)
         LIBPKCS11="-lpkcs11")
 fi
-if test "x$TLSPROG" = "xyes"; then
-   AC_CHECK_DECL([EVP_sha224],
-    AC_DEFINE([HAVE_EVP_SHA224], [], [Define if you have EVP_sha224/256 in openssl]),
-    : ,
-    [[#include <openssl/evp.h>]])
-   AC_CHECK_DECL([EVP_sha384],
-    AC_DEFINE([HAVE_EVP_SHA384], [], [Define if you have EVP_sha384/512 in openssl]),
-    : ,
-    [[#include <openssl/evp.h>]])
-fi
 
 LIBS=$NONAGENTLIBS	 # restore old libraries
 if test "x$SSHPROG" = "xyes"; then
@@ -510,7 +494,7 @@ if test "$with_libwrap" != "no"; then
 	_wraplibs="$_wraplibs -lwrap -lnsl"],
        [AC_MSG_RESULT(no)
 	AC_MSG_ERROR(Asked to use libwrap but I couldn't find it.)])])
-  LAGENTLIBS="$_wraplibs"
+  LAGENTLIBS="$LAGENTLIBS $_wraplibs"
   CPPFLAGS=${_cppflags}
   LDFLAGS=${_ldflags}
   LIBS=${_libs}
@@ -532,7 +516,7 @@ if test "x$with_mysql" = "xyes" ; then
   CPPFLAGS="${CPPFLAGS} ${MYSQL_INCLUDES}"
   AC_CHECK_HEADER(mysql.h,,
      [AC_MSG_ERROR([Could not find mysql.h and was specifically asked to use MySQL support])])
-  AC_CHECK_HEADER([my_global.h my_sys.h])
+  AC_CHECK_HEADERS([my_global.h my_sys.h])
   AC_MSG_CHECKING([whether MY_INIT() works])
   AC_LINK_IFELSE([
     AC_LANG_PROGRAM(
@@ -563,14 +547,7 @@ if test "x$with_mysql" = "xyes" ; then
        AC_DEFINE([HAVE_MY_LOAD_DEFAULTS], 1,
                  [Define if having my_load_defaults()])],
       [AC_MSG_RESULT(no)])
-  AC_CHECK_FUNC(
-    [mysql_init],
-    AC_DEFINE([HAVE_MYSQL_INIT], 1,
-              [Define if mysql_init() is available in libmysqlclient]))
-  AC_CHECK_FUNC(
-    [load_defaults],
-    AC_DEFINE([HAVE_LOAD_DEFAULTS], 1,
-              [Define if load_defaults() is available in libmysqlclient]))
+  AC_CHECK_FUNCS([load_defaults mysql_init mysql_options])
   CPPFLAGS="${_cppflags}"
   LIBS="${_libs}"
   AC_MSG_CACHE_ADD(MYSQL Trap Logging:         enabled)
@@ -601,29 +578,15 @@ AC_SUBST(NETSNMP_BUILD_PCAP_PROG_FALSE)
 # nlist
 AC_CHECK_FUNCS(nlist nlist64 knlist)
 
-AC_CHECK_HEADERS([curses.h])
-AC_CHECK_HEADERS([ncurses/curses.h])
-NETSNMP_SEARCH_LIBS([endwin], [curses ncurses],,,,[LIBCURSES])
+NETSNMP_SEARCH_LIBS([endwin], [curses ncurses], [
+  AC_CHECK_HEADERS([curses.h])
+  AC_CHECK_HEADERS([ncurses/curses.h])
+  HAVE_LIBCURSES=TRUE],
+  [HAVE_LIBCURSES=FALSE],,
+  [LIBCURSES])
+AC_SUBST([HAVE_LIBCURSES])
 AC_SUBST([LIBCURSES])
 
 #   libm for ceil
 #
-AC_MSG_CHECKING([for ceil without -lm])
-AC_LINK_IFELSE([AC_LANG_PROGRAM([
-  #include <math.h>
-], [
-  ceil((double)2.4);
-])], [
-  AC_MSG_RESULT(yes);
-  # Keep LIBS.
-  need_ceil_lib="no"
-  true
-], [
-  AC_MSG_RESULT(no)
-  need_ceil_lib="yes"
-  # Restore LIBS.
-])
-
-if test "${need_ceil_lib}" = yes; then
-  AC_SEARCH_LIBS([ceil], [m])
-fi
+NETSNMP_SEARCH_LIBS(ceil, m,,,, LNETSNMPLIBS)
diff -urpN net-snmp-5.8/configure.d/config_os_misc2 net-snmp-5.9.1/configure.d/config_os_misc2
--- net-snmp-5.8/configure.d/config_os_misc2	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.d/config_os_misc2	2021-05-26 05:19:35.000000000 +0700
@@ -53,7 +53,13 @@ if test "x$CRYPTO" = "xinternal" ; then
     AC_DEFINE(NETSNMP_USE_INTERNAL_CRYPTO, 1, "Define if internal cryptography code should be used")
     AC_MSG_RESULT(Internal Crypto Support)
 elif test "x$useopenssl" != "xno" ; then
-    authmodes="MD5 SHA1 SHA512 SHA384 SHA256 SHA192"
+    authmodes="MD5 SHA1"
+    if test "x$ac_cv_func_EVP_sha224" = xyes; then
+        authmodes="$authmodes SHA224 SHA256"
+    fi
+    if test "x$ac_cv_func_EVP_sha384" = xyes; then
+        authmodes="$authmodes SHA384 SHA512"
+    fi
     if test "x$enable_privacy" != "xno" ; then
         if test "x$ac_cv_header_openssl_aes_h" = "xyes" ; then
             encrmodes="DES AES"
@@ -86,6 +92,13 @@ fi
 if test "x$enable_md5" = "xno"; then
     authmodes=`echo $authmodes | $SED 's/MD5 *//;'`
 fi
+if test "x$ac_cv_func_AES_cfb128_encrypt" = xyes ||
+   test "x$CRYPTO" = xinternal; then
+    encrmodes="$encrmodes AES128"
+    if test "x$aes_capable" = "xyes"; then
+        encrmodes="$encrmodes AES192 AES192C AES256 AES256C"
+    fi
+fi
 AC_SUBST(LNETSNMPLIBS)
 AC_SUBST(LAGENTLIBS)
 
diff -urpN net-snmp-5.8/configure.d/config_os_misc3 net-snmp-5.9.1/configure.d/config_os_misc3
--- net-snmp-5.8/configure.d/config_os_misc3	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.d/config_os_misc3	2021-05-26 05:19:35.000000000 +0700
@@ -9,12 +9,3 @@
 #   Compilation characteristics
 ##
 
-#       Byte order
-#
-if test "$with_endianness" = "big"; then
-    ac_cv_c_bigendian=yes
-elif test "$with_endianness" = "little" ; then
-    ac_cv_c_bigendian=no
-fi
-AC_C_BIGENDIAN(,,
-    [AC_MSG_ERROR([Failed to figure out host endianness, please use --with-endianness to specify it.])])
diff -urpN net-snmp-5.8/configure.d/config_os_misc4 net-snmp-5.9.1/configure.d/config_os_misc4
--- net-snmp-5.8/configure.d/config_os_misc4	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.d/config_os_misc4	2021-05-26 05:19:35.000000000 +0700
@@ -49,23 +49,6 @@ AC_CACHE_CHECK([for location of system k
 AC_DEFINE_UNQUOTED(KERNEL_LOC,"$ac_cv_KERNEL_LOC", [location of UNIX kernel])
 
 
-#       /dev/kmem existence
-#	    used in agent only
-#
-AC_CACHE_CHECK([for /dev/kmem],
-    ac_cv_HAVE_KMEM,
-   [if test $CDEV_TEST_FLAG /dev/kmem; then
-        ac_cv_HAVE_KMEM="/dev/kmem"
-    fi
-])
-#
-#  Note that it's OK if this device is not found
-#
-if test "x$ac_cv_HAVE_KMEM" = "x/dev/kmem"; then
-    AC_DEFINE_UNQUOTED(HAVE_KMEM,"$ac_cv_HAVE_KMEM", [Define if you have /dev/kmem])
-fi
-
-
 #       Swap device Location
 #           (/dev/dmem or /dev/drum)
 #	    used in agent only
@@ -203,7 +186,8 @@ else
 # include <sys/sysctl.h>
 #endif
 
-main() {
+int main(int argc, char **argv)
+{
   int                 mib[2];
   size_t              len;
   struct timeval boottime;
@@ -212,11 +196,7 @@ main() {
   mib[1] = KERN_BOOTTIME;
   
   len = sizeof(boottime);
-  sysctl(mib, 2, &boottime, &len, NULL, NULL);
-  if (boottime.tv_sec != 0)
-    exit(0);
-  else
-    exit(1);
+  return 1 - (sysctl(mib, 2, &boottime, &len, NULL, 0) == 0 && boottime.tv_sec);
 }
         ],
         ac_cv_NETSNMP_CAN_USE_SYSCTL=yes,
@@ -318,6 +298,30 @@ And this can be very slow.])
     ;;
 esac
 
+#   Check whether SO_BINDTODEVICE is available.
+#
+
+AC_MSG_CHECKING([for SO_BINDTODEVICE])
+AC_LINK_IFELSE([AC_LANG_PROGRAM([
+#include <sys/types.h>
+#include <sys/socket.h>
+], [
+return SO_BINDTODEVICE
+])],
+[AC_DEFINE([HAVE_SO_BINDTODEVICE], [1],
+  [Define to 1 if SO_BINDTODEVICE is available])
+ AC_MSG_RESULT([yes])],
+[AC_MSG_RESULT([no])])
+
+#   Check whether struct in_pktinfo.ipi_spec_dst is available.
+#
+
+AC_CHECK_MEMBERS([struct in_pktinfo.ipi_spec_dst], [], [], [
+#include <sys/types.h>
+#include <sys/socket.h>
+#include <netinet/in.h>
+])
+
 #   Check whether IP_PKTINFO is usable.
 #
 
@@ -330,6 +334,7 @@ AC_CACHE_CHECK([for IP_PKTINFO ],
 #include <sys/types.h>
 #include <sys/socket.h>
 #include <netinet/in.h>
+#include <arpa/inet.h> /* inet_ntoa() */
 ], [
     void *buf;
     int len;
@@ -379,6 +384,7 @@ AC_CACHE_CHECK([for IP_RECVDSTADDR ],
 #include <sys/types.h>
 #include <sys/socket.h>
 #include <netinet/in.h>
+#include <arpa/inet.h> /* inet_ntoa() */
 ], [
     void *buf;
     int len;
diff -urpN net-snmp-5.8/configure.d/config_os_progs net-snmp-5.9.1/configure.d/config_os_progs
--- net-snmp-5.8/configure.d/config_os_progs	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.d/config_os_progs	2021-05-26 05:19:35.000000000 +0700
@@ -57,7 +57,7 @@ AC_PATH_PROG(AUTOCONF,    autoconf,   [:
 AC_PATH_PROG(AUTOHEADER,  autoheader, [:])
 AC_PATH_PROG([PERLPROG],  perl)
 AC_PATH_PROG([PSPROG],    ps)
-AC_PATH_PROG([PYTHONPROG],python)
+AC_PATH_PROG([PYTHONPROG],python3)
 
 AC_PATH_PROG([UNAMEPROG], uname)
 AC_DEFINE_UNQUOTED(UNAMEPROG,"$UNAMEPROG", [Where is the uname command])
@@ -102,6 +102,7 @@ AC_C_INLINE
 #
 LT_PREREQ([2.2.6])
 LT_INIT([win32-dll])
+LT_LANG([Windows Resource])
 AC_SUBST(LIBTOOL_DEPS)
 
 
@@ -115,16 +116,15 @@ AC_SUBST(LIBTOOL_DEPS)
 if test "x$developer" != "xno" -a -f $srcdir/remove-files; then
     developer="yes"
 fi
-AC_MSG_CHECKING([for developer gcc flags])
 if test "x$developer" = "xyes" -a "x$GCC" = "xyes"; then
-
+    AC_MSG_CHECKING([for developer gcc flags])
     #       WWWXXX - strict type checking
     #
     netsnmp_save_CFLAGS="$CFLAGS"
     for opt in -Wall -Wextra -Wstrict-prototypes -Wwrite-strings -Wcast-qual \
         -Wimplicit-fallthrough=2 -Wlogical-op                                \
         -Wno-format-truncation -Wno-missing-field-initializers               \
-        -Wno-sign-compare -Wno-unused-parameter -Wno-type-limits
+        -Wno-sign-compare -Wno-unused-parameter
     do
       AC_MSG_CHECKING([whether the compiler supports $opt])
       if test x$opt != x-Wstrict-prototypes; then
@@ -140,11 +140,10 @@ if test "x$developer" = "xyes" -a "x$GCC
       ])
       CFLAGS="$netsnmp_save_CFLAGS"
     done
-
+    AC_MSG_RESULT($DEVFLAGS)
 else
     DEVFLAGS=""
 fi
-AC_MSG_RESULT($DEVFLAGS)
 AC_SUBST(DEVFLAGS)
 
 
@@ -201,31 +200,36 @@ AC_MSG_CACHE_ADD(Building for:
 
 # Avoid conflicts on Cygwin between <windows.h> and the openssl header files.
 case x$target_os in
-     xcygwin*)
+     xcygwin*|xmingw32*)
         CPPFLAGS="-DVC_EXTRALEAN -DWIN32_LEAN_AND_MEAN $CPPFLAGS";;
 esac
 
+
 #
-#    Whether or not Cygwin's ld recognizes the flag -no-undefined. 
+#    Whether the linker supports the flag -Wl,-no-undefined. Do not use
+#    -Wl,-no-undefined on OpenBSD because it breaks linking of shared
+#    libraries. Use -Wl,-no-undefined on all other platforms such that
+#    undefined symbols are detected at compile time instead of at runtime.
 #
 
 case x$target_os in
-xcygwin*)
-  saved_LDFLAGS=$LDFLAGS
-
-  AC_MSG_CHECKING([whether the linker supports -no-undefined])
-  LDFLAGS="$saved_LDFLAGS -Wl,-no-undefined"
-  AC_LINK_IFELSE([AC_LANG_PROGRAM([],[])],
-                 [AC_MSG_RESULT([yes]); dnl
-                  LD_NO_UNDEFINED=-no-undefined],
-                 [AC_MSG_RESULT([no])])
-  
-  LDFLAGS="$saved_LDFLAGS"
-  ;;
+  xopenbsd*)
+    ;;
+  *)
+    if ! echo "$CFLAGS" | grep -q -- -fsanitize=; then
+      saved_LDFLAGS=$LDFLAGS
+      AC_MSG_CHECKING([whether the linker supports -Wl,-no-undefined])
+      LDFLAGS="$saved_LDFLAGS -Wl,-no-undefined"
+      AC_LINK_IFELSE([AC_LANG_PROGRAM([],[])],
+		     [AC_MSG_RESULT([yes]); dnl
+		      LD_NO_UNDEFINED=-Wl,-no-undefined],
+		     [AC_MSG_RESULT([no])])
+      LDFLAGS="$saved_LDFLAGS"
+      AC_SUBST(LD_NO_UNDEFINED)
+    fi
+    ;;
 esac
 
-AC_SUBST(LD_NO_UNDEFINED)
-
 
 #
 #   Socket library: either 'default' (non-MinGW) or 'winsock2' (MinGW).
@@ -233,9 +237,7 @@ AC_SUBST(LD_NO_UNDEFINED)
 case x$target_os in
   xmingw*)
     with_socklib=winsock2
-    if test "x$enable_ipv6" = "xyes"; then
-      CFLAGS="-D_WIN32_WINNT=0x0501 $CFLAGS"
-    fi
+    CPPFLAGS="-D_WIN32_WINNT=0xffff -DWIN32 $CPPFLAGS"
     ;;
   *)
     with_socklib=default;;
diff -urpN net-snmp-5.8/configure.d/config_os_struct_members net-snmp-5.9.1/configure.d/config_os_struct_members
--- net-snmp-5.8/configure.d/config_os_struct_members	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.d/config_os_struct_members	2021-05-26 05:19:35.000000000 +0700
@@ -306,7 +306,7 @@ AC_CHECK_MEMBERS([struct tcpstat.tcp_rcv
 #       struct tm
 #   Library:
 #
-AC_CHECK_MEMBERS([struct tm.tm_gmtoff, struct time.tm_isdst],,,[
+AC_CHECK_MEMBERS([struct tm.tm_gmtoff, struct tm.tm_isdst],,,[
     AC_INCLUDES_DEFAULT()
     [
 #if TIME_WITH_SYS_TIME
@@ -321,9 +321,7 @@ AC_CHECK_MEMBERS([struct tm.tm_gmtoff, s
 #endif
     ]])
 
-#       extern timezone
-AC_MSG_CHECKING([extern timezone])
-AC_LINK_IFELSE([AC_LANG_PROGRAM([[
+AC_CHECK_DECLS([daylight,timezone],,,[
 #if TIME_WITH_SYS_TIME
 # include <sys/time.h>
 # include <time.h>
@@ -334,15 +332,28 @@ AC_LINK_IFELSE([AC_LANG_PROGRAM([[
 #  include <time.h>
 # endif
 #endif
-]], [[
-  return timezone;
-]])], [
-AC_MSG_RESULT([yes])
-AC_DEFINE([HAVE_TIMEZONE_VARIABLE], [1], [Define if a timezone variable is declared in <sys/time.h>])
-], [
-AC_MSG_RESULT([no])
 ])
 
+AC_MSG_CHECKING([whether timezone is a scalar])
+AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
+#if TIME_WITH_SYS_TIME
+# include <sys/time.h>
+# include <time.h>
+#else
+# if HAVE_SYS_TIME_H
+#  include <sys/time.h>
+# else
+#  include <time.h>
+# endif
+#endif
+]], [[
+int a[2];
+return &a[timezone] != NULL;
+]])], [AC_MSG_RESULT([yes])
+	 AC_DEFINE([HAVE_SCALAR_TIMEZONE], [1],
+            [Define if timezone declared as a scalar in <time.h>])],
+    [AC_MSG_RESULT([no])])
+
 #       struct timezone
 #   Library:
 #
diff -urpN net-snmp-5.8/configure.d/config_project_ipv6_types net-snmp-5.9.1/configure.d/config_project_ipv6_types
--- net-snmp-5.8/configure.d/config_project_ipv6_types	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.d/config_project_ipv6_types	2021-05-26 05:19:35.000000000 +0700
@@ -45,6 +45,15 @@ AC_CHECK_TYPES([mib2_ipIfStatsEntry_t],,
 #         the later 'config_types' sub-script
 #
 
+#  Darwin: check whether or not struct in_ifaddr is available.
+#
+#
+AC_CHECK_MEMBERS([struct in_ifaddr.ia_subnetmask],,,[
+#ifdef HAVE_NETINET_IN_VAR_H
+#include <netinet/in_var.h>
+#endif
+])
+
 
 ##
 #   Determine the IPv6 stack type
@@ -55,20 +64,19 @@ AC_CHECK_TYPES([mib2_ipIfStatsEntry_t],,
 #
 
 if test "x$enable_ipv6" = "xyes"; then
-	v6type=unknown
 	v6lib=none
 	v6trylibc=no
 
 	AC_MSG_CHECKING([[ipv6 stack type]])
-	for i in v6d toshiba kame inria zeta linux-glibc linux-inet6 cygwin winsock2 generic; do
-		case $i in
+	for v6type in v6d toshiba kame zeta generic; do
+		case $v6type in
 		v6d)
 			AC_EGREP_CPP(yes, [
 #include </usr/local/v6/include/sys/types.h>
 #ifdef __V6D__
 yes
 #endif],
-				[v6type=$i; v6lib=v6;
+				[v6lib=v6;
 				v6libdir=/usr/local/v6/lib;
 				CFLAGS="-I/usr/local/v6/include $CFLAGS"])
 			;;
@@ -78,7 +86,7 @@ yes
 #ifdef _TOSHIBA_INET6
 yes
 #endif],
-				[v6type=$i; v6lib=inet6;
+				[v6lib=inet6;
 				v6libdir=/usr/local/v6/lib;
 				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"])
 			;;
@@ -88,81 +96,30 @@ yes
 #ifdef __KAME__
 yes
 #endif],
-				[v6type=$i; v6lib=inet6;
+				[v6lib=inet6;
 				v6libdir=/usr/local/v6/lib;
 				v6trylibc=yes;
 				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"])
 			;;
-		inria)
-			AC_EGREP_CPP(yes, [
-#include <netinet/in.h>
-#ifdef IPV6_INRIA_VERSION
-yes
-#endif],
-				[v6type=$i;
-				v6lib=dummy;
-				v6libdir=none;
-				v6trylibc=yes;
-				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"])
-			;;
 		zeta)
 			AC_EGREP_CPP(yes, [
 #include <sys/param.h>
 #ifdef _ZETA_MINAMI_INET6
-A
 yes
 #endif],
-				[v6type=$i; v6lib=inet6;
+				[v6lib=inet6;
 				v6libdir=/usr/local/v6/lib;
 				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"])
 			;;
-		linux-glibc)
-			AC_EGREP_CPP(yes, [
-#include <features.h>
-#if defined(__GLIBC__) && ((__GLIBC__ == 2 && __GLIBC_MINOR__ >= 1) || (__GLIBC_ > 2))
-yes
-#endif],
-				[v6type=$i;
-				v6lib=dummy;
-				v6libdir=none;
-				v6trylibc=yes;
-				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"])
-			;;
-		linux-inet6)
-			if test -d /usr/inet6; then
-				v6type=$i
-				v6lib=inet6
-				v6libdir=/usr/inet6/lib
-				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"
-			fi
-			;;
-		cygwin)
-			AC_EGREP_CPP(yes, [
-#include <netinet/in.h>
-#ifdef _CYGWIN_IN6_H
-yes
-#endif],
-				[v6type=$i;
-				v6lib=dummy;
-				v6libdir=none
-				v6trylibc=yes;
-				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"])
-                       ;;
-		winsock2)
-			AC_EGREP_CPP(yes, [
-#include <ws2tcpip.h>
-#if defined(_WS2TCPIP_H)
-yes
-#endif],
-				[v6type=$i;
-				v6lib=dummy;
-				v6libdir=none
-				v6trylibc=yes;
-				CFLAGS="-DNETSNMP_ENABLE_IPV6 $CFLAGS"])
-			;;
 		generic)
                         AC_MSG_RESULT([[postponed]])
-			AC_CHECK_MEMBER([struct sockaddr_in6.sin6_addr],,,[
+                        AC_CHECK_MEMBER([struct sockaddr_in6.sin6_addr],,,[[
+#ifdef HAVE_WINSOCK2_H
+#include <winsock2.h>
+#ifdef HAVE_WS2TCPIP_H
+#include <ws2tcpip.h>
+#endif
+#endif]
 AC_INCLUDES_DEFAULT()
 [#ifdef HAVE_SYS_PARAM_H
 #include <sys/param.h>
@@ -176,7 +133,6 @@ AC_INCLUDES_DEFAULT()
 ]])
 	                AC_MSG_CHECKING([[ipv6 stack type]])
                         if test "x$ac_cv_member_struct_sockaddr_in6_sin6_addr" = "xyes"; then
-				v6type=$i
 				v6lib=dummy
 				v6libdir=none
 				v6trylibc=yes
@@ -184,7 +140,7 @@ AC_INCLUDES_DEFAULT()
                         fi
 			;;
 		esac
-		if test "$v6type" != "unknown"; then
+		if test "$v6lib" != "none"; then
 			break
 		fi
 	done
@@ -202,6 +158,7 @@ AC_INCLUDES_DEFAULT()
 			exit 1
 		fi
 	else
+		v6type="unknown"
 		enable_ipv6="no"
 		AC_MSG_RESULT(["$v6type, $enable_ipv6"])
 	fi
diff -urpN net-snmp-5.8/configure.d/config_project_types net-snmp-5.9.1/configure.d/config_project_types
--- net-snmp-5.8/configure.d/config_project_types	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.d/config_project_types	2021-05-26 05:19:35.000000000 +0700
@@ -34,39 +34,77 @@ AC_DEFINE_UNQUOTED([NETSNMP_ATTRIBUTE_UN
 #   More complex checks:
 ##
 
-#   Check for 'socklen_t'                           (HP-UX)
+#   Check for 'socklen_t', 'in_addr_t' and 'ssize_t'.
 #
-AC_CHECK_TYPES([socklen_t],,,[
-#include <sys/types.h>
-#if STDC_HEADERS
+AC_CHECK_TYPES([socklen_t, in_addr_t, ssize_t],,,[
+#if defined(HAVE_WINSOCK2_H) && defined(HAVE_WS2TCPIP_H)
+#include <winsock2.h>
+#include <ws2tcpip.h>
+#endif
 #include <stdlib.h>
 #include <stddef.h>
+#ifdef HAVE_SYS_TYPES_H
+#include <sys/types.h>
 #endif
 #ifdef HAVE_SYS_SOCKET_H
 #include <sys/socket.h>
-#endif])
-
-
-#   Check for 'in_addr_t'
-#       May be in <netinet/in.h>                        (AIX)
-#
-AC_CHECK_TYPES([in_addr_t],,,[
-#include <sys/types.h>
-#if STDC_HEADERS
-#include <stdlib.h>
-#include <stddef.h>
 #endif
 #ifdef HAVE_NETINET_IN_H
 #include <netinet/in.h>
 #endif])
 
+if test "x$ac_cv_type_in_addr_t" != xyes; then
+AC_DEFINE([in_addr_t], [unsigned long],
+          [in_addr_t definition if not defined in <netinet/in.h>. Must match the type of sockaddr_in::sin_addr])
+fi
 
-#   Check for 'ssize_t'
-#       Not necessarily in <sys/types.h>                (older MinGW)
 #
-AC_CHECK_TYPES([ssize_t],,,[
-#include <sys/types.h>
-#if STDC_HEADERS
-#include <stdlib.h>
+# Check for the type of the fifth argument of select()
+#
+
+netsnmp_save_CFLAGS=$CFLAGS
+CFLAGS="$CFLAGS -Werror"
+
+AC_MSG_CHECKING([for the type of the fifth argument of select()])
+arg_type=void
+for t in "struct timeval" "struct __ms_timeval"; do
+AC_COMPILE_IFELSE(
+    [AC_LANG_PROGRAM([
+#if defined(HAVE_WINSOCK2_H) && defined(HAVE_WS2TCPIP_H)
+#include <winsock2.h>
+#include <ws2tcpip.h>
+#else
+#ifdef HAVE_SYS_SELECT_H
+#include <sys/select.h>
+#endif
+#endif
 #include <stddef.h>
-#endif])
+], [return select(0, NULL, NULL, NULL, ($t *)NULL)])],
+    [arg_type=$t; break])
+done
+AC_MSG_RESULT(${arg_type})
+AC_DEFINE_UNQUOTED([NETSNMP_SELECT_TIMEVAL], [${arg_type}],
+        [Type of the fifth argument of select()])
+
+AC_MSG_CHECKING([for the type of the third argument of ioctlsocket()])
+arg_type=void
+for t in "unsigned int" "unsigned long"; do
+AC_COMPILE_IFELSE(
+    [AC_LANG_PROGRAM([
+#if defined(HAVE_WINSOCK2_H) && defined(HAVE_WS2TCPIP_H)
+#include <winsock2.h>
+#include <ws2tcpip.h>
+#else
+#ifdef HAVE_SYS_SELECT_H
+#include <sys/select.h>
+#endif
+#endif
+#include <stddef.h>
+], [return ioctlsocket(0, 0, ($t *)NULL)])],
+    [arg_type=$t; break])
+done
+AC_MSG_RESULT(${arg_type})
+AC_DEFINE_UNQUOTED([NETSNMP_IOCTLSOCKET_ARG], [${arg_type}],
+        [Type of the third argument of ioctlsocket()])
+
+CFLAGS=$netsnmp_save_CFLAGS
diff -urpN net-snmp-5.8/configure.d/config_project_with_enable net-snmp-5.9.1/configure.d/config_project_with_enable
--- net-snmp-5.8/configure.d/config_project_with_enable	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/configure.d/config_project_with_enable	2021-05-26 05:19:35.000000000 +0700
@@ -27,6 +27,8 @@ AC_ARG_WITH(endianness,
                                   cross-compiling.],
     [if test $with_endianness != "big" -a $with_endianness != "little" ; then
        AC_MSG_ERROR([Endianness must be big or little, not "$with_endianness".]);
+     else
+       AC_MSG_WARN([--with-endianness is obsolete])
      fi
 ])
 
@@ -57,14 +59,6 @@ AC_SUBST(LIBTOOLFLAGS)
 #   System: Library settings
 ##
 
-NETSNMP_ARG_WITH(dmalloc,
-        AS_HELP_STRING([--with-dmalloc=PATH],
-                [Use dmalloc library (www.dmalloc.com)]))
-
-NETSNMP_ARG_WITH(efence,
-[  --with-efence                   Look for and use libefence (malloc).],
-      use_efence="$withval")
-
 tryrsaref=no
 NETSNMP_ARG_WITH(rsaref,
 [  --with-rsaref=PATH              Look for librsaref in PATH/lib.],
diff -urpN net-snmp-5.8/dist/Makefile net-snmp-5.9.1/dist/Makefile
--- net-snmp-5.8/dist/Makefile	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/dist/Makefile	2021-05-26 05:19:35.000000000 +0700
@@ -19,7 +19,7 @@ SHELL = /bin/sh
 NAME = net-snmp
 
 # Define the default RPM release number. Set by Version-Munge.pl
-VERSION = 5.8
+VERSION = 5.9.1
 
 VERSION_TAG=`echo Ext-$(VERSION) | sed 's/\./-/g;'`
 
diff -urpN net-snmp-5.8/dist/autoconf-version net-snmp-5.9.1/dist/autoconf-version
--- net-snmp-5.8/dist/autoconf-version	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/dist/autoconf-version	2021-05-26 05:19:35.000000000 +0700
@@ -1 +1 @@
-2.68
+2.69
diff -urpN net-snmp-5.8/dist/net-snmp.spec net-snmp-5.9.1/dist/net-snmp.spec
--- net-snmp-5.8/dist/net-snmp.spec	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/dist/net-snmp.spec	2021-05-26 05:19:35.000000000 +0700
@@ -35,25 +35,31 @@
 %if 0%{?netsnmp_embedded_perl} || 0%{?netsnmp_perl_modules}
 %define netsnmp_include_perl 1
 %endif
-Summary: Tools and servers for the SNMP protocol
+Summary: Tools and services for the SNMP protocol
 Name: net-snmp
-Version: 5.8
+Version: 5.9.1
 # update release for vendor release. (eg 1.fc6, 1.rh72, 1.ydl3, 1.ydl23)
 Release: 1
 URL: http://www.net-snmp.org/
 License: BSDish
 Group: System Environment/Daemons
 Vendor: Net-SNMP project
-Source: http://prdownloads.sourceforge.net/net-snmp/net-snmp-%{version}.tar.gz
-Prereq: openssl
+Source: net-snmp-%{version}.tar.gz
 Obsoletes: cmu-snmp ucd-snmp ucd-snmp-utils
 BuildRoot: /tmp/%{name}-root
 Packager: The Net-SNMP Coders <http://sourceforge.net/projects/net-snmp/>
-Requires: openssl, popt, rpm, zlib, bzip2-libs, elfutils-libelf, glibc
-BuildRequires: perl, elfutils-libelf-devel, openssl-devel, bzip2-devel, rpm-devel
+Requires: openssl, popt, rpm, zlib, bzip2-libs, glibc
+# Net-SNMP requires either openssl-devel or libressl-devel at build time, but
+# how to express this in an RPM spec file?
+BuildRequires: autoconf
+BuildRequires: automake
+BuildRequires: bzip2
+BuildRequires: gcc
+BuildRequires: perl
+BuildRequires: rpm-devel
 %if 0%{?netsnmp_embedded_perl}
-BuildRequires: perl(ExtUtils::Embed)
 Requires: perl
+BuildRequires: perl(ExtUtils::Embed)
 %endif
 
 %if 0%{?fedora}%{?rhel}
@@ -62,6 +68,7 @@ Provides: net-snmp-libs, net-snmp-utils
 Obsoletes: net-snmp-libs, net-snmp-utils
 Epoch: 2
 
+# RHEL or Fedora
 %if 0%{?fedora} >= 9
 Provides: net-snmp-gui
 Obsoletes: net-snmp-gui
@@ -70,7 +77,7 @@ Obsoletes: net-snmp-gui
 %else
 BuildRequires: beecrypt-devel
 %endif
-%endif # RHEL or Fedora
+%endif
 
 %description
 
@@ -89,7 +96,7 @@ This package includes embedded Perl supp
 Group: Development/Libraries
 Summary: The includes and static libraries from the Net-SNMP package.
 AutoReqProv: no
-Requires: net-snmp = %{epoch}:%{version}
+Requires: net-snmp = %{?%{epoch}:%{epoch}\:}%{version}
 Obsoletes: cmu-snmp-devel ucd-snmp-devel
 
 %description devel
@@ -101,7 +108,7 @@ useful for building SNMP applications, a
 Group: System Environment/Libraries
 Summary: The Perl modules provided with Net-SNMP
 AutoReqProv: no
-Requires: net-snmp = %{epoch}:%{version}, perl
+Requires: net-snmp = %{?%{epoch}:%{epoch}\:}%{version}, perl
 
 %if 0%{?fedora}%{?rhel}
 Provides: net-snmp-perl
@@ -124,18 +131,29 @@ protocol.  Both client and agent support
 echo "'-with embedded_perl' requires '-with perl_modules'"
 exit 1
 %endif
+
 %setup -q
 
 %build
-%configure --with-defaults --with-sys-contact="Unknown" \
-	--with-mib-modules="smux" \
-	--with-sysconfdir="/etc/net-snmp"               \
-	--enable-shared \
-	%{?netsnmp_perl_modules: --with-perl-modules="INSTALLDIRS=vendor"} \
-	%{!?netsnmp_perl_modules: --without-perl-modules} \
-	%{?netsnmp_embedded_perl: --enable-embedded-perl} \
-	%{!?netsnmp_embedded_perl: --disable-embedded-perl} \
-	--with-cflags="$RPM_OPT_FLAGS %{netsnmp_cflags}"
+options=()
+options+=(--enable-shared)
+options+=(--sysconfdir="/etc/net-snmp")
+options+=(--with-cflags="$RPM_OPT_FLAGS %{netsnmp_cflags}")
+options+=(--with-defaults)
+options+=(--with-mib-modules="smux")
+options+=(--with-sys-contact="Unknown")
+%if 0%{?netsnmp_perl_modules}
+options+=(--with-perl-modules="INSTALLDIRS=vendor")
+%else
+options+=(--without-perl-modules)
+%endif
+%if 0%{?netsnmp_embedded_perl}
+options+=(--enable-embedded-perl)
+%else
+options+=(--disable-embedded-perl)
+%endif
+
+%configure "${options[@]}"
 
 make
 
@@ -203,10 +221,10 @@ rm -rf $RPM_BUILD_ROOT
 %doc README.snmpv3 README.solaris README.thread README.win32
 %doc README.aix README.osX README.tru64 README.irix README.agent-mibs
 %doc README.Panasonic_AM3X.txt
+
+# % config(noreplace) /etc/net-snmp/snmpd.conf
 	 
-#%config(noreplace) /etc/net-snmp/snmpd.conf
-	 
-#%{_datadir}/snmp/snmpconf-data
+# % {_datadir}/snmp/snmpconf-data
 %{_datadir}/snmp
 
 %{_bindir}
@@ -217,6 +235,7 @@ rm -rf $RPM_BUILD_ROOT
 %{_mandir}/man5/*
 %{_mandir}/man8/*
 %{_libdir}/*.so*
+%{_libdir}/pkgconfig/*.pc
 /etc/rc.d/init.d/snmpd
 
 %files devel
@@ -233,12 +252,12 @@ rm -rf $RPM_BUILD_ROOT
 %{_mandir}/man3/SNMP*
 %endif
 
-%verifyscript
-echo "No additional verification is done for net-snmp"
-
 %changelog
+* Sat Aug 22 2020 Bart Van Assche <bvanassche@acm.org>
+- Fixed the warnings reported by rpmbuild about this spec file.
+
 * Sat Dec 15 2012 Magnus Fromreide <magfr@lysator.liu.se>
-- Make he -without options to rpmbuild work
+- Make the -without options to rpmbuild work
 
 * Thu Jul 26 2012 Dave Shield <D.T.Shield@liverpool.ac.uk>
 - Additional "Provides:" to complete the list of perl modules
@@ -259,7 +278,7 @@ echo "No additional verification is done
 * Tue Jun 19 2007 Thomas Anders <tanders@users.sf.net>
 - add "BuildRequires: perl-ExtUtils-Embed", e.g. for Fedora 7
 
-* Wed Nov 23 2006 Thomas Anders <tanders@users.sf.net>
+* Wed Nov 22 2006 Thomas Anders <tanders@users.sf.net>
 - fixes for 5.4 and 64-bit platforms
 - enable Perl by default, but allow for --without perl_modules|embedded_perl
 - add netsnmp_ prefix for local defines
diff -urpN net-snmp-5.8/dist/release net-snmp-5.9.1/dist/release
--- net-snmp-5.8/dist/release	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/dist/release	2021-05-26 05:19:35.000000000 +0700
@@ -3,4 +3,3 @@
 # applying patches to a given branch.  Right now, the file should contain
 # a branch name followed by 'rc' when the branch is in rc phase of a release.
 #
-V5-4-patches rc
diff -urpN net-snmp-5.8/dist/svnup net-snmp-5.9.1/dist/svnup
--- net-snmp-5.8/dist/svnup	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/dist/svnup	1970-01-01 07:00:00.000000000 +0700
@@ -1,130 +0,0 @@
-#!/bin/sh
-#
-# $Id: cvsup 15788 2007-01-24 13:49:38Z dts12 $
-#
-TAG=
-WO=0
-DEST=
-TMPDIR=/tmp
-
-if [ "x$1" = "x-u" ]; then
-    DEST=$2
-    shift 2
-
-    # gnu tar (as of 1.15.1) is unable to create portable tar archives, 
-    # especially if long file names (>100 char) are present.
-    # star is a better replacement.
-    if [ -x /usr/bin/star ]; then
-        TAR='/usr/bin/star -Hustar -not -pat=*/.svn/* -c -f'
-    elif [ -x /bin/tar ]; then
-        TAR="/bin/tar --exclude=.svn -c -f"
-        echo "warning: star not available, using (less portable) tar..."
-    else
-        echo "neither /usr/bin/star nor /bin/tar found."
-        exit
-    fi
-fi
-
-if [ $# -eq 0 ]; then
-    DIR=$PWD
-else
-    if [ $# -ne 1 ]; then
-        echo "usage: $0 <working directory>"
-        exit
-    fi
-    DIR=$1
-fi
-
-if [ -z ${DIR##*/} ];then
-   DIR=${DIR%/*}
-fi
-SUBD=${DIR##*/}
-PARENT=${DIR%*$SUBD}
-#echo "$DIR = $PARENT + $SUBD"
-
-if [ ! -d $DIR ]; then
-    echo "no such directory '$DIR'"
-    exit
-fi
-
-if [ ! -d $DIR/.svn ]; then
-    echo "'$DIR' has no .svn directory!"
-    exit
-fi
-
-if [ ! -f $DIR/.svn/entries ]; then
-    echo "'$DIR' has no .svn/entries!"
-    exit
-fi
-
-SVNURL=`svn info $DIR| grep URL|cut -f2 -d " "`
-SVNTLD=`echo $SVNURL | sed 's:.*svnroot/net-snmp/\([^/]*\).*:\1:'`
-if [ "x$SVNTLD" = "xtrunk" ]; then
-   TAG="main"
-else
-   TAG=`echo $SVNURL | sed 's:.*svnroot/net-snmp/[^/]*/\([^/]*\).*:\1:'`
-fi
-
-if [ ! -z $DEST ]; then
-    if [ -z $TAG ]; then
-        echo "no TAG found in $DIR!"
-        exit 1
-    fi
-fi
-
-COMMAND="svn update -q $SVNURL $DIR"
-
-if [ ! -w $DIR/.svn ]; then
-    if [ -O $DIR/.svn ]; then
-        WO=1
-        echo "Making $DIR writable"
-        chmod -R u+w $DIR
-    fi
-fi
-
-echo "Updating directory $DIR from $TAG..."
-echo "$COMMAND"
-
-$COMMAND
-rc=$?
-if [ $rc -ne 0 ]; then
-    echo "svn command returned $?"
-fi
-
-if [ $WO -eq 1 ]; then
-    echo "Making $DIR read-only"
-    chmod -R a-w $DIR
-fi
-
-if [ ! -z $DEST ]; then
-  if [ $rc -ne 0 ]; then
-    echo "skipping upload due to rc $rc from svn command"
-    exit $rc
-  else
-    cd $DIR/..
-    #echo $PWD
-    DATE=`date +%Y%m%d_%H%M`
-    SOURCE=net-snmp-svn-$TAG"_$DATE"
-    $TAR $TMPDIR/$SOURCE.tar $SUBD
-    rc=$?
-    if [ $rc -ne 0 ]; then
-      echo "skipping upload due to rc $rc from tar command"
-      rm -f $TMPDIR/$SOURCE.tar.gz
-      exit $rc
-    fi
-    gzip -f --best $TMPDIR/$SOURCE.tar
-    rc=$?
-    if [ $rc -ne 0 ]; then
-      echo "skipping upload due to rc $rc from gzip command"
-      rm -f $TMPDIR/$SOURCE.tar.gz
-      exit $rc
-    fi
-    scp $TMPDIR/$SOURCE.tar.gz $DEST
-    rc=$?
-    if [ $rc -ne 0 ]; then
-      echo "warning: rc $rc from scp command (tarball in $TMPDIR)"
-    else
-      rm -f $TMPDIR/$SOURCE.tar.gz
-    fi
-  fi
-fi
diff -urpN net-snmp-5.8/doxygen.conf net-snmp-5.9.1/doxygen.conf
--- net-snmp-5.8/doxygen.conf	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/doxygen.conf	2021-05-26 05:19:35.000000000 +0700
@@ -650,7 +650,7 @@ SEARCH_INCLUDES        = YES
 # contain include files that are not input files but should be processed by 
 # the preprocessor.
 
-INCLUDE_PATH           = 
+INCLUDE_PATH           = $(srcdir)/agent/mibgroup
 
 # You can use the INCLUDE_FILE_PATTERNS tag to specify one or more wildcard 
 # patterns (like *.h and *.hpp) to filter out the header-files in the 
diff -urpN net-snmp-5.8/include/net-snmp/agent/agent_read_config.h net-snmp-5.9.1/include/net-snmp/agent/agent_read_config.h
--- net-snmp-5.8/include/net-snmp/agent/agent_read_config.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/agent/agent_read_config.h	2021-05-26 05:19:35.000000000 +0700
@@ -25,6 +25,11 @@ extern          "C" {
     void            snmpd_unregister_config_handler(const char *);
     void            snmpd_store_config(const char *);
 
+    void            netsnmp_set_agent_user_id(int uid);
+    void            netsnmp_set_agent_group_id(int gid);
+    void            netsnmp_parse_agent_user(const char *token, char *cptr);
+    void            netsnmp_parse_agent_group(const char *token, char *cptr);
+
 #ifdef __cplusplus
 }
 #endif
diff -urpN net-snmp-5.8/include/net-snmp/agent/hardware/fsys.h net-snmp-5.9.1/include/net-snmp/agent/hardware/fsys.h
--- net-snmp-5.8/include/net-snmp/agent/hardware/fsys.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/agent/hardware/fsys.h	2021-05-26 05:19:35.000000000 +0700
@@ -41,6 +41,7 @@ typedef struct netsnmp_fsys_info_s netsn
 #define NETSNMP_FS_TYPE_SYSFS	   (4 | _NETSNMP_FS_TYPE_LOCAL | _NETSNMP_FS_TYPE_SKIP_BIT)
 #define NETSNMP_FS_TYPE_TMPFS	   (5 | _NETSNMP_FS_TYPE_LOCAL)
 #define NETSNMP_FS_TYPE_USBFS	   (6 | _NETSNMP_FS_TYPE_LOCAL)
+#define NETSNMP_FS_TYPE_AUTOFS	   (7 | _NETSNMP_FS_TYPE_LOCAL | _NETSNMP_FS_TYPE_SKIP_BIT)
 
 #define NETSNMP_FS_FLAG_ACTIVE   0x01
 #define NETSNMP_FS_FLAG_REMOTE   0x02
diff -urpN net-snmp-5.8/include/net-snmp/agent/hardware/memory.h net-snmp-5.9.1/include/net-snmp/agent/hardware/memory.h
--- net-snmp-5.8/include/net-snmp/agent/hardware/memory.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/agent/hardware/memory.h	2021-05-26 05:19:35.000000000 +0700
@@ -10,6 +10,7 @@ typedef struct netsnmp_memory_info_s net
 #define NETSNMP_MEM_TYPE_SHARED   8
 #define NETSNMP_MEM_TYPE_SHARED2  9
 #define NETSNMP_MEM_TYPE_SWAP    10
+#define NETSNMP_MEM_TYPE_AVAILMEM 11
     /* Leave space for individual swap devices */
 #define NETSNMP_MEM_TYPE_MAX     30
 
diff -urpN net-snmp-5.8/include/net-snmp/agent/snmp_agent.h net-snmp-5.9.1/include/net-snmp/agent/snmp_agent.h
--- net-snmp-5.8/include/net-snmp/agent/snmp_agent.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/agent/snmp_agent.h	2021-05-26 05:19:35.000000000 +0700
@@ -26,6 +26,8 @@
 #ifndef SNMP_AGENT_H
 #define SNMP_AGENT_H
 
+#include <stdint.h>
+
 #ifdef __cplusplus
 extern          "C" {
 #endif
@@ -40,6 +42,8 @@ extern          "C" {
 #define SNMP_AGENT_FLAGS_NONE                   0x0
 #define SNMP_AGENT_FLAGS_CANCEL_IN_PROGRESS     0x1
 
+    struct timeval;
+
     /*
      * If non-zero, causes the addresses of peers to be logged when receptions
      * occur.  
diff -urpN net-snmp-5.8/include/net-snmp/data_access/interface.h net-snmp-5.9.1/include/net-snmp/data_access/interface.h
--- net-snmp-5.8/include/net-snmp/data_access/interface.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/data_access/interface.h	2021-05-26 05:19:35.000000000 +0700
@@ -10,6 +10,12 @@
 extern          "C" {
 #endif
 
+#if HAVE_PCRE_H
+#include <pcre.h>
+#elif HAVE_REGEX_H
+#include <regex.h>
+#endif
+
 /*
  * define flags to indicate the availability of certain data
  */
@@ -204,6 +210,16 @@ typedef struct _conf_if_list {
 
     typedef netsnmp_conf_if_list conf_if_list; /* backwards compat */
 
+typedef struct _include_if_list {
+#if HAVE_PCRE_H
+    pcre                    *regex_ptr;
+#elif HAVE_REGEX_H
+    regex_t                 *regex_ptr;
+#endif
+    char                    *name;
+    struct _include_if_list *next;
+} netsnmp_include_if_list;
+
 /**---------------------------------------------------------------------*/
 /*
  * ACCESS function prototypes
@@ -283,6 +299,9 @@ void netsnmp_access_interface_entry_over
 netsnmp_conf_if_list *
 netsnmp_access_interface_entry_overrides_get(const char * name);
 
+int netsnmp_access_interface_include(const char * name);
+int netsnmp_access_interface_max_reached(const char * name);
+
 /**---------------------------------------------------------------------*/
 
 #if defined( USING_IF_MIB_IFTABLE_IFTABLE_DATA_ACCESS_MODULE ) && \
diff -urpN net-snmp-5.8/include/net-snmp/data_access/swrun.h net-snmp-5.9.1/include/net-snmp/data_access/swrun.h
--- net-snmp-5.8/include/net-snmp/data_access/swrun.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/data_access/swrun.h	2021-05-26 05:19:35.000000000 +0700
@@ -89,9 +89,9 @@ extern "C" {
     int  swrun_max_processes(   void );
     int  swrun_count_processes_by_name( char *name );
 
-#ifndef NETSNMP_FEATURE_REMOVE_SWRUN_COUNT_PROCESSES_BY_REGEX
-    struct real_pcre;
-    int  swrun_count_processes_by_regex(char *name, struct real_pcre *regexp);
+#if !defined(NETSNMP_FEATURE_REMOVE_SWRUN_COUNT_PROCESSES_BY_REGEX) \
+    && defined(HAVE_PCRE_H)
+    int  swrun_count_processes_by_regex(char *name, netsnmp_regex_ptr regexp);
 #endif
 
 #define NETSNMP_SWRUN_NOFLAGS            0x00000000
diff -urpN net-snmp-5.8/include/net-snmp/library/asn1.h net-snmp-5.9.1/include/net-snmp/library/asn1.h
--- net-snmp-5.8/include/net-snmp/library/asn1.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/asn1.h	2021-05-26 05:19:35.000000000 +0700
@@ -52,26 +52,26 @@ SOFTWARE.
 #define OID_LENGTH(x)  (sizeof(x)/sizeof(oid))
 
 
-#define ASN_BOOLEAN	    ((u_char)0x01)
-#define ASN_INTEGER	    ((u_char)0x02)
-#define ASN_BIT_STR	    ((u_char)0x03)
-#define ASN_OCTET_STR	    ((u_char)0x04)
-#define ASN_NULL	    ((u_char)0x05)
-#define ASN_OBJECT_ID	    ((u_char)0x06)
-#define ASN_SEQUENCE	    ((u_char)0x10)
-#define ASN_SET		    ((u_char)0x11)
-
-#define ASN_UNIVERSAL	    ((u_char)0x00)
-#define ASN_APPLICATION     ((u_char)0x40)
-#define ASN_CONTEXT	    ((u_char)0x80)
-#define ASN_PRIVATE	    ((u_char)0xC0)
-
-#define ASN_PRIMITIVE	    ((u_char)0x00)
-#define ASN_CONSTRUCTOR	    ((u_char)0x20)
-
-#define ASN_LONG_LEN	    (0x80)
-#define ASN_EXTENSION_ID    (0x1F)
-#define ASN_BIT8	    (0x80)
+#define ASN_BOOLEAN	    0x01U
+#define ASN_INTEGER	    0x02U
+#define ASN_BIT_STR	    0x03U
+#define ASN_OCTET_STR	    0x04U
+#define ASN_NULL	    0x05U
+#define ASN_OBJECT_ID	    0x06U
+#define ASN_SEQUENCE	    0x10U
+#define ASN_SET		    0x11U
+
+#define ASN_UNIVERSAL	    0x00U
+#define ASN_APPLICATION     0x40U
+#define ASN_CONTEXT	    0x80U
+#define ASN_PRIVATE	    0xC0U
+
+#define ASN_PRIMITIVE	    0x00U
+#define ASN_CONSTRUCTOR	    0x20U
+
+#define ASN_LONG_LEN	    0x80U
+#define ASN_EXTENSION_ID    0x1FU
+#define ASN_BIT8	    0x80U
 
 #define IS_CONSTRUCTOR(byte)	((byte) & ASN_CONSTRUCTOR)
 #define IS_EXTENSION_ID(byte)	(((byte) & ASN_EXTENSION_ID) == ASN_EXTENSION_ID)
@@ -107,9 +107,9 @@ SOFTWARE.
      * base value for the second octet of the tag - the
      * second octet was the value for the tag 
      */
-#define ASN_OPAQUE_TAG2 ((u_char)0x30)
+#define ASN_OPAQUE_TAG2 0x30U
 
-#define ASN_OPAQUE_TAG2U ((u_char)0x2f) /* second octet of tag for union */
+#define ASN_OPAQUE_TAG2U 0x2fU /* second octet of tag for union */
 
     /*
      * All the ASN.1 types for SNMP "should have been" defined in this file,
diff -urpN net-snmp-5.8/include/net-snmp/library/default_store.h net-snmp-5.9.1/include/net-snmp/library/default_store.h
--- net-snmp-5.8/include/net-snmp/library/default_store.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/default_store.h	2021-05-26 05:19:35.000000000 +0700
@@ -104,6 +104,7 @@ extern          "C" {
 #define NETSNMP_DS_LIB_DISABLE_V2c         44 /* disable SNMPv2c */
 #define NETSNMP_DS_LIB_DISABLE_V3          45 /* disable SNMPv3 */
 #define NETSNMP_DS_LIB_FILTER_SOURCE       46 /* filter pkt by source IP */
+#define NETSNMP_DS_LIB_ADD_FORWARDER_INFO  47 /* add info about forwarder to SNMP packets */
 #define NETSNMP_DS_LIB_MAX_BOOL_ID         48 /* match NETSNMP_DS_MAX_SUBIDS */
 
     /*
@@ -128,7 +129,7 @@ extern          "C" {
 #define NETSNMP_DS_LIB_TIMEOUT             14
 #define NETSNMP_DS_LIB_RETRIES             15
 #define NETSNMP_DS_LIB_MSG_SEND_MAX        16 /* global max response size */
-#define NETSNMP_DS_LIB_FILTER_TYPE         17 /* 0=NONE, 1=whitelist, -1=blacklist */
+#define NETSNMP_DS_LIB_FILTER_TYPE         17 /* 0=NONE, 1=acceptlist, -1=blocklist */
 #define NETSNMP_DS_LIB_MAX_INT_ID          48 /* match NETSNMP_DS_MAX_SUBIDS */
     
     /*
@@ -193,17 +194,25 @@ extern          "C" {
      */
 #ifndef NETSNMP_FEATURE_REMOVE_RUNTIME_DISABLE_VERSION
 
-#if !defined(NETSNMP_DISABLE_SNMPV1) || !defined(NETSNMP_DISABLE_SNMPV2C)
-
-#define NETSNMP_RUNTIME_PROTOCOL_SKIP_V1(pc_ver) \
-    ((pc_ver == SNMP_VERSION_1) &&                                     \
+#if defined(NETSNMP_DISABLE_SNMPV1)
+#define NETSNMP_RUNTIME_PROTOCOL_SKIP_V1(pc_ver)                        \
+    ((pc_ver) == 0/*SNMP_VERSION_1*/)
+#else
+#define NETSNMP_RUNTIME_PROTOCOL_SKIP_V1(pc_ver)                        \
+    ((pc_ver) == SNMP_VERSION_1 &&                                      \
      netsnmp_ds_get_boolean(NETSNMP_DS_LIBRARY_ID,                      \
                             NETSNMP_DS_LIB_DISABLE_V1))
+#endif
 
-#define NETSNMP_RUNTIME_PROTOCOL_SKIP_V2(pc_ver) \
-    ((pc_ver == SNMP_VERSION_2c) &&                                     \
+#if defined(NETSNMP_DISABLE_SNMPV2C)
+#define NETSNMP_RUNTIME_PROTOCOL_SKIP_V2(pc_ver)                        \
+    ((pc_ver) == 1/*SNMP_VERSION_2c*/)
+#else
+#define NETSNMP_RUNTIME_PROTOCOL_SKIP_V2(pc_ver)                        \
+    ((pc_ver) == SNMP_VERSION_2c &&                                     \
      netsnmp_ds_get_boolean(NETSNMP_DS_LIBRARY_ID,                      \
                             NETSNMP_DS_LIB_DISABLE_V2c))
+#endif
 
 #define NETSNMP_RUNTIME_PROTOCOL_CHECK_V1V2(pc_ver, pc_target) do {    \
         if (NETSNMP_RUNTIME_PROTOCOL_SKIP_V1(pc_ver) ||                \
@@ -212,11 +221,6 @@ extern          "C" {
             goto pc_target;                                            \
         }                                                              \
     } while(0)
-#else
-#define NETSNMP_RUNTIME_PROTOCOL_SKIP_V1(pc_ver) (0)
-#define NETSNMP_RUNTIME_PROTOCOL_SKIP_V2(pc_ver) (0)
-#define NETSNMP_RUNTIME_PROTOCOL_CHECK_V1V2(ver, gt) do { ; } while(0)
-#endif
 
 #define NETSNMP_RUNTIME_PROTOCOL_SKIP_V3(pc_ver) \
     ((pc_ver == SNMP_VERSION_3) &&                                   \
diff -urpN net-snmp-5.8/include/net-snmp/library/keytools.h net-snmp-5.9.1/include/net-snmp/library/keytools.h
--- net-snmp-5.8/include/net-snmp/library/keytools.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/keytools.h	2021-05-26 05:19:35.000000000 +0700
@@ -49,11 +49,11 @@ extern          "C" {
                                      size_t * kcstring_len);
 
     NETSNMP_IMPORT
-    int             decode_keychange(const oid * hashtype,
-                                     u_int hashtype_len, u_char * oldkey,
-                                     size_t oldkey_len, u_char * kcstring,
-                                     size_t kcstring_len, u_char * newkey,
-                                     size_t * newkey_len);
+    int             decode_keychange(const oid *hashtype, u_int hashtype_len,
+                                     const u_char *oldkey, size_t oldkey_len,
+                                     const u_char *kcstring,
+                                     size_t kcstring_len, u_char *newkey,
+                                     size_t *newkey_len);
 
 
     /*
diff -urpN net-snmp-5.8/include/net-snmp/library/large_fd_set.h net-snmp-5.9.1/include/net-snmp/library/large_fd_set.h
--- net-snmp-5.8/include/net-snmp/library/large_fd_set.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/large_fd_set.h	2021-05-26 05:19:35.000000000 +0700
@@ -64,6 +64,9 @@ extern "C" {
     do { (fdset)->lfs_setptr->fd_count = 0; } while(0)
 
 
+struct timeval;
+
+
 NETSNMP_IMPORT
 void   netsnmp_large_fd_setfd( SOCKET fd, netsnmp_large_fd_set *fdset);
 NETSNMP_IMPORT
diff -urpN net-snmp-5.8/include/net-snmp/library/mib.h net-snmp-5.9.1/include/net-snmp/library/mib.h
--- net-snmp-5.8/include/net-snmp/library/mib.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/mib.h	2021-05-26 05:19:35.000000000 +0700
@@ -124,9 +124,6 @@ SOFTWARE.
     NETSNMP_IMPORT
     char            *netsnmp_get_mib_directory(void);
     void            netsnmp_fixup_mib_directory(void);
-    void            netsnmp_mibindex_load( void );
-    char *          netsnmp_mibindex_lookup( const char * );
-    FILE *          netsnmp_mibindex_new( const char * );
     int             sprint_realloc_description(u_char ** buf, size_t * buf_len,
                                 size_t * out_len, int allow_realloc,
                                 oid * objid, size_t objidlen, int width);
@@ -149,7 +146,7 @@ SOFTWARE.
                                       netsnmp_variable_list * data);
     NETSNMP_IMPORT
     int             build_oid_noalloc(oid * in, size_t in_len,
-                                      size_t * out_len, oid * prefix,
+                                      size_t * out_len, const oid * prefix,
                                       size_t prefix_len,
                                       netsnmp_variable_list * indexes);
     NETSNMP_IMPORT
@@ -484,7 +481,7 @@ SOFTWARE.
 	                             unsigned char **new_val, int *new_val_len);
 
     NETSNMP_IMPORT
-    void            clear_tree_flags(register struct tree *tp);
+    void            clear_tree_flags(struct tree *tp);
 
     NETSNMP_IMPORT
     char           *snmp_out_toggle_options(char *);
diff -urpN net-snmp-5.8/include/net-snmp/library/oid.h net-snmp-5.9.1/include/net-snmp/library/oid.h
--- net-snmp-5.8/include/net-snmp/library/oid.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/oid.h	2021-05-26 05:19:35.000000000 +0700
@@ -1,10 +1,6 @@
 #ifndef NETSNMP_LIBRARY_OID_H
 #define NETSNMP_LIBRARY_OID_H
 
-#ifdef HAVE_INTTYPES_H
-#include <inttypes.h>
-#endif
-
 #if defined(__CYGWIN__) && defined(__LP64__)
 /*
  * The winExtDLL implementation assumes that the size of an OID component is
@@ -18,11 +14,11 @@ typedef unsigned int oid;
 #define NETSNMP_PRIo ""
 #else
 #ifndef EIGHTBIT_SUBIDS
-typedef u_long oid;
+typedef unsigned long oid;
 #define MAX_SUBID   0xFFFFFFFFUL
 #define NETSNMP_PRIo "l"
 #else
-typedef uint8_t oid;
+typedef unsigned char oid;
 #define MAX_SUBID   0xFF
 #define NETSNMP_PRIo ""
 #endif
diff -urpN net-snmp-5.8/include/net-snmp/library/parse.h net-snmp-5.9.1/include/net-snmp/library/parse.h
--- net-snmp-5.8/include/net-snmp/library/parse.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/parse.h	2021-05-26 05:19:35.000000000 +0700
@@ -201,7 +201,7 @@ SOFTWARE.
 #endif
     void            netsnmp_init_mib_internals(void);
     void            unload_all_mibs(void);
-    int             add_mibfile(const char*, const char*, FILE *);
+    int             add_mibfile(const char*, const char*);
     int             which_module(const char *);
     NETSNMP_IMPORT
     char           *module_name(int, char *);
diff -urpN net-snmp-5.8/include/net-snmp/library/scapi.h net-snmp-5.9.1/include/net-snmp/library/scapi.h
--- net-snmp-5.8/include/net-snmp/library/scapi.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/scapi.h	2021-05-26 05:19:35.000000000 +0700
@@ -87,11 +87,13 @@ typedef struct netsnmp_priv_alg_info_s {
     NETSNMP_IMPORT
     oid *           sc_get_auth_oid(int auth_type, size_t *oid_len);
     NETSNMP_IMPORT
-    netsnmp_auth_alg_info * sc_get_auth_alg_byoid(const oid *oid, u_int len);
+    const netsnmp_auth_alg_info *
+    sc_find_auth_alg_byoid(const oid *oid, u_int len);
     NETSNMP_IMPORT
-    netsnmp_auth_alg_info * sc_get_auth_alg_bytype(u_int type);
+    const netsnmp_auth_alg_info *
+    sc_find_auth_alg_bytype(u_int type);
     NETSNMP_IMPORT
-    netsnmp_auth_alg_info * sc_get_auth_alg_byindex(u_int index);
+    const netsnmp_auth_alg_info * sc_get_auth_alg_byindex(u_int index);
 
     /** deprectated, use
      *        sc_get_authtype() + sc_get_proper_auth_length_bytype() */
@@ -116,11 +118,12 @@ typedef struct netsnmp_priv_alg_info_s {
     NETSNMP_IMPORT
     int             sc_get_proper_priv_length_bytype(int privtype);
     NETSNMP_IMPORT
-    netsnmp_priv_alg_info * sc_get_priv_alg_byoid(const oid *oid, u_int len);
+    const netsnmp_priv_alg_info *
+    sc_get_priv_alg_byoid(const oid *oid, u_int len);
     NETSNMP_IMPORT
-    netsnmp_priv_alg_info * sc_get_priv_alg_bytype(u_int type);
+    const netsnmp_priv_alg_info * sc_get_priv_alg_bytype(u_int type);
     NETSNMP_IMPORT
-    netsnmp_priv_alg_info * sc_get_priv_alg_byindex(u_int index);
+    const netsnmp_priv_alg_info * sc_get_priv_alg_byindex(u_int index);
 
     NETSNMP_IMPORT
     int             sc_init(void);
diff -urpN net-snmp-5.8/include/net-snmp/library/sd-daemon.h net-snmp-5.9.1/include/net-snmp/library/sd-daemon.h
--- net-snmp-5.8/include/net-snmp/library/sd-daemon.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/sd-daemon.h	2021-05-26 05:19:35.000000000 +0700
@@ -30,9 +30,6 @@
 #ifdef HAVE_SYS_TYPES_H
 #include <sys/types.h>
 #endif
-#ifdef HAVE_INTTYPES_H
-#include <inttypes.h>
-#endif
 
 #ifdef __cplusplus
 extern "C" {
diff -urpN net-snmp-5.8/include/net-snmp/library/snmpDTLSUDPDomain.h net-snmp-5.9.1/include/net-snmp/library/snmpDTLSUDPDomain.h
--- net-snmp-5.8/include/net-snmp/library/snmpDTLSUDPDomain.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmpDTLSUDPDomain.h	2021-05-26 05:19:35.000000000 +0700
@@ -19,8 +19,8 @@ extern          "C" {
 NETSNMP_IMPORT oid netsnmpDTLSUDPDomain[7];
 NETSNMP_IMPORT size_t netsnmpDTLSUDPDomain_len;
 
-netsnmp_transport *netsnmp_dtlsudp_transport(const struct sockaddr_in *addr,
-                                             int local);
+netsnmp_transport *
+netsnmp_dtlsudp_transport(const struct netsnmp_ep *ep, int local);
 
 
 /*
diff -urpN net-snmp-5.8/include/net-snmp/library/snmpIPBaseDomain.h net-snmp-5.9.1/include/net-snmp/library/snmpIPBaseDomain.h
--- net-snmp-5.8/include/net-snmp/library/snmpIPBaseDomain.h	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmpIPBaseDomain.h	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,41 @@
+#ifndef _SNMPIPBASEDOMAIN_H_
+#define _SNMPIPBASEDOMAIN_H_
+
+#include <net-snmp/types.h>
+#if HAVE_NETINET_IN_H
+#include <netinet/in.h>
+#endif
+
+/**
+ * SNMP endpoint specification.
+ * @param a     Address family, network address and port number.
+ * @param iface Network interface name in ASCII format. May be empty.
+ */
+struct netsnmp_ep {
+    union {
+        struct sockaddr_in  sin;
+#if defined(NETSNMP_TRANSPORT_UDPIPV6_DOMAIN) || \
+    defined(NETSNMP_TRANSPORT_TCPIPV6_DOMAIN)
+        struct sockaddr_in6 sin6;
+#endif
+    } a;
+    char iface[16];
+};
+
+/**
+ * SNMP endpoint with the network name in ASCII format.
+ * @param addr Network address or host name as an ASCII string.
+ * @param iface Network interface, e.g. "lo".
+ * @param port Port number. "" means that no port number has been specified. "0"
+ *   means "bind to any port".
+ */
+struct netsnmp_ep_str {
+    char     addr[64];
+    char     iface[16];
+    char     port[6];
+};
+
+int netsnmp_parse_ep_str(struct netsnmp_ep_str *ep_str, const char *endpoint);
+int netsnmp_bindtodevice(int fd, const char *iface);
+
+#endif /* _SNMPIPBASEDOMAIN_H_ */
diff -urpN net-snmp-5.8/include/net-snmp/library/snmpIPv4BaseDomain.h net-snmp-5.9.1/include/net-snmp/library/snmpIPv4BaseDomain.h
--- net-snmp-5.8/include/net-snmp/library/snmpIPv4BaseDomain.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmpIPv4BaseDomain.h	2021-05-26 05:19:35.000000000 +0700
@@ -9,10 +9,14 @@
 
 #include <net-snmp/library/snmp_transport.h>
 
+config_require(IPBase)
+
 #ifdef __cplusplus
 extern          "C" {
 #endif
 
+    struct netsnmp_ep;
+
 /*
  * Prototypes
  */
@@ -34,6 +38,9 @@ extern          "C" {
                             int remote_port);
     int netsnmp_sockaddr_in2(struct sockaddr_in *addr, const char *inpeername,
                              const char *default_target);
+    int
+    netsnmp_sockaddr_in3(struct netsnmp_ep *ep,
+                         const char *inpeername, const char *default_target);
 
 #ifdef __cplusplus
 }
diff -urpN net-snmp-5.8/include/net-snmp/library/snmpIPv6BaseDomain.h net-snmp-5.9.1/include/net-snmp/library/snmpIPv6BaseDomain.h
--- net-snmp-5.8/include/net-snmp/library/snmpIPv6BaseDomain.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmpIPv6BaseDomain.h	2021-05-26 05:19:35.000000000 +0700
@@ -7,6 +7,8 @@
 #include <netinet/in.h>
 #endif
 
+config_require(IPBase)
+
 #include <net-snmp/library/snmp_transport.h>
 
 #ifdef __cplusplus
@@ -17,21 +19,20 @@ extern          "C" {
  * Prototypes
  */
 
-    NETSNMP_IMPORT
     char *netsnmp_ipv6_fmtaddr(const char *prefix, netsnmp_transport *t,
                                const void *data, int len);
-    NETSNMP_IMPORT
     void netsnmp_ipv6_get_taddr(struct netsnmp_transport_s *t, void **addr,
                                 size_t *addr_len);
-    NETSNMP_IMPORT
     int netsnmp_ipv6_ostring_to_sockaddr(struct sockaddr_in6 *sin6,
                                          const void *o, size_t o_len);
-    NETSNMP_IMPORT
     int netsnmp_sockaddr_in6_2(struct sockaddr_in6 *addr,
                                const char *inpeername,
                                const char *default_target);
     int netsnmp_sockaddr_in6(struct sockaddr_in6 *addr,
                              const char *inpeername, int remote_port);
+    int
+    netsnmp_sockaddr_in6_3(struct netsnmp_ep *ep,
+                           const char *inpeername, const char *default_target);
 
 #ifdef __cplusplus
 }
diff -urpN net-snmp-5.8/include/net-snmp/library/snmpTCPDomain.h net-snmp-5.9.1/include/net-snmp/library/snmpTCPDomain.h
--- net-snmp-5.8/include/net-snmp/library/snmpTCPDomain.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmpTCPDomain.h	2021-05-26 05:19:35.000000000 +0700
@@ -25,8 +25,8 @@ extern          "C" {
 #define TRANSPORT_DOMAIN_TCP_IP		1,3,6,1,2,1,100,1,5
 NETSNMP_IMPORT oid netsnmp_snmpTCPDomain[];
 
-netsnmp_transport *netsnmp_tcp_transport(const struct sockaddr_in *addr,
-                                         int local);
+netsnmp_transport *
+netsnmp_tcp_transport(const struct netsnmp_ep *ep, int local);
 
 /*
  * "Constructor" for transport domain object.  
diff -urpN net-snmp-5.8/include/net-snmp/library/snmpTCPIPv6Domain.h net-snmp-5.9.1/include/net-snmp/library/snmpTCPIPv6Domain.h
--- net-snmp-5.8/include/net-snmp/library/snmpTCPIPv6Domain.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmpTCPIPv6Domain.h	2021-05-26 05:19:35.000000000 +0700
@@ -23,14 +23,14 @@ extern          "C" {
 #define TRANSPORT_DOMAIN_TCP_IPV6	1,3,6,1,2,1,100,1,6
 NETSNMP_IMPORT oid      netsnmp_TCPIPv6Domain[];
 
-netsnmp_transport *netsnmp_tcp6_transport(const struct sockaddr_in6 *addr,
-					  int local);
+netsnmp_transport *
+netsnmp_tcp6_transport(const struct netsnmp_ep *ep, int local);
 
 /*
  * "Constructor" for transport domain object.  
  */
 
-NETSNMP_IMPORT void     netsnmp_tcpipv6_ctor(void);
+void netsnmp_tcpipv6_ctor(void);
 
 #ifdef __cplusplus
 }
diff -urpN net-snmp-5.8/include/net-snmp/library/snmpUDPDomain.h net-snmp-5.9.1/include/net-snmp/library/snmpUDPDomain.h
--- net-snmp-5.8/include/net-snmp/library/snmpUDPDomain.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmpUDPDomain.h	2021-05-26 05:19:35.000000000 +0700
@@ -24,17 +24,14 @@ extern          "C" {
 config_require(UDPIPv4Base)
 #include <net-snmp/library/snmpUDPIPv4BaseDomain.h>
 
-NETSNMP_IMPORT
-netsnmp_transport *netsnmp_udp_transport(const struct sockaddr_in *addr,
-                                         int local);
+netsnmp_transport *
+netsnmp_udp_transport(const struct netsnmp_ep *ep, int local);
 
-NETSNMP_IMPORT
 netsnmp_transport *netsnmp_udp_create_tspec(netsnmp_tdomain_spec *tspec);
 
-NETSNMP_IMPORT
 netsnmp_transport *
-netsnmp_udp_transport_with_source(const struct sockaddr_in *addr, int local,
-                                  const struct sockaddr_in *src_addr);
+netsnmp_udp_transport_with_source(const struct netsnmp_ep *ep, int local,
+                                  const struct netsnmp_ep *src_addr);
 
 #define C2SE_ERR_SUCCESS             0
 #define C2SE_ERR_MISSING_ARG        -1
@@ -46,7 +43,6 @@ netsnmp_udp_transport_with_source(const
 
 typedef struct com2SecEntry_s com2SecEntry;
 
-NETSNMP_IMPORT
 int         netsnmp_udp_com2SecEntry_create(com2SecEntry **entryp,
                                             const char *community,
                                             const char *secName,
@@ -54,10 +50,8 @@ int         netsnmp_udp_com2SecEntry_cre
                                             struct in_addr *network,
                                             struct in_addr *mask,
                                             int negate);
-NETSNMP_IMPORT
 void        netsnmp_udp_com2Sec_free(com2SecEntry *e);
 
-NETSNMP_IMPORT
 int         netsnmp_udp_com2SecList_remove(com2SecEntry *e);
 
 /*
diff -urpN net-snmp-5.8/include/net-snmp/library/snmpUDPIPv4BaseDomain.h net-snmp-5.9.1/include/net-snmp/library/snmpUDPIPv4BaseDomain.h
--- net-snmp-5.8/include/net-snmp/library/snmpUDPIPv4BaseDomain.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmpUDPIPv4BaseDomain.h	2021-05-26 05:19:35.000000000 +0700
@@ -29,20 +29,20 @@ extern          "C" {
  * Prototypes
  */
 
-    netsnmp_transport *netsnmp_udpipv4base_transport(const struct sockaddr_in *addr,
-                                                     int local);
+    netsnmp_transport *
+    netsnmp_udpipv4base_transport(const struct netsnmp_ep *ep, int local);
 
     netsnmp_transport *
-    netsnmp_udpipv4base_transport_with_source(const struct sockaddr_in *addr,
+    netsnmp_udpipv4base_transport_with_source(const struct netsnmp_ep *ep,
                                               int local,
-                                              const struct sockaddr_in *src_addr);
+                                              const struct netsnmp_ep *src_addr);
 
     netsnmp_transport *
     netsnmp_udpipv4base_tspec_transport(netsnmp_tdomain_spec *tspec);
 
     /** internal functions for derivatives of udpipv4base */
     netsnmp_transport *
-    netsnmp_udpipv4base_transport_init(const struct sockaddr_in *addr,
+    netsnmp_udpipv4base_transport_init(const struct netsnmp_ep *ep,
                                        int local);
 
     int
@@ -50,7 +50,7 @@ extern          "C" {
 
     int
     netsnmp_udpipv4base_transport_bind(netsnmp_transport *t,
-                                       const struct sockaddr_in *addr,
+                                       const struct netsnmp_ep *ep,
                                        int flags);
 
     void
diff -urpN net-snmp-5.8/include/net-snmp/library/snmpUDPIPv6Domain.h net-snmp-5.9.1/include/net-snmp/library/snmpUDPIPv6Domain.h
--- net-snmp-5.8/include/net-snmp/library/snmpUDPIPv6Domain.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmpUDPIPv6Domain.h	2021-05-26 05:19:35.000000000 +0700
@@ -29,24 +29,25 @@ config_require(UDPBase)
 #define TRANSPORT_DOMAIN_UDP_IPV6	1,3,6,1,2,1,100,1,2
 NETSNMP_IMPORT oid      netsnmp_UDPIPv6Domain[];
 
-netsnmp_transport *netsnmp_udp6_transport(const struct sockaddr_in6 *addr,
+netsnmp_transport *netsnmp_udp6_transport(const struct netsnmp_ep *ep,
                                           int local);
 
 netsnmp_transport *
-netsnmp_udp6_transport_with_source(const struct sockaddr_in6 *addr, int local,
-                                   const struct sockaddr_in6 *src_addr);
+netsnmp_udp6_transport_with_source(const struct netsnmp_ep *ep, int local,
+                                   const struct netsnmp_ep *src_addr);
 
     /** internal functions for derivatives of udpipv6 */
 
     netsnmp_transport *
-    netsnmp_udp6_transport_init(const struct sockaddr_in6 *addr, int local);
+    netsnmp_udp6_transport_init(const struct netsnmp_ep *ep, int local);
 
     int
     netsnmp_udp6_transport_socket(int flags);
 
     int
     netsnmp_udp6_transport_bind(netsnmp_transport *t,
-                                const struct sockaddr_in6 *addr, int flags);
+                                const struct netsnmp_ep *ep,
+                                int flags);
 
     void
     netsnmp_udp6_transport_get_bound_addr(netsnmp_transport *t);
@@ -79,7 +80,7 @@ int             netsnmp_udp6_getSecName(
  * "Constructor" for transport domain object.
  */
 
-NETSNMP_IMPORT void netsnmp_udpipv6_ctor(void);
+void netsnmp_udpipv6_ctor(void);
 
 #ifdef __cplusplus
 }
diff -urpN net-snmp-5.8/include/net-snmp/library/snmpUDPsharedDomain.h net-snmp-5.9.1/include/net-snmp/library/snmpUDPsharedDomain.h
--- net-snmp-5.8/include/net-snmp/library/snmpUDPsharedDomain.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmpUDPsharedDomain.h	2021-05-26 05:19:35.000000000 +0700
@@ -33,13 +33,13 @@ extern          "C" {
      */
     void            netsnmp_udpshared_ctor(void);
 
-    netsnmp_transport *netsnmp_udpshared_transport(const struct sockaddr_in *addr,
+    netsnmp_transport *netsnmp_udpshared_transport(const struct netsnmp_ep *ep,
                                                    int local);
 
     netsnmp_transport *
-    netsnmp_udpshared_transport_with_source(const struct sockaddr_in *addr,
+    netsnmp_udpshared_transport_with_source(const struct netsnmp_ep *ep,
                                             int local,
-                                            const struct sockaddr_in *src_addr);
+                                            const struct netsnmp_ep *src_addr);
 
 #ifdef __cplusplus
 }
diff -urpN net-snmp-5.8/include/net-snmp/library/snmp_alarm.h net-snmp-5.9.1/include/net-snmp/library/snmp_alarm.h
--- net-snmp-5.8/include/net-snmp/library/snmp_alarm.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmp_alarm.h	2021-05-26 05:19:35.000000000 +0700
@@ -1,6 +1,20 @@
 #ifndef SNMP_ALARM_H
 #define SNMP_ALARM_H
 
+/*
+ * For 'timeval'
+ */
+#if TIME_WITH_SYS_TIME
+# include <sys/time.h>
+# include <time.h>
+#else
+# if HAVE_SYS_TIME_H
+#  include <sys/time.h>
+# else
+#  include <time.h>
+# endif
+#endif
+
 #ifdef __cplusplus
 extern          "C" {
 #endif
diff -urpN net-snmp-5.8/include/net-snmp/library/snmp_api.h net-snmp-5.9.1/include/net-snmp/library/snmp_api.h
--- net-snmp-5.8/include/net-snmp/library/snmp_api.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmp_api.h	2021-05-26 05:19:35.000000000 +0700
@@ -384,11 +384,17 @@ typedef struct request_list {
     NETSNMP_IMPORT
     void            init_snmp(const char *);
 
+    NETSNMP_IMPORT
     int
     snmp_build(u_char ** pkt, size_t * pkt_len, size_t * offset,
                netsnmp_session * pss, netsnmp_pdu *pdu);
 
     NETSNMP_IMPORT
+    int
+    snmp_parse(struct session_list *sessp, netsnmp_session *pss,
+               netsnmp_pdu *pdu, u_char *data, size_t length);
+
+    NETSNMP_IMPORT
     u_char         *snmp_pdu_build(netsnmp_pdu *, u_char *, size_t *);
 #ifdef NETSNMP_USE_REVERSE_ASNENCODING
     NETSNMP_IMPORT
@@ -454,7 +460,7 @@ typedef struct request_list {
     NETSNMP_IMPORT
     int             create_user_from_session(netsnmp_session * session);
     NETSNMP_IMPORT
-    int snmpv3_probe_contextEngineID_rfc5343(void *slp,
+    int snmpv3_probe_contextEngineID_rfc5343(struct session_list *slp,
                                              netsnmp_session *session);
 
     /*
diff -urpN net-snmp-5.8/include/net-snmp/library/snmp_logging.h net-snmp-5.9.1/include/net-snmp/library/snmp_logging.h
--- net-snmp-5.8/include/net-snmp/library/snmp_logging.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmp_logging.h	2021-05-26 05:19:35.000000000 +0700
@@ -83,8 +83,9 @@ extern          "C" {
     char *snmp_log_syslogname(const char *syslogname);
     typedef struct netsnmp_log_handler_s netsnmp_log_handler; 
     typedef int (NetsnmpLogHandler)(netsnmp_log_handler*, int, const char *);
-
+#ifndef NETSNMP_FEATURE_REMOVE_LOGGING_STDIO
     NetsnmpLogHandler log_handler_stdouterr;
+#endif /* NETSNMP_FEATURE_REMOVE_LOGGING_STDIO */
     NetsnmpLogHandler log_handler_file;
     NetsnmpLogHandler log_handler_syslog;
     NetsnmpLogHandler log_handler_callback;
diff -urpN net-snmp-5.8/include/net-snmp/library/snmp_secmod.h net-snmp-5.9.1/include/net-snmp/library/snmp_secmod.h
--- net-snmp-5.8/include/net-snmp/library/snmp_secmod.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmp_secmod.h	2021-05-26 05:19:35.000000000 +0700
@@ -86,13 +86,15 @@ typedef int     (Secmod2PduCallback) (ne
 typedef int     (SecmodOutMsg) (struct snmp_secmod_outgoing_params *);
 typedef int     (SecmodInMsg) (struct snmp_secmod_incoming_params *);
 typedef void    (SecmodFreeState) (void *);
-typedef void    (SecmodHandleReport) (void *sessp,
+typedef void    (SecmodHandleReport) (struct session_list *slp,
                                       netsnmp_transport *transport,
                                       netsnmp_session *,
                                       int result,
                                       netsnmp_pdu *origpdu);
-typedef int     (SecmodDiscoveryMethod) (void *slp, netsnmp_session *session);
-typedef int     (SecmodPostDiscovery) (void *slp, netsnmp_session *session);
+typedef int     (SecmodDiscoveryMethod) (struct session_list *slp,
+                                         netsnmp_session *session);
+typedef int     (SecmodPostDiscovery) (struct session_list *slp,
+                                       netsnmp_session *session);
 
 typedef int     (SecmodSessionSetup) (netsnmp_session *in_session,
                                       netsnmp_session *out_session);
diff -urpN net-snmp-5.8/include/net-snmp/library/snmp_transport.h net-snmp-5.9.1/include/net-snmp/library/snmp_transport.h
--- net-snmp-5.8/include/net-snmp/library/snmp_transport.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmp_transport.h	2021-05-26 05:19:35.000000000 +0700
@@ -114,8 +114,7 @@ typedef struct netsnmp_tmStateReference_
 } netsnmp_tmStateReference;
 
 #define NETSNMP_TSPEC_LOCAL                     0x01 /* 1=server, 0=client */
-#define NETSNMP_TSPEC_SHARED                    0x02
-#define NETSNMP_TSPEC_NO_DFTL_CLIENT_ADDR       0x04
+#define NETSNMP_TSPEC_PREBOUND                  0x02 /* 1=bound by systemd, 0=needs bind in the library */
 
 struct netsnmp_container_s; /* forward decl */
 typedef struct netsnmp_tdomain_spec_s {
@@ -255,6 +254,7 @@ void shutdown_snmp_transport(void);
 
 /*  Some utility functions.  */
 
+NETSNMP_IMPORT
 char *netsnmp_transport_peer_string(netsnmp_transport *t, const void *data,
                                     int len);
 
@@ -267,6 +267,7 @@ int netsnmp_transport_add_to_list(netsnm
 				  netsnmp_transport *transport);
 int netsnmp_transport_remove_from_list(netsnmp_transport_list **transport_list,
 				       netsnmp_transport *transport);
+NETSNMP_IMPORT
 int netsnmp_sockaddr_size(const struct sockaddr *sa);
 
 
@@ -364,8 +365,8 @@ NETSNMP_IMPORT
 int netsnmp_transport_config_compare(netsnmp_transport_config *left,
                                      netsnmp_transport_config *right);
 NETSNMP_IMPORT
-netsnmp_transport_config *netsnmp_transport_create_config(char *key,
-                                                          char *value);
+netsnmp_transport_config *netsnmp_transport_create_config(const char *key,
+                                                          const char *value);
 
 #ifndef NETSNMP_FEATURE_REMOVE_FILTER_SOURCE
 NETSNMP_IMPORT
diff -urpN net-snmp-5.8/include/net-snmp/library/snmpusm.h net-snmp-5.9.1/include/net-snmp/library/snmpusm.h
--- net-snmp-5.8/include/net-snmp/library/snmpusm.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/snmpusm.h	2021-05-26 05:19:35.000000000 +0700
@@ -42,22 +42,7 @@ extern          "C" {
     /*
      * Structures.
      */
-    struct usmStateReference {
-        char           *usr_name;
-        size_t          usr_name_length;
-        u_char         *usr_engine_id;
-        size_t          usr_engine_id_length;
-        oid            *usr_auth_protocol;
-        size_t          usr_auth_protocol_length;
-        u_char         *usr_auth_key;
-        size_t          usr_auth_key_length;
-        oid            *usr_priv_protocol;
-        size_t          usr_priv_protocol_length;
-        u_char         *usr_priv_key;
-        size_t          usr_priv_key_length;
-        u_int           usr_sec_level;
-    };
-
+    struct usmStateReference;
 
     /*
      * struct usmUser: a structure to represent a given user in a list 
@@ -105,189 +90,42 @@ extern          "C" {
     /*
      * Prototypes.
      */
-    struct usmStateReference *usm_malloc_usmStateReference(void);
-
-    void            usm_free_usmStateReference(void *old);
-
-    int             usm_set_usmStateReference_name(struct usmStateReference
-                                                   *ref, char *name,
-                                                   size_t name_len);
-
-    int             usm_set_usmStateReference_engine_id(struct
-                                                        usmStateReference
-                                                        *ref,
-                                                        u_char * engine_id,
-                                                        size_t
-                                                        engine_id_len);
-
-    int             usm_set_usmStateReference_auth_protocol(struct
-                                                            usmStateReference
-                                                            *ref,
-                                                            oid *
-                                                            auth_protocol,
-                                                            size_t
-                                                            auth_protocol_len);
-
-    int             usm_set_usmStateReference_auth_key(struct
-                                                       usmStateReference
-                                                       *ref,
-                                                       u_char * auth_key,
-                                                       size_t
-                                                       auth_key_len);
-
-    int             usm_set_usmStateReference_priv_protocol(struct
-                                                            usmStateReference
-                                                            *ref,
-                                                            oid *
-                                                            priv_protocol,
-                                                            size_t
-                                                            priv_protocol_len);
-
-    int             usm_set_usmStateReference_priv_key(struct
-                                                       usmStateReference
-                                                       *ref,
-                                                       u_char * priv_key,
-                                                       size_t
-                                                       priv_key_len);
-
-    int             usm_set_usmStateReference_sec_level(struct
-                                                        usmStateReference
-                                                        *ref,
-                                                        int sec_level);
-    int             usm_clone_usmStateReference(struct usmStateReference *from,
-                                                    struct usmStateReference **to);
-
-
-#ifdef NETSNMP_ENABLE_TESTING_CODE
-    void            emergency_print(u_char * field, u_int length);
-#endif
-
-    int             asn_predict_int_length(int type, long number,
-                                           size_t len);
-
-    int             asn_predict_length(int type, u_char * ptr,
-                                       size_t u_char_len);
-
-    int             usm_set_salt(u_char * iv,
-                                 size_t * iv_length,
-                                 u_char * priv_salt,
-                                 size_t priv_salt_length,
-                                 u_char * msgSalt);
-
     NETSNMP_IMPORT
     int             usm_extend_user_kul(struct usmUser *user,
                                         u_int privKeyBufSize);
-
-    int             usm_parse_security_parameters(u_char * secParams,
-                                                  size_t remaining,
-                                                  u_char * secEngineID,
-                                                  size_t * secEngineIDLen,
-                                                  u_int * boots_uint,
-                                                  u_int * time_uint,
-                                                  char *secName,
-                                                  size_t * secNameLen,
-                                                  u_char * signature,
-                                                  size_t *
-                                                  signature_length,
-                                                  u_char * salt,
-                                                  size_t * salt_length,
-                                                  u_char ** data_ptr);
-
-    int             usm_check_and_update_timeliness(u_char * secEngineID,
-                                                    size_t secEngineIDLen,
-                                                    u_int boots_uint,
-                                                    u_int time_uint,
-                                                    int *error);
-
-    SecmodSessionCallback usm_open_session;
-    SecmodOutMsg    usm_secmod_generate_out_msg;
-    SecmodOutMsg    usm_secmod_generate_out_msg;
-    SecmodInMsg     usm_secmod_process_in_msg;
-    int             usm_generate_out_msg(int, u_char *, size_t, int, int,
-                                         u_char *, size_t, char *, size_t,
-                                         int, u_char *, size_t, void *,
-                                         u_char *, size_t *, u_char **,
-                                         size_t *);
-    int             usm_rgenerate_out_msg(int, u_char *, size_t, int, int,
-                                          u_char *, size_t, char *, size_t,
-                                          int, u_char *, size_t, void *,
-                                          u_char **, size_t *, size_t *);
-
-    int             usm_process_in_msg(int, size_t, u_char *, int, int,
-                                       u_char *, size_t, u_char *,
-                                       size_t *, char *, size_t *,
-                                       u_char **, size_t *, size_t *,
-                                       void **, netsnmp_session *, u_char);
-
-    int             usm_check_secLevel(int level, struct usmUser *user);
     NETSNMP_IMPORT
     struct usmUser *usm_get_userList(void);
     NETSNMP_IMPORT
-    struct usmUser *usm_get_user(u_char * engineID, size_t engineIDLen,
-                                 char *name);
-    struct usmUser *usm_get_user_from_list(u_char * engineID,
-                                           size_t engineIDLen, char *name,
-                                           struct usmUser *userList,
-                                           int use_default);
+    struct usmUser *usm_get_user(const u_char *engineID, size_t engineIDLen,
+                                 const char *name);
     NETSNMP_IMPORT
     struct usmUser *usm_add_user(struct usmUser *user);
-    struct usmUser *usm_add_user_to_list(struct usmUser *user,
-                                         struct usmUser *userList);
     NETSNMP_IMPORT
     struct usmUser *usm_free_user(struct usmUser *user);
     NETSNMP_IMPORT
     struct usmUser *usm_create_user(void);
     NETSNMP_IMPORT
-    struct usmUser *usm_create_initial_user(const char *name,
-                                            const oid * authProtocol,
-                                            size_t authProtocolLen,
-                                            const oid * privProtocol,
-                                            size_t privProtocolLen);
-    NETSNMP_IMPORT
     struct usmUser *usm_cloneFrom_user(struct usmUser *from,
                                        struct usmUser *to);
     NETSNMP_IMPORT
     struct usmUser *usm_remove_user(struct usmUser *user);
-    struct usmUser *usm_remove_user_from_list(struct usmUser *user,
-                                              struct usmUser **userList);
-    char           *get_objid(char *line, oid ** optr, size_t * len);
-    NETSNMP_IMPORT
-    void            usm_save_users(const char *token, const char *type);
-    void            usm_save_users_from_list(struct usmUser *user,
-                                             const char *token,
-                                             const char *type);
-    void            usm_save_user(struct usmUser *user, const char *token,
-                                  const char *type);
-    NETSNMP_IMPORT
-    SNMPCallback    usm_store_users;
-    struct usmUser *usm_read_user(const char *line);
     NETSNMP_IMPORT
     void            usm_parse_config_usmUser(const char *token,
                                              char *line);
-
-    void            usm_set_password(const char *token, char *line);
     NETSNMP_IMPORT
     void            usm_set_user_password(struct usmUser *user,
                                           const char *token, char *line);
     void            init_usm(void);
     NETSNMP_IMPORT
     void            init_usm_conf(const char *app);
-    int             init_usm_post_config(int majorid, int minorid,
-                                         void *serverarg, void *clientarg);
-    int             deinit_usm_post_config(int majorid, int minorid, void *serverarg,
-					   void *clientarg);
-    NETSNMP_IMPORT
-    void            clear_user_list(void);
     NETSNMP_IMPORT
     void            shutdown_usm(void);
-
     NETSNMP_IMPORT
     int             usm_lookup_auth_type(const char *str);
     NETSNMP_IMPORT
     const char     *usm_lookup_auth_str(int value);
     NETSNMP_IMPORT
     oid            *usm_get_auth_oid(int auth_type, size_t *oid_len);
-
     NETSNMP_IMPORT
     int             usm_lookup_priv_type(const char *str);
     NETSNMP_IMPORT
@@ -339,26 +177,8 @@ extern          "C" {
      | USM_AES_REEDER_FLAG)
 
 
-    struct usmUser *usm_create_usmUser(const char *userName,
-                                       const char *engineID, u_int flags,
-                                       int authType, const char *authPass,
-                                       int privType, const char *privPass,
-                                       const char **errorMsg);
-
-    NETSNMP_IMPORT
-    int             usm_remove_usmUser(struct usmUser *user);
-
-    NETSNMP_IMPORT
-    int             usm_remove_usmUser_from_list(struct usmUser *user,
-                                                 struct usmUser **ppuserList);
-
-    NETSNMP_IMPORT
-    struct usmUser *usm_create_usmUser_from_string(char *line,
-                                                   const char **errorMsg);
-
     NETSNMP_IMPORT
     int             usm_create_user_from_session(netsnmp_session * session);
-    SecmodPostDiscovery usm_create_user_from_session_hook;
     NETSNMP_IMPORT
     void            usm_parse_create_usmUser(const char *token,
                                              char *line);
@@ -366,8 +186,6 @@ extern          "C" {
     const oid      *get_default_authtype(size_t *);
     NETSNMP_IMPORT
     const oid      *get_default_privtype(size_t *);
-    void            snmpv3_authtype_conf(const char *word, char *cptr);
-    void            snmpv3_privtype_conf(const char *word, char *cptr);
 
 #ifdef __cplusplus
 }
diff -urpN net-snmp-5.8/include/net-snmp/library/system.h net-snmp-5.9.1/include/net-snmp/library/system.h
--- net-snmp-5.8/include/net-snmp/library/system.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/system.h	2021-05-26 05:19:35.000000000 +0700
@@ -43,6 +43,9 @@ SOFTWARE.
  */
 
 
+    struct timeval;
+
+
     /*
      * function to create a daemon. Will fork and call setsid().
      *
@@ -97,18 +100,9 @@ SOFTWARE.
 
 #endif                         /* MSVC_PERL */
 
-/*
- * Note: when compiling Net-SNMP with dmalloc enabled on a system without
- * strcasecmp() or strncasecmp(), the macro HAVE_STRNCASECMP is
- * not defined but strcasecmp() and strncasecmp() are defined as macros in
- * <dmalloc.h>. In order to prevent a compilation error, do not declare
- * strcasecmp() or strncasecmp() when the <dmalloc.h> header has been included.
- */
-#if !defined(HAVE_STRNCASECMP) && !defined(strcasecmp)
+#if !defined(HAVE_STRNCASECMP) && !defined(strncasecmp)
     NETSNMP_IMPORT
     int             strcasecmp(const char *s1, const char *s2);
-#endif
-#if !defined(HAVE_STRNCASECMP) && !defined(strncasecmp)
     NETSNMP_IMPORT
     int             strncasecmp(const char *s1, const char *s2, size_t n);
 #endif
@@ -126,6 +120,9 @@ SOFTWARE.
 #endif                          /* WIN32 */
 
 #include <net-snmp/types.h>     /* For definition of in_addr_t */
+#if HAVE_NETINET_IN_H
+#include <netinet/in.h>
+#endif
 
     /* Simply resolve a hostname and return first IPv4 address.
      * Returns -1 on error */
diff -urpN net-snmp-5.8/include/net-snmp/library/tools.h net-snmp-5.9.1/include/net-snmp/library/tools.h
--- net-snmp-5.8/include/net-snmp/library/tools.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/tools.h	2021-05-26 05:19:35.000000000 +0700
@@ -13,10 +13,6 @@
 #ifndef _TOOLS_H
 #define _TOOLS_H
 
-#ifdef HAVE_INTTYPES_H
-#include <inttypes.h> /* uintptr_t */
-#endif
-
 #ifdef __cplusplus
 extern          "C" {
 #endif
@@ -92,9 +88,9 @@ extern          "C" {
  */
 #if defined(__GNUC__)
 #define NETSNMP_REMOVE_CONST(t, e)                                      \
-    (__extension__ ({ const t tmp = (e); (t)(uintptr_t)tmp; }))
+    (__extension__ ({ const t tmp = (e); (t)(size_t)tmp; }))
 #else
-#define NETSNMP_REMOVE_CONST(t, e) ((t)(uintptr_t)(e))
+#define NETSNMP_REMOVE_CONST(t, e) ((t)(size_t)(e))
 #endif
 
 
@@ -132,6 +128,8 @@ extern          "C" {
 #define TRUE  1
 #endif
 
+#define NETSNMP_IGNORE_RESULT(e) do { if (e) { } } while (0)
+
     /*
      * QUIT the FUNction:
      *      e       Error code variable
@@ -155,15 +153,14 @@ extern          "C" {
  * @note res may be the same variable as one of the operands. In other
  *   words, &a == &res || &b == &res may hold.
  */
-#define NETSNMP_TIMERADD(a, b, res)                  \
-{                                                    \
+#define NETSNMP_TIMERADD(a, b, res) do {             \
     (res)->tv_sec  = (a)->tv_sec  + (b)->tv_sec;     \
     (res)->tv_usec = (a)->tv_usec + (b)->tv_usec;    \
     if ((res)->tv_usec >= 1000000L) {                \
         (res)->tv_usec -= 1000000L;                  \
         (res)->tv_sec++;                             \
     }                                                \
-}
+} while (0)
 
 /**
  * Compute res = a - b.
@@ -173,20 +170,20 @@ extern          "C" {
  * @note res may be the same variable as one of the operands. In other
  *   words, &a == &res || &b == &res may hold.
  */
-#define NETSNMP_TIMERSUB(a, b, res)                             \
-{                                                               \
+#define NETSNMP_TIMERSUB(a, b, res) do {                        \
     (res)->tv_sec  = (a)->tv_sec  - (b)->tv_sec - 1;            \
     (res)->tv_usec = (a)->tv_usec - (b)->tv_usec + 1000000L;    \
     if ((res)->tv_usec >= 1000000L) {                           \
         (res)->tv_usec -= 1000000L;                             \
         (res)->tv_sec++;                                        \
     }                                                           \
-}
+} while (0)
 
 #define ENGINETIME_MAX	2147483647      /* ((2^31)-1) */
 #define ENGINEBOOT_MAX	2147483647      /* ((2^31)-1) */
 
 
+    struct timeval;
 
 
     /*
diff -urpN net-snmp-5.8/include/net-snmp/library/winservice.h net-snmp-5.9.1/include/net-snmp/library/winservice.h
--- net-snmp-5.8/include/net-snmp/library/winservice.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/library/winservice.h	2021-05-26 05:19:35.000000000 +0700
@@ -1,159 +1,70 @@
 #ifndef WINSERVICE_H
 #define WINSERVICE_H
 
-    /*
-     * 
-     * Windows Service related functions declaration
-     * By Raju Krishanppa(raju_krishnappa@yahoo.com)
-     *
-     */
+/* Windows Service related function declarations. */
 
 #ifdef __cplusplus
-extern "C"
-{
-
-#endif				/*  */
+extern          "C" {
+#elif 0
+}
+#endif                          /*  */
 
-  /*
-   * Define Constants for Register, De-register , Run As service or Console mode
-   */
-#define REGISTER_SERVICE 0
-#define UN_REGISTER_SERVICE 1
-#define RUN_AS_SERVICE 2
-#define RUN_AS_CONSOLE 3
-
-
-  /*
-   * Error levels returned when registering or unregistering the service
-  */
-#define SERVICE_ERROR_NONE 0            
-#define SERVICE_ERROR_SCM_OPEN 1                /* Can not open SCM */
-#define SERVICE_ERROR_CREATE_SERVICE 2          /* Can not create service */
-#define SERVICE_ERROR_CREATE_REGISTRY_ENTRIES 3 /* Can not create registry entries */
-#define SERVICE_ERROR_OPEN_SERVICE 4            /* Can not open service (service does not exist) */
- 
-  /*
-   * Define Message catalog ID
-   * MessageId: DISPLAY_MSG
-   * MessageText:  %1.
-   */
-#define DISPLAY_MSG                      0x00000064L
-
-  /*
-   * Hint Value to SCM to wait before sending successive commands to service
-   */
-#define SCM_WAIT_INTERVAL 7000
-
-  /*
-   * Define Generic String Size, to hold Error or Information
-   */
-#define MAX_STR_SIZE  1024
-
-  /*
-   * Delcare Global variables, which are visible to other modules 
-   */
-  extern BOOL g_fRunningAsService;
-
-  /*
-   * Input parameter structure to thread 
-   */
-  typedef struct _InputParams
-  {
-    DWORD Argc;
-    LPTSTR *Argv;
-  } InputParams;
-
-  /*
-   * Define Service Related functions
-   */
-
-  /*
-   * To register application as windows service with SCM 
-   */
-  int RegisterService (LPCTSTR lpszServiceName,
-			LPCTSTR lpszServiceDisplayName,
-			LPCTSTR lpszServiceDescription, InputParams * StartUpArg, int quiet);
-
-  /*
-   * To unregister service 
-   */
-  int UnregisterService (LPCTSTR lpszServiceName, int quiet);
-
-  /*
-   * To parse command line for startup option 
-   */
-  INT ParseCmdLineForServiceOption (INT argc, TCHAR * argv[], int *quiet);
-
-  /*
-   * To write to windows event log 
-   */
-  VOID WriteToEventLog (WORD wType, LPCTSTR pszFormat, ...);
-
-  /*
-   * To display generic windows error 
-   */
-  VOID DisplayError (LPCTSTR pszTitle, int quite);
-
-  /*
-   * Service Main function,  Which will spawn a thread, and calls the
-   * Service run part
-   */
-  VOID WINAPI ServiceMain (DWORD argc, LPTSTR argv[]);
-
-  /*
-   * To start Service 
-   */
-
-  BOOL RunAsService (INT (*ServiceFunction) (INT, LPTSTR *));
-
-  /*
-   * Call back function to process SCM Requests 
-   */
-  VOID WINAPI ControlHandler (DWORD dwControl);
-
-  /*
-   * To Stop the service 
-   */
-  VOID ProcessServiceStop (VOID);
-
-  /*
-   * To Pause service 
-   */
-  VOID ProcessServicePause (VOID);
-
-  /*
-   * To Continue paused service 
-   */
-  VOID ProcessServiceContinue (VOID);
-
-  /*
-   * To send Current Service status to SCM when INTERROGATE command is sent 
-   */
-  VOID ProcessServiceInterrogate (VOID);
-
-  /*
-   * To allocate and Set security descriptor 
-   */
-  BOOL SetSimpleSecurityAttributes (SECURITY_ATTRIBUTES * pSecurityAttr);
-
-  /*
-   * To free Security Descriptor 
-   */
-  VOID FreeSecurityAttributes (SECURITY_ATTRIBUTES * pSecurityAttr);
-
-  /*
-   * TheadFunction - To spawan as thread - Invokes registered service function 
-   */
-  unsigned WINAPI ThreadFunction (LPVOID lpParam);
-
-  /*
-   * Service STOP function registration with this framewrok
-   * * this function must be invoked before calling RunAsService
-   */
-  VOID RegisterStopFunction (VOID (*StopFunc) (VOID));
+/*
+ * Define Constants for Register, De-register , Run As service or Console mode
+ */
+enum net_snmp_cmd_line_action {
+    REGISTER_SERVICE = 0,
+    UN_REGISTER_SERVICE = 1,
+    RUN_AS_SERVICE = 2,
+    RUN_AS_CONSOLE = 3,
+};
+
+/*
+ * Input parameter structure to thread
+ */
+typedef struct _InputParams {
+    DWORD           Argc;
+    char          **Argv;
+} InputParams;
+
+/*
+ * Define Service Related functions
+ */
+
+/*
+ * To register application as windows service with SCM
+ */
+int             RegisterService(const char *lpszServiceName,
+                                const char *lpszServiceDisplayName,
+                                const char *lpszServiceDescription,
+                                InputParams *StartUpArg, int quiet);
+
+/*
+ * To unregister service
+ */
+int             UnregisterService(const char *lpszServiceName, int quiet);
+
+/*
+ * To parse command line for startup option
+ */
+enum net_snmp_cmd_line_action
+                ParseCmdLineForServiceOption(int argc, char *argv[],
+                                             int *quiet);
+
+/*
+ * To start Service
+ */
+BOOL            RunAsService(int (*ServiceFunction)(int, char **));
+
+/*
+ * Service STOP function registration with this framewrok
+ * * this function must be invoked before calling RunAsService
+ */
+void            RegisterStopFunction(void (*StopFunc)(void));
 
-#ifdef __cplusplus
+#if 0
+{
+#elif defined(__cplusplus)
 }
-#endif				/*  */
-#endif				/* WINSERVICE_H */
-
+#endif                          /*  */
+#endif                          /* WINSERVICE_H */
diff -urpN net-snmp-5.8/include/net-snmp/net-snmp-config.h.in net-snmp-5.9.1/include/net-snmp/net-snmp-config.h.in
--- net-snmp-5.8/include/net-snmp/net-snmp-config.h.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/net-snmp-config.h.in	2021-05-26 05:19:35.000000000 +0700
@@ -54,9 +54,6 @@
 
 #define config_parse_dot_conf(w,x,y,z)
 
-/* Define if building universal (internal helper macro) */
-#undef AC_APPLE_UNIVERSAL_BUILD
-
 /* Define to one of `_getb67', `GETB67', `getb67' for Cray-2 and Cray-YMP
    systems. This function is required for `alloca.c' support on those systems.
    */
@@ -126,13 +123,24 @@
 /* Define to 1 if the system has the type `Counter64'. */
 #undef HAVE_COUNTER64
 
+/* Define to 1 if you have the <crt_externs.h> header file. */
+#undef HAVE_CRT_EXTERNS_H
+
 /* Define to 1 if you have the <curses.h> header file. */
 #undef HAVE_CURSES_H
 
+/* Define to 1 if you have the declaration of `daylight', and to 0 if you
+   don't. */
+#undef HAVE_DECL_DAYLIGHT
+
 /* Define to 1 if you have the declaration of `sensors_get_all_subfeatures',
    and to 0 if you don't. */
 #undef HAVE_DECL_SENSORS_GET_ALL_SUBFEATURES
 
+/* Define to 1 if you have the declaration of `timezone', and to 0 if you
+   don't. */
+#undef HAVE_DECL_TIMEZONE
+
 /* define to 1 if you have IRE_CACHE defined in <inet/ip.h> header file. */
 #undef HAVE_DEFINED_IRE_CACHE
 
@@ -158,9 +166,6 @@
 /* Define to 1 if you have the `dlopen' function. */
 #undef HAVE_DLOPEN
 
-/* Define to 1 if you have the <dmalloc.h> header file. */
-#undef HAVE_DMALLOC_H
-
 /* Set if the dpkg-query command is available */
 #undef HAVE_DPKG_QUERY
 
@@ -170,6 +175,12 @@
 /* Define to 1 if you have the `DTLS_method' function. */
 #undef HAVE_DTLS_METHOD
 
+/* Define to 1 if you have the `endfsent' function. */
+#undef HAVE_ENDFSENT
+
+/* Define to 1 if you have the `ERR_get_error_all' function. */
+#undef HAVE_ERR_GET_ERROR_ALL
+
 /* Define to 1 if you have the <err.h> header file. */
 #undef HAVE_ERR_H
 
@@ -191,10 +202,10 @@
 /* Define to 1 if you have the `EVP_MD_CTX_new' function. */
 #undef HAVE_EVP_MD_CTX_NEW
 
-/* Define if you have EVP_sha224/256 in openssl */
+/* Define to 1 if you have the `EVP_sha224' function. */
 #undef HAVE_EVP_SHA224
 
-/* Define if you have EVP_sha384/512 in openssl */
+/* Define to 1 if you have the `EVP_sha384' function. */
 #undef HAVE_EVP_SHA384
 
 /* Define to 1 if you have the `execv' function. */
@@ -236,6 +247,9 @@
 /* Define to 1 if you have the `getdtablesize' function. */
 #undef HAVE_GETDTABLESIZE
 
+/* Define to 1 if you have the `getfsent' function. */
+#undef HAVE_GETFSENT
+
 /* Define to 1 if you have the `getfsstat' function. */
 #undef HAVE_GETFSSTAT
 
@@ -260,9 +274,15 @@
 /* Define to 1 if you have the `getloadavg' function. */
 #undef HAVE_GETLOADAVG
 
+/* Define to 1 if you have the `getlogin' function. */
+#undef HAVE_GETLOGIN
+
 /* Define to 1 if you have the `getmntent' function. */
 #undef HAVE_GETMNTENT
 
+/* Define to 1 if you have the `getmntinfo' function. */
+#undef HAVE_GETMNTINFO
+
 /* Define to 1 if you have the `getopt' function. */
 #undef HAVE_GETOPT
 
@@ -353,9 +373,6 @@
 /* Define to 1 if you have the `kinfo_get_cpus' function. */
 #undef HAVE_KINFO_GET_CPUS
 
-/* Define if you have /dev/kmem */
-#undef HAVE_KMEM
-
 /* Define to 1 if you have the `knlist' function. */
 #undef HAVE_KNLIST
 
@@ -365,6 +382,9 @@
 /* Define to 1 if you have the `krb5_auth_con_getsendsubkey' function. */
 #undef HAVE_KRB5_AUTH_CON_GETSENDSUBKEY
 
+/* Define to 1 if `enctype' is a member of `krb5_keyblock'. */
+#undef HAVE_KRB5_KEYBLOCK_ENCTYPE
+
 /* Define to 1 if you have the <kstat.h> header file. */
 #undef HAVE_KSTAT_H
 
@@ -462,7 +482,10 @@
 /* Define to 1 if you have the <linux/tasks.h> header file. */
 #undef HAVE_LINUX_TASKS_H
 
-/* Define if load_defaults() is available in libmysqlclient */
+/* Define to 1 if you have the <lm.h> header file. */
+#undef HAVE_LM_H
+
+/* Define to 1 if you have the `load_defaults' function. */
 #undef HAVE_LOAD_DEFAULTS
 
 /* Define to 1 if you have the <locale.h> header file. */
@@ -492,6 +515,9 @@
 /* Define to 1 if you have the <machine/types.h> header file. */
 #undef HAVE_MACHINE_TYPES_H
 
+/* Define to 1 if you have the <mach-o/dyld.h> header file. */
+#undef HAVE_MACH_O_DYLD_H
+
 /* Define to 1 if you have the <malloc.h> header file. */
 #undef HAVE_MALLOC_H
 
@@ -501,6 +527,9 @@
 /* Define to 1 if the system has the type `mib2_ipIfStatsEntry_t'. */
 #undef HAVE_MIB2_IPIFSTATSENTRY_T
 
+/* Define if MIB_IF_TABLE2 is available */
+#undef HAVE_MIB_IF_TABLE2
+
 /* Define to 1 if you have the `mkstemp' function. */
 #undef HAVE_MKSTEMP
 
@@ -513,15 +542,24 @@
 /* Define to 1 if you have the <mtab.h> header file. */
 #undef HAVE_MTAB_H
 
-/* Define if mysql_init() is available in libmysqlclient */
+/* Define to 1 if you have the `mysql_init' function. */
 #undef HAVE_MYSQL_INIT
 
+/* Define to 1 if you have the `mysql_options' function. */
+#undef HAVE_MYSQL_OPTIONS
+
+/* Define to 1 if you have the <my_global.h> header file. */
+#undef HAVE_MY_GLOBAL_H
+
 /* Define if MY_INIT() is availabe in libmysqlclient */
 #undef HAVE_MY_INIT
 
 /* Define if having my_load_defaults() */
 #undef HAVE_MY_LOAD_DEFAULTS
 
+/* Define to 1 if you have the <my_sys.h> header file. */
+#undef HAVE_MY_SYS_H
+
 /* Define to 1 if you have the <nbutil.h> header file. */
 #undef HAVE_NBUTIL_H
 
@@ -714,6 +752,9 @@
 /* Define to 1 if you have the `poll' function. */
 #undef HAVE_POLL
 
+/* Define to 1 if you have the `posix_spawn' function. */
+#undef HAVE_POSIX_SPAWN
+
 /* Define to 1 if you have the `pread64' function. */
 #undef HAVE_PREAD64
 
@@ -723,6 +764,9 @@
 /* Define if prioritynames variable is declared in <syslog.h> */
 #undef HAVE_PRIORITYNAMES
 
+/* Define to 1 if you have the <process.h> header file. */
+#undef HAVE_PROCESS_H
+
 /* Define to 1 if you have the <pthread.h> header file. */
 #undef HAVE_PTHREAD_H
 
@@ -759,6 +803,9 @@
 /* Define to 1 if you have the <rpm/rpmts.h> header file. */
 #undef HAVE_RPM_RPMTS_H
 
+/* Define if timezone declared as a scalar in <time.h> */
+#undef HAVE_SCALAR_TIMEZONE
+
 /* Define to 1 if you have the <search.h> header file. */
 #undef HAVE_SEARCH_H
 
@@ -774,6 +821,9 @@
 /* Define to 1 if you have the `setenv' function. */
 #undef HAVE_SETENV
 
+/* Define to 1 if you have the `setfsent' function. */
+#undef HAVE_SETFSENT
+
 /* Define to 1 if you have the `setgid' function. */
 #undef HAVE_SETGID
 
@@ -807,9 +857,6 @@
 /* Define to 1 if you have the `sigblock' function. */
 #undef HAVE_SIGBLOCK
 
-/* Define to 1 if you have the `sighold' function. */
-#undef HAVE_SIGHOLD
-
 /* Define if SIGHUP is defined in <signal.h>. */
 #undef HAVE_SIGHUP
 
@@ -831,6 +878,12 @@
 /* Define to 1 if the system has the type `socklen_t'. */
 #undef HAVE_SOCKLEN_T
 
+/* Define to 1 if SO_BINDTODEVICE is available */
+#undef HAVE_SO_BINDTODEVICE
+
+/* Define to 1 if you have the <spawn.h> header file. */
+#undef HAVE_SPAWN_H
+
 /* Define to 1 if you have the `srand' function. */
 #undef HAVE_SRAND
 
@@ -963,6 +1016,12 @@
 /* Define to 1 if `if_xname' is a member of `struct ifnet'. */
 #undef HAVE_STRUCT_IFNET_IF_XNAME
 
+/* Define to 1 if `ia_subnetmask' is a member of `struct in_ifaddr'. */
+#undef HAVE_STRUCT_IN_IFADDR_IA_SUBNETMASK
+
+/* Define to 1 if `ipi_spec_dst' is a member of `struct in_pktinfo'. */
+#undef HAVE_STRUCT_IN_PKTINFO_IPI_SPEC_DST
+
 /* Define to 1 if `ip6s_exthdrtoolong ' is a member of `struct ip6stat'. */
 #undef HAVE_STRUCT_IP6STAT_IP6S_EXTHDRTOOLONG_
 
@@ -1087,12 +1146,12 @@
 /* Define to 1 if `tz_dsttime' is a member of `struct timezone'. */
 #undef HAVE_STRUCT_TIMEZONE_TZ_DSTTIME
 
-/* Define to 1 if `tm_isdst' is a member of `struct time'. */
-#undef HAVE_STRUCT_TIME_TM_ISDST
-
 /* Define to 1 if `tm_gmtoff' is a member of `struct tm'. */
 #undef HAVE_STRUCT_TM_TM_GMTOFF
 
+/* Define to 1 if `tm_isdst' is a member of `struct tm'. */
+#undef HAVE_STRUCT_TM_TM_ISDST
+
 /* Define to 1 if `udps_discard' is a member of `struct udpstat'. */
 #undef HAVE_STRUCT_UDPSTAT_UDPS_DISCARD
 
@@ -1317,9 +1376,6 @@
 /* Define to 1 if you have the `times' function. */
 #undef HAVE_TIMES
 
-/* Define if a timezone variable is declared in <sys/time.h> */
-#undef HAVE_TIMEZONE_VARIABLE
-
 /* Define to 1 if you have the `TLSv1_method' function. */
 #undef HAVE_TLSV1_METHOD
 
@@ -1380,6 +1436,12 @@
 /* Define to 1 if you have the <validator/validator-config.h> header file. */
 #undef HAVE_VALIDATOR_VALIDATOR_CONFIG_H
 
+/* Define to 1 if you have the `vm_region' function. */
+#undef HAVE_VM_REGION
+
+/* Define to 1 if you have the `vm_region_64' function. */
+#undef HAVE_VM_REGION_64
+
 /* Define to 1 if you have the <vm/swap_pager.h> header file. */
 #undef HAVE_VM_SWAP_PAGER_H
 
@@ -1395,6 +1457,9 @@
 /* Define to 1 if you have the `vsnprintf' function. */
 #undef HAVE_VSNPRINTF
 
+/* Define to 1 if you have the `waitpid' function. */
+#undef HAVE_WAITPID
+
 /* Define to 1 if you have the <windows.h> header file. */
 #undef HAVE_WINDOWS_H
 
@@ -1419,14 +1484,34 @@
 /* Define to 1 if you have the <xti.h> header file. */
 #undef HAVE_XTI_H
 
+/* Define if _beginthreadex() is defined in <process.h> */
+#undef HAVE__BEGINTHREADEX
+
+/* Define if _cputs() is defined in <conio.h> */
+#undef HAVE__CPUTS
+
+/* Define if _getch() is defined in <conio.h> */
+#undef HAVE__GETCH
+
+/* Define if _get_osfhandle() is defined in <io.h> */
+#undef HAVE__GET_OSFHANDLE
+
+/* Define to 1 if you have the `_NSGetArgv' function. */
+#undef HAVE__NSGETARGV
+
+/* Define to 1 if you have the `_NSGetExecutablePath' function. */
+#undef HAVE__NSGETEXECUTABLEPATH
+
+/* Define if _open_osfhandle() is defined in <io.h> */
+#undef HAVE__OPEN_OSFHANDLE
+
 /* location of UNIX kernel */
 #undef KERNEL_LOC
 
 /* Path to the lpstat command */
 #undef LPSTAT_PATH
 
-/* Define to the sub-directory in which libtool stores uninstalled libraries.
-   */
+/* Define to the sub-directory where libtool stores uninstalled libraries. */
 #undef LT_OBJDIR
 
 /* define if agentx transport is to use domain sockets only */
@@ -1522,6 +1607,9 @@
 /* ifnet needs to have _KERNEL_STRUCTURES defined */
 #undef NETSNMP_IFNET_NEEDS_KERNEL_STRUCTURES
 
+/* Type of the third argument of ioctlsocket() */
+#undef NETSNMP_IOCTLSOCKET_ARG
+
 /* Define if you want to remove all non-essential code features. */
 #undef NETSNMP_MINIMAL_CODE
 
@@ -1553,9 +1641,6 @@
 /* umask permissions to set up persistent files with */
 #undef NETSNMP_PERSISTENT_MASK
 
-/* Size prefix to use to printf a uint32_t */
-#undef NETSNMP_PRI32
-
 /* Size prefix to use to printf a size_t or ssize_t */
 #undef NETSNMP_PRIz
 
@@ -1563,6 +1648,9 @@
    */
 #undef NETSNMP_REENTRANT
 
+/* Type of the fifth argument of select() */
+#undef NETSNMP_SELECT_TIMEVAL
+
 /* define if you do not want snmptrapd to register as an AgentX subagent */
 #undef NETSNMP_SNMPTRAPD_DISABLE_AGENTX
 
@@ -1707,18 +1795,6 @@
 #endif
 
 
-/* Define WORDS_BIGENDIAN to 1 if your processor stores words with the most
-   significant byte first (like Motorola and SPARC, unlike Intel). */
-#if defined AC_APPLE_UNIVERSAL_BUILD
-# if defined __BIG_ENDIAN__
-#  define WORDS_BIGENDIAN 1
-# endif
-#else
-# ifndef WORDS_BIGENDIAN
-#  undef WORDS_BIGENDIAN
-# endif
-#endif
-
 /* Define to 1 if on MINIX. */
 #undef _MINIX
 
@@ -1747,6 +1823,10 @@
 /* Define to empty if `const' does not conform to ANSI C. */
 #undef const
 
+/* in_addr_t definition if not defined in <netinet/in.h>. Must match the type
+   of sockaddr_in::sin_addr */
+#undef in_addr_t
+
 /* Define to `__inline__' or `__inline' if that's what the C compiler
    calls it, or to nothing if 'inline' is not supported under any name.  */
 #ifndef __cplusplus
@@ -1832,6 +1912,33 @@
 
 #endif /* NETSNMP_NO_AUTOCONF_DEFINITIONS */
 
+/*
+ * Note: GCC 4.6 added __BYTE_ORDER__, __ORDER_BIG_ENDIAN__,
+ * __ORDER_LITTLE_ENDIAN__ and __ORDER_PDP_ENDIAN__ in SVN r165881. For older
+ * gcc versions and also for other compilers, determine the endianness using
+ * an expression that can be evaluated at compile time. To do: add support for
+ * other compilers than gcc that do not support statement expressions.
+ */
+#if defined(__BYTE_ORDER__)
+# if __BYTE_ORDER__ == __ORDER_BIG_ENDIAN__
+#  define NETSNMP_BIGENDIAN 1
+# elif __BYTE_ORDER__ == __ORDER_LITTLE_ENDIAN__
+#  define NETSNMP_BIGENDIAN 0
+# else
+#  error Unknown byte order
+# endif
+#else
+# define NETSNMP_BIGENDIAN                              \
+    (__extension__                                      \
+     ({                                                 \
+         union { unsigned long l; unsigned char c; } u; \
+                                                        \
+         u.l = 1;                                       \
+         u.c == 0;                                      \
+     })                                                 \
+    )
+#endif
+
 
 
 
diff -urpN net-snmp-5.8/include/net-snmp/net-snmp-features.h net-snmp-5.9.1/include/net-snmp/net-snmp-features.h
--- net-snmp-5.8/include/net-snmp/net-snmp-features.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/net-snmp-features.h	2021-05-26 05:19:35.000000000 +0700
@@ -21,12 +21,12 @@
 
 /* prototypes always needed */
 #ifndef NETSNMP_FEATURE_CHECKING
-#define netsnmp_feature_provide(X)
-#define netsnmp_feature_require(X)
-#define netsnmp_feature_want(X)
-#define netsnmp_feature_child_of(X, Y)
+#define netsnmp_feature_provide(X)	extern char netsnmp_feature_unused_ ## X
+#define netsnmp_feature_require(X)	extern char netsnmp_feature_unused_ ## X
+#define netsnmp_feature_want(X)		extern char netsnmp_feature_unused_ ## X
+#define netsnmp_feature_child_of(X, Y)	extern char netsnmp_feature_unused_ ## X
 #endif
 
-#define netsnmp_feature_unused(X) char netsnmp_feature_unused_ ## X
+#define netsnmp_feature_unused(X)	extern char netsnmp_feature_unused_ ## X
 
 #endif /* NETSNMP_FEATURES_H */
diff -urpN net-snmp-5.8/include/net-snmp/net-snmp-includes.h net-snmp-5.9.1/include/net-snmp/net-snmp-includes.h
--- net-snmp-5.8/include/net-snmp/net-snmp-includes.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/net-snmp-includes.h	2021-05-26 05:19:35.000000000 +0700
@@ -8,15 +8,6 @@
      */
 
 
-    /*
-     *  Common system header requirements
-     */
-#include <stdio.h>
-#include <sys/types.h>
-#ifdef HAVE_STDINT_H
-#include <stdint.h>
-#endif
-
 #ifndef NET_SNMP_CONFIG_H
 #error "Please include <net-snmp/net-snmp-config.h> before this file"
 #endif
@@ -27,40 +18,6 @@
 #include <strings.h>
 #endif
 
-#if HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
-#if HAVE_UNISTD_H
-#include <unistd.h>
-#endif
-#if HAVE_NETINET_IN_H
-#include <netinet/in.h>
-#endif
-
-#if TIME_WITH_SYS_TIME
-# include <sys/time.h>
-# include <time.h>
-#else
-# if HAVE_SYS_TIME_H
-#  include <sys/time.h>
-# else
-#  include <time.h>
-# endif
-#endif
-
-/*
- * Must be right after system headers, but before library code for best usage 
- */
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
-  /*
-   * The check for missing 'in_addr_t' is handled
-   * within the main net-snmp-config.h file 
-   */
-
-
     /*
      *  The full Net-SNMP API
      */
diff -urpN net-snmp-5.8/include/net-snmp/session_api.h net-snmp-5.9.1/include/net-snmp/session_api.h
--- net-snmp-5.8/include/net-snmp/session_api.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/session_api.h	2021-05-26 05:19:35.000000000 +0700
@@ -24,6 +24,8 @@ extern          "C" {
 #endif
 
     struct session_list;
+    struct timeval;
+
 
     NETSNMP_IMPORT
     void            snmp_sess_init(netsnmp_session *);
diff -urpN net-snmp-5.8/include/net-snmp/system/aix.h net-snmp-5.9.1/include/net-snmp/system/aix.h
--- net-snmp-5.8/include/net-snmp/system/aix.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/aix.h	2021-05-26 05:19:35.000000000 +0700
@@ -19,3 +19,15 @@
 
 /* the legacy symbol NOACCESS clashes with the system headers. Remove it. */
 #define NETSNMP_NO_LEGACY_DEFINITIONS
+
+#ifdef _AIX43
+#define aix4
+#endif
+
+#ifdef _AIX51
+#define aix5
+#endif
+
+#ifdef _AIX61
+#define aix6
+#endif
diff -urpN net-snmp-5.8/include/net-snmp/system/cygwin.h net-snmp-5.9.1/include/net-snmp/system/cygwin.h
--- net-snmp-5.8/include/net-snmp/system/cygwin.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/cygwin.h	2021-05-26 05:19:35.000000000 +0700
@@ -1,12 +1 @@
-#include <net-snmp/system/generic.h>
-
-/* got socklen_t? */
-#define HAVE_SOCKLEN_T 1
-
-#ifdef HAVE_STDINT_H
-#include <stdint.h>	/* uint32_t */
-#endif
-
-#undef bsdlike
-#undef MBSTAT_SYMBOL
-#undef TOTAL_MEMORY_SYMBOL
+/* Everything that is specific to Cygwin is detected by the configure script */
diff -urpN net-snmp-5.8/include/net-snmp/system/darwin.h net-snmp-5.9.1/include/net-snmp/system/darwin.h
--- net-snmp-5.8/include/net-snmp/system/darwin.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/darwin.h	2021-05-26 05:19:35.000000000 +0700
@@ -1,8 +1,71 @@
 #include "freebsd4.h"
 #define darwin darwin
+
+#define CHECK_RT_FLAGS 1
+
+/*
+ * udp_inpcb list symbol, e.g. for mibII/udpTable.c
+ */
+#define INP_NEXT_SYMBOL inp_next
+
+/*
+ * Mac OS X should only use the modern API and definitions.
+ */
+#ifndef NETSNMP_NO_LEGACY_DEFINITIONS
+#define NETSNMP_NO_LEGACY_DEFINITIONS 1
+#endif
+
+/*
+ * use new host resources files as well
+ */
+#define NETSNMP_INCLUDE_HOST_RESOURCES
+#define NETSNMP_INCLUDE_HRSWINST_REWRITES
+#define NETSNMP_INCLUDE_HRSWRUN_REWRITES
+#undef NETSNMP_INCLUDE_HRSWRUN_WRITE_SUPPORT
+#define NETSNMP_CAN_GET_DISK_LABEL 1
+
+/*
+ * Enabling this restricts the compiler to mostly public APIs.
+ */
+#ifndef __APPLE_API_STRICT_CONFORMANCE
+#define __APPLE_API_STRICT_CONFORMANCE 1
+#endif
+#ifndef __APPLE_API_UNSTABLE
+#define __APPLE_API_UNSTABLE 1
+#endif
+
 /*
- * Although Darwin does have an fstab.h file, getfsfile etc. always return null.
+ * Although Darwin does have an fstab.h file, getfsfile etc. always return null
  * At least, as of 5.3.
  */
 #undef HAVE_FSTAB_H
 
+#define SWAPFILE_DIR "/private/var/vm"
+#define SWAPFILE_PREFIX "swapfile"
+
+/*
+ * These apparently used to be in netinet/tcp_timers.h, but went away in
+ * 10.4.2. Define them here til we find out a way to get the real values.
+ */
+#define TCPTV_MIN       (  1*PR_SLOWHZ)         /* minimum allowable value */
+#define TCPTV_REXMTMAX  ( 64*PR_SLOWHZ)         /* max allowable REXMT value */
+
+/*
+ * Because Mac OS X is built on Mach, it does not provide a BSD-compatible
+ * VM statistics API.
+ */
+#define USE_MACH_HOST_STATISTICS 1
+
+/*
+ * utility macro used in several darwin specific files
+ */
+#define SNMP_CFRelease(x) do { if (x) { CFRelease(x); x = NULL; } } while(0)
+
+/*
+ * Mac OS X runs on both PPC and Intel hardware,
+ *   which handle udpTable index values differently
+ */
+#include <TargetConditionals.h>
+#ifdef TARGET_RT_LITTLE_ENDIAN
+#define UDP_ADDRESSES_IN_HOST_ORDER 1
+#endif
diff -urpN net-snmp-5.8/include/net-snmp/system/darwin10.h net-snmp-5.9.1/include/net-snmp/system/darwin10.h
--- net-snmp-5.8/include/net-snmp/system/darwin10.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/darwin10.h	1970-01-01 07:00:00.000000000 +0700
@@ -1,133 +0,0 @@
-/*
- * While Darwin 10 (aka, Mac OS X 10.6 Snow Leopard) is "BSD-like", it differs
- * substantially enough to not warrant pretending it is a BSD flavor.
- * This first section are the vestigal BSD remnants.
- */
-/* Portions of this file are subject to the following copyright(s).  See
- * the Net-SNMP's COPYING file for more details and other copyrights
- * that may apply:
- */
-/*
- * Portions of this file are copyrighted by:
- * Copyright (C) 2007 Apple, Inc. All rights reserved.
- * Use is subject to license terms specified in the COPYING file
- * distributed with the Net-SNMP package.
- */
-
-/*
- * BSD systems use a different method of looking up sockaddr_in values 
- */
-/* #define NEED_KLGETSA 1 */
-
-#define CHECK_RT_FLAGS 1
-
-/*
- * this is not good enough before freebsd3! 
- */
-/* #undef HAVE_NET_IF_MIB_H */
-
-/*
- * This section adds the relevant definitions from generic.h
- * (a file we don't include here)
- */
-
-/*
- * udp_inpcb list symbol, e.g. for mibII/udpTable.c
- */
-#define INP_NEXT_SYMBOL inp_next
-
-/*
- * This section defines Mac OS X 10.5 (and later) specific additions.
- */
-#define darwin 10
-#ifndef darwin10
-#   define darwin10 darwin
-#endif
-
-/*
- * Mac OS X should only use the modern API and definitions.
- */
-#ifndef NETSNMP_NO_LEGACY_DEFINITIONS
-#define NETSNMP_NO_LEGACY_DEFINITIONS 1
-#endif
-
-/*
- * looks like the IFTable stuff works better than the mibII versions
- */
- 
-#define NETSNMP_INCLUDE_IFTABLE_REWRITES
-
-/*
- * use new host resources files as well
- */
-#define NETSNMP_INCLUDE_HOST_RESOURCES
-#define NETSNMP_INCLUDE_HRSWINST_REWRITES
-#define NETSNMP_INCLUDE_HRSWRUN_REWRITES
-#undef NETSNMP_INCLUDE_HRSWRUN_WRITE_SUPPORT
-#define NETSNMP_CAN_GET_DISK_LABEL 1
-
-/*
- * Enabling this restricts the compiler to mostly public APIs.
- */
-#ifndef __APPLE_API_STRICT_CONFORMANCE
-#define __APPLE_API_STRICT_CONFORMANCE 1
-#endif
-#ifndef __APPLE_API_UNSTABLE
-#define __APPLE_API_UNSTABLE 1
-#endif
-
-/*
- * Darwin's tools are capable of building multiple architectures in one pass.
- * As a result, platform definitions should be deferred until compile time.
- */
-#ifdef BYTE_ORDER
-# undef WORDS_BIGENDIAN
-# if BYTE_ORDER == BIG_ENDIAN
-#  define WORDS_BIGENDIAN 1
-# endif
-#endif
-
-/*
- * Although Darwin does have an fstab.h file, getfsfile etc. always return null.
- * At least, as of 5.3.
- */
-#undef HAVE_FSTAB_H
-
-#define SWAPFILE_DIR "/private/var/vm"
-#define SWAPFILE_PREFIX "swapfile"
-
-/*
- * These apparently used to be in netinet/tcp_timers.h, but went away in
- * 10.4.2. Define them here til we find out a way to get the real values.
- */
-#define TCPTV_MIN       (  1*PR_SLOWHZ)         /* minimum allowable value */
-#define TCPTV_REXMTMAX  ( 64*PR_SLOWHZ)         /* max allowable REXMT value */
-
-/*
- * Because Mac OS X is built on Mach, it does not provide a BSD-compatible
- * VM statistics API.
- */
-#define USE_MACH_HOST_STATISTICS 1
-
-/*
- * This tells code that manipulates IPv6 that the structures are unified,
- * i.e., IPv4 and IPv6 use the same structs.
- * This should eventually be replaced with a configure directive.
- */
-/* #define USE_UNIFIED_IPV6_STRUCTS 1 */
-#undef STRUCT_in6pcb_HAS_inp_vflag
-
-/*
- * utility macro used in several darwin specific files
- */
-#define SNMP_CFRelease(x) do { if (x) { CFRelease(x); x = NULL; } } while(0)
-
-/*
- * Mac OS X runs on both PPC and Intel hardware,
- *   which handle udpTable index values differently
- */
-#include <TargetConditionals.h>
-#ifdef TARGET_RT_LITTLE_ENDIAN
-#define UDP_ADDRESSES_IN_HOST_ORDER 1
-#endif
-
diff -urpN net-snmp-5.8/include/net-snmp/system/darwin11.h net-snmp-5.9.1/include/net-snmp/system/darwin11.h
--- net-snmp-5.8/include/net-snmp/system/darwin11.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/darwin11.h	1970-01-01 07:00:00.000000000 +0700
@@ -1,132 +0,0 @@
-/*
- * While Darwin 10 (aka, Mac OS X 10.6 Snow Leopard) is "BSD-like", it differs
- * substantially enough to not warrant pretending it is a BSD flavor.
- * This first section are the vestigal BSD remnants.
- */
-/* Portions of this file are subject to the following copyright(s).  See
- * the Net-SNMP's COPYING file for more details and other copyrights
- * that may apply:
- */
-/*
- * Portions of this file are copyrighted by:
- * Copyright (C) 2007 Apple, Inc. All rights reserved.
- * Use is subject to license terms specified in the COPYING file
- * distributed with the Net-SNMP package.
- */
-
-/*
- * BSD systems use a different method of looking up sockaddr_in values 
- */
-/* #define NEED_KLGETSA 1 */
-
-#define CHECK_RT_FLAGS 1
-
-/*
- * this is not good enough before freebsd3! 
- */
-/* #undef HAVE_NET_IF_MIB_H */
-
-/*
- * This section adds the relevant definitions from generic.h
- * (a file we don't include here)
- */
-
-/*
- * udp_inpcb list symbol, e.g. for mibII/udpTable.c
- */
-#define INP_NEXT_SYMBOL inp_next
-
-/*
- * This section defines Mac OS X 10.5 (and later) specific additions.
- */
-#define darwin 11
-#ifndef darwin11
-#   define darwin11 darwin
-#endif
-
-/*
- * Mac OS X should only use the modern API and definitions.
- */
-#ifndef NETSNMP_NO_LEGACY_DEFINITIONS
-#define NETSNMP_NO_LEGACY_DEFINITIONS 1
-#endif
-
-/*
- * looks like the IFTable stuff works better than the mibII versions
- */
- 
-#define NETSNMP_INCLUDE_IFTABLE_REWRITES
-
-/*
- * use new host resources files as well
- */
-#define NETSNMP_INCLUDE_HOST_RESOURCES
-#define NETSNMP_INCLUDE_HRSWINST_REWRITES
-#define NETSNMP_INCLUDE_HRSWRUN_REWRITES
-#undef NETSNMP_INCLUDE_HRSWRUN_WRITE_SUPPORT
-#define NETSNMP_CAN_GET_DISK_LABEL 1
-
-/*
- * Enabling this restricts the compiler to mostly public APIs.
- */
-#ifndef __APPLE_API_STRICT_CONFORMANCE
-#define __APPLE_API_STRICT_CONFORMANCE 1
-#endif
-#ifndef __APPLE_API_UNSTABLE
-#define __APPLE_API_UNSTABLE 1
-#endif
-
-/*
- * Darwin's tools are capable of building multiple architectures in one pass.
- * As a result, platform definitions should be deferred until compile time.
- */
-#ifdef BYTE_ORDER
-# undef WORDS_BIGENDIAN
-# if BYTE_ORDER == BIG_ENDIAN
-#  define WORDS_BIGENDIAN 1
-# endif
-#endif
-
-/*
- * Although Darwin does have an fstab.h file, getfsfile etc. always return null.
- * At least, as of 5.3.
- */
-#undef HAVE_FSTAB_H
-
-#define SWAPFILE_DIR "/private/var/vm"
-#define SWAPFILE_PREFIX "swapfile"
-
-/*
- * These apparently used to be in netinet/tcp_timers.h, but went away in
- * 10.4.2. Define them here til we find out a way to get the real values.
- */
-#define TCPTV_MIN       (  1*PR_SLOWHZ)         /* minimum allowable value */
-#define TCPTV_REXMTMAX  ( 64*PR_SLOWHZ)         /* max allowable REXMT value */
-
-/*
- * Because Mac OS X is built on Mach, it does not provide a BSD-compatible
- * VM statistics API.
- */
-#define USE_MACH_HOST_STATISTICS 1
-
-/*
- * This tells code that manipulates IPv6 that the structures are unified,
- * i.e., IPv4 and IPv6 use the same structs.
- * This should eventually be replaced with a configure directive.
- */
-/* #define USE_UNIFIED_IPV6_STRUCTS 1 */
-#undef STRUCT_in6pcb_HAS_inp_vflag
-
-/*
- * utility macro used in several darwin specific files
- */
-#define SNMP_CFRelease(x) do { if (x) { CFRelease(x); x = NULL; } } while(0)
-
-/*
- * Mac OS X runs on both PPC and Intel hardware,
- *   which handle udpTable index values differently
- */
-#include <TargetConditionals.h>
-#ifdef TARGET_RT_LITTLE_ENDIAN
-#define UDP_ADDRESSES_IN_HOST_ORDER 1
-#endif
diff -urpN net-snmp-5.8/include/net-snmp/system/darwin12.h net-snmp-5.9.1/include/net-snmp/system/darwin12.h
--- net-snmp-5.8/include/net-snmp/system/darwin12.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/darwin12.h	1970-01-01 07:00:00.000000000 +0700
@@ -1,132 +0,0 @@
-/*
- * While Darwin 10 (aka, Mac OS X 10.6 Snow Leopard) is "BSD-like", it differs
- * substantially enough to not warrant pretending it is a BSD flavor.
- * This first section are the vestigal BSD remnants.
- */
-/* Portions of this file are subject to the following copyright(s).  See
- * the Net-SNMP's COPYING file for more details and other copyrights
- * that may apply:
- */
-/*
- * Portions of this file are copyrighted by:
- * Copyright (C) 2007 Apple, Inc. All rights reserved.
- * Use is subject to license terms specified in the COPYING file
- * distributed with the Net-SNMP package.
- */
-
-/*
- * BSD systems use a different method of looking up sockaddr_in values 
- */
-/* #define NEED_KLGETSA 1 */
-
-#define CHECK_RT_FLAGS 1
-
-/*
- * this is not good enough before freebsd3! 
- */
-/* #undef HAVE_NET_IF_MIB_H */
-
-/*
- * This section adds the relevant definitions from generic.h
- * (a file we don't include here)
- */
-
-/*
- * udp_inpcb list symbol, e.g. for mibII/udpTable.c
- */
-#define INP_NEXT_SYMBOL inp_next
-
-/*
- * This section defines Mac OS X 10.5 (and later) specific additions.
- */
-#define darwin 12
-#ifndef darwin12
-#   define darwin12 darwin
-#endif
-
-/*
- * Mac OS X should only use the modern API and definitions.
- */
-#ifndef NETSNMP_NO_LEGACY_DEFINITIONS
-#define NETSNMP_NO_LEGACY_DEFINITIONS 1
-#endif
-
-/*
- * looks like the IFTable stuff works better than the mibII versions
- */
- 
-#define NETSNMP_INCLUDE_IFTABLE_REWRITES
-
-/*
- * use new host resources files as well
- */
-#define NETSNMP_INCLUDE_HOST_RESOURCES
-#define NETSNMP_INCLUDE_HRSWINST_REWRITES
-#define NETSNMP_INCLUDE_HRSWRUN_REWRITES
-#undef NETSNMP_INCLUDE_HRSWRUN_WRITE_SUPPORT
-#define NETSNMP_CAN_GET_DISK_LABEL 1
-
-/*
- * Enabling this restricts the compiler to mostly public APIs.
- */
-#ifndef __APPLE_API_STRICT_CONFORMANCE
-#define __APPLE_API_STRICT_CONFORMANCE 1
-#endif
-#ifndef __APPLE_API_UNSTABLE
-#define __APPLE_API_UNSTABLE 1
-#endif
-
-/*
- * Darwin's tools are capable of building multiple architectures in one pass.
- * As a result, platform definitions should be deferred until compile time.
- */
-#ifdef BYTE_ORDER
-# undef WORDS_BIGENDIAN
-# if BYTE_ORDER == BIG_ENDIAN
-#  define WORDS_BIGENDIAN 1
-# endif
-#endif
-
-/*
- * Although Darwin does have an fstab.h file, getfsfile etc. always return null.
- * At least, as of 5.3.
- */
-#undef HAVE_FSTAB_H
-
-#define SWAPFILE_DIR "/private/var/vm"
-#define SWAPFILE_PREFIX "swapfile"
-
-/*
- * These apparently used to be in netinet/tcp_timers.h, but went away in
- * 10.4.2. Define them here til we find out a way to get the real values.
- */
-#define TCPTV_MIN       (  1*PR_SLOWHZ)         /* minimum allowable value */
-#define TCPTV_REXMTMAX  ( 64*PR_SLOWHZ)         /* max allowable REXMT value */
-
-/*
- * Because Mac OS X is built on Mach, it does not provide a BSD-compatible
- * VM statistics API.
- */
-#define USE_MACH_HOST_STATISTICS 1
-
-/*
- * This tells code that manipulates IPv6 that the structures are unified,
- * i.e., IPv4 and IPv6 use the same structs.
- * This should eventually be replaced with a configure directive.
- */
-/* #define USE_UNIFIED_IPV6_STRUCTS 1 */
-#undef STRUCT_in6pcb_HAS_inp_vflag
-
-/*
- * utility macro used in several darwin specific files
- */
-#define SNMP_CFRelease(x) do { if (x) { CFRelease(x); x = NULL; } } while(0)
-
-/*
- * Mac OS X runs on both PPC and Intel hardware,
- *   which handle udpTable index values differently
- */
-#include <TargetConditionals.h>
-#ifdef TARGET_RT_LITTLE_ENDIAN
-#define UDP_ADDRESSES_IN_HOST_ORDER 1
-#endif
diff -urpN net-snmp-5.8/include/net-snmp/system/darwin13.h net-snmp-5.9.1/include/net-snmp/system/darwin13.h
--- net-snmp-5.8/include/net-snmp/system/darwin13.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/darwin13.h	1970-01-01 07:00:00.000000000 +0700
@@ -1,132 +0,0 @@
-/*
- * While Darwin 10 (aka, Mac OS X 10.6 Snow Leopard) is "BSD-like", it differs
- * substantially enough to not warrant pretending it is a BSD flavor.
- * This first section are the vestigal BSD remnants.
- */
-/* Portions of this file are subject to the following copyright(s).  See
- * the Net-SNMP's COPYING file for more details and other copyrights
- * that may apply:
- */
-/*
- * Portions of this file are copyrighted by:
- * Copyright (C) 2007 Apple, Inc. All rights reserved.
- * Use is subject to license terms specified in the COPYING file
- * distributed with the Net-SNMP package.
- */
-
-/*
- * BSD systems use a different method of looking up sockaddr_in values 
- */
-/* #define NEED_KLGETSA 1 */
-
-#define CHECK_RT_FLAGS 1
-
-/*
- * this is not good enough before freebsd3! 
- */
-/* #undef HAVE_NET_IF_MIB_H */
-
-/*
- * This section adds the relevant definitions from generic.h
- * (a file we don't include here)
- */
-
-/*
- * udp_inpcb list symbol, e.g. for mibII/udpTable.c
- */
-#define INP_NEXT_SYMBOL inp_next
-
-/*
- * This section defines Mac OS X 10.5 (and later) specific additions.
- */
-#define darwin 13
-#ifndef darwin13
-#   define darwin13 darwin
-#endif
-
-/*
- * Mac OS X should only use the modern API and definitions.
- */
-#ifndef NETSNMP_NO_LEGACY_DEFINITIONS
-#define NETSNMP_NO_LEGACY_DEFINITIONS 1
-#endif
-
-/*
- * looks like the IFTable stuff works better than the mibII versions
- */
- 
-#define NETSNMP_INCLUDE_IFTABLE_REWRITES
-
-/*
- * use new host resources files as well
- */
-#define NETSNMP_INCLUDE_HOST_RESOURCES
-#define NETSNMP_INCLUDE_HRSWINST_REWRITES
-#define NETSNMP_INCLUDE_HRSWRUN_REWRITES
-#undef NETSNMP_INCLUDE_HRSWRUN_WRITE_SUPPORT
-#define NETSNMP_CAN_GET_DISK_LABEL 1
-
-/*
- * Enabling this restricts the compiler to mostly public APIs.
- */
-#ifndef __APPLE_API_STRICT_CONFORMANCE
-#define __APPLE_API_STRICT_CONFORMANCE 1
-#endif
-#ifndef __APPLE_API_UNSTABLE
-#define __APPLE_API_UNSTABLE 1
-#endif
-
-/*
- * Darwin's tools are capable of building multiple architectures in one pass.
- * As a result, platform definitions should be deferred until compile time.
- */
-#ifdef BYTE_ORDER
-# undef WORDS_BIGENDIAN
-# if BYTE_ORDER == BIG_ENDIAN
-#  define WORDS_BIGENDIAN 1
-# endif
-#endif
-
-/*
- * Although Darwin does have an fstab.h file, getfsfile etc. always return null.
- * At least, as of 5.3.
- */
-#undef HAVE_FSTAB_H
-
-#define SWAPFILE_DIR "/private/var/vm"
-#define SWAPFILE_PREFIX "swapfile"
-
-/*
- * These apparently used to be in netinet/tcp_timers.h, but went away in
- * 10.4.2. Define them here til we find out a way to get the real values.
- */
-#define TCPTV_MIN       (  1*PR_SLOWHZ)         /* minimum allowable value */
-#define TCPTV_REXMTMAX  ( 64*PR_SLOWHZ)         /* max allowable REXMT value */
-
-/*
- * Because Mac OS X is built on Mach, it does not provide a BSD-compatible
- * VM statistics API.
- */
-#define USE_MACH_HOST_STATISTICS 1
-
-/*
- * This tells code that manipulates IPv6 that the structures are unified,
- * i.e., IPv4 and IPv6 use the same structs.
- * This should eventually be replaced with a configure directive.
- */
-/* #define USE_UNIFIED_IPV6_STRUCTS 1 */
-#undef STRUCT_in6pcb_HAS_inp_vflag
-
-/*
- * utility macro used in several darwin specific files
- */
-#define SNMP_CFRelease(x) do { if (x) { CFRelease(x); x = NULL; } } while(0)
-
-/*
- * Mac OS X runs on both PPC and Intel hardware,
- *   which handle udpTable index values differently
- */
-#include <TargetConditionals.h>
-#ifdef TARGET_RT_LITTLE_ENDIAN
-#define UDP_ADDRESSES_IN_HOST_ORDER 1
-#endif
diff -urpN net-snmp-5.8/include/net-snmp/system/darwin14.h net-snmp-5.9.1/include/net-snmp/system/darwin14.h
--- net-snmp-5.8/include/net-snmp/system/darwin14.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/darwin14.h	1970-01-01 07:00:00.000000000 +0700
@@ -1,132 +0,0 @@
-/*
- * While Darwin 10 (aka, Mac OS X 10.6 Snow Leopard) is "BSD-like", it differs
- * substantially enough to not warrant pretending it is a BSD flavor.
- * This first section are the vestigal BSD remnants.
- */
-/* Portions of this file are subject to the following copyright(s).  See
- * the Net-SNMP's COPYING file for more details and other copyrights
- * that may apply:
- */
-/*
- * Portions of this file are copyrighted by:
- * Copyright (C) 2007 Apple, Inc. All rights reserved.
- * Use is subject to license terms specified in the COPYING file
- * distributed with the Net-SNMP package.
- */
-
-/*
- * BSD systems use a different method of looking up sockaddr_in values 
- */
-/* #define NEED_KLGETSA 1 */
-
-#define CHECK_RT_FLAGS 1
-
-/*
- * this is not good enough before freebsd3! 
- */
-/* #undef HAVE_NET_IF_MIB_H */
-
-/*
- * This section adds the relevant definitions from generic.h
- * (a file we don't include here)
- */
-
-/*
- * udp_inpcb list symbol, e.g. for mibII/udpTable.c
- */
-#define INP_NEXT_SYMBOL inp_next
-
-/*
- * This section defines Mac OS X 10.5 (and later) specific additions.
- */
-#define darwin 14
-#ifndef darwin14
-#   define darwin14 darwin
-#endif
-
-/*
- * Mac OS X should only use the modern API and definitions.
- */
-#ifndef NETSNMP_NO_LEGACY_DEFINITIONS
-#define NETSNMP_NO_LEGACY_DEFINITIONS 1
-#endif
-
-/*
- * looks like the IFTable stuff works better than the mibII versions
- */
- 
-#define NETSNMP_INCLUDE_IFTABLE_REWRITES
-
-/*
- * use new host resources files as well
- */
-#define NETSNMP_INCLUDE_HOST_RESOURCES
-#define NETSNMP_INCLUDE_HRSWINST_REWRITES
-#define NETSNMP_INCLUDE_HRSWRUN_REWRITES
-#undef NETSNMP_INCLUDE_HRSWRUN_WRITE_SUPPORT
-#define NETSNMP_CAN_GET_DISK_LABEL 1
-
-/*
- * Enabling this restricts the compiler to mostly public APIs.
- */
-#ifndef __APPLE_API_STRICT_CONFORMANCE
-#define __APPLE_API_STRICT_CONFORMANCE 1
-#endif
-#ifndef __APPLE_API_UNSTABLE
-#define __APPLE_API_UNSTABLE 1
-#endif
-
-/*
- * Darwin's tools are capable of building multiple architectures in one pass.
- * As a result, platform definitions should be deferred until compile time.
- */
-#ifdef BYTE_ORDER
-# undef WORDS_BIGENDIAN
-# if BYTE_ORDER == BIG_ENDIAN
-#  define WORDS_BIGENDIAN 1
-# endif
-#endif
-
-/*
- * Although Darwin does have an fstab.h file, getfsfile etc. always return null.
- * At least, as of 5.3.
- */
-#undef HAVE_FSTAB_H
-
-#define SWAPFILE_DIR "/private/var/vm"
-#define SWAPFILE_PREFIX "swapfile"
-
-/*
- * These apparently used to be in netinet/tcp_timers.h, but went away in
- * 10.4.2. Define them here til we find out a way to get the real values.
- */
-#define TCPTV_MIN       (  1*PR_SLOWHZ)         /* minimum allowable value */
-#define TCPTV_REXMTMAX  ( 64*PR_SLOWHZ)         /* max allowable REXMT value */
-
-/*
- * Because Mac OS X is built on Mach, it does not provide a BSD-compatible
- * VM statistics API.
- */
-#define USE_MACH_HOST_STATISTICS 1
-
-/*
- * This tells code that manipulates IPv6 that the structures are unified,
- * i.e., IPv4 and IPv6 use the same structs.
- * This should eventually be replaced with a configure directive.
- */
-/* #define USE_UNIFIED_IPV6_STRUCTS 1 */
-#undef STRUCT_in6pcb_HAS_inp_vflag
-
-/*
- * utility macro used in several darwin specific files
- */
-#define SNMP_CFRelease(x) do { if (x) { CFRelease(x); x = NULL; } } while(0)
-
-/*
- * Mac OS X runs on both PPC and Intel hardware,
- *   which handle udpTable index values differently
- */
-#include <TargetConditionals.h>
-#ifdef TARGET_RT_LITTLE_ENDIAN
-#define UDP_ADDRESSES_IN_HOST_ORDER 1
-#endif
diff -urpN net-snmp-5.8/include/net-snmp/system/darwin15.h net-snmp-5.9.1/include/net-snmp/system/darwin15.h
--- net-snmp-5.8/include/net-snmp/system/darwin15.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/darwin15.h	1970-01-01 07:00:00.000000000 +0700
@@ -1 +0,0 @@
-#include <net-snmp/system/darwin14.h>
diff -urpN net-snmp-5.8/include/net-snmp/system/darwin16.h net-snmp-5.9.1/include/net-snmp/system/darwin16.h
--- net-snmp-5.8/include/net-snmp/system/darwin16.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/darwin16.h	1970-01-01 07:00:00.000000000 +0700
@@ -1 +0,0 @@
-#include <net-snmp/system/darwin15.h>
diff -urpN net-snmp-5.8/include/net-snmp/system/darwin17.h net-snmp-5.9.1/include/net-snmp/system/darwin17.h
--- net-snmp-5.8/include/net-snmp/system/darwin17.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/darwin17.h	1970-01-01 07:00:00.000000000 +0700
@@ -1 +0,0 @@
-#include <net-snmp/system/darwin16.h>
diff -urpN net-snmp-5.8/include/net-snmp/system/darwin7.h net-snmp-5.9.1/include/net-snmp/system/darwin7.h
--- net-snmp-5.8/include/net-snmp/system/darwin7.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/darwin7.h	1970-01-01 07:00:00.000000000 +0700
@@ -1,15 +0,0 @@
-#include <stdint.h>
-#include "freebsd4.h"
-#define darwin darwin
-/*
- * Although Darwin does have an fstab.h file, getfsfile etc. always return null.
- * At least, as of 5.3.
- */
-#undef HAVE_FSTAB_H
-
-#define MBSTAT_SYMBOL "mbstat"
-#undef TOTAL_MEMORY_SYMBOL
-
-#define SWAPFILE_DIR "/private/var/vm"
-#define SWAPFILE_PREFIX "swapfile"
-
diff -urpN net-snmp-5.8/include/net-snmp/system/darwin8.h net-snmp-5.9.1/include/net-snmp/system/darwin8.h
--- net-snmp-5.8/include/net-snmp/system/darwin8.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/darwin8.h	1970-01-01 07:00:00.000000000 +0700
@@ -1,89 +0,0 @@
-/*
- * While Darwin 8 (aka, Mac OS X 10.4 Tiger) is "BSD-like", it differs
- * substantially enough to not warrant pretending it is a BSD flavor.
- * This first section are the vestigal BSD remnants.
- */
-
-/*
- * BSD systems use a different method of looking up sockaddr_in values 
- */
-/* #define NEED_KLGETSA 1 */
-
-#define CHECK_RT_FLAGS 1
-
-/*
- * this is not good enough before freebsd3! 
- */
-/* #undef HAVE_NET_IF_MIB_H */
-
-/*
- * This section adds the relevant definitions from generic.h
- * (a file we don't include here)
- */
-
-/*
- * udp_inpcb list symbol, e.g. for mibII/udpTable.c
- */
-#define INP_NEXT_SYMBOL inp_next
-
-/*
- * This section defines Mac OS X 10.4 (and later) specific additions.
- */
-#define darwin 8
-
-/*
- * Mac OS X should only use the modern API and definitions.
- */
-#ifndef NETSNMP_NO_LEGACY_DEFINITIONS
-#define NETSNMP_NO_LEGACY_DEFINITIONS 1
-#endif
-
-/*
- * (eventually) Enabling this forces the compiler to only use public APIs.
- */
-/*#ifndef __APPLE_API_STRICT_CONFORMANCE
- *#define __APPLE_API_STRICT_CONFORMANCE 1
- *#endif
- */
-
-/*
- * Darwin's tools are capable of building multiple architectures in one pass.
- * As a result, platform definitions should be deferred until compile time.
- */
-#ifdef BYTE_ORDER
-# undef WORDS_BIGENDIAN
-# if BYTE_ORDER == BIG_ENDIAN
-#  define WORDS_BIGENDIAN 1
-# endif
-#endif
-
-/*
- * Although Darwin does have an fstab.h file, getfsfile etc. always return null.
- * At least, as of 5.3.
- */
-#undef HAVE_FSTAB_H
-
-#define SWAPFILE_DIR "/private/var/vm"
-#define SWAPFILE_PREFIX "swapfile"
-
-/*
- * These apparently used to be in netinet/tcp_timers.h, but went away in
- * 10.4.2. Define them here til we find out a way to get the real values.
- */
-#define TCPTV_MIN       (  1*PR_SLOWHZ)         /* minimum allowable value */
-#define TCPTV_REXMTMAX  ( 64*PR_SLOWHZ)         /* max allowable REXMT value */
-
-/*
- * Because Mac OS X is built on Mach, it does not provide a BSD-compatible
- * VM statistics API.
- */
-#define USE_MACH_HOST_STATISTICS 1
-
-/*
- * This tells code that manipulates IPv6 that the structures are unified,
- * i.e., IPv4 and IPv6 use the same structs.
- * This should eventually be replaced with a configure directive.
- */
-/* #define USE_UNIFIED_IPV6_STRUCTS 1 */
-#undef STRUCT_in6pcb_HAS_inp_vflag
-
diff -urpN net-snmp-5.8/include/net-snmp/system/darwin9.h net-snmp-5.9.1/include/net-snmp/system/darwin9.h
--- net-snmp-5.8/include/net-snmp/system/darwin9.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/darwin9.h	1970-01-01 07:00:00.000000000 +0700
@@ -1,132 +0,0 @@
-/*
- * While Darwin 9 (aka, Mac OS X 10.5 Leopard) is "BSD-like", it differs
- * substantially enough to not warrant pretending it is a BSD flavor.
- * This first section are the vestigal BSD remnants.
- */
-/* Portions of this file are subject to the following copyright(s).  See
- * the Net-SNMP's COPYING file for more details and other copyrights
- * that may apply:
- */
-/*
- * Portions of this file are copyrighted by:
- * Copyright (C) 2007 Apple, Inc. All rights reserved.
- * Use is subject to license terms specified in the COPYING file
- * distributed with the Net-SNMP package.
- */
-
-/*
- * BSD systems use a different method of looking up sockaddr_in values 
- */
-/* #define NEED_KLGETSA 1 */
-
-#define CHECK_RT_FLAGS 1
-
-/*
- * this is not good enough before freebsd3! 
- */
-/* #undef HAVE_NET_IF_MIB_H */
-
-/*
- * This section adds the relevant definitions from generic.h
- * (a file we don't include here)
- */
-
-/*
- * udp_inpcb list symbol, e.g. for mibII/udpTable.c
- */
-#define INP_NEXT_SYMBOL inp_next
-
-/*
- * This section defines Mac OS X 10.5 (and later) specific additions.
- */
-#define darwin 9
-#ifndef darwin9
-#   define darwin9 darwin
-#endif
-
-/*
- * Mac OS X should only use the modern API and definitions.
- */
-#ifndef NETSNMP_NO_LEGACY_DEFINITIONS
-#define NETSNMP_NO_LEGACY_DEFINITIONS 1
-#endif
-
-/*
- * looks like the IFTable stuff works better than the mibII versions
- */
- 
-#define NETSNMP_INCLUDE_IFTABLE_REWRITES
-
-/*
- * use new host resources files as well
- */
-#define NETSNMP_INCLUDE_HRSWINST_REWRITES
-#define NETSNMP_INCLUDE_HRSWRUN_REWRITES
-#undef NETSNMP_INCLUDE_HRSWRUN_WRITE_SUPPORT
-#define NETSNMP_CAN_GET_DISK_LABEL 1
-
-/*
- * Enabling this restricts the compiler to mostly public APIs.
- */
-#ifndef __APPLE_API_STRICT_CONFORMANCE
-#define __APPLE_API_STRICT_CONFORMANCE 1
-#endif
-#ifndef __APPLE_API_UNSTABLE
-#define __APPLE_API_UNSTABLE 1
-#endif
-
-/*
- * Darwin's tools are capable of building multiple architectures in one pass.
- * As a result, platform definitions should be deferred until compile time.
- */
-#ifdef BYTE_ORDER
-# undef WORDS_BIGENDIAN
-# if BYTE_ORDER == BIG_ENDIAN
-#  define WORDS_BIGENDIAN 1
-# endif
-#endif
-
-/*
- * Although Darwin does have an fstab.h file, getfsfile etc. always return null.
- * At least, as of 5.3.
- */
-#undef HAVE_FSTAB_H
-
-#define SWAPFILE_DIR "/private/var/vm"
-#define SWAPFILE_PREFIX "swapfile"
-
-/*
- * These apparently used to be in netinet/tcp_timers.h, but went away in
- * 10.4.2. Define them here til we find out a way to get the real values.
- */
-#define TCPTV_MIN       (  1*PR_SLOWHZ)         /* minimum allowable value */
-#define TCPTV_REXMTMAX  ( 64*PR_SLOWHZ)         /* max allowable REXMT value */
-
-/*
- * Because Mac OS X is built on Mach, it does not provide a BSD-compatible
- * VM statistics API.
- */
-#define USE_MACH_HOST_STATISTICS 1
-
-/*
- * This tells code that manipulates IPv6 that the structures are unified,
- * i.e., IPv4 and IPv6 use the same structs.
- * This should eventually be replaced with a configure directive.
- */
-/* #define USE_UNIFIED_IPV6_STRUCTS 1 */
-#undef STRUCT_in6pcb_HAS_inp_vflag
-
-/*
- * utility macro used in several darwin specific files
- */
-#define SNMP_CFRelease(x) do { if (x) { CFRelease(x); x = NULL; } } while(0)
-
-/*
- * Mac OS X runs on both PPC and Intel hardware,
- *   which handle udpTable index values differently
- */
-#include <TargetConditionals.h>
-#ifdef TARGET_RT_LITTLE_ENDIAN
-#define UDP_ADDRESSES_IN_HOST_ORDER 1
-#endif
-
diff -urpN net-snmp-5.8/include/net-snmp/system/freebsd.h net-snmp-5.9.1/include/net-snmp/system/freebsd.h
--- net-snmp-5.8/include/net-snmp/system/freebsd.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/freebsd.h	2021-05-26 05:19:35.000000000 +0700
@@ -24,4 +24,3 @@
 
 /* define the extra mib modules that are supported */
 #define NETSNMP_INCLUDE_HOST_RESOURCES
-#define NETSNMP_INCLUDE_IFTABLE_REWRITES
diff -urpN net-snmp-5.8/include/net-snmp/system/freebsd13.h net-snmp-5.9.1/include/net-snmp/system/freebsd13.h
--- net-snmp-5.8/include/net-snmp/system/freebsd13.h	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/freebsd13.h	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,3 @@
+/* freebsd13 is a superset of freebsd12 */
+#include "freebsd12.h"
+#define freebsd12 freebsd12
diff -urpN net-snmp-5.8/include/net-snmp/system/freebsd14.h net-snmp-5.9.1/include/net-snmp/system/freebsd14.h
--- net-snmp-5.8/include/net-snmp/system/freebsd14.h	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/freebsd14.h	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,3 @@
+/* freebsd14 is a superset of freebsd13 */
+#include "freebsd13.h"
+#define freebsd13 freebsd13
diff -urpN net-snmp-5.8/include/net-snmp/system/kfreebsd.h net-snmp-5.9.1/include/net-snmp/system/kfreebsd.h
--- net-snmp-5.8/include/net-snmp/system/kfreebsd.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/kfreebsd.h	2021-05-26 05:19:35.000000000 +0700
@@ -1,9 +1,45 @@
-#include "freebsd6.h"
-#define freebsd6 freebsd6
-
+/* For __FreeBSD_kernel_version */
 #include <osreldate.h>
 #define __FreeBSD_version __FreeBSD_kernel_version
 
-#include <sys/queue.h>
+/* For <vm/vm.h> */
 #include <sys/_types.h>
 
+#define INP_NEXT_SYMBOL inp_next
+
+#if __FreeBSD_kernel_version >= 3
+#define freebsd3
+#endif
+#if __FreeBSD_kernel_version >= 4
+#define freebsd4
+#endif
+#if __FreeBSD_kernel_version >= 5
+#define freebsd5
+#endif
+#if __FreeBSD_kernel_version >= 6
+#define freebsd6
+#endif
+#if __FreeBSD_kernel_version >= 7
+#define freebsd7
+#endif
+#if __FreeBSD_kernel_version >= 8
+#define freebsd8
+#endif
+#if __FreeBSD_kernel_version >= 9
+#define freebsd9
+#endif
+#if __FreeBSD_kernel_version >= 10
+#define freebsd10
+#endif
+#if __FreeBSD_kernel_version >= 11
+#define freebsd11
+#endif
+#if __FreeBSD_kernel_version >= 12
+#define freebsd12
+#endif
+#if __FreeBSD_kernel_version >= 13
+#define freebsd13
+#endif
+#if __FreeBSD_kernel_version >= 14
+#define freebsd14
+#endif
diff -urpN net-snmp-5.8/include/net-snmp/system/linux.h net-snmp-5.9.1/include/net-snmp/system/linux.h
--- net-snmp-5.8/include/net-snmp/system/linux.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/linux.h	2021-05-26 05:19:35.000000000 +0700
@@ -18,4 +18,3 @@
 
 /* define the extra mib modules that are supported */
 #define NETSNMP_INCLUDE_HOST_RESOURCES
-#define NETSNMP_INCLUDE_IFTABLE_REWRITES
diff -urpN net-snmp-5.8/include/net-snmp/system/mingw32.h net-snmp-5.9.1/include/net-snmp/system/mingw32.h
--- net-snmp-5.8/include/net-snmp/system/mingw32.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/mingw32.h	2021-05-26 05:19:35.000000000 +0700
@@ -18,76 +18,18 @@
  */
 
 /*
- * Make the getnameinfo() function available.
- * Note: according to MSDN getnameinfo() is available in ws2_32 on Windows 2000
- * and above. MinGW only makes getnameinfo() visible when setting _WIN32_WINNT
- * to 0x0501 (Windows XP) or higher, which is a bug in the MinGW 5.1.6 headers.
+ * Make sure that the Winsock header files get included before any <sys/...>
+ * header files to avoid that the build fails as follows:
+ *   In file included from /usr/include/w32api/winsock2.h:56:0,
+ *                    from ../include/net-snmp/types.h:24,
+ *                    from snmp_client.c:87:
+ *   /usr/include/w32api/psdk_inc/_fd_types.h:100:2: warning:  *warning "fd_set and associated macros have been defined in sys/types.      This can cause runtime problems with W32 sockets" [-Wcpp]
+ *   #warning "fd_set and associated macros have been defined in sys/types.
  */
-#define _WIN32_WINNT 0x0501
+#include <winsock2.h>
+#include <ws2tcpip.h>
 
 #include <net-snmp/system/generic.h>
-
-#ifdef HAVE_STDINT_H
-#include <stdint.h>	/* uint32_t */
-#endif
-
 #undef bsdlike
 #undef MBSTAT_SYMBOL
 #undef TOTAL_MEMORY_SYMBOL
-#undef HAVE_GETOPT_H
-#undef HAVE_SOCKET
-#undef HAVE_SIGNAL
-
-/* Define if you have the gettimeofday function.  */
-#define HAVE_GETTIMEOFDAY 1
-
-/* Define if you have the gethostbyname function.  */
-#define HAVE_GETHOSTBYNAME 1
-
-/* Define if you have the gethostname function.  */
-#define HAVE_GETHOSTNAME 1
-
-/* Define if you have raise() instead of alarm() */
-#define HAVE_RAISE 1
-
-/* Define if you have the socket function.  */
-#define HAVE_SOCKET 1
-
-/* Define to 1 if you have the `execv' function. */
-#undef HAVE_EXECV
-
-/* Define to 1 if you have the `fork' function. */
-#undef HAVE_FORK
-
-/*
- * I'm sure there is a cleaner way to do this.
- * Probably should be in net_snmp_config.h and
- * set during config.
- */
-#ifndef LOG_DAEMON
-#define	LOG_DAEMON	(3<<3)	/* System daemons */
-#endif
-
-/* got socklen_t? */
-#define HAVE_SOCKLEN_T 1
-
-/* This was taken from the win32 config file - see licensing information above */
-#define EADDRINUSE		WSAEADDRINUSE
-
-/*
- * File io stuff. Odd that this is not defined by MinGW.
- * Maybe there is an M$ish way to do it.
- */
-#define	F_SETFL		4
-#define	O_NONBLOCK	0x4000  /* non blocking I/O (POSIX style) */
-
-#ifndef HAVE_STRUCT_TIMEZONE_TZ_DSTTIME
-/*
- * Older MinGW versions do not have struct timezone, so define it here.
- */
-struct timezone {
-	int tz_minuteswest;
-	int tz_dsttime;
-};
-#endif
-
diff -urpN net-snmp-5.8/include/net-snmp/system/netbsd.h net-snmp-5.9.1/include/net-snmp/system/netbsd.h
--- net-snmp-5.8/include/net-snmp/system/netbsd.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/netbsd.h	2021-05-26 05:19:35.000000000 +0700
@@ -62,6 +62,9 @@
 #define netbsd3
 #endif
 
+#if defined(netbsd9) && !defined(netbsd8)
+#define netbsd8 netbsd8
+#endif
 #if defined(netbsd8) && !defined(netbsd7)
 #define netbsd7 netbsd7
 #endif
@@ -90,4 +93,3 @@
 
 /* define the extra mib modules that are supported */
 #define NETSNMP_INCLUDE_HOST_RESOURCES
-#define NETSNMP_INCLUDE_IFTABLE_REWRITES
diff -urpN net-snmp-5.8/include/net-snmp/system/openbsd.h net-snmp-5.9.1/include/net-snmp/system/openbsd.h
--- net-snmp-5.8/include/net-snmp/system/openbsd.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/openbsd.h	2021-05-26 05:19:35.000000000 +0700
@@ -15,4 +15,3 @@
 
 /* define the extra mib modules that are supported */
 #define NETSNMP_INCLUDE_HOST_RESOURCES
-#define NETSNMP_INCLUDE_IFTABLE_REWRITES
diff -urpN net-snmp-5.8/include/net-snmp/system/solaris.h net-snmp-5.9.1/include/net-snmp/system/solaris.h
--- net-snmp-5.8/include/net-snmp/system/solaris.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/system/solaris.h	2021-05-26 05:19:35.000000000 +0700
@@ -23,7 +23,6 @@
 
 /* define the extra mib modules that are supported */
 #define NETSNMP_INCLUDE_HOST_RESOURCES
-#define NETSNMP_INCLUDE_IFTABLE_REWRITES
 
 /* Solaris 2.6+ */
 #define _SLASH_PROC_METHOD_ 1
diff -urpN net-snmp-5.8/include/net-snmp/types.h net-snmp-5.9.1/include/net-snmp/types.h
--- net-snmp-5.8/include/net-snmp/types.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/types.h	2021-05-26 05:19:35.000000000 +0700
@@ -22,48 +22,7 @@
 #error "Please include <net-snmp/net-snmp-config.h> before this file"
 #endif
 
-                        /*
-                         * For 'timeval' 
-                         */
-#if TIME_WITH_SYS_TIME
-# include <sys/time.h>
-# include <time.h>
-#else
-# if HAVE_SYS_TIME_H
-#  include <sys/time.h>
-# else
-#  include <time.h>
-# endif
-#endif
-
-#ifdef HAVE_INTTYPES_H
-#include <inttypes.h>
-#endif
 #include <sys/types.h>
-#if 1
-/*
- * If neither the Microsoft winsock header file nor the MinGW winsock header
- * file has already been included, do this now.
- */
-# if defined(HAVE_WINSOCK2_H) && defined(HAVE_WS2TCPIP_H)
-#  if !defined(__MINGW32__) && !defined(HAVE_WIN32_PLATFORM_SDK) && \
-    _MSC_VER -0 <= 1200 && _WIN32_WINNT -0 >= 0x0400
-    /*
-     * When using the MSVC 6 header files, including <winsock2.h> when
-     * _WIN32_WINNT >= 0x0400 results in a compilation error. Hence include
-     * <windows.h> instead, because <winsock2.h> is included from inside
-     * <windows.h> when _WIN32_WINNT >= 0x0400. The SDK version of <windows.h>
-     * does not include <winsock2.h> however.
-     */
-#   include <windows.h>
-#  else
-#   include <winsock2.h>
-#  endif
-#  include <ws2tcpip.h>
-# elif defined(HAVE_WINSOCK_H)
-#  include <winsock.h>
-# endif
-#endif
 
 #if defined(WIN32) && !defined(cygwin)
 typedef HANDLE netsnmp_pid_t;
@@ -78,10 +37,6 @@ typedef pid_t netsnmp_pid_t;
 #define NETSNMP_NO_SUCH_PROCESS -1
 #endif
 
-#if HAVE_NETINET_IN_H
-#include <netinet/in.h>		/* For definition of in_addr_t */
-#endif
-
 #include <net-snmp/library/oid.h>
 
 #ifdef __cplusplus
@@ -89,15 +44,11 @@ extern "C" {
 #endif
 
 #ifndef HAVE_SOCKLEN_T
+#ifdef WIN32
+typedef int socklen_t;
+#else
 typedef u_int socklen_t;
 #endif
-
-#ifndef HAVE_IN_ADDR_T
-  /*
-   * The type in_addr_t must match the type of sockaddr_in::sin_addr.
-   * For MSVC and MinGW32, this is u_long.
-   */
-typedef u_long in_addr_t;
 #endif
 
 #ifndef HAVE_SSIZE_T
@@ -112,6 +63,16 @@ typedef long ssize_t;
 typedef unsigned long int nfds_t;
 #endif
 
+#ifdef HAVE_PCRE_H
+/*
+ * Abstract the pcre typedef such that not all *.c files have to include
+ * <pcre.h>.
+ */
+typedef struct {
+    void *regex_ptr;
+} netsnmp_regex_ptr;
+#endif
+ 
     /*
      *  For the initial release, this will just refer to the
      *  relevant UCD header files.
@@ -282,9 +243,10 @@ typedef struct snmp_pdu {
 } netsnmp_pdu;
 
 
-/** @typedef struct snmp_session netsnmp_session
- * Typedefs the snmp_session struct intonetsnmp_session */
-        struct snmp_session;
+/**
+ * @typedef struct snmp_session netsnmp_session
+ * Typedefs the snmp_session struct into netsnmp_session.
+ */
 typedef struct snmp_session netsnmp_session;
 
 /** for openssl this should match up with EVP_MAX_MD_SIZE */
diff -urpN net-snmp-5.8/include/net-snmp/utilities.h net-snmp-5.9.1/include/net-snmp/utilities.h
--- net-snmp-5.8/include/net-snmp/utilities.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/include/net-snmp/utilities.h	2021-05-26 05:19:35.000000000 +0700
@@ -33,9 +33,6 @@
 #include <net-snmp/library/getopt.h>
 #endif
 
-#ifdef HAVE_NETINET_IN_H
-#include <netinet/in.h>         /* for in_addr_t */
-#endif
 #include <net-snmp/library/system.h>
 #include <net-snmp/library/tools.h>
 #include <net-snmp/library/asn1.h>      /* for counter64 */
diff -urpN net-snmp-5.8/local/gittools/shell-functions net-snmp-5.9.1/local/gittools/shell-functions
--- net-snmp-5.8/local/gittools/shell-functions	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/local/gittools/shell-functions	2021-05-26 05:19:35.000000000 +0700
@@ -4,7 +4,7 @@
 
 nsbuildroot=${nsbuildroot:=$HOME/ns-build-root}
 nsecho=${nsecho:=}
-nsbranches=${nsbranches:="V5-4-patches V5-7-patches master"}
+nsbranches=${nsbranches:="V5-9-patches master"}
 
 # set nsverbose to ':' if you don't want verbose output of what's going on
 nsverbose=${nsverbose:="echo ::: Net-SNMP: "}
diff -urpN net-snmp-5.8/local/mib2c net-snmp-5.9.1/local/mib2c
--- net-snmp-5.8/local/mib2c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/local/mib2c	2021-05-26 05:19:35.000000000 +0700
@@ -148,7 +148,7 @@ while($#ARGV >= 0) {
 	       "UNSIGNED32", "u_long",
 	       "UINTEGER", "u_long",
 	       "OBJECTID", "oid",
-	       "COUNTER64", "U64",
+	       "COUNTER64", "struct counter64",
 	       "COUNTER", "u_long",
 	       "IPADDR", "in_addr_t",
 	       "BITS", "char",
diff -urpN net-snmp-5.8/local/mib2c-conf.d/generic-ctx-get.m2i net-snmp-5.9.1/local/mib2c-conf.d/generic-ctx-get.m2i
--- net-snmp-5.8/local/mib2c-conf.d/generic-ctx-get.m2i	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/local/mib2c-conf.d/generic-ctx-get.m2i	2021-05-26 05:19:35.000000000 +0700
@@ -91,7 +91,7 @@
     $m2c_ctx_lhs = $m2c_ctx_rhs$m2c_ctx_lm;
     memcpy( $m2c_ctx_lh, $m2c_ctx_rh, $m2c_ctx_rhs$m2c_ctx_cm );
 @else@
-@   if $node.decl =~ /U64/i@ #              ASN_COUNTER64
+@   if $node.decl =~ /struct counter64/i@  # ASN_COUNTER64
     ${m2c_ctx_lh}.high = ${m2c_ctx_rh}.high;
     ${m2c_ctx_lh}.low = ${m2c_ctx_rh}.low;
 @   else@
diff -urpN net-snmp-5.8/local/mib2c-conf.d/m2c_setup_node.m2i net-snmp-5.9.1/local/mib2c-conf.d/m2c_setup_node.m2i
--- net-snmp-5.8/local/mib2c-conf.d/m2c_setup_node.m2i	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/local/mib2c-conf.d/m2c_setup_node.m2i	2021-05-26 05:19:35.000000000 +0700
@@ -60,7 +60,7 @@
 @      eval $m2c_node_skip_get = 1@
 @    end@
 @  else@
-@    eval $m2c_decl = $node.decl@
+@    eval $m2c_decl = "$node.decl"@
  @  end@ // enums
 ########################################################################
 ## find max size
diff -urpN net-snmp-5.8/local/mib2c-conf.d/mfd-access-container-cached-defines.m2i net-snmp-5.9.1/local/mib2c-conf.d/mfd-access-container-cached-defines.m2i
--- net-snmp-5.8/local/mib2c-conf.d/mfd-access-container-cached-defines.m2i	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/local/mib2c-conf.d/mfd-access-container-cached-defines.m2i	2021-05-26 05:19:35.000000000 +0700
@@ -358,7 +358,7 @@ $example_end
 @end@ # example
 
     DEBUGMSGT(("verbose:${context}:${context}_container_load",
-               "inserted %d records\n", count));
+               "inserted %" NETSNMP_PRIz "u records\n", count));
 
     return MFD_SUCCESS;
 } /* ${context}_container_load */
diff -urpN net-snmp-5.8/local/mib2c-conf.d/mfd-interface.m2c net-snmp-5.9.1/local/mib2c-conf.d/mfd-interface.m2c
--- net-snmp-5.8/local/mib2c-conf.d/mfd-interface.m2c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/local/mib2c-conf.d/mfd-interface.m2c	2021-05-26 05:19:35.000000000 +0700
@@ -112,9 +112,9 @@ void ${context}_valid_columns_set(netsnm
 
 #include "${name}_interface.h"
 
-netsnmp_feature_require(baby_steps)
-netsnmp_feature_require(row_merge)
-netsnmp_feature_require(check_all_requests_error)
+netsnmp_feature_require(baby_steps);
+netsnmp_feature_require(row_merge);
+netsnmp_feature_require(check_all_requests_error);
 
 #include <ctype.h>
 
diff -urpN net-snmp-5.8/local/mib2c-conf.d/node-get.m2i net-snmp-5.9.1/local/mib2c-conf.d/node-get.m2i
--- net-snmp-5.8/local/mib2c-conf.d/node-get.m2i	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/local/mib2c-conf.d/node-get.m2i	2021-05-26 05:19:35.000000000 +0700
@@ -83,7 +83,7 @@ ${node}_get( ${context}_rowreq_ctx *rowr
 @       include generic-get-char.m2i@
 @    elsif $node.decl =~ /oid/i@ #                    ASN_OBJECT_ID
 @       include generic-get-oid.m2i@
-@    elsif $node.decl =~ /U64/i@ #                    ASN_COUNTER64
+@    elsif $node.decl =~ /struct counter64/i@ #       ASN_COUNTER64
 @       include generic-get-U64.m2i@
 @    else@
 @        print ERROR: unknown node.decl: $node.decl@
diff -urpN net-snmp-5.8/local/mib2c-conf.d/subagent.m2c net-snmp-5.9.1/local/mib2c-conf.d/subagent.m2c
--- net-snmp-5.8/local/mib2c-conf.d/subagent.m2c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/local/mib2c-conf.d/subagent.m2c	2021-05-26 05:19:35.000000000 +0700
@@ -35,8 +35,8 @@
  * --with-features="agent_check_and_process enable_stderrlog" to your
  * configure line.
  */
-netsnmp_feature_require(agent_check_and_process)
-netsnmp_feature_require(enable_stderrlog)
+netsnmp_feature_require(agent_check_and_process);
+netsnmp_feature_require(enable_stderrlog);
 
 static int keep_running;
 
diff -urpN net-snmp-5.8/local/mib2c.table_data.conf net-snmp-5.9.1/local/mib2c.table_data.conf
--- net-snmp-5.8/local/mib2c.table_data.conf	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/local/mib2c.table_data.conf	2021-05-26 05:19:35.000000000 +0700
@@ -106,6 +106,7 @@ initialize_table_$i(void)
 @if "$cache" == 1 @
     netsnmp_cache                   *cache;
 @end@
+    int                              ret;
 
     DEBUGMSGTL(("${name}:init", "initializing table $i\n"));
 
@@ -148,9 +149,14 @@ initialize_table_$i(void)
     table_info->min_column = COLUMN_$first_column.uc;
     table_info->max_column = COLUMN_$last_column.uc;
     
-    netsnmp_tdata_register( reg, table_data, table_info );
+    rc = netsnmp_tdata_register(reg, table_data, table_info);
+    if (rc) {
+        snmp_log(LOG_ERR, "%s: netsnmp_tdata_register() returned %d\n",
+                 __func__, rc);
+        return;
+    }
 @if "$cache" == 1 @
-    if (cache) 
+    if (cache)
         netsnmp_inject_handler_before( reg, netsnmp_cache_handler_GET(cache),
                                        TABLE_TDATA_NAME);
 @end@
diff -urpN net-snmp-5.8/local/minimalist/feature-check net-snmp-5.9.1/local/minimalist/feature-check
--- net-snmp-5.8/local/minimalist/feature-check	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/local/minimalist/feature-check	2021-05-26 05:19:35.000000000 +0700
@@ -67,7 +67,7 @@ touch $destination;
 
 # process requires
 firstrequire=1
-for i in `grep NSF_RR $tmpf | sed 's/ NSF_RR//'` ; do
+for i in `grep NSF_RR $tmpf | sed 's/ NSF_RR;//'` ; do
     if test $firstrequire = 1 ; then
 	echo "" >> $destination
 	echo "/* required by $sourcedir/$source */" >> $destination
@@ -79,7 +79,7 @@ done
 
 # process provides
 firstfeature=1
-for i in `grep NSF_PP $tmpf | sed 's/ NSF_PP//'` ; do
+for i in `grep NSF_PP $tmpf | sed 's/ NSF_PP;//'` ; do
     if test $firstfeature = 1 ; then
 	echo "" >> $destination
 	echo "/* features provided by $sourcedir/$source */" >> $destination
@@ -91,7 +91,7 @@ done
 
 # process children
 firstfeature=1
-for i in `grep NSF_CO $tmpf | sed 's/ NSF_CO//'` ; do
+for i in `grep NSF_CO $tmpf | sed 's/ NSF_CO;//'` ; do
     parent=`echo $i | sed 's/.*,//'`
     child=`echo $i | sed 's/,.*//'`
     if test $firstfeature = 1 ; then
@@ -107,7 +107,7 @@ done
 
 # process wants
 firstfeature=1
-for i in `grep NSF_WW $tmpf | sed 's/ NSF_WW//'` ; do
+for i in `grep NSF_WW $tmpf | sed 's/ NSF_WW;//'` ; do
     if test $firstfeature = 1 ; then
 	echo "" >> $destination
 	echo "/* features wanted by $sourcedir/$source */" >> $destination
diff -urpN net-snmp-5.8/local/net-snmp-cert net-snmp-5.9.1/local/net-snmp-cert
--- net-snmp-5.8/local/net-snmp-cert	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/local/net-snmp-cert	2021-05-26 05:19:35.000000000 +0700
@@ -1003,7 +1003,7 @@ sub make_openssl_conf {
 rdir            = .
 dir		= $ENV::DIR
 RANDFILE	= $rdir/.rand
-MD		= sha1
+MD		= sha512
 KSIZE		= 2048
 CN		= net-snmp.org
 EMAIL		= admin@net-snmp.org
diff -urpN net-snmp-5.8/ltmain.sh net-snmp-5.9.1/ltmain.sh
--- net-snmp-5.8/ltmain.sh	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/ltmain.sh	2021-05-26 05:19:35.000000000 +0700
@@ -1,9 +1,12 @@
+#! /bin/sh
+## DO NOT EDIT - This file generated from ./build-aux/ltmain.in
+##               by inline-source v2014-01-03.01
 
-# libtool (GNU libtool) 2.4
+# libtool (GNU libtool) 2.4.6
+# Provide generalized library-building support services.
 # Written by Gordon Matzigkeit <gord@gnu.ai.mit.edu>, 1996
 
-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005, 2006,
-# 2007, 2008, 2009, 2010 Free Software Foundation, Inc.
+# Copyright (C) 1996-2015 Free Software Foundation, Inc.
 # This is free software; see the source for copying conditions.  There is NO
 # warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 
@@ -23,885 +26,2112 @@
 # General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
-# along with GNU Libtool; see the file COPYING.  If not, a copy
-# can be downloaded from http://www.gnu.org/licenses/gpl.html,
-# or obtained by writing to the Free Software Foundation, Inc.,
-# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+# along with this program.  If not, see <http://www.gnu.org/licenses/>.
 
-# Usage: $progname [OPTION]... [MODE-ARG]...
-#
-# Provide generalized library-building support services.
-#
-#       --config             show all configuration variables
-#       --debug              enable verbose shell tracing
-#   -n, --dry-run            display commands without modifying any files
-#       --features           display basic configuration information and exit
-#       --mode=MODE          use operation mode MODE
-#       --preserve-dup-deps  don't remove duplicate dependency libraries
-#       --quiet, --silent    don't print informational messages
-#       --no-quiet, --no-silent
-#                            print informational messages (default)
-#       --tag=TAG            use configuration variables from tag TAG
-#   -v, --verbose            print more informational messages than default
-#       --no-verbose         don't print the extra informational messages
-#       --version            print version information
-#   -h, --help, --help-all   print short, long, or detailed help message
-#
-# MODE must be one of the following:
-#
-#         clean              remove files from the build directory
-#         compile            compile a source file into a libtool object
-#         execute            automatically set library path, then run a program
-#         finish             complete the installation of libtool libraries
-#         install            install libraries or executables
-#         link               create a library or an executable
-#         uninstall          remove libraries from an installed directory
-#
-# MODE-ARGS vary depending on the MODE.  When passed as first option,
-# `--mode=MODE' may be abbreviated as `MODE' or a unique abbreviation of that.
-# Try `$progname --help --mode=MODE' for a more detailed description of MODE.
-#
-# When reporting a bug, please describe a test case to reproduce it and
-# include the following information:
-#
-#         host-triplet:	$host
-#         shell:		$SHELL
-#         compiler:		$LTCC
-#         compiler flags:		$LTCFLAGS
-#         linker:		$LD (gnu? $with_gnu_ld)
-#         $progname:	(GNU libtool) 2.4
-#         automake:	$automake_version
-#         autoconf:	$autoconf_version
-#
-# Report bugs to <bug-libtool@gnu.org>.
-# GNU libtool home page: <http://www.gnu.org/software/libtool/>.
-# General help using GNU software: <http://www.gnu.org/gethelp/>.
 
 PROGRAM=libtool
 PACKAGE=libtool
-VERSION=2.4
-TIMESTAMP=""
-package_revision=1.3293
+VERSION=2.4.6
+package_revision=2.4.6
 
-# Be Bourne compatible
-if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+
+## ------ ##
+## Usage. ##
+## ------ ##
+
+# Run './libtool --help' for help with using this script from the
+# command line.
+
+
+## ------------------------------- ##
+## User overridable command paths. ##
+## ------------------------------- ##
+
+# After configure completes, it has a better idea of some of the
+# shell tools we need than the defaults used by the functions shared
+# with bootstrap, so set those here where they can still be over-
+# ridden by the user, but otherwise take precedence.
+
+: ${AUTOCONF="autoconf"}
+: ${AUTOMAKE="automake"}
+
+
+## -------------------------- ##
+## Source external libraries. ##
+## -------------------------- ##
+
+# Much of our low-level functionality needs to be sourced from external
+# libraries, which are installed to $pkgauxdir.
+
+# Set a version string for this script.
+scriptversion=2015-01-20.17; # UTC
+
+# General shell script boiler plate, and helper functions.
+# Written by Gary V. Vaughan, 2004
+
+# Copyright (C) 2004-2015 Free Software Foundation, Inc.
+# This is free software; see the source for copying conditions.  There is NO
+# warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 3 of the License, or
+# (at your option) any later version.
+
+# As a special exception to the GNU General Public License, if you distribute
+# this file as part of a program or library that is built using GNU Libtool,
+# you may include this file under the same distribution terms that you use
+# for the rest of that program.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNES FOR A PARTICULAR PURPOSE. See the GNU
+# General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program. If not, see <http://www.gnu.org/licenses/>.
+
+# Please report bugs or propose patches to gary@gnu.org.
+
+
+## ------ ##
+## Usage. ##
+## ------ ##
+
+# Evaluate this file near the top of your script to gain access to
+# the functions and variables defined here:
+#
+#   . `echo "$0" | ${SED-sed} 's|[^/]*$||'`/build-aux/funclib.sh
+#
+# If you need to override any of the default environment variable
+# settings, do that before evaluating this file.
+
+
+## -------------------- ##
+## Shell normalisation. ##
+## -------------------- ##
+
+# Some shells need a little help to be as Bourne compatible as possible.
+# Before doing anything else, make sure all that help has been provided!
+
+DUALCASE=1; export DUALCASE # for MKS sh
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
   NULLCMD=:
-  # Zsh 3.x and 4.x performs word splitting on ${1+"$@"}, which
+  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
   # is contrary to our usage.  Disable this feature.
   alias -g '${1+"$@"}'='"$@"'
   setopt NO_GLOB_SUBST
 else
-  case `(set -o) 2>/dev/null` in *posix*) set -o posix;; esac
+  case `(set -o) 2>/dev/null` in *posix*) set -o posix ;; esac
 fi
-BIN_SH=xpg4; export BIN_SH # for Tru64
-DUALCASE=1; export DUALCASE # for MKS sh
 
-# A function that is used when there is no print builtin or printf.
-func_fallback_echo ()
-{
-  eval 'cat <<_LTECHO_EOF
-$1
-_LTECHO_EOF'
-}
-
-# NLS nuisances: We save the old values to restore during execute mode.
-lt_user_locale=
-lt_safe_locale=
-for lt_var in LANG LANGUAGE LC_ALL LC_CTYPE LC_COLLATE LC_MESSAGES
+# NLS nuisances: We save the old values in case they are required later.
+_G_user_locale=
+_G_safe_locale=
+for _G_var in LANG LANGUAGE LC_ALL LC_CTYPE LC_COLLATE LC_MESSAGES
 do
-  eval "if test \"\${$lt_var+set}\" = set; then
-          save_$lt_var=\$$lt_var
-          $lt_var=C
-	  export $lt_var
-	  lt_user_locale=\"$lt_var=\\\$save_\$lt_var; \$lt_user_locale\"
-	  lt_safe_locale=\"$lt_var=C; \$lt_safe_locale\"
+  eval "if test set = \"\${$_G_var+set}\"; then
+          save_$_G_var=\$$_G_var
+          $_G_var=C
+	  export $_G_var
+	  _G_user_locale=\"$_G_var=\\\$save_\$_G_var; \$_G_user_locale\"
+	  _G_safe_locale=\"$_G_var=C; \$_G_safe_locale\"
 	fi"
 done
-LC_ALL=C
-LANGUAGE=C
-export LANGUAGE LC_ALL
 
-$lt_unset CDPATH
+# CDPATH.
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
 
+# Make sure IFS has a sensible default
+sp=' '
+nl='
+'
+IFS="$sp	$nl"
+
+# There are apparently some retarded systems that use ';' as a PATH separator!
+if test "${PATH_SEPARATOR+set}" != set; then
+  PATH_SEPARATOR=:
+  (PATH='/bin;/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 && {
+    (PATH='/bin:/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 ||
+      PATH_SEPARATOR=';'
+  }
+fi
 
-# Work around backward compatibility issue on IRIX 6.5. On IRIX 6.4+, sh
-# is ksh but when the shell is invoked as "sh" and the current value of
-# the _XPG environment variable is not equal to 1 (one), the special
-# positional parameter $0, within a function call, is the name of the
-# function.
-progpath="$0"
 
 
+## ------------------------- ##
+## Locate command utilities. ##
+## ------------------------- ##
+
+
+# func_executable_p FILE
+# ----------------------
+# Check that FILE is an executable regular file.
+func_executable_p ()
+{
+    test -f "$1" && test -x "$1"
+}
+
+
+# func_path_progs PROGS_LIST CHECK_FUNC [PATH]
+# --------------------------------------------
+# Search for either a program that responds to --version with output
+# containing "GNU", or else returned by CHECK_FUNC otherwise, by
+# trying all the directories in PATH with each of the elements of
+# PROGS_LIST.
+#
+# CHECK_FUNC should accept the path to a candidate program, and
+# set $func_check_prog_result if it truncates its output less than
+# $_G_path_prog_max characters.
+func_path_progs ()
+{
+    _G_progs_list=$1
+    _G_check_func=$2
+    _G_PATH=${3-"$PATH"}
+
+    _G_path_prog_max=0
+    _G_path_prog_found=false
+    _G_save_IFS=$IFS; IFS=${PATH_SEPARATOR-:}
+    for _G_dir in $_G_PATH; do
+      IFS=$_G_save_IFS
+      test -z "$_G_dir" && _G_dir=.
+      for _G_prog_name in $_G_progs_list; do
+        for _exeext in '' .EXE; do
+          _G_path_prog=$_G_dir/$_G_prog_name$_exeext
+          func_executable_p "$_G_path_prog" || continue
+          case `"$_G_path_prog" --version 2>&1` in
+            *GNU*) func_path_progs_result=$_G_path_prog _G_path_prog_found=: ;;
+            *)     $_G_check_func $_G_path_prog
+		   func_path_progs_result=$func_check_prog_result
+		   ;;
+          esac
+          $_G_path_prog_found && break 3
+        done
+      done
+    done
+    IFS=$_G_save_IFS
+    test -z "$func_path_progs_result" && {
+      echo "no acceptable sed could be found in \$PATH" >&2
+      exit 1
+    }
+}
+
+
+# We want to be able to use the functions in this file before configure
+# has figured out where the best binaries are kept, which means we have
+# to search for them ourselves - except when the results are already set
+# where we skip the searches.
+
+# Unless the user overrides by setting SED, search the path for either GNU
+# sed, or the sed that truncates its output the least.
+test -z "$SED" && {
+  _G_sed_script=s/aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb/
+  for _G_i in 1 2 3 4 5 6 7; do
+    _G_sed_script=$_G_sed_script$nl$_G_sed_script
+  done
+  echo "$_G_sed_script" 2>/dev/null | sed 99q >conftest.sed
+  _G_sed_script=
+
+  func_check_prog_sed ()
+  {
+    _G_path_prog=$1
+
+    _G_count=0
+    printf 0123456789 >conftest.in
+    while :
+    do
+      cat conftest.in conftest.in >conftest.tmp
+      mv conftest.tmp conftest.in
+      cp conftest.in conftest.nl
+      echo '' >> conftest.nl
+      "$_G_path_prog" -f conftest.sed <conftest.nl >conftest.out 2>/dev/null || break
+      diff conftest.out conftest.nl >/dev/null 2>&1 || break
+      _G_count=`expr $_G_count + 1`
+      if test "$_G_count" -gt "$_G_path_prog_max"; then
+        # Best one so far, save it but keep looking for a better one
+        func_check_prog_result=$_G_path_prog
+        _G_path_prog_max=$_G_count
+      fi
+      # 10*(2^10) chars as input seems more than enough
+      test 10 -lt "$_G_count" && break
+    done
+    rm -f conftest.in conftest.tmp conftest.nl conftest.out
+  }
+
+  func_path_progs "sed gsed" func_check_prog_sed $PATH:/usr/xpg4/bin
+  rm -f conftest.sed
+  SED=$func_path_progs_result
+}
+
+
+# Unless the user overrides by setting GREP, search the path for either GNU
+# grep, or the grep that truncates its output the least.
+test -z "$GREP" && {
+  func_check_prog_grep ()
+  {
+    _G_path_prog=$1
+
+    _G_count=0
+    _G_path_prog_max=0
+    printf 0123456789 >conftest.in
+    while :
+    do
+      cat conftest.in conftest.in >conftest.tmp
+      mv conftest.tmp conftest.in
+      cp conftest.in conftest.nl
+      echo 'GREP' >> conftest.nl
+      "$_G_path_prog" -e 'GREP$' -e '-(cannot match)-' <conftest.nl >conftest.out 2>/dev/null || break
+      diff conftest.out conftest.nl >/dev/null 2>&1 || break
+      _G_count=`expr $_G_count + 1`
+      if test "$_G_count" -gt "$_G_path_prog_max"; then
+        # Best one so far, save it but keep looking for a better one
+        func_check_prog_result=$_G_path_prog
+        _G_path_prog_max=$_G_count
+      fi
+      # 10*(2^10) chars as input seems more than enough
+      test 10 -lt "$_G_count" && break
+    done
+    rm -f conftest.in conftest.tmp conftest.nl conftest.out
+  }
+
+  func_path_progs "grep ggrep" func_check_prog_grep $PATH:/usr/xpg4/bin
+  GREP=$func_path_progs_result
+}
+
+
+## ------------------------------- ##
+## User overridable command paths. ##
+## ------------------------------- ##
+
+# All uppercase variable names are used for environment variables.  These
+# variables can be overridden by the user before calling a script that
+# uses them if a suitable command of that name is not already available
+# in the command search PATH.
 
 : ${CP="cp -f"}
-test "${ECHO+set}" = set || ECHO=${as_echo-'printf %s\n'}
-: ${EGREP="grep -E"}
-: ${FGREP="grep -F"}
-: ${GREP="grep"}
+: ${ECHO="printf %s\n"}
+: ${EGREP="$GREP -E"}
+: ${FGREP="$GREP -F"}
 : ${LN_S="ln -s"}
 : ${MAKE="make"}
 : ${MKDIR="mkdir"}
 : ${MV="mv -f"}
 : ${RM="rm -f"}
-: ${SED="sed"}
 : ${SHELL="${CONFIG_SHELL-/bin/sh}"}
-: ${Xsed="$SED -e 1s/^X//"}
 
-# Global variables:
-EXIT_SUCCESS=0
-EXIT_FAILURE=1
-EXIT_MISMATCH=63  # $? = 63 is used to indicate version mismatch to missing.
-EXIT_SKIP=77	  # $? = 77 is used to indicate a skipped test to automake.
-
-exit_status=$EXIT_SUCCESS
-
-# Make sure IFS has a sensible default
-lt_nl='
-'
-IFS=" 	$lt_nl"
 
-dirname="s,/[^/]*$,,"
-basename="s,^.*/,,"
-
-# func_dirname file append nondir_replacement
-# Compute the dirname of FILE.  If nonempty, add APPEND to the result,
-# otherwise set result to NONDIR_REPLACEMENT.
-func_dirname ()
-{
-    func_dirname_result=`$ECHO "${1}" | $SED "$dirname"`
-    if test "X$func_dirname_result" = "X${1}"; then
-      func_dirname_result="${3}"
-    else
-      func_dirname_result="$func_dirname_result${2}"
-    fi
-} # func_dirname may be replaced by extended shell implementation
+## -------------------- ##
+## Useful sed snippets. ##
+## -------------------- ##
 
+sed_dirname='s|/[^/]*$||'
+sed_basename='s|^.*/||'
 
-# func_basename file
-func_basename ()
-{
-    func_basename_result=`$ECHO "${1}" | $SED "$basename"`
-} # func_basename may be replaced by extended shell implementation
+# Sed substitution that helps us do robust quoting.  It backslashifies
+# metacharacters that are still active within double-quoted strings.
+sed_quote_subst='s|\([`"$\\]\)|\\\1|g'
 
+# Same as above, but do not quote variable references.
+sed_double_quote_subst='s/\(["`\\]\)/\\\1/g'
 
-# func_dirname_and_basename file append nondir_replacement
-# perform func_basename and func_dirname in a single function
-# call:
-#   dirname:  Compute the dirname of FILE.  If nonempty,
-#             add APPEND to the result, otherwise set result
-#             to NONDIR_REPLACEMENT.
-#             value returned in "$func_dirname_result"
-#   basename: Compute filename of FILE.
-#             value retuned in "$func_basename_result"
-# Implementation must be kept synchronized with func_dirname
-# and func_basename. For efficiency, we do not delegate to
-# those functions but instead duplicate the functionality here.
-func_dirname_and_basename ()
-{
-    # Extract subdirectory from the argument.
-    func_dirname_result=`$ECHO "${1}" | $SED -e "$dirname"`
-    if test "X$func_dirname_result" = "X${1}"; then
-      func_dirname_result="${3}"
-    else
-      func_dirname_result="$func_dirname_result${2}"
-    fi
-    func_basename_result=`$ECHO "${1}" | $SED -e "$basename"`
-} # func_dirname_and_basename may be replaced by extended shell implementation
+# Sed substitution that turns a string into a regex matching for the
+# string literally.
+sed_make_literal_regex='s|[].[^$\\*\/]|\\&|g'
 
+# Sed substitution that converts a w32 file name or path
+# that contains forward slashes, into one that contains
+# (escaped) backslashes.  A very naive implementation.
+sed_naive_backslashify='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'
 
-# func_stripname prefix suffix name
-# strip PREFIX and SUFFIX off of NAME.
-# PREFIX and SUFFIX must not contain globbing or regex special
-# characters, hashes, percent signs, but SUFFIX may contain a leading
-# dot (in which case that matches only a dot).
-# func_strip_suffix prefix name
-func_stripname ()
-{
-    case ${2} in
-      .*) func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%\\\\${2}\$%%"`;;
-      *)  func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%${2}\$%%"`;;
-    esac
-} # func_stripname may be replaced by extended shell implementation
+# Re-'\' parameter expansions in output of sed_double_quote_subst that
+# were '\'-ed in input to the same.  If an odd number of '\' preceded a
+# '$' in input to sed_double_quote_subst, that '$' was protected from
+# expansion.  Since each input '\' is now two '\'s, look for any number
+# of runs of four '\'s followed by two '\'s and then a '$'.  '\' that '$'.
+_G_bs='\\'
+_G_bs2='\\\\'
+_G_bs4='\\\\\\\\'
+_G_dollar='\$'
+sed_double_backslash="\
+  s/$_G_bs4/&\\
+/g
+  s/^$_G_bs2$_G_dollar/$_G_bs&/
+  s/\\([^$_G_bs]\\)$_G_bs2$_G_dollar/\\1$_G_bs2$_G_bs$_G_dollar/g
+  s/\n//g"
 
 
-# These SED scripts presuppose an absolute path with a trailing slash.
-pathcar='s,^/\([^/]*\).*$,\1,'
-pathcdr='s,^/[^/]*,,'
-removedotparts=':dotsl
-		s@/\./@/@g
-		t dotsl
-		s,/\.$,/,'
-collapseslashes='s@/\{1,\}@/@g'
-finalslash='s,/*$,/,'
+## ----------------- ##
+## Global variables. ##
+## ----------------- ##
+
+# Except for the global variables explicitly listed below, the following
+# functions in the '^func_' namespace, and the '^require_' namespace
+# variables initialised in the 'Resource management' section, sourcing
+# this file will not pollute your global namespace with anything
+# else. There's no portable way to scope variables in Bourne shell
+# though, so actually running these functions will sometimes place
+# results into a variable named after the function, and often use
+# temporary variables in the '^_G_' namespace. If you are careful to
+# avoid using those namespaces casually in your sourcing script, things
+# should continue to work as you expect. And, of course, you can freely
+# overwrite any of the functions or variables defined here before
+# calling anything to customize them.
 
-# func_normal_abspath PATH
-# Remove doubled-up and trailing slashes, "." path components,
-# and cancel out any ".." path components in PATH after making
-# it an absolute path.
-#             value returned in "$func_normal_abspath_result"
-func_normal_abspath ()
-{
-  # Start from root dir and reassemble the path.
-  func_normal_abspath_result=
-  func_normal_abspath_tpath=$1
-  func_normal_abspath_altnamespace=
-  case $func_normal_abspath_tpath in
-    "")
-      # Empty path, that just means $cwd.
-      func_stripname '' '/' "`pwd`"
-      func_normal_abspath_result=$func_stripname_result
-      return
-    ;;
-    # The next three entries are used to spot a run of precisely
-    # two leading slashes without using negated character classes;
-    # we take advantage of case's first-match behaviour.
-    ///*)
-      # Unusual form of absolute path, do nothing.
-    ;;
-    //*)
-      # Not necessarily an ordinary path; POSIX reserves leading '//'
-      # and for example Cygwin uses it to access remote file shares
-      # over CIFS/SMB, so we conserve a leading double slash if found.
-      func_normal_abspath_altnamespace=/
-    ;;
-    /*)
-      # Absolute path, do nothing.
-    ;;
-    *)
-      # Relative path, prepend $cwd.
-      func_normal_abspath_tpath=`pwd`/$func_normal_abspath_tpath
-    ;;
-  esac
-  # Cancel out all the simple stuff to save iterations.  We also want
-  # the path to end with a slash for ease of parsing, so make sure
-  # there is one (and only one) here.
-  func_normal_abspath_tpath=`$ECHO "$func_normal_abspath_tpath" | $SED \
-        -e "$removedotparts" -e "$collapseslashes" -e "$finalslash"`
-  while :; do
-    # Processed it all yet?
-    if test "$func_normal_abspath_tpath" = / ; then
-      # If we ascended to the root using ".." the result may be empty now.
-      if test -z "$func_normal_abspath_result" ; then
-        func_normal_abspath_result=/
-      fi
-      break
-    fi
-    func_normal_abspath_tcomponent=`$ECHO "$func_normal_abspath_tpath" | $SED \
-        -e "$pathcar"`
-    func_normal_abspath_tpath=`$ECHO "$func_normal_abspath_tpath" | $SED \
-        -e "$pathcdr"`
-    # Figure out what to do with it
-    case $func_normal_abspath_tcomponent in
-      "")
-        # Trailing empty path component, ignore it.
-      ;;
-      ..)
-        # Parent dir; strip last assembled component from result.
-        func_dirname "$func_normal_abspath_result"
-        func_normal_abspath_result=$func_dirname_result
-      ;;
-      *)
-        # Actual path component, append it.
-        func_normal_abspath_result=$func_normal_abspath_result/$func_normal_abspath_tcomponent
-      ;;
-    esac
-  done
-  # Restore leading double-slash if one was found on entry.
-  func_normal_abspath_result=$func_normal_abspath_altnamespace$func_normal_abspath_result
-}
+EXIT_SUCCESS=0
+EXIT_FAILURE=1
+EXIT_MISMATCH=63  # $? = 63 is used to indicate version mismatch to missing.
+EXIT_SKIP=77	  # $? = 77 is used to indicate a skipped test to automake.
 
-# func_relative_path SRCDIR DSTDIR
-# generates a relative path from SRCDIR to DSTDIR, with a trailing
-# slash if non-empty, suitable for immediately appending a filename
-# without needing to append a separator.
-#             value returned in "$func_relative_path_result"
-func_relative_path ()
-{
-  func_relative_path_result=
-  func_normal_abspath "$1"
-  func_relative_path_tlibdir=$func_normal_abspath_result
-  func_normal_abspath "$2"
-  func_relative_path_tbindir=$func_normal_abspath_result
-
-  # Ascend the tree starting from libdir
-  while :; do
-    # check if we have found a prefix of bindir
-    case $func_relative_path_tbindir in
-      $func_relative_path_tlibdir)
-        # found an exact match
-        func_relative_path_tcancelled=
-        break
-        ;;
-      $func_relative_path_tlibdir*)
-        # found a matching prefix
-        func_stripname "$func_relative_path_tlibdir" '' "$func_relative_path_tbindir"
-        func_relative_path_tcancelled=$func_stripname_result
-        if test -z "$func_relative_path_result"; then
-          func_relative_path_result=.
-        fi
-        break
-        ;;
-      *)
-        func_dirname $func_relative_path_tlibdir
-        func_relative_path_tlibdir=${func_dirname_result}
-        if test "x$func_relative_path_tlibdir" = x ; then
-          # Have to descend all the way to the root!
-          func_relative_path_result=../$func_relative_path_result
-          func_relative_path_tcancelled=$func_relative_path_tbindir
-          break
-        fi
-        func_relative_path_result=../$func_relative_path_result
-        ;;
-    esac
-  done
+# Allow overriding, eg assuming that you follow the convention of
+# putting '$debug_cmd' at the start of all your functions, you can get
+# bash to show function call trace with:
+#
+#    debug_cmd='eval echo "${FUNCNAME[0]} $*" >&2' bash your-script-name
+debug_cmd=${debug_cmd-":"}
+exit_cmd=:
 
-  # Now calculate path; take care to avoid doubling-up slashes.
-  func_stripname '' '/' "$func_relative_path_result"
-  func_relative_path_result=$func_stripname_result
-  func_stripname '/' '/' "$func_relative_path_tcancelled"
-  if test "x$func_stripname_result" != x ; then
-    func_relative_path_result=${func_relative_path_result}/${func_stripname_result}
-  fi
+# By convention, finish your script with:
+#
+#    exit $exit_status
+#
+# so that you can set exit_status to non-zero if you want to indicate
+# something went wrong during execution without actually bailing out at
+# the point of failure.
+exit_status=$EXIT_SUCCESS
 
-  # Normalisation. If bindir is libdir, return empty string,
-  # else relative path ending with a slash; either way, target
-  # file name can be directly appended.
-  if test ! -z "$func_relative_path_result"; then
-    func_stripname './' '' "$func_relative_path_result/"
-    func_relative_path_result=$func_stripname_result
-  fi
-}
+# Work around backward compatibility issue on IRIX 6.5. On IRIX 6.4+, sh
+# is ksh but when the shell is invoked as "sh" and the current value of
+# the _XPG environment variable is not equal to 1 (one), the special
+# positional parameter $0, within a function call, is the name of the
+# function.
+progpath=$0
 
-# The name of this program:
-func_dirname_and_basename "$progpath"
-progname=$func_basename_result
+# The name of this program.
+progname=`$ECHO "$progpath" |$SED "$sed_basename"`
 
-# Make sure we have an absolute path for reexecution:
+# Make sure we have an absolute progpath for reexecution:
 case $progpath in
   [\\/]*|[A-Za-z]:\\*) ;;
   *[\\/]*)
-     progdir=$func_dirname_result
+     progdir=`$ECHO "$progpath" |$SED "$sed_dirname"`
      progdir=`cd "$progdir" && pwd`
-     progpath="$progdir/$progname"
+     progpath=$progdir/$progname
      ;;
   *)
-     save_IFS="$IFS"
-     IFS=:
+     _G_IFS=$IFS
+     IFS=${PATH_SEPARATOR-:}
      for progdir in $PATH; do
-       IFS="$save_IFS"
+       IFS=$_G_IFS
        test -x "$progdir/$progname" && break
      done
-     IFS="$save_IFS"
+     IFS=$_G_IFS
      test -n "$progdir" || progdir=`pwd`
-     progpath="$progdir/$progname"
+     progpath=$progdir/$progname
      ;;
 esac
 
-# Sed substitution that helps us do robust quoting.  It backslashifies
-# metacharacters that are still active within double-quoted strings.
-Xsed="${SED}"' -e 1s/^X//'
-sed_quote_subst='s/\([`"$\\]\)/\\\1/g'
 
-# Same as above, but do not quote variable references.
-double_quote_subst='s/\(["`\\]\)/\\\1/g'
+## ----------------- ##
+## Standard options. ##
+## ----------------- ##
+
+# The following options affect the operation of the functions defined
+# below, and should be set appropriately depending on run-time para-
+# meters passed on the command line.
 
-# Sed substitution that turns a string into a regex matching for the
-# string literally.
-sed_make_literal_regex='s,[].[^$\\*\/],\\&,g'
-
-# Sed substitution that converts a w32 file name or path
-# which contains forward slashes, into one that contains
-# (escaped) backslashes.  A very naive implementation.
-lt_sed_naive_backslashify='s|\\\\*|\\|g;s|/|\\|g;s|\\|\\\\|g'
-
-# Re-`\' parameter expansions in output of double_quote_subst that were
-# `\'-ed in input to the same.  If an odd number of `\' preceded a '$'
-# in input to double_quote_subst, that '$' was protected from expansion.
-# Since each input `\' is now two `\'s, look for any number of runs of
-# four `\'s followed by two `\'s and then a '$'.  `\' that '$'.
-bs='\\'
-bs2='\\\\'
-bs4='\\\\\\\\'
-dollar='\$'
-sed_double_backslash="\
-  s/$bs4/&\\
-/g
-  s/^$bs2$dollar/$bs&/
-  s/\\([^$bs]\\)$bs2$dollar/\\1$bs2$bs$dollar/g
-  s/\n//g"
-
-# Standard options:
 opt_dry_run=false
-opt_help=false
 opt_quiet=false
 opt_verbose=false
-opt_warning=:
 
-# func_echo arg...
-# Echo program name prefixed message, along with the current mode
-# name if it has been set yet.
-func_echo ()
-{
-    $ECHO "$progname: ${opt_mode+$opt_mode: }$*"
+# Categories 'all' and 'none' are always available.  Append any others
+# you will pass as the first argument to func_warning from your own
+# code.
+warning_categories=
+
+# By default, display warnings according to 'opt_warning_types'.  Set
+# 'warning_func'  to ':' to elide all warnings, or func_fatal_error to
+# treat the next displayed warning as a fatal error.
+warning_func=func_warn_and_continue
+
+# Set to 'all' to display all warnings, 'none' to suppress all
+# warnings, or a space delimited list of some subset of
+# 'warning_categories' to display only the listed warnings.
+opt_warning_types=all
+
+
+## -------------------- ##
+## Resource management. ##
+## -------------------- ##
+
+# This section contains definitions for functions that each ensure a
+# particular resource (a file, or a non-empty configuration variable for
+# example) is available, and if appropriate to extract default values
+# from pertinent package files. Call them using their associated
+# 'require_*' variable to ensure that they are executed, at most, once.
+#
+# It's entirely deliberate that calling these functions can set
+# variables that don't obey the namespace limitations obeyed by the rest
+# of this file, in order that that they be as useful as possible to
+# callers.
+
+
+# require_term_colors
+# -------------------
+# Allow display of bold text on terminals that support it.
+require_term_colors=func_require_term_colors
+func_require_term_colors ()
+{
+    $debug_cmd
+
+    test -t 1 && {
+      # COLORTERM and USE_ANSI_COLORS environment variables take
+      # precedence, because most terminfo databases neglect to describe
+      # whether color sequences are supported.
+      test -n "${COLORTERM+set}" && : ${USE_ANSI_COLORS="1"}
+
+      if test 1 = "$USE_ANSI_COLORS"; then
+        # Standard ANSI escape sequences
+        tc_reset='[0m'
+        tc_bold='[1m';   tc_standout='[7m'
+        tc_red='[31m';   tc_green='[32m'
+        tc_blue='[34m';  tc_cyan='[36m'
+      else
+        # Otherwise trust the terminfo database after all.
+        test -n "`tput sgr0 2>/dev/null`" && {
+          tc_reset=`tput sgr0`
+          test -n "`tput bold 2>/dev/null`" && tc_bold=`tput bold`
+          tc_standout=$tc_bold
+          test -n "`tput smso 2>/dev/null`" && tc_standout=`tput smso`
+          test -n "`tput setaf 1 2>/dev/null`" && tc_red=`tput setaf 1`
+          test -n "`tput setaf 2 2>/dev/null`" && tc_green=`tput setaf 2`
+          test -n "`tput setaf 4 2>/dev/null`" && tc_blue=`tput setaf 4`
+          test -n "`tput setaf 5 2>/dev/null`" && tc_cyan=`tput setaf 5`
+        }
+      fi
+    }
+
+    require_term_colors=:
 }
 
-# func_verbose arg...
-# Echo program name prefixed message in verbose mode only.
-func_verbose ()
+
+## ----------------- ##
+## Function library. ##
+## ----------------- ##
+
+# This section contains a variety of useful functions to call in your
+# scripts. Take note of the portable wrappers for features provided by
+# some modern shells, which will fall back to slower equivalents on
+# less featureful shells.
+
+
+# func_append VAR VALUE
+# ---------------------
+# Append VALUE onto the existing contents of VAR.
+
+  # We should try to minimise forks, especially on Windows where they are
+  # unreasonably slow, so skip the feature probes when bash or zsh are
+  # being used:
+  if test set = "${BASH_VERSION+set}${ZSH_VERSION+set}"; then
+    : ${_G_HAVE_ARITH_OP="yes"}
+    : ${_G_HAVE_XSI_OPS="yes"}
+    # The += operator was introduced in bash 3.1
+    case $BASH_VERSION in
+      [12].* | 3.0 | 3.0*) ;;
+      *)
+        : ${_G_HAVE_PLUSEQ_OP="yes"}
+        ;;
+    esac
+  fi
+
+  # _G_HAVE_PLUSEQ_OP
+  # Can be empty, in which case the shell is probed, "yes" if += is
+  # useable or anything else if it does not work.
+  test -z "$_G_HAVE_PLUSEQ_OP" \
+    && (eval 'x=a; x+=" b"; test "a b" = "$x"') 2>/dev/null \
+    && _G_HAVE_PLUSEQ_OP=yes
+
+if test yes = "$_G_HAVE_PLUSEQ_OP"
+then
+  # This is an XSI compatible shell, allowing a faster implementation...
+  eval 'func_append ()
+  {
+    $debug_cmd
+
+    eval "$1+=\$2"
+  }'
+else
+  # ...otherwise fall back to using expr, which is often a shell builtin.
+  func_append ()
+  {
+    $debug_cmd
+
+    eval "$1=\$$1\$2"
+  }
+fi
+
+
+# func_append_quoted VAR VALUE
+# ----------------------------
+# Quote VALUE and append to the end of shell variable VAR, separated
+# by a space.
+if test yes = "$_G_HAVE_PLUSEQ_OP"; then
+  eval 'func_append_quoted ()
+  {
+    $debug_cmd
+
+    func_quote_for_eval "$2"
+    eval "$1+=\\ \$func_quote_for_eval_result"
+  }'
+else
+  func_append_quoted ()
+  {
+    $debug_cmd
+
+    func_quote_for_eval "$2"
+    eval "$1=\$$1\\ \$func_quote_for_eval_result"
+  }
+fi
+
+
+# func_append_uniq VAR VALUE
+# --------------------------
+# Append unique VALUE onto the existing contents of VAR, assuming
+# entries are delimited by the first character of VALUE.  For example:
+#
+#   func_append_uniq options " --another-option option-argument"
+#
+# will only append to $options if " --another-option option-argument "
+# is not already present somewhere in $options already (note spaces at
+# each end implied by leading space in second argument).
+func_append_uniq ()
+{
+    $debug_cmd
+
+    eval _G_current_value='`$ECHO $'$1'`'
+    _G_delim=`expr "$2" : '\(.\)'`
+
+    case $_G_delim$_G_current_value$_G_delim in
+      *"$2$_G_delim"*) ;;
+      *) func_append "$@" ;;
+    esac
+}
+
+
+# func_arith TERM...
+# ------------------
+# Set func_arith_result to the result of evaluating TERMs.
+  test -z "$_G_HAVE_ARITH_OP" \
+    && (eval 'test 2 = $(( 1 + 1 ))') 2>/dev/null \
+    && _G_HAVE_ARITH_OP=yes
+
+if test yes = "$_G_HAVE_ARITH_OP"; then
+  eval 'func_arith ()
+  {
+    $debug_cmd
+
+    func_arith_result=$(( $* ))
+  }'
+else
+  func_arith ()
+  {
+    $debug_cmd
+
+    func_arith_result=`expr "$@"`
+  }
+fi
+
+
+# func_basename FILE
+# ------------------
+# Set func_basename_result to FILE with everything up to and including
+# the last / stripped.
+if test yes = "$_G_HAVE_XSI_OPS"; then
+  # If this shell supports suffix pattern removal, then use it to avoid
+  # forking. Hide the definitions single quotes in case the shell chokes
+  # on unsupported syntax...
+  _b='func_basename_result=${1##*/}'
+  _d='case $1 in
+        */*) func_dirname_result=${1%/*}$2 ;;
+        *  ) func_dirname_result=$3        ;;
+      esac'
+
+else
+  # ...otherwise fall back to using sed.
+  _b='func_basename_result=`$ECHO "$1" |$SED "$sed_basename"`'
+  _d='func_dirname_result=`$ECHO "$1"  |$SED "$sed_dirname"`
+      if test "X$func_dirname_result" = "X$1"; then
+        func_dirname_result=$3
+      else
+        func_append func_dirname_result "$2"
+      fi'
+fi
+
+eval 'func_basename ()
 {
-    $opt_verbose && func_echo ${1+"$@"}
+    $debug_cmd
 
-    # A bug in bash halts the script if the last line of a function
-    # fails when set -e is in force, so we need another command to
-    # work around that:
-    :
+    '"$_b"'
+}'
+
+
+# func_dirname FILE APPEND NONDIR_REPLACEMENT
+# -------------------------------------------
+# Compute the dirname of FILE.  If nonempty, add APPEND to the result,
+# otherwise set result to NONDIR_REPLACEMENT.
+eval 'func_dirname ()
+{
+    $debug_cmd
+
+    '"$_d"'
+}'
+
+
+# func_dirname_and_basename FILE APPEND NONDIR_REPLACEMENT
+# --------------------------------------------------------
+# Perform func_basename and func_dirname in a single function
+# call:
+#   dirname:  Compute the dirname of FILE.  If nonempty,
+#             add APPEND to the result, otherwise set result
+#             to NONDIR_REPLACEMENT.
+#             value returned in "$func_dirname_result"
+#   basename: Compute filename of FILE.
+#             value retuned in "$func_basename_result"
+# For efficiency, we do not delegate to the functions above but instead
+# duplicate the functionality here.
+eval 'func_dirname_and_basename ()
+{
+    $debug_cmd
+
+    '"$_b"'
+    '"$_d"'
+}'
+
+
+# func_echo ARG...
+# ----------------
+# Echo program name prefixed message.
+func_echo ()
+{
+    $debug_cmd
+
+    _G_message=$*
+
+    func_echo_IFS=$IFS
+    IFS=$nl
+    for _G_line in $_G_message; do
+      IFS=$func_echo_IFS
+      $ECHO "$progname: $_G_line"
+    done
+    IFS=$func_echo_IFS
 }
 
-# func_echo_all arg...
+
+# func_echo_all ARG...
+# --------------------
 # Invoke $ECHO with all args, space-separated.
 func_echo_all ()
 {
     $ECHO "$*"
 }
 
-# func_error arg...
+
+# func_echo_infix_1 INFIX ARG...
+# ------------------------------
+# Echo program name, followed by INFIX on the first line, with any
+# additional lines not showing INFIX.
+func_echo_infix_1 ()
+{
+    $debug_cmd
+
+    $require_term_colors
+
+    _G_infix=$1; shift
+    _G_indent=$_G_infix
+    _G_prefix="$progname: $_G_infix: "
+    _G_message=$*
+
+    # Strip color escape sequences before counting printable length
+    for _G_tc in "$tc_reset" "$tc_bold" "$tc_standout" "$tc_red" "$tc_green" "$tc_blue" "$tc_cyan"
+    do
+      test -n "$_G_tc" && {
+        _G_esc_tc=`$ECHO "$_G_tc" | $SED "$sed_make_literal_regex"`
+        _G_indent=`$ECHO "$_G_indent" | $SED "s|$_G_esc_tc||g"`
+      }
+    done
+    _G_indent="$progname: "`echo "$_G_indent" | $SED 's|.| |g'`"  " ## exclude from sc_prohibit_nested_quotes
+
+    func_echo_infix_1_IFS=$IFS
+    IFS=$nl
+    for _G_line in $_G_message; do
+      IFS=$func_echo_infix_1_IFS
+      $ECHO "$_G_prefix$tc_bold$_G_line$tc_reset" >&2
+      _G_prefix=$_G_indent
+    done
+    IFS=$func_echo_infix_1_IFS
+}
+
+
+# func_error ARG...
+# -----------------
 # Echo program name prefixed message to standard error.
 func_error ()
 {
-    $ECHO "$progname: ${opt_mode+$opt_mode: }"${1+"$@"} 1>&2
-}
+    $debug_cmd
 
-# func_warning arg...
-# Echo program name prefixed warning message to standard error.
-func_warning ()
-{
-    $opt_warning && $ECHO "$progname: ${opt_mode+$opt_mode: }warning: "${1+"$@"} 1>&2
+    $require_term_colors
 
-    # bash bug again:
-    :
+    func_echo_infix_1 "  $tc_standout${tc_red}error$tc_reset" "$*" >&2
 }
 
-# func_fatal_error arg...
+
+# func_fatal_error ARG...
+# -----------------------
 # Echo program name prefixed message to standard error, and exit.
 func_fatal_error ()
 {
-    func_error ${1+"$@"}
-    exit $EXIT_FAILURE
-}
+    $debug_cmd
 
-# func_fatal_help arg...
-# Echo program name prefixed message to standard error, followed by
-# a help hint, and exit.
-func_fatal_help ()
-{
-    func_error ${1+"$@"}
-    func_fatal_error "$help"
+    func_error "$*"
+    exit $EXIT_FAILURE
 }
-help="Try \`$progname --help' for more information."  ## default
 
 
-# func_grep expression filename
+# func_grep EXPRESSION FILENAME
+# -----------------------------
 # Check whether EXPRESSION matches any line of FILENAME, without output.
 func_grep ()
 {
+    $debug_cmd
+
     $GREP "$1" "$2" >/dev/null 2>&1
 }
 
 
-# func_mkdir_p directory-path
+# func_len STRING
+# ---------------
+# Set func_len_result to the length of STRING. STRING may not
+# start with a hyphen.
+  test -z "$_G_HAVE_XSI_OPS" \
+    && (eval 'x=a/b/c;
+      test 5aa/bb/cc = "${#x}${x%%/*}${x%/*}${x#*/}${x##*/}"') 2>/dev/null \
+    && _G_HAVE_XSI_OPS=yes
+
+if test yes = "$_G_HAVE_XSI_OPS"; then
+  eval 'func_len ()
+  {
+    $debug_cmd
+
+    func_len_result=${#1}
+  }'
+else
+  func_len ()
+  {
+    $debug_cmd
+
+    func_len_result=`expr "$1" : ".*" 2>/dev/null || echo $max_cmd_len`
+  }
+fi
+
+
+# func_mkdir_p DIRECTORY-PATH
+# ---------------------------
 # Make sure the entire path to DIRECTORY-PATH is available.
 func_mkdir_p ()
 {
-    my_directory_path="$1"
-    my_dir_list=
+    $debug_cmd
+
+    _G_directory_path=$1
+    _G_dir_list=
 
-    if test -n "$my_directory_path" && test "$opt_dry_run" != ":"; then
+    if test -n "$_G_directory_path" && test : != "$opt_dry_run"; then
 
-      # Protect directory names starting with `-'
-      case $my_directory_path in
-        -*) my_directory_path="./$my_directory_path" ;;
+      # Protect directory names starting with '-'
+      case $_G_directory_path in
+        -*) _G_directory_path=./$_G_directory_path ;;
       esac
 
       # While some portion of DIR does not yet exist...
-      while test ! -d "$my_directory_path"; do
+      while test ! -d "$_G_directory_path"; do
         # ...make a list in topmost first order.  Use a colon delimited
 	# list incase some portion of path contains whitespace.
-        my_dir_list="$my_directory_path:$my_dir_list"
+        _G_dir_list=$_G_directory_path:$_G_dir_list
 
         # If the last portion added has no slash in it, the list is done
-        case $my_directory_path in */*) ;; *) break ;; esac
+        case $_G_directory_path in */*) ;; *) break ;; esac
 
         # ...otherwise throw away the child directory and loop
-        my_directory_path=`$ECHO "$my_directory_path" | $SED -e "$dirname"`
+        _G_directory_path=`$ECHO "$_G_directory_path" | $SED -e "$sed_dirname"`
       done
-      my_dir_list=`$ECHO "$my_dir_list" | $SED 's,:*$,,'`
+      _G_dir_list=`$ECHO "$_G_dir_list" | $SED 's|:*$||'`
 
-      save_mkdir_p_IFS="$IFS"; IFS=':'
-      for my_dir in $my_dir_list; do
-	IFS="$save_mkdir_p_IFS"
-        # mkdir can fail with a `File exist' error if two processes
+      func_mkdir_p_IFS=$IFS; IFS=:
+      for _G_dir in $_G_dir_list; do
+	IFS=$func_mkdir_p_IFS
+        # mkdir can fail with a 'File exist' error if two processes
         # try to create one of the directories concurrently.  Don't
         # stop in that case!
-        $MKDIR "$my_dir" 2>/dev/null || :
+        $MKDIR "$_G_dir" 2>/dev/null || :
       done
-      IFS="$save_mkdir_p_IFS"
+      IFS=$func_mkdir_p_IFS
 
       # Bail out if we (or some other process) failed to create a directory.
-      test -d "$my_directory_path" || \
-        func_fatal_error "Failed to create \`$1'"
+      test -d "$_G_directory_path" || \
+        func_fatal_error "Failed to create '$1'"
     fi
 }
 
 
-# func_mktempdir [string]
+# func_mktempdir [BASENAME]
+# -------------------------
 # Make a temporary directory that won't clash with other running
 # libtool processes, and avoids race conditions if possible.  If
-# given, STRING is the basename for that directory.
+# given, BASENAME is the basename for that directory.
 func_mktempdir ()
 {
-    my_template="${TMPDIR-/tmp}/${1-$progname}"
+    $debug_cmd
 
-    if test "$opt_dry_run" = ":"; then
+    _G_template=${TMPDIR-/tmp}/${1-$progname}
+
+    if test : = "$opt_dry_run"; then
       # Return a directory name, but don't create it in dry-run mode
-      my_tmpdir="${my_template}-$$"
+      _G_tmpdir=$_G_template-$$
     else
 
       # If mktemp works, use that first and foremost
-      my_tmpdir=`mktemp -d "${my_template}-XXXXXXXX" 2>/dev/null`
+      _G_tmpdir=`mktemp -d "$_G_template-XXXXXXXX" 2>/dev/null`
 
-      if test ! -d "$my_tmpdir"; then
+      if test ! -d "$_G_tmpdir"; then
         # Failing that, at least try and use $RANDOM to avoid a race
-        my_tmpdir="${my_template}-${RANDOM-0}$$"
+        _G_tmpdir=$_G_template-${RANDOM-0}$$
 
-        save_mktempdir_umask=`umask`
+        func_mktempdir_umask=`umask`
         umask 0077
-        $MKDIR "$my_tmpdir"
-        umask $save_mktempdir_umask
+        $MKDIR "$_G_tmpdir"
+        umask $func_mktempdir_umask
       fi
 
       # If we're not in dry-run mode, bomb out on failure
-      test -d "$my_tmpdir" || \
-        func_fatal_error "cannot create temporary directory \`$my_tmpdir'"
+      test -d "$_G_tmpdir" || \
+        func_fatal_error "cannot create temporary directory '$_G_tmpdir'"
     fi
 
-    $ECHO "$my_tmpdir"
+    $ECHO "$_G_tmpdir"
 }
 
 
-# func_quote_for_eval arg
-# Aesthetically quote ARG to be evaled later.
-# This function returns two values: FUNC_QUOTE_FOR_EVAL_RESULT
-# is double-quoted, suitable for a subsequent eval, whereas
-# FUNC_QUOTE_FOR_EVAL_UNQUOTED_RESULT has merely all characters
-# which are still active within double quotes backslashified.
-func_quote_for_eval ()
+# func_normal_abspath PATH
+# ------------------------
+# Remove doubled-up and trailing slashes, "." path components,
+# and cancel out any ".." path components in PATH after making
+# it an absolute path.
+func_normal_abspath ()
 {
-    case $1 in
-      *[\\\`\"\$]*)
-	func_quote_for_eval_unquoted_result=`$ECHO "$1" | $SED "$sed_quote_subst"` ;;
-      *)
-        func_quote_for_eval_unquoted_result="$1" ;;
-    esac
+    $debug_cmd
 
-    case $func_quote_for_eval_unquoted_result in
-      # Double-quote args containing shell metacharacters to delay
-      # word splitting, command substitution and and variable
-      # expansion for a subsequent eval.
-      # Many Bourne shells cannot handle close brackets correctly
-      # in scan sets, so we specify it separately.
-      *[\[\~\#\^\&\*\(\)\{\}\|\;\<\>\?\'\ \	]*|*]*|"")
-        func_quote_for_eval_result="\"$func_quote_for_eval_unquoted_result\""
+    # These SED scripts presuppose an absolute path with a trailing slash.
+    _G_pathcar='s|^/\([^/]*\).*$|\1|'
+    _G_pathcdr='s|^/[^/]*||'
+    _G_removedotparts=':dotsl
+		s|/\./|/|g
+		t dotsl
+		s|/\.$|/|'
+    _G_collapseslashes='s|/\{1,\}|/|g'
+    _G_finalslash='s|/*$|/|'
+
+    # Start from root dir and reassemble the path.
+    func_normal_abspath_result=
+    func_normal_abspath_tpath=$1
+    func_normal_abspath_altnamespace=
+    case $func_normal_abspath_tpath in
+      "")
+        # Empty path, that just means $cwd.
+        func_stripname '' '/' "`pwd`"
+        func_normal_abspath_result=$func_stripname_result
+        return
+        ;;
+      # The next three entries are used to spot a run of precisely
+      # two leading slashes without using negated character classes;
+      # we take advantage of case's first-match behaviour.
+      ///*)
+        # Unusual form of absolute path, do nothing.
+        ;;
+      //*)
+        # Not necessarily an ordinary path; POSIX reserves leading '//'
+        # and for example Cygwin uses it to access remote file shares
+        # over CIFS/SMB, so we conserve a leading double slash if found.
+        func_normal_abspath_altnamespace=/
+        ;;
+      /*)
+        # Absolute path, do nothing.
         ;;
       *)
-        func_quote_for_eval_result="$func_quote_for_eval_unquoted_result"
+        # Relative path, prepend $cwd.
+        func_normal_abspath_tpath=`pwd`/$func_normal_abspath_tpath
+        ;;
     esac
+
+    # Cancel out all the simple stuff to save iterations.  We also want
+    # the path to end with a slash for ease of parsing, so make sure
+    # there is one (and only one) here.
+    func_normal_abspath_tpath=`$ECHO "$func_normal_abspath_tpath" | $SED \
+          -e "$_G_removedotparts" -e "$_G_collapseslashes" -e "$_G_finalslash"`
+    while :; do
+      # Processed it all yet?
+      if test / = "$func_normal_abspath_tpath"; then
+        # If we ascended to the root using ".." the result may be empty now.
+        if test -z "$func_normal_abspath_result"; then
+          func_normal_abspath_result=/
+        fi
+        break
+      fi
+      func_normal_abspath_tcomponent=`$ECHO "$func_normal_abspath_tpath" | $SED \
+          -e "$_G_pathcar"`
+      func_normal_abspath_tpath=`$ECHO "$func_normal_abspath_tpath" | $SED \
+          -e "$_G_pathcdr"`
+      # Figure out what to do with it
+      case $func_normal_abspath_tcomponent in
+        "")
+          # Trailing empty path component, ignore it.
+          ;;
+        ..)
+          # Parent dir; strip last assembled component from result.
+          func_dirname "$func_normal_abspath_result"
+          func_normal_abspath_result=$func_dirname_result
+          ;;
+        *)
+          # Actual path component, append it.
+          func_append func_normal_abspath_result "/$func_normal_abspath_tcomponent"
+          ;;
+      esac
+    done
+    # Restore leading double-slash if one was found on entry.
+    func_normal_abspath_result=$func_normal_abspath_altnamespace$func_normal_abspath_result
+}
+
+
+# func_notquiet ARG...
+# --------------------
+# Echo program name prefixed message only when not in quiet mode.
+func_notquiet ()
+{
+    $debug_cmd
+
+    $opt_quiet || func_echo ${1+"$@"}
+
+    # A bug in bash halts the script if the last line of a function
+    # fails when set -e is in force, so we need another command to
+    # work around that:
+    :
+}
+
+
+# func_relative_path SRCDIR DSTDIR
+# --------------------------------
+# Set func_relative_path_result to the relative path from SRCDIR to DSTDIR.
+func_relative_path ()
+{
+    $debug_cmd
+
+    func_relative_path_result=
+    func_normal_abspath "$1"
+    func_relative_path_tlibdir=$func_normal_abspath_result
+    func_normal_abspath "$2"
+    func_relative_path_tbindir=$func_normal_abspath_result
+
+    # Ascend the tree starting from libdir
+    while :; do
+      # check if we have found a prefix of bindir
+      case $func_relative_path_tbindir in
+        $func_relative_path_tlibdir)
+          # found an exact match
+          func_relative_path_tcancelled=
+          break
+          ;;
+        $func_relative_path_tlibdir*)
+          # found a matching prefix
+          func_stripname "$func_relative_path_tlibdir" '' "$func_relative_path_tbindir"
+          func_relative_path_tcancelled=$func_stripname_result
+          if test -z "$func_relative_path_result"; then
+            func_relative_path_result=.
+          fi
+          break
+          ;;
+        *)
+          func_dirname $func_relative_path_tlibdir
+          func_relative_path_tlibdir=$func_dirname_result
+          if test -z "$func_relative_path_tlibdir"; then
+            # Have to descend all the way to the root!
+            func_relative_path_result=../$func_relative_path_result
+            func_relative_path_tcancelled=$func_relative_path_tbindir
+            break
+          fi
+          func_relative_path_result=../$func_relative_path_result
+          ;;
+      esac
+    done
+
+    # Now calculate path; take care to avoid doubling-up slashes.
+    func_stripname '' '/' "$func_relative_path_result"
+    func_relative_path_result=$func_stripname_result
+    func_stripname '/' '/' "$func_relative_path_tcancelled"
+    if test -n "$func_stripname_result"; then
+      func_append func_relative_path_result "/$func_stripname_result"
+    fi
+
+    # Normalisation. If bindir is libdir, return '.' else relative path.
+    if test -n "$func_relative_path_result"; then
+      func_stripname './' '' "$func_relative_path_result"
+      func_relative_path_result=$func_stripname_result
+    fi
+
+    test -n "$func_relative_path_result" || func_relative_path_result=.
+
+    :
 }
 
 
-# func_quote_for_expand arg
+# func_quote_for_eval ARG...
+# --------------------------
+# Aesthetically quote ARGs to be evaled later.
+# This function returns two values:
+#   i) func_quote_for_eval_result
+#      double-quoted, suitable for a subsequent eval
+#  ii) func_quote_for_eval_unquoted_result
+#      has all characters that are still active within double
+#      quotes backslashified.
+func_quote_for_eval ()
+{
+    $debug_cmd
+
+    func_quote_for_eval_unquoted_result=
+    func_quote_for_eval_result=
+    while test 0 -lt $#; do
+      case $1 in
+        *[\\\`\"\$]*)
+	  _G_unquoted_arg=`printf '%s\n' "$1" |$SED "$sed_quote_subst"` ;;
+        *)
+          _G_unquoted_arg=$1 ;;
+      esac
+      if test -n "$func_quote_for_eval_unquoted_result"; then
+	func_append func_quote_for_eval_unquoted_result " $_G_unquoted_arg"
+      else
+        func_append func_quote_for_eval_unquoted_result "$_G_unquoted_arg"
+      fi
+
+      case $_G_unquoted_arg in
+        # Double-quote args containing shell metacharacters to delay
+        # word splitting, command substitution and variable expansion
+        # for a subsequent eval.
+        # Many Bourne shells cannot handle close brackets correctly
+        # in scan sets, so we specify it separately.
+        *[\[\~\#\^\&\*\(\)\{\}\|\;\<\>\?\'\ \	]*|*]*|"")
+          _G_quoted_arg=\"$_G_unquoted_arg\"
+          ;;
+        *)
+          _G_quoted_arg=$_G_unquoted_arg
+	  ;;
+      esac
+
+      if test -n "$func_quote_for_eval_result"; then
+	func_append func_quote_for_eval_result " $_G_quoted_arg"
+      else
+        func_append func_quote_for_eval_result "$_G_quoted_arg"
+      fi
+      shift
+    done
+}
+
+
+# func_quote_for_expand ARG
+# -------------------------
 # Aesthetically quote ARG to be evaled later; same as above,
 # but do not quote variable references.
 func_quote_for_expand ()
 {
+    $debug_cmd
+
     case $1 in
       *[\\\`\"]*)
-	my_arg=`$ECHO "$1" | $SED \
-	    -e "$double_quote_subst" -e "$sed_double_backslash"` ;;
+	_G_arg=`$ECHO "$1" | $SED \
+	    -e "$sed_double_quote_subst" -e "$sed_double_backslash"` ;;
       *)
-        my_arg="$1" ;;
+        _G_arg=$1 ;;
     esac
 
-    case $my_arg in
+    case $_G_arg in
       # Double-quote args containing shell metacharacters to delay
       # word splitting and command substitution for a subsequent eval.
       # Many Bourne shells cannot handle close brackets correctly
       # in scan sets, so we specify it separately.
       *[\[\~\#\^\&\*\(\)\{\}\|\;\<\>\?\'\ \	]*|*]*|"")
-        my_arg="\"$my_arg\""
+        _G_arg=\"$_G_arg\"
         ;;
     esac
 
-    func_quote_for_expand_result="$my_arg"
+    func_quote_for_expand_result=$_G_arg
 }
 
 
-# func_show_eval cmd [fail_exp]
-# Unless opt_silent is true, then output CMD.  Then, if opt_dryrun is
+# func_stripname PREFIX SUFFIX NAME
+# ---------------------------------
+# strip PREFIX and SUFFIX from NAME, and store in func_stripname_result.
+# PREFIX and SUFFIX must not contain globbing or regex special
+# characters, hashes, percent signs, but SUFFIX may contain a leading
+# dot (in which case that matches only a dot).
+if test yes = "$_G_HAVE_XSI_OPS"; then
+  eval 'func_stripname ()
+  {
+    $debug_cmd
+
+    # pdksh 5.2.14 does not do ${X%$Y} correctly if both X and Y are
+    # positional parameters, so assign one to ordinary variable first.
+    func_stripname_result=$3
+    func_stripname_result=${func_stripname_result#"$1"}
+    func_stripname_result=${func_stripname_result%"$2"}
+  }'
+else
+  func_stripname ()
+  {
+    $debug_cmd
+
+    case $2 in
+      .*) func_stripname_result=`$ECHO "$3" | $SED -e "s%^$1%%" -e "s%\\\\$2\$%%"`;;
+      *)  func_stripname_result=`$ECHO "$3" | $SED -e "s%^$1%%" -e "s%$2\$%%"`;;
+    esac
+  }
+fi
+
+
+# func_show_eval CMD [FAIL_EXP]
+# -----------------------------
+# Unless opt_quiet is true, then output CMD.  Then, if opt_dryrun is
 # not true, evaluate CMD.  If the evaluation of CMD fails, and FAIL_EXP
 # is given, then evaluate it.
 func_show_eval ()
 {
-    my_cmd="$1"
-    my_fail_exp="${2-:}"
+    $debug_cmd
 
-    ${opt_silent-false} || {
-      func_quote_for_expand "$my_cmd"
-      eval "func_echo $func_quote_for_expand_result"
-    }
+    _G_cmd=$1
+    _G_fail_exp=${2-':'}
+
+    func_quote_for_expand "$_G_cmd"
+    eval "func_notquiet $func_quote_for_expand_result"
 
-    if ${opt_dry_run-false}; then :; else
-      eval "$my_cmd"
-      my_status=$?
-      if test "$my_status" -eq 0; then :; else
-	eval "(exit $my_status); $my_fail_exp"
+    $opt_dry_run || {
+      eval "$_G_cmd"
+      _G_status=$?
+      if test 0 -ne "$_G_status"; then
+	eval "(exit $_G_status); $_G_fail_exp"
       fi
-    fi
+    }
 }
 
 
-# func_show_eval_locale cmd [fail_exp]
-# Unless opt_silent is true, then output CMD.  Then, if opt_dryrun is
+# func_show_eval_locale CMD [FAIL_EXP]
+# ------------------------------------
+# Unless opt_quiet is true, then output CMD.  Then, if opt_dryrun is
 # not true, evaluate CMD.  If the evaluation of CMD fails, and FAIL_EXP
 # is given, then evaluate it.  Use the saved locale for evaluation.
 func_show_eval_locale ()
 {
-    my_cmd="$1"
-    my_fail_exp="${2-:}"
+    $debug_cmd
+
+    _G_cmd=$1
+    _G_fail_exp=${2-':'}
 
-    ${opt_silent-false} || {
-      func_quote_for_expand "$my_cmd"
+    $opt_quiet || {
+      func_quote_for_expand "$_G_cmd"
       eval "func_echo $func_quote_for_expand_result"
     }
 
-    if ${opt_dry_run-false}; then :; else
-      eval "$lt_user_locale
-	    $my_cmd"
-      my_status=$?
-      eval "$lt_safe_locale"
-      if test "$my_status" -eq 0; then :; else
-	eval "(exit $my_status); $my_fail_exp"
+    $opt_dry_run || {
+      eval "$_G_user_locale
+	    $_G_cmd"
+      _G_status=$?
+      eval "$_G_safe_locale"
+      if test 0 -ne "$_G_status"; then
+	eval "(exit $_G_status); $_G_fail_exp"
       fi
-    fi
+    }
 }
 
+
 # func_tr_sh
+# ----------
 # Turn $1 into a string suitable for a shell variable name.
 # Result is stored in $func_tr_sh_result.  All characters
 # not in the set a-zA-Z0-9_ are replaced with '_'. Further,
 # if $1 begins with a digit, a '_' is prepended as well.
 func_tr_sh ()
 {
-  case $1 in
-  [0-9]* | *[!a-zA-Z0-9_]*)
-    func_tr_sh_result=`$ECHO "$1" | $SED 's/^\([0-9]\)/_\1/; s/[^a-zA-Z0-9_]/_/g'`
-    ;;
-  * )
-    func_tr_sh_result=$1
-    ;;
-  esac
+    $debug_cmd
+
+    case $1 in
+    [0-9]* | *[!a-zA-Z0-9_]*)
+      func_tr_sh_result=`$ECHO "$1" | $SED -e 's/^\([0-9]\)/_\1/' -e 's/[^a-zA-Z0-9_]/_/g'`
+      ;;
+    * )
+      func_tr_sh_result=$1
+      ;;
+    esac
 }
 
 
-# func_version
-# Echo version message to standard output and exit.
-func_version ()
+# func_verbose ARG...
+# -------------------
+# Echo program name prefixed message in verbose mode only.
+func_verbose ()
 {
-    $opt_debug
+    $debug_cmd
 
-    $SED -n '/(C)/!b go
-	:more
-	/\./!{
-	  N
-	  s/\n# / /
-	  b more
-	}
-	:go
-	/^# '$PROGRAM' (GNU /,/# warranty; / {
-        s/^# //
-	s/^# *$//
-        s/\((C)\)[ 0-9,-]*\( [1-9][0-9]*\)/\1\2/
-        p
-     }' < "$progpath"
-     exit $?
+    $opt_verbose && func_echo "$*"
+
+    :
 }
 
-# func_usage
-# Echo short help message to standard output and exit.
-func_usage ()
+
+# func_warn_and_continue ARG...
+# -----------------------------
+# Echo program name prefixed warning message to standard error.
+func_warn_and_continue ()
 {
-    $opt_debug
+    $debug_cmd
 
-    $SED -n '/^# Usage:/,/^#  *.*--help/ {
-        s/^# //
-	s/^# *$//
-	s/\$progname/'$progname'/
-	p
-    }' < "$progpath"
-    echo
-    $ECHO "run \`$progname --help | more' for full usage"
-    exit $?
+    $require_term_colors
+
+    func_echo_infix_1 "${tc_red}warning$tc_reset" "$*" >&2
 }
 
-# func_help [NOEXIT]
-# Echo long help message to standard output and exit,
-# unless 'noexit' is passed as argument.
+
+# func_warning CATEGORY ARG...
+# ----------------------------
+# Echo program name prefixed warning message to standard error. Warning
+# messages can be filtered according to CATEGORY, where this function
+# elides messages where CATEGORY is not listed in the global variable
+# 'opt_warning_types'.
+func_warning ()
+{
+    $debug_cmd
+
+    # CATEGORY must be in the warning_categories list!
+    case " $warning_categories " in
+      *" $1 "*) ;;
+      *) func_internal_error "invalid warning category '$1'" ;;
+    esac
+
+    _G_category=$1
+    shift
+
+    case " $opt_warning_types " in
+      *" $_G_category "*) $warning_func ${1+"$@"} ;;
+    esac
+}
+
+
+# func_sort_ver VER1 VER2
+# -----------------------
+# 'sort -V' is not generally available.
+# Note this deviates from the version comparison in automake
+# in that it treats 1.5 < 1.5.0, and treats 1.4.4a < 1.4-p3a
+# but this should suffice as we won't be specifying old
+# version formats or redundant trailing .0 in bootstrap.conf.
+# If we did want full compatibility then we should probably
+# use m4_version_compare from autoconf.
+func_sort_ver ()
+{
+    $debug_cmd
+
+    printf '%s\n%s\n' "$1" "$2" \
+      | sort -t. -k 1,1n -k 2,2n -k 3,3n -k 4,4n -k 5,5n -k 6,6n -k 7,7n -k 8,8n -k 9,9n
+}
+
+# func_lt_ver PREV CURR
+# ---------------------
+# Return true if PREV and CURR are in the correct order according to
+# func_sort_ver, otherwise false.  Use it like this:
+#
+#  func_lt_ver "$prev_ver" "$proposed_ver" || func_fatal_error "..."
+func_lt_ver ()
+{
+    $debug_cmd
+
+    test "x$1" = x`func_sort_ver "$1" "$2" | $SED 1q`
+}
+
+
+# Local variables:
+# mode: shell-script
+# sh-indentation: 2
+# eval: (add-hook 'before-save-hook 'time-stamp)
+# time-stamp-pattern: "10/scriptversion=%:y-%02m-%02d.%02H; # UTC"
+# time-stamp-time-zone: "UTC"
+# End:
+#! /bin/sh
+
+# Set a version string for this script.
+scriptversion=2014-01-07.03; # UTC
+
+# A portable, pluggable option parser for Bourne shell.
+# Written by Gary V. Vaughan, 2010
+
+# Copyright (C) 2010-2015 Free Software Foundation, Inc.
+# This is free software; see the source for copying conditions.  There is NO
+# warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+
+# This program is free software: you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation, either version 3 of the License, or
+# (at your option) any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program.  If not, see <http://www.gnu.org/licenses/>.
+
+# Please report bugs or propose patches to gary@gnu.org.
+
+
+## ------ ##
+## Usage. ##
+## ------ ##
+
+# This file is a library for parsing options in your shell scripts along
+# with assorted other useful supporting features that you can make use
+# of too.
+#
+# For the simplest scripts you might need only:
+#
+#   #!/bin/sh
+#   . relative/path/to/funclib.sh
+#   . relative/path/to/options-parser
+#   scriptversion=1.0
+#   func_options ${1+"$@"}
+#   eval set dummy "$func_options_result"; shift
+#   ...rest of your script...
+#
+# In order for the '--version' option to work, you will need to have a
+# suitably formatted comment like the one at the top of this file
+# starting with '# Written by ' and ending with '# warranty; '.
+#
+# For '-h' and '--help' to work, you will also need a one line
+# description of your script's purpose in a comment directly above the
+# '# Written by ' line, like the one at the top of this file.
+#
+# The default options also support '--debug', which will turn on shell
+# execution tracing (see the comment above debug_cmd below for another
+# use), and '--verbose' and the func_verbose function to allow your script
+# to display verbose messages only when your user has specified
+# '--verbose'.
+#
+# After sourcing this file, you can plug processing for additional
+# options by amending the variables from the 'Configuration' section
+# below, and following the instructions in the 'Option parsing'
+# section further down.
+
+## -------------- ##
+## Configuration. ##
+## -------------- ##
+
+# You should override these variables in your script after sourcing this
+# file so that they reflect the customisations you have added to the
+# option parser.
+
+# The usage line for option parsing errors and the start of '-h' and
+# '--help' output messages. You can embed shell variables for delayed
+# expansion at the time the message is displayed, but you will need to
+# quote other shell meta-characters carefully to prevent them being
+# expanded when the contents are evaled.
+usage='$progpath [OPTION]...'
+
+# Short help message in response to '-h' and '--help'.  Add to this or
+# override it after sourcing this library to reflect the full set of
+# options your script accepts.
+usage_message="\
+       --debug        enable verbose shell tracing
+   -W, --warnings=CATEGORY
+                      report the warnings falling in CATEGORY [all]
+   -v, --verbose      verbosely report processing
+       --version      print version information and exit
+   -h, --help         print short or long help message and exit
+"
+
+# Additional text appended to 'usage_message' in response to '--help'.
+long_help_message="
+Warning categories include:
+       'all'          show all warnings
+       'none'         turn off all the warnings
+       'error'        warnings are treated as fatal errors"
+
+# Help message printed before fatal option parsing errors.
+fatal_help="Try '\$progname --help' for more information."
+
+
+
+## ------------------------- ##
+## Hook function management. ##
+## ------------------------- ##
+
+# This section contains functions for adding, removing, and running hooks
+# to the main code.  A hook is just a named list of of function, that can
+# be run in order later on.
+
+# func_hookable FUNC_NAME
+# -----------------------
+# Declare that FUNC_NAME will run hooks added with
+# 'func_add_hook FUNC_NAME ...'.
+func_hookable ()
+{
+    $debug_cmd
+
+    func_append hookable_fns " $1"
+}
+
+
+# func_add_hook FUNC_NAME HOOK_FUNC
+# ---------------------------------
+# Request that FUNC_NAME call HOOK_FUNC before it returns.  FUNC_NAME must
+# first have been declared "hookable" by a call to 'func_hookable'.
+func_add_hook ()
+{
+    $debug_cmd
+
+    case " $hookable_fns " in
+      *" $1 "*) ;;
+      *) func_fatal_error "'$1' does not accept hook functions." ;;
+    esac
+
+    eval func_append ${1}_hooks '" $2"'
+}
+
+
+# func_remove_hook FUNC_NAME HOOK_FUNC
+# ------------------------------------
+# Remove HOOK_FUNC from the list of functions called by FUNC_NAME.
+func_remove_hook ()
+{
+    $debug_cmd
+
+    eval ${1}_hooks='`$ECHO "\$'$1'_hooks" |$SED "s| '$2'||"`'
+}
+
+
+# func_run_hooks FUNC_NAME [ARG]...
+# ---------------------------------
+# Run all hook functions registered to FUNC_NAME.
+# It is assumed that the list of hook functions contains nothing more
+# than a whitespace-delimited list of legal shell function names, and
+# no effort is wasted trying to catch shell meta-characters or preserve
+# whitespace.
+func_run_hooks ()
+{
+    $debug_cmd
+
+    case " $hookable_fns " in
+      *" $1 "*) ;;
+      *) func_fatal_error "'$1' does not support hook funcions.n" ;;
+    esac
+
+    eval _G_hook_fns=\$$1_hooks; shift
+
+    for _G_hook in $_G_hook_fns; do
+      eval $_G_hook '"$@"'
+
+      # store returned options list back into positional
+      # parameters for next 'cmd' execution.
+      eval _G_hook_result=\$${_G_hook}_result
+      eval set dummy "$_G_hook_result"; shift
+    done
+
+    func_quote_for_eval ${1+"$@"}
+    func_run_hooks_result=$func_quote_for_eval_result
+}
+
+
+
+## --------------- ##
+## Option parsing. ##
+## --------------- ##
+
+# In order to add your own option parsing hooks, you must accept the
+# full positional parameter list in your hook function, remove any
+# options that you action, and then pass back the remaining unprocessed
+# options in '<hooked_function_name>_result', escaped suitably for
+# 'eval'.  Like this:
+#
+#    my_options_prep ()
+#    {
+#        $debug_cmd
+#
+#        # Extend the existing usage message.
+#        usage_message=$usage_message'
+#      -s, --silent       don'\''t print informational messages
+#    '
+#
+#        func_quote_for_eval ${1+"$@"}
+#        my_options_prep_result=$func_quote_for_eval_result
+#    }
+#    func_add_hook func_options_prep my_options_prep
+#
+#
+#    my_silent_option ()
+#    {
+#        $debug_cmd
+#
+#        # Note that for efficiency, we parse as many options as we can
+#        # recognise in a loop before passing the remainder back to the
+#        # caller on the first unrecognised argument we encounter.
+#        while test $# -gt 0; do
+#          opt=$1; shift
+#          case $opt in
+#            --silent|-s) opt_silent=: ;;
+#            # Separate non-argument short options:
+#            -s*)         func_split_short_opt "$_G_opt"
+#                         set dummy "$func_split_short_opt_name" \
+#                             "-$func_split_short_opt_arg" ${1+"$@"}
+#                         shift
+#                         ;;
+#            *)            set dummy "$_G_opt" "$*"; shift; break ;;
+#          esac
+#        done
+#
+#        func_quote_for_eval ${1+"$@"}
+#        my_silent_option_result=$func_quote_for_eval_result
+#    }
+#    func_add_hook func_parse_options my_silent_option
+#
+#
+#    my_option_validation ()
+#    {
+#        $debug_cmd
+#
+#        $opt_silent && $opt_verbose && func_fatal_help "\
+#    '--silent' and '--verbose' options are mutually exclusive."
+#
+#        func_quote_for_eval ${1+"$@"}
+#        my_option_validation_result=$func_quote_for_eval_result
+#    }
+#    func_add_hook func_validate_options my_option_validation
+#
+# You'll alse need to manually amend $usage_message to reflect the extra
+# options you parse.  It's preferable to append if you can, so that
+# multiple option parsing hooks can be added safely.
+
+
+# func_options [ARG]...
+# ---------------------
+# All the functions called inside func_options are hookable. See the
+# individual implementations for details.
+func_hookable func_options
+func_options ()
+{
+    $debug_cmd
+
+    func_options_prep ${1+"$@"}
+    eval func_parse_options \
+        ${func_options_prep_result+"$func_options_prep_result"}
+    eval func_validate_options \
+        ${func_parse_options_result+"$func_parse_options_result"}
+
+    eval func_run_hooks func_options \
+        ${func_validate_options_result+"$func_validate_options_result"}
+
+    # save modified positional parameters for caller
+    func_options_result=$func_run_hooks_result
+}
+
+
+# func_options_prep [ARG]...
+# --------------------------
+# All initialisations required before starting the option parse loop.
+# Note that when calling hook functions, we pass through the list of
+# positional parameters.  If a hook function modifies that list, and
+# needs to propogate that back to rest of this script, then the complete
+# modified list must be put in 'func_run_hooks_result' before
+# returning.
+func_hookable func_options_prep
+func_options_prep ()
+{
+    $debug_cmd
+
+    # Option defaults:
+    opt_verbose=false
+    opt_warning_types=
+
+    func_run_hooks func_options_prep ${1+"$@"}
+
+    # save modified positional parameters for caller
+    func_options_prep_result=$func_run_hooks_result
+}
+
+
+# func_parse_options [ARG]...
+# ---------------------------
+# The main option parsing loop.
+func_hookable func_parse_options
+func_parse_options ()
+{
+    $debug_cmd
+
+    func_parse_options_result=
+
+    # this just eases exit handling
+    while test $# -gt 0; do
+      # Defer to hook functions for initial option parsing, so they
+      # get priority in the event of reusing an option name.
+      func_run_hooks func_parse_options ${1+"$@"}
+
+      # Adjust func_parse_options positional parameters to match
+      eval set dummy "$func_run_hooks_result"; shift
+
+      # Break out of the loop if we already parsed every option.
+      test $# -gt 0 || break
+
+      _G_opt=$1
+      shift
+      case $_G_opt in
+        --debug|-x)   debug_cmd='set -x'
+                      func_echo "enabling shell trace mode"
+                      $debug_cmd
+                      ;;
+
+        --no-warnings|--no-warning|--no-warn)
+                      set dummy --warnings none ${1+"$@"}
+                      shift
+		      ;;
+
+        --warnings|--warning|-W)
+                      test $# = 0 && func_missing_arg $_G_opt && break
+                      case " $warning_categories $1" in
+                        *" $1 "*)
+                          # trailing space prevents matching last $1 above
+                          func_append_uniq opt_warning_types " $1"
+                          ;;
+                        *all)
+                          opt_warning_types=$warning_categories
+                          ;;
+                        *none)
+                          opt_warning_types=none
+                          warning_func=:
+                          ;;
+                        *error)
+                          opt_warning_types=$warning_categories
+                          warning_func=func_fatal_error
+                          ;;
+                        *)
+                          func_fatal_error \
+                             "unsupported warning category: '$1'"
+                          ;;
+                      esac
+                      shift
+                      ;;
+
+        --verbose|-v) opt_verbose=: ;;
+        --version)    func_version ;;
+        -\?|-h)       func_usage ;;
+        --help)       func_help ;;
+
+	# Separate optargs to long options (plugins may need this):
+	--*=*)        func_split_equals "$_G_opt"
+	              set dummy "$func_split_equals_lhs" \
+                          "$func_split_equals_rhs" ${1+"$@"}
+                      shift
+                      ;;
+
+       # Separate optargs to short options:
+        -W*)
+                      func_split_short_opt "$_G_opt"
+                      set dummy "$func_split_short_opt_name" \
+                          "$func_split_short_opt_arg" ${1+"$@"}
+                      shift
+                      ;;
+
+        # Separate non-argument short options:
+        -\?*|-h*|-v*|-x*)
+                      func_split_short_opt "$_G_opt"
+                      set dummy "$func_split_short_opt_name" \
+                          "-$func_split_short_opt_arg" ${1+"$@"}
+                      shift
+                      ;;
+
+        --)           break ;;
+        -*)           func_fatal_help "unrecognised option: '$_G_opt'" ;;
+        *)            set dummy "$_G_opt" ${1+"$@"}; shift; break ;;
+      esac
+    done
+
+    # save modified positional parameters for caller
+    func_quote_for_eval ${1+"$@"}
+    func_parse_options_result=$func_quote_for_eval_result
+}
+
+
+# func_validate_options [ARG]...
+# ------------------------------
+# Perform any sanity checks on option settings and/or unconsumed
+# arguments.
+func_hookable func_validate_options
+func_validate_options ()
+{
+    $debug_cmd
+
+    # Display all warnings if -W was not given.
+    test -n "$opt_warning_types" || opt_warning_types=" $warning_categories"
+
+    func_run_hooks func_validate_options ${1+"$@"}
+
+    # Bail if the options were screwed!
+    $exit_cmd $EXIT_FAILURE
+
+    # save modified positional parameters for caller
+    func_validate_options_result=$func_run_hooks_result
+}
+
+
+
+## ----------------- ##
+## Helper functions. ##
+## ----------------- ##
+
+# This section contains the helper functions used by the rest of the
+# hookable option parser framework in ascii-betical order.
+
+
+# func_fatal_help ARG...
+# ----------------------
+# Echo program name prefixed message to standard error, followed by
+# a help hint, and exit.
+func_fatal_help ()
+{
+    $debug_cmd
+
+    eval \$ECHO \""Usage: $usage"\"
+    eval \$ECHO \""$fatal_help"\"
+    func_error ${1+"$@"}
+    exit $EXIT_FAILURE
+}
+
+
+# func_help
+# ---------
+# Echo long help message to standard output and exit.
 func_help ()
 {
-    $opt_debug
+    $debug_cmd
 
-    $SED -n '/^# Usage:/,/# Report bugs to/ {
-	:print
-        s/^# //
-	s/^# *$//
-	s*\$progname*'$progname'*
-	s*\$host*'"$host"'*
-	s*\$SHELL*'"$SHELL"'*
-	s*\$LTCC*'"$LTCC"'*
-	s*\$LTCFLAGS*'"$LTCFLAGS"'*
-	s*\$LD*'"$LD"'*
-	s/\$with_gnu_ld/'"$with_gnu_ld"'/
-	s/\$automake_version/'"`(automake --version) 2>/dev/null |$SED 1q`"'/
-	s/\$autoconf_version/'"`(autoconf --version) 2>/dev/null |$SED 1q`"'/
-	p
-	d
-     }
-     /^# .* home page:/b print
-     /^# General help using/b print
-     ' < "$progpath"
-    ret=$?
-    if test -z "$1"; then
-      exit $ret
-    fi
+    func_usage_message
+    $ECHO "$long_help_message"
+    exit 0
 }
 
-# func_missing_arg argname
+
+# func_missing_arg ARGNAME
+# ------------------------
 # Echo program name prefixed message to standard error and set global
 # exit_cmd.
 func_missing_arg ()
 {
-    $opt_debug
+    $debug_cmd
 
-    func_error "missing argument for $1."
+    func_error "Missing argument for '$1'."
     exit_cmd=exit
 }
 
 
-# func_split_short_opt shortopt
+# func_split_equals STRING
+# ------------------------
+# Set func_split_equals_lhs and func_split_equals_rhs shell variables after
+# splitting STRING at the '=' sign.
+test -z "$_G_HAVE_XSI_OPS" \
+    && (eval 'x=a/b/c;
+      test 5aa/bb/cc = "${#x}${x%%/*}${x%/*}${x#*/}${x##*/}"') 2>/dev/null \
+    && _G_HAVE_XSI_OPS=yes
+
+if test yes = "$_G_HAVE_XSI_OPS"
+then
+  # This is an XSI compatible shell, allowing a faster implementation...
+  eval 'func_split_equals ()
+  {
+      $debug_cmd
+
+      func_split_equals_lhs=${1%%=*}
+      func_split_equals_rhs=${1#*=}
+      test "x$func_split_equals_lhs" = "x$1" \
+        && func_split_equals_rhs=
+  }'
+else
+  # ...otherwise fall back to using expr, which is often a shell builtin.
+  func_split_equals ()
+  {
+      $debug_cmd
+
+      func_split_equals_lhs=`expr "x$1" : 'x\([^=]*\)'`
+      func_split_equals_rhs=
+      test "x$func_split_equals_lhs" = "x$1" \
+        || func_split_equals_rhs=`expr "x$1" : 'x[^=]*=\(.*\)$'`
+  }
+fi #func_split_equals
+
+
+# func_split_short_opt SHORTOPT
+# -----------------------------
 # Set func_split_short_opt_name and func_split_short_opt_arg shell
 # variables after splitting SHORTOPT after the 2nd character.
-func_split_short_opt ()
+if test yes = "$_G_HAVE_XSI_OPS"
+then
+  # This is an XSI compatible shell, allowing a faster implementation...
+  eval 'func_split_short_opt ()
+  {
+      $debug_cmd
+
+      func_split_short_opt_arg=${1#??}
+      func_split_short_opt_name=${1%"$func_split_short_opt_arg"}
+  }'
+else
+  # ...otherwise fall back to using expr, which is often a shell builtin.
+  func_split_short_opt ()
+  {
+      $debug_cmd
+
+      func_split_short_opt_name=`expr "x$1" : 'x-\(.\)'`
+      func_split_short_opt_arg=`expr "x$1" : 'x-.\(.*\)$'`
+  }
+fi #func_split_short_opt
+
+
+# func_usage
+# ----------
+# Echo short help message to standard output and exit.
+func_usage ()
 {
-    my_sed_short_opt='1s/^\(..\).*$/\1/;q'
-    my_sed_short_rest='1s/^..\(.*\)$/\1/;q'
+    $debug_cmd
 
-    func_split_short_opt_name=`$ECHO "$1" | $SED "$my_sed_short_opt"`
-    func_split_short_opt_arg=`$ECHO "$1" | $SED "$my_sed_short_rest"`
-} # func_split_short_opt may be replaced by extended shell implementation
+    func_usage_message
+    $ECHO "Run '$progname --help |${PAGER-more}' for full usage"
+    exit 0
+}
 
 
-# func_split_long_opt longopt
-# Set func_split_long_opt_name and func_split_long_opt_arg shell
-# variables after splitting LONGOPT at the `=' sign.
-func_split_long_opt ()
+# func_usage_message
+# ------------------
+# Echo short help message to standard output.
+func_usage_message ()
 {
-    my_sed_long_opt='1s/^\(--[^=]*\)=.*/\1/;q'
-    my_sed_long_arg='1s/^--[^=]*=//'
+    $debug_cmd
 
-    func_split_long_opt_name=`$ECHO "$1" | $SED "$my_sed_long_opt"`
-    func_split_long_opt_arg=`$ECHO "$1" | $SED "$my_sed_long_arg"`
-} # func_split_long_opt may be replaced by extended shell implementation
+    eval \$ECHO \""Usage: $usage"\"
+    echo
+    $SED -n 's|^# ||
+        /^Written by/{
+          x;p;x
+        }
+	h
+	/^Written by/q' < "$progpath"
+    echo
+    eval \$ECHO \""$usage_message"\"
+}
 
-exit_cmd=:
 
+# func_version
+# ------------
+# Echo version message to standard output and exit.
+func_version ()
+{
+    $debug_cmd
 
+    printf '%s\n' "$progname $scriptversion"
+    $SED -n '
+        /(C)/!b go
+        :more
+        /\./!{
+          N
+          s|\n# | |
+          b more
+        }
+        :go
+        /^# Written by /,/# warranty; / {
+          s|^# ||
+          s|^# *$||
+          s|\((C)\)[ 0-9,-]*[ ,-]\([1-9][0-9]* \)|\1 \2|
+          p
+        }
+        /^# Written by / {
+          s|^# ||
+          p
+        }
+        /^warranty; /q' < "$progpath"
 
+    exit $?
+}
 
 
-magic="%%%MAGIC variable%%%"
-magic_exe="%%%MAGIC EXE variable%%%"
+# Local variables:
+# mode: shell-script
+# sh-indentation: 2
+# eval: (add-hook 'before-save-hook 'time-stamp)
+# time-stamp-pattern: "10/scriptversion=%:y-%02m-%02d.%02H; # UTC"
+# time-stamp-time-zone: "UTC"
+# End:
 
-# Global variables.
-nonopt=
-preserve_args=
-lo2o="s/\\.lo\$/.${objext}/"
-o2lo="s/\\.${objext}\$/.lo/"
-extracted_archives=
-extracted_serial=0
+# Set a version string.
+scriptversion='(GNU libtool) 2.4.6'
 
-# If this variable is set in any of the actions, the command in it
-# will be execed at the end.  This prevents here-documents from being
-# left over by shells.
-exec_cmd=
 
-# func_append var value
-# Append VALUE to the end of shell variable VAR.
-func_append ()
+# func_echo ARG...
+# ----------------
+# Libtool also displays the current mode in messages, so override
+# funclib.sh func_echo with this custom definition.
+func_echo ()
 {
-    eval "${1}=\$${1}\${2}"
-} # func_append may be replaced by extended shell implementation
+    $debug_cmd
 
-# func_append_quoted var value
-# Quote VALUE and append to the end of shell variable VAR, separated
-# by a space.
-func_append_quoted ()
-{
-    func_quote_for_eval "${2}"
-    eval "${1}=\$${1}\\ \$func_quote_for_eval_result"
-} # func_append_quoted may be replaced by extended shell implementation
+    _G_message=$*
+
+    func_echo_IFS=$IFS
+    IFS=$nl
+    for _G_line in $_G_message; do
+      IFS=$func_echo_IFS
+      $ECHO "$progname${opt_mode+: $opt_mode}: $_G_line"
+    done
+    IFS=$func_echo_IFS
+}
 
 
-# func_arith arithmetic-term...
-func_arith ()
+# func_warning ARG...
+# -------------------
+# Libtool warnings are not categorized, so override funclib.sh
+# func_warning with this simpler definition.
+func_warning ()
 {
-    func_arith_result=`expr "${@}"`
-} # func_arith may be replaced by extended shell implementation
+    $debug_cmd
 
+    $warning_func ${1+"$@"}
+}
 
-# func_len string
-# STRING may not start with a hyphen.
-func_len ()
-{
-    func_len_result=`expr "${1}" : ".*" 2>/dev/null || echo $max_cmd_len`
-} # func_len may be replaced by extended shell implementation
 
+## ---------------- ##
+## Options parsing. ##
+## ---------------- ##
+
+# Hook in the functions to make sure our own options are parsed during
+# the option parsing loop.
+
+usage='$progpath [OPTION]... [MODE-ARG]...'
+
+# Short help message in response to '-h'.
+usage_message="Options:
+       --config             show all configuration variables
+       --debug              enable verbose shell tracing
+   -n, --dry-run            display commands without modifying any files
+       --features           display basic configuration information and exit
+       --mode=MODE          use operation mode MODE
+       --no-warnings        equivalent to '-Wnone'
+       --preserve-dup-deps  don't remove duplicate dependency libraries
+       --quiet, --silent    don't print informational messages
+       --tag=TAG            use configuration variables from tag TAG
+   -v, --verbose            print more informational messages than default
+       --version            print version information
+   -W, --warnings=CATEGORY  report the warnings falling in CATEGORY [all]
+   -h, --help, --help-all   print short, long, or detailed help message
+"
 
-# func_lo2o object
-func_lo2o ()
+# Additional text appended to 'usage_message' in response to '--help'.
+func_help ()
 {
-    func_lo2o_result=`$ECHO "${1}" | $SED "$lo2o"`
-} # func_lo2o may be replaced by extended shell implementation
+    $debug_cmd
 
+    func_usage_message
+    $ECHO "$long_help_message
 
-# func_xform libobj-or-source
-func_xform ()
-{
-    func_xform_result=`$ECHO "${1}" | $SED 's/\.[^.]*$/.lo/'`
-} # func_xform may be replaced by extended shell implementation
+MODE must be one of the following:
+
+       clean           remove files from the build directory
+       compile         compile a source file into a libtool object
+       execute         automatically set library path, then run a program
+       finish          complete the installation of libtool libraries
+       install         install libraries or executables
+       link            create a library or an executable
+       uninstall       remove libraries from an installed directory
+
+MODE-ARGS vary depending on the MODE.  When passed as first option,
+'--mode=MODE' may be abbreviated as 'MODE' or a unique abbreviation of that.
+Try '$progname --help --mode=MODE' for a more detailed description of MODE.
+
+When reporting a bug, please describe a test case to reproduce it and
+include the following information:
+
+       host-triplet:   $host
+       shell:          $SHELL
+       compiler:       $LTCC
+       compiler flags: $LTCFLAGS
+       linker:         $LD (gnu? $with_gnu_ld)
+       version:        $progname (GNU libtool) 2.4.6
+       automake:       `($AUTOMAKE --version) 2>/dev/null |$SED 1q`
+       autoconf:       `($AUTOCONF --version) 2>/dev/null |$SED 1q`
+
+Report bugs to <bug-libtool@gnu.org>.
+GNU libtool home page: <http://www.gnu.org/software/libtool/>.
+General help using GNU software: <http://www.gnu.org/gethelp/>."
+    exit 0
+}
 
 
-# func_fatal_configuration arg...
+# func_lo2o OBJECT-NAME
+# ---------------------
+# Transform OBJECT-NAME from a '.lo' suffix to the platform specific
+# object suffix.
+
+lo2o=s/\\.lo\$/.$objext/
+o2lo=s/\\.$objext\$/.lo/
+
+if test yes = "$_G_HAVE_XSI_OPS"; then
+  eval 'func_lo2o ()
+  {
+    case $1 in
+      *.lo) func_lo2o_result=${1%.lo}.$objext ;;
+      *   ) func_lo2o_result=$1               ;;
+    esac
+  }'
+
+  # func_xform LIBOBJ-OR-SOURCE
+  # ---------------------------
+  # Transform LIBOBJ-OR-SOURCE from a '.o' or '.c' (or otherwise)
+  # suffix to a '.lo' libtool-object suffix.
+  eval 'func_xform ()
+  {
+    func_xform_result=${1%.*}.lo
+  }'
+else
+  # ...otherwise fall back to using sed.
+  func_lo2o ()
+  {
+    func_lo2o_result=`$ECHO "$1" | $SED "$lo2o"`
+  }
+
+  func_xform ()
+  {
+    func_xform_result=`$ECHO "$1" | $SED 's|\.[^.]*$|.lo|'`
+  }
+fi
+
+
+# func_fatal_configuration ARG...
+# -------------------------------
 # Echo program name prefixed message to standard error, followed by
 # a configuration failure hint, and exit.
 func_fatal_configuration ()
 {
-    func_error ${1+"$@"}
-    func_error "See the $PACKAGE documentation for more information."
-    func_fatal_error "Fatal configuration error."
+    func__fatal_error ${1+"$@"} \
+      "See the $PACKAGE documentation for more information." \
+      "Fatal configuration error."
 }
 
 
 # func_config
+# -----------
 # Display the configuration for all the tags in this script.
 func_config ()
 {
@@ -919,17 +2149,19 @@ func_config ()
     exit $?
 }
 
+
 # func_features
+# -------------
 # Display the features supported by this script.
 func_features ()
 {
     echo "host: $host"
-    if test "$build_libtool_libs" = yes; then
+    if test yes = "$build_libtool_libs"; then
       echo "enable shared libraries"
     else
       echo "disable shared libraries"
     fi
-    if test "$build_old_libs" = yes; then
+    if test yes = "$build_old_libs"; then
       echo "enable static libraries"
     else
       echo "disable static libraries"
@@ -938,284 +2170,297 @@ func_features ()
     exit $?
 }
 
-# func_enable_tag tagname
+
+# func_enable_tag TAGNAME
+# -----------------------
 # Verify that TAGNAME is valid, and either flag an error and exit, or
 # enable the TAGNAME tag.  We also add TAGNAME to the global $taglist
 # variable here.
 func_enable_tag ()
 {
-  # Global variable:
-  tagname="$1"
+    # Global variable:
+    tagname=$1
 
-  re_begincf="^# ### BEGIN LIBTOOL TAG CONFIG: $tagname\$"
-  re_endcf="^# ### END LIBTOOL TAG CONFIG: $tagname\$"
-  sed_extractcf="/$re_begincf/,/$re_endcf/p"
-
-  # Validate tagname.
-  case $tagname in
-    *[!-_A-Za-z0-9,/]*)
-      func_fatal_error "invalid tag name: $tagname"
-      ;;
-  esac
+    re_begincf="^# ### BEGIN LIBTOOL TAG CONFIG: $tagname\$"
+    re_endcf="^# ### END LIBTOOL TAG CONFIG: $tagname\$"
+    sed_extractcf=/$re_begincf/,/$re_endcf/p
+
+    # Validate tagname.
+    case $tagname in
+      *[!-_A-Za-z0-9,/]*)
+        func_fatal_error "invalid tag name: $tagname"
+        ;;
+    esac
 
-  # Don't test for the "default" C tag, as we know it's
-  # there but not specially marked.
-  case $tagname in
-    CC) ;;
+    # Don't test for the "default" C tag, as we know it's
+    # there but not specially marked.
+    case $tagname in
+        CC) ;;
     *)
-      if $GREP "$re_begincf" "$progpath" >/dev/null 2>&1; then
-	taglist="$taglist $tagname"
+        if $GREP "$re_begincf" "$progpath" >/dev/null 2>&1; then
+	  taglist="$taglist $tagname"
 
-	# Evaluate the configuration.  Be careful to quote the path
-	# and the sed script, to avoid splitting on whitespace, but
-	# also don't use non-portable quotes within backquotes within
-	# quotes we have to do it in 2 steps:
-	extractedcf=`$SED -n -e "$sed_extractcf" < "$progpath"`
-	eval "$extractedcf"
-      else
-	func_error "ignoring unknown tag $tagname"
-      fi
-      ;;
-  esac
+	  # Evaluate the configuration.  Be careful to quote the path
+	  # and the sed script, to avoid splitting on whitespace, but
+	  # also don't use non-portable quotes within backquotes within
+	  # quotes we have to do it in 2 steps:
+	  extractedcf=`$SED -n -e "$sed_extractcf" < "$progpath"`
+	  eval "$extractedcf"
+        else
+	  func_error "ignoring unknown tag $tagname"
+        fi
+        ;;
+    esac
 }
 
+
 # func_check_version_match
+# ------------------------
 # Ensure that we are using m4 macros, and libtool script from the same
 # release of libtool.
 func_check_version_match ()
 {
-  if test "$package_revision" != "$macro_revision"; then
-    if test "$VERSION" != "$macro_version"; then
-      if test -z "$macro_version"; then
-        cat >&2 <<_LT_EOF
+    if test "$package_revision" != "$macro_revision"; then
+      if test "$VERSION" != "$macro_version"; then
+        if test -z "$macro_version"; then
+          cat >&2 <<_LT_EOF
 $progname: Version mismatch error.  This is $PACKAGE $VERSION, but the
 $progname: definition of this LT_INIT comes from an older release.
 $progname: You should recreate aclocal.m4 with macros from $PACKAGE $VERSION
 $progname: and run autoconf again.
 _LT_EOF
-      else
-        cat >&2 <<_LT_EOF
+        else
+          cat >&2 <<_LT_EOF
 $progname: Version mismatch error.  This is $PACKAGE $VERSION, but the
 $progname: definition of this LT_INIT comes from $PACKAGE $macro_version.
 $progname: You should recreate aclocal.m4 with macros from $PACKAGE $VERSION
 $progname: and run autoconf again.
 _LT_EOF
-      fi
-    else
-      cat >&2 <<_LT_EOF
+        fi
+      else
+        cat >&2 <<_LT_EOF
 $progname: Version mismatch error.  This is $PACKAGE $VERSION, revision $package_revision,
 $progname: but the definition of this LT_INIT comes from revision $macro_revision.
 $progname: You should recreate aclocal.m4 with macros from revision $package_revision
 $progname: of $PACKAGE $VERSION and run autoconf again.
 _LT_EOF
-    fi
+      fi
 
-    exit $EXIT_MISMATCH
-  fi
+      exit $EXIT_MISMATCH
+    fi
 }
 
 
-# Shorthand for --mode=foo, only valid as the first argument
-case $1 in
-clean|clea|cle|cl)
-  shift; set dummy --mode clean ${1+"$@"}; shift
-  ;;
-compile|compil|compi|comp|com|co|c)
-  shift; set dummy --mode compile ${1+"$@"}; shift
-  ;;
-execute|execut|execu|exec|exe|ex|e)
-  shift; set dummy --mode execute ${1+"$@"}; shift
-  ;;
-finish|finis|fini|fin|fi|f)
-  shift; set dummy --mode finish ${1+"$@"}; shift
-  ;;
-install|instal|insta|inst|ins|in|i)
-  shift; set dummy --mode install ${1+"$@"}; shift
-  ;;
-link|lin|li|l)
-  shift; set dummy --mode link ${1+"$@"}; shift
-  ;;
-uninstall|uninstal|uninsta|uninst|unins|unin|uni|un|u)
-  shift; set dummy --mode uninstall ${1+"$@"}; shift
-  ;;
-esac
+# libtool_options_prep [ARG]...
+# -----------------------------
+# Preparation for options parsed by libtool.
+libtool_options_prep ()
+{
+    $debug_mode
 
+    # Option defaults:
+    opt_config=false
+    opt_dlopen=
+    opt_dry_run=false
+    opt_help=false
+    opt_mode=
+    opt_preserve_dup_deps=false
+    opt_quiet=false
 
+    nonopt=
+    preserve_args=
 
-# Option defaults:
-opt_debug=:
-opt_dry_run=false
-opt_config=false
-opt_preserve_dup_deps=false
-opt_features=false
-opt_finish=false
-opt_help=false
-opt_help_all=false
-opt_silent=:
-opt_verbose=:
-opt_silent=false
-opt_verbose=false
+    # Shorthand for --mode=foo, only valid as the first argument
+    case $1 in
+    clean|clea|cle|cl)
+      shift; set dummy --mode clean ${1+"$@"}; shift
+      ;;
+    compile|compil|compi|comp|com|co|c)
+      shift; set dummy --mode compile ${1+"$@"}; shift
+      ;;
+    execute|execut|execu|exec|exe|ex|e)
+      shift; set dummy --mode execute ${1+"$@"}; shift
+      ;;
+    finish|finis|fini|fin|fi|f)
+      shift; set dummy --mode finish ${1+"$@"}; shift
+      ;;
+    install|instal|insta|inst|ins|in|i)
+      shift; set dummy --mode install ${1+"$@"}; shift
+      ;;
+    link|lin|li|l)
+      shift; set dummy --mode link ${1+"$@"}; shift
+      ;;
+    uninstall|uninstal|uninsta|uninst|unins|unin|uni|un|u)
+      shift; set dummy --mode uninstall ${1+"$@"}; shift
+      ;;
+    esac
 
+    # Pass back the list of options.
+    func_quote_for_eval ${1+"$@"}
+    libtool_options_prep_result=$func_quote_for_eval_result
+}
+func_add_hook func_options_prep libtool_options_prep
 
-# Parse options once, thoroughly.  This comes as soon as possible in the
-# script to make things like `--version' happen as quickly as we can.
-{
-  # this just eases exit handling
-  while test $# -gt 0; do
-    opt="$1"
-    shift
-    case $opt in
-      --debug|-x)	opt_debug='set -x'
-			func_echo "enabling shell trace mode"
-			$opt_debug
-			;;
-      --dry-run|--dryrun|-n)
-			opt_dry_run=:
-			;;
-      --config)
-			opt_config=:
-func_config
-			;;
-      --dlopen|-dlopen)
-			optarg="$1"
-			opt_dlopen="${opt_dlopen+$opt_dlopen
-}$optarg"
-			shift
-			;;
-      --preserve-dup-deps)
-			opt_preserve_dup_deps=:
-			;;
-      --features)
-			opt_features=:
-func_features
-			;;
-      --finish)
-			opt_finish=:
-set dummy --mode finish ${1+"$@"}; shift
-			;;
-      --help)
-			opt_help=:
-			;;
-      --help-all)
-			opt_help_all=:
-opt_help=': help-all'
-			;;
-      --mode)
-			test $# = 0 && func_missing_arg $opt && break
-			optarg="$1"
-			opt_mode="$optarg"
-case $optarg in
-  # Valid mode arguments:
-  clean|compile|execute|finish|install|link|relink|uninstall) ;;
-
-  # Catch anything else as an error
-  *) func_error "invalid argument for $opt"
-     exit_cmd=exit
-     break
-     ;;
-esac
-			shift
-			;;
-      --no-silent|--no-quiet)
-			opt_silent=false
-func_append preserve_args " $opt"
-			;;
-      --no-verbose)
-			opt_verbose=false
-func_append preserve_args " $opt"
-			;;
-      --silent|--quiet)
-			opt_silent=:
-func_append preserve_args " $opt"
-        opt_verbose=false
-			;;
-      --verbose|-v)
-			opt_verbose=:
-func_append preserve_args " $opt"
-opt_silent=false
-			;;
-      --tag)
-			test $# = 0 && func_missing_arg $opt && break
-			optarg="$1"
-			opt_tag="$optarg"
-func_append preserve_args " $opt $optarg"
-func_enable_tag "$optarg"
-			shift
-			;;
-
-      -\?|-h)		func_usage				;;
-      --help)		func_help				;;
-      --version)	func_version				;;
-
-      # Separate optargs to long options:
-      --*=*)
-			func_split_long_opt "$opt"
-			set dummy "$func_split_long_opt_name" "$func_split_long_opt_arg" ${1+"$@"}
-			shift
-			;;
-
-      # Separate non-argument short options:
-      -\?*|-h*|-n*|-v*)
-			func_split_short_opt "$opt"
-			set dummy "$func_split_short_opt_name" "-$func_split_short_opt_arg" ${1+"$@"}
-			shift
-			;;
-
-      --)		break					;;
-      -*)		func_fatal_help "unrecognized option \`$opt'" ;;
-      *)		set dummy "$opt" ${1+"$@"};	shift; break  ;;
-    esac
-  done
 
-  # Validate options:
+# libtool_parse_options [ARG]...
+# ---------------------------------
+# Provide handling for libtool specific options.
+libtool_parse_options ()
+{
+    $debug_cmd
 
-  # save first non-option argument
-  if test "$#" -gt 0; then
-    nonopt="$opt"
-    shift
-  fi
+    # Perform our own loop to consume as many options as possible in
+    # each iteration.
+    while test $# -gt 0; do
+      _G_opt=$1
+      shift
+      case $_G_opt in
+        --dry-run|--dryrun|-n)
+                        opt_dry_run=:
+                        ;;
+
+        --config)       func_config ;;
+
+        --dlopen|-dlopen)
+                        opt_dlopen="${opt_dlopen+$opt_dlopen
+}$1"
+                        shift
+                        ;;
+
+        --preserve-dup-deps)
+                        opt_preserve_dup_deps=: ;;
+
+        --features)     func_features ;;
+
+        --finish)       set dummy --mode finish ${1+"$@"}; shift ;;
+
+        --help)         opt_help=: ;;
+
+        --help-all)     opt_help=': help-all' ;;
+
+        --mode)         test $# = 0 && func_missing_arg $_G_opt && break
+                        opt_mode=$1
+                        case $1 in
+                          # Valid mode arguments:
+                          clean|compile|execute|finish|install|link|relink|uninstall) ;;
+
+                          # Catch anything else as an error
+                          *) func_error "invalid argument for $_G_opt"
+                             exit_cmd=exit
+                             break
+                             ;;
+                        esac
+                        shift
+                        ;;
+
+        --no-silent|--no-quiet)
+                        opt_quiet=false
+                        func_append preserve_args " $_G_opt"
+                        ;;
+
+        --no-warnings|--no-warning|--no-warn)
+                        opt_warning=false
+                        func_append preserve_args " $_G_opt"
+                        ;;
+
+        --no-verbose)
+                        opt_verbose=false
+                        func_append preserve_args " $_G_opt"
+                        ;;
+
+        --silent|--quiet)
+                        opt_quiet=:
+                        opt_verbose=false
+                        func_append preserve_args " $_G_opt"
+                        ;;
+
+        --tag)          test $# = 0 && func_missing_arg $_G_opt && break
+                        opt_tag=$1
+                        func_append preserve_args " $_G_opt $1"
+                        func_enable_tag "$1"
+                        shift
+                        ;;
+
+        --verbose|-v)   opt_quiet=false
+                        opt_verbose=:
+                        func_append preserve_args " $_G_opt"
+                        ;;
 
-  # preserve --debug
-  test "$opt_debug" = : || func_append preserve_args " --debug"
+	# An option not handled by this hook function:
+        *)		set dummy "$_G_opt" ${1+"$@"};	shift; break  ;;
+      esac
+    done
 
-  case $host in
-    *cygwin* | *mingw* | *pw32* | *cegcc*)
-      # don't eliminate duplications in $postdeps and $predeps
-      opt_duplicate_compiler_generated_deps=:
-      ;;
-    *)
-      opt_duplicate_compiler_generated_deps=$opt_preserve_dup_deps
-      ;;
-  esac
 
-  $opt_help || {
-    # Sanity checks first:
-    func_check_version_match
+    # save modified positional parameters for caller
+    func_quote_for_eval ${1+"$@"}
+    libtool_parse_options_result=$func_quote_for_eval_result
+}
+func_add_hook func_parse_options libtool_parse_options
 
-    if test "$build_libtool_libs" != yes && test "$build_old_libs" != yes; then
-      func_fatal_configuration "not configured to build any kind of library"
-    fi
 
-    # Darwin sucks
-    eval std_shrext=\"$shrext_cmds\"
 
-    # Only execute mode is allowed to have -dlopen flags.
-    if test -n "$opt_dlopen" && test "$opt_mode" != execute; then
-      func_error "unrecognized option \`-dlopen'"
-      $ECHO "$help" 1>&2
-      exit $EXIT_FAILURE
+# libtool_validate_options [ARG]...
+# ---------------------------------
+# Perform any sanity checks on option settings and/or unconsumed
+# arguments.
+libtool_validate_options ()
+{
+    # save first non-option argument
+    if test 0 -lt $#; then
+      nonopt=$1
+      shift
     fi
 
-    # Change the help message to a mode-specific one.
-    generic_help="$help"
-    help="Try \`$progname --help --mode=$opt_mode' for more information."
-  }
+    # preserve --debug
+    test : = "$debug_cmd" || func_append preserve_args " --debug"
 
+    case $host in
+      # Solaris2 added to fix http://debbugs.gnu.org/cgi/bugreport.cgi?bug=16452
+      # see also: http://gcc.gnu.org/bugzilla/show_bug.cgi?id=59788
+      *cygwin* | *mingw* | *pw32* | *cegcc* | *solaris2* | *os2*)
+        # don't eliminate duplications in $postdeps and $predeps
+        opt_duplicate_compiler_generated_deps=:
+        ;;
+      *)
+        opt_duplicate_compiler_generated_deps=$opt_preserve_dup_deps
+        ;;
+    esac
+
+    $opt_help || {
+      # Sanity checks first:
+      func_check_version_match
+
+      test yes != "$build_libtool_libs" \
+        && test yes != "$build_old_libs" \
+        && func_fatal_configuration "not configured to build any kind of library"
+
+      # Darwin sucks
+      eval std_shrext=\"$shrext_cmds\"
+
+      # Only execute mode is allowed to have -dlopen flags.
+      if test -n "$opt_dlopen" && test execute != "$opt_mode"; then
+        func_error "unrecognized option '-dlopen'"
+        $ECHO "$help" 1>&2
+        exit $EXIT_FAILURE
+      fi
+
+      # Change the help message to a mode-specific one.
+      generic_help=$help
+      help="Try '$progname --help --mode=$opt_mode' for more information."
+    }
 
-  # Bail if the options were screwed
-  $exit_cmd $EXIT_FAILURE
+    # Pass back the unparsed argument list
+    func_quote_for_eval ${1+"$@"}
+    libtool_validate_options_result=$func_quote_for_eval_result
 }
+func_add_hook func_validate_options libtool_validate_options
+
 
+# Process options as early as possible so that --help and --version
+# can return quickly.
+func_options ${1+"$@"}
+eval set dummy "$func_options_result"; shift
 
 
 
@@ -1223,24 +2468,52 @@ func_enable_tag "$optarg"
 ##    Main.    ##
 ## ----------- ##
 
+magic='%%%MAGIC variable%%%'
+magic_exe='%%%MAGIC EXE variable%%%'
+
+# Global variables.
+extracted_archives=
+extracted_serial=0
+
+# If this variable is set in any of the actions, the command in it
+# will be execed at the end.  This prevents here-documents from being
+# left over by shells.
+exec_cmd=
+
+
+# A function that is used when there is no print builtin or printf.
+func_fallback_echo ()
+{
+  eval 'cat <<_LTECHO_EOF
+$1
+_LTECHO_EOF'
+}
+
+# func_generated_by_libtool
+# True iff stdin has been generated by Libtool. This function is only
+# a basic sanity check; it will hardly flush out determined imposters.
+func_generated_by_libtool_p ()
+{
+  $GREP "^# Generated by .*$PACKAGE" > /dev/null 2>&1
+}
+
 # func_lalib_p file
-# True iff FILE is a libtool `.la' library or `.lo' object file.
+# True iff FILE is a libtool '.la' library or '.lo' object file.
 # This function is only a basic sanity check; it will hardly flush out
 # determined imposters.
 func_lalib_p ()
 {
     test -f "$1" &&
-      $SED -e 4q "$1" 2>/dev/null \
-        | $GREP "^# Generated by .*$PACKAGE" > /dev/null 2>&1
+      $SED -e 4q "$1" 2>/dev/null | func_generated_by_libtool_p
 }
 
 # func_lalib_unsafe_p file
-# True iff FILE is a libtool `.la' library or `.lo' object file.
+# True iff FILE is a libtool '.la' library or '.lo' object file.
 # This function implements the same check as func_lalib_p without
 # resorting to external programs.  To this end, it redirects stdin and
 # closes it afterwards, without saving the original file descriptor.
 # As a safety measure, use it only where a negative result would be
-# fatal anyway.  Works if `file' does not exist.
+# fatal anyway.  Works if 'file' does not exist.
 func_lalib_unsafe_p ()
 {
     lalib_p=no
@@ -1248,13 +2521,13 @@ func_lalib_unsafe_p ()
 	for lalib_p_l in 1 2 3 4
 	do
 	    read lalib_p_line
-	    case "$lalib_p_line" in
+	    case $lalib_p_line in
 		\#\ Generated\ by\ *$PACKAGE* ) lalib_p=yes; break;;
 	    esac
 	done
 	exec 0<&5 5<&-
     fi
-    test "$lalib_p" = yes
+    test yes = "$lalib_p"
 }
 
 # func_ltwrapper_script_p file
@@ -1263,7 +2536,8 @@ func_lalib_unsafe_p ()
 # determined imposters.
 func_ltwrapper_script_p ()
 {
-    func_lalib_p "$1"
+    test -f "$1" &&
+      $lt_truncate_bin < "$1" 2>/dev/null | func_generated_by_libtool_p
 }
 
 # func_ltwrapper_executable_p file
@@ -1288,7 +2562,7 @@ func_ltwrapper_scriptname ()
 {
     func_dirname_and_basename "$1" "" "."
     func_stripname '' '.exe' "$func_basename_result"
-    func_ltwrapper_scriptname_result="$func_dirname_result/$objdir/${func_stripname_result}_ltshwrapper"
+    func_ltwrapper_scriptname_result=$func_dirname_result/$objdir/${func_stripname_result}_ltshwrapper
 }
 
 # func_ltwrapper_p file
@@ -1307,11 +2581,13 @@ func_ltwrapper_p ()
 # FAIL_CMD may read-access the current command in variable CMD!
 func_execute_cmds ()
 {
-    $opt_debug
+    $debug_cmd
+
     save_ifs=$IFS; IFS='~'
     for cmd in $1; do
-      IFS=$save_ifs
+      IFS=$sp$nl
       eval cmd=\"$cmd\"
+      IFS=$save_ifs
       func_show_eval "$cmd" "${2-:}"
     done
     IFS=$save_ifs
@@ -1323,10 +2599,11 @@ func_execute_cmds ()
 # Note that it is not necessary on cygwin/mingw to append a dot to
 # FILE even if both FILE and FILE.exe exist: automatic-append-.exe
 # behavior happens only for exec(3), not for open(2)!  Also, sourcing
-# `FILE.' does not work on cygwin managed mounts.
+# 'FILE.' does not work on cygwin managed mounts.
 func_source ()
 {
-    $opt_debug
+    $debug_cmd
+
     case $1 in
     */* | *\\*)	. "$1" ;;
     *)		. "./$1" ;;
@@ -1353,10 +2630,10 @@ func_resolve_sysroot ()
 # store the result into func_replace_sysroot_result.
 func_replace_sysroot ()
 {
-  case "$lt_sysroot:$1" in
+  case $lt_sysroot:$1 in
   ?*:"$lt_sysroot"*)
     func_stripname "$lt_sysroot" '' "$1"
-    func_replace_sysroot_result="=$func_stripname_result"
+    func_replace_sysroot_result='='$func_stripname_result
     ;;
   *)
     # Including no sysroot.
@@ -1373,7 +2650,8 @@ func_replace_sysroot ()
 # arg is usually of the form 'gcc ...'
 func_infer_tag ()
 {
-    $opt_debug
+    $debug_cmd
+
     if test -n "$available_tags" && test -z "$tagname"; then
       CC_quoted=
       for arg in $CC; do
@@ -1392,7 +2670,7 @@ func_infer_tag ()
 	for z in $available_tags; do
 	  if $GREP "^# ### BEGIN LIBTOOL TAG CONFIG: $z$" < "$progpath" > /dev/null; then
 	    # Evaluate the configuration.
-	    eval "`${SED} -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$z'$/,/^# ### END LIBTOOL TAG CONFIG: '$z'$/p' < $progpath`"
+	    eval "`$SED -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$z'$/,/^# ### END LIBTOOL TAG CONFIG: '$z'$/p' < $progpath`"
 	    CC_quoted=
 	    for arg in $CC; do
 	      # Double-quote args containing other shell metacharacters.
@@ -1417,7 +2695,7 @@ func_infer_tag ()
 	# line option must be used.
 	if test -z "$tagname"; then
 	  func_echo "unable to infer tagged configuration"
-	  func_fatal_error "specify a tag with \`--tag'"
+	  func_fatal_error "specify a tag with '--tag'"
 #	else
 #	  func_verbose "using $tagname tagged configuration"
 	fi
@@ -1433,15 +2711,15 @@ func_infer_tag ()
 # but don't create it if we're doing a dry run.
 func_write_libtool_object ()
 {
-    write_libobj=${1}
-    if test "$build_libtool_libs" = yes; then
-      write_lobj=\'${2}\'
+    write_libobj=$1
+    if test yes = "$build_libtool_libs"; then
+      write_lobj=\'$2\'
     else
       write_lobj=none
     fi
 
-    if test "$build_old_libs" = yes; then
-      write_oldobj=\'${3}\'
+    if test yes = "$build_old_libs"; then
+      write_oldobj=\'$3\'
     else
       write_oldobj=none
     fi
@@ -1449,7 +2727,7 @@ func_write_libtool_object ()
     $opt_dry_run || {
       cat >${write_libobj}T <<EOF
 # $write_libobj - a libtool object file
-# Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION
+# Generated by $PROGRAM (GNU $PACKAGE) $VERSION
 #
 # Please DO NOT delete this file!
 # It is necessary for linking the library.
@@ -1461,7 +2739,7 @@ pic_object=$write_lobj
 non_pic_object=$write_oldobj
 
 EOF
-      $MV "${write_libobj}T" "${write_libobj}"
+      $MV "${write_libobj}T" "$write_libobj"
     }
 }
 
@@ -1481,8 +2759,9 @@ EOF
 # be empty on error (or when ARG is empty)
 func_convert_core_file_wine_to_w32 ()
 {
-  $opt_debug
-  func_convert_core_file_wine_to_w32_result="$1"
+  $debug_cmd
+
+  func_convert_core_file_wine_to_w32_result=$1
   if test -n "$1"; then
     # Unfortunately, winepath does not exit with a non-zero error code, so we
     # are forced to check the contents of stdout. On the other hand, if the
@@ -1490,9 +2769,9 @@ func_convert_core_file_wine_to_w32 ()
     # *an error message* to stdout. So we must check for both error code of
     # zero AND non-empty stdout, which explains the odd construction:
     func_convert_core_file_wine_to_w32_tmp=`winepath -w "$1" 2>/dev/null`
-    if test "$?" -eq 0 && test -n "${func_convert_core_file_wine_to_w32_tmp}"; then
+    if test "$?" -eq 0 && test -n "$func_convert_core_file_wine_to_w32_tmp"; then
       func_convert_core_file_wine_to_w32_result=`$ECHO "$func_convert_core_file_wine_to_w32_tmp" |
-        $SED -e "$lt_sed_naive_backslashify"`
+        $SED -e "$sed_naive_backslashify"`
     else
       func_convert_core_file_wine_to_w32_result=
     fi
@@ -1513,18 +2792,19 @@ func_convert_core_file_wine_to_w32 ()
 # are convertible, then the result may be empty.
 func_convert_core_path_wine_to_w32 ()
 {
-  $opt_debug
+  $debug_cmd
+
   # unfortunately, winepath doesn't convert paths, only file names
-  func_convert_core_path_wine_to_w32_result=""
+  func_convert_core_path_wine_to_w32_result=
   if test -n "$1"; then
     oldIFS=$IFS
     IFS=:
     for func_convert_core_path_wine_to_w32_f in $1; do
       IFS=$oldIFS
       func_convert_core_file_wine_to_w32 "$func_convert_core_path_wine_to_w32_f"
-      if test -n "$func_convert_core_file_wine_to_w32_result" ; then
+      if test -n "$func_convert_core_file_wine_to_w32_result"; then
         if test -z "$func_convert_core_path_wine_to_w32_result"; then
-          func_convert_core_path_wine_to_w32_result="$func_convert_core_file_wine_to_w32_result"
+          func_convert_core_path_wine_to_w32_result=$func_convert_core_file_wine_to_w32_result
         else
           func_append func_convert_core_path_wine_to_w32_result ";$func_convert_core_file_wine_to_w32_result"
         fi
@@ -1553,7 +2833,8 @@ func_convert_core_path_wine_to_w32 ()
 # environment variable; do not put it in $PATH.
 func_cygpath ()
 {
-  $opt_debug
+  $debug_cmd
+
   if test -n "$LT_CYGPATH" && test -f "$LT_CYGPATH"; then
     func_cygpath_result=`$LT_CYGPATH "$@" 2>/dev/null`
     if test "$?" -ne 0; then
@@ -1562,7 +2843,7 @@ func_cygpath ()
     fi
   else
     func_cygpath_result=
-    func_error "LT_CYGPATH is empty or specifies non-existent file: \`$LT_CYGPATH'"
+    func_error "LT_CYGPATH is empty or specifies non-existent file: '$LT_CYGPATH'"
   fi
 }
 #end: func_cygpath
@@ -1573,10 +2854,11 @@ func_cygpath ()
 # result in func_convert_core_msys_to_w32_result.
 func_convert_core_msys_to_w32 ()
 {
-  $opt_debug
+  $debug_cmd
+
   # awkward: cmd appends spaces to result
   func_convert_core_msys_to_w32_result=`( cmd //c echo "$1" ) 2>/dev/null |
-    $SED -e 's/[ ]*$//' -e "$lt_sed_naive_backslashify"`
+    $SED -e 's/[ ]*$//' -e "$sed_naive_backslashify"`
 }
 #end: func_convert_core_msys_to_w32
 
@@ -1587,13 +2869,14 @@ func_convert_core_msys_to_w32 ()
 # func_to_host_file_result to ARG1).
 func_convert_file_check ()
 {
-  $opt_debug
-  if test -z "$2" && test -n "$1" ; then
+  $debug_cmd
+
+  if test -z "$2" && test -n "$1"; then
     func_error "Could not determine host file name corresponding to"
-    func_error "  \`$1'"
+    func_error "  '$1'"
     func_error "Continuing, but uninstalled executables may not work."
     # Fallback:
-    func_to_host_file_result="$1"
+    func_to_host_file_result=$1
   fi
 }
 # end func_convert_file_check
@@ -1605,10 +2888,11 @@ func_convert_file_check ()
 # func_to_host_file_result to a simplistic fallback value (see below).
 func_convert_path_check ()
 {
-  $opt_debug
+  $debug_cmd
+
   if test -z "$4" && test -n "$3"; then
     func_error "Could not determine the host path corresponding to"
-    func_error "  \`$3'"
+    func_error "  '$3'"
     func_error "Continuing, but uninstalled executables may not work."
     # Fallback.  This is a deliberately simplistic "conversion" and
     # should not be "improved".  See libtool.info.
@@ -1617,7 +2901,7 @@ func_convert_path_check ()
       func_to_host_path_result=`echo "$3" |
         $SED -e "$lt_replace_pathsep_chars"`
     else
-      func_to_host_path_result="$3"
+      func_to_host_path_result=$3
     fi
   fi
 }
@@ -1629,9 +2913,10 @@ func_convert_path_check ()
 # and appending REPL if ORIG matches BACKPAT.
 func_convert_path_front_back_pathsep ()
 {
-  $opt_debug
+  $debug_cmd
+
   case $4 in
-  $1 ) func_to_host_path_result="$3$func_to_host_path_result"
+  $1 ) func_to_host_path_result=$3$func_to_host_path_result
     ;;
   esac
   case $4 in
@@ -1645,7 +2930,7 @@ func_convert_path_front_back_pathsep ()
 ##################################################
 # $build to $host FILE NAME CONVERSION FUNCTIONS #
 ##################################################
-# invoked via `$to_host_file_cmd ARG'
+# invoked via '$to_host_file_cmd ARG'
 #
 # In each case, ARG is the path to be converted from $build to $host format.
 # Result will be available in $func_to_host_file_result.
@@ -1656,7 +2941,8 @@ func_convert_path_front_back_pathsep ()
 # in func_to_host_file_result.
 func_to_host_file ()
 {
-  $opt_debug
+  $debug_cmd
+
   $to_host_file_cmd "$1"
 }
 # end func_to_host_file
@@ -1668,7 +2954,8 @@ func_to_host_file ()
 # in (the comma separated) LAZY, no conversion takes place.
 func_to_tool_file ()
 {
-  $opt_debug
+  $debug_cmd
+
   case ,$2, in
     *,"$to_tool_file_cmd",*)
       func_to_tool_file_result=$1
@@ -1686,7 +2973,7 @@ func_to_tool_file ()
 # Copy ARG to func_to_host_file_result.
 func_convert_file_noop ()
 {
-  func_to_host_file_result="$1"
+  func_to_host_file_result=$1
 }
 # end func_convert_file_noop
 
@@ -1697,11 +2984,12 @@ func_convert_file_noop ()
 # func_to_host_file_result.
 func_convert_file_msys_to_w32 ()
 {
-  $opt_debug
-  func_to_host_file_result="$1"
+  $debug_cmd
+
+  func_to_host_file_result=$1
   if test -n "$1"; then
     func_convert_core_msys_to_w32 "$1"
-    func_to_host_file_result="$func_convert_core_msys_to_w32_result"
+    func_to_host_file_result=$func_convert_core_msys_to_w32_result
   fi
   func_convert_file_check "$1" "$func_to_host_file_result"
 }
@@ -1713,8 +3001,9 @@ func_convert_file_msys_to_w32 ()
 # func_to_host_file_result.
 func_convert_file_cygwin_to_w32 ()
 {
-  $opt_debug
-  func_to_host_file_result="$1"
+  $debug_cmd
+
+  func_to_host_file_result=$1
   if test -n "$1"; then
     # because $build is cygwin, we call "the" cygpath in $PATH; no need to use
     # LT_CYGPATH in this case.
@@ -1730,11 +3019,12 @@ func_convert_file_cygwin_to_w32 ()
 # and a working winepath. Returns result in func_to_host_file_result.
 func_convert_file_nix_to_w32 ()
 {
-  $opt_debug
-  func_to_host_file_result="$1"
+  $debug_cmd
+
+  func_to_host_file_result=$1
   if test -n "$1"; then
     func_convert_core_file_wine_to_w32 "$1"
-    func_to_host_file_result="$func_convert_core_file_wine_to_w32_result"
+    func_to_host_file_result=$func_convert_core_file_wine_to_w32_result
   fi
   func_convert_file_check "$1" "$func_to_host_file_result"
 }
@@ -1746,12 +3036,13 @@ func_convert_file_nix_to_w32 ()
 # Returns result in func_to_host_file_result.
 func_convert_file_msys_to_cygwin ()
 {
-  $opt_debug
-  func_to_host_file_result="$1"
+  $debug_cmd
+
+  func_to_host_file_result=$1
   if test -n "$1"; then
     func_convert_core_msys_to_w32 "$1"
     func_cygpath -u "$func_convert_core_msys_to_w32_result"
-    func_to_host_file_result="$func_cygpath_result"
+    func_to_host_file_result=$func_cygpath_result
   fi
   func_convert_file_check "$1" "$func_to_host_file_result"
 }
@@ -1764,13 +3055,14 @@ func_convert_file_msys_to_cygwin ()
 # in func_to_host_file_result.
 func_convert_file_nix_to_cygwin ()
 {
-  $opt_debug
-  func_to_host_file_result="$1"
+  $debug_cmd
+
+  func_to_host_file_result=$1
   if test -n "$1"; then
     # convert from *nix to w32, then use cygpath to convert from w32 to cygwin.
     func_convert_core_file_wine_to_w32 "$1"
     func_cygpath -u "$func_convert_core_file_wine_to_w32_result"
-    func_to_host_file_result="$func_cygpath_result"
+    func_to_host_file_result=$func_cygpath_result
   fi
   func_convert_file_check "$1" "$func_to_host_file_result"
 }
@@ -1780,7 +3072,7 @@ func_convert_file_nix_to_cygwin ()
 #############################################
 # $build to $host PATH CONVERSION FUNCTIONS #
 #############################################
-# invoked via `$to_host_path_cmd ARG'
+# invoked via '$to_host_path_cmd ARG'
 #
 # In each case, ARG is the path to be converted from $build to $host format.
 # The result will be available in $func_to_host_path_result.
@@ -1804,10 +3096,11 @@ func_convert_file_nix_to_cygwin ()
 to_host_path_cmd=
 func_init_to_host_path_cmd ()
 {
-  $opt_debug
+  $debug_cmd
+
   if test -z "$to_host_path_cmd"; then
     func_stripname 'func_convert_file_' '' "$to_host_file_cmd"
-    to_host_path_cmd="func_convert_path_${func_stripname_result}"
+    to_host_path_cmd=func_convert_path_$func_stripname_result
   fi
 }
 
@@ -1817,7 +3110,8 @@ func_init_to_host_path_cmd ()
 # in func_to_host_path_result.
 func_to_host_path ()
 {
-  $opt_debug
+  $debug_cmd
+
   func_init_to_host_path_cmd
   $to_host_path_cmd "$1"
 }
@@ -1828,7 +3122,7 @@ func_to_host_path ()
 # Copy ARG to func_to_host_path_result.
 func_convert_path_noop ()
 {
-  func_to_host_path_result="$1"
+  func_to_host_path_result=$1
 }
 # end func_convert_path_noop
 
@@ -1839,8 +3133,9 @@ func_convert_path_noop ()
 # func_to_host_path_result.
 func_convert_path_msys_to_w32 ()
 {
-  $opt_debug
-  func_to_host_path_result="$1"
+  $debug_cmd
+
+  func_to_host_path_result=$1
   if test -n "$1"; then
     # Remove leading and trailing path separator characters from ARG.  MSYS
     # behavior is inconsistent here; cygpath turns them into '.;' and ';.';
@@ -1848,7 +3143,7 @@ func_convert_path_msys_to_w32 ()
     func_stripname : : "$1"
     func_to_host_path_tmp1=$func_stripname_result
     func_convert_core_msys_to_w32 "$func_to_host_path_tmp1"
-    func_to_host_path_result="$func_convert_core_msys_to_w32_result"
+    func_to_host_path_result=$func_convert_core_msys_to_w32_result
     func_convert_path_check : ";" \
       "$func_to_host_path_tmp1" "$func_to_host_path_result"
     func_convert_path_front_back_pathsep ":*" "*:" ";" "$1"
@@ -1862,8 +3157,9 @@ func_convert_path_msys_to_w32 ()
 # func_to_host_file_result.
 func_convert_path_cygwin_to_w32 ()
 {
-  $opt_debug
-  func_to_host_path_result="$1"
+  $debug_cmd
+
+  func_to_host_path_result=$1
   if test -n "$1"; then
     # See func_convert_path_msys_to_w32:
     func_stripname : : "$1"
@@ -1882,14 +3178,15 @@ func_convert_path_cygwin_to_w32 ()
 # a working winepath.  Returns result in func_to_host_file_result.
 func_convert_path_nix_to_w32 ()
 {
-  $opt_debug
-  func_to_host_path_result="$1"
+  $debug_cmd
+
+  func_to_host_path_result=$1
   if test -n "$1"; then
     # See func_convert_path_msys_to_w32:
     func_stripname : : "$1"
     func_to_host_path_tmp1=$func_stripname_result
     func_convert_core_path_wine_to_w32 "$func_to_host_path_tmp1"
-    func_to_host_path_result="$func_convert_core_path_wine_to_w32_result"
+    func_to_host_path_result=$func_convert_core_path_wine_to_w32_result
     func_convert_path_check : ";" \
       "$func_to_host_path_tmp1" "$func_to_host_path_result"
     func_convert_path_front_back_pathsep ":*" "*:" ";" "$1"
@@ -1903,15 +3200,16 @@ func_convert_path_nix_to_w32 ()
 # Returns result in func_to_host_file_result.
 func_convert_path_msys_to_cygwin ()
 {
-  $opt_debug
-  func_to_host_path_result="$1"
+  $debug_cmd
+
+  func_to_host_path_result=$1
   if test -n "$1"; then
     # See func_convert_path_msys_to_w32:
     func_stripname : : "$1"
     func_to_host_path_tmp1=$func_stripname_result
     func_convert_core_msys_to_w32 "$func_to_host_path_tmp1"
     func_cygpath -u -p "$func_convert_core_msys_to_w32_result"
-    func_to_host_path_result="$func_cygpath_result"
+    func_to_host_path_result=$func_cygpath_result
     func_convert_path_check : : \
       "$func_to_host_path_tmp1" "$func_to_host_path_result"
     func_convert_path_front_back_pathsep ":*" "*:" : "$1"
@@ -1926,8 +3224,9 @@ func_convert_path_msys_to_cygwin ()
 # func_to_host_file_result.
 func_convert_path_nix_to_cygwin ()
 {
-  $opt_debug
-  func_to_host_path_result="$1"
+  $debug_cmd
+
+  func_to_host_path_result=$1
   if test -n "$1"; then
     # Remove leading and trailing path separator characters from
     # ARG. msys behavior is inconsistent here, cygpath turns them
@@ -1936,7 +3235,7 @@ func_convert_path_nix_to_cygwin ()
     func_to_host_path_tmp1=$func_stripname_result
     func_convert_core_path_wine_to_w32 "$func_to_host_path_tmp1"
     func_cygpath -u -p "$func_convert_core_path_wine_to_w32_result"
-    func_to_host_path_result="$func_cygpath_result"
+    func_to_host_path_result=$func_cygpath_result
     func_convert_path_check : : \
       "$func_to_host_path_tmp1" "$func_to_host_path_result"
     func_convert_path_front_back_pathsep ":*" "*:" : "$1"
@@ -1945,13 +3244,31 @@ func_convert_path_nix_to_cygwin ()
 # end func_convert_path_nix_to_cygwin
 
 
+# func_dll_def_p FILE
+# True iff FILE is a Windows DLL '.def' file.
+# Keep in sync with _LT_DLL_DEF_P in libtool.m4
+func_dll_def_p ()
+{
+  $debug_cmd
+
+  func_dll_def_p_tmp=`$SED -n \
+    -e 's/^[	 ]*//' \
+    -e '/^\(;.*\)*$/d' \
+    -e 's/^\(EXPORTS\|LIBRARY\)\([	 ].*\)*$/DEF/p' \
+    -e q \
+    "$1"`
+  test DEF = "$func_dll_def_p_tmp"
+}
+
+
 # func_mode_compile arg...
 func_mode_compile ()
 {
-    $opt_debug
+    $debug_cmd
+
     # Get the compilation command and the source file.
     base_compile=
-    srcfile="$nonopt"  #  always keep a non-empty value in "srcfile"
+    srcfile=$nonopt  #  always keep a non-empty value in "srcfile"
     suppress_opt=yes
     suppress_output=
     arg_mode=normal
@@ -1964,12 +3281,12 @@ func_mode_compile ()
       case $arg_mode in
       arg  )
 	# do not "continue".  Instead, add this to base_compile
-	lastarg="$arg"
+	lastarg=$arg
 	arg_mode=normal
 	;;
 
       target )
-	libobj="$arg"
+	libobj=$arg
 	arg_mode=normal
 	continue
 	;;
@@ -1979,7 +3296,7 @@ func_mode_compile ()
 	case $arg in
 	-o)
 	  test -n "$libobj" && \
-	    func_fatal_error "you cannot specify \`-o' more than once"
+	    func_fatal_error "you cannot specify '-o' more than once"
 	  arg_mode=target
 	  continue
 	  ;;
@@ -2008,12 +3325,12 @@ func_mode_compile ()
 	  func_stripname '-Wc,' '' "$arg"
 	  args=$func_stripname_result
 	  lastarg=
-	  save_ifs="$IFS"; IFS=','
+	  save_ifs=$IFS; IFS=,
 	  for arg in $args; do
-	    IFS="$save_ifs"
+	    IFS=$save_ifs
 	    func_append_quoted lastarg "$arg"
 	  done
-	  IFS="$save_ifs"
+	  IFS=$save_ifs
 	  func_stripname ' ' '' "$lastarg"
 	  lastarg=$func_stripname_result
 
@@ -2026,8 +3343,8 @@ func_mode_compile ()
 	  # Accept the current argument as the source file.
 	  # The previous "srcfile" becomes the current argument.
 	  #
-	  lastarg="$srcfile"
-	  srcfile="$arg"
+	  lastarg=$srcfile
+	  srcfile=$arg
 	  ;;
 	esac  #  case $arg
 	;;
@@ -2042,13 +3359,13 @@ func_mode_compile ()
       func_fatal_error "you must specify an argument for -Xcompile"
       ;;
     target)
-      func_fatal_error "you must specify a target with \`-o'"
+      func_fatal_error "you must specify a target with '-o'"
       ;;
     *)
       # Get the name of the library object.
       test -z "$libobj" && {
 	func_basename "$srcfile"
-	libobj="$func_basename_result"
+	libobj=$func_basename_result
       }
       ;;
     esac
@@ -2059,7 +3376,7 @@ func_mode_compile ()
     *.[cCFSifmso] | \
     *.ada | *.adb | *.ads | *.asm | \
     *.c++ | *.cc | *.ii | *.class | *.cpp | *.cxx | \
-    *.[fF][09]? | *.for | *.java | *.obj | *.sx | *.cu | *.cup)
+    *.[fF][09]? | *.for | *.java | *.go | *.obj | *.sx | *.cu | *.cup)
       func_xform "$libobj"
       libobj=$func_xform_result
       ;;
@@ -2068,7 +3385,7 @@ func_mode_compile ()
     case $libobj in
     *.lo) func_lo2o "$libobj"; obj=$func_lo2o_result ;;
     *)
-      func_fatal_error "cannot determine name of library object from \`$libobj'"
+      func_fatal_error "cannot determine name of library object from '$libobj'"
       ;;
     esac
 
@@ -2077,8 +3394,8 @@ func_mode_compile ()
     for arg in $later; do
       case $arg in
       -shared)
-	test "$build_libtool_libs" != yes && \
-	  func_fatal_configuration "can not build a shared library"
+	test yes = "$build_libtool_libs" \
+	  || func_fatal_configuration "cannot build a shared library"
 	build_old_libs=no
 	continue
 	;;
@@ -2104,17 +3421,17 @@ func_mode_compile ()
     func_quote_for_eval "$libobj"
     test "X$libobj" != "X$func_quote_for_eval_result" \
       && $ECHO "X$libobj" | $GREP '[]~#^*{};<>?"'"'"'	 &()|`$[]' \
-      && func_warning "libobj name \`$libobj' may not contain shell special characters."
+      && func_warning "libobj name '$libobj' may not contain shell special characters."
     func_dirname_and_basename "$obj" "/" ""
-    objname="$func_basename_result"
-    xdir="$func_dirname_result"
-    lobj=${xdir}$objdir/$objname
+    objname=$func_basename_result
+    xdir=$func_dirname_result
+    lobj=$xdir$objdir/$objname
 
     test -z "$base_compile" && \
       func_fatal_help "you must specify a compilation command"
 
     # Delete any leftover library objects.
-    if test "$build_old_libs" = yes; then
+    if test yes = "$build_old_libs"; then
       removelist="$obj $lobj $libobj ${libobj}T"
     else
       removelist="$lobj $libobj ${libobj}T"
@@ -2126,16 +3443,16 @@ func_mode_compile ()
       pic_mode=default
       ;;
     esac
-    if test "$pic_mode" = no && test "$deplibs_check_method" != pass_all; then
+    if test no = "$pic_mode" && test pass_all != "$deplibs_check_method"; then
       # non-PIC code in shared libraries is not supported
       pic_mode=default
     fi
 
     # Calculate the filename of the output object if compiler does
     # not support -o with -c
-    if test "$compiler_c_o" = no; then
-      output_obj=`$ECHO "$srcfile" | $SED 's%^.*/%%; s%\.[^.]*$%%'`.${objext}
-      lockfile="$output_obj.lock"
+    if test no = "$compiler_c_o"; then
+      output_obj=`$ECHO "$srcfile" | $SED 's%^.*/%%; s%\.[^.]*$%%'`.$objext
+      lockfile=$output_obj.lock
     else
       output_obj=
       need_locks=no
@@ -2144,12 +3461,12 @@ func_mode_compile ()
 
     # Lock this critical section if it is needed
     # We use this script file to make the link, it avoids creating a new file
-    if test "$need_locks" = yes; then
+    if test yes = "$need_locks"; then
       until $opt_dry_run || ln "$progpath" "$lockfile" 2>/dev/null; do
 	func_echo "Waiting for $lockfile to be removed"
 	sleep 2
       done
-    elif test "$need_locks" = warn; then
+    elif test warn = "$need_locks"; then
       if test -f "$lockfile"; then
 	$ECHO "\
 *** ERROR, $lockfile exists and contains:
@@ -2157,7 +3474,7 @@ func_mode_compile ()
 
 This indicates that another process is trying to use the same
 temporary object file, and libtool could not work around it because
-your compiler does not support \`-c' and \`-o' together.  If you
+your compiler does not support '-c' and '-o' together.  If you
 repeat this compilation, it may succeed, by chance, but you had better
 avoid parallel builds (make -j) in this platform, or get a better
 compiler."
@@ -2179,11 +3496,11 @@ compiler."
     qsrcfile=$func_quote_for_eval_result
 
     # Only build a PIC object if we are building libtool libraries.
-    if test "$build_libtool_libs" = yes; then
+    if test yes = "$build_libtool_libs"; then
       # Without this assignment, base_compile gets emptied.
       fbsd_hideous_sh_bug=$base_compile
 
-      if test "$pic_mode" != no; then
+      if test no != "$pic_mode"; then
 	command="$base_compile $qsrcfile $pic_flag"
       else
 	# Don't build PIC code
@@ -2200,7 +3517,7 @@ compiler."
       func_show_eval_locale "$command"	\
           'test -n "$output_obj" && $RM $removelist; exit $EXIT_FAILURE'
 
-      if test "$need_locks" = warn &&
+      if test warn = "$need_locks" &&
 	 test "X`cat $lockfile 2>/dev/null`" != "X$srcfile"; then
 	$ECHO "\
 *** ERROR, $lockfile contains:
@@ -2211,7 +3528,7 @@ $srcfile
 
 This indicates that another process is trying to use the same
 temporary object file, and libtool could not work around it because
-your compiler does not support \`-c' and \`-o' together.  If you
+your compiler does not support '-c' and '-o' together.  If you
 repeat this compilation, it may succeed, by chance, but you had better
 avoid parallel builds (make -j) in this platform, or get a better
 compiler."
@@ -2227,20 +3544,20 @@ compiler."
       fi
 
       # Allow error messages only from the first compilation.
-      if test "$suppress_opt" = yes; then
+      if test yes = "$suppress_opt"; then
 	suppress_output=' >/dev/null 2>&1'
       fi
     fi
 
     # Only build a position-dependent object if we build old libraries.
-    if test "$build_old_libs" = yes; then
-      if test "$pic_mode" != yes; then
+    if test yes = "$build_old_libs"; then
+      if test yes != "$pic_mode"; then
 	# Don't build PIC code
 	command="$base_compile $qsrcfile$pie_flag"
       else
 	command="$base_compile $qsrcfile $pic_flag"
       fi
-      if test "$compiler_c_o" = yes; then
+      if test yes = "$compiler_c_o"; then
 	func_append command " -o $obj"
       fi
 
@@ -2249,7 +3566,7 @@ compiler."
       func_show_eval_locale "$command" \
         '$opt_dry_run || $RM $removelist; exit $EXIT_FAILURE'
 
-      if test "$need_locks" = warn &&
+      if test warn = "$need_locks" &&
 	 test "X`cat $lockfile 2>/dev/null`" != "X$srcfile"; then
 	$ECHO "\
 *** ERROR, $lockfile contains:
@@ -2260,7 +3577,7 @@ $srcfile
 
 This indicates that another process is trying to use the same
 temporary object file, and libtool could not work around it because
-your compiler does not support \`-c' and \`-o' together.  If you
+your compiler does not support '-c' and '-o' together.  If you
 repeat this compilation, it may succeed, by chance, but you had better
 avoid parallel builds (make -j) in this platform, or get a better
 compiler."
@@ -2280,7 +3597,7 @@ compiler."
       func_write_libtool_object "$libobj" "$objdir/$objname" "$objname"
 
       # Unlock the critical section if it was locked
-      if test "$need_locks" != no; then
+      if test no != "$need_locks"; then
 	removelist=$lockfile
         $RM "$lockfile"
       fi
@@ -2290,7 +3607,7 @@ compiler."
 }
 
 $opt_help || {
-  test "$opt_mode" = compile && func_mode_compile ${1+"$@"}
+  test compile = "$opt_mode" && func_mode_compile ${1+"$@"}
 }
 
 func_mode_help ()
@@ -2310,7 +3627,7 @@ func_mode_help ()
 Remove files from the build directory.
 
 RM is the name of the program to use to delete files associated with each FILE
-(typically \`/bin/rm').  RM-OPTIONS are options (such as \`-f') to be passed
+(typically '/bin/rm').  RM-OPTIONS are options (such as '-f') to be passed
 to RM.
 
 If FILE is a libtool library, object or program, all the files associated
@@ -2329,16 +3646,16 @@ This mode accepts the following addition
   -no-suppress      do not suppress compiler output for multiple passes
   -prefer-pic       try to build PIC objects only
   -prefer-non-pic   try to build non-PIC objects only
-  -shared           do not build a \`.o' file suitable for static linking
-  -static           only build a \`.o' file suitable for static linking
+  -shared           do not build a '.o' file suitable for static linking
+  -static           only build a '.o' file suitable for static linking
   -Wc,FLAG          pass FLAG directly to the compiler
 
-COMPILE-COMMAND is a command to be used in creating a \`standard' object file
+COMPILE-COMMAND is a command to be used in creating a 'standard' object file
 from the given SOURCEFILE.
 
 The output file name is determined by removing the directory component from
-SOURCEFILE, then substituting the C source code suffix \`.c' with the
-library object suffix, \`.lo'."
+SOURCEFILE, then substituting the C source code suffix '.c' with the
+library object suffix, '.lo'."
         ;;
 
       execute)
@@ -2351,7 +3668,7 @@ This mode accepts the following addition
 
   -dlopen FILE      add the directory containing FILE to the library path
 
-This mode sets the library path environment variable according to \`-dlopen'
+This mode sets the library path environment variable according to '-dlopen'
 flags.
 
 If any of the ARGS are libtool executable wrappers, then they are translated
@@ -2370,7 +3687,7 @@ Complete the installation of libtool lib
 Each LIBDIR is a directory that contains libtool libraries.
 
 The commands that this mode executes may require superuser privileges.  Use
-the \`--dry-run' option if you just want to see what would be executed."
+the '--dry-run' option if you just want to see what would be executed."
         ;;
 
       install)
@@ -2380,7 +3697,7 @@ the \`--dry-run' option if you just want
 Install executables or libraries.
 
 INSTALL-COMMAND is the installation command.  The first component should be
-either the \`install' or \`cp' program.
+either the 'install' or 'cp' program.
 
 The following components of INSTALL-COMMAND are treated specially:
 
@@ -2406,7 +3723,7 @@ The following components of LINK-COMMAND
   -avoid-version    do not add a version suffix if possible
   -bindir BINDIR    specify path to binaries directory (for systems where
                     libraries must be found in the PATH setting at runtime)
-  -dlopen FILE      \`-dlpreopen' FILE if it cannot be dlopened at runtime
+  -dlopen FILE      '-dlpreopen' FILE if it cannot be dlopened at runtime
   -dlpreopen FILE   link in FILE and add its symbols to lt_preloaded_symbols
   -export-dynamic   allow symbols from OUTPUT-FILE to be resolved with dlsym(3)
   -export-symbols SYMFILE
@@ -2420,7 +3737,8 @@ The following components of LINK-COMMAND
   -no-install       link a not-installable executable
   -no-undefined     declare that a library does not refer to external symbols
   -o OUTPUT-FILE    create OUTPUT-FILE from the specified objects
-  -objectlist FILE  Use a list of object files found in FILE to specify objects
+  -objectlist FILE  use a list of object files found in FILE to specify objects
+  -os2dllname NAME  force a short DLL name on OS/2 (no effect on other OSes)
   -precious-files-regex REGEX
                     don't remove output files matching REGEX
   -release RELEASE  specify package release information
@@ -2440,20 +3758,20 @@ The following components of LINK-COMMAND
   -Xlinker FLAG     pass linker-specific FLAG directly to the linker
   -XCClinker FLAG   pass link-specific FLAG to the compiler driver (CC)
 
-All other options (arguments beginning with \`-') are ignored.
+All other options (arguments beginning with '-') are ignored.
 
-Every other argument is treated as a filename.  Files ending in \`.la' are
+Every other argument is treated as a filename.  Files ending in '.la' are
 treated as uninstalled libtool libraries, other files are standard or library
 object files.
 
-If the OUTPUT-FILE ends in \`.la', then a libtool library is created,
-only library objects (\`.lo' files) may be specified, and \`-rpath' is
+If the OUTPUT-FILE ends in '.la', then a libtool library is created,
+only library objects ('.lo' files) may be specified, and '-rpath' is
 required, except when creating a convenience library.
 
-If OUTPUT-FILE ends in \`.a' or \`.lib', then a standard library is created
-using \`ar' and \`ranlib', or on Windows using \`lib'.
+If OUTPUT-FILE ends in '.a' or '.lib', then a standard library is created
+using 'ar' and 'ranlib', or on Windows using 'lib'.
 
-If OUTPUT-FILE ends in \`.lo' or \`.${objext}', then a reloadable object file
+If OUTPUT-FILE ends in '.lo' or '.$objext', then a reloadable object file
 is created, otherwise an executable program is created."
         ;;
 
@@ -2464,7 +3782,7 @@ is created, otherwise an executable prog
 Remove libraries from an installation directory.
 
 RM is the name of the program to use to delete files associated with each FILE
-(typically \`/bin/rm').  RM-OPTIONS are options (such as \`-f') to be passed
+(typically '/bin/rm').  RM-OPTIONS are options (such as '-f') to be passed
 to RM.
 
 If FILE is a libtool library, all the files associated with it are deleted.
@@ -2472,17 +3790,17 @@ Otherwise, only FILE itself is deleted u
         ;;
 
       *)
-        func_fatal_help "invalid operation mode \`$opt_mode'"
+        func_fatal_help "invalid operation mode '$opt_mode'"
         ;;
     esac
 
     echo
-    $ECHO "Try \`$progname --help' for more information about other modes."
+    $ECHO "Try '$progname --help' for more information about other modes."
 }
 
 # Now that we've collected a possible --mode arg, show help if necessary
 if $opt_help; then
-  if test "$opt_help" = :; then
+  if test : = "$opt_help"; then
     func_mode_help
   else
     {
@@ -2490,7 +3808,7 @@ if $opt_help; then
       for opt_mode in compile link execute install finish uninstall clean; do
 	func_mode_help
       done
-    } | sed -n '1p; 2,$s/^Usage:/  or: /p'
+    } | $SED -n '1p; 2,$s/^Usage:/  or: /p'
     {
       func_help noexit
       for opt_mode in compile link execute install finish uninstall clean; do
@@ -2498,7 +3816,7 @@ if $opt_help; then
 	func_mode_help
       done
     } |
-    sed '1d
+    $SED '1d
       /^When reporting/,/^Report/{
 	H
 	d
@@ -2515,16 +3833,17 @@ fi
 # func_mode_execute arg...
 func_mode_execute ()
 {
-    $opt_debug
+    $debug_cmd
+
     # The first argument is the command name.
-    cmd="$nonopt"
+    cmd=$nonopt
     test -z "$cmd" && \
       func_fatal_help "you must specify a COMMAND"
 
     # Handle -dlopen flags immediately.
     for file in $opt_dlopen; do
       test -f "$file" \
-	|| func_fatal_help "\`$file' is not a file"
+	|| func_fatal_help "'$file' is not a file"
 
       dir=
       case $file in
@@ -2534,7 +3853,7 @@ func_mode_execute ()
 
 	# Check to see that this really is a libtool archive.
 	func_lalib_unsafe_p "$file" \
-	  || func_fatal_help "\`$lib' is not a valid libtool archive"
+	  || func_fatal_help "'$lib' is not a valid libtool archive"
 
 	# Read the libtool library.
 	dlname=
@@ -2545,18 +3864,18 @@ func_mode_execute ()
 	if test -z "$dlname"; then
 	  # Warn if it was a shared library.
 	  test -n "$library_names" && \
-	    func_warning "\`$file' was not linked with \`-export-dynamic'"
+	    func_warning "'$file' was not linked with '-export-dynamic'"
 	  continue
 	fi
 
 	func_dirname "$file" "" "."
-	dir="$func_dirname_result"
+	dir=$func_dirname_result
 
 	if test -f "$dir/$objdir/$dlname"; then
 	  func_append dir "/$objdir"
 	else
 	  if test ! -f "$dir/$dlname"; then
-	    func_fatal_error "cannot find \`$dlname' in \`$dir' or \`$dir/$objdir'"
+	    func_fatal_error "cannot find '$dlname' in '$dir' or '$dir/$objdir'"
 	  fi
 	fi
 	;;
@@ -2564,18 +3883,18 @@ func_mode_execute ()
       *.lo)
 	# Just add the directory containing the .lo file.
 	func_dirname "$file" "" "."
-	dir="$func_dirname_result"
+	dir=$func_dirname_result
 	;;
 
       *)
-	func_warning "\`-dlopen' is ignored for non-libtool libraries and objects"
+	func_warning "'-dlopen' is ignored for non-libtool libraries and objects"
 	continue
 	;;
       esac
 
       # Get the absolute pathname.
       absdir=`cd "$dir" && pwd`
-      test -n "$absdir" && dir="$absdir"
+      test -n "$absdir" && dir=$absdir
 
       # Now add the directory to shlibpath_var.
       if eval "test -z \"\$$shlibpath_var\""; then
@@ -2587,7 +3906,7 @@ func_mode_execute ()
 
     # This variable tells wrapper scripts just to set shlibpath_var
     # rather than running their programs.
-    libtool_execute_magic="$magic"
+    libtool_execute_magic=$magic
 
     # Check if any of the arguments is a wrapper script.
     args=
@@ -2600,12 +3919,12 @@ func_mode_execute ()
 	if func_ltwrapper_script_p "$file"; then
 	  func_source "$file"
 	  # Transform arg to wrapped name.
-	  file="$progdir/$program"
+	  file=$progdir/$program
 	elif func_ltwrapper_executable_p "$file"; then
 	  func_ltwrapper_scriptname "$file"
 	  func_source "$func_ltwrapper_scriptname_result"
 	  # Transform arg to wrapped name.
-	  file="$progdir/$program"
+	  file=$progdir/$program
 	fi
 	;;
       esac
@@ -2613,7 +3932,15 @@ func_mode_execute ()
       func_append_quoted args "$file"
     done
 
-    if test "X$opt_dry_run" = Xfalse; then
+    if $opt_dry_run; then
+      # Display what would be done.
+      if test -n "$shlibpath_var"; then
+	eval "\$ECHO \"\$shlibpath_var=\$$shlibpath_var\""
+	echo "export $shlibpath_var"
+      fi
+      $ECHO "$cmd$args"
+      exit $EXIT_SUCCESS
+    else
       if test -n "$shlibpath_var"; then
 	# Export the shlibpath_var.
 	eval "export $shlibpath_var"
@@ -2630,25 +3957,18 @@ func_mode_execute ()
       done
 
       # Now prepare to actually exec the command.
-      exec_cmd="\$cmd$args"
-    else
-      # Display what would be done.
-      if test -n "$shlibpath_var"; then
-	eval "\$ECHO \"\$shlibpath_var=\$$shlibpath_var\""
-	echo "export $shlibpath_var"
-      fi
-      $ECHO "$cmd$args"
-      exit $EXIT_SUCCESS
+      exec_cmd=\$cmd$args
     fi
 }
 
-test "$opt_mode" = execute && func_mode_execute ${1+"$@"}
+test execute = "$opt_mode" && func_mode_execute ${1+"$@"}
 
 
 # func_mode_finish arg...
 func_mode_finish ()
 {
-    $opt_debug
+    $debug_cmd
+
     libs=
     libdirs=
     admincmds=
@@ -2662,11 +3982,11 @@ func_mode_finish ()
 	if func_lalib_unsafe_p "$opt"; then
 	  func_append libs " $opt"
 	else
-	  func_warning "\`$opt' is not a valid libtool archive"
+	  func_warning "'$opt' is not a valid libtool archive"
 	fi
 
       else
-	func_fatal_error "invalid argument \`$opt'"
+	func_fatal_error "invalid argument '$opt'"
       fi
     done
 
@@ -2681,12 +4001,12 @@ func_mode_finish ()
       # Remove sysroot references
       if $opt_dry_run; then
         for lib in $libs; do
-          echo "removing references to $lt_sysroot and \`=' prefixes from $lib"
+          echo "removing references to $lt_sysroot and '=' prefixes from $lib"
         done
       else
         tmpdir=`func_mktempdir`
         for lib in $libs; do
-	  sed -e "${sysroot_cmd} s/\([ ']-[LR]\)=/\1/g; s/\([ ']\)=/\1/g" $lib \
+	  $SED -e "$sysroot_cmd s/\([ ']-[LR]\)=/\1/g; s/\([ ']\)=/\1/g" $lib \
 	    > $tmpdir/tmp-la
 	  mv -f $tmpdir/tmp-la $lib
 	done
@@ -2711,7 +4031,7 @@ func_mode_finish ()
     fi
 
     # Exit here if they wanted silent mode.
-    $opt_silent && exit $EXIT_SUCCESS
+    $opt_quiet && exit $EXIT_SUCCESS
 
     if test -n "$finish_cmds$finish_eval" && test -n "$libdirs"; then
       echo "----------------------------------------------------------------------"
@@ -2722,27 +4042,27 @@ func_mode_finish ()
       echo
       echo "If you ever happen to want to link against installed libraries"
       echo "in a given directory, LIBDIR, you must either use libtool, and"
-      echo "specify the full pathname of the library, or use the \`-LLIBDIR'"
+      echo "specify the full pathname of the library, or use the '-LLIBDIR'"
       echo "flag during linking and do at least one of the following:"
       if test -n "$shlibpath_var"; then
-	echo "   - add LIBDIR to the \`$shlibpath_var' environment variable"
+	echo "   - add LIBDIR to the '$shlibpath_var' environment variable"
 	echo "     during execution"
       fi
       if test -n "$runpath_var"; then
-	echo "   - add LIBDIR to the \`$runpath_var' environment variable"
+	echo "   - add LIBDIR to the '$runpath_var' environment variable"
 	echo "     during linking"
       fi
       if test -n "$hardcode_libdir_flag_spec"; then
 	libdir=LIBDIR
 	eval flag=\"$hardcode_libdir_flag_spec\"
 
-	$ECHO "   - use the \`$flag' linker flag"
+	$ECHO "   - use the '$flag' linker flag"
       fi
       if test -n "$admincmds"; then
 	$ECHO "   - have your system administrator run these commands:$admincmds"
       fi
       if test -f /etc/ld.so.conf; then
-	echo "   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'"
+	echo "   - have your system administrator add LIBDIR to '/etc/ld.so.conf'"
       fi
       echo
 
@@ -2761,18 +4081,20 @@ func_mode_finish ()
     exit $EXIT_SUCCESS
 }
 
-test "$opt_mode" = finish && func_mode_finish ${1+"$@"}
+test finish = "$opt_mode" && func_mode_finish ${1+"$@"}
 
 
 # func_mode_install arg...
 func_mode_install ()
 {
-    $opt_debug
+    $debug_cmd
+
     # There may be an optional sh(1) argument at the beginning of
     # install_prog (especially on Windows NT).
-    if test "$nonopt" = "$SHELL" || test "$nonopt" = /bin/sh ||
+    if test "$SHELL" = "$nonopt" || test /bin/sh = "$nonopt" ||
        # Allow the use of GNU shtool's install command.
-       case $nonopt in *shtool*) :;; *) false;; esac; then
+       case $nonopt in *shtool*) :;; *) false;; esac
+    then
       # Aesthetically quote it.
       func_quote_for_eval "$nonopt"
       install_prog="$func_quote_for_eval_result "
@@ -2799,7 +4121,7 @@ func_mode_install ()
     opts=
     prev=
     install_type=
-    isdir=no
+    isdir=false
     stripme=
     no_mode=:
     for arg
@@ -2812,7 +4134,7 @@ func_mode_install ()
       fi
 
       case $arg in
-      -d) isdir=yes ;;
+      -d) isdir=: ;;
       -f)
 	if $install_cp; then :; else
 	  prev=$arg
@@ -2830,7 +4152,7 @@ func_mode_install ()
       *)
 	# If the previous option needed an argument, then skip it.
 	if test -n "$prev"; then
-	  if test "x$prev" = x-m && test -n "$install_override_mode"; then
+	  if test X-m = "X$prev" && test -n "$install_override_mode"; then
 	    arg2=$install_override_mode
 	    no_mode=false
 	  fi
@@ -2855,7 +4177,7 @@ func_mode_install ()
       func_fatal_help "you must specify an install program"
 
     test -n "$prev" && \
-      func_fatal_help "the \`$prev' option requires an argument"
+      func_fatal_help "the '$prev' option requires an argument"
 
     if test -n "$install_override_mode" && $no_mode; then
       if $install_cp; then :; else
@@ -2877,19 +4199,19 @@ func_mode_install ()
     dest=$func_stripname_result
 
     # Check to see that the destination is a directory.
-    test -d "$dest" && isdir=yes
-    if test "$isdir" = yes; then
-      destdir="$dest"
+    test -d "$dest" && isdir=:
+    if $isdir; then
+      destdir=$dest
       destname=
     else
       func_dirname_and_basename "$dest" "" "."
-      destdir="$func_dirname_result"
-      destname="$func_basename_result"
+      destdir=$func_dirname_result
+      destname=$func_basename_result
 
       # Not a directory, so check to see that there is only one file specified.
       set dummy $files; shift
       test "$#" -gt 1 && \
-	func_fatal_help "\`$dest' is not a directory"
+	func_fatal_help "'$dest' is not a directory"
     fi
     case $destdir in
     [\\/]* | [A-Za-z]:[\\/]*) ;;
@@ -2898,7 +4220,7 @@ func_mode_install ()
 	case $file in
 	*.lo) ;;
 	*)
-	  func_fatal_help "\`$destdir' must be an absolute directory name"
+	  func_fatal_help "'$destdir' must be an absolute directory name"
 	  ;;
 	esac
       done
@@ -2907,7 +4229,7 @@ func_mode_install ()
 
     # This variable tells wrapper scripts just to set variables rather
     # than running their programs.
-    libtool_install_magic="$magic"
+    libtool_install_magic=$magic
 
     staticlibs=
     future_libdirs=
@@ -2927,7 +4249,7 @@ func_mode_install ()
 
 	# Check to see that this really is a libtool archive.
 	func_lalib_unsafe_p "$file" \
-	  || func_fatal_help "\`$file' is not a valid libtool archive"
+	  || func_fatal_help "'$file' is not a valid libtool archive"
 
 	library_names=
 	old_library=
@@ -2949,7 +4271,7 @@ func_mode_install ()
 	fi
 
 	func_dirname "$file" "/" ""
-	dir="$func_dirname_result"
+	dir=$func_dirname_result
 	func_append dir "$objdir"
 
 	if test -n "$relink_command"; then
@@ -2963,7 +4285,7 @@ func_mode_install ()
 	  # are installed into $libdir/../bin (currently, that works fine)
 	  # but it's something to keep an eye on.
 	  test "$inst_prefix_dir" = "$destdir" && \
-	    func_fatal_error "error: cannot install \`$file' to a directory not ending in $libdir"
+	    func_fatal_error "error: cannot install '$file' to a directory not ending in $libdir"
 
 	  if test -n "$inst_prefix_dir"; then
 	    # Stick the inst_prefix_dir data into the link command.
@@ -2972,29 +4294,36 @@ func_mode_install ()
 	    relink_command=`$ECHO "$relink_command" | $SED "s%@inst_prefix_dir@%%"`
 	  fi
 
-	  func_warning "relinking \`$file'"
+	  func_warning "relinking '$file'"
 	  func_show_eval "$relink_command" \
-	    'func_fatal_error "error: relink \`$file'\'' with the above command before installing it"'
+	    'func_fatal_error "error: relink '\''$file'\'' with the above command before installing it"'
 	fi
 
 	# See the names of the shared library.
 	set dummy $library_names; shift
 	if test -n "$1"; then
-	  realname="$1"
+	  realname=$1
 	  shift
 
-	  srcname="$realname"
-	  test -n "$relink_command" && srcname="$realname"T
+	  srcname=$realname
+	  test -n "$relink_command" && srcname=${realname}T
 
 	  # Install the shared library and build the symlinks.
 	  func_show_eval "$install_shared_prog $dir/$srcname $destdir/$realname" \
 	      'exit $?'
-	  tstripme="$stripme"
+	  tstripme=$stripme
 	  case $host_os in
 	  cygwin* | mingw* | pw32* | cegcc*)
 	    case $realname in
 	    *.dll.a)
-	      tstripme=""
+	      tstripme=
+	      ;;
+	    esac
+	    ;;
+	  os2*)
+	    case $realname in
+	    *_dll.a)
+	      tstripme=
 	      ;;
 	    esac
 	    ;;
@@ -3005,7 +4334,7 @@ func_mode_install ()
 
 	  if test "$#" -gt 0; then
 	    # Delete the old symlinks, and create new ones.
-	    # Try `ln -sf' first, because the `ln' binary might depend on
+	    # Try 'ln -sf' first, because the 'ln' binary might depend on
 	    # the symlink we replace!  Solaris /bin/ln does not understand -f,
 	    # so we also need to try rm && ln -s.
 	    for linkname
@@ -3016,14 +4345,14 @@ func_mode_install ()
 	  fi
 
 	  # Do each command in the postinstall commands.
-	  lib="$destdir/$realname"
+	  lib=$destdir/$realname
 	  func_execute_cmds "$postinstall_cmds" 'exit $?'
 	fi
 
 	# Install the pseudo-library for information purposes.
 	func_basename "$file"
-	name="$func_basename_result"
-	instname="$dir/$name"i
+	name=$func_basename_result
+	instname=$dir/${name}i
 	func_show_eval "$install_prog $instname $destdir/$name" 'exit $?'
 
 	# Maybe install the static library, too.
@@ -3035,11 +4364,11 @@ func_mode_install ()
 
 	# Figure out destination file name, if it wasn't already specified.
 	if test -n "$destname"; then
-	  destfile="$destdir/$destname"
+	  destfile=$destdir/$destname
 	else
 	  func_basename "$file"
-	  destfile="$func_basename_result"
-	  destfile="$destdir/$destfile"
+	  destfile=$func_basename_result
+	  destfile=$destdir/$destfile
 	fi
 
 	# Deduce the name of the destination old-style object file.
@@ -3049,11 +4378,11 @@ func_mode_install ()
 	  staticdest=$func_lo2o_result
 	  ;;
 	*.$objext)
-	  staticdest="$destfile"
+	  staticdest=$destfile
 	  destfile=
 	  ;;
 	*)
-	  func_fatal_help "cannot copy a libtool object to \`$destfile'"
+	  func_fatal_help "cannot copy a libtool object to '$destfile'"
 	  ;;
 	esac
 
@@ -3062,7 +4391,7 @@ func_mode_install ()
 	  func_show_eval "$install_prog $file $destfile" 'exit $?'
 
 	# Install the old object if enabled.
-	if test "$build_old_libs" = yes; then
+	if test yes = "$build_old_libs"; then
 	  # Deduce the name of the old-style object file.
 	  func_lo2o "$file"
 	  staticobj=$func_lo2o_result
@@ -3074,23 +4403,23 @@ func_mode_install ()
       *)
 	# Figure out destination file name, if it wasn't already specified.
 	if test -n "$destname"; then
-	  destfile="$destdir/$destname"
+	  destfile=$destdir/$destname
 	else
 	  func_basename "$file"
-	  destfile="$func_basename_result"
-	  destfile="$destdir/$destfile"
+	  destfile=$func_basename_result
+	  destfile=$destdir/$destfile
 	fi
 
 	# If the file is missing, and there is a .exe on the end, strip it
 	# because it is most likely a libtool script we actually want to
 	# install
-	stripped_ext=""
+	stripped_ext=
 	case $file in
 	  *.exe)
 	    if test ! -f "$file"; then
 	      func_stripname '' '.exe' "$file"
 	      file=$func_stripname_result
-	      stripped_ext=".exe"
+	      stripped_ext=.exe
 	    fi
 	    ;;
 	esac
@@ -3118,19 +4447,19 @@ func_mode_install ()
 
 	  # Check the variables that should have been set.
 	  test -z "$generated_by_libtool_version" && \
-	    func_fatal_error "invalid libtool wrapper script \`$wrapper'"
+	    func_fatal_error "invalid libtool wrapper script '$wrapper'"
 
-	  finalize=yes
+	  finalize=:
 	  for lib in $notinst_deplibs; do
 	    # Check to see that each library is installed.
 	    libdir=
 	    if test -f "$lib"; then
 	      func_source "$lib"
 	    fi
-	    libfile="$libdir/"`$ECHO "$lib" | $SED 's%^.*/%%g'` ### testsuite: skip nested quoting test
+	    libfile=$libdir/`$ECHO "$lib" | $SED 's%^.*/%%g'`
 	    if test -n "$libdir" && test ! -f "$libfile"; then
-	      func_warning "\`$lib' has not been installed in \`$libdir'"
-	      finalize=no
+	      func_warning "'$lib' has not been installed in '$libdir'"
+	      finalize=false
 	    fi
 	  done
 
@@ -3138,29 +4467,29 @@ func_mode_install ()
 	  func_source "$wrapper"
 
 	  outputname=
-	  if test "$fast_install" = no && test -n "$relink_command"; then
+	  if test no = "$fast_install" && test -n "$relink_command"; then
 	    $opt_dry_run || {
-	      if test "$finalize" = yes; then
+	      if $finalize; then
 	        tmpdir=`func_mktempdir`
 		func_basename "$file$stripped_ext"
-		file="$func_basename_result"
-	        outputname="$tmpdir/$file"
+		file=$func_basename_result
+	        outputname=$tmpdir/$file
 	        # Replace the output file specification.
 	        relink_command=`$ECHO "$relink_command" | $SED 's%@OUTPUT@%'"$outputname"'%g'`
 
-	        $opt_silent || {
+	        $opt_quiet || {
 	          func_quote_for_expand "$relink_command"
 		  eval "func_echo $func_quote_for_expand_result"
 	        }
 	        if eval "$relink_command"; then :
 	          else
-		  func_error "error: relink \`$file' with the above command before installing it"
+		  func_error "error: relink '$file' with the above command before installing it"
 		  $opt_dry_run || ${RM}r "$tmpdir"
 		  continue
 	        fi
-	        file="$outputname"
+	        file=$outputname
 	      else
-	        func_warning "cannot relink \`$file'"
+	        func_warning "cannot relink '$file'"
 	      fi
 	    }
 	  else
@@ -3197,15 +4526,17 @@ func_mode_install ()
 
     for file in $staticlibs; do
       func_basename "$file"
-      name="$func_basename_result"
+      name=$func_basename_result
 
       # Set up the ranlib parameters.
-      oldlib="$destdir/$name"
+      oldlib=$destdir/$name
+      func_to_tool_file "$oldlib" func_convert_file_msys_to_w32
+      tool_oldlib=$func_to_tool_file_result
 
       func_show_eval "$install_prog \$file \$oldlib" 'exit $?'
 
       if test -n "$stripme" && test -n "$old_striplib"; then
-	func_show_eval "$old_striplib $oldlib" 'exit $?'
+	func_show_eval "$old_striplib $tool_oldlib" 'exit $?'
       fi
 
       # Do each command in the postinstall commands.
@@ -3213,18 +4544,18 @@ func_mode_install ()
     done
 
     test -n "$future_libdirs" && \
-      func_warning "remember to run \`$progname --finish$future_libdirs'"
+      func_warning "remember to run '$progname --finish$future_libdirs'"
 
     if test -n "$current_libdirs"; then
       # Maybe just do a dry run.
       $opt_dry_run && current_libdirs=" -n$current_libdirs"
-      exec_cmd='$SHELL $progpath $preserve_args --finish$current_libdirs'
+      exec_cmd='$SHELL "$progpath" $preserve_args --finish$current_libdirs'
     else
       exit $EXIT_SUCCESS
     fi
 }
 
-test "$opt_mode" = install && func_mode_install ${1+"$@"}
+test install = "$opt_mode" && func_mode_install ${1+"$@"}
 
 
 # func_generate_dlsyms outputname originator pic_p
@@ -3232,16 +4563,17 @@ test "$opt_mode" = install && func_mode_
 # a dlpreopen symbol table.
 func_generate_dlsyms ()
 {
-    $opt_debug
-    my_outputname="$1"
-    my_originator="$2"
-    my_pic_p="${3-no}"
-    my_prefix=`$ECHO "$my_originator" | sed 's%[^a-zA-Z0-9]%_%g'`
+    $debug_cmd
+
+    my_outputname=$1
+    my_originator=$2
+    my_pic_p=${3-false}
+    my_prefix=`$ECHO "$my_originator" | $SED 's%[^a-zA-Z0-9]%_%g'`
     my_dlsyms=
 
-    if test -n "$dlfiles$dlprefiles" || test "$dlself" != no; then
+    if test -n "$dlfiles$dlprefiles" || test no != "$dlself"; then
       if test -n "$NM" && test -n "$global_symbol_pipe"; then
-	my_dlsyms="${my_outputname}S.c"
+	my_dlsyms=${my_outputname}S.c
       else
 	func_error "not configured to extract global symbols from dlpreopened files"
       fi
@@ -3252,7 +4584,7 @@ func_generate_dlsyms ()
       "") ;;
       *.c)
 	# Discover the nlist of each of the dlfiles.
-	nlist="$output_objdir/${my_outputname}.nm"
+	nlist=$output_objdir/$my_outputname.nm
 
 	func_show_eval "$RM $nlist ${nlist}S ${nlist}T"
 
@@ -3260,34 +4592,36 @@ func_generate_dlsyms ()
 	func_verbose "creating $output_objdir/$my_dlsyms"
 
 	$opt_dry_run || $ECHO > "$output_objdir/$my_dlsyms" "\
-/* $my_dlsyms - symbol resolution table for \`$my_outputname' dlsym emulation. */
-/* Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION */
+/* $my_dlsyms - symbol resolution table for '$my_outputname' dlsym emulation. */
+/* Generated by $PROGRAM (GNU $PACKAGE) $VERSION */
 
 #ifdef __cplusplus
 extern \"C\" {
 #endif
 
-#if defined(__GNUC__) && (((__GNUC__ == 4) && (__GNUC_MINOR__ >= 4)) || (__GNUC__ > 4))
+#if defined __GNUC__ && (((__GNUC__ == 4) && (__GNUC_MINOR__ >= 4)) || (__GNUC__ > 4))
 #pragma GCC diagnostic ignored \"-Wstrict-prototypes\"
 #endif
 
 /* Keep this code in sync between libtool.m4, ltmain, lt_system.h, and tests.  */
-#if defined(_WIN32) || defined(__CYGWIN__) || defined(_WIN32_WCE)
-/* DATA imports from DLLs on WIN32 con't be const, because runtime
+#if defined _WIN32 || defined __CYGWIN__ || defined _WIN32_WCE
+/* DATA imports from DLLs on WIN32 can't be const, because runtime
    relocations are performed -- see ld's documentation on pseudo-relocs.  */
 # define LT_DLSYM_CONST
-#elif defined(__osf__)
+#elif defined __osf__
 /* This system does not cope well with relocations in const data.  */
 # define LT_DLSYM_CONST
 #else
 # define LT_DLSYM_CONST const
 #endif
 
+#define STREQ(s1, s2) (strcmp ((s1), (s2)) == 0)
+
 /* External symbol declarations for the compiler. */\
 "
 
-	if test "$dlself" = yes; then
-	  func_verbose "generating symbol list for \`$output'"
+	if test yes = "$dlself"; then
+	  func_verbose "generating symbol list for '$output'"
 
 	  $opt_dry_run || echo ': @PROGRAM@ ' > "$nlist"
 
@@ -3295,7 +4629,7 @@ extern \"C\" {
 	  progfiles=`$ECHO "$objs$old_deplibs" | $SP2NL | $SED "$lo2o" | $NL2SP`
 	  for progfile in $progfiles; do
 	    func_to_tool_file "$progfile" func_convert_file_msys_to_w32
-	    func_verbose "extracting global C symbols from \`$func_to_tool_file_result'"
+	    func_verbose "extracting global C symbols from '$func_to_tool_file_result'"
 	    $opt_dry_run || eval "$NM $func_to_tool_file_result | $global_symbol_pipe >> '$nlist'"
 	  done
 
@@ -3315,10 +4649,10 @@ extern \"C\" {
 
 	  # Prepare the list of exported symbols
 	  if test -z "$export_symbols"; then
-	    export_symbols="$output_objdir/$outputname.exp"
+	    export_symbols=$output_objdir/$outputname.exp
 	    $opt_dry_run || {
 	      $RM $export_symbols
-	      eval "${SED} -n -e '/^: @PROGRAM@ $/d' -e 's/^.* \(.*\)$/\1/p' "'< "$nlist" > "$export_symbols"'
+	      eval "$SED -n -e '/^: @PROGRAM@ $/d' -e 's/^.* \(.*\)$/\1/p' "'< "$nlist" > "$export_symbols"'
 	      case $host in
 	      *cygwin* | *mingw* | *cegcc* )
                 eval "echo EXPORTS "'> "$output_objdir/$outputname.def"'
@@ -3328,7 +4662,7 @@ extern \"C\" {
 	    }
 	  else
 	    $opt_dry_run || {
-	      eval "${SED} -e 's/\([].[*^$]\)/\\\\\1/g' -e 's/^/ /' -e 's/$/$/'"' < "$export_symbols" > "$output_objdir/$outputname.exp"'
+	      eval "$SED -e 's/\([].[*^$]\)/\\\\\1/g' -e 's/^/ /' -e 's/$/$/'"' < "$export_symbols" > "$output_objdir/$outputname.exp"'
 	      eval '$GREP -f "$output_objdir/$outputname.exp" < "$nlist" > "$nlist"T'
 	      eval '$MV "$nlist"T "$nlist"'
 	      case $host in
@@ -3342,22 +4676,22 @@ extern \"C\" {
 	fi
 
 	for dlprefile in $dlprefiles; do
-	  func_verbose "extracting global C symbols from \`$dlprefile'"
+	  func_verbose "extracting global C symbols from '$dlprefile'"
 	  func_basename "$dlprefile"
-	  name="$func_basename_result"
+	  name=$func_basename_result
           case $host in
 	    *cygwin* | *mingw* | *cegcc* )
 	      # if an import library, we need to obtain dlname
 	      if func_win32_import_lib_p "$dlprefile"; then
 	        func_tr_sh "$dlprefile"
 	        eval "curr_lafile=\$libfile_$func_tr_sh_result"
-	        dlprefile_dlbasename=""
+	        dlprefile_dlbasename=
 	        if test -n "$curr_lafile" && func_lalib_p "$curr_lafile"; then
 	          # Use subshell, to avoid clobbering current variable values
 	          dlprefile_dlname=`source "$curr_lafile" && echo "$dlname"`
-	          if test -n "$dlprefile_dlname" ; then
+	          if test -n "$dlprefile_dlname"; then
 	            func_basename "$dlprefile_dlname"
-	            dlprefile_dlbasename="$func_basename_result"
+	            dlprefile_dlbasename=$func_basename_result
 	          else
 	            # no lafile. user explicitly requested -dlpreopen <import library>.
 	            $sharedlib_from_linklib_cmd "$dlprefile"
@@ -3365,7 +4699,7 @@ extern \"C\" {
 	          fi
 	        fi
 	        $opt_dry_run || {
-	          if test -n "$dlprefile_dlbasename" ; then
+	          if test -n "$dlprefile_dlbasename"; then
 	            eval '$ECHO ": $dlprefile_dlbasename" >> "$nlist"'
 	          else
 	            func_warning "Could not compute DLL name from $name"
@@ -3421,6 +4755,11 @@ extern \"C\" {
 	    echo '/* NONE */' >> "$output_objdir/$my_dlsyms"
 	  fi
 
+	  func_show_eval '$RM "${nlist}I"'
+	  if test -n "$global_symbol_to_import"; then
+	    eval "$global_symbol_to_import"' < "$nlist"S > "$nlist"I'
+	  fi
+
 	  echo >> "$output_objdir/$my_dlsyms" "\
 
 /* The mapping between symbol names and symbols.  */
@@ -3429,11 +4768,30 @@ typedef struct {
   void *address;
 } lt_dlsymlist;
 extern LT_DLSYM_CONST lt_dlsymlist
-lt_${my_prefix}_LTX_preloaded_symbols[];
+lt_${my_prefix}_LTX_preloaded_symbols[];\
+"
+
+	  if test -s "$nlist"I; then
+	    echo >> "$output_objdir/$my_dlsyms" "\
+static void lt_syminit(void)
+{
+  LT_DLSYM_CONST lt_dlsymlist *symbol = lt_${my_prefix}_LTX_preloaded_symbols;
+  for (; symbol->name; ++symbol)
+    {"
+	    $SED 's/.*/      if (STREQ (symbol->name, \"&\")) symbol->address = (void *) \&&;/' < "$nlist"I >> "$output_objdir/$my_dlsyms"
+	    echo >> "$output_objdir/$my_dlsyms" "\
+    }
+}"
+	  fi
+	  echo >> "$output_objdir/$my_dlsyms" "\
 LT_DLSYM_CONST lt_dlsymlist
 lt_${my_prefix}_LTX_preloaded_symbols[] =
-{\
-  { \"$my_originator\", (void *) 0 },"
+{ {\"$my_originator\", (void *) 0},"
+
+	  if test -s "$nlist"I; then
+	    echo >> "$output_objdir/$my_dlsyms" "\
+  {\"@INIT@\", (void *) &lt_syminit},"
+	  fi
 
 	  case $need_lib_prefix in
 	  no)
@@ -3470,14 +4828,12 @@ static const void *lt_preloaded_setup()
 	  # linked before any other PIC object.  But we must not use
 	  # pic_flag when linking with -static.  The problem exists in
 	  # FreeBSD 2.2.6 and is fixed in FreeBSD 3.1.
-	  *-*-freebsd2*|*-*-freebsd3.0*|*-*-freebsdelf3.0*)
+	  *-*-freebsd2.*|*-*-freebsd3.0*|*-*-freebsdelf3.0*)
 	    pic_flag_for_symtable=" $pic_flag -DFREEBSD_WORKAROUND" ;;
 	  *-*-hpux*)
 	    pic_flag_for_symtable=" $pic_flag"  ;;
 	  *)
-	    if test "X$my_pic_p" != Xno; then
-	      pic_flag_for_symtable=" $pic_flag"
-	    fi
+	    $my_pic_p && pic_flag_for_symtable=" $pic_flag"
 	    ;;
 	  esac
 	  ;;
@@ -3494,10 +4850,10 @@ static const void *lt_preloaded_setup()
 	func_show_eval '(cd $output_objdir && $LTCC$symtab_cflags -c$no_builtin_flag$pic_flag_for_symtable "$my_dlsyms")' 'exit $?'
 
 	# Clean up the generated files.
-	func_show_eval '$RM "$output_objdir/$my_dlsyms" "$nlist" "${nlist}S" "${nlist}T"'
+	func_show_eval '$RM "$output_objdir/$my_dlsyms" "$nlist" "${nlist}S" "${nlist}T" "${nlist}I"'
 
 	# Transform the symbol file into the correct name.
-	symfileobj="$output_objdir/${my_outputname}S.$objext"
+	symfileobj=$output_objdir/${my_outputname}S.$objext
 	case $host in
 	*cygwin* | *mingw* | *cegcc* )
 	  if test -f "$output_objdir/$my_outputname.def"; then
@@ -3515,7 +4871,7 @@ static const void *lt_preloaded_setup()
 	esac
 	;;
       *)
-	func_fatal_error "unknown suffix for \`$my_dlsyms'"
+	func_fatal_error "unknown suffix for '$my_dlsyms'"
 	;;
       esac
     else
@@ -3529,6 +4885,32 @@ static const void *lt_preloaded_setup()
     fi
 }
 
+# func_cygming_gnu_implib_p ARG
+# This predicate returns with zero status (TRUE) if
+# ARG is a GNU/binutils-style import library. Returns
+# with nonzero status (FALSE) otherwise.
+func_cygming_gnu_implib_p ()
+{
+  $debug_cmd
+
+  func_to_tool_file "$1" func_convert_file_msys_to_w32
+  func_cygming_gnu_implib_tmp=`$NM "$func_to_tool_file_result" | eval "$global_symbol_pipe" | $EGREP ' (_head_[A-Za-z0-9_]+_[ad]l*|[A-Za-z0-9_]+_[ad]l*_iname)$'`
+  test -n "$func_cygming_gnu_implib_tmp"
+}
+
+# func_cygming_ms_implib_p ARG
+# This predicate returns with zero status (TRUE) if
+# ARG is an MS-style import library. Returns
+# with nonzero status (FALSE) otherwise.
+func_cygming_ms_implib_p ()
+{
+  $debug_cmd
+
+  func_to_tool_file "$1" func_convert_file_msys_to_w32
+  func_cygming_ms_implib_tmp=`$NM "$func_to_tool_file_result" | eval "$global_symbol_pipe" | $GREP '_NULL_IMPORT_DESCRIPTOR'`
+  test -n "$func_cygming_ms_implib_tmp"
+}
+
 # func_win32_libid arg
 # return the library type of file 'arg'
 #
@@ -3538,8 +4920,9 @@ static const void *lt_preloaded_setup()
 # Despite the name, also deal with 64 bit binaries.
 func_win32_libid ()
 {
-  $opt_debug
-  win32_libid_type="unknown"
+  $debug_cmd
+
+  win32_libid_type=unknown
   win32_fileres=`file -L $1 2>/dev/null`
   case $win32_fileres in
   *ar\ archive\ import\ library*) # definitely import
@@ -3549,16 +4932,29 @@ func_win32_libid ()
     # Keep the egrep pattern in sync with the one in _LT_CHECK_MAGIC_METHOD.
     if eval $OBJDUMP -f $1 | $SED -e '10q' 2>/dev/null |
        $EGREP 'file format (pei*-i386(.*architecture: i386)?|pe-arm-wince|pe-x86-64)' >/dev/null; then
-      func_to_tool_file "$1" func_convert_file_msys_to_w32
-      win32_nmres=`eval $NM -f posix -A \"$func_to_tool_file_result\" |
-	$SED -n -e '
+      case $nm_interface in
+      "MS dumpbin")
+	if func_cygming_ms_implib_p "$1" ||
+	   func_cygming_gnu_implib_p "$1"
+	then
+	  win32_nmres=import
+	else
+	  win32_nmres=
+	fi
+	;;
+      *)
+	func_to_tool_file "$1" func_convert_file_msys_to_w32
+	win32_nmres=`eval $NM -f posix -A \"$func_to_tool_file_result\" |
+	  $SED -n -e '
 	    1,100{
 		/ I /{
-		    s,.*,import,
+		    s|.*|import|
 		    p
 		    q
 		}
 	    }'`
+	;;
+      esac
       case $win32_nmres in
       import*)  win32_libid_type="x86 archive import";;
       *)        win32_libid_type="x86 archive static";;
@@ -3590,7 +4986,8 @@ func_win32_libid ()
 #    $sharedlib_from_linklib_result
 func_cygming_dll_for_implib ()
 {
-  $opt_debug
+  $debug_cmd
+
   sharedlib_from_linklib_result=`$DLLTOOL --identify-strict --identify "$1"`
 }
 
@@ -3607,7 +5004,8 @@ func_cygming_dll_for_implib ()
 # specified import library.
 func_cygming_dll_for_implib_fallback_core ()
 {
-  $opt_debug
+  $debug_cmd
+
   match_literal=`$ECHO "$1" | $SED "$sed_make_literal_regex"`
   $OBJDUMP -s --section "$1" "$2" 2>/dev/null |
     $SED '/^Contents of section '"$match_literal"':/{
@@ -3643,8 +5041,8 @@ func_cygming_dll_for_implib_fallback_cor
       /./p' |
     # we now have a list, one entry per line, of the stringified
     # contents of the appropriate section of all members of the
-    # archive which possess that section. Heuristic: eliminate
-    # all those which have a first or second character that is
+    # archive that possess that section. Heuristic: eliminate
+    # all those that have a first or second character that is
     # a '.' (that is, objdump's representation of an unprintable
     # character.) This should work for all archives with less than
     # 0x302f exports -- but will fail for DLLs whose name actually
@@ -3655,30 +5053,6 @@ func_cygming_dll_for_implib_fallback_cor
     $SED -e '/^\./d;/^.\./d;q'
 }
 
-# func_cygming_gnu_implib_p ARG
-# This predicate returns with zero status (TRUE) if
-# ARG is a GNU/binutils-style import library. Returns
-# with nonzero status (FALSE) otherwise.
-func_cygming_gnu_implib_p ()
-{
-  $opt_debug
-  func_to_tool_file "$1" func_convert_file_msys_to_w32
-  func_cygming_gnu_implib_tmp=`$NM "$func_to_tool_file_result" | eval "$global_symbol_pipe" | $EGREP ' (_head_[A-Za-z0-9_]+_[ad]l*|[A-Za-z0-9_]+_[ad]l*_iname)$'`
-  test -n "$func_cygming_gnu_implib_tmp"
-}
-
-# func_cygming_ms_implib_p ARG
-# This predicate returns with zero status (TRUE) if
-# ARG is an MS-style import library. Returns
-# with nonzero status (FALSE) otherwise.
-func_cygming_ms_implib_p ()
-{
-  $opt_debug
-  func_to_tool_file "$1" func_convert_file_msys_to_w32
-  func_cygming_ms_implib_tmp=`$NM "$func_to_tool_file_result" | eval "$global_symbol_pipe" | $GREP '_NULL_IMPORT_DESCRIPTOR'`
-  test -n "$func_cygming_ms_implib_tmp"
-}
-
 # func_cygming_dll_for_implib_fallback ARG
 # Platform-specific function to extract the
 # name of the DLL associated with the specified
@@ -3692,16 +5066,17 @@ func_cygming_ms_implib_p ()
 #    $sharedlib_from_linklib_result
 func_cygming_dll_for_implib_fallback ()
 {
-  $opt_debug
-  if func_cygming_gnu_implib_p "$1" ; then
+  $debug_cmd
+
+  if func_cygming_gnu_implib_p "$1"; then
     # binutils import library
     sharedlib_from_linklib_result=`func_cygming_dll_for_implib_fallback_core '.idata$7' "$1"`
-  elif func_cygming_ms_implib_p "$1" ; then
+  elif func_cygming_ms_implib_p "$1"; then
     # ms-generated import library
     sharedlib_from_linklib_result=`func_cygming_dll_for_implib_fallback_core '.idata$6' "$1"`
   else
     # unknown
-    sharedlib_from_linklib_result=""
+    sharedlib_from_linklib_result=
   fi
 }
 
@@ -3709,10 +5084,11 @@ func_cygming_dll_for_implib_fallback ()
 # func_extract_an_archive dir oldlib
 func_extract_an_archive ()
 {
-    $opt_debug
-    f_ex_an_ar_dir="$1"; shift
-    f_ex_an_ar_oldlib="$1"
-    if test "$lock_old_archive_extraction" = yes; then
+    $debug_cmd
+
+    f_ex_an_ar_dir=$1; shift
+    f_ex_an_ar_oldlib=$1
+    if test yes = "$lock_old_archive_extraction"; then
       lockfile=$f_ex_an_ar_oldlib.lock
       until $opt_dry_run || ln "$progpath" "$lockfile" 2>/dev/null; do
 	func_echo "Waiting for $lockfile to be removed"
@@ -3721,7 +5097,7 @@ func_extract_an_archive ()
     fi
     func_show_eval "(cd \$f_ex_an_ar_dir && $AR x \"\$f_ex_an_ar_oldlib\")" \
 		   'stat=$?; rm -f "$lockfile"; exit $stat'
-    if test "$lock_old_archive_extraction" = yes; then
+    if test yes = "$lock_old_archive_extraction"; then
       $opt_dry_run || rm -f "$lockfile"
     fi
     if ($AR t "$f_ex_an_ar_oldlib" | sort | sort -uc >/dev/null 2>&1); then
@@ -3735,22 +5111,23 @@ func_extract_an_archive ()
 # func_extract_archives gentop oldlib ...
 func_extract_archives ()
 {
-    $opt_debug
-    my_gentop="$1"; shift
+    $debug_cmd
+
+    my_gentop=$1; shift
     my_oldlibs=${1+"$@"}
-    my_oldobjs=""
-    my_xlib=""
-    my_xabs=""
-    my_xdir=""
+    my_oldobjs=
+    my_xlib=
+    my_xabs=
+    my_xdir=
 
     for my_xlib in $my_oldlibs; do
       # Extract the objects.
       case $my_xlib in
-	[\\/]* | [A-Za-z]:[\\/]*) my_xabs="$my_xlib" ;;
+	[\\/]* | [A-Za-z]:[\\/]*) my_xabs=$my_xlib ;;
 	*) my_xabs=`pwd`"/$my_xlib" ;;
       esac
       func_basename "$my_xlib"
-      my_xlib="$func_basename_result"
+      my_xlib=$func_basename_result
       my_xlib_u=$my_xlib
       while :; do
         case " $extracted_archives " in
@@ -3762,7 +5139,7 @@ func_extract_archives ()
 	esac
       done
       extracted_archives="$extracted_archives $my_xlib_u"
-      my_xdir="$my_gentop/$my_xlib_u"
+      my_xdir=$my_gentop/$my_xlib_u
 
       func_mkdir_p "$my_xdir"
 
@@ -3775,22 +5152,23 @@ func_extract_archives ()
 	  cd $my_xdir || exit $?
 	  darwin_archive=$my_xabs
 	  darwin_curdir=`pwd`
-	  darwin_base_archive=`basename "$darwin_archive"`
+	  func_basename "$darwin_archive"
+	  darwin_base_archive=$func_basename_result
 	  darwin_arches=`$LIPO -info "$darwin_archive" 2>/dev/null | $GREP Architectures 2>/dev/null || true`
 	  if test -n "$darwin_arches"; then
 	    darwin_arches=`$ECHO "$darwin_arches" | $SED -e 's/.*are://'`
 	    darwin_arch=
 	    func_verbose "$darwin_base_archive has multiple architectures $darwin_arches"
-	    for darwin_arch in  $darwin_arches ; do
-	      func_mkdir_p "unfat-$$/${darwin_base_archive}-${darwin_arch}"
-	      $LIPO -thin $darwin_arch -output "unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}" "${darwin_archive}"
-	      cd "unfat-$$/${darwin_base_archive}-${darwin_arch}"
-	      func_extract_an_archive "`pwd`" "${darwin_base_archive}"
+	    for darwin_arch in  $darwin_arches; do
+	      func_mkdir_p "unfat-$$/$darwin_base_archive-$darwin_arch"
+	      $LIPO -thin $darwin_arch -output "unfat-$$/$darwin_base_archive-$darwin_arch/$darwin_base_archive" "$darwin_archive"
+	      cd "unfat-$$/$darwin_base_archive-$darwin_arch"
+	      func_extract_an_archive "`pwd`" "$darwin_base_archive"
 	      cd "$darwin_curdir"
-	      $RM "unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}"
+	      $RM "unfat-$$/$darwin_base_archive-$darwin_arch/$darwin_base_archive"
 	    done # $darwin_arches
             ## Okay now we've a bunch of thin objects, gotta fatten them up :)
-	    darwin_filelist=`find unfat-$$ -type f -name \*.o -print -o -name \*.lo -print | $SED -e "$basename" | sort -u`
+	    darwin_filelist=`find unfat-$$ -type f -name \*.o -print -o -name \*.lo -print | $SED -e "$sed_basename" | sort -u`
 	    darwin_file=
 	    darwin_files=
 	    for darwin_file in $darwin_filelist; do
@@ -3812,7 +5190,7 @@ func_extract_archives ()
       my_oldobjs="$my_oldobjs "`find $my_xdir -name \*.$objext -print -o -name \*.lo -print | sort | $NL2SP`
     done
 
-    func_extract_archives_result="$my_oldobjs"
+    func_extract_archives_result=$my_oldobjs
 }
 
 
@@ -3827,7 +5205,7 @@ func_extract_archives ()
 #
 # ARG is the value that the WRAPPER_SCRIPT_BELONGS_IN_OBJDIR
 # variable will take.  If 'yes', then the emitted script
-# will assume that the directory in which it is stored is
+# will assume that the directory where it is stored is
 # the $objdir directory.  This is a cygwin/mingw-specific
 # behavior.
 func_emit_wrapper ()
@@ -3838,7 +5216,7 @@ func_emit_wrapper ()
 #! $SHELL
 
 # $output - temporary wrapper script for $objdir/$outputname
-# Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION
+# Generated by $PROGRAM (GNU $PACKAGE) $VERSION
 #
 # The $output program cannot be directly executed until all the libtool
 # libraries that it depends on are installed.
@@ -3895,9 +5273,9 @@ _LTECHO_EOF'
 
 # Very basic option parsing. These options are (a) specific to
 # the libtool wrapper, (b) are identical between the wrapper
-# /script/ and the wrapper /executable/ which is used only on
+# /script/ and the wrapper /executable/ that is used only on
 # windows platforms, and (c) all begin with the string "--lt-"
-# (application programs are unlikely to have options which match
+# (application programs are unlikely to have options that match
 # this pattern).
 #
 # There are only two supported options: --lt-debug and
@@ -3930,7 +5308,7 @@ func_parse_lt_options ()
 
   # Print the debug banner immediately:
   if test -n \"\$lt_option_debug\"; then
-    echo \"${outputname}:${output}:\${LINENO}: libtool wrapper (GNU $PACKAGE$TIMESTAMP) $VERSION\" 1>&2
+    echo \"$outputname:$output:\$LINENO: libtool wrapper (GNU $PACKAGE) $VERSION\" 1>&2
   fi
 }
 
@@ -3941,7 +5319,7 @@ func_lt_dump_args ()
   lt_dump_args_N=1;
   for lt_arg
   do
-    \$ECHO \"${outputname}:${output}:\${LINENO}: newargv[\$lt_dump_args_N]: \$lt_arg\"
+    \$ECHO \"$outputname:$output:\$LINENO: newargv[\$lt_dump_args_N]: \$lt_arg\"
     lt_dump_args_N=\`expr \$lt_dump_args_N + 1\`
   done
 }
@@ -3955,7 +5333,7 @@ func_exec_program_core ()
   *-*-mingw | *-*-os2* | *-cegcc*)
     $ECHO "\
       if test -n \"\$lt_option_debug\"; then
-        \$ECHO \"${outputname}:${output}:\${LINENO}: newargv[0]: \$progdir\\\\\$program\" 1>&2
+        \$ECHO \"$outputname:$output:\$LINENO: newargv[0]: \$progdir\\\\\$program\" 1>&2
         func_lt_dump_args \${1+\"\$@\"} 1>&2
       fi
       exec \"\$progdir\\\\\$program\" \${1+\"\$@\"}
@@ -3965,7 +5343,7 @@ func_exec_program_core ()
   *)
     $ECHO "\
       if test -n \"\$lt_option_debug\"; then
-        \$ECHO \"${outputname}:${output}:\${LINENO}: newargv[0]: \$progdir/\$program\" 1>&2
+        \$ECHO \"$outputname:$output:\$LINENO: newargv[0]: \$progdir/\$program\" 1>&2
         func_lt_dump_args \${1+\"\$@\"} 1>&2
       fi
       exec \"\$progdir/\$program\" \${1+\"\$@\"}
@@ -3982,14 +5360,17 @@ func_exec_program_core ()
 # launches target application with the remaining arguments.
 func_exec_program ()
 {
-  for lt_wr_arg
-  do
-    case \$lt_wr_arg in
-    --lt-*) ;;
-    *) set x \"\$@\" \"\$lt_wr_arg\"; shift;;
-    esac
-    shift
-  done
+  case \" \$* \" in
+  *\\ --lt-*)
+    for lt_wr_arg
+    do
+      case \$lt_wr_arg in
+      --lt-*) ;;
+      *) set x \"\$@\" \"\$lt_wr_arg\"; shift;;
+      esac
+      shift
+    done ;;
+  esac
   func_exec_program_core \${1+\"\$@\"}
 }
 
@@ -4037,13 +5418,13 @@ func_exec_program ()
   test -n \"\$absdir\" && thisdir=\"\$absdir\"
 "
 
-	if test "$fast_install" = yes; then
+	if test yes = "$fast_install"; then
 	  $ECHO "\
   program=lt-'$outputname'$exeext
   progdir=\"\$thisdir/$objdir\"
 
   if test ! -f \"\$progdir/\$program\" ||
-     { file=\`ls -1dt \"\$progdir/\$program\" \"\$progdir/../\$program\" 2>/dev/null | ${SED} 1q\`; \\
+     { file=\`ls -1dt \"\$progdir/\$program\" \"\$progdir/../\$program\" 2>/dev/null | $SED 1q\`; \\
        test \"X\$file\" != \"X\$progdir/\$program\"; }; then
 
     file=\"\$\$-\$program\"
@@ -4060,7 +5441,7 @@ func_exec_program ()
     if test -n \"\$relink_command\"; then
       if relink_command_output=\`eval \$relink_command 2>&1\`; then :
       else
-	$ECHO \"\$relink_command_output\" >&2
+	\$ECHO \"\$relink_command_output\" >&2
 	$RM \"\$progdir/\$file\"
 	exit 1
       fi
@@ -4095,7 +5476,7 @@ func_exec_program ()
 	fi
 
 	# Export our shlibpath_var if we have one.
-	if test "$shlibpath_overrides_runpath" = yes && test -n "$shlibpath_var" && test -n "$temp_rpath"; then
+	if test yes = "$shlibpath_overrides_runpath" && test -n "$shlibpath_var" && test -n "$temp_rpath"; then
 	  $ECHO "\
     # Add our own library path to $shlibpath_var
     $shlibpath_var=\"$temp_rpath\$$shlibpath_var\"
@@ -4115,7 +5496,7 @@ func_exec_program ()
     fi
   else
     # The program doesn't exist.
-    \$ECHO \"\$0: error: \\\`\$progdir/\$program' does not exist\" 1>&2
+    \$ECHO \"\$0: error: '\$progdir/\$program' does not exist\" 1>&2
     \$ECHO \"This script is just a wrapper for \$program.\" 1>&2
     \$ECHO \"See the $PACKAGE documentation for more information.\" 1>&2
     exit 1
@@ -4134,7 +5515,7 @@ func_emit_cwrapperexe_src ()
 	cat <<EOF
 
 /* $cwrappersource - temporary wrapper executable for $objdir/$outputname
-   Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION
+   Generated by $PROGRAM (GNU $PACKAGE) $VERSION
 
    The $output program cannot be directly executed until all the libtool
    libraries that it depends on are installed.
@@ -4169,47 +5550,45 @@ EOF
 #include <fcntl.h>
 #include <sys/stat.h>
 
+#define STREQ(s1, s2) (strcmp ((s1), (s2)) == 0)
+
 /* declarations of non-ANSI functions */
-#if defined(__MINGW32__)
+#if defined __MINGW32__
 # ifdef __STRICT_ANSI__
 int _putenv (const char *);
 # endif
-#elif defined(__CYGWIN__)
+#elif defined __CYGWIN__
 # ifdef __STRICT_ANSI__
 char *realpath (const char *, char *);
 int putenv (char *);
 int setenv (const char *, const char *, int);
 # endif
-/* #elif defined (other platforms) ... */
+/* #elif defined other_platform || defined ... */
 #endif
 
 /* portability defines, excluding path handling macros */
-#if defined(_MSC_VER)
+#if defined _MSC_VER
 # define setmode _setmode
 # define stat    _stat
 # define chmod   _chmod
 # define getcwd  _getcwd
 # define putenv  _putenv
 # define S_IXUSR _S_IEXEC
-# ifndef _INTPTR_T_DEFINED
-#  define _INTPTR_T_DEFINED
-#  define intptr_t int
-# endif
-#elif defined(__MINGW32__)
+#elif defined __MINGW32__
 # define setmode _setmode
 # define stat    _stat
 # define chmod   _chmod
 # define getcwd  _getcwd
 # define putenv  _putenv
-#elif defined(__CYGWIN__)
+#elif defined __CYGWIN__
 # define HAVE_SETENV
 # define FOPEN_WB "wb"
-/* #elif defined (other platforms) ... */
+/* #elif defined other platforms ... */
 #endif
 
-#if defined(PATH_MAX)
+#if defined PATH_MAX
 # define LT_PATHMAX PATH_MAX
-#elif defined(MAXPATHLEN)
+#elif defined MAXPATHLEN
 # define LT_PATHMAX MAXPATHLEN
 #else
 # define LT_PATHMAX 1024
@@ -4228,8 +5607,8 @@ int setenv (const char *, const char *,
 # define PATH_SEPARATOR ':'
 #endif
 
-#if defined (_WIN32) || defined (__MSDOS__) || defined (__DJGPP__) || \
-  defined (__OS2__)
+#if defined _WIN32 || defined __MSDOS__ || defined __DJGPP__ || \
+  defined __OS2__
 # define HAVE_DOS_BASED_FILE_SYSTEM
 # define FOPEN_WB "wb"
 # ifndef DIR_SEPARATOR_2
@@ -4262,10 +5641,10 @@ int setenv (const char *, const char *,
 
 #define XMALLOC(type, num)      ((type *) xmalloc ((num) * sizeof(type)))
 #define XFREE(stale) do { \
-  if (stale) { free ((void *) stale); stale = 0; } \
+  if (stale) { free (stale); stale = 0; } \
 } while (0)
 
-#if defined(LT_DEBUGWRAPPER)
+#if defined LT_DEBUGWRAPPER
 static int lt_debug = 1;
 #else
 static int lt_debug = 0;
@@ -4294,11 +5673,16 @@ void lt_dump_script (FILE *f);
 EOF
 
 	    cat <<EOF
-volatile const char * MAGIC_EXE = "$magic_exe";
+#if __GNUC__ < 4 || (__GNUC__ == 4 && __GNUC_MINOR__ < 5)
+# define externally_visible volatile
+#else
+# define externally_visible __attribute__((externally_visible)) volatile
+#endif
+externally_visible const char * MAGIC_EXE = "$magic_exe";
 const char * LIB_PATH_VARNAME = "$shlibpath_var";
 EOF
 
-	    if test "$shlibpath_overrides_runpath" = yes && test -n "$shlibpath_var" && test -n "$temp_rpath"; then
+	    if test yes = "$shlibpath_overrides_runpath" && test -n "$shlibpath_var" && test -n "$temp_rpath"; then
               func_to_host_path "$temp_rpath"
 	      cat <<EOF
 const char * LIB_PATH_VALUE   = "$func_to_host_path_result";
@@ -4322,7 +5706,7 @@ const char * EXE_PATH_VALUE   = "";
 EOF
 	    fi
 
-	    if test "$fast_install" = yes; then
+	    if test yes = "$fast_install"; then
 	      cat <<EOF
 const char * TARGET_PROGRAM_NAME = "lt-$outputname"; /* hopefully, no .exe */
 EOF
@@ -4351,12 +5735,12 @@ main (int argc, char *argv[])
   char *actual_cwrapper_name;
   char *target_name;
   char *lt_argv_zero;
-  intptr_t rval = 127;
+  int rval = 127;
 
   int i;
 
   program_name = (char *) xstrdup (base_name (argv[0]));
-  newargz = XMALLOC (char *, argc + 1);
+  newargz = XMALLOC (char *, (size_t) argc + 1);
 
   /* very simple arg parsing; don't want to rely on getopt
    * also, copy all non cwrapper options to newargz, except
@@ -4365,10 +5749,10 @@ main (int argc, char *argv[])
   newargc=0;
   for (i = 1; i < argc; i++)
     {
-      if (strcmp (argv[i], dumpscript_opt) == 0)
+      if (STREQ (argv[i], dumpscript_opt))
 	{
 EOF
-	    case "$host" in
+	    case $host in
 	      *mingw* | *cygwin* )
 		# make stdout use "unix" line endings
 		echo "          setmode(1,_O_BINARY);"
@@ -4379,12 +5763,12 @@ EOF
 	  lt_dump_script (stdout);
 	  return 0;
 	}
-      if (strcmp (argv[i], debug_opt) == 0)
+      if (STREQ (argv[i], debug_opt))
 	{
           lt_debug = 1;
           continue;
 	}
-      if (strcmp (argv[i], ltwrapper_option_prefix) == 0)
+      if (STREQ (argv[i], ltwrapper_option_prefix))
         {
           /* however, if there is an option in the LTWRAPPER_OPTION_PREFIX
              namespace, but it is not one of the ones we know about and
@@ -4407,7 +5791,7 @@ EOF
 EOF
 	    cat <<EOF
   /* The GNU banner must be the first non-error debug message */
-  lt_debugprintf (__FILE__, __LINE__, "libtool wrapper (GNU $PACKAGE$TIMESTAMP) $VERSION\n");
+  lt_debugprintf (__FILE__, __LINE__, "libtool wrapper (GNU $PACKAGE) $VERSION\n");
 EOF
 	    cat <<"EOF"
   lt_debugprintf (__FILE__, __LINE__, "(main) argv[0]: %s\n", argv[0]);
@@ -4518,7 +5902,7 @@ EOF
 		cat <<"EOF"
   /* execv doesn't actually work on mingw as expected on unix */
   newargz = prepare_spawn (newargz);
-  rval = _spawnv (_P_WAIT, lt_argv_zero, (const char * const *) newargz);
+  rval = (int) _spawnv (_P_WAIT, lt_argv_zero, (const char * const *) newargz);
   if (rval == -1)
     {
       /* failed to start process */
@@ -4563,7 +5947,7 @@ base_name (const char *name)
 {
   const char *base;
 
-#if defined (HAVE_DOS_BASED_FILE_SYSTEM)
+#if defined HAVE_DOS_BASED_FILE_SYSTEM
   /* Skip over the disk name in MSDOS pathnames. */
   if (isalpha ((unsigned char) name[0]) && name[1] == ':')
     name += 2;
@@ -4622,7 +6006,7 @@ find_executable (const char *wrapper)
   const char *p_next;
   /* static buffer for getcwd */
   char tmp[LT_PATHMAX + 1];
-  int tmp_len;
+  size_t tmp_len;
   char *concat_name;
 
   lt_debugprintf (__FILE__, __LINE__, "(find_executable): %s\n",
@@ -4632,7 +6016,7 @@ find_executable (const char *wrapper)
     return NULL;
 
   /* Absolute path? */
-#if defined (HAVE_DOS_BASED_FILE_SYSTEM)
+#if defined HAVE_DOS_BASED_FILE_SYSTEM
   if (isalpha ((unsigned char) wrapper[0]) && wrapper[1] == ':')
     {
       concat_name = xstrdup (wrapper);
@@ -4650,7 +6034,7 @@ find_executable (const char *wrapper)
 	    return concat_name;
 	  XFREE (concat_name);
 	}
-#if defined (HAVE_DOS_BASED_FILE_SYSTEM)
+#if defined HAVE_DOS_BASED_FILE_SYSTEM
     }
 #endif
 
@@ -4673,7 +6057,7 @@ find_executable (const char *wrapper)
 	      for (q = p; *q; q++)
 		if (IS_PATH_SEPARATOR (*q))
 		  break;
-	      p_len = q - p;
+	      p_len = (size_t) (q - p);
 	      p_next = (*q == '\0' ? q : q + 1);
 	      if (p_len == 0)
 		{
@@ -4792,7 +6176,7 @@ strendzap (char *str, const char *pat)
   if (patlen <= len)
     {
       str += len - patlen;
-      if (strcmp (str, pat) == 0)
+      if (STREQ (str, pat))
 	*str = '\0';
     }
   return str;
@@ -4857,7 +6241,7 @@ lt_setenv (const char *name, const char
     char *str = xstrdup (value);
     setenv (name, str, 1);
 #else
-    int len = strlen (name) + 1 + strlen (value) + 1;
+    size_t len = strlen (name) + 1 + strlen (value) + 1;
     char *str = XMALLOC (char, len);
     sprintf (str, "%s=%s", name, value);
     if (putenv (str) != EXIT_SUCCESS)
@@ -4874,8 +6258,8 @@ lt_extend_str (const char *orig_value, c
   char *new_value;
   if (orig_value && *orig_value)
     {
-      int orig_value_len = strlen (orig_value);
-      int add_len = strlen (add);
+      size_t orig_value_len = strlen (orig_value);
+      size_t add_len = strlen (add);
       new_value = XMALLOC (char, add_len + orig_value_len + 1);
       if (to_end)
         {
@@ -4906,10 +6290,10 @@ lt_update_exe_path (const char *name, co
     {
       char *new_value = lt_extend_str (getenv (name), value, 0);
       /* some systems can't cope with a ':'-terminated path #' */
-      int len = strlen (new_value);
-      while (((len = strlen (new_value)) > 0) && IS_PATH_SEPARATOR (new_value[len-1]))
+      size_t len = strlen (new_value);
+      while ((len > 0) && IS_PATH_SEPARATOR (new_value[len-1]))
         {
-          new_value[len-1] = '\0';
+          new_value[--len] = '\0';
         }
       lt_setenv (name, new_value);
       XFREE (new_value);
@@ -5057,9 +6441,15 @@ void lt_dump_script (FILE* f)
 {
 EOF
 	    func_emit_wrapper yes |
-              $SED -e 's/\([\\"]\)/\\\1/g' \
-	           -e 's/^/  fputs ("/' -e 's/$/\\n", f);/'
-
+	      $SED -n -e '
+s/^\(.\{79\}\)\(..*\)/\1\
+\2/
+h
+s/\([\\"]\)/\\\1/g
+s/$/\\n/
+s/\([^\n]*\).*/  fputs ("\1", f);/p
+g
+D'
             cat <<"EOF"
 }
 EOF
@@ -5070,27 +6460,47 @@ EOF
 # True if ARG is an import lib, as indicated by $file_magic_cmd
 func_win32_import_lib_p ()
 {
-    $opt_debug
+    $debug_cmd
+
     case `eval $file_magic_cmd \"\$1\" 2>/dev/null | $SED -e 10q` in
     *import*) : ;;
     *) false ;;
     esac
 }
 
+# func_suncc_cstd_abi
+# !!ONLY CALL THIS FOR SUN CC AFTER $compile_command IS FULLY EXPANDED!!
+# Several compiler flags select an ABI that is incompatible with the
+# Cstd library. Avoid specifying it if any are in CXXFLAGS.
+func_suncc_cstd_abi ()
+{
+    $debug_cmd
+
+    case " $compile_command " in
+    *" -compat=g "*|*\ -std=c++[0-9][0-9]\ *|*" -library=stdcxx4 "*|*" -library=stlport4 "*)
+      suncc_use_cstd_abi=no
+      ;;
+    *)
+      suncc_use_cstd_abi=yes
+      ;;
+    esac
+}
+
 # func_mode_link arg...
 func_mode_link ()
 {
-    $opt_debug
+    $debug_cmd
+
     case $host in
     *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-cegcc*)
       # It is impossible to link a dll without this setting, and
       # we shouldn't force the makefile maintainer to figure out
-      # which system we are compiling for in order to pass an extra
+      # what system we are compiling for in order to pass an extra
       # flag for every libtool invocation.
       # allow_undefined=no
 
       # FIXME: Unfortunately, there are problems with the above when trying
-      # to make a dll which has undefined symbols, in which case not
+      # to make a dll that has undefined symbols, in which case not
       # even a static library is built.  For now, we need to specify
       # -no-undefined on the libtool link line when we can be certain
       # that all symbols are satisfied, otherwise we get a static library.
@@ -5134,10 +6544,11 @@ func_mode_link ()
     module=no
     no_install=no
     objs=
+    os2dllname=
     non_pic_objects=
     precious_files_regex=
     prefer_static_libs=no
-    preload=no
+    preload=false
     prev=
     prevarg=
     release=
@@ -5149,7 +6560,7 @@ func_mode_link ()
     vinfo=
     vinfo_number=no
     weak_libs=
-    single_module="${wl}-single_module"
+    single_module=$wl-single_module
     func_infer_tag $base_compile
 
     # We need to know -static, to get the right output filenames.
@@ -5157,15 +6568,15 @@ func_mode_link ()
     do
       case $arg in
       -shared)
-	test "$build_libtool_libs" != yes && \
-	  func_fatal_configuration "can not build a shared library"
+	test yes != "$build_libtool_libs" \
+	  && func_fatal_configuration "cannot build a shared library"
 	build_old_libs=no
 	break
 	;;
       -all-static | -static | -static-libtool-libs)
 	case $arg in
 	-all-static)
-	  if test "$build_libtool_libs" = yes && test -z "$link_static_flag"; then
+	  if test yes = "$build_libtool_libs" && test -z "$link_static_flag"; then
 	    func_warning "complete static linking is impossible in this configuration"
 	  fi
 	  if test -n "$link_static_flag"; then
@@ -5198,7 +6609,7 @@ func_mode_link ()
 
     # Go through the arguments, transforming them on the way.
     while test "$#" -gt 0; do
-      arg="$1"
+      arg=$1
       shift
       func_quote_for_eval "$arg"
       qarg=$func_quote_for_eval_unquoted_result
@@ -5215,21 +6626,21 @@ func_mode_link ()
 
 	case $prev in
 	bindir)
-	  bindir="$arg"
+	  bindir=$arg
 	  prev=
 	  continue
 	  ;;
 	dlfiles|dlprefiles)
-	  if test "$preload" = no; then
+	  $preload || {
 	    # Add the symbol object into the linking commands.
 	    func_append compile_command " @SYMFILE@"
 	    func_append finalize_command " @SYMFILE@"
-	    preload=yes
-	  fi
+	    preload=:
+	  }
 	  case $arg in
 	  *.la | *.lo) ;;  # We handle these cases below.
 	  force)
-	    if test "$dlself" = no; then
+	    if test no = "$dlself"; then
 	      dlself=needless
 	      export_dynamic=yes
 	    fi
@@ -5237,9 +6648,9 @@ func_mode_link ()
 	    continue
 	    ;;
 	  self)
-	    if test "$prev" = dlprefiles; then
+	    if test dlprefiles = "$prev"; then
 	      dlself=yes
-	    elif test "$prev" = dlfiles && test "$dlopen_self" != yes; then
+	    elif test dlfiles = "$prev" && test yes != "$dlopen_self"; then
 	      dlself=yes
 	    else
 	      dlself=needless
@@ -5249,7 +6660,7 @@ func_mode_link ()
 	    continue
 	    ;;
 	  *)
-	    if test "$prev" = dlfiles; then
+	    if test dlfiles = "$prev"; then
 	      func_append dlfiles " $arg"
 	    else
 	      func_append dlprefiles " $arg"
@@ -5260,14 +6671,14 @@ func_mode_link ()
 	  esac
 	  ;;
 	expsyms)
-	  export_symbols="$arg"
+	  export_symbols=$arg
 	  test -f "$arg" \
-	    || func_fatal_error "symbol file \`$arg' does not exist"
+	    || func_fatal_error "symbol file '$arg' does not exist"
 	  prev=
 	  continue
 	  ;;
 	expsyms_regex)
-	  export_symbols_regex="$arg"
+	  export_symbols_regex=$arg
 	  prev=
 	  continue
 	  ;;
@@ -5285,7 +6696,13 @@ func_mode_link ()
 	  continue
 	  ;;
 	inst_prefix)
-	  inst_prefix_dir="$arg"
+	  inst_prefix_dir=$arg
+	  prev=
+	  continue
+	  ;;
+	mllvm)
+	  # Clang does not use LLVM to link, so we can simply discard any
+	  # '-mllvm $arg' options when doing the link step.
 	  prev=
 	  continue
 	  ;;
@@ -5309,21 +6726,21 @@ func_mode_link ()
 
 		if test -z "$pic_object" ||
 		   test -z "$non_pic_object" ||
-		   test "$pic_object" = none &&
-		   test "$non_pic_object" = none; then
-		  func_fatal_error "cannot find name of object for \`$arg'"
+		   test none = "$pic_object" &&
+		   test none = "$non_pic_object"; then
+		  func_fatal_error "cannot find name of object for '$arg'"
 		fi
 
 		# Extract subdirectory from the argument.
 		func_dirname "$arg" "/" ""
-		xdir="$func_dirname_result"
+		xdir=$func_dirname_result
 
-		if test "$pic_object" != none; then
+		if test none != "$pic_object"; then
 		  # Prepend the subdirectory the object is found in.
-		  pic_object="$xdir$pic_object"
+		  pic_object=$xdir$pic_object
 
-		  if test "$prev" = dlfiles; then
-		    if test "$build_libtool_libs" = yes && test "$dlopen_support" = yes; then
+		  if test dlfiles = "$prev"; then
+		    if test yes = "$build_libtool_libs" && test yes = "$dlopen_support"; then
 		      func_append dlfiles " $pic_object"
 		      prev=
 		      continue
@@ -5334,7 +6751,7 @@ func_mode_link ()
 		  fi
 
 		  # CHECK ME:  I think I busted this.  -Ossama
-		  if test "$prev" = dlprefiles; then
+		  if test dlprefiles = "$prev"; then
 		    # Preload the old-style object.
 		    func_append dlprefiles " $pic_object"
 		    prev=
@@ -5342,23 +6759,23 @@ func_mode_link ()
 
 		  # A PIC object.
 		  func_append libobjs " $pic_object"
-		  arg="$pic_object"
+		  arg=$pic_object
 		fi
 
 		# Non-PIC object.
-		if test "$non_pic_object" != none; then
+		if test none != "$non_pic_object"; then
 		  # Prepend the subdirectory the object is found in.
-		  non_pic_object="$xdir$non_pic_object"
+		  non_pic_object=$xdir$non_pic_object
 
 		  # A standard non-PIC object
 		  func_append non_pic_objects " $non_pic_object"
-		  if test -z "$pic_object" || test "$pic_object" = none ; then
-		    arg="$non_pic_object"
+		  if test -z "$pic_object" || test none = "$pic_object"; then
+		    arg=$non_pic_object
 		  fi
 		else
 		  # If the PIC object exists, use it instead.
 		  # $xdir was prepended to $pic_object above.
-		  non_pic_object="$pic_object"
+		  non_pic_object=$pic_object
 		  func_append non_pic_objects " $non_pic_object"
 		fi
 	      else
@@ -5366,7 +6783,7 @@ func_mode_link ()
 		if $opt_dry_run; then
 		  # Extract subdirectory from the argument.
 		  func_dirname "$arg" "/" ""
-		  xdir="$func_dirname_result"
+		  xdir=$func_dirname_result
 
 		  func_lo2o "$arg"
 		  pic_object=$xdir$objdir/$func_lo2o_result
@@ -5374,24 +6791,29 @@ func_mode_link ()
 		  func_append libobjs " $pic_object"
 		  func_append non_pic_objects " $non_pic_object"
 	        else
-		  func_fatal_error "\`$arg' is not a valid libtool object"
+		  func_fatal_error "'$arg' is not a valid libtool object"
 		fi
 	      fi
 	    done
 	  else
-	    func_fatal_error "link input file \`$arg' does not exist"
+	    func_fatal_error "link input file '$arg' does not exist"
 	  fi
 	  arg=$save_arg
 	  prev=
 	  continue
 	  ;;
+	os2dllname)
+	  os2dllname=$arg
+	  prev=
+	  continue
+	  ;;
 	precious_regex)
-	  precious_files_regex="$arg"
+	  precious_files_regex=$arg
 	  prev=
 	  continue
 	  ;;
 	release)
-	  release="-$arg"
+	  release=-$arg
 	  prev=
 	  continue
 	  ;;
@@ -5403,7 +6825,7 @@ func_mode_link ()
 	    func_fatal_error "only absolute run-paths are allowed"
 	    ;;
 	  esac
-	  if test "$prev" = rpath; then
+	  if test rpath = "$prev"; then
 	    case "$rpath " in
 	    *" $arg "*) ;;
 	    *) func_append rpath " $arg" ;;
@@ -5418,7 +6840,7 @@ func_mode_link ()
 	  continue
 	  ;;
 	shrext)
-	  shrext_cmds="$arg"
+	  shrext_cmds=$arg
 	  prev=
 	  continue
 	  ;;
@@ -5458,7 +6880,7 @@ func_mode_link ()
 	esac
       fi # test -n "$prev"
 
-      prevarg="$arg"
+      prevarg=$arg
 
       case $arg in
       -all-static)
@@ -5472,7 +6894,7 @@ func_mode_link ()
 
       -allow-undefined)
 	# FIXME: remove this flag sometime in the future.
-	func_fatal_error "\`-allow-undefined' must not be used because it is the default"
+	func_fatal_error "'-allow-undefined' must not be used because it is the default"
 	;;
 
       -avoid-version)
@@ -5504,7 +6926,7 @@ func_mode_link ()
 	if test -n "$export_symbols" || test -n "$export_symbols_regex"; then
 	  func_fatal_error "more than one -exported-symbols argument is not allowed"
 	fi
-	if test "X$arg" = "X-export-symbols"; then
+	if test X-export-symbols = "X$arg"; then
 	  prev=expsyms
 	else
 	  prev=expsyms_regex
@@ -5538,9 +6960,9 @@ func_mode_link ()
 	func_stripname "-L" '' "$arg"
 	if test -z "$func_stripname_result"; then
 	  if test "$#" -gt 0; then
-	    func_fatal_error "require no space between \`-L' and \`$1'"
+	    func_fatal_error "require no space between '-L' and '$1'"
 	  else
-	    func_fatal_error "need path for \`-L' option"
+	    func_fatal_error "need path for '-L' option"
 	  fi
 	fi
 	func_resolve_sysroot "$func_stripname_result"
@@ -5551,8 +6973,8 @@ func_mode_link ()
 	*)
 	  absdir=`cd "$dir" && pwd`
 	  test -z "$absdir" && \
-	    func_fatal_error "cannot determine absolute directory name of \`$dir'"
-	  dir="$absdir"
+	    func_fatal_error "cannot determine absolute directory name of '$dir'"
+	  dir=$absdir
 	  ;;
 	esac
 	case "$deplibs " in
@@ -5587,7 +7009,7 @@ func_mode_link ()
 	;;
 
       -l*)
-	if test "X$arg" = "X-lc" || test "X$arg" = "X-lm"; then
+	if test X-lc = "X$arg" || test X-lm = "X$arg"; then
 	  case $host in
 	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-beos* | *-cegcc* | *-*-haiku*)
 	    # These systems don't actually have a C or math library (as such)
@@ -5595,11 +7017,11 @@ func_mode_link ()
 	    ;;
 	  *-*-os2*)
 	    # These systems don't actually have a C library (as such)
-	    test "X$arg" = "X-lc" && continue
+	    test X-lc = "X$arg" && continue
 	    ;;
-	  *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*)
+	  *-*-openbsd* | *-*-freebsd* | *-*-dragonfly* | *-*-bitrig*)
 	    # Do not include libc due to us having libc/libc_r.
-	    test "X$arg" = "X-lc" && continue
+	    test X-lc = "X$arg" && continue
 	    ;;
 	  *-*-rhapsody* | *-*-darwin1.[012])
 	    # Rhapsody C and math libraries are in the System framework
@@ -5608,16 +7030,16 @@ func_mode_link ()
 	    ;;
 	  *-*-sco3.2v5* | *-*-sco5v6*)
 	    # Causes problems with __ctype
-	    test "X$arg" = "X-lc" && continue
+	    test X-lc = "X$arg" && continue
 	    ;;
 	  *-*-sysv4.2uw2* | *-*-sysv5* | *-*-unixware* | *-*-OpenUNIX*)
 	    # Compiler inserts libc in the correct place for threads to work
-	    test "X$arg" = "X-lc" && continue
+	    test X-lc = "X$arg" && continue
 	    ;;
 	  esac
-	elif test "X$arg" = "X-lc_r"; then
+	elif test X-lc_r = "X$arg"; then
 	 case $host in
-	 *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*)
+	 *-*-openbsd* | *-*-freebsd* | *-*-dragonfly* | *-*-bitrig*)
 	   # Do not include libc_r directly, use -pthread flag.
 	   continue
 	   ;;
@@ -5627,6 +7049,11 @@ func_mode_link ()
 	continue
 	;;
 
+      -mllvm)
+	prev=mllvm
+	continue
+	;;
+
       -module)
 	module=yes
 	continue
@@ -5643,7 +7070,8 @@ func_mode_link ()
 	continue
 	;;
 
-      -mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe|-threads)
+      -mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe \
+      |-threads|-fopenmp|-openmp|-mp|-xopenmp|-omp|-qsmp=*)
 	func_append compiler_flags " $arg"
 	func_append compile_command " $arg"
 	func_append finalize_command " $arg"
@@ -5655,7 +7083,7 @@ func_mode_link ()
 	;;
 
       -multi_module)
-	single_module="${wl}-multi_module"
+	single_module=$wl-multi_module
 	continue
 	;;
 
@@ -5669,8 +7097,8 @@ func_mode_link ()
 	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-darwin* | *-cegcc*)
 	  # The PATH hackery in wrapper scripts is required on Windows
 	  # and Darwin in order for the loader to find any dlls it needs.
-	  func_warning "\`-no-install' is ignored for $host"
-	  func_warning "assuming \`-no-fast-install' instead"
+	  func_warning "'-no-install' is ignored for $host"
+	  func_warning "assuming '-no-fast-install' instead"
 	  fast_install=no
 	  ;;
 	*) no_install=yes ;;
@@ -5688,6 +7116,11 @@ func_mode_link ()
 	continue
 	;;
 
+      -os2dllname)
+	prev=os2dllname
+	continue
+	;;
+
       -o) prev=output ;;
 
       -precious-files-regex)
@@ -5775,14 +7208,14 @@ func_mode_link ()
 	func_stripname '-Wc,' '' "$arg"
 	args=$func_stripname_result
 	arg=
-	save_ifs="$IFS"; IFS=','
+	save_ifs=$IFS; IFS=,
 	for flag in $args; do
-	  IFS="$save_ifs"
+	  IFS=$save_ifs
           func_quote_for_eval "$flag"
 	  func_append arg " $func_quote_for_eval_result"
 	  func_append compiler_flags " $func_quote_for_eval_result"
 	done
-	IFS="$save_ifs"
+	IFS=$save_ifs
 	func_stripname ' ' '' "$arg"
 	arg=$func_stripname_result
 	;;
@@ -5791,15 +7224,15 @@ func_mode_link ()
 	func_stripname '-Wl,' '' "$arg"
 	args=$func_stripname_result
 	arg=
-	save_ifs="$IFS"; IFS=','
+	save_ifs=$IFS; IFS=,
 	for flag in $args; do
-	  IFS="$save_ifs"
+	  IFS=$save_ifs
           func_quote_for_eval "$flag"
 	  func_append arg " $wl$func_quote_for_eval_result"
 	  func_append compiler_flags " $wl$func_quote_for_eval_result"
 	  func_append linker_flags " $func_quote_for_eval_result"
 	done
-	IFS="$save_ifs"
+	IFS=$save_ifs
 	func_stripname ' ' '' "$arg"
 	arg=$func_stripname_result
 	;;
@@ -5822,7 +7255,7 @@ func_mode_link ()
       # -msg_* for osf cc
       -msg_*)
 	func_quote_for_eval "$arg"
-	arg="$func_quote_for_eval_result"
+	arg=$func_quote_for_eval_result
 	;;
 
       # Flags to be passed through unchanged, with rationale:
@@ -5838,22 +7271,42 @@ func_mode_link ()
       # @file                GCC response files
       # -tp=*                Portland pgcc target processor selection
       # --sysroot=*          for sysroot support
-      # -O*, -flto*, -fwhopr*, -fuse-linker-plugin GCC link-time optimization
+      # -O*, -g*, -flto*, -fwhopr*, -fuse-linker-plugin GCC link-time optimization
+      # -stdlib=*            select c++ std lib with clang
       -64|-mips[0-9]|-r[0-9][0-9]*|-xarch=*|-xtarget=*|+DA*|+DD*|-q*|-m*| \
       -t[45]*|-txscale*|-p|-pg|--coverage|-fprofile-*|-F*|@*|-tp=*|--sysroot=*| \
-      -O*|-flto*|-fwhopr*|-fuse-linker-plugin|-fstack-protector*)
+      -O*|-g*|-flto*|-fwhopr*|-fuse-linker-plugin|-fstack-protector*|-stdlib=*)
         func_quote_for_eval "$arg"
-	arg="$func_quote_for_eval_result"
+	arg=$func_quote_for_eval_result
         func_append compile_command " $arg"
         func_append finalize_command " $arg"
         func_append compiler_flags " $arg"
         continue
         ;;
 
+      -Z*)
+        if test os2 = "`expr $host : '.*\(os2\)'`"; then
+          # OS/2 uses -Zxxx to specify OS/2-specific options
+	  compiler_flags="$compiler_flags $arg"
+	  func_append compile_command " $arg"
+	  func_append finalize_command " $arg"
+	  case $arg in
+	  -Zlinker | -Zstack)
+	    prev=xcompiler
+	    ;;
+	  esac
+	  continue
+        else
+	  # Otherwise treat like 'Some other compiler flag' below
+	  func_quote_for_eval "$arg"
+	  arg=$func_quote_for_eval_result
+        fi
+	;;
+
       # Some other compiler flag.
       -* | +*)
         func_quote_for_eval "$arg"
-	arg="$func_quote_for_eval_result"
+	arg=$func_quote_for_eval_result
 	;;
 
       *.$objext)
@@ -5874,21 +7327,21 @@ func_mode_link ()
 
 	  if test -z "$pic_object" ||
 	     test -z "$non_pic_object" ||
-	     test "$pic_object" = none &&
-	     test "$non_pic_object" = none; then
-	    func_fatal_error "cannot find name of object for \`$arg'"
+	     test none = "$pic_object" &&
+	     test none = "$non_pic_object"; then
+	    func_fatal_error "cannot find name of object for '$arg'"
 	  fi
 
 	  # Extract subdirectory from the argument.
 	  func_dirname "$arg" "/" ""
-	  xdir="$func_dirname_result"
+	  xdir=$func_dirname_result
 
-	  if test "$pic_object" != none; then
+	  test none = "$pic_object" || {
 	    # Prepend the subdirectory the object is found in.
-	    pic_object="$xdir$pic_object"
+	    pic_object=$xdir$pic_object
 
-	    if test "$prev" = dlfiles; then
-	      if test "$build_libtool_libs" = yes && test "$dlopen_support" = yes; then
+	    if test dlfiles = "$prev"; then
+	      if test yes = "$build_libtool_libs" && test yes = "$dlopen_support"; then
 		func_append dlfiles " $pic_object"
 		prev=
 		continue
@@ -5899,7 +7352,7 @@ func_mode_link ()
 	    fi
 
 	    # CHECK ME:  I think I busted this.  -Ossama
-	    if test "$prev" = dlprefiles; then
+	    if test dlprefiles = "$prev"; then
 	      # Preload the old-style object.
 	      func_append dlprefiles " $pic_object"
 	      prev=
@@ -5907,23 +7360,23 @@ func_mode_link ()
 
 	    # A PIC object.
 	    func_append libobjs " $pic_object"
-	    arg="$pic_object"
-	  fi
+	    arg=$pic_object
+	  }
 
 	  # Non-PIC object.
-	  if test "$non_pic_object" != none; then
+	  if test none != "$non_pic_object"; then
 	    # Prepend the subdirectory the object is found in.
-	    non_pic_object="$xdir$non_pic_object"
+	    non_pic_object=$xdir$non_pic_object
 
 	    # A standard non-PIC object
 	    func_append non_pic_objects " $non_pic_object"
-	    if test -z "$pic_object" || test "$pic_object" = none ; then
-	      arg="$non_pic_object"
+	    if test -z "$pic_object" || test none = "$pic_object"; then
+	      arg=$non_pic_object
 	    fi
 	  else
 	    # If the PIC object exists, use it instead.
 	    # $xdir was prepended to $pic_object above.
-	    non_pic_object="$pic_object"
+	    non_pic_object=$pic_object
 	    func_append non_pic_objects " $non_pic_object"
 	  fi
 	else
@@ -5931,7 +7384,7 @@ func_mode_link ()
 	  if $opt_dry_run; then
 	    # Extract subdirectory from the argument.
 	    func_dirname "$arg" "/" ""
-	    xdir="$func_dirname_result"
+	    xdir=$func_dirname_result
 
 	    func_lo2o "$arg"
 	    pic_object=$xdir$objdir/$func_lo2o_result
@@ -5939,7 +7392,7 @@ func_mode_link ()
 	    func_append libobjs " $pic_object"
 	    func_append non_pic_objects " $non_pic_object"
 	  else
-	    func_fatal_error "\`$arg' is not a valid libtool object"
+	    func_fatal_error "'$arg' is not a valid libtool object"
 	  fi
 	fi
 	;;
@@ -5955,11 +7408,11 @@ func_mode_link ()
 	# A libtool-controlled library.
 
 	func_resolve_sysroot "$arg"
-	if test "$prev" = dlfiles; then
+	if test dlfiles = "$prev"; then
 	  # This library was specified with -dlopen.
 	  func_append dlfiles " $func_resolve_sysroot_result"
 	  prev=
-	elif test "$prev" = dlprefiles; then
+	elif test dlprefiles = "$prev"; then
 	  # The library was specified with -dlpreopen.
 	  func_append dlprefiles " $func_resolve_sysroot_result"
 	  prev=
@@ -5974,7 +7427,7 @@ func_mode_link ()
 	# Unknown arguments in both finalize_command and compile_command need
 	# to be aesthetically quoted because they are evaled later.
 	func_quote_for_eval "$arg"
-	arg="$func_quote_for_eval_result"
+	arg=$func_quote_for_eval_result
 	;;
       esac # arg
 
@@ -5986,9 +7439,9 @@ func_mode_link ()
     done # argument parsing loop
 
     test -n "$prev" && \
-      func_fatal_help "the \`$prevarg' option requires an argument"
+      func_fatal_help "the '$prevarg' option requires an argument"
 
-    if test "$export_dynamic" = yes && test -n "$export_dynamic_flag_spec"; then
+    if test yes = "$export_dynamic" && test -n "$export_dynamic_flag_spec"; then
       eval arg=\"$export_dynamic_flag_spec\"
       func_append compile_command " $arg"
       func_append finalize_command " $arg"
@@ -5997,20 +7450,23 @@ func_mode_link ()
     oldlibs=
     # calculate the name of the file, without its directory
     func_basename "$output"
-    outputname="$func_basename_result"
-    libobjs_save="$libobjs"
+    outputname=$func_basename_result
+    libobjs_save=$libobjs
 
     if test -n "$shlibpath_var"; then
       # get the directories listed in $shlibpath_var
-      eval shlib_search_path=\`\$ECHO \"\${$shlibpath_var}\" \| \$SED \'s/:/ /g\'\`
+      eval shlib_search_path=\`\$ECHO \"\$$shlibpath_var\" \| \$SED \'s/:/ /g\'\`
     else
       shlib_search_path=
     fi
     eval sys_lib_search_path=\"$sys_lib_search_path_spec\"
     eval sys_lib_dlsearch_path=\"$sys_lib_dlsearch_path_spec\"
 
+    # Definition is injected by LT_CONFIG during libtool generation.
+    func_munge_path_list sys_lib_dlsearch_path "$LT_SYS_LIBRARY_PATH"
+
     func_dirname "$output" "/" ""
-    output_objdir="$func_dirname_result$objdir"
+    output_objdir=$func_dirname_result$objdir
     func_to_tool_file "$output_objdir/"
     tool_output_objdir=$func_to_tool_file_result
     # Create the object directory.
@@ -6033,7 +7489,7 @@ func_mode_link ()
     # Find all interdependent deplibs by searching for libraries
     # that are linked more than once (e.g. -la -lb -la)
     for deplib in $deplibs; do
-      if $opt_preserve_dup_deps ; then
+      if $opt_preserve_dup_deps; then
 	case "$libs " in
 	*" $deplib "*) func_append specialdeplibs " $deplib" ;;
 	esac
@@ -6041,7 +7497,7 @@ func_mode_link ()
       func_append libs " $deplib"
     done
 
-    if test "$linkmode" = lib; then
+    if test lib = "$linkmode"; then
       libs="$predeps $libs $compiler_lib_search_path $postdeps"
 
       # Compute libraries that are listed more than once in $predeps
@@ -6073,7 +7529,7 @@ func_mode_link ()
 	  case $file in
 	  *.la) ;;
 	  *)
-	    func_fatal_help "libraries can \`-dlopen' only libtool libraries: $file"
+	    func_fatal_help "libraries can '-dlopen' only libtool libraries: $file"
 	    ;;
 	  esac
 	done
@@ -6081,7 +7537,7 @@ func_mode_link ()
     prog)
 	compile_deplibs=
 	finalize_deplibs=
-	alldeplibs=no
+	alldeplibs=false
 	newdlfiles=
 	newdlprefiles=
 	passes="conv scan dlopen dlpreopen link"
@@ -6093,29 +7549,29 @@ func_mode_link ()
     for pass in $passes; do
       # The preopen pass in lib mode reverses $deplibs; put it back here
       # so that -L comes before libs that need it for instance...
-      if test "$linkmode,$pass" = "lib,link"; then
+      if test lib,link = "$linkmode,$pass"; then
 	## FIXME: Find the place where the list is rebuilt in the wrong
 	##        order, and fix it there properly
         tmp_deplibs=
 	for deplib in $deplibs; do
 	  tmp_deplibs="$deplib $tmp_deplibs"
 	done
-	deplibs="$tmp_deplibs"
+	deplibs=$tmp_deplibs
       fi
 
-      if test "$linkmode,$pass" = "lib,link" ||
-	 test "$linkmode,$pass" = "prog,scan"; then
-	libs="$deplibs"
+      if test lib,link = "$linkmode,$pass" ||
+	 test prog,scan = "$linkmode,$pass"; then
+	libs=$deplibs
 	deplibs=
       fi
-      if test "$linkmode" = prog; then
+      if test prog = "$linkmode"; then
 	case $pass in
-	dlopen) libs="$dlfiles" ;;
-	dlpreopen) libs="$dlprefiles" ;;
+	dlopen) libs=$dlfiles ;;
+	dlpreopen) libs=$dlprefiles ;;
 	link) libs="$deplibs %DEPLIBS% $dependency_libs" ;;
 	esac
       fi
-      if test "$linkmode,$pass" = "lib,dlpreopen"; then
+      if test lib,dlpreopen = "$linkmode,$pass"; then
 	# Collect and forward deplibs of preopened libtool libs
 	for lib in $dlprefiles; do
 	  # Ignore non-libtool-libs
@@ -6136,25 +7592,26 @@ func_mode_link ()
 	    esac
 	  done
 	done
-	libs="$dlprefiles"
+	libs=$dlprefiles
       fi
-      if test "$pass" = dlopen; then
+      if test dlopen = "$pass"; then
 	# Collect dlpreopened libraries
-	save_deplibs="$deplibs"
+	save_deplibs=$deplibs
 	deplibs=
       fi
 
       for deplib in $libs; do
 	lib=
-	found=no
+	found=false
 	case $deplib in
-	-mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe|-threads)
-	  if test "$linkmode,$pass" = "prog,link"; then
+	-mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe \
+        |-threads|-fopenmp|-openmp|-mp|-xopenmp|-omp|-qsmp=*)
+	  if test prog,link = "$linkmode,$pass"; then
 	    compile_deplibs="$deplib $compile_deplibs"
 	    finalize_deplibs="$deplib $finalize_deplibs"
 	  else
 	    func_append compiler_flags " $deplib"
-	    if test "$linkmode" = lib ; then
+	    if test lib = "$linkmode"; then
 		case "$new_inherited_linker_flags " in
 		    *" $deplib "*) ;;
 		    * ) func_append new_inherited_linker_flags " $deplib" ;;
@@ -6164,13 +7621,13 @@ func_mode_link ()
 	  continue
 	  ;;
 	-l*)
-	  if test "$linkmode" != lib && test "$linkmode" != prog; then
-	    func_warning "\`-l' is ignored for archives/objects"
+	  if test lib != "$linkmode" && test prog != "$linkmode"; then
+	    func_warning "'-l' is ignored for archives/objects"
 	    continue
 	  fi
 	  func_stripname '-l' '' "$deplib"
 	  name=$func_stripname_result
-	  if test "$linkmode" = lib; then
+	  if test lib = "$linkmode"; then
 	    searchdirs="$newlib_search_path $lib_search_path $compiler_lib_search_dirs $sys_lib_search_path $shlib_search_path"
 	  else
 	    searchdirs="$newlib_search_path $lib_search_path $sys_lib_search_path $shlib_search_path"
@@ -6178,31 +7635,22 @@ func_mode_link ()
 	  for searchdir in $searchdirs; do
 	    for search_ext in .la $std_shrext .so .a; do
 	      # Search the libtool library
-	      lib="$searchdir/lib${name}${search_ext}"
+	      lib=$searchdir/lib$name$search_ext
 	      if test -f "$lib"; then
-		if test "$search_ext" = ".la"; then
-		  found=yes
+		if test .la = "$search_ext"; then
+		  found=:
 		else
-		  found=no
+		  found=false
 		fi
 		break 2
 	      fi
 	    done
 	  done
-	  if test "$found" != yes; then
-	    # deplib doesn't seem to be a libtool library
-	    if test "$linkmode,$pass" = "prog,link"; then
-	      compile_deplibs="$deplib $compile_deplibs"
-	      finalize_deplibs="$deplib $finalize_deplibs"
-	    else
-	      deplibs="$deplib $deplibs"
-	      test "$linkmode" = lib && newdependency_libs="$deplib $newdependency_libs"
-	    fi
-	    continue
-	  else # deplib is a libtool library
+	  if $found; then
+	    # deplib is a libtool library
 	    # If $allow_libtool_libs_with_static_runtimes && $deplib is a stdlib,
 	    # We need to do some special things here, and not later.
-	    if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
+	    if test yes = "$allow_libtool_libs_with_static_runtimes"; then
 	      case " $predeps $postdeps " in
 	      *" $deplib "*)
 		if func_lalib_p "$lib"; then
@@ -6210,19 +7658,19 @@ func_mode_link ()
 		  old_library=
 		  func_source "$lib"
 		  for l in $old_library $library_names; do
-		    ll="$l"
+		    ll=$l
 		  done
-		  if test "X$ll" = "X$old_library" ; then # only static version available
-		    found=no
+		  if test "X$ll" = "X$old_library"; then # only static version available
+		    found=false
 		    func_dirname "$lib" "" "."
-		    ladir="$func_dirname_result"
+		    ladir=$func_dirname_result
 		    lib=$ladir/$old_library
-		    if test "$linkmode,$pass" = "prog,link"; then
+		    if test prog,link = "$linkmode,$pass"; then
 		      compile_deplibs="$deplib $compile_deplibs"
 		      finalize_deplibs="$deplib $finalize_deplibs"
 		    else
 		      deplibs="$deplib $deplibs"
-		      test "$linkmode" = lib && newdependency_libs="$deplib $newdependency_libs"
+		      test lib = "$linkmode" && newdependency_libs="$deplib $newdependency_libs"
 		    fi
 		    continue
 		  fi
@@ -6231,15 +7679,25 @@ func_mode_link ()
 	      *) ;;
 	      esac
 	    fi
+	  else
+	    # deplib doesn't seem to be a libtool library
+	    if test prog,link = "$linkmode,$pass"; then
+	      compile_deplibs="$deplib $compile_deplibs"
+	      finalize_deplibs="$deplib $finalize_deplibs"
+	    else
+	      deplibs="$deplib $deplibs"
+	      test lib = "$linkmode" && newdependency_libs="$deplib $newdependency_libs"
+	    fi
+	    continue
 	  fi
 	  ;; # -l
 	*.ltframework)
-	  if test "$linkmode,$pass" = "prog,link"; then
+	  if test prog,link = "$linkmode,$pass"; then
 	    compile_deplibs="$deplib $compile_deplibs"
 	    finalize_deplibs="$deplib $finalize_deplibs"
 	  else
 	    deplibs="$deplib $deplibs"
-	    if test "$linkmode" = lib ; then
+	    if test lib = "$linkmode"; then
 		case "$new_inherited_linker_flags " in
 		    *" $deplib "*) ;;
 		    * ) func_append new_inherited_linker_flags " $deplib" ;;
@@ -6252,18 +7710,18 @@ func_mode_link ()
 	  case $linkmode in
 	  lib)
 	    deplibs="$deplib $deplibs"
-	    test "$pass" = conv && continue
+	    test conv = "$pass" && continue
 	    newdependency_libs="$deplib $newdependency_libs"
 	    func_stripname '-L' '' "$deplib"
 	    func_resolve_sysroot "$func_stripname_result"
 	    func_append newlib_search_path " $func_resolve_sysroot_result"
 	    ;;
 	  prog)
-	    if test "$pass" = conv; then
+	    if test conv = "$pass"; then
 	      deplibs="$deplib $deplibs"
 	      continue
 	    fi
-	    if test "$pass" = scan; then
+	    if test scan = "$pass"; then
 	      deplibs="$deplib $deplibs"
 	    else
 	      compile_deplibs="$deplib $compile_deplibs"
@@ -6274,13 +7732,13 @@ func_mode_link ()
 	    func_append newlib_search_path " $func_resolve_sysroot_result"
 	    ;;
 	  *)
-	    func_warning "\`-L' is ignored for archives/objects"
+	    func_warning "'-L' is ignored for archives/objects"
 	    ;;
 	  esac # linkmode
 	  continue
 	  ;; # -L
 	-R*)
-	  if test "$pass" = link; then
+	  if test link = "$pass"; then
 	    func_stripname '-R' '' "$deplib"
 	    func_resolve_sysroot "$func_stripname_result"
 	    dir=$func_resolve_sysroot_result
@@ -6298,7 +7756,7 @@ func_mode_link ()
 	  lib=$func_resolve_sysroot_result
 	  ;;
 	*.$libext)
-	  if test "$pass" = conv; then
+	  if test conv = "$pass"; then
 	    deplibs="$deplib $deplibs"
 	    continue
 	  fi
@@ -6309,21 +7767,26 @@ func_mode_link ()
 	    case " $dlpreconveniencelibs " in
 	    *" $deplib "*) ;;
 	    *)
-	      valid_a_lib=no
+	      valid_a_lib=false
 	      case $deplibs_check_method in
 		match_pattern*)
 		  set dummy $deplibs_check_method; shift
 		  match_pattern_regex=`expr "$deplibs_check_method" : "$1 \(.*\)"`
 		  if eval "\$ECHO \"$deplib\"" 2>/dev/null | $SED 10q \
 		    | $EGREP "$match_pattern_regex" > /dev/null; then
-		    valid_a_lib=yes
+		    valid_a_lib=:
 		  fi
 		;;
 		pass_all)
-		  valid_a_lib=yes
+		  valid_a_lib=:
 		;;
 	      esac
-	      if test "$valid_a_lib" != yes; then
+	      if $valid_a_lib; then
+		echo
+		$ECHO "*** Warning: Linking the shared library $output against the"
+		$ECHO "*** static library $deplib is not portable!"
+		deplibs="$deplib $deplibs"
+	      else
 		echo
 		$ECHO "*** Warning: Trying to link with static lib archive $deplib."
 		echo "*** I have the capability to make that library automatically link in when"
@@ -6331,18 +7794,13 @@ func_mode_link ()
 		echo "*** shared version of the library, which you do not appear to have"
 		echo "*** because the file extensions .$libext of this argument makes me believe"
 		echo "*** that it is just a static archive that I should not use here."
-	      else
-		echo
-		$ECHO "*** Warning: Linking the shared library $output against the"
-		$ECHO "*** static library $deplib is not portable!"
-		deplibs="$deplib $deplibs"
 	      fi
 	      ;;
 	    esac
 	    continue
 	    ;;
 	  prog)
-	    if test "$pass" != link; then
+	    if test link != "$pass"; then
 	      deplibs="$deplib $deplibs"
 	    else
 	      compile_deplibs="$deplib $compile_deplibs"
@@ -6353,10 +7811,10 @@ func_mode_link ()
 	  esac # linkmode
 	  ;; # *.$libext
 	*.lo | *.$objext)
-	  if test "$pass" = conv; then
+	  if test conv = "$pass"; then
 	    deplibs="$deplib $deplibs"
-	  elif test "$linkmode" = prog; then
-	    if test "$pass" = dlpreopen || test "$dlopen_support" != yes || test "$build_libtool_libs" = no; then
+	  elif test prog = "$linkmode"; then
+	    if test dlpreopen = "$pass" || test yes != "$dlopen_support" || test no = "$build_libtool_libs"; then
 	      # If there is no dlopen support or we're linking statically,
 	      # we need to preload.
 	      func_append newdlprefiles " $deplib"
@@ -6369,22 +7827,20 @@ func_mode_link ()
 	  continue
 	  ;;
 	%DEPLIBS%)
-	  alldeplibs=yes
+	  alldeplibs=:
 	  continue
 	  ;;
 	esac # case $deplib
 
-	if test "$found" = yes || test -f "$lib"; then :
-	else
-	  func_fatal_error "cannot find the library \`$lib' or unhandled argument \`$deplib'"
-	fi
+	$found || test -f "$lib" \
+	  || func_fatal_error "cannot find the library '$lib' or unhandled argument '$deplib'"
 
 	# Check to see that this really is a libtool archive.
 	func_lalib_unsafe_p "$lib" \
-	  || func_fatal_error "\`$lib' is not a valid libtool archive"
+	  || func_fatal_error "'$lib' is not a valid libtool archive"
 
 	func_dirname "$lib" "" "."
-	ladir="$func_dirname_result"
+	ladir=$func_dirname_result
 
 	dlname=
 	dlopen=
@@ -6414,30 +7870,30 @@ func_mode_link ()
 	  done
 	fi
 	dependency_libs=`$ECHO " $dependency_libs" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
-	if test "$linkmode,$pass" = "lib,link" ||
-	   test "$linkmode,$pass" = "prog,scan" ||
-	   { test "$linkmode" != prog && test "$linkmode" != lib; }; then
+	if test lib,link = "$linkmode,$pass" ||
+	   test prog,scan = "$linkmode,$pass" ||
+	   { test prog != "$linkmode" && test lib != "$linkmode"; }; then
 	  test -n "$dlopen" && func_append dlfiles " $dlopen"
 	  test -n "$dlpreopen" && func_append dlprefiles " $dlpreopen"
 	fi
 
-	if test "$pass" = conv; then
+	if test conv = "$pass"; then
 	  # Only check for convenience libraries
 	  deplibs="$lib $deplibs"
 	  if test -z "$libdir"; then
 	    if test -z "$old_library"; then
-	      func_fatal_error "cannot find name of link library for \`$lib'"
+	      func_fatal_error "cannot find name of link library for '$lib'"
 	    fi
 	    # It is a libtool convenience library, so add in its objects.
 	    func_append convenience " $ladir/$objdir/$old_library"
 	    func_append old_convenience " $ladir/$objdir/$old_library"
-	  elif test "$linkmode" != prog && test "$linkmode" != lib; then
-	    func_fatal_error "\`$lib' is not a convenience library"
+	  elif test prog != "$linkmode" && test lib != "$linkmode"; then
+	    func_fatal_error "'$lib' is not a convenience library"
 	  fi
 	  tmp_libs=
 	  for deplib in $dependency_libs; do
 	    deplibs="$deplib $deplibs"
-	    if $opt_preserve_dup_deps ; then
+	    if $opt_preserve_dup_deps; then
 	      case "$tmp_libs " in
 	      *" $deplib "*) func_append specialdeplibs " $deplib" ;;
 	      esac
@@ -6451,26 +7907,26 @@ func_mode_link ()
 	# Get the name of the library we link against.
 	linklib=
 	if test -n "$old_library" &&
-	   { test "$prefer_static_libs" = yes ||
-	     test "$prefer_static_libs,$installed" = "built,no"; }; then
+	   { test yes = "$prefer_static_libs" ||
+	     test built,no = "$prefer_static_libs,$installed"; }; then
 	  linklib=$old_library
 	else
 	  for l in $old_library $library_names; do
-	    linklib="$l"
+	    linklib=$l
 	  done
 	fi
 	if test -z "$linklib"; then
-	  func_fatal_error "cannot find name of link library for \`$lib'"
+	  func_fatal_error "cannot find name of link library for '$lib'"
 	fi
 
 	# This library was specified with -dlopen.
-	if test "$pass" = dlopen; then
-	  if test -z "$libdir"; then
-	    func_fatal_error "cannot -dlopen a convenience library: \`$lib'"
-	  fi
+	if test dlopen = "$pass"; then
+	  test -z "$libdir" \
+	    && func_fatal_error "cannot -dlopen a convenience library: '$lib'"
 	  if test -z "$dlname" ||
-	     test "$dlopen_support" != yes ||
-	     test "$build_libtool_libs" = no; then
+	     test yes != "$dlopen_support" ||
+	     test no = "$build_libtool_libs"
+	  then
 	    # If there is no dlname, no dlopen support or we're linking
 	    # statically, we need to preload.  We also need to preload any
 	    # dependent libraries so libltdl's deplib preloader doesn't
@@ -6484,40 +7940,40 @@ func_mode_link ()
 
 	# We need an absolute path.
 	case $ladir in
-	[\\/]* | [A-Za-z]:[\\/]*) abs_ladir="$ladir" ;;
+	[\\/]* | [A-Za-z]:[\\/]*) abs_ladir=$ladir ;;
 	*)
 	  abs_ladir=`cd "$ladir" && pwd`
 	  if test -z "$abs_ladir"; then
-	    func_warning "cannot determine absolute directory name of \`$ladir'"
+	    func_warning "cannot determine absolute directory name of '$ladir'"
 	    func_warning "passing it literally to the linker, although it might fail"
-	    abs_ladir="$ladir"
+	    abs_ladir=$ladir
 	  fi
 	  ;;
 	esac
 	func_basename "$lib"
-	laname="$func_basename_result"
+	laname=$func_basename_result
 
 	# Find the relevant object directory and library name.
-	if test "X$installed" = Xyes; then
+	if test yes = "$installed"; then
 	  if test ! -f "$lt_sysroot$libdir/$linklib" && test -f "$abs_ladir/$linklib"; then
-	    func_warning "library \`$lib' was moved."
-	    dir="$ladir"
-	    absdir="$abs_ladir"
-	    libdir="$abs_ladir"
+	    func_warning "library '$lib' was moved."
+	    dir=$ladir
+	    absdir=$abs_ladir
+	    libdir=$abs_ladir
 	  else
-	    dir="$lt_sysroot$libdir"
-	    absdir="$lt_sysroot$libdir"
+	    dir=$lt_sysroot$libdir
+	    absdir=$lt_sysroot$libdir
 	  fi
-	  test "X$hardcode_automatic" = Xyes && avoidtemprpath=yes
+	  test yes = "$hardcode_automatic" && avoidtemprpath=yes
 	else
 	  if test ! -f "$ladir/$objdir/$linklib" && test -f "$abs_ladir/$linklib"; then
-	    dir="$ladir"
-	    absdir="$abs_ladir"
+	    dir=$ladir
+	    absdir=$abs_ladir
 	    # Remove this search path later
 	    func_append notinst_path " $abs_ladir"
 	  else
-	    dir="$ladir/$objdir"
-	    absdir="$abs_ladir/$objdir"
+	    dir=$ladir/$objdir
+	    absdir=$abs_ladir/$objdir
 	    # Remove this search path later
 	    func_append notinst_path " $abs_ladir"
 	  fi
@@ -6526,11 +7982,11 @@ func_mode_link ()
 	name=$func_stripname_result
 
 	# This library was specified with -dlpreopen.
-	if test "$pass" = dlpreopen; then
-	  if test -z "$libdir" && test "$linkmode" = prog; then
-	    func_fatal_error "only libraries may -dlpreopen a convenience library: \`$lib'"
+	if test dlpreopen = "$pass"; then
+	  if test -z "$libdir" && test prog = "$linkmode"; then
+	    func_fatal_error "only libraries may -dlpreopen a convenience library: '$lib'"
 	  fi
-	  case "$host" in
+	  case $host in
 	    # special handling for platforms with PE-DLLs.
 	    *cygwin* | *mingw* | *cegcc* )
 	      # Linker will automatically link against shared library if both
@@ -6574,9 +8030,9 @@ func_mode_link ()
 
 	if test -z "$libdir"; then
 	  # Link the convenience library
-	  if test "$linkmode" = lib; then
+	  if test lib = "$linkmode"; then
 	    deplibs="$dir/$old_library $deplibs"
-	  elif test "$linkmode,$pass" = "prog,link"; then
+	  elif test prog,link = "$linkmode,$pass"; then
 	    compile_deplibs="$dir/$old_library $compile_deplibs"
 	    finalize_deplibs="$dir/$old_library $finalize_deplibs"
 	  else
@@ -6586,14 +8042,14 @@ func_mode_link ()
 	fi
 
 
-	if test "$linkmode" = prog && test "$pass" != link; then
+	if test prog = "$linkmode" && test link != "$pass"; then
 	  func_append newlib_search_path " $ladir"
 	  deplibs="$lib $deplibs"
 
-	  linkalldeplibs=no
-	  if test "$link_all_deplibs" != no || test -z "$library_names" ||
-	     test "$build_libtool_libs" = no; then
-	    linkalldeplibs=yes
+	  linkalldeplibs=false
+	  if test no != "$link_all_deplibs" || test -z "$library_names" ||
+	     test no = "$build_libtool_libs"; then
+	    linkalldeplibs=:
 	  fi
 
 	  tmp_libs=
@@ -6605,14 +8061,14 @@ func_mode_link ()
 		 ;;
 	    esac
 	    # Need to link against all dependency_libs?
-	    if test "$linkalldeplibs" = yes; then
+	    if $linkalldeplibs; then
 	      deplibs="$deplib $deplibs"
 	    else
 	      # Need to hardcode shared library paths
 	      # or/and link against static libraries
 	      newdependency_libs="$deplib $newdependency_libs"
 	    fi
-	    if $opt_preserve_dup_deps ; then
+	    if $opt_preserve_dup_deps; then
 	      case "$tmp_libs " in
 	      *" $deplib "*) func_append specialdeplibs " $deplib" ;;
 	      esac
@@ -6622,15 +8078,15 @@ func_mode_link ()
 	  continue
 	fi # $linkmode = prog...
 
-	if test "$linkmode,$pass" = "prog,link"; then
+	if test prog,link = "$linkmode,$pass"; then
 	  if test -n "$library_names" &&
-	     { { test "$prefer_static_libs" = no ||
-	         test "$prefer_static_libs,$installed" = "built,yes"; } ||
+	     { { test no = "$prefer_static_libs" ||
+	         test built,yes = "$prefer_static_libs,$installed"; } ||
 	       test -z "$old_library"; }; then
 	    # We need to hardcode the library path
-	    if test -n "$shlibpath_var" && test -z "$avoidtemprpath" ; then
+	    if test -n "$shlibpath_var" && test -z "$avoidtemprpath"; then
 	      # Make sure the rpath contains only unique directories.
-	      case "$temp_rpath:" in
+	      case $temp_rpath: in
 	      *"$absdir:"*) ;;
 	      *) func_append temp_rpath "$absdir:" ;;
 	      esac
@@ -6659,9 +8115,9 @@ func_mode_link ()
 	    esac
 	  fi # $linkmode,$pass = prog,link...
 
-	  if test "$alldeplibs" = yes &&
-	     { test "$deplibs_check_method" = pass_all ||
-	       { test "$build_libtool_libs" = yes &&
+	  if $alldeplibs &&
+	     { test pass_all = "$deplibs_check_method" ||
+	       { test yes = "$build_libtool_libs" &&
 		 test -n "$library_names"; }; }; then
 	    # We only need to search for static libraries
 	    continue
@@ -6670,19 +8126,19 @@ func_mode_link ()
 
 	link_static=no # Whether the deplib will be linked statically
 	use_static_libs=$prefer_static_libs
-	if test "$use_static_libs" = built && test "$installed" = yes; then
+	if test built = "$use_static_libs" && test yes = "$installed"; then
 	  use_static_libs=no
 	fi
 	if test -n "$library_names" &&
-	   { test "$use_static_libs" = no || test -z "$old_library"; }; then
+	   { test no = "$use_static_libs" || test -z "$old_library"; }; then
 	  case $host in
-	  *cygwin* | *mingw* | *cegcc*)
+	  *cygwin* | *mingw* | *cegcc* | *os2*)
 	      # No point in relinking DLLs because paths are not encoded
 	      func_append notinst_deplibs " $lib"
 	      need_relink=no
 	    ;;
 	  *)
-	    if test "$installed" = no; then
+	    if test no = "$installed"; then
 	      func_append notinst_deplibs " $lib"
 	      need_relink=yes
 	    fi
@@ -6692,24 +8148,24 @@ func_mode_link ()
 
 	  # Warn about portability, can't link against -module's on some
 	  # systems (darwin).  Don't bleat about dlopened modules though!
-	  dlopenmodule=""
+	  dlopenmodule=
 	  for dlpremoduletest in $dlprefiles; do
 	    if test "X$dlpremoduletest" = "X$lib"; then
-	      dlopenmodule="$dlpremoduletest"
+	      dlopenmodule=$dlpremoduletest
 	      break
 	    fi
 	  done
-	  if test -z "$dlopenmodule" && test "$shouldnotlink" = yes && test "$pass" = link; then
+	  if test -z "$dlopenmodule" && test yes = "$shouldnotlink" && test link = "$pass"; then
 	    echo
-	    if test "$linkmode" = prog; then
+	    if test prog = "$linkmode"; then
 	      $ECHO "*** Warning: Linking the executable $output against the loadable module"
 	    else
 	      $ECHO "*** Warning: Linking the shared library $output against the loadable module"
 	    fi
 	    $ECHO "*** $linklib is not portable!"
 	  fi
-	  if test "$linkmode" = lib &&
-	     test "$hardcode_into_libs" = yes; then
+	  if test lib = "$linkmode" &&
+	     test yes = "$hardcode_into_libs"; then
 	    # Hardcode the library path.
 	    # Skip directories that are in the system default run-time
 	    # search path.
@@ -6737,43 +8193,43 @@ func_mode_link ()
 	    # figure out the soname
 	    set dummy $library_names
 	    shift
-	    realname="$1"
+	    realname=$1
 	    shift
 	    libname=`eval "\\$ECHO \"$libname_spec\""`
 	    # use dlname if we got it. it's perfectly good, no?
 	    if test -n "$dlname"; then
-	      soname="$dlname"
+	      soname=$dlname
 	    elif test -n "$soname_spec"; then
 	      # bleh windows
 	      case $host in
-	      *cygwin* | mingw* | *cegcc*)
+	      *cygwin* | mingw* | *cegcc* | *os2*)
 	        func_arith $current - $age
 		major=$func_arith_result
-		versuffix="-$major"
+		versuffix=-$major
 		;;
 	      esac
 	      eval soname=\"$soname_spec\"
 	    else
-	      soname="$realname"
+	      soname=$realname
 	    fi
 
 	    # Make a new name for the extract_expsyms_cmds to use
-	    soroot="$soname"
+	    soroot=$soname
 	    func_basename "$soroot"
-	    soname="$func_basename_result"
+	    soname=$func_basename_result
 	    func_stripname 'lib' '.dll' "$soname"
 	    newlib=libimp-$func_stripname_result.a
 
 	    # If the library has no export list, then create one now
 	    if test -f "$output_objdir/$soname-def"; then :
 	    else
-	      func_verbose "extracting exported symbol list from \`$soname'"
+	      func_verbose "extracting exported symbol list from '$soname'"
 	      func_execute_cmds "$extract_expsyms_cmds" 'exit $?'
 	    fi
 
 	    # Create $newlib
 	    if test -f "$output_objdir/$newlib"; then :; else
-	      func_verbose "generating import library for \`$soname'"
+	      func_verbose "generating import library for '$soname'"
 	      func_execute_cmds "$old_archive_from_expsyms_cmds" 'exit $?'
 	    fi
 	    # make sure the library variables are pointing to the new library
@@ -6781,58 +8237,58 @@ func_mode_link ()
 	    linklib=$newlib
 	  fi # test -n "$old_archive_from_expsyms_cmds"
 
-	  if test "$linkmode" = prog || test "$opt_mode" != relink; then
+	  if test prog = "$linkmode" || test relink != "$opt_mode"; then
 	    add_shlibpath=
 	    add_dir=
 	    add=
 	    lib_linked=yes
 	    case $hardcode_action in
 	    immediate | unsupported)
-	      if test "$hardcode_direct" = no; then
-		add="$dir/$linklib"
+	      if test no = "$hardcode_direct"; then
+		add=$dir/$linklib
 		case $host in
-		  *-*-sco3.2v5.0.[024]*) add_dir="-L$dir" ;;
-		  *-*-sysv4*uw2*) add_dir="-L$dir" ;;
+		  *-*-sco3.2v5.0.[024]*) add_dir=-L$dir ;;
+		  *-*-sysv4*uw2*) add_dir=-L$dir ;;
 		  *-*-sysv5OpenUNIX* | *-*-sysv5UnixWare7.[01].[10]* | \
-		    *-*-unixware7*) add_dir="-L$dir" ;;
+		    *-*-unixware7*) add_dir=-L$dir ;;
 		  *-*-darwin* )
-		    # if the lib is a (non-dlopened) module then we can not
+		    # if the lib is a (non-dlopened) module then we cannot
 		    # link against it, someone is ignoring the earlier warnings
 		    if /usr/bin/file -L $add 2> /dev/null |
-			 $GREP ": [^:]* bundle" >/dev/null ; then
+			 $GREP ": [^:]* bundle" >/dev/null; then
 		      if test "X$dlopenmodule" != "X$lib"; then
 			$ECHO "*** Warning: lib $linklib is a module, not a shared library"
-			if test -z "$old_library" ; then
+			if test -z "$old_library"; then
 			  echo
 			  echo "*** And there doesn't seem to be a static archive available"
 			  echo "*** The link will probably fail, sorry"
 			else
-			  add="$dir/$old_library"
+			  add=$dir/$old_library
 			fi
 		      elif test -n "$old_library"; then
-			add="$dir/$old_library"
+			add=$dir/$old_library
 		      fi
 		    fi
 		esac
-	      elif test "$hardcode_minus_L" = no; then
+	      elif test no = "$hardcode_minus_L"; then
 		case $host in
-		*-*-sunos*) add_shlibpath="$dir" ;;
+		*-*-sunos*) add_shlibpath=$dir ;;
 		esac
-		add_dir="-L$dir"
-		add="-l$name"
-	      elif test "$hardcode_shlibpath_var" = no; then
-		add_shlibpath="$dir"
-		add="-l$name"
+		add_dir=-L$dir
+		add=-l$name
+	      elif test no = "$hardcode_shlibpath_var"; then
+		add_shlibpath=$dir
+		add=-l$name
 	      else
 		lib_linked=no
 	      fi
 	      ;;
 	    relink)
-	      if test "$hardcode_direct" = yes &&
-	         test "$hardcode_direct_absolute" = no; then
-		add="$dir/$linklib"
-	      elif test "$hardcode_minus_L" = yes; then
-		add_dir="-L$dir"
+	      if test yes = "$hardcode_direct" &&
+	         test no = "$hardcode_direct_absolute"; then
+		add=$dir/$linklib
+	      elif test yes = "$hardcode_minus_L"; then
+		add_dir=-L$absdir
 		# Try looking first in the location we're being installed to.
 		if test -n "$inst_prefix_dir"; then
 		  case $libdir in
@@ -6841,10 +8297,10 @@ func_mode_link ()
 		      ;;
 		  esac
 		fi
-		add="-l$name"
-	      elif test "$hardcode_shlibpath_var" = yes; then
-		add_shlibpath="$dir"
-		add="-l$name"
+		add=-l$name
+	      elif test yes = "$hardcode_shlibpath_var"; then
+		add_shlibpath=$dir
+		add=-l$name
 	      else
 		lib_linked=no
 	      fi
@@ -6852,7 +8308,7 @@ func_mode_link ()
 	    *) lib_linked=no ;;
 	    esac
 
-	    if test "$lib_linked" != yes; then
+	    if test yes != "$lib_linked"; then
 	      func_fatal_configuration "unsupported hardcode properties"
 	    fi
 
@@ -6862,15 +8318,15 @@ func_mode_link ()
 	      *) func_append compile_shlibpath "$add_shlibpath:" ;;
 	      esac
 	    fi
-	    if test "$linkmode" = prog; then
+	    if test prog = "$linkmode"; then
 	      test -n "$add_dir" && compile_deplibs="$add_dir $compile_deplibs"
 	      test -n "$add" && compile_deplibs="$add $compile_deplibs"
 	    else
 	      test -n "$add_dir" && deplibs="$add_dir $deplibs"
 	      test -n "$add" && deplibs="$add $deplibs"
-	      if test "$hardcode_direct" != yes &&
-		 test "$hardcode_minus_L" != yes &&
-		 test "$hardcode_shlibpath_var" = yes; then
+	      if test yes != "$hardcode_direct" &&
+		 test yes != "$hardcode_minus_L" &&
+		 test yes = "$hardcode_shlibpath_var"; then
 		case :$finalize_shlibpath: in
 		*":$libdir:"*) ;;
 		*) func_append finalize_shlibpath "$libdir:" ;;
@@ -6879,33 +8335,33 @@ func_mode_link ()
 	    fi
 	  fi
 
-	  if test "$linkmode" = prog || test "$opt_mode" = relink; then
+	  if test prog = "$linkmode" || test relink = "$opt_mode"; then
 	    add_shlibpath=
 	    add_dir=
 	    add=
 	    # Finalize command for both is simple: just hardcode it.
-	    if test "$hardcode_direct" = yes &&
-	       test "$hardcode_direct_absolute" = no; then
-	      add="$libdir/$linklib"
-	    elif test "$hardcode_minus_L" = yes; then
-	      add_dir="-L$libdir"
-	      add="-l$name"
-	    elif test "$hardcode_shlibpath_var" = yes; then
+	    if test yes = "$hardcode_direct" &&
+	       test no = "$hardcode_direct_absolute"; then
+	      add=$libdir/$linklib
+	    elif test yes = "$hardcode_minus_L"; then
+	      add_dir=-L$libdir
+	      add=-l$name
+	    elif test yes = "$hardcode_shlibpath_var"; then
 	      case :$finalize_shlibpath: in
 	      *":$libdir:"*) ;;
 	      *) func_append finalize_shlibpath "$libdir:" ;;
 	      esac
-	      add="-l$name"
-	    elif test "$hardcode_automatic" = yes; then
+	      add=-l$name
+	    elif test yes = "$hardcode_automatic"; then
 	      if test -n "$inst_prefix_dir" &&
-		 test -f "$inst_prefix_dir$libdir/$linklib" ; then
-		add="$inst_prefix_dir$libdir/$linklib"
+		 test -f "$inst_prefix_dir$libdir/$linklib"; then
+		add=$inst_prefix_dir$libdir/$linklib
 	      else
-		add="$libdir/$linklib"
+		add=$libdir/$linklib
 	      fi
 	    else
 	      # We cannot seem to hardcode it, guess we'll fake it.
-	      add_dir="-L$libdir"
+	      add_dir=-L$libdir
 	      # Try looking first in the location we're being installed to.
 	      if test -n "$inst_prefix_dir"; then
 		case $libdir in
@@ -6914,10 +8370,10 @@ func_mode_link ()
 		    ;;
 		esac
 	      fi
-	      add="-l$name"
+	      add=-l$name
 	    fi
 
-	    if test "$linkmode" = prog; then
+	    if test prog = "$linkmode"; then
 	      test -n "$add_dir" && finalize_deplibs="$add_dir $finalize_deplibs"
 	      test -n "$add" && finalize_deplibs="$add $finalize_deplibs"
 	    else
@@ -6925,43 +8381,43 @@ func_mode_link ()
 	      test -n "$add" && deplibs="$add $deplibs"
 	    fi
 	  fi
-	elif test "$linkmode" = prog; then
+	elif test prog = "$linkmode"; then
 	  # Here we assume that one of hardcode_direct or hardcode_minus_L
 	  # is not unsupported.  This is valid on all known static and
 	  # shared platforms.
-	  if test "$hardcode_direct" != unsupported; then
-	    test -n "$old_library" && linklib="$old_library"
+	  if test unsupported != "$hardcode_direct"; then
+	    test -n "$old_library" && linklib=$old_library
 	    compile_deplibs="$dir/$linklib $compile_deplibs"
 	    finalize_deplibs="$dir/$linklib $finalize_deplibs"
 	  else
 	    compile_deplibs="-l$name -L$dir $compile_deplibs"
 	    finalize_deplibs="-l$name -L$dir $finalize_deplibs"
 	  fi
-	elif test "$build_libtool_libs" = yes; then
+	elif test yes = "$build_libtool_libs"; then
 	  # Not a shared library
-	  if test "$deplibs_check_method" != pass_all; then
+	  if test pass_all != "$deplibs_check_method"; then
 	    # We're trying link a shared library against a static one
 	    # but the system doesn't support it.
 
 	    # Just print a warning and add the library to dependency_libs so
 	    # that the program can be linked against the static library.
 	    echo
-	    $ECHO "*** Warning: This system can not link to static lib archive $lib."
+	    $ECHO "*** Warning: This system cannot link to static lib archive $lib."
 	    echo "*** I have the capability to make that library automatically link in when"
 	    echo "*** you link to this library.  But I can only do this if you have a"
 	    echo "*** shared version of the library, which you do not appear to have."
-	    if test "$module" = yes; then
+	    if test yes = "$module"; then
 	      echo "*** But as you try to build a module library, libtool will still create "
 	      echo "*** a static module, that should work as long as the dlopening application"
 	      echo "*** is linked with the -dlopen flag to resolve symbols at runtime."
 	      if test -z "$global_symbol_pipe"; then
 		echo
 		echo "*** However, this would only work if libtool was able to extract symbol"
-		echo "*** lists from a program, using \`nm' or equivalent, but libtool could"
+		echo "*** lists from a program, using 'nm' or equivalent, but libtool could"
 		echo "*** not find such a program.  So, this module is probably useless."
-		echo "*** \`nm' from GNU binutils and a full rebuild may help."
+		echo "*** 'nm' from GNU binutils and a full rebuild may help."
 	      fi
-	      if test "$build_old_libs" = no; then
+	      if test no = "$build_old_libs"; then
 		build_libtool_libs=module
 		build_old_libs=yes
 	      else
@@ -6974,11 +8430,11 @@ func_mode_link ()
 	  fi
 	fi # link shared/static library?
 
-	if test "$linkmode" = lib; then
+	if test lib = "$linkmode"; then
 	  if test -n "$dependency_libs" &&
-	     { test "$hardcode_into_libs" != yes ||
-	       test "$build_old_libs" = yes ||
-	       test "$link_static" = yes; }; then
+	     { test yes != "$hardcode_into_libs" ||
+	       test yes = "$build_old_libs" ||
+	       test yes = "$link_static"; }; then
 	    # Extract -R from dependency_libs
 	    temp_deplibs=
 	    for libdir in $dependency_libs; do
@@ -6992,12 +8448,12 @@ func_mode_link ()
 	      *) func_append temp_deplibs " $libdir";;
 	      esac
 	    done
-	    dependency_libs="$temp_deplibs"
+	    dependency_libs=$temp_deplibs
 	  fi
 
 	  func_append newlib_search_path " $absdir"
 	  # Link against this library
-	  test "$link_static" = no && newdependency_libs="$abs_ladir/$laname $newdependency_libs"
+	  test no = "$link_static" && newdependency_libs="$abs_ladir/$laname $newdependency_libs"
 	  # ... and its dependency_libs
 	  tmp_libs=
 	  for deplib in $dependency_libs; do
@@ -7007,7 +8463,7 @@ func_mode_link ()
                    func_resolve_sysroot "$func_stripname_result";;
               *) func_resolve_sysroot "$deplib" ;;
             esac
-	    if $opt_preserve_dup_deps ; then
+	    if $opt_preserve_dup_deps; then
 	      case "$tmp_libs " in
 	      *" $func_resolve_sysroot_result "*)
                 func_append specialdeplibs " $func_resolve_sysroot_result" ;;
@@ -7016,12 +8472,12 @@ func_mode_link ()
 	    func_append tmp_libs " $func_resolve_sysroot_result"
 	  done
 
-	  if test "$link_all_deplibs" != no; then
+	  if test no != "$link_all_deplibs"; then
 	    # Add the search paths of all dependency libraries
 	    for deplib in $dependency_libs; do
 	      path=
 	      case $deplib in
-	      -L*) path="$deplib" ;;
+	      -L*) path=$deplib ;;
 	      *.la)
 	        func_resolve_sysroot "$deplib"
 	        deplib=$func_resolve_sysroot_result
@@ -7029,12 +8485,12 @@ func_mode_link ()
 		dir=$func_dirname_result
 		# We need an absolute path.
 		case $dir in
-		[\\/]* | [A-Za-z]:[\\/]*) absdir="$dir" ;;
+		[\\/]* | [A-Za-z]:[\\/]*) absdir=$dir ;;
 		*)
 		  absdir=`cd "$dir" && pwd`
 		  if test -z "$absdir"; then
-		    func_warning "cannot determine absolute directory name of \`$dir'"
-		    absdir="$dir"
+		    func_warning "cannot determine absolute directory name of '$dir'"
+		    absdir=$dir
 		  fi
 		  ;;
 		esac
@@ -7042,35 +8498,35 @@ func_mode_link ()
 		case $host in
 		*-*-darwin*)
 		  depdepl=
-		  eval deplibrary_names=`${SED} -n -e 's/^library_names=\(.*\)$/\1/p' $deplib`
-		  if test -n "$deplibrary_names" ; then
-		    for tmp in $deplibrary_names ; do
+		  eval deplibrary_names=`$SED -n -e 's/^library_names=\(.*\)$/\1/p' $deplib`
+		  if test -n "$deplibrary_names"; then
+		    for tmp in $deplibrary_names; do
 		      depdepl=$tmp
 		    done
-		    if test -f "$absdir/$objdir/$depdepl" ; then
-		      depdepl="$absdir/$objdir/$depdepl"
-		      darwin_install_name=`${OTOOL} -L $depdepl | awk '{if (NR == 2) {print $1;exit}}'`
+		    if test -f "$absdir/$objdir/$depdepl"; then
+		      depdepl=$absdir/$objdir/$depdepl
+		      darwin_install_name=`$OTOOL -L $depdepl | awk '{if (NR == 2) {print $1;exit}}'`
                       if test -z "$darwin_install_name"; then
-                          darwin_install_name=`${OTOOL64} -L $depdepl  | awk '{if (NR == 2) {print $1;exit}}'`
+                          darwin_install_name=`$OTOOL64 -L $depdepl  | awk '{if (NR == 2) {print $1;exit}}'`
                       fi
-		      func_append compiler_flags " ${wl}-dylib_file ${wl}${darwin_install_name}:${depdepl}"
-		      func_append linker_flags " -dylib_file ${darwin_install_name}:${depdepl}"
+		      func_append compiler_flags " $wl-dylib_file $wl$darwin_install_name:$depdepl"
+		      func_append linker_flags " -dylib_file $darwin_install_name:$depdepl"
 		      path=
 		    fi
 		  fi
 		  ;;
 		*)
-		  path="-L$absdir/$objdir"
+		  path=-L$absdir/$objdir
 		  ;;
 		esac
 		else
-		  eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
+		  eval libdir=`$SED -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
 		  test -z "$libdir" && \
-		    func_fatal_error "\`$deplib' is not a valid libtool archive"
+		    func_fatal_error "'$deplib' is not a valid libtool archive"
 		  test "$absdir" != "$libdir" && \
-		    func_warning "\`$deplib' seems to be moved"
+		    func_warning "'$deplib' seems to be moved"
 
-		  path="-L$absdir"
+		  path=-L$absdir
 		fi
 		;;
 	      esac
@@ -7082,23 +8538,23 @@ func_mode_link ()
 	  fi # link_all_deplibs != no
 	fi # linkmode = lib
       done # for deplib in $libs
-      if test "$pass" = link; then
-	if test "$linkmode" = "prog"; then
+      if test link = "$pass"; then
+	if test prog = "$linkmode"; then
 	  compile_deplibs="$new_inherited_linker_flags $compile_deplibs"
 	  finalize_deplibs="$new_inherited_linker_flags $finalize_deplibs"
 	else
 	  compiler_flags="$compiler_flags "`$ECHO " $new_inherited_linker_flags" | $SED 's% \([^ $]*\).ltframework% -framework \1%g'`
 	fi
       fi
-      dependency_libs="$newdependency_libs"
-      if test "$pass" = dlpreopen; then
+      dependency_libs=$newdependency_libs
+      if test dlpreopen = "$pass"; then
 	# Link the dlpreopened libraries before other libraries
 	for deplib in $save_deplibs; do
 	  deplibs="$deplib $deplibs"
 	done
       fi
-      if test "$pass" != dlopen; then
-	if test "$pass" != conv; then
+      if test dlopen != "$pass"; then
+	test conv = "$pass" || {
 	  # Make sure lib_search_path contains only unique directories.
 	  lib_search_path=
 	  for dir in $newlib_search_path; do
@@ -7108,12 +8564,12 @@ func_mode_link ()
 	    esac
 	  done
 	  newlib_search_path=
-	fi
+	}
 
-	if test "$linkmode,$pass" != "prog,link"; then
-	  vars="deplibs"
-	else
+	if test prog,link = "$linkmode,$pass"; then
 	  vars="compile_deplibs finalize_deplibs"
+	else
+	  vars=deplibs
 	fi
 	for var in $vars dependency_libs; do
 	  # Add libraries to $var in reverse order
@@ -7171,62 +8627,93 @@ func_mode_link ()
 	  eval $var=\"$tmp_libs\"
 	done # for var
       fi
+
+      # Add Sun CC postdeps if required:
+      test CXX = "$tagname" && {
+        case $host_os in
+        linux*)
+          case `$CC -V 2>&1 | sed 5q` in
+          *Sun\ C*) # Sun C++ 5.9
+            func_suncc_cstd_abi
+
+            if test no != "$suncc_use_cstd_abi"; then
+              func_append postdeps ' -library=Cstd -library=Crun'
+            fi
+            ;;
+          esac
+          ;;
+
+        solaris*)
+          func_cc_basename "$CC"
+          case $func_cc_basename_result in
+          CC* | sunCC*)
+            func_suncc_cstd_abi
+
+            if test no != "$suncc_use_cstd_abi"; then
+              func_append postdeps ' -library=Cstd -library=Crun'
+            fi
+            ;;
+          esac
+          ;;
+        esac
+      }
+
       # Last step: remove runtime libs from dependency_libs
       # (they stay in deplibs)
       tmp_libs=
-      for i in $dependency_libs ; do
+      for i in $dependency_libs; do
 	case " $predeps $postdeps $compiler_lib_search_path " in
 	*" $i "*)
-	  i=""
+	  i=
 	  ;;
 	esac
-	if test -n "$i" ; then
+	if test -n "$i"; then
 	  func_append tmp_libs " $i"
 	fi
       done
       dependency_libs=$tmp_libs
     done # for pass
-    if test "$linkmode" = prog; then
-      dlfiles="$newdlfiles"
+    if test prog = "$linkmode"; then
+      dlfiles=$newdlfiles
     fi
-    if test "$linkmode" = prog || test "$linkmode" = lib; then
-      dlprefiles="$newdlprefiles"
+    if test prog = "$linkmode" || test lib = "$linkmode"; then
+      dlprefiles=$newdlprefiles
     fi
 
     case $linkmode in
     oldlib)
-      if test -n "$dlfiles$dlprefiles" || test "$dlself" != no; then
-	func_warning "\`-dlopen' is ignored for archives"
+      if test -n "$dlfiles$dlprefiles" || test no != "$dlself"; then
+	func_warning "'-dlopen' is ignored for archives"
       fi
 
       case " $deplibs" in
       *\ -l* | *\ -L*)
-	func_warning "\`-l' and \`-L' are ignored for archives" ;;
+	func_warning "'-l' and '-L' are ignored for archives" ;;
       esac
 
       test -n "$rpath" && \
-	func_warning "\`-rpath' is ignored for archives"
+	func_warning "'-rpath' is ignored for archives"
 
       test -n "$xrpath" && \
-	func_warning "\`-R' is ignored for archives"
+	func_warning "'-R' is ignored for archives"
 
       test -n "$vinfo" && \
-	func_warning "\`-version-info/-version-number' is ignored for archives"
+	func_warning "'-version-info/-version-number' is ignored for archives"
 
       test -n "$release" && \
-	func_warning "\`-release' is ignored for archives"
+	func_warning "'-release' is ignored for archives"
 
       test -n "$export_symbols$export_symbols_regex" && \
-	func_warning "\`-export-symbols' is ignored for archives"
+	func_warning "'-export-symbols' is ignored for archives"
 
       # Now set the variables for building old libraries.
       build_libtool_libs=no
-      oldlibs="$output"
+      oldlibs=$output
       func_append objs "$old_deplibs"
       ;;
 
     lib)
-      # Make sure we only generate libraries of the form `libNAME.la'.
+      # Make sure we only generate libraries of the form 'libNAME.la'.
       case $outputname in
       lib*)
 	func_stripname 'lib' '.la' "$outputname"
@@ -7235,10 +8722,10 @@ func_mode_link ()
 	eval libname=\"$libname_spec\"
 	;;
       *)
-	test "$module" = no && \
-	  func_fatal_help "libtool library \`$output' must begin with \`lib'"
+	test no = "$module" \
+	  && func_fatal_help "libtool library '$output' must begin with 'lib'"
 
-	if test "$need_lib_prefix" != no; then
+	if test no != "$need_lib_prefix"; then
 	  # Add the "lib" prefix for modules if required
 	  func_stripname '' '.la' "$outputname"
 	  name=$func_stripname_result
@@ -7252,8 +8739,8 @@ func_mode_link ()
       esac
 
       if test -n "$objs"; then
-	if test "$deplibs_check_method" != pass_all; then
-	  func_fatal_error "cannot build libtool library \`$output' from non-libtool objects on this host:$objs"
+	if test pass_all != "$deplibs_check_method"; then
+	  func_fatal_error "cannot build libtool library '$output' from non-libtool objects on this host:$objs"
 	else
 	  echo
 	  $ECHO "*** Warning: Linking the shared library $output against the non-libtool"
@@ -7262,21 +8749,21 @@ func_mode_link ()
 	fi
       fi
 
-      test "$dlself" != no && \
-	func_warning "\`-dlopen self' is ignored for libtool libraries"
+      test no = "$dlself" \
+	|| func_warning "'-dlopen self' is ignored for libtool libraries"
 
       set dummy $rpath
       shift
-      test "$#" -gt 1 && \
-	func_warning "ignoring multiple \`-rpath's for a libtool library"
+      test 1 -lt "$#" \
+	&& func_warning "ignoring multiple '-rpath's for a libtool library"
 
-      install_libdir="$1"
+      install_libdir=$1
 
       oldlibs=
       if test -z "$rpath"; then
-	if test "$build_libtool_libs" = yes; then
+	if test yes = "$build_libtool_libs"; then
 	  # Building a libtool convenience library.
-	  # Some compilers have problems with a `.al' extension so
+	  # Some compilers have problems with a '.al' extension so
 	  # convenience libraries should have the same extension an
 	  # archive normally would.
 	  oldlibs="$output_objdir/$libname.$libext $oldlibs"
@@ -7285,20 +8772,20 @@ func_mode_link ()
 	fi
 
 	test -n "$vinfo" && \
-	  func_warning "\`-version-info/-version-number' is ignored for convenience libraries"
+	  func_warning "'-version-info/-version-number' is ignored for convenience libraries"
 
 	test -n "$release" && \
-	  func_warning "\`-release' is ignored for convenience libraries"
+	  func_warning "'-release' is ignored for convenience libraries"
       else
 
 	# Parse the version information argument.
-	save_ifs="$IFS"; IFS=':'
+	save_ifs=$IFS; IFS=:
 	set dummy $vinfo 0 0 0
 	shift
-	IFS="$save_ifs"
+	IFS=$save_ifs
 
 	test -n "$7" && \
-	  func_fatal_help "too many parameters to \`-version-info'"
+	  func_fatal_help "too many parameters to '-version-info'"
 
 	# convert absolute version numbers to libtool ages
 	# this retains compatibility with .la files and attempts
@@ -7306,41 +8793,42 @@ func_mode_link ()
 
 	case $vinfo_number in
 	yes)
-	  number_major="$1"
-	  number_minor="$2"
-	  number_revision="$3"
+	  number_major=$1
+	  number_minor=$2
+	  number_revision=$3
 	  #
 	  # There are really only two kinds -- those that
 	  # use the current revision as the major version
 	  # and those that subtract age and use age as
 	  # a minor version.  But, then there is irix
-	  # which has an extra 1 added just for fun
+	  # that has an extra 1 added just for fun
 	  #
 	  case $version_type in
-	  darwin|linux|osf|windows|none)
+	  # correct linux to gnu/linux during the next big refactor
+	  darwin|freebsd-elf|linux|osf|windows|none)
 	    func_arith $number_major + $number_minor
 	    current=$func_arith_result
-	    age="$number_minor"
-	    revision="$number_revision"
+	    age=$number_minor
+	    revision=$number_revision
 	    ;;
-	  freebsd-aout|freebsd-elf|qnx|sunos)
-	    current="$number_major"
-	    revision="$number_minor"
-	    age="0"
+	  freebsd-aout|qnx|sunos)
+	    current=$number_major
+	    revision=$number_minor
+	    age=0
 	    ;;
 	  irix|nonstopux)
 	    func_arith $number_major + $number_minor
 	    current=$func_arith_result
-	    age="$number_minor"
-	    revision="$number_minor"
+	    age=$number_minor
+	    revision=$number_minor
 	    lt_irix_increment=no
 	    ;;
 	  esac
 	  ;;
 	no)
-	  current="$1"
-	  revision="$2"
-	  age="$3"
+	  current=$1
+	  revision=$2
+	  age=$3
 	  ;;
 	esac
 
@@ -7348,30 +8836,30 @@ func_mode_link ()
 	case $current in
 	0|[1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-9][0-9][0-9][0-9][0-9]) ;;
 	*)
-	  func_error "CURRENT \`$current' must be a nonnegative integer"
-	  func_fatal_error "\`$vinfo' is not valid version information"
+	  func_error "CURRENT '$current' must be a nonnegative integer"
+	  func_fatal_error "'$vinfo' is not valid version information"
 	  ;;
 	esac
 
 	case $revision in
 	0|[1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-9][0-9][0-9][0-9][0-9]) ;;
 	*)
-	  func_error "REVISION \`$revision' must be a nonnegative integer"
-	  func_fatal_error "\`$vinfo' is not valid version information"
+	  func_error "REVISION '$revision' must be a nonnegative integer"
+	  func_fatal_error "'$vinfo' is not valid version information"
 	  ;;
 	esac
 
 	case $age in
 	0|[1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-9][0-9][0-9][0-9][0-9]) ;;
 	*)
-	  func_error "AGE \`$age' must be a nonnegative integer"
-	  func_fatal_error "\`$vinfo' is not valid version information"
+	  func_error "AGE '$age' must be a nonnegative integer"
+	  func_fatal_error "'$vinfo' is not valid version information"
 	  ;;
 	esac
 
 	if test "$age" -gt "$current"; then
-	  func_error "AGE \`$age' is greater than the current interface number \`$current'"
-	  func_fatal_error "\`$vinfo' is not valid version information"
+	  func_error "AGE '$age' is greater than the current interface number '$current'"
+	  func_fatal_error "'$vinfo' is not valid version information"
 	fi
 
 	# Calculate the version variables.
@@ -7386,26 +8874,36 @@ func_mode_link ()
 	  # verstring for coding it into the library header
 	  func_arith $current - $age
 	  major=.$func_arith_result
-	  versuffix="$major.$age.$revision"
+	  versuffix=$major.$age.$revision
 	  # Darwin ld doesn't like 0 for these options...
 	  func_arith $current + 1
 	  minor_current=$func_arith_result
-	  xlcverstring="${wl}-compatibility_version ${wl}$minor_current ${wl}-current_version ${wl}$minor_current.$revision"
+	  xlcverstring="$wl-compatibility_version $wl$minor_current $wl-current_version $wl$minor_current.$revision"
 	  verstring="-compatibility_version $minor_current -current_version $minor_current.$revision"
+          # On Darwin other compilers
+          case $CC in
+              nagfor*)
+                  verstring="$wl-compatibility_version $wl$minor_current $wl-current_version $wl$minor_current.$revision"
+                  ;;
+              *)
+                  verstring="-compatibility_version $minor_current -current_version $minor_current.$revision"
+                  ;;
+          esac
 	  ;;
 
 	freebsd-aout)
-	  major=".$current"
-	  versuffix=".$current.$revision";
+	  major=.$current
+	  versuffix=.$current.$revision
 	  ;;
 
 	freebsd-elf)
-	  major=".$current"
-	  versuffix=".$current"
+	  func_arith $current - $age
+	  major=.$func_arith_result
+	  versuffix=$major.$age.$revision
 	  ;;
 
 	irix | nonstopux)
-	  if test "X$lt_irix_increment" = "Xno"; then
+	  if test no = "$lt_irix_increment"; then
 	    func_arith $current - $age
 	  else
 	    func_arith $current - $age + 1
@@ -7416,69 +8914,74 @@ func_mode_link ()
 	    nonstopux) verstring_prefix=nonstopux ;;
 	    *)         verstring_prefix=sgi ;;
 	  esac
-	  verstring="$verstring_prefix$major.$revision"
+	  verstring=$verstring_prefix$major.$revision
 
 	  # Add in all the interfaces that we are compatible with.
 	  loop=$revision
-	  while test "$loop" -ne 0; do
+	  while test 0 -ne "$loop"; do
 	    func_arith $revision - $loop
 	    iface=$func_arith_result
 	    func_arith $loop - 1
 	    loop=$func_arith_result
-	    verstring="$verstring_prefix$major.$iface:$verstring"
+	    verstring=$verstring_prefix$major.$iface:$verstring
 	  done
 
-	  # Before this point, $major must not contain `.'.
+	  # Before this point, $major must not contain '.'.
 	  major=.$major
-	  versuffix="$major.$revision"
+	  versuffix=$major.$revision
 	  ;;
 
-	linux)
+	linux) # correct to gnu/linux during the next big refactor
 	  func_arith $current - $age
 	  major=.$func_arith_result
-	  versuffix="$major.$age.$revision"
+	  versuffix=$major.$age.$revision
 	  ;;
 
 	osf)
 	  func_arith $current - $age
 	  major=.$func_arith_result
-	  versuffix=".$current.$age.$revision"
-	  verstring="$current.$age.$revision"
+	  versuffix=.$current.$age.$revision
+	  verstring=$current.$age.$revision
 
 	  # Add in all the interfaces that we are compatible with.
 	  loop=$age
-	  while test "$loop" -ne 0; do
+	  while test 0 -ne "$loop"; do
 	    func_arith $current - $loop
 	    iface=$func_arith_result
 	    func_arith $loop - 1
 	    loop=$func_arith_result
-	    verstring="$verstring:${iface}.0"
+	    verstring=$verstring:$iface.0
 	  done
 
 	  # Make executables depend on our current version.
-	  func_append verstring ":${current}.0"
+	  func_append verstring ":$current.0"
 	  ;;
 
 	qnx)
-	  major=".$current"
-	  versuffix=".$current"
+	  major=.$current
+	  versuffix=.$current
+	  ;;
+
+	sco)
+	  major=.$current
+	  versuffix=.$current
 	  ;;
 
 	sunos)
-	  major=".$current"
-	  versuffix=".$current.$revision"
+	  major=.$current
+	  versuffix=.$current.$revision
 	  ;;
 
 	windows)
 	  # Use '-' rather than '.', since we only want one
-	  # extension on DOS 8.3 filesystems.
+	  # extension on DOS 8.3 file systems.
 	  func_arith $current - $age
 	  major=$func_arith_result
-	  versuffix="-$major"
+	  versuffix=-$major
 	  ;;
 
 	*)
-	  func_fatal_configuration "unknown library version type \`$version_type'"
+	  func_fatal_configuration "unknown library version type '$version_type'"
 	  ;;
 	esac
 
@@ -7492,42 +8995,45 @@ func_mode_link ()
 	    verstring=
 	    ;;
 	  *)
-	    verstring="0.0"
+	    verstring=0.0
 	    ;;
 	  esac
-	  if test "$need_version" = no; then
+	  if test no = "$need_version"; then
 	    versuffix=
 	  else
-	    versuffix=".0.0"
+	    versuffix=.0.0
 	  fi
 	fi
 
 	# Remove version info from name if versioning should be avoided
-	if test "$avoid_version" = yes && test "$need_version" = no; then
+	if test yes,no = "$avoid_version,$need_version"; then
 	  major=
 	  versuffix=
-	  verstring=""
+	  verstring=
 	fi
 
 	# Check to see if the archive will have undefined symbols.
-	if test "$allow_undefined" = yes; then
-	  if test "$allow_undefined_flag" = unsupported; then
-	    func_warning "undefined symbols not allowed in $host shared libraries"
-	    build_libtool_libs=no
-	    build_old_libs=yes
+	if test yes = "$allow_undefined"; then
+	  if test unsupported = "$allow_undefined_flag"; then
+	    if test yes = "$build_old_libs"; then
+	      func_warning "undefined symbols not allowed in $host shared libraries; building static only"
+	      build_libtool_libs=no
+	    else
+	      func_fatal_error "can't build $host shared library unless -no-undefined is specified"
+	    fi
 	  fi
 	else
 	  # Don't allow undefined symbols.
-	  allow_undefined_flag="$no_undefined_flag"
+	  allow_undefined_flag=$no_undefined_flag
 	fi
 
       fi
 
-      func_generate_dlsyms "$libname" "$libname" "yes"
+      func_generate_dlsyms "$libname" "$libname" :
       func_append libobjs " $symfileobj"
-      test "X$libobjs" = "X " && libobjs=
+      test " " = "$libobjs" && libobjs=
 
-      if test "$opt_mode" != relink; then
+      if test relink != "$opt_mode"; then
 	# Remove our outputs, but don't remove object files since they
 	# may have been created when compiling PIC objects.
 	removelist=
@@ -7536,8 +9042,8 @@ func_mode_link ()
 	  case $p in
 	    *.$objext | *.gcno)
 	       ;;
-	    $output_objdir/$outputname | $output_objdir/$libname.* | $output_objdir/${libname}${release}.*)
-	       if test "X$precious_files_regex" != "X"; then
+	    $output_objdir/$outputname | $output_objdir/$libname.* | $output_objdir/$libname$release.*)
+	       if test -n "$precious_files_regex"; then
 		 if $ECHO "$p" | $EGREP -e "$precious_files_regex" >/dev/null 2>&1
 		 then
 		   continue
@@ -7553,11 +9059,11 @@ func_mode_link ()
       fi
 
       # Now set the variables for building old libraries.
-      if test "$build_old_libs" = yes && test "$build_libtool_libs" != convenience ; then
+      if test yes = "$build_old_libs" && test convenience != "$build_libtool_libs"; then
 	func_append oldlibs " $output_objdir/$libname.$libext"
 
 	# Transform .lo files to .o files.
-	oldobjs="$objs "`$ECHO "$libobjs" | $SP2NL | $SED "/\.${libext}$/d; $lo2o" | $NL2SP`
+	oldobjs="$objs "`$ECHO "$libobjs" | $SP2NL | $SED "/\.$libext$/d; $lo2o" | $NL2SP`
       fi
 
       # Eliminate all temporary directories.
@@ -7578,13 +9084,13 @@ func_mode_link ()
 	  *) func_append finalize_rpath " $libdir" ;;
 	  esac
 	done
-	if test "$hardcode_into_libs" != yes || test "$build_old_libs" = yes; then
+	if test yes != "$hardcode_into_libs" || test yes = "$build_old_libs"; then
 	  dependency_libs="$temp_xrpath $dependency_libs"
 	fi
       fi
 
       # Make sure dlfiles contains only unique files that won't be dlpreopened
-      old_dlfiles="$dlfiles"
+      old_dlfiles=$dlfiles
       dlfiles=
       for lib in $old_dlfiles; do
 	case " $dlprefiles $dlfiles " in
@@ -7594,7 +9100,7 @@ func_mode_link ()
       done
 
       # Make sure dlprefiles contains only unique files
-      old_dlprefiles="$dlprefiles"
+      old_dlprefiles=$dlprefiles
       dlprefiles=
       for lib in $old_dlprefiles; do
 	case "$dlprefiles " in
@@ -7603,7 +9109,7 @@ func_mode_link ()
 	esac
       done
 
-      if test "$build_libtool_libs" = yes; then
+      if test yes = "$build_libtool_libs"; then
 	if test -n "$rpath"; then
 	  case $host in
 	  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-beos* | *-cegcc* | *-*-haiku*)
@@ -7627,7 +9133,7 @@ func_mode_link ()
 	    ;;
 	  *)
 	    # Add libc to deplibs on all other systems if necessary.
-	    if test "$build_libtool_need_lc" = "yes"; then
+	    if test yes = "$build_libtool_need_lc"; then
 	      func_append deplibs " -lc"
 	    fi
 	    ;;
@@ -7643,9 +9149,9 @@ func_mode_link ()
 	# I'm not sure if I'm treating the release correctly.  I think
 	# release should show up in the -l (ie -lgmp5) so we don't want to
 	# add it in twice.  Is that correct?
-	release=""
-	versuffix=""
-	major=""
+	release=
+	versuffix=
+	major=
 	newdeplibs=
 	droppeddeps=no
 	case $deplibs_check_method in
@@ -7674,20 +9180,20 @@ EOF
 	      -l*)
 		func_stripname -l '' "$i"
 		name=$func_stripname_result
-		if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
+		if test yes = "$allow_libtool_libs_with_static_runtimes"; then
 		  case " $predeps $postdeps " in
 		  *" $i "*)
 		    func_append newdeplibs " $i"
-		    i=""
+		    i=
 		    ;;
 		  esac
 		fi
-		if test -n "$i" ; then
+		if test -n "$i"; then
 		  libname=`eval "\\$ECHO \"$libname_spec\""`
 		  deplib_matches=`eval "\\$ECHO \"$library_names_spec\""`
 		  set dummy $deplib_matches; shift
 		  deplib_match=$1
-		  if test `expr "$ldd_output" : ".*$deplib_match"` -ne 0 ; then
+		  if test `expr "$ldd_output" : ".*$deplib_match"` -ne 0; then
 		    func_append newdeplibs " $i"
 		  else
 		    droppeddeps=yes
@@ -7717,20 +9223,20 @@ EOF
 		$opt_dry_run || $RM conftest
 		if $LTCC $LTCFLAGS -o conftest conftest.c $i; then
 		  ldd_output=`ldd conftest`
-		  if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
+		  if test yes = "$allow_libtool_libs_with_static_runtimes"; then
 		    case " $predeps $postdeps " in
 		    *" $i "*)
 		      func_append newdeplibs " $i"
-		      i=""
+		      i=
 		      ;;
 		    esac
 		  fi
-		  if test -n "$i" ; then
+		  if test -n "$i"; then
 		    libname=`eval "\\$ECHO \"$libname_spec\""`
 		    deplib_matches=`eval "\\$ECHO \"$library_names_spec\""`
 		    set dummy $deplib_matches; shift
 		    deplib_match=$1
-		    if test `expr "$ldd_output" : ".*$deplib_match"` -ne 0 ; then
+		    if test `expr "$ldd_output" : ".*$deplib_match"` -ne 0; then
 		      func_append newdeplibs " $i"
 		    else
 		      droppeddeps=yes
@@ -7767,24 +9273,24 @@ EOF
 	    -l*)
 	      func_stripname -l '' "$a_deplib"
 	      name=$func_stripname_result
-	      if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
+	      if test yes = "$allow_libtool_libs_with_static_runtimes"; then
 		case " $predeps $postdeps " in
 		*" $a_deplib "*)
 		  func_append newdeplibs " $a_deplib"
-		  a_deplib=""
+		  a_deplib=
 		  ;;
 		esac
 	      fi
-	      if test -n "$a_deplib" ; then
+	      if test -n "$a_deplib"; then
 		libname=`eval "\\$ECHO \"$libname_spec\""`
 		if test -n "$file_magic_glob"; then
 		  libnameglob=`func_echo_all "$libname" | $SED -e $file_magic_glob`
 		else
 		  libnameglob=$libname
 		fi
-		test "$want_nocaseglob" = yes && nocaseglob=`shopt -p nocaseglob`
+		test yes = "$want_nocaseglob" && nocaseglob=`shopt -p nocaseglob`
 		for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
-		  if test "$want_nocaseglob" = yes; then
+		  if test yes = "$want_nocaseglob"; then
 		    shopt -s nocaseglob
 		    potential_libs=`ls $i/$libnameglob[.-]* 2>/dev/null`
 		    $nocaseglob
@@ -7802,25 +9308,25 @@ EOF
 		      # We might still enter an endless loop, since a link
 		      # loop can be closed while we follow links,
 		      # but so what?
-		      potlib="$potent_lib"
+		      potlib=$potent_lib
 		      while test -h "$potlib" 2>/dev/null; do
-			potliblink=`ls -ld $potlib | ${SED} 's/.* -> //'`
+			potliblink=`ls -ld $potlib | $SED 's/.* -> //'`
 			case $potliblink in
-			[\\/]* | [A-Za-z]:[\\/]*) potlib="$potliblink";;
-			*) potlib=`$ECHO "$potlib" | $SED 's,[^/]*$,,'`"$potliblink";;
+			[\\/]* | [A-Za-z]:[\\/]*) potlib=$potliblink;;
+			*) potlib=`$ECHO "$potlib" | $SED 's|[^/]*$||'`"$potliblink";;
 			esac
 		      done
 		      if eval $file_magic_cmd \"\$potlib\" 2>/dev/null |
 			 $SED -e 10q |
 			 $EGREP "$file_magic_regex" > /dev/null; then
 			func_append newdeplibs " $a_deplib"
-			a_deplib=""
+			a_deplib=
 			break 2
 		      fi
 		  done
 		done
 	      fi
-	      if test -n "$a_deplib" ; then
+	      if test -n "$a_deplib"; then
 		droppeddeps=yes
 		echo
 		$ECHO "*** Warning: linker path does not have real file for library $a_deplib."
@@ -7828,7 +9334,7 @@ EOF
 		echo "*** you link to this library.  But I can only do this if you have a"
 		echo "*** shared version of the library, which you do not appear to have"
 		echo "*** because I did check the linker path looking for a file starting"
-		if test -z "$potlib" ; then
+		if test -z "$potlib"; then
 		  $ECHO "*** with $libname but no candidates were found. (...for file magic test)"
 		else
 		  $ECHO "*** with $libname and none of the candidates passed a file format test"
@@ -7851,30 +9357,30 @@ EOF
 	    -l*)
 	      func_stripname -l '' "$a_deplib"
 	      name=$func_stripname_result
-	      if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
+	      if test yes = "$allow_libtool_libs_with_static_runtimes"; then
 		case " $predeps $postdeps " in
 		*" $a_deplib "*)
 		  func_append newdeplibs " $a_deplib"
-		  a_deplib=""
+		  a_deplib=
 		  ;;
 		esac
 	      fi
-	      if test -n "$a_deplib" ; then
+	      if test -n "$a_deplib"; then
 		libname=`eval "\\$ECHO \"$libname_spec\""`
 		for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
 		  potential_libs=`ls $i/$libname[.-]* 2>/dev/null`
 		  for potent_lib in $potential_libs; do
-		    potlib="$potent_lib" # see symlink-check above in file_magic test
+		    potlib=$potent_lib # see symlink-check above in file_magic test
 		    if eval "\$ECHO \"$potent_lib\"" 2>/dev/null | $SED 10q | \
 		       $EGREP "$match_pattern_regex" > /dev/null; then
 		      func_append newdeplibs " $a_deplib"
-		      a_deplib=""
+		      a_deplib=
 		      break 2
 		    fi
 		  done
 		done
 	      fi
-	      if test -n "$a_deplib" ; then
+	      if test -n "$a_deplib"; then
 		droppeddeps=yes
 		echo
 		$ECHO "*** Warning: linker path does not have real file for library $a_deplib."
@@ -7882,7 +9388,7 @@ EOF
 		echo "*** you link to this library.  But I can only do this if you have a"
 		echo "*** shared version of the library, which you do not appear to have"
 		echo "*** because I did check the linker path looking for a file starting"
-		if test -z "$potlib" ; then
+		if test -z "$potlib"; then
 		  $ECHO "*** with $libname but no candidates were found. (...for regex pattern test)"
 		else
 		  $ECHO "*** with $libname and none of the candidates passed a file format test"
@@ -7898,18 +9404,18 @@ EOF
 	  done # Gone through all deplibs.
 	  ;;
 	none | unknown | *)
-	  newdeplibs=""
+	  newdeplibs=
 	  tmp_deplibs=`$ECHO " $deplibs" | $SED 's/ -lc$//; s/ -[LR][^ ]*//g'`
-	  if test "X$allow_libtool_libs_with_static_runtimes" = "Xyes" ; then
-	    for i in $predeps $postdeps ; do
+	  if test yes = "$allow_libtool_libs_with_static_runtimes"; then
+	    for i in $predeps $postdeps; do
 	      # can't use Xsed below, because $i might contain '/'
-	      tmp_deplibs=`$ECHO " $tmp_deplibs" | $SED "s,$i,,"`
+	      tmp_deplibs=`$ECHO " $tmp_deplibs" | $SED "s|$i||"`
 	    done
 	  fi
 	  case $tmp_deplibs in
 	  *[!\	\ ]*)
 	    echo
-	    if test "X$deplibs_check_method" = "Xnone"; then
+	    if test none = "$deplibs_check_method"; then
 	      echo "*** Warning: inter-library dependencies are not supported in this platform."
 	    else
 	      echo "*** Warning: inter-library dependencies are not known to be supported."
@@ -7933,8 +9439,8 @@ EOF
 	  ;;
 	esac
 
-	if test "$droppeddeps" = yes; then
-	  if test "$module" = yes; then
+	if test yes = "$droppeddeps"; then
+	  if test yes = "$module"; then
 	    echo
 	    echo "*** Warning: libtool could not satisfy all declared inter-library"
 	    $ECHO "*** dependencies of module $libname.  Therefore, libtool will create"
@@ -7943,12 +9449,12 @@ EOF
 	    if test -z "$global_symbol_pipe"; then
 	      echo
 	      echo "*** However, this would only work if libtool was able to extract symbol"
-	      echo "*** lists from a program, using \`nm' or equivalent, but libtool could"
+	      echo "*** lists from a program, using 'nm' or equivalent, but libtool could"
 	      echo "*** not find such a program.  So, this module is probably useless."
-	      echo "*** \`nm' from GNU binutils and a full rebuild may help."
+	      echo "*** 'nm' from GNU binutils and a full rebuild may help."
 	    fi
-	    if test "$build_old_libs" = no; then
-	      oldlibs="$output_objdir/$libname.$libext"
+	    if test no = "$build_old_libs"; then
+	      oldlibs=$output_objdir/$libname.$libext
 	      build_libtool_libs=module
 	      build_old_libs=yes
 	    else
@@ -7959,14 +9465,14 @@ EOF
 	    echo "*** automatically added whenever a program is linked with this library"
 	    echo "*** or is declared to -dlopen it."
 
-	    if test "$allow_undefined" = no; then
+	    if test no = "$allow_undefined"; then
 	      echo
 	      echo "*** Since this library must not contain undefined symbols,"
 	      echo "*** because either the platform does not support them or"
 	      echo "*** it was explicitly requested with -no-undefined,"
 	      echo "*** libtool will only create a static version of it."
-	      if test "$build_old_libs" = no; then
-		oldlibs="$output_objdir/$libname.$libext"
+	      if test no = "$build_old_libs"; then
+		oldlibs=$output_objdir/$libname.$libext
 		build_libtool_libs=module
 		build_old_libs=yes
 	      else
@@ -8012,7 +9518,7 @@ EOF
 	*) func_append new_libs " $deplib" ;;
 	esac
       done
-      deplibs="$new_libs"
+      deplibs=$new_libs
 
       # All the library-specific variables (install_libdir is set above).
       library_names=
@@ -8020,20 +9526,25 @@ EOF
       dlname=
 
       # Test again, we may have decided not to build it any more
-      if test "$build_libtool_libs" = yes; then
-	if test "$hardcode_into_libs" = yes; then
+      if test yes = "$build_libtool_libs"; then
+	# Remove $wl instances when linking with ld.
+	# FIXME: should test the right _cmds variable.
+	case $archive_cmds in
+	  *\$LD\ *) wl= ;;
+        esac
+	if test yes = "$hardcode_into_libs"; then
 	  # Hardcode the library paths
 	  hardcode_libdirs=
 	  dep_rpath=
-	  rpath="$finalize_rpath"
-	  test "$opt_mode" != relink && rpath="$compile_rpath$rpath"
+	  rpath=$finalize_rpath
+	  test relink = "$opt_mode" || rpath=$compile_rpath$rpath
 	  for libdir in $rpath; do
 	    if test -n "$hardcode_libdir_flag_spec"; then
 	      if test -n "$hardcode_libdir_separator"; then
 		func_replace_sysroot "$libdir"
 		libdir=$func_replace_sysroot_result
 		if test -z "$hardcode_libdirs"; then
-		  hardcode_libdirs="$libdir"
+		  hardcode_libdirs=$libdir
 		else
 		  # Just accumulate the unique libdirs.
 		  case $hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator in
@@ -8058,12 +9569,8 @@ EOF
 	  # Substitute the hardcoded libdirs into the rpath.
 	  if test -n "$hardcode_libdir_separator" &&
 	     test -n "$hardcode_libdirs"; then
-	    libdir="$hardcode_libdirs"
-	    if test -n "$hardcode_libdir_flag_spec_ld"; then
-	      eval dep_rpath=\"$hardcode_libdir_flag_spec_ld\"
-	    else
-	      eval dep_rpath=\"$hardcode_libdir_flag_spec\"
-	    fi
+	    libdir=$hardcode_libdirs
+	    eval "dep_rpath=\"$hardcode_libdir_flag_spec\""
 	  fi
 	  if test -n "$runpath_var" && test -n "$perm_rpath"; then
 	    # We should set the runpath_var.
@@ -8076,8 +9583,8 @@ EOF
 	  test -n "$dep_rpath" && deplibs="$dep_rpath $deplibs"
 	fi
 
-	shlibpath="$finalize_shlibpath"
-	test "$opt_mode" != relink && shlibpath="$compile_shlibpath$shlibpath"
+	shlibpath=$finalize_shlibpath
+	test relink = "$opt_mode" || shlibpath=$compile_shlibpath$shlibpath
 	if test -n "$shlibpath"; then
 	  eval "$shlibpath_var='$shlibpath\$$shlibpath_var'; export $shlibpath_var"
 	fi
@@ -8087,19 +9594,19 @@ EOF
 	eval library_names=\"$library_names_spec\"
 	set dummy $library_names
 	shift
-	realname="$1"
+	realname=$1
 	shift
 
 	if test -n "$soname_spec"; then
 	  eval soname=\"$soname_spec\"
 	else
-	  soname="$realname"
+	  soname=$realname
 	fi
 	if test -z "$dlname"; then
 	  dlname=$soname
 	fi
 
-	lib="$output_objdir/$realname"
+	lib=$output_objdir/$realname
 	linknames=
 	for link
 	do
@@ -8113,7 +9620,7 @@ EOF
 	delfiles=
 	if test -n "$export_symbols" && test -n "$include_expsyms"; then
 	  $opt_dry_run || cp "$export_symbols" "$output_objdir/$libname.uexp"
-	  export_symbols="$output_objdir/$libname.uexp"
+	  export_symbols=$output_objdir/$libname.uexp
 	  func_append delfiles " $export_symbols"
 	fi
 
@@ -8122,31 +9629,31 @@ EOF
 	cygwin* | mingw* | cegcc*)
 	  if test -n "$export_symbols" && test -z "$export_symbols_regex"; then
 	    # exporting using user supplied symfile
-	    if test "x`$SED 1q $export_symbols`" != xEXPORTS; then
+	    func_dll_def_p "$export_symbols" || {
 	      # and it's NOT already a .def file. Must figure out
 	      # which of the given symbols are data symbols and tag
 	      # them as such. So, trigger use of export_symbols_cmds.
 	      # export_symbols gets reassigned inside the "prepare
 	      # the list of exported symbols" if statement, so the
 	      # include_expsyms logic still works.
-	      orig_export_symbols="$export_symbols"
+	      orig_export_symbols=$export_symbols
 	      export_symbols=
 	      always_export_symbols=yes
-	    fi
+	    }
 	  fi
 	  ;;
 	esac
 
 	# Prepare the list of exported symbols
 	if test -z "$export_symbols"; then
-	  if test "$always_export_symbols" = yes || test -n "$export_symbols_regex"; then
-	    func_verbose "generating symbol list for \`$libname.la'"
-	    export_symbols="$output_objdir/$libname.exp"
+	  if test yes = "$always_export_symbols" || test -n "$export_symbols_regex"; then
+	    func_verbose "generating symbol list for '$libname.la'"
+	    export_symbols=$output_objdir/$libname.exp
 	    $opt_dry_run || $RM $export_symbols
 	    cmds=$export_symbols_cmds
-	    save_ifs="$IFS"; IFS='~'
+	    save_ifs=$IFS; IFS='~'
 	    for cmd1 in $cmds; do
-	      IFS="$save_ifs"
+	      IFS=$save_ifs
 	      # Take the normal branch if the nm_file_list_spec branch
 	      # doesn't work or if tool conversion is not needed.
 	      case $nm_file_list_spec~$to_tool_file_cmd in
@@ -8160,7 +9667,7 @@ EOF
 		  try_normal_branch=no
 		  ;;
 	      esac
-	      if test "$try_normal_branch" = yes \
+	      if test yes = "$try_normal_branch" \
 		 && { test "$len" -lt "$max_cmd_len" \
 		      || test "$max_cmd_len" -le -1; }
 	      then
@@ -8171,7 +9678,7 @@ EOF
 		output_la=$func_basename_result
 		save_libobjs=$libobjs
 		save_output=$output
-		output=${output_objdir}/${output_la}.nm
+		output=$output_objdir/$output_la.nm
 		func_to_tool_file "$output"
 		libobjs=$nm_file_list_spec$func_to_tool_file_result
 		func_append delfiles " $output"
@@ -8194,8 +9701,8 @@ EOF
 		break
 	      fi
 	    done
-	    IFS="$save_ifs"
-	    if test -n "$export_symbols_regex" && test "X$skipped_export" != "X:"; then
+	    IFS=$save_ifs
+	    if test -n "$export_symbols_regex" && test : != "$skipped_export"; then
 	      func_show_eval '$EGREP -e "$export_symbols_regex" "$export_symbols" > "${export_symbols}T"'
 	      func_show_eval '$MV "${export_symbols}T" "$export_symbols"'
 	    fi
@@ -8203,16 +9710,16 @@ EOF
 	fi
 
 	if test -n "$export_symbols" && test -n "$include_expsyms"; then
-	  tmp_export_symbols="$export_symbols"
-	  test -n "$orig_export_symbols" && tmp_export_symbols="$orig_export_symbols"
+	  tmp_export_symbols=$export_symbols
+	  test -n "$orig_export_symbols" && tmp_export_symbols=$orig_export_symbols
 	  $opt_dry_run || eval '$ECHO "$include_expsyms" | $SP2NL >> "$tmp_export_symbols"'
 	fi
 
-	if test "X$skipped_export" != "X:" && test -n "$orig_export_symbols"; then
+	if test : != "$skipped_export" && test -n "$orig_export_symbols"; then
 	  # The given exports_symbols file has to be filtered, so filter it.
-	  func_verbose "filter symbol list for \`$libname.la' to tag DATA exports"
+	  func_verbose "filter symbol list for '$libname.la' to tag DATA exports"
 	  # FIXME: $output_objdir/$libname.filter potentially contains lots of
-	  # 's' commands which not all seds can handle. GNU sed should be fine
+	  # 's' commands, which not all seds can handle. GNU sed should be fine
 	  # though. Also, the filter scales superlinearly with the number of
 	  # global variables. join(1) would be nice here, but unfortunately
 	  # isn't a blessed tool.
@@ -8231,11 +9738,11 @@ EOF
 	    ;;
 	  esac
 	done
-	deplibs="$tmp_deplibs"
+	deplibs=$tmp_deplibs
 
 	if test -n "$convenience"; then
 	  if test -n "$whole_archive_flag_spec" &&
-	    test "$compiler_needs_object" = yes &&
+	    test yes = "$compiler_needs_object" &&
 	    test -z "$libobjs"; then
 	    # extract the archives, so we have objects to list.
 	    # TODO: could optimize this to just extract one archive.
@@ -8246,7 +9753,7 @@ EOF
 	    eval libobjs=\"\$libobjs $whole_archive_flag_spec\"
 	    test "X$libobjs" = "X " && libobjs=
 	  else
-	    gentop="$output_objdir/${outputname}x"
+	    gentop=$output_objdir/${outputname}x
 	    func_append generated " $gentop"
 
 	    func_extract_archives $gentop $convenience
@@ -8255,18 +9762,18 @@ EOF
 	  fi
 	fi
 
-	if test "$thread_safe" = yes && test -n "$thread_safe_flag_spec"; then
+	if test yes = "$thread_safe" && test -n "$thread_safe_flag_spec"; then
 	  eval flag=\"$thread_safe_flag_spec\"
 	  func_append linker_flags " $flag"
 	fi
 
 	# Make a backup of the uninstalled library when relinking
-	if test "$opt_mode" = relink; then
+	if test relink = "$opt_mode"; then
 	  $opt_dry_run || eval '(cd $output_objdir && $RM ${realname}U && $MV $realname ${realname}U)' || exit $?
 	fi
 
 	# Do each of the archive commands.
-	if test "$module" = yes && test -n "$module_cmds" ; then
+	if test yes = "$module" && test -n "$module_cmds"; then
 	  if test -n "$export_symbols" && test -n "$module_expsym_cmds"; then
 	    eval test_cmds=\"$module_expsym_cmds\"
 	    cmds=$module_expsym_cmds
@@ -8284,7 +9791,7 @@ EOF
 	  fi
 	fi
 
-	if test "X$skipped_export" != "X:" &&
+	if test : != "$skipped_export" &&
 	   func_len " $test_cmds" &&
 	   len=$func_len_result &&
 	   test "$len" -lt "$max_cmd_len" || test "$max_cmd_len" -le -1; then
@@ -8317,8 +9824,8 @@ EOF
 	  last_robj=
 	  k=1
 
-	  if test -n "$save_libobjs" && test "X$skipped_export" != "X:" && test "$with_gnu_ld" = yes; then
-	    output=${output_objdir}/${output_la}.lnkscript
+	  if test -n "$save_libobjs" && test : != "$skipped_export" && test yes = "$with_gnu_ld"; then
+	    output=$output_objdir/$output_la.lnkscript
 	    func_verbose "creating GNU ld script: $output"
 	    echo 'INPUT (' > $output
 	    for obj in $save_libobjs
@@ -8330,14 +9837,14 @@ EOF
 	    func_append delfiles " $output"
 	    func_to_tool_file "$output"
 	    output=$func_to_tool_file_result
-	  elif test -n "$save_libobjs" && test "X$skipped_export" != "X:" && test "X$file_list_spec" != X; then
-	    output=${output_objdir}/${output_la}.lnk
+	  elif test -n "$save_libobjs" && test : != "$skipped_export" && test -n "$file_list_spec"; then
+	    output=$output_objdir/$output_la.lnk
 	    func_verbose "creating linker input file list: $output"
 	    : > $output
 	    set x $save_libobjs
 	    shift
 	    firstobj=
-	    if test "$compiler_needs_object" = yes; then
+	    if test yes = "$compiler_needs_object"; then
 	      firstobj="$1 "
 	      shift
 	    fi
@@ -8352,7 +9859,7 @@ EOF
 	  else
 	    if test -n "$save_libobjs"; then
 	      func_verbose "creating reloadable object files..."
-	      output=$output_objdir/$output_la-${k}.$objext
+	      output=$output_objdir/$output_la-$k.$objext
 	      eval test_cmds=\"$reload_cmds\"
 	      func_len " $test_cmds"
 	      len0=$func_len_result
@@ -8364,13 +9871,13 @@ EOF
 		func_len " $obj"
 		func_arith $len + $func_len_result
 		len=$func_arith_result
-		if test "X$objlist" = X ||
+		if test -z "$objlist" ||
 		   test "$len" -lt "$max_cmd_len"; then
 		  func_append objlist " $obj"
 		else
 		  # The command $test_cmds is almost too long, add a
 		  # command to the queue.
-		  if test "$k" -eq 1 ; then
+		  if test 1 -eq "$k"; then
 		    # The first file doesn't have a previous command to add.
 		    reload_objs=$objlist
 		    eval concat_cmds=\"$reload_cmds\"
@@ -8380,10 +9887,10 @@ EOF
 		    reload_objs="$objlist $last_robj"
 		    eval concat_cmds=\"\$concat_cmds~$reload_cmds~\$RM $last_robj\"
 		  fi
-		  last_robj=$output_objdir/$output_la-${k}.$objext
+		  last_robj=$output_objdir/$output_la-$k.$objext
 		  func_arith $k + 1
 		  k=$func_arith_result
-		  output=$output_objdir/$output_la-${k}.$objext
+		  output=$output_objdir/$output_la-$k.$objext
 		  objlist=" $obj"
 		  func_len " $last_robj"
 		  func_arith $len0 + $func_len_result
@@ -8395,9 +9902,9 @@ EOF
 	      # files will link in the last one created.
 	      test -z "$concat_cmds" || concat_cmds=$concat_cmds~
 	      reload_objs="$objlist $last_robj"
-	      eval concat_cmds=\"\${concat_cmds}$reload_cmds\"
+	      eval concat_cmds=\"\$concat_cmds$reload_cmds\"
 	      if test -n "$last_robj"; then
-	        eval concat_cmds=\"\${concat_cmds}~\$RM $last_robj\"
+	        eval concat_cmds=\"\$concat_cmds~\$RM $last_robj\"
 	      fi
 	      func_append delfiles " $output"
 
@@ -8405,9 +9912,9 @@ EOF
 	      output=
 	    fi
 
-	    if ${skipped_export-false}; then
-	      func_verbose "generating symbol list for \`$libname.la'"
-	      export_symbols="$output_objdir/$libname.exp"
+	    ${skipped_export-false} && {
+	      func_verbose "generating symbol list for '$libname.la'"
+	      export_symbols=$output_objdir/$libname.exp
 	      $opt_dry_run || $RM $export_symbols
 	      libobjs=$output
 	      # Append the command to create the export file.
@@ -8416,16 +9923,16 @@ EOF
 	      if test -n "$last_robj"; then
 		eval concat_cmds=\"\$concat_cmds~\$RM $last_robj\"
 	      fi
-	    fi
+	    }
 
 	    test -n "$save_libobjs" &&
 	      func_verbose "creating a temporary reloadable object file: $output"
 
 	    # Loop through the commands generated above and execute them.
-	    save_ifs="$IFS"; IFS='~'
+	    save_ifs=$IFS; IFS='~'
 	    for cmd in $concat_cmds; do
-	      IFS="$save_ifs"
-	      $opt_silent || {
+	      IFS=$save_ifs
+	      $opt_quiet || {
 		  func_quote_for_expand "$cmd"
 		  eval "func_echo $func_quote_for_expand_result"
 	      }
@@ -8433,7 +9940,7 @@ EOF
 		lt_exit=$?
 
 		# Restore the uninstalled library and exit
-		if test "$opt_mode" = relink; then
+		if test relink = "$opt_mode"; then
 		  ( cd "$output_objdir" && \
 		    $RM "${realname}T" && \
 		    $MV "${realname}U" "$realname" )
@@ -8442,7 +9949,7 @@ EOF
 		exit $lt_exit
 	      }
 	    done
-	    IFS="$save_ifs"
+	    IFS=$save_ifs
 
 	    if test -n "$export_symbols_regex" && ${skipped_export-false}; then
 	      func_show_eval '$EGREP -e "$export_symbols_regex" "$export_symbols" > "${export_symbols}T"'
@@ -8450,18 +9957,18 @@ EOF
 	    fi
 	  fi
 
-          if ${skipped_export-false}; then
+          ${skipped_export-false} && {
 	    if test -n "$export_symbols" && test -n "$include_expsyms"; then
-	      tmp_export_symbols="$export_symbols"
-	      test -n "$orig_export_symbols" && tmp_export_symbols="$orig_export_symbols"
+	      tmp_export_symbols=$export_symbols
+	      test -n "$orig_export_symbols" && tmp_export_symbols=$orig_export_symbols
 	      $opt_dry_run || eval '$ECHO "$include_expsyms" | $SP2NL >> "$tmp_export_symbols"'
 	    fi
 
 	    if test -n "$orig_export_symbols"; then
 	      # The given exports_symbols file has to be filtered, so filter it.
-	      func_verbose "filter symbol list for \`$libname.la' to tag DATA exports"
+	      func_verbose "filter symbol list for '$libname.la' to tag DATA exports"
 	      # FIXME: $output_objdir/$libname.filter potentially contains lots of
-	      # 's' commands which not all seds can handle. GNU sed should be fine
+	      # 's' commands, which not all seds can handle. GNU sed should be fine
 	      # though. Also, the filter scales superlinearly with the number of
 	      # global variables. join(1) would be nice here, but unfortunately
 	      # isn't a blessed tool.
@@ -8470,7 +9977,7 @@ EOF
 	      export_symbols=$output_objdir/$libname.def
 	      $opt_dry_run || $SED -f $output_objdir/$libname.filter < $orig_export_symbols > $export_symbols
 	    fi
-	  fi
+	  }
 
 	  libobjs=$output
 	  # Restore the value of output.
@@ -8484,7 +9991,7 @@ EOF
 	  # value of $libobjs for piecewise linking.
 
 	  # Do each of the archive commands.
-	  if test "$module" = yes && test -n "$module_cmds" ; then
+	  if test yes = "$module" && test -n "$module_cmds"; then
 	    if test -n "$export_symbols" && test -n "$module_expsym_cmds"; then
 	      cmds=$module_expsym_cmds
 	    else
@@ -8506,7 +10013,7 @@ EOF
 
 	# Add any objects from preloaded convenience libraries
 	if test -n "$dlprefiles"; then
-	  gentop="$output_objdir/${outputname}x"
+	  gentop=$output_objdir/${outputname}x
 	  func_append generated " $gentop"
 
 	  func_extract_archives $gentop $dlprefiles
@@ -8514,11 +10021,12 @@ EOF
 	  test "X$libobjs" = "X " && libobjs=
 	fi
 
-	save_ifs="$IFS"; IFS='~'
+	save_ifs=$IFS; IFS='~'
 	for cmd in $cmds; do
-	  IFS="$save_ifs"
+	  IFS=$sp$nl
 	  eval cmd=\"$cmd\"
-	  $opt_silent || {
+	  IFS=$save_ifs
+	  $opt_quiet || {
 	    func_quote_for_expand "$cmd"
 	    eval "func_echo $func_quote_for_expand_result"
 	  }
@@ -8526,7 +10034,7 @@ EOF
 	    lt_exit=$?
 
 	    # Restore the uninstalled library and exit
-	    if test "$opt_mode" = relink; then
+	    if test relink = "$opt_mode"; then
 	      ( cd "$output_objdir" && \
 	        $RM "${realname}T" && \
 		$MV "${realname}U" "$realname" )
@@ -8535,10 +10043,10 @@ EOF
 	    exit $lt_exit
 	  }
 	done
-	IFS="$save_ifs"
+	IFS=$save_ifs
 
 	# Restore the uninstalled library and exit
-	if test "$opt_mode" = relink; then
+	if test relink = "$opt_mode"; then
 	  $opt_dry_run || eval '(cd $output_objdir && $RM ${realname}T && $MV $realname ${realname}T && $MV ${realname}U $realname)' || exit $?
 
 	  if test -n "$convenience"; then
@@ -8558,39 +10066,39 @@ EOF
 	done
 
 	# If -module or -export-dynamic was specified, set the dlname.
-	if test "$module" = yes || test "$export_dynamic" = yes; then
+	if test yes = "$module" || test yes = "$export_dynamic"; then
 	  # On all known operating systems, these are identical.
-	  dlname="$soname"
+	  dlname=$soname
 	fi
       fi
       ;;
 
     obj)
-      if test -n "$dlfiles$dlprefiles" || test "$dlself" != no; then
-	func_warning "\`-dlopen' is ignored for objects"
+      if test -n "$dlfiles$dlprefiles" || test no != "$dlself"; then
+	func_warning "'-dlopen' is ignored for objects"
       fi
 
       case " $deplibs" in
       *\ -l* | *\ -L*)
-	func_warning "\`-l' and \`-L' are ignored for objects" ;;
+	func_warning "'-l' and '-L' are ignored for objects" ;;
       esac
 
       test -n "$rpath" && \
-	func_warning "\`-rpath' is ignored for objects"
+	func_warning "'-rpath' is ignored for objects"
 
       test -n "$xrpath" && \
-	func_warning "\`-R' is ignored for objects"
+	func_warning "'-R' is ignored for objects"
 
       test -n "$vinfo" && \
-	func_warning "\`-version-info' is ignored for objects"
+	func_warning "'-version-info' is ignored for objects"
 
       test -n "$release" && \
-	func_warning "\`-release' is ignored for objects"
+	func_warning "'-release' is ignored for objects"
 
       case $output in
       *.lo)
 	test -n "$objs$old_deplibs" && \
-	  func_fatal_error "cannot build library object \`$output' from non-libtool objects"
+	  func_fatal_error "cannot build library object '$output' from non-libtool objects"
 
 	libobj=$output
 	func_lo2o "$libobj"
@@ -8598,7 +10106,7 @@ EOF
 	;;
       *)
 	libobj=
-	obj="$output"
+	obj=$output
 	;;
       esac
 
@@ -8611,17 +10119,19 @@ EOF
       # the extraction.
       reload_conv_objs=
       gentop=
-      # reload_cmds runs $LD directly, so let us get rid of
-      # -Wl from whole_archive_flag_spec and hope we can get by with
-      # turning comma into space..
-      wl=
-
+      # if reload_cmds runs $LD directly, get rid of -Wl from
+      # whole_archive_flag_spec and hope we can get by with turning comma
+      # into space.
+      case $reload_cmds in
+        *\$LD[\ \$]*) wl= ;;
+      esac
       if test -n "$convenience"; then
 	if test -n "$whole_archive_flag_spec"; then
 	  eval tmp_whole_archive_flags=\"$whole_archive_flag_spec\"
-	  reload_conv_objs=$reload_objs\ `$ECHO "$tmp_whole_archive_flags" | $SED 's|,| |g'`
+	  test -n "$wl" || tmp_whole_archive_flags=`$ECHO "$tmp_whole_archive_flags" | $SED 's|,| |g'`
+	  reload_conv_objs=$reload_objs\ $tmp_whole_archive_flags
 	else
-	  gentop="$output_objdir/${obj}x"
+	  gentop=$output_objdir/${obj}x
 	  func_append generated " $gentop"
 
 	  func_extract_archives $gentop $convenience
@@ -8630,12 +10140,12 @@ EOF
       fi
 
       # If we're not building shared, we need to use non_pic_objs
-      test "$build_libtool_libs" != yes && libobjs="$non_pic_objects"
+      test yes = "$build_libtool_libs" || libobjs=$non_pic_objects
 
       # Create the old-style object.
-      reload_objs="$objs$old_deplibs "`$ECHO "$libobjs" | $SP2NL | $SED "/\.${libext}$/d; /\.lib$/d; $lo2o" | $NL2SP`" $reload_conv_objs" ### testsuite: skip nested quoting test
+      reload_objs=$objs$old_deplibs' '`$ECHO "$libobjs" | $SP2NL | $SED "/\.$libext$/d; /\.lib$/d; $lo2o" | $NL2SP`' '$reload_conv_objs
 
-      output="$obj"
+      output=$obj
       func_execute_cmds "$reload_cmds" 'exit $?'
 
       # Exit if we aren't doing a library object file.
@@ -8647,7 +10157,7 @@ EOF
 	exit $EXIT_SUCCESS
       fi
 
-      if test "$build_libtool_libs" != yes; then
+      test yes = "$build_libtool_libs" || {
 	if test -n "$gentop"; then
 	  func_show_eval '${RM}r "$gentop"'
 	fi
@@ -8657,12 +10167,12 @@ EOF
 	# $show "echo timestamp > $libobj"
 	# $opt_dry_run || eval "echo timestamp > $libobj" || exit $?
 	exit $EXIT_SUCCESS
-      fi
+      }
 
-      if test -n "$pic_flag" || test "$pic_mode" != default; then
+      if test -n "$pic_flag" || test default != "$pic_mode"; then
 	# Only do commands if we really have different PIC objects.
 	reload_objs="$libobjs $reload_conv_objs"
-	output="$libobj"
+	output=$libobj
 	func_execute_cmds "$reload_cmds" 'exit $?'
       fi
 
@@ -8679,16 +10189,14 @@ EOF
 	          output=$func_stripname_result.exe;;
       esac
       test -n "$vinfo" && \
-	func_warning "\`-version-info' is ignored for programs"
+	func_warning "'-version-info' is ignored for programs"
 
       test -n "$release" && \
-	func_warning "\`-release' is ignored for programs"
+	func_warning "'-release' is ignored for programs"
 
-      test "$preload" = yes \
-        && test "$dlopen_support" = unknown \
-	&& test "$dlopen_self" = unknown \
-	&& test "$dlopen_self_static" = unknown && \
-	  func_warning "\`LT_INIT([dlopen])' not used. Assuming no dlopen support."
+      $preload \
+	&& test unknown,unknown,unknown = "$dlopen_support,$dlopen_self,$dlopen_self_static" \
+	&& func_warning "'LT_INIT([dlopen])' not used. Assuming no dlopen support."
 
       case $host in
       *-*-rhapsody* | *-*-darwin1.[012])
@@ -8702,11 +10210,11 @@ EOF
       *-*-darwin*)
 	# Don't allow lazy linking, it breaks C++ global constructors
 	# But is supposedly fixed on 10.4 or later (yay!).
-	if test "$tagname" = CXX ; then
+	if test CXX = "$tagname"; then
 	  case ${MACOSX_DEPLOYMENT_TARGET-10.0} in
 	    10.[0123])
-	      func_append compile_command " ${wl}-bind_at_load"
-	      func_append finalize_command " ${wl}-bind_at_load"
+	      func_append compile_command " $wl-bind_at_load"
+	      func_append finalize_command " $wl-bind_at_load"
 	    ;;
 	  esac
 	fi
@@ -8742,7 +10250,7 @@ EOF
 	*) func_append new_libs " $deplib" ;;
 	esac
       done
-      compile_deplibs="$new_libs"
+      compile_deplibs=$new_libs
 
 
       func_append compile_command " $compile_deplibs"
@@ -8766,7 +10274,7 @@ EOF
 	if test -n "$hardcode_libdir_flag_spec"; then
 	  if test -n "$hardcode_libdir_separator"; then
 	    if test -z "$hardcode_libdirs"; then
-	      hardcode_libdirs="$libdir"
+	      hardcode_libdirs=$libdir
 	    else
 	      # Just accumulate the unique libdirs.
 	      case $hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator in
@@ -8789,7 +10297,7 @@ EOF
 	fi
 	case $host in
 	*-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-cegcc*)
-	  testbindir=`${ECHO} "$libdir" | ${SED} -e 's*/lib$*/bin*'`
+	  testbindir=`$ECHO "$libdir" | $SED -e 's*/lib$*/bin*'`
 	  case :$dllsearchpath: in
 	  *":$libdir:"*) ;;
 	  ::) dllsearchpath=$libdir;;
@@ -8806,10 +10314,10 @@ EOF
       # Substitute the hardcoded libdirs into the rpath.
       if test -n "$hardcode_libdir_separator" &&
 	 test -n "$hardcode_libdirs"; then
-	libdir="$hardcode_libdirs"
+	libdir=$hardcode_libdirs
 	eval rpath=\" $hardcode_libdir_flag_spec\"
       fi
-      compile_rpath="$rpath"
+      compile_rpath=$rpath
 
       rpath=
       hardcode_libdirs=
@@ -8817,7 +10325,7 @@ EOF
 	if test -n "$hardcode_libdir_flag_spec"; then
 	  if test -n "$hardcode_libdir_separator"; then
 	    if test -z "$hardcode_libdirs"; then
-	      hardcode_libdirs="$libdir"
+	      hardcode_libdirs=$libdir
 	    else
 	      # Just accumulate the unique libdirs.
 	      case $hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator in
@@ -8842,45 +10350,43 @@ EOF
       # Substitute the hardcoded libdirs into the rpath.
       if test -n "$hardcode_libdir_separator" &&
 	 test -n "$hardcode_libdirs"; then
-	libdir="$hardcode_libdirs"
+	libdir=$hardcode_libdirs
 	eval rpath=\" $hardcode_libdir_flag_spec\"
       fi
-      finalize_rpath="$rpath"
+      finalize_rpath=$rpath
 
-      if test -n "$libobjs" && test "$build_old_libs" = yes; then
+      if test -n "$libobjs" && test yes = "$build_old_libs"; then
 	# Transform all the library objects into standard objects.
 	compile_command=`$ECHO "$compile_command" | $SP2NL | $SED "$lo2o" | $NL2SP`
 	finalize_command=`$ECHO "$finalize_command" | $SP2NL | $SED "$lo2o" | $NL2SP`
       fi
 
-      func_generate_dlsyms "$outputname" "@PROGRAM@" "no"
+      func_generate_dlsyms "$outputname" "@PROGRAM@" false
 
       # template prelinking step
       if test -n "$prelink_cmds"; then
 	func_execute_cmds "$prelink_cmds" 'exit $?'
       fi
 
-      wrappers_required=yes
+      wrappers_required=:
       case $host in
       *cegcc* | *mingw32ce*)
         # Disable wrappers for cegcc and mingw32ce hosts, we are cross compiling anyway.
-        wrappers_required=no
+        wrappers_required=false
         ;;
       *cygwin* | *mingw* )
-        if test "$build_libtool_libs" != yes; then
-          wrappers_required=no
-        fi
+        test yes = "$build_libtool_libs" || wrappers_required=false
         ;;
       *)
-        if test "$need_relink" = no || test "$build_libtool_libs" != yes; then
-          wrappers_required=no
+        if test no = "$need_relink" || test yes != "$build_libtool_libs"; then
+          wrappers_required=false
         fi
         ;;
       esac
-      if test "$wrappers_required" = no; then
+      $wrappers_required || {
 	# Replace the output file specification.
 	compile_command=`$ECHO "$compile_command" | $SED 's%@OUTPUT@%'"$output"'%g'`
-	link_command="$compile_command$compile_rpath"
+	link_command=$compile_command$compile_rpath
 
 	# We have no uninstalled library dependencies, so finalize right now.
 	exit_status=0
@@ -8893,12 +10399,12 @@ EOF
 	fi
 
 	# Delete the generated files.
-	if test -f "$output_objdir/${outputname}S.${objext}"; then
-	  func_show_eval '$RM "$output_objdir/${outputname}S.${objext}"'
+	if test -f "$output_objdir/${outputname}S.$objext"; then
+	  func_show_eval '$RM "$output_objdir/${outputname}S.$objext"'
 	fi
 
 	exit $exit_status
-      fi
+      }
 
       if test -n "$compile_shlibpath$finalize_shlibpath"; then
 	compile_command="$shlibpath_var=\"$compile_shlibpath$finalize_shlibpath\$$shlibpath_var\" $compile_command"
@@ -8928,9 +10434,9 @@ EOF
 	fi
       fi
 
-      if test "$no_install" = yes; then
+      if test yes = "$no_install"; then
 	# We don't need to create a wrapper script.
-	link_command="$compile_var$compile_command$compile_rpath"
+	link_command=$compile_var$compile_command$compile_rpath
 	# Replace the output file specification.
 	link_command=`$ECHO "$link_command" | $SED 's%@OUTPUT@%'"$output"'%g'`
 	# Delete the old output file.
@@ -8947,27 +10453,28 @@ EOF
 	exit $EXIT_SUCCESS
       fi
 
-      if test "$hardcode_action" = relink; then
-	# Fast installation is not supported
-	link_command="$compile_var$compile_command$compile_rpath"
-	relink_command="$finalize_var$finalize_command$finalize_rpath"
-
-	func_warning "this platform does not like uninstalled shared libraries"
-	func_warning "\`$output' will be relinked during installation"
-      else
-	if test "$fast_install" != no; then
-	  link_command="$finalize_var$compile_command$finalize_rpath"
-	  if test "$fast_install" = yes; then
-	    relink_command=`$ECHO "$compile_var$compile_command$compile_rpath" | $SED 's%@OUTPUT@%\$progdir/\$file%g'`
-	  else
-	    # fast_install is set to needless
-	    relink_command=
-	  fi
-	else
-	  link_command="$compile_var$compile_command$compile_rpath"
-	  relink_command="$finalize_var$finalize_command$finalize_rpath"
-	fi
-      fi
+      case $hardcode_action,$fast_install in
+        relink,*)
+	  # Fast installation is not supported
+	  link_command=$compile_var$compile_command$compile_rpath
+	  relink_command=$finalize_var$finalize_command$finalize_rpath
+
+	  func_warning "this platform does not like uninstalled shared libraries"
+	  func_warning "'$output' will be relinked during installation"
+	  ;;
+        *,yes)
+	  link_command=$finalize_var$compile_command$finalize_rpath
+	  relink_command=`$ECHO "$compile_var$compile_command$compile_rpath" | $SED 's%@OUTPUT@%\$progdir/\$file%g'`
+          ;;
+	*,no)
+	  link_command=$compile_var$compile_command$compile_rpath
+	  relink_command=$finalize_var$finalize_command$finalize_rpath
+          ;;
+	*,needless)
+	  link_command=$finalize_var$compile_command$finalize_rpath
+	  relink_command=
+          ;;
+      esac
 
       # Replace the output file specification.
       link_command=`$ECHO "$link_command" | $SED 's%@OUTPUT@%'"$output_objdir/$outputname"'%g'`
@@ -9024,8 +10531,8 @@ EOF
 	    func_dirname_and_basename "$output" "" "."
 	    output_name=$func_basename_result
 	    output_path=$func_dirname_result
-	    cwrappersource="$output_path/$objdir/lt-$output_name.c"
-	    cwrapper="$output_path/$output_name.exe"
+	    cwrappersource=$output_path/$objdir/lt-$output_name.c
+	    cwrapper=$output_path/$output_name.exe
 	    $RM $cwrappersource $cwrapper
 	    trap "$RM $cwrappersource $cwrapper; exit $EXIT_FAILURE" 1 2 15
 
@@ -9046,7 +10553,7 @@ EOF
 	    trap "$RM $func_ltwrapper_scriptname_result; exit $EXIT_FAILURE" 1 2 15
 	    $opt_dry_run || {
 	      # note: this script will not be executed, so do not chmod.
-	      if test "x$build" = "x$host" ; then
+	      if test "x$build" = "x$host"; then
 		$cwrapper --lt-dump-script > $func_ltwrapper_scriptname_result
 	      else
 		func_emit_wrapper no > $func_ltwrapper_scriptname_result
@@ -9069,25 +10576,27 @@ EOF
     # See if we need to build an old-fashioned archive.
     for oldlib in $oldlibs; do
 
-      if test "$build_libtool_libs" = convenience; then
-	oldobjs="$libobjs_save $symfileobj"
-	addlibs="$convenience"
-	build_libtool_libs=no
-      else
-	if test "$build_libtool_libs" = module; then
-	  oldobjs="$libobjs_save"
+      case $build_libtool_libs in
+        convenience)
+	  oldobjs="$libobjs_save $symfileobj"
+	  addlibs=$convenience
 	  build_libtool_libs=no
-	else
+	  ;;
+	module)
+	  oldobjs=$libobjs_save
+	  addlibs=$old_convenience
+	  build_libtool_libs=no
+          ;;
+	*)
 	  oldobjs="$old_deplibs $non_pic_objects"
-	  if test "$preload" = yes && test -f "$symfileobj"; then
-	    func_append oldobjs " $symfileobj"
-	  fi
-	fi
-	addlibs="$old_convenience"
-      fi
+	  $preload && test -f "$symfileobj" \
+	    && func_append oldobjs " $symfileobj"
+	  addlibs=$old_convenience
+	  ;;
+      esac
 
       if test -n "$addlibs"; then
-	gentop="$output_objdir/${outputname}x"
+	gentop=$output_objdir/${outputname}x
 	func_append generated " $gentop"
 
 	func_extract_archives $gentop $addlibs
@@ -9095,13 +10604,13 @@ EOF
       fi
 
       # Do each command in the archive commands.
-      if test -n "$old_archive_from_new_cmds" && test "$build_libtool_libs" = yes; then
+      if test -n "$old_archive_from_new_cmds" && test yes = "$build_libtool_libs"; then
 	cmds=$old_archive_from_new_cmds
       else
 
 	# Add any objects from preloaded convenience libraries
 	if test -n "$dlprefiles"; then
-	  gentop="$output_objdir/${outputname}x"
+	  gentop=$output_objdir/${outputname}x
 	  func_append generated " $gentop"
 
 	  func_extract_archives $gentop $dlprefiles
@@ -9122,7 +10631,7 @@ EOF
 	  :
 	else
 	  echo "copying selected object files to avoid basename conflicts..."
-	  gentop="$output_objdir/${outputname}x"
+	  gentop=$output_objdir/${outputname}x
 	  func_append generated " $gentop"
 	  func_mkdir_p "$gentop"
 	  save_oldobjs=$oldobjs
@@ -9131,7 +10640,7 @@ EOF
 	  for obj in $save_oldobjs
 	  do
 	    func_basename "$obj"
-	    objbase="$func_basename_result"
+	    objbase=$func_basename_result
 	    case " $oldobjs " in
 	    " ") oldobjs=$obj ;;
 	    *[\ /]"$objbase "*)
@@ -9153,6 +10662,8 @@ EOF
 	    esac
 	  done
 	fi
+	func_to_tool_file "$oldlib" func_convert_file_msys_to_w32
+	tool_oldlib=$func_to_tool_file_result
 	eval cmds=\"$old_archive_cmds\"
 
 	func_len " $cmds"
@@ -9198,18 +10709,18 @@ EOF
 	    else
 	      # the above command should be used before it gets too long
 	      oldobjs=$objlist
-	      if test "$obj" = "$last_oldobj" ; then
+	      if test "$obj" = "$last_oldobj"; then
 		RANLIB=$save_RANLIB
 	      fi
 	      test -z "$concat_cmds" || concat_cmds=$concat_cmds~
-	      eval concat_cmds=\"\${concat_cmds}$old_archive_cmds\"
+	      eval concat_cmds=\"\$concat_cmds$old_archive_cmds\"
 	      objlist=
 	      len=$len0
 	    fi
 	  done
 	  RANLIB=$save_RANLIB
 	  oldobjs=$objlist
-	  if test "X$oldobjs" = "X" ; then
+	  if test -z "$oldobjs"; then
 	    eval cmds=\"\$concat_cmds\"
 	  else
 	    eval cmds=\"\$concat_cmds~\$old_archive_cmds\"
@@ -9226,7 +10737,7 @@ EOF
     case $output in
     *.la)
       old_library=
-      test "$build_old_libs" = yes && old_library="$libname.$libext"
+      test yes = "$build_old_libs" && old_library=$libname.$libext
       func_verbose "creating $output"
 
       # Preserve any variables that may affect compiler behavior
@@ -9241,30 +10752,31 @@ EOF
 	fi
       done
       # Quote the link command for shipping.
-      relink_command="(cd `pwd`; $SHELL $progpath $preserve_args --mode=relink $libtool_args @inst_prefix_dir@)"
+      relink_command="(cd `pwd`; $SHELL \"$progpath\" $preserve_args --mode=relink $libtool_args @inst_prefix_dir@)"
       relink_command=`$ECHO "$relink_command" | $SED "$sed_quote_subst"`
-      if test "$hardcode_automatic" = yes ; then
+      if test yes = "$hardcode_automatic"; then
 	relink_command=
       fi
 
       # Only create the output if not a dry run.
       $opt_dry_run || {
 	for installed in no yes; do
-	  if test "$installed" = yes; then
+	  if test yes = "$installed"; then
 	    if test -z "$install_libdir"; then
 	      break
 	    fi
-	    output="$output_objdir/$outputname"i
+	    output=$output_objdir/${outputname}i
 	    # Replace all uninstalled libtool libraries with the installed ones
 	    newdependency_libs=
 	    for deplib in $dependency_libs; do
 	      case $deplib in
 	      *.la)
 		func_basename "$deplib"
-		name="$func_basename_result"
-		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
+		name=$func_basename_result
+		func_resolve_sysroot "$deplib"
+		eval libdir=`$SED -n -e 's/^libdir=\(.*\)$/\1/p' $func_resolve_sysroot_result`
 		test -z "$libdir" && \
-		  func_fatal_error "\`$deplib' is not a valid libtool archive"
+		  func_fatal_error "'$deplib' is not a valid libtool archive"
 		func_append newdependency_libs " ${lt_sysroot:+=}$libdir/$name"
 		;;
 	      -L*)
@@ -9280,23 +10792,23 @@ EOF
 	      *) func_append newdependency_libs " $deplib" ;;
 	      esac
 	    done
-	    dependency_libs="$newdependency_libs"
+	    dependency_libs=$newdependency_libs
 	    newdlfiles=
 
 	    for lib in $dlfiles; do
 	      case $lib in
 	      *.la)
 	        func_basename "$lib"
-		name="$func_basename_result"
-		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
+		name=$func_basename_result
+		eval libdir=`$SED -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
 		test -z "$libdir" && \
-		  func_fatal_error "\`$lib' is not a valid libtool archive"
+		  func_fatal_error "'$lib' is not a valid libtool archive"
 		func_append newdlfiles " ${lt_sysroot:+=}$libdir/$name"
 		;;
 	      *) func_append newdlfiles " $lib" ;;
 	      esac
 	    done
-	    dlfiles="$newdlfiles"
+	    dlfiles=$newdlfiles
 	    newdlprefiles=
 	    for lib in $dlprefiles; do
 	      case $lib in
@@ -9306,34 +10818,34 @@ EOF
 		# didn't already link the preopened objects directly into
 		# the library:
 		func_basename "$lib"
-		name="$func_basename_result"
-		eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
+		name=$func_basename_result
+		eval libdir=`$SED -n -e 's/^libdir=\(.*\)$/\1/p' $lib`
 		test -z "$libdir" && \
-		  func_fatal_error "\`$lib' is not a valid libtool archive"
+		  func_fatal_error "'$lib' is not a valid libtool archive"
 		func_append newdlprefiles " ${lt_sysroot:+=}$libdir/$name"
 		;;
 	      esac
 	    done
-	    dlprefiles="$newdlprefiles"
+	    dlprefiles=$newdlprefiles
 	  else
 	    newdlfiles=
 	    for lib in $dlfiles; do
 	      case $lib in
-		[\\/]* | [A-Za-z]:[\\/]*) abs="$lib" ;;
+		[\\/]* | [A-Za-z]:[\\/]*) abs=$lib ;;
 		*) abs=`pwd`"/$lib" ;;
 	      esac
 	      func_append newdlfiles " $abs"
 	    done
-	    dlfiles="$newdlfiles"
+	    dlfiles=$newdlfiles
 	    newdlprefiles=
 	    for lib in $dlprefiles; do
 	      case $lib in
-		[\\/]* | [A-Za-z]:[\\/]*) abs="$lib" ;;
+		[\\/]* | [A-Za-z]:[\\/]*) abs=$lib ;;
 		*) abs=`pwd`"/$lib" ;;
 	      esac
 	      func_append newdlprefiles " $abs"
 	    done
-	    dlprefiles="$newdlprefiles"
+	    dlprefiles=$newdlprefiles
 	  fi
 	  $RM $output
 	  # place dlname in correct position for cygwin
@@ -9349,10 +10861,9 @@ EOF
 	  case $host,$output,$installed,$module,$dlname in
 	    *cygwin*,*lai,yes,no,*.dll | *mingw*,*lai,yes,no,*.dll | *cegcc*,*lai,yes,no,*.dll)
 	      # If a -bindir argument was supplied, place the dll there.
-	      if test "x$bindir" != x ;
-	      then
+	      if test -n "$bindir"; then
 		func_relative_path "$install_libdir" "$bindir"
-		tdlname=$func_relative_path_result$dlname
+		tdlname=$func_relative_path_result/$dlname
 	      else
 		# Otherwise fall back on heuristic.
 		tdlname=../bin/$dlname
@@ -9361,7 +10872,7 @@ EOF
 	  esac
 	  $ECHO > $output "\
 # $outputname - a libtool library file
-# Generated by $PROGRAM (GNU $PACKAGE$TIMESTAMP) $VERSION
+# Generated by $PROGRAM (GNU $PACKAGE) $VERSION
 #
 # Please DO NOT delete this file!
 # It is necessary for linking the library.
@@ -9375,7 +10886,7 @@ library_names='$library_names'
 # The name of the static archive.
 old_library='$old_library'
 
-# Linker flags that can not go in dependency_libs.
+# Linker flags that cannot go in dependency_libs.
 inherited_linker_flags='$new_inherited_linker_flags'
 
 # Libraries that this one depends upon.
@@ -9401,7 +10912,7 @@ dlpreopen='$dlprefiles'
 
 # Directory that this library needs to be installed in:
 libdir='$install_libdir'"
-	  if test "$installed" = no && test "$need_relink" = yes; then
+	  if test no,yes = "$installed,$need_relink"; then
 	    $ECHO >> $output "\
 relink_command=\"$relink_command\""
 	  fi
@@ -9416,27 +10927,29 @@ relink_command=\"$relink_command\""
     exit $EXIT_SUCCESS
 }
 
-{ test "$opt_mode" = link || test "$opt_mode" = relink; } &&
-    func_mode_link ${1+"$@"}
+if test link = "$opt_mode" || test relink = "$opt_mode"; then
+  func_mode_link ${1+"$@"}
+fi
 
 
 # func_mode_uninstall arg...
 func_mode_uninstall ()
 {
-    $opt_debug
-    RM="$nonopt"
+    $debug_cmd
+
+    RM=$nonopt
     files=
-    rmforce=
+    rmforce=false
     exit_status=0
 
     # This variable tells wrapper scripts just to set variables rather
     # than running their programs.
-    libtool_install_magic="$magic"
+    libtool_install_magic=$magic
 
     for arg
     do
       case $arg in
-      -f) func_append RM " $arg"; rmforce=yes ;;
+      -f) func_append RM " $arg"; rmforce=: ;;
       -*) func_append RM " $arg" ;;
       *) func_append files " $arg" ;;
       esac
@@ -9449,18 +10962,18 @@ func_mode_uninstall ()
 
     for file in $files; do
       func_dirname "$file" "" "."
-      dir="$func_dirname_result"
-      if test "X$dir" = X.; then
-	odir="$objdir"
+      dir=$func_dirname_result
+      if test . = "$dir"; then
+	odir=$objdir
       else
-	odir="$dir/$objdir"
+	odir=$dir/$objdir
       fi
       func_basename "$file"
-      name="$func_basename_result"
-      test "$opt_mode" = uninstall && odir="$dir"
+      name=$func_basename_result
+      test uninstall = "$opt_mode" && odir=$dir
 
       # Remember odir for removal later, being careful to avoid duplicates
-      if test "$opt_mode" = clean; then
+      if test clean = "$opt_mode"; then
 	case " $rmdirs " in
 	  *" $odir "*) ;;
 	  *) func_append rmdirs " $odir" ;;
@@ -9475,11 +10988,11 @@ func_mode_uninstall ()
       elif test -d "$file"; then
 	exit_status=1
 	continue
-      elif test "$rmforce" = yes; then
+      elif $rmforce; then
 	continue
       fi
 
-      rmfiles="$file"
+      rmfiles=$file
 
       case $name in
       *.la)
@@ -9493,7 +11006,7 @@ func_mode_uninstall ()
 	  done
 	  test -n "$old_library" && func_append rmfiles " $odir/$old_library"
 
-	  case "$opt_mode" in
+	  case $opt_mode in
 	  clean)
 	    case " $library_names " in
 	    *" $dlname "*) ;;
@@ -9504,12 +11017,12 @@ func_mode_uninstall ()
 	  uninstall)
 	    if test -n "$library_names"; then
 	      # Do each command in the postuninstall commands.
-	      func_execute_cmds "$postuninstall_cmds" 'test "$rmforce" = yes || exit_status=1'
+	      func_execute_cmds "$postuninstall_cmds" '$rmforce || exit_status=1'
 	    fi
 
 	    if test -n "$old_library"; then
 	      # Do each command in the old_postuninstall commands.
-	      func_execute_cmds "$old_postuninstall_cmds" 'test "$rmforce" = yes || exit_status=1'
+	      func_execute_cmds "$old_postuninstall_cmds" '$rmforce || exit_status=1'
 	    fi
 	    # FIXME: should reinstall the best remaining shared library.
 	    ;;
@@ -9525,21 +11038,19 @@ func_mode_uninstall ()
 	  func_source $dir/$name
 
 	  # Add PIC object to the list of files to remove.
-	  if test -n "$pic_object" &&
-	     test "$pic_object" != none; then
+	  if test -n "$pic_object" && test none != "$pic_object"; then
 	    func_append rmfiles " $dir/$pic_object"
 	  fi
 
 	  # Add non-PIC object to the list of files to remove.
-	  if test -n "$non_pic_object" &&
-	     test "$non_pic_object" != none; then
+	  if test -n "$non_pic_object" && test none != "$non_pic_object"; then
 	    func_append rmfiles " $dir/$non_pic_object"
 	  fi
 	fi
 	;;
 
       *)
-	if test "$opt_mode" = clean ; then
+	if test clean = "$opt_mode"; then
 	  noexename=$name
 	  case $file in
 	  *.exe)
@@ -9566,12 +11077,12 @@ func_mode_uninstall ()
 
 	    # note $name still contains .exe if it was in $file originally
 	    # as does the version of $file that was added into $rmfiles
-	    func_append rmfiles " $odir/$name $odir/${name}S.${objext}"
-	    if test "$fast_install" = yes && test -n "$relink_command"; then
+	    func_append rmfiles " $odir/$name $odir/${name}S.$objext"
+	    if test yes = "$fast_install" && test -n "$relink_command"; then
 	      func_append rmfiles " $odir/lt-$name"
 	    fi
-	    if test "X$noexename" != "X$name" ; then
-	      func_append rmfiles " $odir/lt-${noexename}.c"
+	    if test "X$noexename" != "X$name"; then
+	      func_append rmfiles " $odir/lt-$noexename.c"
 	    fi
 	  fi
 	fi
@@ -9580,7 +11091,7 @@ func_mode_uninstall ()
       func_show_eval "$RM $rmfiles" 'exit_status=1'
     done
 
-    # Try to remove the ${objdir}s in the directories where we deleted files
+    # Try to remove the $objdir's in the directories where we deleted files
     for dir in $rmdirs; do
       if test -d "$dir"; then
 	func_show_eval "rmdir $dir >/dev/null 2>&1"
@@ -9590,16 +11101,17 @@ func_mode_uninstall ()
     exit $exit_status
 }
 
-{ test "$opt_mode" = uninstall || test "$opt_mode" = clean; } &&
-    func_mode_uninstall ${1+"$@"}
+if test uninstall = "$opt_mode" || test clean = "$opt_mode"; then
+  func_mode_uninstall ${1+"$@"}
+fi
 
 test -z "$opt_mode" && {
-  help="$generic_help"
+  help=$generic_help
   func_fatal_help "you must specify a MODE"
 }
 
 test -z "$exec_cmd" && \
-  func_fatal_help "invalid operation mode \`$opt_mode'"
+  func_fatal_help "invalid operation mode '$opt_mode'"
 
 if test -n "$exec_cmd"; then
   eval exec "$exec_cmd"
@@ -9610,7 +11122,7 @@ exit $exit_status
 
 
 # The TAGs below are defined such that we never get into a situation
-# in which we disable both kinds of libraries.  Given conflicting
+# where we disable both kinds of libraries.  Given conflicting
 # choices, we go for a static library, that is the most portable,
 # since we can't tell whether shared libraries were disabled because
 # the user asked for that or because the platform doesn't support
@@ -9633,5 +11145,3 @@ build_old_libs=`case $build_libtool_libs
 # mode:shell-script
 # sh-indentation:2
 # End:
-# vi:sw=2
-
diff -urpN net-snmp-5.8/m4/libtool.m4 net-snmp-5.9.1/m4/libtool.m4
--- net-snmp-5.8/m4/libtool.m4	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/m4/libtool.m4	2021-05-26 05:19:35.000000000 +0700
@@ -1,8 +1,6 @@
 # libtool.m4 - Configure libtool for the host system. -*-Autoconf-*-
 #
-#   Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005,
-#                 2006, 2007, 2008, 2009, 2010 Free Software Foundation,
-#                 Inc.
+#   Copyright (C) 1996-2001, 2003-2015 Free Software Foundation, Inc.
 #   Written by Gordon Matzigkeit, 1996
 #
 # This file is free software; the Free Software Foundation gives
@@ -10,36 +8,30 @@
 # modifications, as long as this notice is preserved.
 
 m4_define([_LT_COPYING], [dnl
-#   Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005,
-#                 2006, 2007, 2008, 2009, 2010 Free Software Foundation,
-#                 Inc.
-#   Written by Gordon Matzigkeit, 1996
-#
-#   This file is part of GNU Libtool.
+# Copyright (C) 2014 Free Software Foundation, Inc.
+# This is free software; see the source for copying conditions.  There is NO
+# warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
+
+# GNU Libtool is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of of the License, or
+# (at your option) any later version.
 #
-# GNU Libtool is free software; you can redistribute it and/or
-# modify it under the terms of the GNU General Public License as
-# published by the Free Software Foundation; either version 2 of
-# the License, or (at your option) any later version.
+# As a special exception to the GNU General Public License, if you
+# distribute this file as part of a program or library that is built
+# using GNU Libtool, you may include this file under the  same
+# distribution terms that you use for the rest of that program.
 #
-# As a special exception to the GNU General Public License,
-# if you distribute this file as part of a program or library that
-# is built using GNU Libtool, you may include this file under the
-# same distribution terms that you use for the rest of that program.
-#
-# GNU Libtool is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# GNU Libtool is distributed in the hope that it will be useful, but
+# WITHOUT ANY WARRANTY; without even the implied warranty of
 # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 # GNU General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
-# along with GNU Libtool; see the file COPYING.  If not, a copy
-# can be downloaded from http://www.gnu.org/licenses/gpl.html, or
-# obtained by writing to the Free Software Foundation, Inc.,
-# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
+# along with this program.  If not, see <http://www.gnu.org/licenses/>.
 ])
 
-# serial 57 LT_INIT
+# serial 58 LT_INIT
 
 
 # LT_PREREQ(VERSION)
@@ -67,7 +59,7 @@ esac
 # LT_INIT([OPTIONS])
 # ------------------
 AC_DEFUN([LT_INIT],
-[AC_PREREQ([2.58])dnl We use AC_INCLUDES_DEFAULT
+[AC_PREREQ([2.62])dnl We use AC_PATH_PROGS_FEATURE_CHECK
 AC_REQUIRE([AC_CONFIG_AUX_DIR_DEFAULT])dnl
 AC_BEFORE([$0], [LT_LANG])dnl
 AC_BEFORE([$0], [LT_OUTPUT])dnl
@@ -91,7 +83,7 @@ dnl Parse OPTIONS
 _LT_SET_OPTIONS([$0], [$1])
 
 # This can be used to rebuild libtool when needed
-LIBTOOL_DEPS="$ltmain"
+LIBTOOL_DEPS=$ltmain
 
 # Always use our own libtool.
 LIBTOOL='$(SHELL) $(top_builddir)/libtool'
@@ -111,26 +103,43 @@ dnl AC_DEFUN([AC_PROG_LIBTOOL], [])
 dnl AC_DEFUN([AM_PROG_LIBTOOL], [])
 
 
+# _LT_PREPARE_CC_BASENAME
+# -----------------------
+m4_defun([_LT_PREPARE_CC_BASENAME], [
+# Calculate cc_basename.  Skip known compiler wrappers and cross-prefix.
+func_cc_basename ()
+{
+    for cc_temp in @S|@*""; do
+      case $cc_temp in
+        compile | *[[\\/]]compile | ccache | *[[\\/]]ccache ) ;;
+        distcc | *[[\\/]]distcc | purify | *[[\\/]]purify ) ;;
+        \-*) ;;
+        *) break;;
+      esac
+    done
+    func_cc_basename_result=`$ECHO "$cc_temp" | $SED "s%.*/%%; s%^$host_alias-%%"`
+}
+])# _LT_PREPARE_CC_BASENAME
+
+
 # _LT_CC_BASENAME(CC)
 # -------------------
-# Calculate cc_basename.  Skip known compiler wrappers and cross-prefix.
+# It would be clearer to call AC_REQUIREs from _LT_PREPARE_CC_BASENAME,
+# but that macro is also expanded into generated libtool script, which
+# arranges for $SED and $ECHO to be set by different means.
 m4_defun([_LT_CC_BASENAME],
-[for cc_temp in $1""; do
-  case $cc_temp in
-    compile | *[[\\/]]compile | ccache | *[[\\/]]ccache ) ;;
-    distcc | *[[\\/]]distcc | purify | *[[\\/]]purify ) ;;
-    \-*) ;;
-    *) break;;
-  esac
-done
-cc_basename=`$ECHO "$cc_temp" | $SED "s%.*/%%; s%^$host_alias-%%"`
+[m4_require([_LT_PREPARE_CC_BASENAME])dnl
+AC_REQUIRE([_LT_DECL_SED])dnl
+AC_REQUIRE([_LT_PROG_ECHO_BACKSLASH])dnl
+func_cc_basename $1
+cc_basename=$func_cc_basename_result
 ])
 
 
 # _LT_FILEUTILS_DEFAULTS
 # ----------------------
 # It is okay to use these file commands and assume they have been set
-# sensibly after `m4_require([_LT_FILEUTILS_DEFAULTS])'.
+# sensibly after 'm4_require([_LT_FILEUTILS_DEFAULTS])'.
 m4_defun([_LT_FILEUTILS_DEFAULTS],
 [: ${CP="cp -f"}
 : ${MV="mv -f"}
@@ -146,6 +155,8 @@ AC_REQUIRE([AC_CANONICAL_BUILD])dnl
 AC_REQUIRE([_LT_PREPARE_SED_QUOTE_VARS])dnl
 AC_REQUIRE([_LT_PROG_ECHO_BACKSLASH])dnl
 
+_LT_DECL([], [PATH_SEPARATOR], [1], [The PATH separator for the build system])dnl
+dnl
 _LT_DECL([], [host_alias], [0], [The host system])dnl
 _LT_DECL([], [host], [0])dnl
 _LT_DECL([], [host_os], [0])dnl
@@ -175,15 +186,16 @@ m4_require([_LT_CHECK_SHAREDLIB_FROM_LIN
 m4_require([_LT_CMD_OLD_ARCHIVE])dnl
 m4_require([_LT_CMD_GLOBAL_SYMBOLS])dnl
 m4_require([_LT_WITH_SYSROOT])dnl
+m4_require([_LT_CMD_TRUNCATE])dnl
 
 _LT_CONFIG_LIBTOOL_INIT([
-# See if we are running on zsh, and set the options which allow our
+# See if we are running on zsh, and set the options that allow our
 # commands through without removal of \ escapes INIT.
-if test -n "\${ZSH_VERSION+set}" ; then
+if test -n "\${ZSH_VERSION+set}"; then
    setopt NO_GLOB_SUBST
 fi
 ])
-if test -n "${ZSH_VERSION+set}" ; then
+if test -n "${ZSH_VERSION+set}"; then
    setopt NO_GLOB_SUBST
 fi
 
@@ -196,7 +208,7 @@ aix3*)
   # AIX sometimes has problems with the GCC collect2 program.  For some
   # reason, if we set the COLLECT_NAMES environment variable, the problems
   # vanish in a puff of smoke.
-  if test "X${COLLECT_NAMES+set}" != Xset; then
+  if test set != "${COLLECT_NAMES+set}"; then
     COLLECT_NAMES=
     export COLLECT_NAMES
   fi
@@ -207,14 +219,14 @@ esac
 ofile=libtool
 can_build_shared=yes
 
-# All known linkers require a `.a' archive for static linking (except MSVC,
+# All known linkers require a '.a' archive for static linking (except MSVC,
 # which needs '.lib').
 libext=a
 
-with_gnu_ld="$lt_cv_prog_gnu_ld"
+with_gnu_ld=$lt_cv_prog_gnu_ld
 
-old_CC="$CC"
-old_CFLAGS="$CFLAGS"
+old_CC=$CC
+old_CFLAGS=$CFLAGS
 
 # Set sane defaults for various variables
 test -z "$CC" && CC=cc
@@ -267,14 +279,14 @@ no_glob_subst='s/\*/\\\*/g'
 
 # _LT_PROG_LTMAIN
 # ---------------
-# Note that this code is called both from `configure', and `config.status'
+# Note that this code is called both from 'configure', and 'config.status'
 # now that we use AC_CONFIG_COMMANDS to generate libtool.  Notably,
-# `config.status' has no value for ac_aux_dir unless we are using Automake,
+# 'config.status' has no value for ac_aux_dir unless we are using Automake,
 # so we pass a copy along to make sure it has a sensible value anyway.
 m4_defun([_LT_PROG_LTMAIN],
 [m4_ifdef([AC_REQUIRE_AUX_FILE], [AC_REQUIRE_AUX_FILE([ltmain.sh])])dnl
 _LT_CONFIG_LIBTOOL_INIT([ac_aux_dir='$ac_aux_dir'])
-ltmain="$ac_aux_dir/ltmain.sh"
+ltmain=$ac_aux_dir/ltmain.sh
 ])# _LT_PROG_LTMAIN
 
 
@@ -284,7 +296,7 @@ ltmain="$ac_aux_dir/ltmain.sh"
 
 # So that we can recreate a full libtool script including additional
 # tags, we accumulate the chunks of code to send to AC_CONFIG_COMMANDS
-# in macros and then make a single call at the end using the `libtool'
+# in macros and then make a single call at the end using the 'libtool'
 # label.
 
 
@@ -419,8 +431,8 @@ m4_define([_lt_decl_all_varnames],
 
 # _LT_CONFIG_STATUS_DECLARE([VARNAME])
 # ------------------------------------
-# Quote a variable value, and forward it to `config.status' so that its
-# declaration there will have the same value as in `configure'.  VARNAME
+# Quote a variable value, and forward it to 'config.status' so that its
+# declaration there will have the same value as in 'configure'.  VARNAME
 # must have a single quote delimited value for this to work.
 m4_define([_LT_CONFIG_STATUS_DECLARE],
 [$1='`$ECHO "$][$1" | $SED "$delay_single_quote_subst"`'])
@@ -444,7 +456,7 @@ m4_defun([_LT_CONFIG_STATUS_DECLARATIONS
 # Output comment and list of tags supported by the script
 m4_defun([_LT_LIBTOOL_TAGS],
 [_LT_FORMAT_COMMENT([The names of the tagged configurations supported by this script])dnl
-available_tags="_LT_TAGS"dnl
+available_tags='_LT_TAGS'dnl
 ])
 
 
@@ -472,7 +484,7 @@ m4_ifval([$2], [_$2])[]m4_popdef([_libto
 # _LT_LIBTOOL_CONFIG_VARS
 # -----------------------
 # Produce commented declarations of non-tagged libtool config variables
-# suitable for insertion in the LIBTOOL CONFIG section of the `libtool'
+# suitable for insertion in the LIBTOOL CONFIG section of the 'libtool'
 # script.  Tagged libtool config variables (even for the LIBTOOL CONFIG
 # section) are produced by _LT_LIBTOOL_TAG_VARS.
 m4_defun([_LT_LIBTOOL_CONFIG_VARS],
@@ -498,8 +510,8 @@ m4_define([_LT_TAGVAR], [m4_ifval([$2],
 # Send accumulated output to $CONFIG_STATUS.  Thanks to the lists of
 # variables for single and double quote escaping we saved from calls
 # to _LT_DECL, we can put quote escaped variables declarations
-# into `config.status', and then the shell code to quote escape them in
-# for loops in `config.status'.  Finally, any additional code accumulated
+# into 'config.status', and then the shell code to quote escape them in
+# for loops in 'config.status'.  Finally, any additional code accumulated
 # from calls to _LT_CONFIG_LIBTOOL_INIT is expanded.
 m4_defun([_LT_CONFIG_COMMANDS],
 [AC_PROVIDE_IFELSE([LT_OUTPUT],
@@ -545,7 +557,7 @@ for var in lt_decl_all_varnames([[ \
 ]], lt_decl_quote_varnames); do
     case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
     *[[\\\\\\\`\\"\\\$]]*)
-      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED \\"\\\$sed_quote_subst\\"\\\`\\\\\\""
+      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED \\"\\\$sed_quote_subst\\"\\\`\\\\\\"" ## exclude from sc_prohibit_nested_quotes
       ;;
     *)
       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
@@ -558,7 +570,7 @@ for var in lt_decl_all_varnames([[ \
 ]], lt_decl_dquote_varnames); do
     case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
     *[[\\\\\\\`\\"\\\$]]*)
-      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED -e \\"\\\$double_quote_subst\\" -e \\"\\\$sed_quote_subst\\" -e \\"\\\$delay_variable_subst\\"\\\`\\\\\\""
+      eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED -e \\"\\\$double_quote_subst\\" -e \\"\\\$sed_quote_subst\\" -e \\"\\\$delay_variable_subst\\"\\\`\\\\\\"" ## exclude from sc_prohibit_nested_quotes
       ;;
     *)
       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
@@ -574,7 +586,7 @@ _LT_OUTPUT_LIBTOOL_INIT
 # Generate a child script FILE with all initialization necessary to
 # reuse the environment learned by the parent script, and make the
 # file executable.  If COMMENT is supplied, it is inserted after the
-# `#!' sequence but before initialization text begins.  After this
+# '#!' sequence but before initialization text begins.  After this
 # macro, additional text can be appended to FILE to form the body of
 # the child script.  The macro ends with non-zero status if the
 # file could not be fully written (such as if the disk is full).
@@ -596,7 +608,7 @@ AS_SHELL_SANITIZE
 _AS_PREPARE
 exec AS_MESSAGE_FD>&1
 _ASEOF
-test $lt_write_fail = 0 && chmod +x $1[]dnl
+test 0 = "$lt_write_fail" && chmod +x $1[]dnl
 m4_popdef([AS_MESSAGE_LOG_FD])])])# _LT_GENERATED_FILE_INIT
 
 # LT_OUTPUT
@@ -619,7 +631,7 @@ exec AS_MESSAGE_LOG_FD>>config.log
 } >&AS_MESSAGE_LOG_FD
 
 lt_cl_help="\
-\`$as_me' creates a local libtool stub from the current configuration,
+'$as_me' creates a local libtool stub from the current configuration,
 for use in further configure time tests before the real libtool is
 generated.
 
@@ -637,11 +649,11 @@ m4_ifset([AC_PACKAGE_NAME], [AC_PACKAGE_
 m4_ifset([AC_PACKAGE_VERSION], [ AC_PACKAGE_VERSION])
 configured by $[0], generated by m4_PACKAGE_STRING.
 
-Copyright (C) 2010 Free Software Foundation, Inc.
+Copyright (C) 2011 Free Software Foundation, Inc.
 This config.lt script is free software; the Free Software Foundation
 gives unlimited permision to copy, distribute and modify it."
 
-while test $[#] != 0
+while test 0 != $[#]
 do
   case $[1] in
     --version | --v* | -V )
@@ -654,10 +666,10 @@ do
       lt_cl_silent=: ;;
 
     -*) AC_MSG_ERROR([unrecognized option: $[1]
-Try \`$[0] --help' for more information.]) ;;
+Try '$[0] --help' for more information.]) ;;
 
     *) AC_MSG_ERROR([unrecognized argument: $[1]
-Try \`$[0] --help' for more information.]) ;;
+Try '$[0] --help' for more information.]) ;;
   esac
   shift
 done
@@ -683,7 +695,7 @@ chmod +x "$CONFIG_LT"
 # open by configure.  Here we exec the FD to /dev/null, effectively closing
 # config.log, so it can be properly (re)opened and appended to by config.lt.
 lt_cl_success=:
-test "$silent" = yes &&
+test yes = "$silent" &&
   lt_config_lt_args="$lt_config_lt_args --quiet"
 exec AS_MESSAGE_LOG_FD>/dev/null
 $SHELL "$CONFIG_LT" $lt_config_lt_args || lt_cl_success=false
@@ -703,27 +715,31 @@ m4_defun([_LT_CONFIG],
 _LT_CONFIG_SAVE_COMMANDS([
   m4_define([_LT_TAG], m4_if([$1], [], [C], [$1]))dnl
   m4_if(_LT_TAG, [C], [
-    # See if we are running on zsh, and set the options which allow our
+    # See if we are running on zsh, and set the options that allow our
     # commands through without removal of \ escapes.
-    if test -n "${ZSH_VERSION+set}" ; then
+    if test -n "${ZSH_VERSION+set}"; then
       setopt NO_GLOB_SUBST
     fi
 
-    cfgfile="${ofile}T"
+    cfgfile=${ofile}T
     trap "$RM \"$cfgfile\"; exit 1" 1 2 15
     $RM "$cfgfile"
 
     cat <<_LT_EOF >> "$cfgfile"
 #! $SHELL
-
-# `$ECHO "$ofile" | sed 's%^.*/%%'` - Provide generalized library-building support services.
-# Generated automatically by $as_me ($PACKAGE$TIMESTAMP) $VERSION
+# Generated automatically by $as_me ($PACKAGE) $VERSION
 # Libtool was configured on host `(hostname || uname -n) 2>/dev/null | sed 1q`:
 # NOTE: Changes made to this file will be lost: look at ltmain.sh.
-#
+
+# Provide generalized library-building support services.
+# Written by Gordon Matzigkeit, 1996
+
 _LT_COPYING
 _LT_LIBTOOL_TAGS
 
+# Configured defaults for sys_lib_dlsearch_path munging.
+: \${LT_SYS_LIBRARY_PATH="$configure_time_lt_sys_library_path"}
+
 # ### BEGIN LIBTOOL CONFIG
 _LT_LIBTOOL_CONFIG_VARS
 _LT_LIBTOOL_TAG_VARS
@@ -731,13 +747,24 @@ _LT_LIBTOOL_TAG_VARS
 
 _LT_EOF
 
+    cat <<'_LT_EOF' >> "$cfgfile"
+
+# ### BEGIN FUNCTIONS SHARED WITH CONFIGURE
+
+_LT_PREPARE_MUNGE_PATH_LIST
+_LT_PREPARE_CC_BASENAME
+
+# ### END FUNCTIONS SHARED WITH CONFIGURE
+
+_LT_EOF
+
   case $host_os in
   aix3*)
     cat <<\_LT_EOF >> "$cfgfile"
 # AIX sometimes has problems with the GCC collect2 program.  For some
 # reason, if we set the COLLECT_NAMES environment variable, the problems
 # vanish in a puff of smoke.
-if test "X${COLLECT_NAMES+set}" != Xset; then
+if test set != "${COLLECT_NAMES+set}"; then
   COLLECT_NAMES=
   export COLLECT_NAMES
 fi
@@ -754,8 +781,6 @@ _LT_EOF
   sed '$q' "$ltmain" >> "$cfgfile" \
      || (rm -f "$cfgfile"; exit 1)
 
-  _LT_PROG_REPLACE_SHELLFNS
-
    mv -f "$cfgfile" "$ofile" ||
     (rm -f "$ofile" && cp "$cfgfile" "$ofile" && rm -f "$cfgfile")
   chmod +x "$ofile"
@@ -773,7 +798,6 @@ _LT_EOF
 [m4_if([$1], [], [
     PACKAGE='$PACKAGE'
     VERSION='$VERSION'
-    TIMESTAMP='$TIMESTAMP'
     RM='$RM'
     ofile='$ofile'], [])
 ])dnl /_LT_CONFIG_SAVE_COMMANDS
@@ -801,6 +825,7 @@ AC_DEFUN([LT_LANG],
 m4_case([$1],
   [C],			[_LT_LANG(C)],
   [C++],		[_LT_LANG(CXX)],
+  [Go],			[_LT_LANG(GO)],
   [Java],		[_LT_LANG(GCJ)],
   [Fortran 77],		[_LT_LANG(F77)],
   [Fortran],		[_LT_LANG(FC)],
@@ -822,6 +847,31 @@ m4_defun([_LT_LANG],
 ])# _LT_LANG
 
 
+m4_ifndef([AC_PROG_GO], [
+############################################################
+# NOTE: This macro has been submitted for inclusion into   #
+#  GNU Autoconf as AC_PROG_GO.  When it is available in    #
+#  a released version of Autoconf we should remove this    #
+#  macro and use it instead.                               #
+############################################################
+m4_defun([AC_PROG_GO],
+[AC_LANG_PUSH(Go)dnl
+AC_ARG_VAR([GOC],     [Go compiler command])dnl
+AC_ARG_VAR([GOFLAGS], [Go compiler flags])dnl
+_AC_ARG_VAR_LDFLAGS()dnl
+AC_CHECK_TOOL(GOC, gccgo)
+if test -z "$GOC"; then
+  if test -n "$ac_tool_prefix"; then
+    AC_CHECK_PROG(GOC, [${ac_tool_prefix}gccgo], [${ac_tool_prefix}gccgo])
+  fi
+fi
+if test -z "$GOC"; then
+  AC_CHECK_PROG(GOC, gccgo, gccgo, false)
+fi
+])#m4_defun
+])#m4_ifndef
+
+
 # _LT_LANG_DEFAULT_CONFIG
 # -----------------------
 m4_defun([_LT_LANG_DEFAULT_CONFIG],
@@ -852,6 +902,10 @@ AC_PROVIDE_IFELSE([AC_PROG_GCJ],
        m4_ifdef([LT_PROG_GCJ],
 	[m4_define([LT_PROG_GCJ], defn([LT_PROG_GCJ])[LT_LANG(GCJ)])])])])])
 
+AC_PROVIDE_IFELSE([AC_PROG_GO],
+  [LT_LANG(GO)],
+  [m4_define([AC_PROG_GO], defn([AC_PROG_GO])[LT_LANG(GO)])])
+
 AC_PROVIDE_IFELSE([LT_PROG_RC],
   [LT_LANG(RC)],
   [m4_define([LT_PROG_RC], defn([LT_PROG_RC])[LT_LANG(RC)])])
@@ -942,7 +996,7 @@ m4_defun_once([_LT_REQUIRED_DARWIN_CHECK
 
     AC_CACHE_CHECK([for -single_module linker flag],[lt_cv_apple_cc_single_mod],
       [lt_cv_apple_cc_single_mod=no
-      if test -z "${LT_MULTI_MODULE}"; then
+      if test -z "$LT_MULTI_MODULE"; then
 	# By default we will add the -single_module flag. You can override
 	# by either setting the environment variable LT_MULTI_MODULE
 	# non-empty at configure time, or by adding -multi_module to the
@@ -954,7 +1008,13 @@ m4_defun_once([_LT_REQUIRED_DARWIN_CHECK
 	$LTCC $LTCFLAGS $LDFLAGS -o libconftest.dylib \
 	  -dynamiclib -Wl,-single_module conftest.c 2>conftest.err
         _lt_result=$?
-	if test -f libconftest.dylib && test ! -s conftest.err && test $_lt_result = 0; then
+	# If there is a non-empty error log, and "single_module"
+	# appears in it, assume the flag caused a linker warning
+        if test -s conftest.err && $GREP single_module conftest.err; then
+	  cat conftest.err >&AS_MESSAGE_LOG_FD
+	# Otherwise, if the output was created with a 0 exit code from
+	# the compiler, it worked.
+	elif test -f libconftest.dylib && test 0 = "$_lt_result"; then
 	  lt_cv_apple_cc_single_mod=yes
 	else
 	  cat conftest.err >&AS_MESSAGE_LOG_FD
@@ -962,6 +1022,7 @@ m4_defun_once([_LT_REQUIRED_DARWIN_CHECK
 	rm -rf libconftest.dylib*
 	rm -f conftest.*
       fi])
+
     AC_CACHE_CHECK([for -exported_symbols_list linker flag],
       [lt_cv_ld_exported_symbols_list],
       [lt_cv_ld_exported_symbols_list=no
@@ -971,8 +1032,9 @@ m4_defun_once([_LT_REQUIRED_DARWIN_CHECK
       AC_LINK_IFELSE([AC_LANG_PROGRAM([],[])],
 	[lt_cv_ld_exported_symbols_list=yes],
 	[lt_cv_ld_exported_symbols_list=no])
-	LDFLAGS="$save_LDFLAGS"
+	LDFLAGS=$save_LDFLAGS
     ])
+
     AC_CACHE_CHECK([for -force_load linker flag],[lt_cv_ld_force_load],
       [lt_cv_ld_force_load=no
       cat > conftest.c << _LT_EOF
@@ -990,7 +1052,9 @@ _LT_EOF
       echo "$LTCC $LTCFLAGS $LDFLAGS -o conftest conftest.c -Wl,-force_load,./libconftest.a" >&AS_MESSAGE_LOG_FD
       $LTCC $LTCFLAGS $LDFLAGS -o conftest conftest.c -Wl,-force_load,./libconftest.a 2>conftest.err
       _lt_result=$?
-      if test -f conftest && test ! -s conftest.err && test $_lt_result = 0 && $GREP forced_load conftest 2>&1 >/dev/null; then
+      if test -s conftest.err && $GREP force_load conftest.err; then
+	cat conftest.err >&AS_MESSAGE_LOG_FD
+      elif test -f conftest && test 0 = "$_lt_result" && $GREP forced_load conftest >/dev/null 2>&1; then
 	lt_cv_ld_force_load=yes
       else
 	cat conftest.err >&AS_MESSAGE_LOG_FD
@@ -1000,32 +1064,32 @@ _LT_EOF
     ])
     case $host_os in
     rhapsody* | darwin1.[[012]])
-      _lt_dar_allow_undefined='${wl}-undefined ${wl}suppress' ;;
+      _lt_dar_allow_undefined='$wl-undefined ${wl}suppress' ;;
     darwin1.*)
-      _lt_dar_allow_undefined='${wl}-flat_namespace ${wl}-undefined ${wl}suppress' ;;
+      _lt_dar_allow_undefined='$wl-flat_namespace $wl-undefined ${wl}suppress' ;;
     darwin*) # darwin 5.x on
       # if running on 10.5 or later, the deployment target defaults
       # to the OS version, if on x86, and 10.4, the deployment
       # target defaults to 10.4. Don't you love it?
       case ${MACOSX_DEPLOYMENT_TARGET-10.0},$host in
 	10.0,*86*-darwin8*|10.0,*-darwin[[91]]*)
-	  _lt_dar_allow_undefined='${wl}-undefined ${wl}dynamic_lookup' ;;
-	10.[[012]]*)
-	  _lt_dar_allow_undefined='${wl}-flat_namespace ${wl}-undefined ${wl}suppress' ;;
+	  _lt_dar_allow_undefined='$wl-undefined ${wl}dynamic_lookup' ;;
+	10.[[012]][[,.]]*)
+	  _lt_dar_allow_undefined='$wl-flat_namespace $wl-undefined ${wl}suppress' ;;
 	10.*)
-	  _lt_dar_allow_undefined='${wl}-undefined ${wl}dynamic_lookup' ;;
+	  _lt_dar_allow_undefined='$wl-undefined ${wl}dynamic_lookup' ;;
       esac
     ;;
   esac
-    if test "$lt_cv_apple_cc_single_mod" = "yes"; then
+    if test yes = "$lt_cv_apple_cc_single_mod"; then
       _lt_dar_single_mod='$single_module'
     fi
-    if test "$lt_cv_ld_exported_symbols_list" = "yes"; then
-      _lt_dar_export_syms=' ${wl}-exported_symbols_list,$output_objdir/${libname}-symbols.expsym'
+    if test yes = "$lt_cv_ld_exported_symbols_list"; then
+      _lt_dar_export_syms=' $wl-exported_symbols_list,$output_objdir/$libname-symbols.expsym'
     else
-      _lt_dar_export_syms='~$NMEDIT -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      _lt_dar_export_syms='~$NMEDIT -s $output_objdir/$libname-symbols.expsym $lib'
     fi
-    if test "$DSYMUTIL" != ":" && test "$lt_cv_ld_force_load" = "no"; then
+    if test : != "$DSYMUTIL" && test no = "$lt_cv_ld_force_load"; then
       _lt_dsymutil='~$DSYMUTIL $lib || :'
     else
       _lt_dsymutil=
@@ -1035,8 +1099,8 @@ _LT_EOF
 ])
 
 
-# _LT_DARWIN_LINKER_FEATURES
-# --------------------------
+# _LT_DARWIN_LINKER_FEATURES([TAG])
+# ---------------------------------
 # Checks for linker and compiler features on darwin
 m4_defun([_LT_DARWIN_LINKER_FEATURES],
 [
@@ -1045,27 +1109,29 @@ m4_defun([_LT_DARWIN_LINKER_FEATURES],
   _LT_TAGVAR(hardcode_direct, $1)=no
   _LT_TAGVAR(hardcode_automatic, $1)=yes
   _LT_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
-  if test "$lt_cv_ld_force_load" = "yes"; then
-    _LT_TAGVAR(whole_archive_flag_spec, $1)='`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience ${wl}-force_load,$conv\"; done; func_echo_all \"$new_convenience\"`'
+  if test yes = "$lt_cv_ld_force_load"; then
+    _LT_TAGVAR(whole_archive_flag_spec, $1)='`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience $wl-force_load,$conv\"; done; func_echo_all \"$new_convenience\"`'
+    m4_case([$1], [F77], [_LT_TAGVAR(compiler_needs_object, $1)=yes],
+                  [FC],  [_LT_TAGVAR(compiler_needs_object, $1)=yes])
   else
     _LT_TAGVAR(whole_archive_flag_spec, $1)=''
   fi
   _LT_TAGVAR(link_all_deplibs, $1)=yes
-  _LT_TAGVAR(allow_undefined_flag, $1)="$_lt_dar_allow_undefined"
+  _LT_TAGVAR(allow_undefined_flag, $1)=$_lt_dar_allow_undefined
   case $cc_basename in
-     ifort*) _lt_dar_can_shared=yes ;;
+     ifort*|nagfor*) _lt_dar_can_shared=yes ;;
      *) _lt_dar_can_shared=$GCC ;;
   esac
-  if test "$_lt_dar_can_shared" = "yes"; then
+  if test yes = "$_lt_dar_can_shared"; then
     output_verbose_link_cmd=func_echo_all
-    _LT_TAGVAR(archive_cmds, $1)="\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring $_lt_dar_single_mod${_lt_dsymutil}"
-    _LT_TAGVAR(module_cmds, $1)="\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dsymutil}"
-    _LT_TAGVAR(archive_expsym_cmds, $1)="sed 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring ${_lt_dar_single_mod}${_lt_dar_export_syms}${_lt_dsymutil}"
-    _LT_TAGVAR(module_expsym_cmds, $1)="sed -e 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dar_export_syms}${_lt_dsymutil}"
+    _LT_TAGVAR(archive_cmds, $1)="\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring $_lt_dar_single_mod$_lt_dsymutil"
+    _LT_TAGVAR(module_cmds, $1)="\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags$_lt_dsymutil"
+    _LT_TAGVAR(archive_expsym_cmds, $1)="sed 's|^|_|' < \$export_symbols > \$output_objdir/\$libname-symbols.expsym~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring $_lt_dar_single_mod$_lt_dar_export_syms$_lt_dsymutil"
+    _LT_TAGVAR(module_expsym_cmds, $1)="sed -e 's|^|_|' < \$export_symbols > \$output_objdir/\$libname-symbols.expsym~\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags$_lt_dar_export_syms$_lt_dsymutil"
     m4_if([$1], [CXX],
-[   if test "$lt_cv_apple_cc_single_mod" != "yes"; then
-      _LT_TAGVAR(archive_cmds, $1)="\$CC -r -keep_private_externs -nostdlib -o \${lib}-master.o \$libobjs~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \${lib}-master.o \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring${_lt_dsymutil}"
-      _LT_TAGVAR(archive_expsym_cmds, $1)="sed 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC -r -keep_private_externs -nostdlib -o \${lib}-master.o \$libobjs~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \${lib}-master.o \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring${_lt_dar_export_syms}${_lt_dsymutil}"
+[   if test yes != "$lt_cv_apple_cc_single_mod"; then
+      _LT_TAGVAR(archive_cmds, $1)="\$CC -r -keep_private_externs -nostdlib -o \$lib-master.o \$libobjs~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$lib-master.o \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring$_lt_dsymutil"
+      _LT_TAGVAR(archive_expsym_cmds, $1)="sed 's|^|_|' < \$export_symbols > \$output_objdir/\$libname-symbols.expsym~\$CC -r -keep_private_externs -nostdlib -o \$lib-master.o \$libobjs~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$lib-master.o \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring$_lt_dar_export_syms$_lt_dsymutil"
     fi
 ],[])
   else
@@ -1085,7 +1151,7 @@ m4_defun([_LT_DARWIN_LINKER_FEATURES],
 # Allow to override them for all tags through lt_cv_aix_libpath.
 m4_defun([_LT_SYS_MODULE_PATH_AIX],
 [m4_require([_LT_DECL_SED])dnl
-if test "${lt_cv_aix_libpath+set}" = set; then
+if test set = "${lt_cv_aix_libpath+set}"; then
   aix_libpath=$lt_cv_aix_libpath
 else
   AC_CACHE_VAL([_LT_TAGVAR([lt_cv_aix_libpath_], [$1])],
@@ -1103,7 +1169,7 @@ else
     _LT_TAGVAR([lt_cv_aix_libpath_], [$1])=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
   fi],[])
   if test -z "$_LT_TAGVAR([lt_cv_aix_libpath_], [$1])"; then
-    _LT_TAGVAR([lt_cv_aix_libpath_], [$1])="/usr/lib:/lib"
+    _LT_TAGVAR([lt_cv_aix_libpath_], [$1])=/usr/lib:/lib
   fi
   ])
   aix_libpath=$_LT_TAGVAR([lt_cv_aix_libpath_], [$1])
@@ -1123,8 +1189,8 @@ m4_define([_LT_SHELL_INIT],
 # -----------------------
 # Find how we can fake an echo command that does not interpret backslash.
 # In particular, with Autoconf 2.60 or later we add some code to the start
-# of the generated configure script which will find a shell with a builtin
-# printf (which we can use as an echo command).
+# of the generated configure script that will find a shell with a builtin
+# printf (that we can use as an echo command).
 m4_defun([_LT_PROG_ECHO_BACKSLASH],
 [ECHO='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
 ECHO=$ECHO$ECHO$ECHO$ECHO$ECHO
@@ -1152,10 +1218,10 @@ fi
 # Invoke $ECHO with all args, space-separated.
 func_echo_all ()
 {
-    $ECHO "$*" 
+    $ECHO "$*"
 }
 
-case "$ECHO" in
+case $ECHO in
   printf*) AC_MSG_RESULT([printf]) ;;
   print*) AC_MSG_RESULT([print -r]) ;;
   *) AC_MSG_RESULT([cat]) ;;
@@ -1181,16 +1247,17 @@ _LT_DECL([], [ECHO], [1], [An echo progr
 AC_DEFUN([_LT_WITH_SYSROOT],
 [AC_MSG_CHECKING([for sysroot])
 AC_ARG_WITH([sysroot],
-[  --with-sysroot[=DIR] Search for dependent libraries within DIR
-                        (or the compiler's sysroot if not specified).],
+[AS_HELP_STRING([--with-sysroot@<:@=DIR@:>@],
+  [Search for dependent libraries within DIR (or the compiler's sysroot
+   if not specified).])],
 [], [with_sysroot=no])
 
 dnl lt_sysroot will always be passed unquoted.  We quote it here
 dnl in case the user passed a directory name.
 lt_sysroot=
-case ${with_sysroot} in #(
+case $with_sysroot in #(
  yes)
-   if test "$GCC" = yes; then
+   if test yes = "$GCC"; then
      lt_sysroot=`$CC --print-sysroot 2>/dev/null`
    fi
    ;; #(
@@ -1200,14 +1267,14 @@ case ${with_sysroot} in #(
  no|'')
    ;; #(
  *)
-   AC_MSG_RESULT([${with_sysroot}])
+   AC_MSG_RESULT([$with_sysroot])
    AC_MSG_ERROR([The sysroot must be an absolute path.])
    ;;
 esac
 
  AC_MSG_RESULT([${lt_sysroot:-no}])
 _LT_DECL([], [lt_sysroot], [0], [The root where to search for ]dnl
-[dependent libraries, and in which our libraries should be installed.])])
+[dependent libraries, and where our libraries should be installed.])])
 
 # _LT_ENABLE_LOCK
 # ---------------
@@ -1215,31 +1282,33 @@ m4_defun([_LT_ENABLE_LOCK],
 [AC_ARG_ENABLE([libtool-lock],
   [AS_HELP_STRING([--disable-libtool-lock],
     [avoid locking (might break parallel builds)])])
-test "x$enable_libtool_lock" != xno && enable_libtool_lock=yes
+test no = "$enable_libtool_lock" || enable_libtool_lock=yes
 
 # Some flags need to be propagated to the compiler or linker for good
 # libtool support.
 case $host in
 ia64-*-hpux*)
-  # Find out which ABI we are using.
+  # Find out what ABI is being produced by ac_compile, and set mode
+  # options accordingly.
   echo 'int i;' > conftest.$ac_ext
   if AC_TRY_EVAL(ac_compile); then
     case `/usr/bin/file conftest.$ac_objext` in
       *ELF-32*)
-	HPUX_IA64_MODE="32"
+	HPUX_IA64_MODE=32
 	;;
       *ELF-64*)
-	HPUX_IA64_MODE="64"
+	HPUX_IA64_MODE=64
 	;;
     esac
   fi
   rm -rf conftest*
   ;;
 *-*-irix6*)
-  # Find out which ABI we are using.
+  # Find out what ABI is being produced by ac_compile, and set linker
+  # options accordingly.
   echo '[#]line '$LINENO' "configure"' > conftest.$ac_ext
   if AC_TRY_EVAL(ac_compile); then
-    if test "$lt_cv_prog_gnu_ld" = yes; then
+    if test yes = "$lt_cv_prog_gnu_ld"; then
       case `/usr/bin/file conftest.$ac_objext` in
 	*32-bit*)
 	  LD="${LD-ld} -melf32bsmip"
@@ -1268,9 +1337,46 @@ ia64-*-hpux*)
   rm -rf conftest*
   ;;
 
-x86_64-*kfreebsd*-gnu|x86_64-*linux*|ppc*-*linux*|powerpc*-*linux*| \
+mips64*-*linux*)
+  # Find out what ABI is being produced by ac_compile, and set linker
+  # options accordingly.
+  echo '[#]line '$LINENO' "configure"' > conftest.$ac_ext
+  if AC_TRY_EVAL(ac_compile); then
+    emul=elf
+    case `/usr/bin/file conftest.$ac_objext` in
+      *32-bit*)
+	emul="${emul}32"
+	;;
+      *64-bit*)
+	emul="${emul}64"
+	;;
+    esac
+    case `/usr/bin/file conftest.$ac_objext` in
+      *MSB*)
+	emul="${emul}btsmip"
+	;;
+      *LSB*)
+	emul="${emul}ltsmip"
+	;;
+    esac
+    case `/usr/bin/file conftest.$ac_objext` in
+      *N32*)
+	emul="${emul}n32"
+	;;
+    esac
+    LD="${LD-ld} -m $emul"
+  fi
+  rm -rf conftest*
+  ;;
+
+x86_64-*kfreebsd*-gnu|x86_64-*linux*|powerpc*-*linux*| \
 s390*-*linux*|s390*-*tpf*|sparc*-*linux*)
-  # Find out which ABI we are using.
+  # Find out what ABI is being produced by ac_compile, and set linker
+  # options accordingly.  Note that the listed cases only cover the
+  # situations where additional linker options are needed (such as when
+  # doing 32-bit compilation for a host where ld defaults to 64-bit, or
+  # vice versa); the common cases where no linker options are needed do
+  # not appear in the list.
   echo 'int i;' > conftest.$ac_ext
   if AC_TRY_EVAL(ac_compile); then
     case `/usr/bin/file conftest.o` in
@@ -1280,9 +1386,19 @@ s390*-*linux*|s390*-*tpf*|sparc*-*linux*
 	    LD="${LD-ld} -m elf_i386_fbsd"
 	    ;;
 	  x86_64-*linux*)
-	    LD="${LD-ld} -m elf_i386"
+	    case `/usr/bin/file conftest.o` in
+	      *x86-64*)
+		LD="${LD-ld} -m elf32_x86_64"
+		;;
+	      *)
+		LD="${LD-ld} -m elf_i386"
+		;;
+	    esac
+	    ;;
+	  powerpc64le-*linux*)
+	    LD="${LD-ld} -m elf32lppclinux"
 	    ;;
-	  ppc64-*linux*|powerpc64-*linux*)
+	  powerpc64-*linux*)
 	    LD="${LD-ld} -m elf32ppclinux"
 	    ;;
 	  s390x-*linux*)
@@ -1301,7 +1417,10 @@ s390*-*linux*|s390*-*tpf*|sparc*-*linux*
 	  x86_64-*linux*)
 	    LD="${LD-ld} -m elf_x86_64"
 	    ;;
-	  ppc*-*linux*|powerpc*-*linux*)
+	  powerpcle-*linux*)
+	    LD="${LD-ld} -m elf64lppc"
+	    ;;
+	  powerpc-*linux*)
 	    LD="${LD-ld} -m elf64ppc"
 	    ;;
 	  s390*-*linux*|s390*-*tpf*)
@@ -1319,25 +1438,39 @@ s390*-*linux*|s390*-*tpf*|sparc*-*linux*
 
 *-*-sco3.2v5*)
   # On SCO OpenServer 5, we need -belf to get full-featured binaries.
-  SAVE_CFLAGS="$CFLAGS"
+  SAVE_CFLAGS=$CFLAGS
   CFLAGS="$CFLAGS -belf"
   AC_CACHE_CHECK([whether the C compiler needs -belf], lt_cv_cc_needs_belf,
     [AC_LANG_PUSH(C)
      AC_LINK_IFELSE([AC_LANG_PROGRAM([[]],[[]])],[lt_cv_cc_needs_belf=yes],[lt_cv_cc_needs_belf=no])
      AC_LANG_POP])
-  if test x"$lt_cv_cc_needs_belf" != x"yes"; then
+  if test yes != "$lt_cv_cc_needs_belf"; then
     # this is probably gcc 2.8.0, egcs 1.0 or newer; no need for -belf
-    CFLAGS="$SAVE_CFLAGS"
+    CFLAGS=$SAVE_CFLAGS
   fi
   ;;
-sparc*-*solaris*)
-  # Find out which ABI we are using.
+*-*solaris*)
+  # Find out what ABI is being produced by ac_compile, and set linker
+  # options accordingly.
   echo 'int i;' > conftest.$ac_ext
   if AC_TRY_EVAL(ac_compile); then
     case `/usr/bin/file conftest.o` in
     *64-bit*)
       case $lt_cv_prog_gnu_ld in
-      yes*) LD="${LD-ld} -m elf64_sparc" ;;
+      yes*)
+        case $host in
+        i?86-*-solaris*|x86_64-*-solaris*)
+          LD="${LD-ld} -m elf_x86_64"
+          ;;
+        sparc*-*-solaris*)
+          LD="${LD-ld} -m elf64_sparc"
+          ;;
+        esac
+        # GNU ld 2.21 introduced _sol2 emulations.  Use them if available.
+        if ${LD-ld} -V | grep _sol2 >/dev/null 2>&1; then
+          LD=${LD-ld}_sol2
+        fi
+        ;;
       *)
 	if ${LD-ld} -64 -r -o conftest2.o conftest.o >/dev/null 2>&1; then
 	  LD="${LD-ld} -64"
@@ -1351,7 +1484,7 @@ sparc*-*solaris*)
   ;;
 esac
 
-need_locks="$enable_libtool_lock"
+need_locks=$enable_libtool_lock
 ])# _LT_ENABLE_LOCK
 
 
@@ -1370,11 +1503,11 @@ AC_CACHE_CHECK([for archiver @FILE suppo
      [echo conftest.$ac_objext > conftest.lst
       lt_ar_try='$AR $AR_FLAGS libconftest.a @conftest.lst >&AS_MESSAGE_LOG_FD'
       AC_TRY_EVAL([lt_ar_try])
-      if test "$ac_status" -eq 0; then
+      if test 0 -eq "$ac_status"; then
 	# Ensure the archiver fails upon bogus file names.
 	rm -f conftest.$ac_objext libconftest.a
 	AC_TRY_EVAL([lt_ar_try])
-	if test "$ac_status" -ne 0; then
+	if test 0 -ne "$ac_status"; then
           lt_cv_ar_at_file=@
         fi
       fi
@@ -1382,7 +1515,7 @@ AC_CACHE_CHECK([for archiver @FILE suppo
      ])
   ])
 
-if test "x$lt_cv_ar_at_file" = xno; then
+if test no = "$lt_cv_ar_at_file"; then
   archiver_list_spec=
 else
   archiver_list_spec=$lt_cv_ar_at_file
@@ -1413,14 +1546,14 @@ old_postuninstall_cmds=
 
 if test -n "$RANLIB"; then
   case $host_os in
-  openbsd*)
-    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB -t \$oldlib"
+  bitrig* | openbsd*)
+    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB -t \$tool_oldlib"
     ;;
   *)
-    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB \$oldlib"
+    old_postinstall_cmds="$old_postinstall_cmds~\$RANLIB \$tool_oldlib"
     ;;
   esac
-  old_archive_cmds="$old_archive_cmds~\$RANLIB \$oldlib"
+  old_archive_cmds="$old_archive_cmds~\$RANLIB \$tool_oldlib"
 fi
 
 case $host_os in
@@ -1449,7 +1582,7 @@ AC_CACHE_CHECK([$1], [$2],
   [$2=no
    m4_if([$4], , [ac_outfile=conftest.$ac_objext], [ac_outfile=$4])
    echo "$lt_simple_compile_test_code" > conftest.$ac_ext
-   lt_compiler_flag="$3"
+   lt_compiler_flag="$3"  ## exclude from sc_useless_quotes_in_assignment
    # Insert the option either (1) after the last *FLAGS variable, or
    # (2) before a word containing "conftest.", or (3) at the end.
    # Note that $ac_compile itself does not contain backslashes and begins
@@ -1476,7 +1609,7 @@ AC_CACHE_CHECK([$1], [$2],
    $RM conftest*
 ])
 
-if test x"[$]$2" = xyes; then
+if test yes = "[$]$2"; then
     m4_if([$5], , :, [$5])
 else
     m4_if([$6], , :, [$6])
@@ -1498,7 +1631,7 @@ AC_DEFUN([_LT_LINKER_OPTION],
 m4_require([_LT_DECL_SED])dnl
 AC_CACHE_CHECK([$1], [$2],
   [$2=no
-   save_LDFLAGS="$LDFLAGS"
+   save_LDFLAGS=$LDFLAGS
    LDFLAGS="$LDFLAGS $3"
    echo "$lt_simple_link_test_code" > conftest.$ac_ext
    if (eval $ac_link 2>conftest.err) && test -s conftest$ac_exeext; then
@@ -1517,10 +1650,10 @@ AC_CACHE_CHECK([$1], [$2],
      fi
    fi
    $RM -r conftest*
-   LDFLAGS="$save_LDFLAGS"
+   LDFLAGS=$save_LDFLAGS
 ])
 
-if test x"[$]$2" = xyes; then
+if test yes = "[$]$2"; then
     m4_if([$4], , :, [$4])
 else
     m4_if([$5], , :, [$5])
@@ -1541,7 +1674,7 @@ AC_DEFUN([LT_CMD_MAX_LEN],
 AC_MSG_CHECKING([the maximum length of command line arguments])
 AC_CACHE_VAL([lt_cv_sys_max_cmd_len], [dnl
   i=0
-  teststring="ABCD"
+  teststring=ABCD
 
   case $build_os in
   msdosdjgpp*)
@@ -1581,7 +1714,7 @@ AC_CACHE_VAL([lt_cv_sys_max_cmd_len], [d
     lt_cv_sys_max_cmd_len=8192;
     ;;
 
-  netbsd* | freebsd* | openbsd* | darwin* | dragonfly*)
+  bitrig* | darwin* | dragonfly* | freebsd* | netbsd* | openbsd*)
     # This has been around since 386BSD, at least.  Likely further.
     if test -x /sbin/sysctl; then
       lt_cv_sys_max_cmd_len=`/sbin/sysctl -n kern.argmax`
@@ -1600,6 +1733,11 @@ AC_CACHE_VAL([lt_cv_sys_max_cmd_len], [d
     lt_cv_sys_max_cmd_len=196608
     ;;
 
+  os2*)
+    # The test takes a long time on OS/2.
+    lt_cv_sys_max_cmd_len=8192
+    ;;
+
   osf*)
     # Dr. Hans Ekkehard Plesser reports seeing a kernel panic running configure
     # due to this test when exec_disable_arg_limit is 1 on Tru64. It is not
@@ -1626,22 +1764,23 @@ AC_CACHE_VAL([lt_cv_sys_max_cmd_len], [d
     ;;
   *)
     lt_cv_sys_max_cmd_len=`(getconf ARG_MAX) 2> /dev/null`
-    if test -n "$lt_cv_sys_max_cmd_len"; then
+    if test -n "$lt_cv_sys_max_cmd_len" && \
+       test undefined != "$lt_cv_sys_max_cmd_len"; then
       lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \/ 4`
       lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \* 3`
     else
       # Make teststring a little bigger before we do anything with it.
       # a 1K string should be a reasonable start.
-      for i in 1 2 3 4 5 6 7 8 ; do
+      for i in 1 2 3 4 5 6 7 8; do
         teststring=$teststring$teststring
       done
       SHELL=${SHELL-${CONFIG_SHELL-/bin/sh}}
       # If test is not a shell built-in, we'll probably end up computing a
       # maximum length that is only half of the actual maximum length, but
       # we can't tell.
-      while { test "X"`func_fallback_echo "$teststring$teststring" 2>/dev/null` \
+      while { test X`env echo "$teststring$teststring" 2>/dev/null` \
 	         = "X$teststring$teststring"; } >/dev/null 2>&1 &&
-	      test $i != 17 # 1/2 MB should be enough
+	      test 17 != "$i" # 1/2 MB should be enough
       do
         i=`expr $i + 1`
         teststring=$teststring$teststring
@@ -1657,7 +1796,7 @@ AC_CACHE_VAL([lt_cv_sys_max_cmd_len], [d
     ;;
   esac
 ])
-if test -n $lt_cv_sys_max_cmd_len ; then
+if test -n "$lt_cv_sys_max_cmd_len"; then
   AC_MSG_RESULT($lt_cv_sys_max_cmd_len)
 else
   AC_MSG_RESULT(none)
@@ -1685,7 +1824,7 @@ m4_defun([_LT_HEADER_DLFCN],
 # ----------------------------------------------------------------
 m4_defun([_LT_TRY_DLOPEN_SELF],
 [m4_require([_LT_HEADER_DLFCN])dnl
-if test "$cross_compiling" = yes; then :
+if test yes = "$cross_compiling"; then :
   [$4]
 else
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
@@ -1732,9 +1871,9 @@ else
 #  endif
 #endif
 
-/* When -fvisbility=hidden is used, assume the code has been annotated
+/* When -fvisibility=hidden is used, assume the code has been annotated
    correspondingly for the symbols needed.  */
-#if defined(__GNUC__) && (((__GNUC__ == 3) && (__GNUC_MINOR__ >= 3)) || (__GNUC__ > 3))
+#if defined __GNUC__ && (((__GNUC__ == 3) && (__GNUC_MINOR__ >= 3)) || (__GNUC__ > 3))
 int fnord () __attribute__((visibility("default")));
 #endif
 
@@ -1760,7 +1899,7 @@ int main ()
   return status;
 }]
 _LT_EOF
-  if AC_TRY_EVAL(ac_link) && test -s conftest${ac_exeext} 2>/dev/null; then
+  if AC_TRY_EVAL(ac_link) && test -s "conftest$ac_exeext" 2>/dev/null; then
     (./conftest; exit; ) >&AS_MESSAGE_LOG_FD 2>/dev/null
     lt_status=$?
     case x$lt_status in
@@ -1781,7 +1920,7 @@ rm -fr conftest*
 # ------------------
 AC_DEFUN([LT_SYS_DLOPEN_SELF],
 [m4_require([_LT_HEADER_DLFCN])dnl
-if test "x$enable_dlopen" != xyes; then
+if test yes != "$enable_dlopen"; then
   enable_dlopen=unknown
   enable_dlopen_self=unknown
   enable_dlopen_self_static=unknown
@@ -1791,44 +1930,52 @@ else
 
   case $host_os in
   beos*)
-    lt_cv_dlopen="load_add_on"
+    lt_cv_dlopen=load_add_on
     lt_cv_dlopen_libs=
     lt_cv_dlopen_self=yes
     ;;
 
   mingw* | pw32* | cegcc*)
-    lt_cv_dlopen="LoadLibrary"
+    lt_cv_dlopen=LoadLibrary
     lt_cv_dlopen_libs=
     ;;
 
   cygwin*)
-    lt_cv_dlopen="dlopen"
+    lt_cv_dlopen=dlopen
     lt_cv_dlopen_libs=
     ;;
 
   darwin*)
-  # if libdl is installed we need to link against it
+    # if libdl is installed we need to link against it
     AC_CHECK_LIB([dl], [dlopen],
-		[lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"],[
-    lt_cv_dlopen="dyld"
+		[lt_cv_dlopen=dlopen lt_cv_dlopen_libs=-ldl],[
+    lt_cv_dlopen=dyld
     lt_cv_dlopen_libs=
     lt_cv_dlopen_self=yes
     ])
     ;;
 
+  tpf*)
+    # Don't try to run any link tests for TPF.  We know it's impossible
+    # because TPF is a cross-compiler, and we know how we open DSOs.
+    lt_cv_dlopen=dlopen
+    lt_cv_dlopen_libs=
+    lt_cv_dlopen_self=no
+    ;;
+
   *)
     AC_CHECK_FUNC([shl_load],
-	  [lt_cv_dlopen="shl_load"],
+	  [lt_cv_dlopen=shl_load],
       [AC_CHECK_LIB([dld], [shl_load],
-	    [lt_cv_dlopen="shl_load" lt_cv_dlopen_libs="-ldld"],
+	    [lt_cv_dlopen=shl_load lt_cv_dlopen_libs=-ldld],
 	[AC_CHECK_FUNC([dlopen],
-	      [lt_cv_dlopen="dlopen"],
+	      [lt_cv_dlopen=dlopen],
 	  [AC_CHECK_LIB([dl], [dlopen],
-		[lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-ldl"],
+		[lt_cv_dlopen=dlopen lt_cv_dlopen_libs=-ldl],
 	    [AC_CHECK_LIB([svld], [dlopen],
-		  [lt_cv_dlopen="dlopen" lt_cv_dlopen_libs="-lsvld"],
+		  [lt_cv_dlopen=dlopen lt_cv_dlopen_libs=-lsvld],
 	      [AC_CHECK_LIB([dld], [dld_link],
-		    [lt_cv_dlopen="dld_link" lt_cv_dlopen_libs="-ldld"])
+		    [lt_cv_dlopen=dld_link lt_cv_dlopen_libs=-ldld])
 	      ])
 	    ])
 	  ])
@@ -1837,21 +1984,21 @@ else
     ;;
   esac
 
-  if test "x$lt_cv_dlopen" != xno; then
-    enable_dlopen=yes
-  else
+  if test no = "$lt_cv_dlopen"; then
     enable_dlopen=no
+  else
+    enable_dlopen=yes
   fi
 
   case $lt_cv_dlopen in
   dlopen)
-    save_CPPFLAGS="$CPPFLAGS"
-    test "x$ac_cv_header_dlfcn_h" = xyes && CPPFLAGS="$CPPFLAGS -DHAVE_DLFCN_H"
+    save_CPPFLAGS=$CPPFLAGS
+    test yes = "$ac_cv_header_dlfcn_h" && CPPFLAGS="$CPPFLAGS -DHAVE_DLFCN_H"
 
-    save_LDFLAGS="$LDFLAGS"
+    save_LDFLAGS=$LDFLAGS
     wl=$lt_prog_compiler_wl eval LDFLAGS=\"\$LDFLAGS $export_dynamic_flag_spec\"
 
-    save_LIBS="$LIBS"
+    save_LIBS=$LIBS
     LIBS="$lt_cv_dlopen_libs $LIBS"
 
     AC_CACHE_CHECK([whether a program can dlopen itself],
@@ -1861,7 +2008,7 @@ else
 	    lt_cv_dlopen_self=no, lt_cv_dlopen_self=cross)
     ])
 
-    if test "x$lt_cv_dlopen_self" = xyes; then
+    if test yes = "$lt_cv_dlopen_self"; then
       wl=$lt_prog_compiler_wl eval LDFLAGS=\"\$LDFLAGS $lt_prog_compiler_static\"
       AC_CACHE_CHECK([whether a statically linked program can dlopen itself],
 	  lt_cv_dlopen_self_static, [dnl
@@ -1871,9 +2018,9 @@ else
       ])
     fi
 
-    CPPFLAGS="$save_CPPFLAGS"
-    LDFLAGS="$save_LDFLAGS"
-    LIBS="$save_LIBS"
+    CPPFLAGS=$save_CPPFLAGS
+    LDFLAGS=$save_LDFLAGS
+    LIBS=$save_LIBS
     ;;
   esac
 
@@ -1965,8 +2112,8 @@ m4_defun([_LT_COMPILER_FILE_LOCKS],
 m4_require([_LT_FILEUTILS_DEFAULTS])dnl
 _LT_COMPILER_C_O([$1])
 
-hard_links="nottested"
-if test "$_LT_TAGVAR(lt_cv_prog_compiler_c_o, $1)" = no && test "$need_locks" != no; then
+hard_links=nottested
+if test no = "$_LT_TAGVAR(lt_cv_prog_compiler_c_o, $1)" && test no != "$need_locks"; then
   # do not overwrite the value of need_locks provided by the user
   AC_MSG_CHECKING([if we can lock with hard links])
   hard_links=yes
@@ -1976,8 +2123,8 @@ if test "$_LT_TAGVAR(lt_cv_prog_compiler
   ln conftest.a conftest.b 2>&5 || hard_links=no
   ln conftest.a conftest.b 2>/dev/null && hard_links=no
   AC_MSG_RESULT([$hard_links])
-  if test "$hard_links" = no; then
-    AC_MSG_WARN([`$CC' does not support `-c -o', so `make -j' may be unsafe])
+  if test no = "$hard_links"; then
+    AC_MSG_WARN(['$CC' does not support '-c -o', so 'make -j' may be unsafe])
     need_locks=warn
   fi
 else
@@ -2004,8 +2151,8 @@ objdir=$lt_cv_objdir
 _LT_DECL([], [objdir], [0],
          [The name of the directory that contains temporary libtool files])dnl
 m4_pattern_allow([LT_OBJDIR])dnl
-AC_DEFINE_UNQUOTED(LT_OBJDIR, "$lt_cv_objdir/",
-  [Define to the sub-directory in which libtool stores uninstalled libraries.])
+AC_DEFINE_UNQUOTED([LT_OBJDIR], "$lt_cv_objdir/",
+  [Define to the sub-directory where libtool stores uninstalled libraries.])
 ])# _LT_CHECK_OBJDIR
 
 
@@ -2017,15 +2164,15 @@ m4_defun([_LT_LINKER_HARDCODE_LIBPATH],
 _LT_TAGVAR(hardcode_action, $1)=
 if test -n "$_LT_TAGVAR(hardcode_libdir_flag_spec, $1)" ||
    test -n "$_LT_TAGVAR(runpath_var, $1)" ||
-   test "X$_LT_TAGVAR(hardcode_automatic, $1)" = "Xyes" ; then
+   test yes = "$_LT_TAGVAR(hardcode_automatic, $1)"; then
 
   # We can hardcode non-existent directories.
-  if test "$_LT_TAGVAR(hardcode_direct, $1)" != no &&
+  if test no != "$_LT_TAGVAR(hardcode_direct, $1)" &&
      # If the only mechanism to avoid hardcoding is shlibpath_var, we
      # have to relink, otherwise we might link with an installed library
      # when we should be linking with a yet-to-be-installed one
-     ## test "$_LT_TAGVAR(hardcode_shlibpath_var, $1)" != no &&
-     test "$_LT_TAGVAR(hardcode_minus_L, $1)" != no; then
+     ## test no != "$_LT_TAGVAR(hardcode_shlibpath_var, $1)" &&
+     test no != "$_LT_TAGVAR(hardcode_minus_L, $1)"; then
     # Linking always hardcodes the temporary library directory.
     _LT_TAGVAR(hardcode_action, $1)=relink
   else
@@ -2039,12 +2186,12 @@ else
 fi
 AC_MSG_RESULT([$_LT_TAGVAR(hardcode_action, $1)])
 
-if test "$_LT_TAGVAR(hardcode_action, $1)" = relink ||
-   test "$_LT_TAGVAR(inherit_rpath, $1)" = yes; then
+if test relink = "$_LT_TAGVAR(hardcode_action, $1)" ||
+   test yes = "$_LT_TAGVAR(inherit_rpath, $1)"; then
   # Fast installation is not supported
   enable_fast_install=no
-elif test "$shlibpath_overrides_runpath" = yes ||
-     test "$enable_shared" = no; then
+elif test yes = "$shlibpath_overrides_runpath" ||
+     test no = "$enable_shared"; then
   # Fast installation is not necessary
   enable_fast_install=needless
 fi
@@ -2068,7 +2215,7 @@ else
 # FIXME - insert some real tests, host_os isn't really good enough
   case $host_os in
   darwin*)
-    if test -n "$STRIP" ; then
+    if test -n "$STRIP"; then
       striplib="$STRIP -x"
       old_striplib="$STRIP -S"
       AC_MSG_RESULT([yes])
@@ -2086,6 +2233,47 @@ _LT_DECL([], [striplib], [1])
 ])# _LT_CMD_STRIPLIB
 
 
+# _LT_PREPARE_MUNGE_PATH_LIST
+# ---------------------------
+# Make sure func_munge_path_list() is defined correctly.
+m4_defun([_LT_PREPARE_MUNGE_PATH_LIST],
+[[# func_munge_path_list VARIABLE PATH
+# -----------------------------------
+# VARIABLE is name of variable containing _space_ separated list of
+# directories to be munged by the contents of PATH, which is string
+# having a format:
+# "DIR[:DIR]:"
+#       string "DIR[ DIR]" will be prepended to VARIABLE
+# ":DIR[:DIR]"
+#       string "DIR[ DIR]" will be appended to VARIABLE
+# "DIRP[:DIRP]::[DIRA:]DIRA"
+#       string "DIRP[ DIRP]" will be prepended to VARIABLE and string
+#       "DIRA[ DIRA]" will be appended to VARIABLE
+# "DIR[:DIR]"
+#       VARIABLE will be replaced by "DIR[ DIR]"
+func_munge_path_list ()
+{
+    case x@S|@2 in
+    x)
+        ;;
+    *:)
+        eval @S|@1=\"`$ECHO @S|@2 | $SED 's/:/ /g'` \@S|@@S|@1\"
+        ;;
+    x:*)
+        eval @S|@1=\"\@S|@@S|@1 `$ECHO @S|@2 | $SED 's/:/ /g'`\"
+        ;;
+    *::*)
+        eval @S|@1=\"\@S|@@S|@1\ `$ECHO @S|@2 | $SED -e 's/.*:://' -e 's/:/ /g'`\"
+        eval @S|@1=\"`$ECHO @S|@2 | $SED -e 's/::.*//' -e 's/:/ /g'`\ \@S|@@S|@1\"
+        ;;
+    *)
+        eval @S|@1=\"`$ECHO @S|@2 | $SED 's/:/ /g'`\"
+        ;;
+    esac
+}
+]])# _LT_PREPARE_PATH_LIST
+
+
 # _LT_SYS_DYNAMIC_LINKER([TAG])
 # -----------------------------
 # PORTME Fill in your ld.so characteristics
@@ -2096,17 +2284,18 @@ m4_require([_LT_FILEUTILS_DEFAULTS])dnl
 m4_require([_LT_DECL_OBJDUMP])dnl
 m4_require([_LT_DECL_SED])dnl
 m4_require([_LT_CHECK_SHELL_FEATURES])dnl
+m4_require([_LT_PREPARE_MUNGE_PATH_LIST])dnl
 AC_MSG_CHECKING([dynamic linker characteristics])
 m4_if([$1],
 	[], [
-if test "$GCC" = yes; then
+if test yes = "$GCC"; then
   case $host_os in
-    darwin*) lt_awk_arg="/^libraries:/,/LR/" ;;
-    *) lt_awk_arg="/^libraries:/" ;;
+    darwin*) lt_awk_arg='/^libraries:/,/LR/' ;;
+    *) lt_awk_arg='/^libraries:/' ;;
   esac
   case $host_os in
-    mingw* | cegcc*) lt_sed_strip_eq="s,=\([[A-Za-z]]:\),\1,g" ;;
-    *) lt_sed_strip_eq="s,=/,/,g" ;;
+    mingw* | cegcc*) lt_sed_strip_eq='s|=\([[A-Za-z]]:\)|\1|g' ;;
+    *) lt_sed_strip_eq='s|=/|/|g' ;;
   esac
   lt_search_path_spec=`$CC -print-search-dirs | awk $lt_awk_arg | $SED -e "s/^libraries://" -e $lt_sed_strip_eq`
   case $lt_search_path_spec in
@@ -2122,28 +2311,35 @@ if test "$GCC" = yes; then
     ;;
   esac
   # Ok, now we have the path, separated by spaces, we can step through it
-  # and add multilib dir if necessary.
+  # and add multilib dir if necessary...
   lt_tmp_lt_search_path_spec=
-  lt_multi_os_dir=`$CC $CPPFLAGS $CFLAGS $LDFLAGS -print-multi-os-directory 2>/dev/null`
+  lt_multi_os_dir=/`$CC $CPPFLAGS $CFLAGS $LDFLAGS -print-multi-os-directory 2>/dev/null`
+  # ...but if some path component already ends with the multilib dir we assume
+  # that all is fine and trust -print-search-dirs as is (GCC 4.2? or newer).
+  case "$lt_multi_os_dir; $lt_search_path_spec " in
+  "/; "* | "/.; "* | "/./; "* | *"$lt_multi_os_dir "* | *"$lt_multi_os_dir/ "*)
+    lt_multi_os_dir=
+    ;;
+  esac
   for lt_sys_path in $lt_search_path_spec; do
-    if test -d "$lt_sys_path/$lt_multi_os_dir"; then
-      lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path/$lt_multi_os_dir"
-    else
+    if test -d "$lt_sys_path$lt_multi_os_dir"; then
+      lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path$lt_multi_os_dir"
+    elif test -n "$lt_multi_os_dir"; then
       test -d "$lt_sys_path" && \
 	lt_tmp_lt_search_path_spec="$lt_tmp_lt_search_path_spec $lt_sys_path"
     fi
   done
   lt_search_path_spec=`$ECHO "$lt_tmp_lt_search_path_spec" | awk '
-BEGIN {RS=" "; FS="/|\n";} {
-  lt_foo="";
-  lt_count=0;
+BEGIN {RS = " "; FS = "/|\n";} {
+  lt_foo = "";
+  lt_count = 0;
   for (lt_i = NF; lt_i > 0; lt_i--) {
     if ($lt_i != "" && $lt_i != ".") {
       if ($lt_i == "..") {
         lt_count++;
       } else {
         if (lt_count == 0) {
-          lt_foo="/" $lt_i lt_foo;
+          lt_foo = "/" $lt_i lt_foo;
         } else {
           lt_count--;
         }
@@ -2157,7 +2353,7 @@ BEGIN {RS=" "; FS="/|\n";} {
   # for these hosts.
   case $host_os in
     mingw* | cegcc*) lt_search_path_spec=`$ECHO "$lt_search_path_spec" |\
-      $SED 's,/\([[A-Za-z]]:\),\1,g'` ;;
+      $SED 's|/\([[A-Za-z]]:\)|\1|g'` ;;
   esac
   sys_lib_search_path_spec=`$ECHO "$lt_search_path_spec" | $lt_NL2SP`
 else
@@ -2166,7 +2362,7 @@ fi])
 library_names_spec=
 libname_spec='lib$name'
 soname_spec=
-shrext_cmds=".so"
+shrext_cmds=.so
 postinstall_cmds=
 postuninstall_cmds=
 finish_cmds=
@@ -2183,56 +2379,109 @@ hardcode_into_libs=no
 # flags to be left without arguments
 need_version=unknown
 
+AC_ARG_VAR([LT_SYS_LIBRARY_PATH],
+[User-defined run-time library search path.])
+
 case $host_os in
 aix3*)
-  version_type=linux
-  library_names_spec='${libname}${release}${shared_ext}$versuffix $libname.a'
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='$libname$release$shared_ext$versuffix $libname.a'
   shlibpath_var=LIBPATH
 
   # AIX 3 has no versioning support, so we append a major version to the name.
-  soname_spec='${libname}${release}${shared_ext}$major'
+  soname_spec='$libname$release$shared_ext$major'
   ;;
 
 aix[[4-9]]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   hardcode_into_libs=yes
-  if test "$host_cpu" = ia64; then
+  if test ia64 = "$host_cpu"; then
     # AIX 5 supports IA64
-    library_names_spec='${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext}$versuffix $libname${shared_ext}'
+    library_names_spec='$libname$release$shared_ext$major $libname$release$shared_ext$versuffix $libname$shared_ext'
     shlibpath_var=LD_LIBRARY_PATH
   else
     # With GCC up to 2.95.x, collect2 would create an import file
     # for dependence libraries.  The import file would start with
-    # the line `#! .'.  This would cause the generated library to
-    # depend on `.', always an invalid library.  This was fixed in
+    # the line '#! .'.  This would cause the generated library to
+    # depend on '.', always an invalid library.  This was fixed in
     # development snapshots of GCC prior to 3.0.
     case $host_os in
       aix4 | aix4.[[01]] | aix4.[[01]].*)
       if { echo '#if __GNUC__ > 2 || (__GNUC__ == 2 && __GNUC_MINOR__ >= 97)'
 	   echo ' yes '
-	   echo '#endif'; } | ${CC} -E - | $GREP yes > /dev/null; then
+	   echo '#endif'; } | $CC -E - | $GREP yes > /dev/null; then
 	:
       else
 	can_build_shared=no
       fi
       ;;
     esac
-    # AIX (on Power*) has no versioning support, so currently we can not hardcode correct
+    # Using Import Files as archive members, it is possible to support
+    # filename-based versioning of shared library archives on AIX. While
+    # this would work for both with and without runtime linking, it will
+    # prevent static linking of such archives. So we do filename-based
+    # shared library versioning with .so extension only, which is used
+    # when both runtime linking and shared linking is enabled.
+    # Unfortunately, runtime linking may impact performance, so we do
+    # not want this to be the default eventually. Also, we use the
+    # versioned .so libs for executables only if there is the -brtl
+    # linker flag in LDFLAGS as well, or --with-aix-soname=svr4 only.
+    # To allow for filename-based versioning support, we need to create
+    # libNAME.so.V as an archive file, containing:
+    # *) an Import File, referring to the versioned filename of the
+    #    archive as well as the shared archive member, telling the
+    #    bitwidth (32 or 64) of that shared object, and providing the
+    #    list of exported symbols of that shared object, eventually
+    #    decorated with the 'weak' keyword
+    # *) the shared object with the F_LOADONLY flag set, to really avoid
+    #    it being seen by the linker.
+    # At run time we better use the real file rather than another symlink,
+    # but for link time we create the symlink libNAME.so -> libNAME.so.V
+
+    case $with_aix_soname,$aix_use_runtimelinking in
+    # AIX (on Power*) has no versioning support, so currently we cannot hardcode correct
     # soname into executable. Probably we can add versioning support to
     # collect2, so additional links can be useful in future.
-    if test "$aix_use_runtimelinking" = yes; then
+    aix,yes) # traditional libtool
+      dynamic_linker='AIX unversionable lib.so'
       # If using run time linking (on AIX 4.2 or later) use lib<name>.so
       # instead of lib<name>.a to let people know that these are not
       # typical AIX shared libraries.
-      library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-    else
+      library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+      ;;
+    aix,no) # traditional AIX only
+      dynamic_linker='AIX lib.a[(]lib.so.V[)]'
       # We preserve .a as extension for shared libraries through AIX4.2
       # and later when we are not doing run time linking.
-      library_names_spec='${libname}${release}.a $libname.a'
-      soname_spec='${libname}${release}${shared_ext}$major'
-    fi
+      library_names_spec='$libname$release.a $libname.a'
+      soname_spec='$libname$release$shared_ext$major'
+      ;;
+    svr4,*) # full svr4 only
+      dynamic_linker="AIX lib.so.V[(]$shared_archive_member_spec.o[)]"
+      library_names_spec='$libname$release$shared_ext$major $libname$shared_ext'
+      # We do not specify a path in Import Files, so LIBPATH fires.
+      shlibpath_overrides_runpath=yes
+      ;;
+    *,yes) # both, prefer svr4
+      dynamic_linker="AIX lib.so.V[(]$shared_archive_member_spec.o[)], lib.a[(]lib.so.V[)]"
+      library_names_spec='$libname$release$shared_ext$major $libname$shared_ext'
+      # unpreferred sharedlib libNAME.a needs extra handling
+      postinstall_cmds='test -n "$linkname" || linkname="$realname"~func_stripname "" ".so" "$linkname"~$install_shared_prog "$dir/$func_stripname_result.$libext" "$destdir/$func_stripname_result.$libext"~test -z "$tstripme" || test -z "$striplib" || $striplib "$destdir/$func_stripname_result.$libext"'
+      postuninstall_cmds='for n in $library_names $old_library; do :; done~func_stripname "" ".so" "$n"~test "$func_stripname_result" = "$n" || func_append rmfiles " $odir/$func_stripname_result.$libext"'
+      # We do not specify a path in Import Files, so LIBPATH fires.
+      shlibpath_overrides_runpath=yes
+      ;;
+    *,no) # both, prefer aix
+      dynamic_linker="AIX lib.a[(]lib.so.V[)], lib.so.V[(]$shared_archive_member_spec.o[)]"
+      library_names_spec='$libname$release.a $libname.a'
+      soname_spec='$libname$release$shared_ext$major'
+      # unpreferred sharedlib libNAME.so.V and symlink libNAME.so need extra handling
+      postinstall_cmds='test -z "$dlname" || $install_shared_prog $dir/$dlname $destdir/$dlname~test -z "$tstripme" || test -z "$striplib" || $striplib $destdir/$dlname~test -n "$linkname" || linkname=$realname~func_stripname "" ".a" "$linkname"~(cd "$destdir" && $LN_S -f $dlname $func_stripname_result.so)'
+      postuninstall_cmds='test -z "$dlname" || func_append rmfiles " $odir/$dlname"~for n in $old_library $library_names; do :; done~func_stripname "" ".a" "$n"~func_append rmfiles " $odir/$func_stripname_result.so"'
+      ;;
+    esac
     shlibpath_var=LIBPATH
   fi
   ;;
@@ -2242,27 +2491,27 @@ amigaos*)
   powerpc)
     # Since July 2007 AmigaOS4 officially supports .so libraries.
     # When compiling the executable, add -use-dynld -Lsobjs: to the compileline.
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+    library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
     ;;
   m68k)
     library_names_spec='$libname.ixlibrary $libname.a'
     # Create ${libname}_ixlibrary.a entries in /sys/libs.
-    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`func_echo_all "$lib" | $SED '\''s%^.*/\([[^/]]*\)\.ixlibrary$%\1%'\''`; test $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
+    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`func_echo_all "$lib" | $SED '\''s%^.*/\([[^/]]*\)\.ixlibrary$%\1%'\''`; $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
     ;;
   esac
   ;;
 
 beos*)
-  library_names_spec='${libname}${shared_ext}'
+  library_names_spec='$libname$shared_ext'
   dynamic_linker="$host_os ld.so"
   shlibpath_var=LIBRARY_PATH
   ;;
 
 bsdi[[45]]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   finish_cmds='PATH="\$PATH:/sbin" ldconfig $libdir'
   shlibpath_var=LD_LIBRARY_PATH
   sys_lib_search_path_spec="/shlib /usr/lib /usr/X11/lib /usr/contrib/lib /lib /usr/local/lib"
@@ -2274,7 +2523,7 @@ bsdi[[45]]*)
 
 cygwin* | mingw* | pw32* | cegcc*)
   version_type=windows
-  shrext_cmds=".dll"
+  shrext_cmds=.dll
   need_version=no
   need_lib_prefix=no
 
@@ -2283,8 +2532,8 @@ cygwin* | mingw* | pw32* | cegcc*)
     # gcc
     library_names_spec='$libname.dll.a'
     # DLL is installed to $(libdir)/../bin by postinstall_cmds
-    postinstall_cmds='base_file=`basename \${file}`~
-      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
+    postinstall_cmds='base_file=`basename \$file`~
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\$base_file'\''i; echo \$dlname'\''`~
       dldir=$destdir/`dirname \$dlpath`~
       test -d \$dldir || mkdir -p \$dldir~
       $install_prog $dir/$dlname \$dldir/$dlname~
@@ -2300,17 +2549,17 @@ cygwin* | mingw* | pw32* | cegcc*)
     case $host_os in
     cygwin*)
       # Cygwin DLLs use 'cyg' prefix rather than 'lib'
-      soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
+      soname_spec='`echo $libname | sed -e 's/^lib/cyg/'``echo $release | $SED -e 's/[[.]]/-/g'`$versuffix$shared_ext'
 m4_if([$1], [],[
       sys_lib_search_path_spec="$sys_lib_search_path_spec /usr/lib/w32api"])
       ;;
     mingw* | cegcc*)
       # MinGW DLLs use traditional 'lib' prefix
-      soname_spec='${libname}`echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
+      soname_spec='$libname`echo $release | $SED -e 's/[[.]]/-/g'`$versuffix$shared_ext'
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
-      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
+      library_names_spec='`echo $libname | sed -e 's/^lib/pw/'``echo $release | $SED -e 's/[[.]]/-/g'`$versuffix$shared_ext'
       ;;
     esac
     dynamic_linker='Win32 ld.exe'
@@ -2319,8 +2568,8 @@ m4_if([$1], [],[
   *,cl*)
     # Native MSVC
     libname_spec='$name'
-    soname_spec='${libname}`echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
-    library_names_spec='${libname}.dll.lib'
+    soname_spec='$libname`echo $release | $SED -e 's/[[.]]/-/g'`$versuffix$shared_ext'
+    library_names_spec='$libname.dll.lib'
 
     case $build_os in
     mingw*)
@@ -2347,7 +2596,7 @@ m4_if([$1], [],[
       sys_lib_search_path_spec=`cygpath --path --unix "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
       ;;
     *)
-      sys_lib_search_path_spec="$LIB"
+      sys_lib_search_path_spec=$LIB
       if $ECHO "$sys_lib_search_path_spec" | [$GREP ';[c-zC-Z]:/' >/dev/null]; then
         # It is most probably a Windows format PATH.
         sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
@@ -2360,8 +2609,8 @@ m4_if([$1], [],[
     esac
 
     # DLL is installed to $(libdir)/../bin by postinstall_cmds
-    postinstall_cmds='base_file=`basename \${file}`~
-      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
+    postinstall_cmds='base_file=`basename \$file`~
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\$base_file'\''i; echo \$dlname'\''`~
       dldir=$destdir/`dirname \$dlpath`~
       test -d \$dldir || mkdir -p \$dldir~
       $install_prog $dir/$dlname \$dldir/$dlname'
@@ -2374,7 +2623,7 @@ m4_if([$1], [],[
 
   *)
     # Assume MSVC wrapper
-    library_names_spec='${libname}`echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext} $libname.lib'
+    library_names_spec='$libname`echo $release | $SED -e 's/[[.]]/-/g'`$versuffix$shared_ext $libname.lib'
     dynamic_linker='Win32 ld.exe'
     ;;
   esac
@@ -2387,8 +2636,8 @@ darwin* | rhapsody*)
   version_type=darwin
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${major}$shared_ext ${libname}$shared_ext'
-  soname_spec='${libname}${release}${major}$shared_ext'
+  library_names_spec='$libname$release$major$shared_ext $libname$shared_ext'
+  soname_spec='$libname$release$major$shared_ext'
   shlibpath_overrides_runpath=yes
   shlibpath_var=DYLD_LIBRARY_PATH
   shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
@@ -2398,18 +2647,14 @@ m4_if([$1], [],[
   ;;
 
 dgux*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname$shared_ext'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   shlibpath_var=LD_LIBRARY_PATH
   ;;
 
-freebsd1*)
-  dynamic_linker=no
-  ;;
-
 freebsd* | dragonfly*)
   # DragonFly does not have aout.  When/if they implement a new
   # versioning mechanism, adjust this.
@@ -2417,25 +2662,26 @@ freebsd* | dragonfly*)
     objformat=`/usr/bin/objformat`
   else
     case $host_os in
-    freebsd[[123]]*) objformat=aout ;;
+    freebsd[[23]].*) objformat=aout ;;
     *) objformat=elf ;;
     esac
   fi
   version_type=freebsd-$objformat
   case $version_type in
     freebsd-elf*)
-      library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext} $libname${shared_ext}'
+      library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+      soname_spec='$libname$release$shared_ext$major'
       need_version=no
       need_lib_prefix=no
       ;;
     freebsd-*)
-      library_names_spec='${libname}${release}${shared_ext}$versuffix $libname${shared_ext}$versuffix'
+      library_names_spec='$libname$release$shared_ext$versuffix $libname$shared_ext$versuffix'
       need_version=yes
       ;;
   esac
   shlibpath_var=LD_LIBRARY_PATH
   case $host_os in
-  freebsd2*)
+  freebsd2.*)
     shlibpath_overrides_runpath=yes
     ;;
   freebsd3.[[01]]* | freebsdelf3.[[01]]*)
@@ -2454,25 +2700,15 @@ freebsd* | dragonfly*)
   esac
   ;;
 
-gnu*)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  hardcode_into_libs=yes
-  ;;
-
 haiku*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
   dynamic_linker="$host_os runtime_loader"
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   shlibpath_var=LIBRARY_PATH
-  shlibpath_overrides_runpath=yes
+  shlibpath_overrides_runpath=no
   sys_lib_dlsearch_path_spec='/boot/home/config/lib /boot/common/lib /boot/system/lib'
   hardcode_into_libs=yes
   ;;
@@ -2490,14 +2726,15 @@ hpux9* | hpux10* | hpux11*)
     dynamic_linker="$host_os dld.so"
     shlibpath_var=LD_LIBRARY_PATH
     shlibpath_overrides_runpath=yes # Unless +noenvvar is specified.
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-    soname_spec='${libname}${release}${shared_ext}$major'
-    if test "X$HPUX_IA64_MODE" = X32; then
+    library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+    soname_spec='$libname$release$shared_ext$major'
+    if test 32 = "$HPUX_IA64_MODE"; then
       sys_lib_search_path_spec="/usr/lib/hpux32 /usr/local/lib/hpux32 /usr/local/lib"
+      sys_lib_dlsearch_path_spec=/usr/lib/hpux32
     else
       sys_lib_search_path_spec="/usr/lib/hpux64 /usr/local/lib/hpux64"
+      sys_lib_dlsearch_path_spec=/usr/lib/hpux64
     fi
-    sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
     ;;
   hppa*64*)
     shrext_cmds='.sl'
@@ -2505,8 +2742,8 @@ hpux9* | hpux10* | hpux11*)
     dynamic_linker="$host_os dld.sl"
     shlibpath_var=LD_LIBRARY_PATH # How should we handle SHLIB_PATH
     shlibpath_overrides_runpath=yes # Unless +noenvvar is specified.
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-    soname_spec='${libname}${release}${shared_ext}$major'
+    library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+    soname_spec='$libname$release$shared_ext$major'
     sys_lib_search_path_spec="/usr/lib/pa20_64 /usr/ccs/lib/pa20_64"
     sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
     ;;
@@ -2515,8 +2752,8 @@ hpux9* | hpux10* | hpux11*)
     dynamic_linker="$host_os dld.sl"
     shlibpath_var=SHLIB_PATH
     shlibpath_overrides_runpath=no # +s is required to enable SHLIB_PATH
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-    soname_spec='${libname}${release}${shared_ext}$major'
+    library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+    soname_spec='$libname$release$shared_ext$major'
     ;;
   esac
   # HP-UX runs *really* slowly unless shared libraries are mode 555, ...
@@ -2526,11 +2763,11 @@ hpux9* | hpux10* | hpux11*)
   ;;
 
 interix[[3-9]]*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   dynamic_linker='Interix 3.x ld.so.1 (PE, like ELF)'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=no
@@ -2541,16 +2778,16 @@ irix5* | irix6* | nonstopux*)
   case $host_os in
     nonstopux*) version_type=nonstopux ;;
     *)
-	if test "$lt_cv_prog_gnu_ld" = yes; then
-		version_type=linux
+	if test yes = "$lt_cv_prog_gnu_ld"; then
+		version_type=linux # correct to gnu/linux during the next big refactor
 	else
 		version_type=irix
 	fi ;;
   esac
   need_lib_prefix=no
   need_version=no
-  soname_spec='${libname}${release}${shared_ext}$major'
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext} $libname${shared_ext}'
+  soname_spec='$libname$release$shared_ext$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$release$shared_ext $libname$shared_ext'
   case $host_os in
   irix5* | nonstopux*)
     libsuff= shlibsuff=
@@ -2569,8 +2806,8 @@ irix5* | irix6* | nonstopux*)
   esac
   shlibpath_var=LD_LIBRARY${shlibsuff}_PATH
   shlibpath_overrides_runpath=no
-  sys_lib_search_path_spec="/usr/lib${libsuff} /lib${libsuff} /usr/local/lib${libsuff}"
-  sys_lib_dlsearch_path_spec="/usr/lib${libsuff} /lib${libsuff}"
+  sys_lib_search_path_spec="/usr/lib$libsuff /lib$libsuff /usr/local/lib$libsuff"
+  sys_lib_dlsearch_path_spec="/usr/lib$libsuff /lib$libsuff"
   hardcode_into_libs=yes
   ;;
 
@@ -2579,13 +2816,33 @@ linux*oldld* | linux*aout* | linux*coff*
   dynamic_linker=no
   ;;
 
-# This must be Linux ELF.
-linux* | k*bsd*-gnu | kopensolaris*-gnu)
-  version_type=linux
+linux*android*)
+  version_type=none # Android doesn't support versioned libraries.
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext'
+  soname_spec='$libname$release$shared_ext'
+  finish_cmds=
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+
+  # This implies no fast_install, which is unacceptable.
+  # Some rework will be needed to allow for fast_install
+  # before this can be enabled.
+  hardcode_into_libs=yes
+
+  dynamic_linker='Android linker'
+  # Don't embed -rpath directories since the linker doesn't support them.
+  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
+  ;;
+
+# This must be glibc/ELF.
+linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   finish_cmds='PATH="\$PATH:/sbin" ldconfig -n $libdir'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=no
@@ -2610,7 +2867,12 @@ linux* | k*bsd*-gnu | kopensolaris*-gnu)
   # before this can be enabled.
   hardcode_into_libs=yes
 
-  # Append ld.so.conf contents to the search path
+  # Ideally, we could use ldconfig to report *all* directores which are
+  # searched for libraries, however this is still not possible.  Aside from not
+  # being certain /sbin/ldconfig is available, command
+  # 'ldconfig -N -X -v | grep ^/' on 64bit Fedora does not report /usr/lib64,
+  # even though it is searched at run-time.  Try to do the best guess by
+  # appending ld.so.conf contents (and includes) to the search path.
   if test -f /etc/ld.so.conf; then
     lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s 2>/dev/null", \[$]2)); skip = 1; } { if (!skip) print \[$]0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;/^[	 ]*hwcap[	 ]/d;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;s/"//g;/^$/d' | tr '\n' ' '`
     sys_lib_dlsearch_path_spec="/lib /usr/lib $lt_ld_extra"
@@ -2630,12 +2892,12 @@ netbsd*)
   need_lib_prefix=no
   need_version=no
   if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
+    library_names_spec='$libname$release$shared_ext$versuffix $libname$shared_ext$versuffix'
     finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
     dynamic_linker='NetBSD (a.out) ld.so'
   else
-    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-    soname_spec='${libname}${release}${shared_ext}$major'
+    library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+    soname_spec='$libname$release$shared_ext$major'
     dynamic_linker='NetBSD ld.elf_so'
   fi
   shlibpath_var=LD_LIBRARY_PATH
@@ -2644,8 +2906,8 @@ netbsd*)
   ;;
 
 newsos6)
-  version_type=linux
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
   ;;
@@ -2654,58 +2916,68 @@ newsos6)
   version_type=qnx
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=no
   hardcode_into_libs=yes
   dynamic_linker='ldqnx.so'
   ;;
 
-openbsd*)
+openbsd* | bitrig*)
   version_type=sunos
-  sys_lib_dlsearch_path_spec="/usr/lib"
+  sys_lib_dlsearch_path_spec=/usr/lib
   need_lib_prefix=no
-  # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
-  case $host_os in
-    openbsd3.3 | openbsd3.3.*)	need_version=yes ;;
-    *)				need_version=no  ;;
-  esac
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
-  finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
-  shlibpath_var=LD_LIBRARY_PATH
-  if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
-    case $host_os in
-      openbsd2.[[89]] | openbsd2.[[89]].*)
-	shlibpath_overrides_runpath=no
-	;;
-      *)
-	shlibpath_overrides_runpath=yes
-	;;
-      esac
+  if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`"; then
+    need_version=no
   else
-    shlibpath_overrides_runpath=yes
+    need_version=yes
   fi
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$shared_ext$versuffix'
+  finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
   ;;
 
 os2*)
   libname_spec='$name'
-  shrext_cmds=".dll"
+  version_type=windows
+  shrext_cmds=.dll
+  need_version=no
   need_lib_prefix=no
-  library_names_spec='$libname${shared_ext} $libname.a'
+  # OS/2 can only load a DLL with a base name of 8 characters or less.
+  soname_spec='`test -n "$os2dllname" && libname="$os2dllname";
+    v=$($ECHO $release$versuffix | tr -d .-);
+    n=$($ECHO $libname | cut -b -$((8 - ${#v})) | tr . _);
+    $ECHO $n$v`$shared_ext'
+  library_names_spec='${libname}_dll.$libext'
   dynamic_linker='OS/2 ld.exe'
-  shlibpath_var=LIBPATH
+  shlibpath_var=BEGINLIBPATH
+  sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib"
+  sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
+  postinstall_cmds='base_file=`basename \$file`~
+    dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\$base_file'\''i; $ECHO \$dlname'\''`~
+    dldir=$destdir/`dirname \$dlpath`~
+    test -d \$dldir || mkdir -p \$dldir~
+    $install_prog $dir/$dlname \$dldir/$dlname~
+    chmod a+x \$dldir/$dlname~
+    if test -n '\''$stripme'\'' && test -n '\''$striplib'\''; then
+      eval '\''$striplib \$dldir/$dlname'\'' || exit \$?;
+    fi'
+  postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; $ECHO \$dlname'\''`~
+    dlpath=$dir/\$dldll~
+    $RM \$dlpath'
   ;;
 
 osf3* | osf4* | osf5*)
   version_type=osf
   need_lib_prefix=no
   need_version=no
-  soname_spec='${libname}${release}${shared_ext}$major'
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='$libname$release$shared_ext$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
   shlibpath_var=LD_LIBRARY_PATH
   sys_lib_search_path_spec="/usr/shlib /usr/ccs/lib /usr/lib/cmplrs/cc /usr/lib /usr/local/lib /var/shlib"
-  sys_lib_dlsearch_path_spec="$sys_lib_search_path_spec"
+  sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
   ;;
 
 rdos*)
@@ -2713,11 +2985,11 @@ rdos*)
   ;;
 
 solaris*)
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
   hardcode_into_libs=yes
@@ -2727,20 +2999,20 @@ solaris*)
 
 sunos4*)
   version_type=sunos
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$shared_ext$versuffix'
   finish_cmds='PATH="\$PATH:/usr/etc" ldconfig $libdir'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
-  if test "$with_gnu_ld" = yes; then
+  if test yes = "$with_gnu_ld"; then
     need_lib_prefix=no
   fi
   need_version=yes
   ;;
 
 sysv4 | sysv4.3*)
-  version_type=linux
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   shlibpath_var=LD_LIBRARY_PATH
   case $host_vendor in
     sni)
@@ -2761,24 +3033,24 @@ sysv4 | sysv4.3*)
   ;;
 
 sysv4*MP*)
-  if test -d /usr/nec ;then
-    version_type=linux
-    library_names_spec='$libname${shared_ext}.$versuffix $libname${shared_ext}.$major $libname${shared_ext}'
-    soname_spec='$libname${shared_ext}.$major'
+  if test -d /usr/nec; then
+    version_type=linux # correct to gnu/linux during the next big refactor
+    library_names_spec='$libname$shared_ext.$versuffix $libname$shared_ext.$major $libname$shared_ext'
+    soname_spec='$libname$shared_ext.$major'
     shlibpath_var=LD_LIBRARY_PATH
   fi
   ;;
 
 sysv5* | sco3.2v5* | sco5v6* | unixware* | OpenUNIX* | sysv4*uw2*)
-  version_type=freebsd-elf
+  version_type=sco
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext} $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
   hardcode_into_libs=yes
-  if test "$with_gnu_ld" = yes; then
+  if test yes = "$with_gnu_ld"; then
     sys_lib_search_path_spec='/usr/local/lib /usr/gnu/lib /usr/ccs/lib /usr/lib /lib'
   else
     sys_lib_search_path_spec='/usr/ccs/lib /usr/lib'
@@ -2793,19 +3065,19 @@ sysv5* | sco3.2v5* | sco5v6* | unixware*
 
 tpf*)
   # TPF is a cross-target only.  Preferred cross-host = GNU/Linux.
-  version_type=linux
+  version_type=linux # correct to gnu/linux during the next big refactor
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=no
   hardcode_into_libs=yes
   ;;
 
 uts4*)
-  version_type=linux
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='$libname$release$shared_ext$versuffix $libname$release$shared_ext$major $libname$shared_ext'
+  soname_spec='$libname$release$shared_ext$major'
   shlibpath_var=LD_LIBRARY_PATH
   ;;
 
@@ -2814,20 +3086,30 @@ uts4*)
   ;;
 esac
 AC_MSG_RESULT([$dynamic_linker])
-test "$dynamic_linker" = no && can_build_shared=no
+test no = "$dynamic_linker" && can_build_shared=no
 
 variables_saved_for_relink="PATH $shlibpath_var $runpath_var"
-if test "$GCC" = yes; then
+if test yes = "$GCC"; then
   variables_saved_for_relink="$variables_saved_for_relink GCC_EXEC_PREFIX COMPILER_PATH LIBRARY_PATH"
 fi
 
-if test "${lt_cv_sys_lib_search_path_spec+set}" = set; then
-  sys_lib_search_path_spec="$lt_cv_sys_lib_search_path_spec"
+if test set = "${lt_cv_sys_lib_search_path_spec+set}"; then
+  sys_lib_search_path_spec=$lt_cv_sys_lib_search_path_spec
 fi
-if test "${lt_cv_sys_lib_dlsearch_path_spec+set}" = set; then
-  sys_lib_dlsearch_path_spec="$lt_cv_sys_lib_dlsearch_path_spec"
+
+if test set = "${lt_cv_sys_lib_dlsearch_path_spec+set}"; then
+  sys_lib_dlsearch_path_spec=$lt_cv_sys_lib_dlsearch_path_spec
 fi
 
+# remember unaugmented sys_lib_dlsearch_path content for libtool script decls...
+configure_time_dlsearch_path=$sys_lib_dlsearch_path_spec
+
+# ... but it needs LT_SYS_LIBRARY_PATH munging for other configure-time code
+func_munge_path_list sys_lib_dlsearch_path_spec "$LT_SYS_LIBRARY_PATH"
+
+# to be used as default LT_SYS_LIBRARY_PATH value in generated libtool
+configure_time_lt_sys_library_path=$LT_SYS_LIBRARY_PATH
+
 _LT_DECL([], [variables_saved_for_relink], [1],
     [Variables whose values should be saved in libtool wrapper scripts and
     restored at link time])
@@ -2860,39 +3142,41 @@ _LT_DECL([], [hardcode_into_libs], [0],
     [Whether we should hardcode library paths into libraries])
 _LT_DECL([], [sys_lib_search_path_spec], [2],
     [Compile-time system search path for libraries])
-_LT_DECL([], [sys_lib_dlsearch_path_spec], [2],
-    [Run-time system search path for libraries])
+_LT_DECL([sys_lib_dlsearch_path_spec], [configure_time_dlsearch_path], [2],
+    [Detected run-time system search path for libraries])
+_LT_DECL([], [configure_time_lt_sys_library_path], [2],
+    [Explicit LT_SYS_LIBRARY_PATH set during ./configure time])
 ])# _LT_SYS_DYNAMIC_LINKER
 
 
 # _LT_PATH_TOOL_PREFIX(TOOL)
 # --------------------------
-# find a file program which can recognize shared library
+# find a file program that can recognize shared library
 AC_DEFUN([_LT_PATH_TOOL_PREFIX],
 [m4_require([_LT_DECL_EGREP])dnl
 AC_MSG_CHECKING([for $1])
 AC_CACHE_VAL(lt_cv_path_MAGIC_CMD,
 [case $MAGIC_CMD in
 [[\\/*] |  ?:[\\/]*])
-  lt_cv_path_MAGIC_CMD="$MAGIC_CMD" # Let the user override the test with a path.
+  lt_cv_path_MAGIC_CMD=$MAGIC_CMD # Let the user override the test with a path.
   ;;
 *)
-  lt_save_MAGIC_CMD="$MAGIC_CMD"
-  lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
+  lt_save_MAGIC_CMD=$MAGIC_CMD
+  lt_save_ifs=$IFS; IFS=$PATH_SEPARATOR
 dnl $ac_dummy forces splitting on constant user-supplied paths.
 dnl POSIX.2 word splitting is done only on the output of word expansions,
 dnl not every word.  This closes a longstanding sh security hole.
   ac_dummy="m4_if([$2], , $PATH, [$2])"
   for ac_dir in $ac_dummy; do
-    IFS="$lt_save_ifs"
+    IFS=$lt_save_ifs
     test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/$1; then
-      lt_cv_path_MAGIC_CMD="$ac_dir/$1"
+    if test -f "$ac_dir/$1"; then
+      lt_cv_path_MAGIC_CMD=$ac_dir/"$1"
       if test -n "$file_magic_test_file"; then
 	case $deplibs_check_method in
 	"file_magic "*)
 	  file_magic_regex=`expr "$deplibs_check_method" : "file_magic \(.*\)"`
-	  MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
+	  MAGIC_CMD=$lt_cv_path_MAGIC_CMD
 	  if eval $file_magic_cmd \$file_magic_test_file 2> /dev/null |
 	    $EGREP "$file_magic_regex" > /dev/null; then
 	    :
@@ -2915,11 +3199,11 @@ _LT_EOF
       break
     fi
   done
-  IFS="$lt_save_ifs"
-  MAGIC_CMD="$lt_save_MAGIC_CMD"
+  IFS=$lt_save_ifs
+  MAGIC_CMD=$lt_save_MAGIC_CMD
   ;;
 esac])
-MAGIC_CMD="$lt_cv_path_MAGIC_CMD"
+MAGIC_CMD=$lt_cv_path_MAGIC_CMD
 if test -n "$MAGIC_CMD"; then
   AC_MSG_RESULT($MAGIC_CMD)
 else
@@ -2937,7 +3221,7 @@ dnl AC_DEFUN([AC_PATH_TOOL_PREFIX], [])
 
 # _LT_PATH_MAGIC
 # --------------
-# find a file program which can recognize a shared library
+# find a file program that can recognize a shared library
 m4_defun([_LT_PATH_MAGIC],
 [_LT_PATH_TOOL_PREFIX(${ac_tool_prefix}file, /usr/bin$PATH_SEPARATOR$PATH)
 if test -z "$lt_cv_path_MAGIC_CMD"; then
@@ -2964,16 +3248,16 @@ m4_require([_LT_PROG_ECHO_BACKSLASH])dnl
 AC_ARG_WITH([gnu-ld],
     [AS_HELP_STRING([--with-gnu-ld],
 	[assume the C compiler uses GNU ld @<:@default=no@:>@])],
-    [test "$withval" = no || with_gnu_ld=yes],
+    [test no = "$withval" || with_gnu_ld=yes],
     [with_gnu_ld=no])dnl
 
 ac_prog=ld
-if test "$GCC" = yes; then
+if test yes = "$GCC"; then
   # Check if gcc -print-prog-name=ld gives a path.
   AC_MSG_CHECKING([for ld used by $CC])
   case $host in
   *-*-mingw*)
-    # gcc leaves a trailing carriage return which upsets mingw
+    # gcc leaves a trailing carriage return, which upsets mingw
     ac_prog=`($CC -print-prog-name=ld) 2>&5 | tr -d '\015'` ;;
   *)
     ac_prog=`($CC -print-prog-name=ld) 2>&5` ;;
@@ -2987,7 +3271,7 @@ if test "$GCC" = yes; then
       while $ECHO "$ac_prog" | $GREP "$re_direlt" > /dev/null 2>&1; do
 	ac_prog=`$ECHO $ac_prog| $SED "s%$re_direlt%/%"`
       done
-      test -z "$LD" && LD="$ac_prog"
+      test -z "$LD" && LD=$ac_prog
       ;;
   "")
     # If it fails, then pretend we aren't using GCC.
@@ -2998,37 +3282,37 @@ if test "$GCC" = yes; then
     with_gnu_ld=unknown
     ;;
   esac
-elif test "$with_gnu_ld" = yes; then
+elif test yes = "$with_gnu_ld"; then
   AC_MSG_CHECKING([for GNU ld])
 else
   AC_MSG_CHECKING([for non-GNU ld])
 fi
 AC_CACHE_VAL(lt_cv_path_LD,
 [if test -z "$LD"; then
-  lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
+  lt_save_ifs=$IFS; IFS=$PATH_SEPARATOR
   for ac_dir in $PATH; do
-    IFS="$lt_save_ifs"
+    IFS=$lt_save_ifs
     test -z "$ac_dir" && ac_dir=.
     if test -f "$ac_dir/$ac_prog" || test -f "$ac_dir/$ac_prog$ac_exeext"; then
-      lt_cv_path_LD="$ac_dir/$ac_prog"
+      lt_cv_path_LD=$ac_dir/$ac_prog
       # Check to see if the program is GNU ld.  I'd rather use --version,
       # but apparently some variants of GNU ld only accept -v.
       # Break only if it was the GNU/non-GNU ld that we prefer.
       case `"$lt_cv_path_LD" -v 2>&1 </dev/null` in
       *GNU* | *'with BFD'*)
-	test "$with_gnu_ld" != no && break
+	test no != "$with_gnu_ld" && break
 	;;
       *)
-	test "$with_gnu_ld" != yes && break
+	test yes != "$with_gnu_ld" && break
 	;;
       esac
     fi
   done
-  IFS="$lt_save_ifs"
+  IFS=$lt_save_ifs
 else
-  lt_cv_path_LD="$LD" # Let the user override the test with a path.
+  lt_cv_path_LD=$LD # Let the user override the test with a path.
 fi])
-LD="$lt_cv_path_LD"
+LD=$lt_cv_path_LD
 if test -n "$LD"; then
   AC_MSG_RESULT($LD)
 else
@@ -3082,13 +3366,13 @@ esac
 reload_cmds='$LD$reload_flag -o $output$reload_objs'
 case $host_os in
   cygwin* | mingw* | pw32* | cegcc*)
-    if test "$GCC" != yes; then
+    if test yes != "$GCC"; then
       reload_cmds=false
     fi
     ;;
   darwin*)
-    if test "$GCC" = yes; then
-      reload_cmds='$LTCC $LTCFLAGS -nostdlib ${wl}-r -o $output$reload_objs'
+    if test yes = "$GCC"; then
+      reload_cmds='$LTCC $LTCFLAGS -nostdlib $wl-r -o $output$reload_objs'
     else
       reload_cmds='$LD$reload_flag -o $output$reload_objs'
     fi
@@ -3099,6 +3383,43 @@ _LT_TAGDECL([], [reload_cmds], [2])dnl
 ])# _LT_CMD_RELOAD
 
 
+# _LT_PATH_DD
+# -----------
+# find a working dd
+m4_defun([_LT_PATH_DD],
+[AC_CACHE_CHECK([for a working dd], [ac_cv_path_lt_DD],
+[printf 0123456789abcdef0123456789abcdef >conftest.i
+cat conftest.i conftest.i >conftest2.i
+: ${lt_DD:=$DD}
+AC_PATH_PROGS_FEATURE_CHECK([lt_DD], [dd],
+[if "$ac_path_lt_DD" bs=32 count=1 <conftest2.i >conftest.out 2>/dev/null; then
+  cmp -s conftest.i conftest.out \
+  && ac_cv_path_lt_DD="$ac_path_lt_DD" ac_path_lt_DD_found=:
+fi])
+rm -f conftest.i conftest2.i conftest.out])
+])# _LT_PATH_DD
+
+
+# _LT_CMD_TRUNCATE
+# ----------------
+# find command to truncate a binary pipe
+m4_defun([_LT_CMD_TRUNCATE],
+[m4_require([_LT_PATH_DD])
+AC_CACHE_CHECK([how to truncate binary pipes], [lt_cv_truncate_bin],
+[printf 0123456789abcdef0123456789abcdef >conftest.i
+cat conftest.i conftest.i >conftest2.i
+lt_cv_truncate_bin=
+if "$ac_cv_path_lt_DD" bs=32 count=1 <conftest2.i >conftest.out 2>/dev/null; then
+  cmp -s conftest.i conftest.out \
+  && lt_cv_truncate_bin="$ac_cv_path_lt_DD bs=4096 count=1"
+fi
+rm -f conftest.i conftest2.i conftest.out
+test -z "$lt_cv_truncate_bin" && lt_cv_truncate_bin="$SED -e 4q"])
+_LT_DECL([lt_truncate_bin], [lt_cv_truncate_bin], [1],
+  [Command to truncate a binary pipe])
+])# _LT_CMD_TRUNCATE
+
+
 # _LT_CHECK_MAGIC_METHOD
 # ----------------------
 # how to check for library dependencies
@@ -3114,13 +3435,13 @@ lt_cv_deplibs_check_method='unknown'
 # Need to set the preceding variable on all platforms that support
 # interlibrary dependencies.
 # 'none' -- dependencies not supported.
-# `unknown' -- same as none, but documents that we really don't know.
+# 'unknown' -- same as none, but documents that we really don't know.
 # 'pass_all' -- all dependencies passed with no checks.
 # 'test_compile' -- check by making test program.
 # 'file_magic [[regex]]' -- check by looking for files in library path
-# which responds to the $file_magic_cmd with a given extended regex.
-# If you have `file' or equivalent on your system and you're not sure
-# whether `pass_all' will *always* work, you probably want this one.
+# that responds to the $file_magic_cmd with a given extended regex.
+# If you have 'file' or equivalent on your system and you're not sure
+# whether 'pass_all' will *always* work, you probably want this one.
 
 case $host_os in
 aix[[4-9]]*)
@@ -3147,8 +3468,7 @@ mingw* | pw32*)
   # Base MSYS/MinGW do not provide the 'file' command needed by
   # func_win32_libid shell function, so use a weaker test based on 'objdump',
   # unless we find 'file', for example because we are cross-compiling.
-  # func_win32_libid assumes BSD nm, so disallow it if using MS dumpbin.
-  if ( test "$lt_cv_nm_interface" = "BSD nm" && file / ) >/dev/null 2>&1; then
+  if ( file / ) >/dev/null 2>&1; then
     lt_cv_deplibs_check_method='file_magic ^x86 archive import|^x86 DLL'
     lt_cv_file_magic_cmd='func_win32_libid'
   else
@@ -3184,10 +3504,6 @@ freebsd* | dragonfly*)
   fi
   ;;
 
-gnu*)
-  lt_cv_deplibs_check_method=pass_all
-  ;;
-
 haiku*)
   lt_cv_deplibs_check_method=pass_all
   ;;
@@ -3225,8 +3541,8 @@ irix5* | irix6* | nonstopux*)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-# This must be Linux ELF.
-linux* | k*bsd*-gnu | kopensolaris*-gnu)
+# This must be glibc/ELF.
+linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
@@ -3248,8 +3564,8 @@ newos6*)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-openbsd*)
-  if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+openbsd* | bitrig*)
+  if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`"; then
     lt_cv_deplibs_check_method='match_pattern /lib[[^/]]+(\.so\.[[0-9]]+\.[[0-9]]+|\.so|_pic\.a)$'
   else
     lt_cv_deplibs_check_method='match_pattern /lib[[^/]]+(\.so\.[[0-9]]+\.[[0-9]]+|_pic\.a)$'
@@ -3302,6 +3618,9 @@ sysv4 | sysv4.3*)
 tpf*)
   lt_cv_deplibs_check_method=pass_all
   ;;
+os2*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
 esac
 ])
 
@@ -3342,33 +3661,38 @@ AC_DEFUN([LT_PATH_NM],
 AC_CACHE_CHECK([for BSD- or MS-compatible name lister (nm)], lt_cv_path_NM,
 [if test -n "$NM"; then
   # Let the user override the test.
-  lt_cv_path_NM="$NM"
+  lt_cv_path_NM=$NM
 else
-  lt_nm_to_check="${ac_tool_prefix}nm"
+  lt_nm_to_check=${ac_tool_prefix}nm
   if test -n "$ac_tool_prefix" && test "$build" = "$host"; then
     lt_nm_to_check="$lt_nm_to_check nm"
   fi
   for lt_tmp_nm in $lt_nm_to_check; do
-    lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
+    lt_save_ifs=$IFS; IFS=$PATH_SEPARATOR
     for ac_dir in $PATH /usr/ccs/bin/elf /usr/ccs/bin /usr/ucb /bin; do
-      IFS="$lt_save_ifs"
+      IFS=$lt_save_ifs
       test -z "$ac_dir" && ac_dir=.
-      tmp_nm="$ac_dir/$lt_tmp_nm"
-      if test -f "$tmp_nm" || test -f "$tmp_nm$ac_exeext" ; then
+      tmp_nm=$ac_dir/$lt_tmp_nm
+      if test -f "$tmp_nm" || test -f "$tmp_nm$ac_exeext"; then
 	# Check to see if the nm accepts a BSD-compat flag.
-	# Adding the `sed 1q' prevents false positives on HP-UX, which says:
+	# Adding the 'sed 1q' prevents false positives on HP-UX, which says:
 	#   nm: unknown option "B" ignored
 	# Tru64's nm complains that /dev/null is an invalid object file
-	case `"$tmp_nm" -B /dev/null 2>&1 | sed '1q'` in
-	*/dev/null* | *'Invalid file or object type'*)
+	# MSYS converts /dev/null to NUL, MinGW nm treats NUL as empty
+	case $build_os in
+	mingw*) lt_bad_file=conftest.nm/nofile ;;
+	*) lt_bad_file=/dev/null ;;
+	esac
+	case `"$tmp_nm" -B $lt_bad_file 2>&1 | sed '1q'` in
+	*$lt_bad_file* | *'Invalid file or object type'*)
 	  lt_cv_path_NM="$tmp_nm -B"
-	  break
+	  break 2
 	  ;;
 	*)
 	  case `"$tmp_nm" -p /dev/null 2>&1 | sed '1q'` in
 	  */dev/null*)
 	    lt_cv_path_NM="$tmp_nm -p"
-	    break
+	    break 2
 	    ;;
 	  *)
 	    lt_cv_path_NM=${lt_cv_path_NM="$tmp_nm"} # keep the first match, but
@@ -3379,21 +3703,21 @@ else
 	esac
       fi
     done
-    IFS="$lt_save_ifs"
+    IFS=$lt_save_ifs
   done
   : ${lt_cv_path_NM=no}
 fi])
-if test "$lt_cv_path_NM" != "no"; then
-  NM="$lt_cv_path_NM"
+if test no != "$lt_cv_path_NM"; then
+  NM=$lt_cv_path_NM
 else
   # Didn't find any BSD compatible name lister, look for dumpbin.
   if test -n "$DUMPBIN"; then :
     # Let the user override the test.
   else
     AC_CHECK_TOOLS(DUMPBIN, [dumpbin "link -dump"], :)
-    case `$DUMPBIN -symbols /dev/null 2>&1 | sed '1q'` in
+    case `$DUMPBIN -symbols -headers /dev/null 2>&1 | sed '1q'` in
     *COFF*)
-      DUMPBIN="$DUMPBIN -symbols"
+      DUMPBIN="$DUMPBIN -symbols -headers"
       ;;
     *)
       DUMPBIN=:
@@ -3401,8 +3725,8 @@ else
     esac
   fi
   AC_SUBST([DUMPBIN])
-  if test "$DUMPBIN" != ":"; then
-    NM="$DUMPBIN"
+  if test : != "$DUMPBIN"; then
+    NM=$DUMPBIN
   fi
 fi
 test -z "$NM" && NM=nm
@@ -3448,8 +3772,8 @@ lt_cv_sharedlib_from_linklib_cmd,
 
 case $host_os in
 cygwin* | mingw* | pw32* | cegcc*)
-  # two different shell functions defined in ltmain.sh
-  # decide which to use based on capabilities of $DLLTOOL
+  # two different shell functions defined in ltmain.sh;
+  # decide which one to use based on capabilities of $DLLTOOL
   case `$DLLTOOL --help 2>&1` in
   *--identify-strict*)
     lt_cv_sharedlib_from_linklib_cmd=func_cygming_dll_for_implib
@@ -3461,7 +3785,7 @@ cygwin* | mingw* | pw32* | cegcc*)
   ;;
 *)
   # fallback: assume linklib IS sharedlib
-  lt_cv_sharedlib_from_linklib_cmd="$ECHO"
+  lt_cv_sharedlib_from_linklib_cmd=$ECHO
   ;;
 esac
 ])
@@ -3488,13 +3812,28 @@ AC_CACHE_CHECK([if $MANIFEST_TOOL is a m
     lt_cv_path_mainfest_tool=yes
   fi
   rm -f conftest*])
-if test "x$lt_cv_path_mainfest_tool" != xyes; then
+if test yes != "$lt_cv_path_mainfest_tool"; then
   MANIFEST_TOOL=:
 fi
 _LT_DECL([], [MANIFEST_TOOL], [1], [Manifest tool])dnl
 ])# _LT_PATH_MANIFEST_TOOL
 
 
+# _LT_DLL_DEF_P([FILE])
+# ---------------------
+# True iff FILE is a Windows DLL '.def' file.
+# Keep in sync with func_dll_def_p in the libtool script
+AC_DEFUN([_LT_DLL_DEF_P],
+[dnl
+  test DEF = "`$SED -n dnl
+    -e '\''s/^[[	 ]]*//'\'' dnl Strip leading whitespace
+    -e '\''/^\(;.*\)*$/d'\'' dnl      Delete empty lines and comments
+    -e '\''s/^\(EXPORTS\|LIBRARY\)\([[	 ]].*\)*$/DEF/p'\'' dnl
+    -e q dnl                          Only consider the first "real" line
+    $1`" dnl
+])# _LT_DLL_DEF_P
+
+
 # LT_LIB_M
 # --------
 # check for math library
@@ -3506,11 +3845,11 @@ case $host in
   # These system don't have libm, or don't need it
   ;;
 *-ncr-sysv4.3*)
-  AC_CHECK_LIB(mw, _mwvalidcheckl, LIBM="-lmw")
+  AC_CHECK_LIB(mw, _mwvalidcheckl, LIBM=-lmw)
   AC_CHECK_LIB(m, cos, LIBM="$LIBM -lm")
   ;;
 *)
-  AC_CHECK_LIB(m, cos, LIBM="-lm")
+  AC_CHECK_LIB(m, cos, LIBM=-lm)
   ;;
 esac
 AC_SUBST([LIBM])
@@ -3529,7 +3868,7 @@ m4_defun([_LT_COMPILER_NO_RTTI],
 
 _LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)=
 
-if test "$GCC" = yes; then
+if test yes = "$GCC"; then
   case $cc_basename in
   nvcc*)
     _LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)=' -Xcompiler -fno-builtin' ;;
@@ -3581,7 +3920,7 @@ cygwin* | mingw* | pw32* | cegcc*)
   symcode='[[ABCDGISTW]]'
   ;;
 hpux*)
-  if test "$host_cpu" = ia64; then
+  if test ia64 = "$host_cpu"; then
     symcode='[[ABCDEGRST]]'
   fi
   ;;
@@ -3614,14 +3953,44 @@ case `$NM -V 2>&1` in
   symcode='[[ABCDGIRSTW]]' ;;
 esac
 
+if test "$lt_cv_nm_interface" = "MS dumpbin"; then
+  # Gets list of data symbols to import.
+  lt_cv_sys_global_symbol_to_import="sed -n -e 's/^I .* \(.*\)$/\1/p'"
+  # Adjust the below global symbol transforms to fixup imported variables.
+  lt_cdecl_hook=" -e 's/^I .* \(.*\)$/extern __declspec(dllimport) char \1;/p'"
+  lt_c_name_hook=" -e 's/^I .* \(.*\)$/  {\"\1\", (void *) 0},/p'"
+  lt_c_name_lib_hook="\
+  -e 's/^I .* \(lib.*\)$/  {\"\1\", (void *) 0},/p'\
+  -e 's/^I .* \(.*\)$/  {\"lib\1\", (void *) 0},/p'"
+else
+  # Disable hooks by default.
+  lt_cv_sys_global_symbol_to_import=
+  lt_cdecl_hook=
+  lt_c_name_hook=
+  lt_c_name_lib_hook=
+fi
+
 # Transform an extracted symbol line into a proper C declaration.
 # Some systems (esp. on ia64) link data and code symbols differently,
 # so use this general approach.
-lt_cv_sys_global_symbol_to_cdecl="sed -n -e 's/^T .* \(.*\)$/extern int \1();/p' -e 's/^$symcode* .* \(.*\)$/extern char \1;/p'"
+lt_cv_sys_global_symbol_to_cdecl="sed -n"\
+$lt_cdecl_hook\
+" -e 's/^T .* \(.*\)$/extern int \1();/p'"\
+" -e 's/^$symcode$symcode* .* \(.*\)$/extern char \1;/p'"
 
 # Transform an extracted symbol line into symbol name and symbol address
-lt_cv_sys_global_symbol_to_c_name_address="sed -n -e 's/^: \([[^ ]]*\)[[ ]]*$/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([[^ ]]*\) \([[^ ]]*\)$/  {\"\2\", (void *) \&\2},/p'"
-lt_cv_sys_global_symbol_to_c_name_address_lib_prefix="sed -n -e 's/^: \([[^ ]]*\)[[ ]]*$/  {\\\"\1\\\", (void *) 0},/p' -e 's/^$symcode* \([[^ ]]*\) \(lib[[^ ]]*\)$/  {\"\2\", (void *) \&\2},/p' -e 's/^$symcode* \([[^ ]]*\) \([[^ ]]*\)$/  {\"lib\2\", (void *) \&\2},/p'"
+lt_cv_sys_global_symbol_to_c_name_address="sed -n"\
+$lt_c_name_hook\
+" -e 's/^: \(.*\) .*$/  {\"\1\", (void *) 0},/p'"\
+" -e 's/^$symcode$symcode* .* \(.*\)$/  {\"\1\", (void *) \&\1},/p'"
+
+# Transform an extracted symbol line into symbol name with lib prefix and
+# symbol address.
+lt_cv_sys_global_symbol_to_c_name_address_lib_prefix="sed -n"\
+$lt_c_name_lib_hook\
+" -e 's/^: \(.*\) .*$/  {\"\1\", (void *) 0},/p'"\
+" -e 's/^$symcode$symcode* .* \(lib.*\)$/  {\"\1\", (void *) \&\1},/p'"\
+" -e 's/^$symcode$symcode* .* \(.*\)$/  {\"lib\1\", (void *) \&\1},/p'"
 
 # Handle CRLF in mingw tool chain
 opt_cr=
@@ -3639,20 +4008,24 @@ for ac_symprfx in "" "_"; do
 
   # Write the raw and C identifiers.
   if test "$lt_cv_nm_interface" = "MS dumpbin"; then
-    # Fake it for dumpbin and say T for any non-static function
-    # and D for any global variable.
+    # Fake it for dumpbin and say T for any non-static function,
+    # D for any global variable and I for any imported variable.
     # Also find C++ and __fastcall symbols from MSVC++,
     # which start with @ or ?.
     lt_cv_sys_global_symbol_pipe="$AWK ['"\
 "     {last_section=section; section=\$ 3};"\
+"     /^COFF SYMBOL TABLE/{for(i in hide) delete hide[i]};"\
 "     /Section length .*#relocs.*(pick any)/{hide[last_section]=1};"\
+"     /^ *Symbol name *: /{split(\$ 0,sn,\":\"); si=substr(sn[2],2)};"\
+"     /^ *Type *: code/{print \"T\",si,substr(si,length(prfx))};"\
+"     /^ *Type *: data/{print \"I\",si,substr(si,length(prfx))};"\
 "     \$ 0!~/External *\|/{next};"\
 "     / 0+ UNDEF /{next}; / UNDEF \([^|]\)*()/{next};"\
 "     {if(hide[section]) next};"\
-"     {f=0}; \$ 0~/\(\).*\|/{f=1}; {printf f ? \"T \" : \"D \"};"\
-"     {split(\$ 0, a, /\||\r/); split(a[2], s)};"\
-"     s[1]~/^[@?]/{print s[1], s[1]; next};"\
-"     s[1]~prfx {split(s[1],t,\"@\"); print t[1], substr(t[1],length(prfx))}"\
+"     {f=\"D\"}; \$ 0~/\(\).*\|/{f=\"T\"};"\
+"     {split(\$ 0,a,/\||\r/); split(a[2],s)};"\
+"     s[1]~/^[@?]/{print f,s[1],s[1]; next};"\
+"     s[1]~prfx {split(s[1],t,\"@\"); print f,t[1],substr(t[1],length(prfx))}"\
 "     ' prfx=^$ac_symprfx]"
   else
     lt_cv_sys_global_symbol_pipe="sed -n -e 's/^.*[[	 ]]\($symcode$symcode*\)[[	 ]][[	 ]]*$ac_symprfx$sympat$opt_cr$/$symxfrm/p'"
@@ -3692,11 +4065,11 @@ _LT_EOF
 	if $GREP ' nm_test_func$' "$nlist" >/dev/null; then
 	  cat <<_LT_EOF > conftest.$ac_ext
 /* Keep this code in sync between libtool.m4, ltmain, lt_system.h, and tests.  */
-#if defined(_WIN32) || defined(__CYGWIN__) || defined(_WIN32_WCE)
-/* DATA imports from DLLs on WIN32 con't be const, because runtime
+#if defined _WIN32 || defined __CYGWIN__ || defined _WIN32_WCE
+/* DATA imports from DLLs on WIN32 can't be const, because runtime
    relocations are performed -- see ld's documentation on pseudo-relocs.  */
 # define LT@&t@_DLSYM_CONST
-#elif defined(__osf__)
+#elif defined __osf__
 /* This system does not cope well with relocations in const data.  */
 # define LT@&t@_DLSYM_CONST
 #else
@@ -3722,7 +4095,7 @@ lt__PROGRAM__LTX_preloaded_symbols[[]] =
 {
   { "@PROGRAM@", (void *) 0 },
 _LT_EOF
-	  $SED "s/^$symcode$symcode* \(.*\) \(.*\)$/  {\"\2\", (void *) \&\2},/" < "$nlist" | $GREP -v main >> conftest.$ac_ext
+	  $SED "s/^$symcode$symcode* .* \(.*\)$/  {\"\1\", (void *) \&\1},/" < "$nlist" | $GREP -v main >> conftest.$ac_ext
 	  cat <<\_LT_EOF >> conftest.$ac_ext
   {0, (void *) 0}
 };
@@ -3742,9 +4115,9 @@ _LT_EOF
 	  mv conftest.$ac_objext conftstm.$ac_objext
 	  lt_globsym_save_LIBS=$LIBS
 	  lt_globsym_save_CFLAGS=$CFLAGS
-	  LIBS="conftstm.$ac_objext"
+	  LIBS=conftstm.$ac_objext
 	  CFLAGS="$CFLAGS$_LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)"
-	  if AC_TRY_EVAL(ac_link) && test -s conftest${ac_exeext}; then
+	  if AC_TRY_EVAL(ac_link) && test -s conftest$ac_exeext; then
 	    pipe_works=yes
 	  fi
 	  LIBS=$lt_globsym_save_LIBS
@@ -3765,7 +4138,7 @@ _LT_EOF
   rm -rf conftest* conftst*
 
   # Do not use the global_symbol_pipe unless it works.
-  if test "$pipe_works" = yes; then
+  if test yes = "$pipe_works"; then
     break
   else
     lt_cv_sys_global_symbol_pipe=
@@ -3792,12 +4165,16 @@ _LT_DECL([global_symbol_pipe], [lt_cv_sy
     [Take the output of nm and produce a listing of raw symbols and C names])
 _LT_DECL([global_symbol_to_cdecl], [lt_cv_sys_global_symbol_to_cdecl], [1],
     [Transform the output of nm in a proper C declaration])
+_LT_DECL([global_symbol_to_import], [lt_cv_sys_global_symbol_to_import], [1],
+    [Transform the output of nm into a list of symbols to manually relocate])
 _LT_DECL([global_symbol_to_c_name_address],
     [lt_cv_sys_global_symbol_to_c_name_address], [1],
     [Transform the output of nm in a C name address pair])
 _LT_DECL([global_symbol_to_c_name_address_lib_prefix],
     [lt_cv_sys_global_symbol_to_c_name_address_lib_prefix], [1],
     [Transform the output of nm in a C name address pair when lib prefix is needed])
+_LT_DECL([nm_interface], [lt_cv_nm_interface], [1],
+    [The name lister interface])
 _LT_DECL([], [nm_file_list_spec], [1],
     [Specify filename containing input files for $NM])
 ]) # _LT_CMD_GLOBAL_SYMBOLS
@@ -3813,17 +4190,18 @@ _LT_TAGVAR(lt_prog_compiler_static, $1)=
 
 m4_if([$1], [CXX], [
   # C++ specific cases for pic, static, wl, etc.
-  if test "$GXX" = yes; then
+  if test yes = "$GXX"; then
     _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
     _LT_TAGVAR(lt_prog_compiler_static, $1)='-static'
 
     case $host_os in
     aix*)
       # All AIX code is PIC.
-      if test "$host_cpu" = ia64; then
+      if test ia64 = "$host_cpu"; then
 	# AIX 5 now supports IA64 processor
 	_LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
       fi
+      _LT_TAGVAR(lt_prog_compiler_pic, $1)='-fPIC'
       ;;
 
     amigaos*)
@@ -3834,8 +4212,8 @@ m4_if([$1], [CXX], [
         ;;
       m68k)
             # FIXME: we need at least 68020 code to build shared libraries, but
-            # adding the `-m68020' flag to GCC prevents building anything better,
-            # like `-m68040'.
+            # adding the '-m68020' flag to GCC prevents building anything better,
+            # like '-m68040'.
             _LT_TAGVAR(lt_prog_compiler_pic, $1)='-m68020 -resident32 -malways-restore-a4'
         ;;
       esac
@@ -3851,6 +4229,11 @@ m4_if([$1], [CXX], [
       # (--disable-auto-import) libraries
       m4_if([$1], [GCJ], [],
 	[_LT_TAGVAR(lt_prog_compiler_pic, $1)='-DDLL_EXPORT'])
+      case $host_os in
+      os2*)
+	_LT_TAGVAR(lt_prog_compiler_static, $1)='$wl-static'
+	;;
+      esac
       ;;
     darwin* | rhapsody*)
       # PIC is the default on this platform
@@ -3900,7 +4283,7 @@ m4_if([$1], [CXX], [
     case $host_os in
       aix[[4-9]]*)
 	# All AIX code is PIC.
-	if test "$host_cpu" = ia64; then
+	if test ia64 = "$host_cpu"; then
 	  # AIX 5 now supports IA64 processor
 	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
 	else
@@ -3941,14 +4324,14 @@ m4_if([$1], [CXX], [
 	case $cc_basename in
 	  CC*)
 	    _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
-	    _LT_TAGVAR(lt_prog_compiler_static, $1)='${wl}-a ${wl}archive'
-	    if test "$host_cpu" != ia64; then
+	    _LT_TAGVAR(lt_prog_compiler_static, $1)='$wl-a ${wl}archive'
+	    if test ia64 != "$host_cpu"; then
 	      _LT_TAGVAR(lt_prog_compiler_pic, $1)='+Z'
 	    fi
 	    ;;
 	  aCC*)
 	    _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
-	    _LT_TAGVAR(lt_prog_compiler_static, $1)='${wl}-a ${wl}archive'
+	    _LT_TAGVAR(lt_prog_compiler_static, $1)='$wl-a ${wl}archive'
 	    case $host_cpu in
 	    hppa*64*|ia64*)
 	      # +Z the default
@@ -3977,7 +4360,7 @@ m4_if([$1], [CXX], [
 	    ;;
 	esac
 	;;
-      linux* | k*bsd*-gnu | kopensolaris*-gnu)
+      linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
 	case $cc_basename in
 	  KCC*)
 	    # KAI C++ Compiler
@@ -3985,7 +4368,7 @@ m4_if([$1], [CXX], [
 	    _LT_TAGVAR(lt_prog_compiler_pic, $1)='-fPIC'
 	    ;;
 	  ecpc* )
-	    # old Intel C++ for x86_64 which still supported -KPIC.
+	    # old Intel C++ for x86_64, which still supported -KPIC.
 	    _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	    _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
 	    _LT_TAGVAR(lt_prog_compiler_static, $1)='-static'
@@ -4130,17 +4513,18 @@ m4_if([$1], [CXX], [
   fi
 ],
 [
-  if test "$GCC" = yes; then
+  if test yes = "$GCC"; then
     _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
     _LT_TAGVAR(lt_prog_compiler_static, $1)='-static'
 
     case $host_os in
       aix*)
       # All AIX code is PIC.
-      if test "$host_cpu" = ia64; then
+      if test ia64 = "$host_cpu"; then
 	# AIX 5 now supports IA64 processor
 	_LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
       fi
+      _LT_TAGVAR(lt_prog_compiler_pic, $1)='-fPIC'
       ;;
 
     amigaos*)
@@ -4151,8 +4535,8 @@ m4_if([$1], [CXX], [
         ;;
       m68k)
             # FIXME: we need at least 68020 code to build shared libraries, but
-            # adding the `-m68020' flag to GCC prevents building anything better,
-            # like `-m68040'.
+            # adding the '-m68020' flag to GCC prevents building anything better,
+            # like '-m68040'.
             _LT_TAGVAR(lt_prog_compiler_pic, $1)='-m68020 -resident32 -malways-restore-a4'
         ;;
       esac
@@ -4169,6 +4553,11 @@ m4_if([$1], [CXX], [
       # (--disable-auto-import) libraries
       m4_if([$1], [GCJ], [],
 	[_LT_TAGVAR(lt_prog_compiler_pic, $1)='-DDLL_EXPORT'])
+      case $host_os in
+      os2*)
+	_LT_TAGVAR(lt_prog_compiler_static, $1)='$wl-static'
+	;;
+      esac
       ;;
 
     darwin* | rhapsody*)
@@ -4229,7 +4618,9 @@ m4_if([$1], [CXX], [
     case $cc_basename in
     nvcc*) # Cuda Compiler Driver 2.2
       _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Xlinker '
-      _LT_TAGVAR(lt_prog_compiler_pic, $1)='-Xcompiler -fPIC'
+      if test -n "$_LT_TAGVAR(lt_prog_compiler_pic, $1)"; then
+        _LT_TAGVAR(lt_prog_compiler_pic, $1)="-Xcompiler $_LT_TAGVAR(lt_prog_compiler_pic, $1)"
+      fi
       ;;
     esac
   else
@@ -4237,7 +4628,7 @@ m4_if([$1], [CXX], [
     case $host_os in
     aix*)
       _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
-      if test "$host_cpu" = ia64; then
+      if test ia64 = "$host_cpu"; then
 	# AIX 5 now supports IA64 processor
 	_LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
       else
@@ -4245,11 +4636,30 @@ m4_if([$1], [CXX], [
       fi
       ;;
 
+    darwin* | rhapsody*)
+      # PIC is the default on this platform
+      # Common symbols not allowed in MH_DYLIB files
+      _LT_TAGVAR(lt_prog_compiler_pic, $1)='-fno-common'
+      case $cc_basename in
+      nagfor*)
+        # NAG Fortran compiler
+        _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,-Wl,,'
+        _LT_TAGVAR(lt_prog_compiler_pic, $1)='-PIC'
+        _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
+        ;;
+      esac
+      ;;
+
     mingw* | cygwin* | pw32* | os2* | cegcc*)
       # This hack is so that the source file can tell whether it is being
       # built for inclusion in a dll (and should export symbols for example).
       m4_if([$1], [GCJ], [],
 	[_LT_TAGVAR(lt_prog_compiler_pic, $1)='-DDLL_EXPORT'])
+      case $host_os in
+      os2*)
+	_LT_TAGVAR(lt_prog_compiler_static, $1)='$wl-static'
+	;;
+      esac
       ;;
 
     hpux9* | hpux10* | hpux11*)
@@ -4265,7 +4675,7 @@ m4_if([$1], [CXX], [
 	;;
       esac
       # Is there a better lt_prog_compiler_static that works with the bundled CC?
-      _LT_TAGVAR(lt_prog_compiler_static, $1)='${wl}-a ${wl}archive'
+      _LT_TAGVAR(lt_prog_compiler_static, $1)='$wl-a ${wl}archive'
       ;;
 
     irix5* | irix6* | nonstopux*)
@@ -4274,9 +4684,9 @@ m4_if([$1], [CXX], [
       _LT_TAGVAR(lt_prog_compiler_static, $1)='-non_shared'
       ;;
 
-    linux* | k*bsd*-gnu | kopensolaris*-gnu)
+    linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
       case $cc_basename in
-      # old Intel for x86_64 which still supported -KPIC.
+      # old Intel for x86_64, which still supported -KPIC.
       ecc*)
 	_LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	_LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
@@ -4301,6 +4711,12 @@ m4_if([$1], [CXX], [
 	_LT_TAGVAR(lt_prog_compiler_pic, $1)='-PIC'
 	_LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
 	;;
+      tcc*)
+	# Fabrice Bellard et al's Tiny C Compiler
+	_LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
+	_LT_TAGVAR(lt_prog_compiler_pic, $1)='-fPIC'
+	_LT_TAGVAR(lt_prog_compiler_static, $1)='-static'
+	;;
       pgcc* | pgf77* | pgf90* | pgf95* | pgfortran*)
         # Portland Group compilers (*not* the Pentium gcc compiler,
 	# which looks to be a dead project)
@@ -4321,18 +4737,33 @@ m4_if([$1], [CXX], [
 	;;
       *)
 	case `$CC -V 2>&1 | sed 5q` in
-	*Sun\ F* | *Sun*Fortran*)
+	*Sun\ Ceres\ Fortran* | *Sun*Fortran*\ [[1-7]].* | *Sun*Fortran*\ 8.[[0-3]]*)
 	  # Sun Fortran 8.3 passes all unrecognized flags to the linker
 	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
 	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
 	  _LT_TAGVAR(lt_prog_compiler_wl, $1)=''
 	  ;;
+	*Sun\ F* | *Sun*Fortran*)
+	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
+	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
+	  _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Qoption ld '
+	  ;;
 	*Sun\ C*)
 	  # Sun C 5.9
 	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
 	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
 	  _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	  ;;
+        *Intel*\ [[CF]]*Compiler*)
+	  _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
+	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-fPIC'
+	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-static'
+	  ;;
+	*Portland\ Group*)
+	  _LT_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
+	  _LT_TAGVAR(lt_prog_compiler_pic, $1)='-fpic'
+	  _LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
+	  ;;
 	esac
 	;;
       esac
@@ -4383,7 +4814,7 @@ m4_if([$1], [CXX], [
       ;;
 
     sysv4*MP*)
-      if test -d /usr/nec ;then
+      if test -d /usr/nec; then
 	_LT_TAGVAR(lt_prog_compiler_pic, $1)='-Kconform_pic'
 	_LT_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
       fi
@@ -4412,7 +4843,7 @@ m4_if([$1], [CXX], [
   fi
 ])
 case $host_os in
-  # For platforms which do not support PIC, -DPIC is meaningless:
+  # For platforms that do not support PIC, -DPIC is meaningless:
   *djgpp*)
     _LT_TAGVAR(lt_prog_compiler_pic, $1)=
     ;;
@@ -4478,21 +4909,27 @@ m4_if([$1], [CXX], [
   case $host_os in
   aix[[4-9]]*)
     # If we're using GNU nm, then we don't want the "-C" option.
-    # -C means demangle to AIX nm, but means don't demangle with GNU nm
-    # Also, AIX nm treats weak defined symbols like other global defined
-    # symbols, whereas GNU nm marks them as "W".
+    # -C means demangle to GNU nm, but means don't demangle to AIX nm.
+    # Without the "-l" option, or with the "-B" option, AIX nm treats
+    # weak defined symbols like other global defined symbols, whereas
+    # GNU nm marks them as "W".
+    # While the 'weak' keyword is ignored in the Export File, we need
+    # it in the Import File for the 'aix-soname' feature, so we have
+    # to replace the "-B" option with "-P" for AIX nm.
     if $NM -V 2>&1 | $GREP 'GNU' > /dev/null; then
-      _LT_TAGVAR(export_symbols_cmds, $1)='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+      _LT_TAGVAR(export_symbols_cmds, $1)='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && ([substr](\$ 3,1,1) != ".")) { if (\$ 2 == "W") { print \$ 3 " weak" } else { print \$ 3 } } }'\'' | sort -u > $export_symbols'
     else
-      _LT_TAGVAR(export_symbols_cmds, $1)='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+      _LT_TAGVAR(export_symbols_cmds, $1)='`func_echo_all $NM | $SED -e '\''s/B\([[^B]]*\)$/P\1/'\''` -PCpgl $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W") || (\$ 2 == "V") || (\$ 2 == "Z")) && ([substr](\$ 1,1,1) != ".")) { if ((\$ 2 == "W") || (\$ 2 == "V") || (\$ 2 == "Z")) { print \$ 1 " weak" } else { print \$ 1 } } }'\'' | sort -u > $export_symbols'
     fi
     ;;
   pw32*)
-    _LT_TAGVAR(export_symbols_cmds, $1)="$ltdll_cmds"
+    _LT_TAGVAR(export_symbols_cmds, $1)=$ltdll_cmds
     ;;
   cygwin* | mingw* | cegcc*)
     case $cc_basename in
-    cl*) ;;
+    cl*)
+      _LT_TAGVAR(exclude_expsyms, $1)='_NULL_IMPORT_DESCRIPTOR|_IMPORT_DESCRIPTOR_.*'
+      ;;
     *)
       _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]][[ ]]/s/.*[[ ]]\([[^ ]]*\)/\1 DATA/;s/^.*[[ ]]__nm__\([[^ ]]*\)[[ ]][[^ ]]*/\1 DATA/;/^I[[ ]]/d;/^[[AITW]][[ ]]/s/.* //'\'' | sort | uniq > $export_symbols'
       _LT_TAGVAR(exclude_expsyms, $1)=['[_]+GLOBAL_OFFSET_TABLE_|[_]+GLOBAL__[FID]_.*|[_]+head_[A-Za-z0-9_]+_dll|[A-Za-z0-9_]+_dll_iname']
@@ -4517,7 +4954,6 @@ m4_if([$1], [CXX], [
   _LT_TAGVAR(hardcode_direct, $1)=no
   _LT_TAGVAR(hardcode_direct_absolute, $1)=no
   _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-  _LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
   _LT_TAGVAR(hardcode_libdir_separator, $1)=
   _LT_TAGVAR(hardcode_minus_L, $1)=no
   _LT_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
@@ -4533,9 +4969,9 @@ m4_if([$1], [CXX], [
   # included in the symbol list
   _LT_TAGVAR(include_expsyms, $1)=
   # exclude_expsyms can be an extended regexp of symbols to exclude
-  # it will be wrapped by ` (' and `)$', so one must not match beginning or
-  # end of line.  Example: `a|bc|.*d.*' will exclude the symbols `a' and `bc',
-  # as well as any symbol that contains `d'.
+  # it will be wrapped by ' (' and ')$', so one must not match beginning or
+  # end of line.  Example: 'a|bc|.*d.*' will exclude the symbols 'a' and 'bc',
+  # as well as any symbol that contains 'd'.
   _LT_TAGVAR(exclude_expsyms, $1)=['_GLOBAL_OFFSET_TABLE_|_GLOBAL__F[ID]_.*']
   # Although _GLOBAL_OFFSET_TABLE_ is a valid symbol C name, most a.out
   # platforms (ab)use it in PIC code, but their linkers get confused if
@@ -4551,7 +4987,7 @@ dnl Note also adjust exclude_expsyms for
     # FIXME: the MSVC++ port hasn't been tested in a loooong time
     # When not using gcc, we currently assume that we are using
     # Microsoft Visual C++.
-    if test "$GCC" != yes; then
+    if test yes != "$GCC"; then
       with_gnu_ld=no
     fi
     ;;
@@ -4559,7 +4995,7 @@ dnl Note also adjust exclude_expsyms for
     # we just hope/assume this is gcc and not c89 (= MSVC++)
     with_gnu_ld=yes
     ;;
-  openbsd*)
+  openbsd* | bitrig*)
     with_gnu_ld=no
     ;;
   esac
@@ -4569,7 +5005,7 @@ dnl Note also adjust exclude_expsyms for
   # On some targets, GNU ld is compatible enough with the native linker
   # that we're better off using the native interface for both.
   lt_use_gnu_ld_interface=no
-  if test "$with_gnu_ld" = yes; then
+  if test yes = "$with_gnu_ld"; then
     case $host_os in
       aix*)
 	# The AIX port of GNU ld has always aspired to compatibility
@@ -4591,24 +5027,24 @@ dnl Note also adjust exclude_expsyms for
     esac
   fi
 
-  if test "$lt_use_gnu_ld_interface" = yes; then
+  if test yes = "$lt_use_gnu_ld_interface"; then
     # If archive_cmds runs LD, not CC, wlarc should be empty
-    wlarc='${wl}'
+    wlarc='$wl'
 
     # Set some defaults for GNU ld with shared library support. These
     # are reset later if shared libraries are not supported. Putting them
     # here allows them to be overridden if necessary.
     runpath_var=LD_RUN_PATH
-    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
-    _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
+    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath $wl$libdir'
+    _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl--export-dynamic'
     # ancient GNU ld didn't support --whole-archive et. al.
     if $LD --help 2>&1 | $GREP 'no-whole-archive' > /dev/null; then
-      _LT_TAGVAR(whole_archive_flag_spec, $1)="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
+      _LT_TAGVAR(whole_archive_flag_spec, $1)=$wlarc'--whole-archive$convenience '$wlarc'--no-whole-archive'
     else
       _LT_TAGVAR(whole_archive_flag_spec, $1)=
     fi
     supports_anon_versioning=no
-    case `$LD -v 2>&1` in
+    case `$LD -v | $SED -e 's/([^)]\+)\s\+//' 2>&1` in
       *GNU\ gold*) supports_anon_versioning=yes ;;
       *\ [[01]].* | *\ 2.[[0-9]].* | *\ 2.10.*) ;; # catch versions < 2.11
       *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
@@ -4621,7 +5057,7 @@ dnl Note also adjust exclude_expsyms for
     case $host_os in
     aix[[3-9]]*)
       # On AIX/PPC, the GNU linker is very broken
-      if test "$host_cpu" != ia64; then
+      if test ia64 != "$host_cpu"; then
 	_LT_TAGVAR(ld_shlibs, $1)=no
 	cat <<_LT_EOF 1>&2
 
@@ -4640,7 +5076,7 @@ _LT_EOF
       case $host_cpu in
       powerpc)
             # see comment about AmigaOS4 .so support
-            _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+            _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
             _LT_TAGVAR(archive_expsym_cmds, $1)=''
         ;;
       m68k)
@@ -4656,7 +5092,7 @@ _LT_EOF
 	_LT_TAGVAR(allow_undefined_flag, $1)=unsupported
 	# Joseph Beckenbach <jrb3@best.com> says some releases of gcc
 	# support --undefined.  This deserves some investigation.  FIXME
-	_LT_TAGVAR(archive_cmds, $1)='$CC -nostart $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -nostart $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
       else
 	_LT_TAGVAR(ld_shlibs, $1)=no
       fi
@@ -4666,7 +5102,7 @@ _LT_EOF
       # _LT_TAGVAR(hardcode_libdir_flag_spec, $1) is actually meaningless,
       # as there is no search path for DLLs.
       _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
-      _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-all-symbols'
+      _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl--export-all-symbols'
       _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
       _LT_TAGVAR(always_export_symbols, $1)=no
       _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
@@ -4674,61 +5110,89 @@ _LT_EOF
       _LT_TAGVAR(exclude_expsyms, $1)=['[_]+GLOBAL_OFFSET_TABLE_|[_]+GLOBAL__[FID]_.*|[_]+head_[A-Za-z0-9_]+_dll|[A-Za-z0-9_]+_dll_iname']
 
       if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
-        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
-	# If the export-symbols file already is a .def file (1st line
-	# is EXPORTS), use it as is; otherwise, prepend...
-	_LT_TAGVAR(archive_expsym_cmds, $1)='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
-	  cp $export_symbols $output_objdir/$soname.def;
-	else
-	  echo EXPORTS > $output_objdir/$soname.def;
-	  cat $export_symbols >> $output_objdir/$soname.def;
-	fi~
-	$CC -shared $output_objdir/$soname.def $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname $wl--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+	# If the export-symbols file already is a .def file, use it as
+	# is; otherwise, prepend EXPORTS...
+	_LT_TAGVAR(archive_expsym_cmds, $1)='if _LT_DLL_DEF_P([$export_symbols]); then
+          cp $export_symbols $output_objdir/$soname.def;
+        else
+          echo EXPORTS > $output_objdir/$soname.def;
+          cat $export_symbols >> $output_objdir/$soname.def;
+        fi~
+        $CC -shared $output_objdir/$soname.def $libobjs $deplibs $compiler_flags -o $output_objdir/$soname $wl--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
       else
 	_LT_TAGVAR(ld_shlibs, $1)=no
       fi
       ;;
 
     haiku*)
-      _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
       _LT_TAGVAR(link_all_deplibs, $1)=yes
       ;;
 
+    os2*)
+      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
+      _LT_TAGVAR(hardcode_minus_L, $1)=yes
+      _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
+      shrext_cmds=.dll
+      _LT_TAGVAR(archive_cmds, $1)='$ECHO "LIBRARY ${soname%$shared_ext} INITINSTANCE TERMINSTANCE" > $output_objdir/$libname.def~
+	$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~
+	$ECHO "DATA MULTIPLE NONSHARED" >> $output_objdir/$libname.def~
+	$ECHO EXPORTS >> $output_objdir/$libname.def~
+	emxexp $libobjs | $SED /"_DLL_InitTerm"/d >> $output_objdir/$libname.def~
+	$CC -Zdll -Zcrtdll -o $output_objdir/$soname $libobjs $deplibs $compiler_flags $output_objdir/$libname.def~
+	emximp -o $lib $output_objdir/$libname.def'
+      _LT_TAGVAR(archive_expsym_cmds, $1)='$ECHO "LIBRARY ${soname%$shared_ext} INITINSTANCE TERMINSTANCE" > $output_objdir/$libname.def~
+	$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~
+	$ECHO "DATA MULTIPLE NONSHARED" >> $output_objdir/$libname.def~
+	$ECHO EXPORTS >> $output_objdir/$libname.def~
+	prefix_cmds="$SED"~
+	if test EXPORTS = "`$SED 1q $export_symbols`"; then
+	  prefix_cmds="$prefix_cmds -e 1d";
+	fi~
+	prefix_cmds="$prefix_cmds -e \"s/^\(.*\)$/_\1/g\""~
+	cat $export_symbols | $prefix_cmds >> $output_objdir/$libname.def~
+	$CC -Zdll -Zcrtdll -o $output_objdir/$soname $libobjs $deplibs $compiler_flags $output_objdir/$libname.def~
+	emximp -o $lib $output_objdir/$libname.def'
+      _LT_TAGVAR(old_archive_From_new_cmds, $1)='emximp -o $output_objdir/${libname}_dll.a $output_objdir/$libname.def'
+      _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
+      ;;
+
     interix[[3-9]]*)
       _LT_TAGVAR(hardcode_direct, $1)=no
       _LT_TAGVAR(hardcode_shlibpath_var, $1)=no
-      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
-      _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
+      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath,$libdir'
+      _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl-E'
       # Hack: On Interix 3.x, we cannot compile PIC because of a broken gcc.
       # Instead, shared libraries are loaded at an image base (0x10000000 by
       # default) and relocated if they conflict, which is a slow very memory
       # consuming and fragmenting process.  To avoid this, we pick a random,
       # 256 KiB-aligned image base between 0x50000000 and 0x6FFC0000 at link
       # time.  Moving up from 0x10000000 also allows more sbrk(2) space.
-      _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
-      _LT_TAGVAR(archive_expsym_cmds, $1)='sed "s,^,_," $export_symbols >$output_objdir/$soname.expsym~$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--retain-symbols-file,$output_objdir/$soname.expsym ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
+      _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-h,$soname $wl--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
+      _LT_TAGVAR(archive_expsym_cmds, $1)='sed "s|^|_|" $export_symbols >$output_objdir/$soname.expsym~$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-h,$soname $wl--retain-symbols-file,$output_objdir/$soname.expsym $wl--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
       ;;
 
     gnu* | linux* | tpf* | k*bsd*-gnu | kopensolaris*-gnu)
       tmp_diet=no
-      if test "$host_os" = linux-dietlibc; then
+      if test linux-dietlibc = "$host_os"; then
 	case $cc_basename in
 	  diet\ *) tmp_diet=yes;;	# linux-dietlibc with static linking (!diet-dyn)
 	esac
       fi
       if $LD --help 2>&1 | $EGREP ': supported targets:.* elf' > /dev/null \
-	 && test "$tmp_diet" = no
+	 && test no = "$tmp_diet"
       then
 	tmp_addflag=' $pic_flag'
 	tmp_sharedflag='-shared'
 	case $cc_basename,$host_cpu in
         pgcc*)				# Portland Group C compiler
-	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  _LT_TAGVAR(whole_archive_flag_spec, $1)='$wl--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` $wl--no-whole-archive'
 	  tmp_addflag=' $pic_flag'
 	  ;;
 	pgf77* | pgf90* | pgf95* | pgfortran*)
 					# Portland Group f77 and f90 compilers
-	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  _LT_TAGVAR(whole_archive_flag_spec, $1)='$wl--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` $wl--no-whole-archive'
 	  tmp_addflag=' $pic_flag -Mnomain' ;;
 	ecc*,ia64* | icc*,ia64*)	# Intel C compiler on ia64
 	  tmp_addflag=' -i_dynamic' ;;
@@ -4739,43 +5203,47 @@ _LT_EOF
 	lf95*)				# Lahey Fortran 8.1
 	  _LT_TAGVAR(whole_archive_flag_spec, $1)=
 	  tmp_sharedflag='--shared' ;;
+        nagfor*)                        # NAGFOR 5.3
+          tmp_sharedflag='-Wl,-shared' ;;
 	xl[[cC]]* | bgxl[[cC]]* | mpixl[[cC]]*) # IBM XL C 8.0 on PPC (deal with xlf below)
 	  tmp_sharedflag='-qmkshrobj'
 	  tmp_addflag= ;;
 	nvcc*)	# Cuda Compiler Driver 2.2
-	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  _LT_TAGVAR(whole_archive_flag_spec, $1)='$wl--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` $wl--no-whole-archive'
 	  _LT_TAGVAR(compiler_needs_object, $1)=yes
 	  ;;
 	esac
 	case `$CC -V 2>&1 | sed 5q` in
 	*Sun\ C*)			# Sun C 5.9
-	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	  _LT_TAGVAR(whole_archive_flag_spec, $1)='$wl--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` $wl--no-whole-archive'
 	  _LT_TAGVAR(compiler_needs_object, $1)=yes
 	  tmp_sharedflag='-G' ;;
 	*Sun\ F*)			# Sun Fortran 8.3
 	  tmp_sharedflag='-G' ;;
 	esac
-	_LT_TAGVAR(archive_cmds, $1)='$CC '"$tmp_sharedflag""$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC '"$tmp_sharedflag""$tmp_addflag"' $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
 
-        if test "x$supports_anon_versioning" = xyes; then
+        if test yes = "$supports_anon_versioning"; then
           _LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $output_objdir/$libname.ver~
-	    cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
-	    echo "local: *; };" >> $output_objdir/$libname.ver~
-	    $CC '"$tmp_sharedflag""$tmp_addflag"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
+            cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
+            echo "local: *; };" >> $output_objdir/$libname.ver~
+            $CC '"$tmp_sharedflag""$tmp_addflag"' $libobjs $deplibs $compiler_flags $wl-soname $wl$soname $wl-version-script $wl$output_objdir/$libname.ver -o $lib'
         fi
 
 	case $cc_basename in
+	tcc*)
+	  _LT_TAGVAR(export_dynamic_flag_spec, $1)='-rdynamic'
+	  ;;
 	xlf* | bgf* | bgxlf* | mpixlf*)
 	  # IBM XL Fortran 10.1 on PPC cannot create shared libs itself
 	  _LT_TAGVAR(whole_archive_flag_spec, $1)='--whole-archive$convenience --no-whole-archive'
-	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-	  _LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)='-rpath $libdir'
+	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath $wl$libdir'
 	  _LT_TAGVAR(archive_cmds, $1)='$LD -shared $libobjs $deplibs $linker_flags -soname $soname -o $lib'
-	  if test "x$supports_anon_versioning" = xyes; then
+	  if test yes = "$supports_anon_versioning"; then
 	    _LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $output_objdir/$libname.ver~
-	      cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
-	      echo "local: *; };" >> $output_objdir/$libname.ver~
-	      $LD -shared $libobjs $deplibs $linker_flags -soname $soname -version-script $output_objdir/$libname.ver -o $lib'
+              cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
+              echo "local: *; };" >> $output_objdir/$libname.ver~
+              $LD -shared $libobjs $deplibs $linker_flags -soname $soname -version-script $output_objdir/$libname.ver -o $lib'
 	  fi
 	  ;;
 	esac
@@ -4789,8 +5257,8 @@ _LT_EOF
 	_LT_TAGVAR(archive_cmds, $1)='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
 	wlarc=
       else
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname $wl-retain-symbols-file $wl$export_symbols -o $lib'
       fi
       ;;
 
@@ -4808,8 +5276,8 @@ _LT_EOF
 
 _LT_EOF
       elif $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname $wl-retain-symbols-file $wl$export_symbols -o $lib'
       else
 	_LT_TAGVAR(ld_shlibs, $1)=no
       fi
@@ -4821,7 +5289,7 @@ _LT_EOF
 	_LT_TAGVAR(ld_shlibs, $1)=no
 	cat <<_LT_EOF 1>&2
 
-*** Warning: Releases of the GNU linker prior to 2.16.91.0.3 can not
+*** Warning: Releases of the GNU linker prior to 2.16.91.0.3 cannot
 *** reliably create shared libraries on SCO systems.  Therefore, libtool
 *** is disabling shared libraries support.  We urge you to upgrade GNU
 *** binutils to release 2.16.91.0.3 or newer.  Another option is to modify
@@ -4836,9 +5304,9 @@ _LT_EOF
 	  # DT_RUNPATH tag from executables and libraries.  But doing so
 	  # requires that you compile everything twice, which is a pain.
 	  if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
-	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	    _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath $wl$libdir'
+	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
+	    _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags $wl-soname $wl$soname $wl-retain-symbols-file $wl$export_symbols -o $lib'
 	  else
 	    _LT_TAGVAR(ld_shlibs, $1)=no
 	  fi
@@ -4855,15 +5323,15 @@ _LT_EOF
 
     *)
       if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname $wl-retain-symbols-file $wl$export_symbols -o $lib'
       else
 	_LT_TAGVAR(ld_shlibs, $1)=no
       fi
       ;;
     esac
 
-    if test "$_LT_TAGVAR(ld_shlibs, $1)" = no; then
+    if test no = "$_LT_TAGVAR(ld_shlibs, $1)"; then
       runpath_var=
       _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
       _LT_TAGVAR(export_dynamic_flag_spec, $1)=
@@ -4879,7 +5347,7 @@ _LT_EOF
       # Note: this linker hardcodes the directories in LIBPATH if there
       # are no directories specified by -L.
       _LT_TAGVAR(hardcode_minus_L, $1)=yes
-      if test "$GCC" = yes && test -z "$lt_prog_compiler_static"; then
+      if test yes = "$GCC" && test -z "$lt_prog_compiler_static"; then
 	# Neither direct hardcoding nor static linking is supported with a
 	# broken collect2.
 	_LT_TAGVAR(hardcode_direct, $1)=unsupported
@@ -4887,34 +5355,57 @@ _LT_EOF
       ;;
 
     aix[[4-9]]*)
-      if test "$host_cpu" = ia64; then
+      if test ia64 = "$host_cpu"; then
 	# On IA64, the linker does run time linking by default, so we don't
 	# have to do anything special.
 	aix_use_runtimelinking=no
 	exp_sym_flag='-Bexport'
-	no_entry_flag=""
+	no_entry_flag=
       else
 	# If we're using GNU nm, then we don't want the "-C" option.
-	# -C means demangle to AIX nm, but means don't demangle with GNU nm
-	# Also, AIX nm treats weak defined symbols like other global
-	# defined symbols, whereas GNU nm marks them as "W".
+	# -C means demangle to GNU nm, but means don't demangle to AIX nm.
+	# Without the "-l" option, or with the "-B" option, AIX nm treats
+	# weak defined symbols like other global defined symbols, whereas
+	# GNU nm marks them as "W".
+	# While the 'weak' keyword is ignored in the Export File, we need
+	# it in the Import File for the 'aix-soname' feature, so we have
+	# to replace the "-B" option with "-P" for AIX nm.
 	if $NM -V 2>&1 | $GREP 'GNU' > /dev/null; then
-	  _LT_TAGVAR(export_symbols_cmds, $1)='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+	  _LT_TAGVAR(export_symbols_cmds, $1)='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && ([substr](\$ 3,1,1) != ".")) { if (\$ 2 == "W") { print \$ 3 " weak" } else { print \$ 3 } } }'\'' | sort -u > $export_symbols'
 	else
-	  _LT_TAGVAR(export_symbols_cmds, $1)='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && ([substr](\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+	  _LT_TAGVAR(export_symbols_cmds, $1)='`func_echo_all $NM | $SED -e '\''s/B\([[^B]]*\)$/P\1/'\''` -PCpgl $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W") || (\$ 2 == "V") || (\$ 2 == "Z")) && ([substr](\$ 1,1,1) != ".")) { if ((\$ 2 == "W") || (\$ 2 == "V") || (\$ 2 == "Z")) { print \$ 1 " weak" } else { print \$ 1 } } }'\'' | sort -u > $export_symbols'
 	fi
 	aix_use_runtimelinking=no
 
 	# Test if we are trying to use run time linking or normal
 	# AIX style linking. If -brtl is somewhere in LDFLAGS, we
-	# need to do runtime linking.
+	# have runtime linking enabled, and use it for executables.
+	# For shared libraries, we enable/disable runtime linking
+	# depending on the kind of the shared library created -
+	# when "with_aix_soname,aix_use_runtimelinking" is:
+	# "aix,no"   lib.a(lib.so.V) shared, rtl:no,  for executables
+	# "aix,yes"  lib.so          shared, rtl:yes, for executables
+	#            lib.a           static archive
+	# "both,no"  lib.so.V(shr.o) shared, rtl:yes
+	#            lib.a(lib.so.V) shared, rtl:no,  for executables
+	# "both,yes" lib.so.V(shr.o) shared, rtl:yes, for executables
+	#            lib.a(lib.so.V) shared, rtl:no
+	# "svr4,*"   lib.so.V(shr.o) shared, rtl:yes, for executables
+	#            lib.a           static archive
 	case $host_os in aix4.[[23]]|aix4.[[23]].*|aix[[5-9]]*)
 	  for ld_flag in $LDFLAGS; do
-	  if (test $ld_flag = "-brtl" || test $ld_flag = "-Wl,-brtl"); then
+	  if (test x-brtl = "x$ld_flag" || test x-Wl,-brtl = "x$ld_flag"); then
 	    aix_use_runtimelinking=yes
 	    break
 	  fi
 	  done
+	  if test svr4,no = "$with_aix_soname,$aix_use_runtimelinking"; then
+	    # With aix-soname=svr4, we create the lib.so.V shared archives only,
+	    # so we don't have lib.a shared libs to link our executables.
+	    # We have to force runtime linking in this case.
+	    aix_use_runtimelinking=yes
+	    LDFLAGS="$LDFLAGS -Wl,-brtl"
+	  fi
 	  ;;
 	esac
 
@@ -4933,13 +5424,21 @@ _LT_EOF
       _LT_TAGVAR(hardcode_direct_absolute, $1)=yes
       _LT_TAGVAR(hardcode_libdir_separator, $1)=':'
       _LT_TAGVAR(link_all_deplibs, $1)=yes
-      _LT_TAGVAR(file_list_spec, $1)='${wl}-f,'
+      _LT_TAGVAR(file_list_spec, $1)='$wl-f,'
+      case $with_aix_soname,$aix_use_runtimelinking in
+      aix,*) ;; # traditional, no import file
+      svr4,* | *,yes) # use import file
+	# The Import File defines what to hardcode.
+	_LT_TAGVAR(hardcode_direct, $1)=no
+	_LT_TAGVAR(hardcode_direct_absolute, $1)=no
+	;;
+      esac
 
-      if test "$GCC" = yes; then
+      if test yes = "$GCC"; then
 	case $host_os in aix4.[[012]]|aix4.[[012]].*)
 	# We only want to do this on AIX 4.2 and lower, the check
 	# below for broken collect2 doesn't work under 4.3+
-	  collect2name=`${CC} -print-prog-name=collect2`
+	  collect2name=`$CC -print-prog-name=collect2`
 	  if test -f "$collect2name" &&
 	   strings "$collect2name" | $GREP resolve_lib_name >/dev/null
 	  then
@@ -4958,61 +5457,80 @@ _LT_EOF
 	  ;;
 	esac
 	shared_flag='-shared'
-	if test "$aix_use_runtimelinking" = yes; then
-	  shared_flag="$shared_flag "'${wl}-G'
+	if test yes = "$aix_use_runtimelinking"; then
+	  shared_flag="$shared_flag "'$wl-G'
 	fi
+	# Need to ensure runtime linking is disabled for the traditional
+	# shared library, or the linker may eventually find shared libraries
+	# /with/ Import File - we do not want to mix them.
+	shared_flag_aix='-shared'
+	shared_flag_svr4='-shared $wl-G'
       else
 	# not using gcc
-	if test "$host_cpu" = ia64; then
+	if test ia64 = "$host_cpu"; then
 	# VisualAge C++, Version 5.5 for AIX 5L for IA-64, Beta 3 Release
 	# chokes on -Wl,-G. The following line is correct:
 	  shared_flag='-G'
 	else
-	  if test "$aix_use_runtimelinking" = yes; then
-	    shared_flag='${wl}-G'
+	  if test yes = "$aix_use_runtimelinking"; then
+	    shared_flag='$wl-G'
 	  else
-	    shared_flag='${wl}-bM:SRE'
+	    shared_flag='$wl-bM:SRE'
 	  fi
+	  shared_flag_aix='$wl-bM:SRE'
+	  shared_flag_svr4='$wl-G'
 	fi
       fi
 
-      _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-bexpall'
+      _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl-bexpall'
       # It seems that -bexpall does not export symbols beginning with
       # underscore (_), so it is better to generate a list of symbols to export.
       _LT_TAGVAR(always_export_symbols, $1)=yes
-      if test "$aix_use_runtimelinking" = yes; then
+      if test aix,yes = "$with_aix_soname,$aix_use_runtimelinking"; then
 	# Warning - without using the other runtime loading flags (-brtl),
 	# -berok will link without error, but may produce a broken library.
 	_LT_TAGVAR(allow_undefined_flag, $1)='-berok'
         # Determine the default libpath from the value encoded in an
         # empty executable.
         _LT_SYS_MODULE_PATH_AIX([$1])
-        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-blibpath:$libdir:'"$aix_libpath"
-        _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then func_echo_all "${wl}${allow_undefined_flag}"; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
+        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-blibpath:$libdir:'"$aix_libpath"
+        _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $deplibs $wl'$no_entry_flag' $compiler_flags `if test -n "$allow_undefined_flag"; then func_echo_all "$wl$allow_undefined_flag"; else :; fi` $wl'$exp_sym_flag:\$export_symbols' '$shared_flag
       else
-	if test "$host_cpu" = ia64; then
-	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-R $libdir:/usr/lib:/lib'
+	if test ia64 = "$host_cpu"; then
+	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-R $libdir:/usr/lib:/lib'
 	  _LT_TAGVAR(allow_undefined_flag, $1)="-z nodefs"
-	  _LT_TAGVAR(archive_expsym_cmds, $1)="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags ${wl}${allow_undefined_flag} '"\${wl}$exp_sym_flag:\$export_symbols"
+	  _LT_TAGVAR(archive_expsym_cmds, $1)="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs '"\$wl$no_entry_flag"' $compiler_flags $wl$allow_undefined_flag '"\$wl$exp_sym_flag:\$export_symbols"
 	else
 	 # Determine the default libpath from the value encoded in an
 	 # empty executable.
 	 _LT_SYS_MODULE_PATH_AIX([$1])
-	 _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-blibpath:$libdir:'"$aix_libpath"
+	 _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-blibpath:$libdir:'"$aix_libpath"
 	  # Warning - without using the other run time loading flags,
 	  # -berok will link without error, but may produce a broken library.
-	  _LT_TAGVAR(no_undefined_flag, $1)=' ${wl}-bernotok'
-	  _LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-berok'
-	  if test "$with_gnu_ld" = yes; then
+	  _LT_TAGVAR(no_undefined_flag, $1)=' $wl-bernotok'
+	  _LT_TAGVAR(allow_undefined_flag, $1)=' $wl-berok'
+	  if test yes = "$with_gnu_ld"; then
 	    # We only use this code for GNU lds that support --whole-archive.
-	    _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
+	    _LT_TAGVAR(whole_archive_flag_spec, $1)='$wl--whole-archive$convenience $wl--no-whole-archive'
 	  else
 	    # Exported symbols can be pulled into shared objects from archives
 	    _LT_TAGVAR(whole_archive_flag_spec, $1)='$convenience'
 	  fi
 	  _LT_TAGVAR(archive_cmds_need_lc, $1)=yes
-	  # This is similar to how AIX traditionally builds its shared libraries.
-	  _LT_TAGVAR(archive_expsym_cmds, $1)="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs ${wl}-bnoentry $compiler_flags ${wl}-bE:$export_symbols${allow_undefined_flag}~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
+	  _LT_TAGVAR(archive_expsym_cmds, $1)='$RM -r $output_objdir/$realname.d~$MKDIR $output_objdir/$realname.d'
+	  # -brtl affects multiple linker settings, -berok does not and is overridden later
+	  compiler_flags_filtered='`func_echo_all "$compiler_flags " | $SED -e "s%-brtl\\([[, ]]\\)%-berok\\1%g"`'
+	  if test svr4 != "$with_aix_soname"; then
+	    # This is similar to how AIX traditionally builds its shared libraries.
+	    _LT_TAGVAR(archive_expsym_cmds, $1)="$_LT_TAGVAR(archive_expsym_cmds, $1)"'~$CC '$shared_flag_aix' -o $output_objdir/$realname.d/$soname $libobjs $deplibs $wl-bnoentry '$compiler_flags_filtered'$wl-bE:$export_symbols$allow_undefined_flag~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$realname.d/$soname'
+	  fi
+	  if test aix != "$with_aix_soname"; then
+	    _LT_TAGVAR(archive_expsym_cmds, $1)="$_LT_TAGVAR(archive_expsym_cmds, $1)"'~$CC '$shared_flag_svr4' -o $output_objdir/$realname.d/$shared_archive_member_spec.o $libobjs $deplibs $wl-bnoentry '$compiler_flags_filtered'$wl-bE:$export_symbols$allow_undefined_flag~$STRIP -e $output_objdir/$realname.d/$shared_archive_member_spec.o~( func_echo_all "#! $soname($shared_archive_member_spec.o)"; if test shr_64 = "$shared_archive_member_spec"; then func_echo_all "# 64"; else func_echo_all "# 32"; fi; cat $export_symbols ) > $output_objdir/$realname.d/$shared_archive_member_spec.imp~$AR $AR_FLAGS $output_objdir/$soname $output_objdir/$realname.d/$shared_archive_member_spec.o $output_objdir/$realname.d/$shared_archive_member_spec.imp'
+	  else
+	    # used by -dlpreopen to get the symbols
+	    _LT_TAGVAR(archive_expsym_cmds, $1)="$_LT_TAGVAR(archive_expsym_cmds, $1)"'~$MV  $output_objdir/$realname.d/$soname $output_objdir'
+	  fi
+	  _LT_TAGVAR(archive_expsym_cmds, $1)="$_LT_TAGVAR(archive_expsym_cmds, $1)"'~$RM -r $output_objdir/$realname.d'
 	fi
       fi
       ;;
@@ -5021,7 +5539,7 @@ _LT_EOF
       case $host_cpu in
       powerpc)
             # see comment about AmigaOS4 .so support
-            _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+            _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
             _LT_TAGVAR(archive_expsym_cmds, $1)=''
         ;;
       m68k)
@@ -5051,35 +5569,37 @@ _LT_EOF
 	# Tell ltmain to make .lib files, not .a files.
 	libext=lib
 	# Tell ltmain to make .dll files, not .so files.
-	shrext_cmds=".dll"
+	shrext_cmds=.dll
 	# FIXME: Setting linknames here is a bad hack.
-	_LT_TAGVAR(archive_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-dll~linknames='
-	_LT_TAGVAR(archive_expsym_cmds, $1)='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
-	    sed -n -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' -e '1\\\!p' < $export_symbols > $output_objdir/$soname.exp;
-	  else
-	    sed -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' < $export_symbols > $output_objdir/$soname.exp;
-	  fi~
-	  $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
-	  linknames='
+	_LT_TAGVAR(archive_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~linknames='
+	_LT_TAGVAR(archive_expsym_cmds, $1)='if _LT_DLL_DEF_P([$export_symbols]); then
+            cp "$export_symbols" "$output_objdir/$soname.def";
+            echo "$tool_output_objdir$soname.def" > "$output_objdir/$soname.exp";
+          else
+            $SED -e '\''s/^/-link -EXPORT:/'\'' < $export_symbols > $output_objdir/$soname.exp;
+          fi~
+          $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
+          linknames='
 	# The linker will not automatically build a static lib if we build a DLL.
 	# _LT_TAGVAR(old_archive_from_new_cmds, $1)='true'
 	_LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
+	_LT_TAGVAR(exclude_expsyms, $1)='_NULL_IMPORT_DESCRIPTOR|_IMPORT_DESCRIPTOR_.*'
 	_LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]][[ ]]/s/.*[[ ]]\([[^ ]]*\)/\1,DATA/'\'' | $SED -e '\''/^[[AITW]][[ ]]/s/.*[[ ]]//'\'' | sort | uniq > $export_symbols'
 	# Don't use ranlib
 	_LT_TAGVAR(old_postinstall_cmds, $1)='chmod 644 $oldlib'
 	_LT_TAGVAR(postlink_cmds, $1)='lt_outputfile="@OUTPUT@"~
-	  lt_tool_outputfile="@TOOL_OUTPUT@"~
-	  case $lt_outputfile in
-	    *.exe|*.EXE) ;;
-	    *)
-	      lt_outputfile="$lt_outputfile.exe"
-	      lt_tool_outputfile="$lt_tool_outputfile.exe"
-	      ;;
-	  esac~
-	  if test "$MANIFEST_TOOL" != ":" && test -f "$lt_outputfile.manifest"; then
-	    $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
-	    $RM "$lt_outputfile.manifest";
-	  fi'
+          lt_tool_outputfile="@TOOL_OUTPUT@"~
+          case $lt_outputfile in
+            *.exe|*.EXE) ;;
+            *)
+              lt_outputfile=$lt_outputfile.exe
+              lt_tool_outputfile=$lt_tool_outputfile.exe
+              ;;
+          esac~
+          if test : != "$MANIFEST_TOOL" && test -f "$lt_outputfile.manifest"; then
+            $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
+            $RM "$lt_outputfile.manifest";
+          fi'
 	;;
       *)
 	# Assume MSVC wrapper
@@ -5088,7 +5608,7 @@ _LT_EOF
 	# Tell ltmain to make .lib files, not .a files.
 	libext=lib
 	# Tell ltmain to make .dll files, not .so files.
-	shrext_cmds=".dll"
+	shrext_cmds=.dll
 	# FIXME: Setting linknames here is a bad hack.
 	_LT_TAGVAR(archive_cmds, $1)='$CC -o $lib $libobjs $compiler_flags `func_echo_all "$deplibs" | $SED '\''s/ -lc$//'\''` -link -dll~linknames='
 	# The linker will automatically build a .lib file if we build a DLL.
@@ -5110,10 +5630,6 @@ _LT_EOF
       _LT_TAGVAR(hardcode_shlibpath_var, $1)=no
       ;;
 
-    freebsd1*)
-      _LT_TAGVAR(ld_shlibs, $1)=no
-      ;;
-
     # FreeBSD 2.2.[012] allows us to include c++rt0.o to get C++ constructor
     # support.  Future versions do this automatically, but an explicit c++rt0.o
     # does not break anything, and helps significantly (at the cost of a little
@@ -5126,7 +5642,7 @@ _LT_EOF
       ;;
 
     # Unfortunately, older versions of FreeBSD 2 do not have this feature.
-    freebsd2*)
+    freebsd2.*)
       _LT_TAGVAR(archive_cmds, $1)='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
       _LT_TAGVAR(hardcode_direct, $1)=yes
       _LT_TAGVAR(hardcode_minus_L, $1)=yes
@@ -5142,34 +5658,33 @@ _LT_EOF
       ;;
 
     hpux9*)
-      if test "$GCC" = yes; then
-	_LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$CC -shared $pic_flag ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+      if test yes = "$GCC"; then
+	_LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$CC -shared $pic_flag $wl+b $wl$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test "x$output_objdir/$soname" = "x$lib" || mv $output_objdir/$soname $lib'
       else
-	_LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test "x$output_objdir/$soname" = "x$lib" || mv $output_objdir/$soname $lib'
       fi
-      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
+      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl+b $wl$libdir'
       _LT_TAGVAR(hardcode_libdir_separator, $1)=:
       _LT_TAGVAR(hardcode_direct, $1)=yes
 
       # hardcode_minus_L: Not really in the search PATH,
       # but as the default location of the library.
       _LT_TAGVAR(hardcode_minus_L, $1)=yes
-      _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
+      _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl-E'
       ;;
 
     hpux10*)
-      if test "$GCC" = yes && test "$with_gnu_ld" = no; then
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+      if test yes,no = "$GCC,$with_gnu_ld"; then
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $wl+h $wl$soname $wl+b $wl$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
       else
 	_LT_TAGVAR(archive_cmds, $1)='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'
       fi
-      if test "$with_gnu_ld" = no; then
-	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
-	_LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)='+b $libdir'
+      if test no = "$with_gnu_ld"; then
+	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl+b $wl$libdir'
 	_LT_TAGVAR(hardcode_libdir_separator, $1)=:
 	_LT_TAGVAR(hardcode_direct, $1)=yes
 	_LT_TAGVAR(hardcode_direct_absolute, $1)=yes
-	_LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
+	_LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl-E'
 	# hardcode_minus_L: Not really in the search PATH,
 	# but as the default location of the library.
 	_LT_TAGVAR(hardcode_minus_L, $1)=yes
@@ -5177,25 +5692,25 @@ _LT_EOF
       ;;
 
     hpux11*)
-      if test "$GCC" = yes && test "$with_gnu_ld" = no; then
+      if test yes,no = "$GCC,$with_gnu_ld"; then
 	case $host_cpu in
 	hppa*64*)
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared $wl+h $wl$soname -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	ia64*)
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $wl+h $wl$soname $wl+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	*)
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $wl+h $wl$soname $wl+b $wl$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	esac
       else
 	case $host_cpu in
 	hppa*64*)
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -b $wl+h $wl$soname -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	ia64*)
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -b $wl+h $wl$soname $wl+nodefaultrpath -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	*)
 	m4_if($1, [], [
@@ -5203,14 +5718,14 @@ _LT_EOF
 	  # (HP92453-01 A.11.01.20 doesn't, HP92453-01 B.11.X.35175-35176.GP does)
 	  _LT_LINKER_OPTION([if $CC understands -b],
 	    _LT_TAGVAR(lt_cv_prog_compiler__b, $1), [-b],
-	    [_LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'],
+	    [_LT_TAGVAR(archive_cmds, $1)='$CC -b $wl+h $wl$soname $wl+b $wl$install_libdir -o $lib $libobjs $deplibs $compiler_flags'],
 	    [_LT_TAGVAR(archive_cmds, $1)='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'])],
-	  [_LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'])
+	  [_LT_TAGVAR(archive_cmds, $1)='$CC -b $wl+h $wl$soname $wl+b $wl$install_libdir -o $lib $libobjs $deplibs $compiler_flags'])
 	  ;;
 	esac
       fi
-      if test "$with_gnu_ld" = no; then
-	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
+      if test no = "$with_gnu_ld"; then
+	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl+b $wl$libdir'
 	_LT_TAGVAR(hardcode_libdir_separator, $1)=:
 
 	case $host_cpu in
@@ -5221,7 +5736,7 @@ _LT_EOF
 	*)
 	  _LT_TAGVAR(hardcode_direct, $1)=yes
 	  _LT_TAGVAR(hardcode_direct_absolute, $1)=yes
-	  _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
+	  _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl-E'
 
 	  # hardcode_minus_L: Not really in the search PATH,
 	  # but as the default location of the library.
@@ -5232,16 +5747,16 @@ _LT_EOF
       ;;
 
     irix5* | irix6* | nonstopux*)
-      if test "$GCC" = yes; then
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+      if test yes = "$GCC"; then
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname `test -n "$verstring" && func_echo_all "$wl-set_version $wl$verstring"` $wl-update_registry $wl$output_objdir/so_locations -o $lib'
 	# Try to use the -exported_symbol ld option, if it does not
 	# work, assume that -exports_file does not work either and
 	# implicitly export all symbols.
 	# This should be the same for all languages, so no per-tag cache variable.
 	AC_CACHE_CHECK([whether the $host_os linker accepts -exported_symbol],
 	  [lt_cv_irix_exported_symbol],
-	  [save_LDFLAGS="$LDFLAGS"
-	   LDFLAGS="$LDFLAGS -shared ${wl}-exported_symbol ${wl}foo ${wl}-update_registry ${wl}/dev/null"
+	  [save_LDFLAGS=$LDFLAGS
+	   LDFLAGS="$LDFLAGS -shared $wl-exported_symbol ${wl}foo $wl-update_registry $wl/dev/null"
 	   AC_LINK_IFELSE(
 	     [AC_LANG_SOURCE(
 	        [AC_LANG_CASE([C], [[int foo (void) { return 0; }]],
@@ -5254,21 +5769,31 @@ _LT_EOF
       end]])])],
 	      [lt_cv_irix_exported_symbol=yes],
 	      [lt_cv_irix_exported_symbol=no])
-           LDFLAGS="$save_LDFLAGS"])
-	if test "$lt_cv_irix_exported_symbol" = yes; then
-          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations ${wl}-exports_file ${wl}$export_symbols -o $lib'
+           LDFLAGS=$save_LDFLAGS])
+	if test yes = "$lt_cv_irix_exported_symbol"; then
+          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname `test -n "$verstring" && func_echo_all "$wl-set_version $wl$verstring"` $wl-update_registry $wl$output_objdir/so_locations $wl-exports_file $wl$export_symbols -o $lib'
 	fi
       else
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -exports_file $export_symbols -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry $output_objdir/so_locations -o $lib'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry $output_objdir/so_locations -exports_file $export_symbols -o $lib'
       fi
       _LT_TAGVAR(archive_cmds_need_lc, $1)='no'
-      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
+      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath $wl$libdir'
       _LT_TAGVAR(hardcode_libdir_separator, $1)=:
       _LT_TAGVAR(inherit_rpath, $1)=yes
       _LT_TAGVAR(link_all_deplibs, $1)=yes
       ;;
 
+    linux*)
+      case $cc_basename in
+      tcc*)
+	# Fabrice Bellard et al's Tiny C Compiler
+	_LT_TAGVAR(ld_shlibs, $1)=yes
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
+	;;
+      esac
+      ;;
+
     netbsd*)
       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
 	_LT_TAGVAR(archive_cmds, $1)='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
@@ -5283,7 +5808,7 @@ _LT_EOF
     newsos6)
       _LT_TAGVAR(archive_cmds, $1)='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
       _LT_TAGVAR(hardcode_direct, $1)=yes
-      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
+      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath $wl$libdir'
       _LT_TAGVAR(hardcode_libdir_separator, $1)=:
       _LT_TAGVAR(hardcode_shlibpath_var, $1)=no
       ;;
@@ -5291,27 +5816,19 @@ _LT_EOF
     *nto* | *qnx*)
       ;;
 
-    openbsd*)
+    openbsd* | bitrig*)
       if test -f /usr/libexec/ld.so; then
 	_LT_TAGVAR(hardcode_direct, $1)=yes
 	_LT_TAGVAR(hardcode_shlibpath_var, $1)=no
 	_LT_TAGVAR(hardcode_direct_absolute, $1)=yes
-	if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+	if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`"; then
 	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
-	  _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-retain-symbols-file,$export_symbols'
-	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
-	  _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
+	  _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags $wl-retain-symbols-file,$export_symbols'
+	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath,$libdir'
+	  _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl-E'
 	else
-	  case $host_os in
-	   openbsd[[01]].* | openbsd2.[[0-7]] | openbsd2.[[0-7]].*)
-	     _LT_TAGVAR(archive_cmds, $1)='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'
-	     _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
-	     ;;
-	   *)
-	     _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
-	     _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
-	     ;;
-	  esac
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
+	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath,$libdir'
 	fi
       else
 	_LT_TAGVAR(ld_shlibs, $1)=no
@@ -5322,33 +5839,53 @@ _LT_EOF
       _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
       _LT_TAGVAR(hardcode_minus_L, $1)=yes
       _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
-      _LT_TAGVAR(archive_cmds, $1)='$ECHO "LIBRARY $libname INITINSTANCE" > $output_objdir/$libname.def~$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~echo DATA >> $output_objdir/$libname.def~echo " SINGLE NONSHARED" >> $output_objdir/$libname.def~echo EXPORTS >> $output_objdir/$libname.def~emxexp $libobjs >> $output_objdir/$libname.def~$CC -Zdll -Zcrtdll -o $lib $libobjs $deplibs $compiler_flags $output_objdir/$libname.def'
-      _LT_TAGVAR(old_archive_from_new_cmds, $1)='emximp -o $output_objdir/$libname.a $output_objdir/$libname.def'
+      shrext_cmds=.dll
+      _LT_TAGVAR(archive_cmds, $1)='$ECHO "LIBRARY ${soname%$shared_ext} INITINSTANCE TERMINSTANCE" > $output_objdir/$libname.def~
+	$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~
+	$ECHO "DATA MULTIPLE NONSHARED" >> $output_objdir/$libname.def~
+	$ECHO EXPORTS >> $output_objdir/$libname.def~
+	emxexp $libobjs | $SED /"_DLL_InitTerm"/d >> $output_objdir/$libname.def~
+	$CC -Zdll -Zcrtdll -o $output_objdir/$soname $libobjs $deplibs $compiler_flags $output_objdir/$libname.def~
+	emximp -o $lib $output_objdir/$libname.def'
+      _LT_TAGVAR(archive_expsym_cmds, $1)='$ECHO "LIBRARY ${soname%$shared_ext} INITINSTANCE TERMINSTANCE" > $output_objdir/$libname.def~
+	$ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~
+	$ECHO "DATA MULTIPLE NONSHARED" >> $output_objdir/$libname.def~
+	$ECHO EXPORTS >> $output_objdir/$libname.def~
+	prefix_cmds="$SED"~
+	if test EXPORTS = "`$SED 1q $export_symbols`"; then
+	  prefix_cmds="$prefix_cmds -e 1d";
+	fi~
+	prefix_cmds="$prefix_cmds -e \"s/^\(.*\)$/_\1/g\""~
+	cat $export_symbols | $prefix_cmds >> $output_objdir/$libname.def~
+	$CC -Zdll -Zcrtdll -o $output_objdir/$soname $libobjs $deplibs $compiler_flags $output_objdir/$libname.def~
+	emximp -o $lib $output_objdir/$libname.def'
+      _LT_TAGVAR(old_archive_From_new_cmds, $1)='emximp -o $output_objdir/${libname}_dll.a $output_objdir/$libname.def'
+      _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
       ;;
 
     osf3*)
-      if test "$GCC" = yes; then
-	_LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+      if test yes = "$GCC"; then
+	_LT_TAGVAR(allow_undefined_flag, $1)=' $wl-expect_unresolved $wl\*'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared$allow_undefined_flag $libobjs $deplibs $compiler_flags $wl-soname $wl$soname `test -n "$verstring" && func_echo_all "$wl-set_version $wl$verstring"` $wl-update_registry $wl$output_objdir/so_locations -o $lib'
       else
 	_LT_TAGVAR(allow_undefined_flag, $1)=' -expect_unresolved \*'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared$allow_undefined_flag $libobjs $deplibs $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry $output_objdir/so_locations -o $lib'
       fi
       _LT_TAGVAR(archive_cmds_need_lc, $1)='no'
-      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
+      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath $wl$libdir'
       _LT_TAGVAR(hardcode_libdir_separator, $1)=:
       ;;
 
     osf4* | osf5*)	# as osf3* with the addition of -msym flag
-      if test "$GCC" = yes; then
-	_LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $pic_flag $libobjs $deplibs $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
-	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
+      if test yes = "$GCC"; then
+	_LT_TAGVAR(allow_undefined_flag, $1)=' $wl-expect_unresolved $wl\*'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared$allow_undefined_flag $pic_flag $libobjs $deplibs $compiler_flags $wl-msym $wl-soname $wl$soname `test -n "$verstring" && func_echo_all "$wl-set_version $wl$verstring"` $wl-update_registry $wl$output_objdir/so_locations -o $lib'
+	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath $wl$libdir'
       else
 	_LT_TAGVAR(allow_undefined_flag, $1)=' -expect_unresolved \*'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $libobjs $deplibs $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared$allow_undefined_flag $libobjs $deplibs $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry $output_objdir/so_locations -o $lib'
 	_LT_TAGVAR(archive_expsym_cmds, $1)='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done; printf "%s\\n" "-hidden">> $lib.exp~
-	$CC -shared${allow_undefined_flag} ${wl}-input ${wl}$lib.exp $compiler_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib~$RM $lib.exp'
+          $CC -shared$allow_undefined_flag $wl-input $wl$lib.exp $compiler_flags $libobjs $deplibs -soname $soname `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry $output_objdir/so_locations -o $lib~$RM $lib.exp'
 
 	# Both c and cxx compiler support -rpath directly
 	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-rpath $libdir'
@@ -5359,24 +5896,24 @@ _LT_EOF
 
     solaris*)
       _LT_TAGVAR(no_undefined_flag, $1)=' -z defs'
-      if test "$GCC" = yes; then
-	wlarc='${wl}'
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag ${wl}-z ${wl}text ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
+      if test yes = "$GCC"; then
+	wlarc='$wl'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $wl-z ${wl}text $wl-h $wl$soname -o $lib $libobjs $deplibs $compiler_flags'
 	_LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-	  $CC -shared $pic_flag ${wl}-z ${wl}text ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
+          $CC -shared $pic_flag $wl-z ${wl}text $wl-M $wl$lib.exp $wl-h $wl$soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
       else
 	case `$CC -V 2>&1` in
 	*"Compilers 5.0"*)
 	  wlarc=''
-	  _LT_TAGVAR(archive_cmds, $1)='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
+	  _LT_TAGVAR(archive_cmds, $1)='$LD -G$allow_undefined_flag -h $soname -o $lib $libobjs $deplibs $linker_flags'
 	  _LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-	  $LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$RM $lib.exp'
+            $LD -G$allow_undefined_flag -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$RM $lib.exp'
 	  ;;
 	*)
-	  wlarc='${wl}'
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $compiler_flags'
+	  wlarc='$wl'
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -G$allow_undefined_flag -h $soname -o $lib $libobjs $deplibs $compiler_flags'
 	  _LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-	  $CC -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
+            $CC -G$allow_undefined_flag -M $lib.exp -h $soname -o $lib $libobjs $deplibs $compiler_flags~$RM $lib.exp'
 	  ;;
 	esac
       fi
@@ -5386,11 +5923,11 @@ _LT_EOF
       solaris2.[[0-5]] | solaris2.[[0-5]].*) ;;
       *)
 	# The compiler driver will combine and reorder linker options,
-	# but understands `-z linker_flag'.  GCC discards it without `$wl',
+	# but understands '-z linker_flag'.  GCC discards it without '$wl',
 	# but is careful enough not to reorder.
 	# Supported since Solaris 2.6 (maybe 2.5.1?)
-	if test "$GCC" = yes; then
-	  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}-z ${wl}allextract$convenience ${wl}-z ${wl}defaultextract'
+	if test yes = "$GCC"; then
+	  _LT_TAGVAR(whole_archive_flag_spec, $1)='$wl-z ${wl}allextract$convenience $wl-z ${wl}defaultextract'
 	else
 	  _LT_TAGVAR(whole_archive_flag_spec, $1)='-z allextract$convenience -z defaultextract'
 	fi
@@ -5400,10 +5937,10 @@ _LT_EOF
       ;;
 
     sunos4*)
-      if test "x$host_vendor" = xsequent; then
+      if test sequent = "$host_vendor"; then
 	# Use $CC to link under sequent, because it throws in some extra .o
 	# files that make .init and .fini sections work.
-	_LT_TAGVAR(archive_cmds, $1)='$CC -G ${wl}-h $soname -o $lib $libobjs $deplibs $compiler_flags'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -G $wl-h $soname -o $lib $libobjs $deplibs $compiler_flags'
       else
 	_LT_TAGVAR(archive_cmds, $1)='$LD -assert pure-text -Bstatic -o $lib $libobjs $deplibs $linker_flags'
       fi
@@ -5452,43 +5989,43 @@ _LT_EOF
       ;;
 
     sysv4*uw2* | sysv5OpenUNIX* | sysv5UnixWare7.[[01]].[[10]]* | unixware7* | sco3.2v5.0.[[024]]*)
-      _LT_TAGVAR(no_undefined_flag, $1)='${wl}-z,text'
+      _LT_TAGVAR(no_undefined_flag, $1)='$wl-z,text'
       _LT_TAGVAR(archive_cmds_need_lc, $1)=no
       _LT_TAGVAR(hardcode_shlibpath_var, $1)=no
       runpath_var='LD_RUN_PATH'
 
-      if test "$GCC" = yes; then
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+      if test yes = "$GCC"; then
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $wl-Bexport:$export_symbols $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
       else
-	_LT_TAGVAR(archive_cmds, $1)='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -G $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G $wl-Bexport:$export_symbols $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
       fi
       ;;
 
     sysv5* | sco3.2v5* | sco5v6*)
-      # Note: We can NOT use -z defs as we might desire, because we do not
+      # Note: We CANNOT use -z defs as we might desire, because we do not
       # link with -lc, and that would cause any symbols used from libc to
       # always be unresolved, which means just about no library would
       # ever link correctly.  If we're not using GNU ld we use -z text
       # though, which does catch some bad symbols but isn't as heavy-handed
       # as -z defs.
-      _LT_TAGVAR(no_undefined_flag, $1)='${wl}-z,text'
-      _LT_TAGVAR(allow_undefined_flag, $1)='${wl}-z,nodefs'
+      _LT_TAGVAR(no_undefined_flag, $1)='$wl-z,text'
+      _LT_TAGVAR(allow_undefined_flag, $1)='$wl-z,nodefs'
       _LT_TAGVAR(archive_cmds_need_lc, $1)=no
       _LT_TAGVAR(hardcode_shlibpath_var, $1)=no
-      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-R,$libdir'
+      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-R,$libdir'
       _LT_TAGVAR(hardcode_libdir_separator, $1)=':'
       _LT_TAGVAR(link_all_deplibs, $1)=yes
-      _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-Bexport'
+      _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl-Bexport'
       runpath_var='LD_RUN_PATH'
 
-      if test "$GCC" = yes; then
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+      if test yes = "$GCC"; then
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $wl-Bexport:$export_symbols $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
       else
-	_LT_TAGVAR(archive_cmds, $1)='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -G $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G $wl-Bexport:$export_symbols $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
       fi
       ;;
 
@@ -5503,17 +6040,17 @@ _LT_EOF
       ;;
     esac
 
-    if test x$host_vendor = xsni; then
+    if test sni = "$host_vendor"; then
       case $host in
       sysv4 | sysv4.2uw2* | sysv4.3* | sysv5*)
-	_LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-Blargedynsym'
+	_LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl-Blargedynsym'
 	;;
       esac
     fi
   fi
 ])
 AC_MSG_RESULT([$_LT_TAGVAR(ld_shlibs, $1)])
-test "$_LT_TAGVAR(ld_shlibs, $1)" = no && can_build_shared=no
+test no = "$_LT_TAGVAR(ld_shlibs, $1)" && can_build_shared=no
 
 _LT_TAGVAR(with_gnu_ld, $1)=$with_gnu_ld
 
@@ -5530,7 +6067,7 @@ x|xyes)
   # Assume -lc should be added
   _LT_TAGVAR(archive_cmds_need_lc, $1)=yes
 
-  if test "$enable_shared" = yes && test "$GCC" = yes; then
+  if test yes,yes = "$GCC,$enable_shared"; then
     case $_LT_TAGVAR(archive_cmds, $1) in
     *'~'*)
       # FIXME: we may have to deal with multi-command sequences.
@@ -5607,18 +6144,15 @@ _LT_TAGDECL([], [no_undefined_flag], [1]
 _LT_TAGDECL([], [hardcode_libdir_flag_spec], [1],
     [Flag to hardcode $libdir into a binary during linking.
     This must work even if $libdir does not exist])
-_LT_TAGDECL([], [hardcode_libdir_flag_spec_ld], [1],
-    [[If ld is used when linking, flag to hardcode $libdir into a binary
-    during linking.  This must work even if $libdir does not exist]])
 _LT_TAGDECL([], [hardcode_libdir_separator], [1],
     [Whether we need a single "-rpath" flag with a separated argument])
 _LT_TAGDECL([], [hardcode_direct], [0],
-    [Set to "yes" if using DIR/libNAME${shared_ext} during linking hardcodes
+    [Set to "yes" if using DIR/libNAME$shared_ext during linking hardcodes
     DIR into the resulting binary])
 _LT_TAGDECL([], [hardcode_direct_absolute], [0],
-    [Set to "yes" if using DIR/libNAME${shared_ext} during linking hardcodes
+    [Set to "yes" if using DIR/libNAME$shared_ext during linking hardcodes
     DIR into the resulting binary and the resulting library dependency is
-    "absolute", i.e impossible to change by setting ${shlibpath_var} if the
+    "absolute", i.e impossible to change by setting $shlibpath_var if the
     library is relocated])
 _LT_TAGDECL([], [hardcode_minus_L], [0],
     [Set to "yes" if using the -LDIR flag during linking hardcodes DIR
@@ -5659,10 +6193,10 @@ dnl    [Compiler flag to generate thread
 # ------------------------
 # Ensure that the configuration variables for a C compiler are suitably
 # defined.  These variables are subsequently used by _LT_CONFIG to write
-# the compiler configuration to `libtool'.
+# the compiler configuration to 'libtool'.
 m4_defun([_LT_LANG_C_CONFIG],
 [m4_require([_LT_DECL_EGREP])dnl
-lt_save_CC="$CC"
+lt_save_CC=$CC
 AC_LANG_PUSH(C)
 
 # Source file extension for C test sources.
@@ -5702,18 +6236,18 @@ if test -n "$compiler"; then
   LT_SYS_DLOPEN_SELF
   _LT_CMD_STRIPLIB
 
-  # Report which library types will actually be built
+  # Report what library types will actually be built
   AC_MSG_CHECKING([if libtool supports shared libraries])
   AC_MSG_RESULT([$can_build_shared])
 
   AC_MSG_CHECKING([whether to build shared libraries])
-  test "$can_build_shared" = "no" && enable_shared=no
+  test no = "$can_build_shared" && enable_shared=no
 
   # On AIX, shared libraries and static libraries use the same namespace, and
   # are all built from PIC.
   case $host_os in
   aix3*)
-    test "$enable_shared" = yes && enable_static=no
+    test yes = "$enable_shared" && enable_static=no
     if test -n "$RANLIB"; then
       archive_cmds="$archive_cmds~\$RANLIB \$lib"
       postinstall_cmds='$RANLIB $lib'
@@ -5721,8 +6255,12 @@ if test -n "$compiler"; then
     ;;
 
   aix[[4-9]]*)
-    if test "$host_cpu" != ia64 && test "$aix_use_runtimelinking" = no ; then
-      test "$enable_shared" = yes && enable_static=no
+    if test ia64 != "$host_cpu"; then
+      case $enable_shared,$with_aix_soname,$aix_use_runtimelinking in
+      yes,aix,yes) ;;			# shared object as lib.so file only
+      yes,svr4,*) ;;			# shared object as lib.so archive member only
+      yes,*) enable_static=no ;;	# shared object in lib.a archive as well
+      esac
     fi
     ;;
   esac
@@ -5730,13 +6268,13 @@ if test -n "$compiler"; then
 
   AC_MSG_CHECKING([whether to build static libraries])
   # Make sure either enable_shared or enable_static is yes.
-  test "$enable_shared" = yes || enable_static=yes
+  test yes = "$enable_shared" || enable_static=yes
   AC_MSG_RESULT([$enable_static])
 
   _LT_CONFIG($1)
 fi
 AC_LANG_POP
-CC="$lt_save_CC"
+CC=$lt_save_CC
 ])# _LT_LANG_C_CONFIG
 
 
@@ -5744,14 +6282,14 @@ CC="$lt_save_CC"
 # --------------------------
 # Ensure that the configuration variables for a C++ compiler are suitably
 # defined.  These variables are subsequently used by _LT_CONFIG to write
-# the compiler configuration to `libtool'.
+# the compiler configuration to 'libtool'.
 m4_defun([_LT_LANG_CXX_CONFIG],
 [m4_require([_LT_FILEUTILS_DEFAULTS])dnl
 m4_require([_LT_DECL_EGREP])dnl
 m4_require([_LT_PATH_MANIFEST_TOOL])dnl
-if test -n "$CXX" && ( test "X$CXX" != "Xno" &&
-    ( (test "X$CXX" = "Xg++" && `g++ -v >/dev/null 2>&1` ) ||
-    (test "X$CXX" != "Xg++"))) ; then
+if test -n "$CXX" && ( test no != "$CXX" &&
+    ( (test g++ = "$CXX" && `g++ -v >/dev/null 2>&1` ) ||
+    (test g++ != "$CXX"))); then
   AC_PROG_CXXCPP
 else
   _lt_caught_CXX_error=yes
@@ -5767,7 +6305,6 @@ _LT_TAGVAR(export_dynamic_flag_spec, $1)
 _LT_TAGVAR(hardcode_direct, $1)=no
 _LT_TAGVAR(hardcode_direct_absolute, $1)=no
 _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-_LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
 _LT_TAGVAR(hardcode_libdir_separator, $1)=
 _LT_TAGVAR(hardcode_minus_L, $1)=no
 _LT_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
@@ -5794,7 +6331,7 @@ _LT_TAGVAR(objext, $1)=$objext
 # the CXX compiler isn't working.  Some variables (like enable_shared)
 # are currently assumed to apply to all compilers on this platform,
 # and will be corrupted by setting them based on a non-working compiler.
-if test "$_lt_caught_CXX_error" != yes; then
+if test yes != "$_lt_caught_CXX_error"; then
   # Code to be used in simple compile tests
   lt_simple_compile_test_code="int some_variable = 0;"
 
@@ -5836,35 +6373,35 @@ if test "$_lt_caught_CXX_error" != yes;
   if test -n "$compiler"; then
     # We don't want -fno-exception when compiling C++ code, so set the
     # no_builtin_flag separately
-    if test "$GXX" = yes; then
+    if test yes = "$GXX"; then
       _LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)=' -fno-builtin'
     else
       _LT_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)=
     fi
 
-    if test "$GXX" = yes; then
+    if test yes = "$GXX"; then
       # Set up default GNU C++ configuration
 
       LT_PATH_LD
 
       # Check if GNU C++ uses GNU ld as the underlying linker, since the
       # archiving commands below assume that GNU ld is being used.
-      if test "$with_gnu_ld" = yes; then
-        _LT_TAGVAR(archive_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
-        _LT_TAGVAR(archive_expsym_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+      if test yes = "$with_gnu_ld"; then
+        _LT_TAGVAR(archive_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-soname $wl$soname -o $lib'
+        _LT_TAGVAR(archive_expsym_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-soname $wl$soname $wl-retain-symbols-file $wl$export_symbols -o $lib'
 
-        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
-        _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
+        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath $wl$libdir'
+        _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl--export-dynamic'
 
         # If archive_cmds runs LD, not CC, wlarc should be empty
         # XXX I think wlarc can be eliminated in ltcf-cxx, but I need to
         #     investigate it a little bit more. (MM)
-        wlarc='${wl}'
+        wlarc='$wl'
 
         # ancient GNU ld didn't support --whole-archive et. al.
         if eval "`$CC -print-prog-name=ld` --help 2>&1" |
 	  $GREP 'no-whole-archive' > /dev/null; then
-          _LT_TAGVAR(whole_archive_flag_spec, $1)="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
+          _LT_TAGVAR(whole_archive_flag_spec, $1)=$wlarc'--whole-archive$convenience '$wlarc'--no-whole-archive'
         else
           _LT_TAGVAR(whole_archive_flag_spec, $1)=
         fi
@@ -5900,18 +6437,30 @@ if test "$_lt_caught_CXX_error" != yes;
         _LT_TAGVAR(ld_shlibs, $1)=no
         ;;
       aix[[4-9]]*)
-        if test "$host_cpu" = ia64; then
+        if test ia64 = "$host_cpu"; then
           # On IA64, the linker does run time linking by default, so we don't
           # have to do anything special.
           aix_use_runtimelinking=no
           exp_sym_flag='-Bexport'
-          no_entry_flag=""
+          no_entry_flag=
         else
           aix_use_runtimelinking=no
 
           # Test if we are trying to use run time linking or normal
           # AIX style linking. If -brtl is somewhere in LDFLAGS, we
-          # need to do runtime linking.
+          # have runtime linking enabled, and use it for executables.
+          # For shared libraries, we enable/disable runtime linking
+          # depending on the kind of the shared library created -
+          # when "with_aix_soname,aix_use_runtimelinking" is:
+          # "aix,no"   lib.a(lib.so.V) shared, rtl:no,  for executables
+          # "aix,yes"  lib.so          shared, rtl:yes, for executables
+          #            lib.a           static archive
+          # "both,no"  lib.so.V(shr.o) shared, rtl:yes
+          #            lib.a(lib.so.V) shared, rtl:no,  for executables
+          # "both,yes" lib.so.V(shr.o) shared, rtl:yes, for executables
+          #            lib.a(lib.so.V) shared, rtl:no
+          # "svr4,*"   lib.so.V(shr.o) shared, rtl:yes, for executables
+          #            lib.a           static archive
           case $host_os in aix4.[[23]]|aix4.[[23]].*|aix[[5-9]]*)
 	    for ld_flag in $LDFLAGS; do
 	      case $ld_flag in
@@ -5921,6 +6470,13 @@ if test "$_lt_caught_CXX_error" != yes;
 	        ;;
 	      esac
 	    done
+	    if test svr4,no = "$with_aix_soname,$aix_use_runtimelinking"; then
+	      # With aix-soname=svr4, we create the lib.so.V shared archives only,
+	      # so we don't have lib.a shared libs to link our executables.
+	      # We have to force runtime linking in this case.
+	      aix_use_runtimelinking=yes
+	      LDFLAGS="$LDFLAGS -Wl,-brtl"
+	    fi
 	    ;;
           esac
 
@@ -5939,13 +6495,21 @@ if test "$_lt_caught_CXX_error" != yes;
         _LT_TAGVAR(hardcode_direct_absolute, $1)=yes
         _LT_TAGVAR(hardcode_libdir_separator, $1)=':'
         _LT_TAGVAR(link_all_deplibs, $1)=yes
-        _LT_TAGVAR(file_list_spec, $1)='${wl}-f,'
+        _LT_TAGVAR(file_list_spec, $1)='$wl-f,'
+        case $with_aix_soname,$aix_use_runtimelinking in
+        aix,*) ;;	# no import file
+        svr4,* | *,yes) # use import file
+          # The Import File defines what to hardcode.
+          _LT_TAGVAR(hardcode_direct, $1)=no
+          _LT_TAGVAR(hardcode_direct_absolute, $1)=no
+          ;;
+        esac
 
-        if test "$GXX" = yes; then
+        if test yes = "$GXX"; then
           case $host_os in aix4.[[012]]|aix4.[[012]].*)
           # We only want to do this on AIX 4.2 and lower, the check
           # below for broken collect2 doesn't work under 4.3+
-	  collect2name=`${CC} -print-prog-name=collect2`
+	  collect2name=`$CC -print-prog-name=collect2`
 	  if test -f "$collect2name" &&
 	     strings "$collect2name" | $GREP resolve_lib_name >/dev/null
 	  then
@@ -5963,64 +6527,84 @@ if test "$_lt_caught_CXX_error" != yes;
 	  fi
           esac
           shared_flag='-shared'
-	  if test "$aix_use_runtimelinking" = yes; then
-	    shared_flag="$shared_flag "'${wl}-G'
+	  if test yes = "$aix_use_runtimelinking"; then
+	    shared_flag=$shared_flag' $wl-G'
 	  fi
+	  # Need to ensure runtime linking is disabled for the traditional
+	  # shared library, or the linker may eventually find shared libraries
+	  # /with/ Import File - we do not want to mix them.
+	  shared_flag_aix='-shared'
+	  shared_flag_svr4='-shared $wl-G'
         else
           # not using gcc
-          if test "$host_cpu" = ia64; then
+          if test ia64 = "$host_cpu"; then
 	  # VisualAge C++, Version 5.5 for AIX 5L for IA-64, Beta 3 Release
 	  # chokes on -Wl,-G. The following line is correct:
 	  shared_flag='-G'
           else
-	    if test "$aix_use_runtimelinking" = yes; then
-	      shared_flag='${wl}-G'
+	    if test yes = "$aix_use_runtimelinking"; then
+	      shared_flag='$wl-G'
 	    else
-	      shared_flag='${wl}-bM:SRE'
+	      shared_flag='$wl-bM:SRE'
 	    fi
+	    shared_flag_aix='$wl-bM:SRE'
+	    shared_flag_svr4='$wl-G'
           fi
         fi
 
-        _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-bexpall'
+        _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl-bexpall'
         # It seems that -bexpall does not export symbols beginning with
         # underscore (_), so it is better to generate a list of symbols to
 	# export.
         _LT_TAGVAR(always_export_symbols, $1)=yes
-        if test "$aix_use_runtimelinking" = yes; then
+	if test aix,yes = "$with_aix_soname,$aix_use_runtimelinking"; then
           # Warning - without using the other runtime loading flags (-brtl),
           # -berok will link without error, but may produce a broken library.
-          _LT_TAGVAR(allow_undefined_flag, $1)='-berok'
+          # The "-G" linker flag allows undefined symbols.
+          _LT_TAGVAR(no_undefined_flag, $1)='-bernotok'
           # Determine the default libpath from the value encoded in an empty
           # executable.
           _LT_SYS_MODULE_PATH_AIX([$1])
-          _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-blibpath:$libdir:'"$aix_libpath"
+          _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-blibpath:$libdir:'"$aix_libpath"
 
-          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then func_echo_all "${wl}${allow_undefined_flag}"; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
+          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $deplibs $wl'$no_entry_flag' $compiler_flags `if test -n "$allow_undefined_flag"; then func_echo_all "$wl$allow_undefined_flag"; else :; fi` $wl'$exp_sym_flag:\$export_symbols' '$shared_flag
         else
-          if test "$host_cpu" = ia64; then
-	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-R $libdir:/usr/lib:/lib'
+          if test ia64 = "$host_cpu"; then
+	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-R $libdir:/usr/lib:/lib'
 	    _LT_TAGVAR(allow_undefined_flag, $1)="-z nodefs"
-	    _LT_TAGVAR(archive_expsym_cmds, $1)="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags ${wl}${allow_undefined_flag} '"\${wl}$exp_sym_flag:\$export_symbols"
+	    _LT_TAGVAR(archive_expsym_cmds, $1)="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs '"\$wl$no_entry_flag"' $compiler_flags $wl$allow_undefined_flag '"\$wl$exp_sym_flag:\$export_symbols"
           else
 	    # Determine the default libpath from the value encoded in an
 	    # empty executable.
 	    _LT_SYS_MODULE_PATH_AIX([$1])
-	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-blibpath:$libdir:'"$aix_libpath"
+	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-blibpath:$libdir:'"$aix_libpath"
 	    # Warning - without using the other run time loading flags,
 	    # -berok will link without error, but may produce a broken library.
-	    _LT_TAGVAR(no_undefined_flag, $1)=' ${wl}-bernotok'
-	    _LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-berok'
-	    if test "$with_gnu_ld" = yes; then
+	    _LT_TAGVAR(no_undefined_flag, $1)=' $wl-bernotok'
+	    _LT_TAGVAR(allow_undefined_flag, $1)=' $wl-berok'
+	    if test yes = "$with_gnu_ld"; then
 	      # We only use this code for GNU lds that support --whole-archive.
-	      _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
+	      _LT_TAGVAR(whole_archive_flag_spec, $1)='$wl--whole-archive$convenience $wl--no-whole-archive'
 	    else
 	      # Exported symbols can be pulled into shared objects from archives
 	      _LT_TAGVAR(whole_archive_flag_spec, $1)='$convenience'
 	    fi
 	    _LT_TAGVAR(archive_cmds_need_lc, $1)=yes
-	    # This is similar to how AIX traditionally builds its shared
-	    # libraries.
-	    _LT_TAGVAR(archive_expsym_cmds, $1)="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs ${wl}-bnoentry $compiler_flags ${wl}-bE:$export_symbols${allow_undefined_flag}~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
+	    _LT_TAGVAR(archive_expsym_cmds, $1)='$RM -r $output_objdir/$realname.d~$MKDIR $output_objdir/$realname.d'
+	    # -brtl affects multiple linker settings, -berok does not and is overridden later
+	    compiler_flags_filtered='`func_echo_all "$compiler_flags " | $SED -e "s%-brtl\\([[, ]]\\)%-berok\\1%g"`'
+	    if test svr4 != "$with_aix_soname"; then
+	      # This is similar to how AIX traditionally builds its shared
+	      # libraries. Need -bnortl late, we may have -brtl in LDFLAGS.
+	      _LT_TAGVAR(archive_expsym_cmds, $1)="$_LT_TAGVAR(archive_expsym_cmds, $1)"'~$CC '$shared_flag_aix' -o $output_objdir/$realname.d/$soname $libobjs $deplibs $wl-bnoentry '$compiler_flags_filtered'$wl-bE:$export_symbols$allow_undefined_flag~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$realname.d/$soname'
+	    fi
+	    if test aix != "$with_aix_soname"; then
+	      _LT_TAGVAR(archive_expsym_cmds, $1)="$_LT_TAGVAR(archive_expsym_cmds, $1)"'~$CC '$shared_flag_svr4' -o $output_objdir/$realname.d/$shared_archive_member_spec.o $libobjs $deplibs $wl-bnoentry '$compiler_flags_filtered'$wl-bE:$export_symbols$allow_undefined_flag~$STRIP -e $output_objdir/$realname.d/$shared_archive_member_spec.o~( func_echo_all "#! $soname($shared_archive_member_spec.o)"; if test shr_64 = "$shared_archive_member_spec"; then func_echo_all "# 64"; else func_echo_all "# 32"; fi; cat $export_symbols ) > $output_objdir/$realname.d/$shared_archive_member_spec.imp~$AR $AR_FLAGS $output_objdir/$soname $output_objdir/$realname.d/$shared_archive_member_spec.o $output_objdir/$realname.d/$shared_archive_member_spec.imp'
+	    else
+	      # used by -dlpreopen to get the symbols
+	      _LT_TAGVAR(archive_expsym_cmds, $1)="$_LT_TAGVAR(archive_expsym_cmds, $1)"'~$MV  $output_objdir/$realname.d/$soname $output_objdir'
+	    fi
+	    _LT_TAGVAR(archive_expsym_cmds, $1)="$_LT_TAGVAR(archive_expsym_cmds, $1)"'~$RM -r $output_objdir/$realname.d'
           fi
         fi
         ;;
@@ -6030,7 +6614,7 @@ if test "$_lt_caught_CXX_error" != yes;
 	  _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
 	  # Joseph Beckenbach <jrb3@best.com> says some releases of gcc
 	  # support --undefined.  This deserves some investigation.  FIXME
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -nostart $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -nostart $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
 	else
 	  _LT_TAGVAR(ld_shlibs, $1)=no
 	fi
@@ -6058,57 +6642,58 @@ if test "$_lt_caught_CXX_error" != yes;
 	  # Tell ltmain to make .lib files, not .a files.
 	  libext=lib
 	  # Tell ltmain to make .dll files, not .so files.
-	  shrext_cmds=".dll"
+	  shrext_cmds=.dll
 	  # FIXME: Setting linknames here is a bad hack.
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-dll~linknames='
-	  _LT_TAGVAR(archive_expsym_cmds, $1)='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
-	      $SED -n -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' -e '1\\\!p' < $export_symbols > $output_objdir/$soname.exp;
-	    else
-	      $SED -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' < $export_symbols > $output_objdir/$soname.exp;
-	    fi~
-	    $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
-	    linknames='
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~linknames='
+	  _LT_TAGVAR(archive_expsym_cmds, $1)='if _LT_DLL_DEF_P([$export_symbols]); then
+              cp "$export_symbols" "$output_objdir/$soname.def";
+              echo "$tool_output_objdir$soname.def" > "$output_objdir/$soname.exp";
+            else
+              $SED -e '\''s/^/-link -EXPORT:/'\'' < $export_symbols > $output_objdir/$soname.exp;
+            fi~
+            $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
+            linknames='
 	  # The linker will not automatically build a static lib if we build a DLL.
 	  # _LT_TAGVAR(old_archive_from_new_cmds, $1)='true'
 	  _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
 	  # Don't use ranlib
 	  _LT_TAGVAR(old_postinstall_cmds, $1)='chmod 644 $oldlib'
 	  _LT_TAGVAR(postlink_cmds, $1)='lt_outputfile="@OUTPUT@"~
-	    lt_tool_outputfile="@TOOL_OUTPUT@"~
-	    case $lt_outputfile in
-	      *.exe|*.EXE) ;;
-	      *)
-		lt_outputfile="$lt_outputfile.exe"
-		lt_tool_outputfile="$lt_tool_outputfile.exe"
-		;;
-	    esac~
-	    func_to_tool_file "$lt_outputfile"~
-	    if test "$MANIFEST_TOOL" != ":" && test -f "$lt_outputfile.manifest"; then
-	      $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
-	      $RM "$lt_outputfile.manifest";
-	    fi'
+            lt_tool_outputfile="@TOOL_OUTPUT@"~
+            case $lt_outputfile in
+              *.exe|*.EXE) ;;
+              *)
+                lt_outputfile=$lt_outputfile.exe
+                lt_tool_outputfile=$lt_tool_outputfile.exe
+                ;;
+            esac~
+            func_to_tool_file "$lt_outputfile"~
+            if test : != "$MANIFEST_TOOL" && test -f "$lt_outputfile.manifest"; then
+              $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
+              $RM "$lt_outputfile.manifest";
+            fi'
 	  ;;
 	*)
 	  # g++
 	  # _LT_TAGVAR(hardcode_libdir_flag_spec, $1) is actually meaningless,
 	  # as there is no search path for DLLs.
 	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
-	  _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-all-symbols'
+	  _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl--export-all-symbols'
 	  _LT_TAGVAR(allow_undefined_flag, $1)=unsupported
 	  _LT_TAGVAR(always_export_symbols, $1)=no
 	  _LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
 
 	  if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
-	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
-	    # If the export-symbols file already is a .def file (1st line
-	    # is EXPORTS), use it as is; otherwise, prepend...
-	    _LT_TAGVAR(archive_expsym_cmds, $1)='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
-	      cp $export_symbols $output_objdir/$soname.def;
-	    else
-	      echo EXPORTS > $output_objdir/$soname.def;
-	      cat $export_symbols >> $output_objdir/$soname.def;
-	    fi~
-	    $CC -shared -nostdlib $output_objdir/$soname.def $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname $wl--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+	    # If the export-symbols file already is a .def file, use it as
+	    # is; otherwise, prepend EXPORTS...
+	    _LT_TAGVAR(archive_expsym_cmds, $1)='if _LT_DLL_DEF_P([$export_symbols]); then
+              cp $export_symbols $output_objdir/$soname.def;
+            else
+              echo EXPORTS > $output_objdir/$soname.def;
+              cat $export_symbols >> $output_objdir/$soname.def;
+            fi~
+            $CC -shared -nostdlib $output_objdir/$soname.def $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname $wl--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
 	  else
 	    _LT_TAGVAR(ld_shlibs, $1)=no
 	  fi
@@ -6119,6 +6704,34 @@ if test "$_lt_caught_CXX_error" != yes;
         _LT_DARWIN_LINKER_FEATURES($1)
 	;;
 
+      os2*)
+	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
+	_LT_TAGVAR(hardcode_minus_L, $1)=yes
+	_LT_TAGVAR(allow_undefined_flag, $1)=unsupported
+	shrext_cmds=.dll
+	_LT_TAGVAR(archive_cmds, $1)='$ECHO "LIBRARY ${soname%$shared_ext} INITINSTANCE TERMINSTANCE" > $output_objdir/$libname.def~
+	  $ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~
+	  $ECHO "DATA MULTIPLE NONSHARED" >> $output_objdir/$libname.def~
+	  $ECHO EXPORTS >> $output_objdir/$libname.def~
+	  emxexp $libobjs | $SED /"_DLL_InitTerm"/d >> $output_objdir/$libname.def~
+	  $CC -Zdll -Zcrtdll -o $output_objdir/$soname $libobjs $deplibs $compiler_flags $output_objdir/$libname.def~
+	  emximp -o $lib $output_objdir/$libname.def'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='$ECHO "LIBRARY ${soname%$shared_ext} INITINSTANCE TERMINSTANCE" > $output_objdir/$libname.def~
+	  $ECHO "DESCRIPTION \"$libname\"" >> $output_objdir/$libname.def~
+	  $ECHO "DATA MULTIPLE NONSHARED" >> $output_objdir/$libname.def~
+	  $ECHO EXPORTS >> $output_objdir/$libname.def~
+	  prefix_cmds="$SED"~
+	  if test EXPORTS = "`$SED 1q $export_symbols`"; then
+	    prefix_cmds="$prefix_cmds -e 1d";
+	  fi~
+	  prefix_cmds="$prefix_cmds -e \"s/^\(.*\)$/_\1/g\""~
+	  cat $export_symbols | $prefix_cmds >> $output_objdir/$libname.def~
+	  $CC -Zdll -Zcrtdll -o $output_objdir/$soname $libobjs $deplibs $compiler_flags $output_objdir/$libname.def~
+	  emximp -o $lib $output_objdir/$libname.def'
+	_LT_TAGVAR(old_archive_From_new_cmds, $1)='emximp -o $output_objdir/${libname}_dll.a $output_objdir/$libname.def'
+	_LT_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
+	;;
+
       dgux*)
         case $cc_basename in
           ec++*)
@@ -6137,7 +6750,7 @@ if test "$_lt_caught_CXX_error" != yes;
         esac
         ;;
 
-      freebsd[[12]]*)
+      freebsd2.*)
         # C++ shared libraries reported to be fairly broken before
 	# switch to ELF
         _LT_TAGVAR(ld_shlibs, $1)=no
@@ -6153,18 +6766,15 @@ if test "$_lt_caught_CXX_error" != yes;
         _LT_TAGVAR(ld_shlibs, $1)=yes
         ;;
 
-      gnu*)
-        ;;
-
       haiku*)
-        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
         _LT_TAGVAR(link_all_deplibs, $1)=yes
         ;;
 
       hpux9*)
-        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
+        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl+b $wl$libdir'
         _LT_TAGVAR(hardcode_libdir_separator, $1)=:
-        _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
+        _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl-E'
         _LT_TAGVAR(hardcode_direct, $1)=yes
         _LT_TAGVAR(hardcode_minus_L, $1)=yes # Not in the search PATH,
 				             # but as the default
@@ -6176,7 +6786,7 @@ if test "$_lt_caught_CXX_error" != yes;
             _LT_TAGVAR(ld_shlibs, $1)=no
             ;;
           aCC*)
-            _LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$CC -b ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+            _LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$CC -b $wl+b $wl$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test "x$output_objdir/$soname" = "x$lib" || mv $output_objdir/$soname $lib'
             # Commands to make compiler produce verbose output that lists
             # what "hidden" libraries, object files and flags are used when
             # linking a shared library.
@@ -6185,11 +6795,11 @@ if test "$_lt_caught_CXX_error" != yes;
             # explicitly linking system object files so we need to strip them
             # from the output so that they don't get included in the library
             # dependencies.
-            output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $EGREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
+            output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $EGREP "\-L"`; list= ; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
             ;;
           *)
-            if test "$GXX" = yes; then
-              _LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$CC -shared -nostdlib $pic_flag ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+            if test yes = "$GXX"; then
+              _LT_TAGVAR(archive_cmds, $1)='$RM $output_objdir/$soname~$CC -shared -nostdlib $pic_flag $wl+b $wl$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test "x$output_objdir/$soname" = "x$lib" || mv $output_objdir/$soname $lib'
             else
               # FIXME: insert proper C++ library support
               _LT_TAGVAR(ld_shlibs, $1)=no
@@ -6199,15 +6809,15 @@ if test "$_lt_caught_CXX_error" != yes;
         ;;
 
       hpux10*|hpux11*)
-        if test $with_gnu_ld = no; then
-	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
+        if test no = "$with_gnu_ld"; then
+	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl+b $wl$libdir'
 	  _LT_TAGVAR(hardcode_libdir_separator, $1)=:
 
           case $host_cpu in
             hppa*64*|ia64*)
               ;;
             *)
-	      _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
+	      _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl-E'
               ;;
           esac
         fi
@@ -6233,13 +6843,13 @@ if test "$_lt_caught_CXX_error" != yes;
           aCC*)
 	    case $host_cpu in
 	      hppa*64*)
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -b $wl+h $wl$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	        ;;
 	      ia64*)
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -b $wl+h $wl$soname $wl+nodefaultrpath -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	        ;;
 	      *)
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -b $wl+h $wl$soname $wl+b $wl$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	        ;;
 	    esac
 	    # Commands to make compiler produce verbose output that lists
@@ -6250,20 +6860,20 @@ if test "$_lt_caught_CXX_error" != yes;
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $GREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
+	    output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $GREP "\-L"`; list= ; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
 	    ;;
           *)
-	    if test "$GXX" = yes; then
-	      if test $with_gnu_ld = no; then
+	    if test yes = "$GXX"; then
+	      if test no = "$with_gnu_ld"; then
 	        case $host_cpu in
 	          hppa*64*)
-	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib -fPIC ${wl}+h ${wl}$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib -fPIC $wl+h $wl$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	            ;;
 	          ia64*)
-	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $pic_flag ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $pic_flag $wl+h $wl$soname $wl+nodefaultrpath -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	            ;;
 	          *)
-	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	            _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $pic_flag $wl+h $wl$soname $wl+b $wl$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	            ;;
 	        esac
 	      fi
@@ -6278,22 +6888,22 @@ if test "$_lt_caught_CXX_error" != yes;
       interix[[3-9]]*)
 	_LT_TAGVAR(hardcode_direct, $1)=no
 	_LT_TAGVAR(hardcode_shlibpath_var, $1)=no
-	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
-	_LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
+	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath,$libdir'
+	_LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl-E'
 	# Hack: On Interix 3.x, we cannot compile PIC because of a broken gcc.
 	# Instead, shared libraries are loaded at an image base (0x10000000 by
 	# default) and relocated if they conflict, which is a slow very memory
 	# consuming and fragmenting process.  To avoid this, we pick a random,
 	# 256 KiB-aligned image base between 0x50000000 and 0x6FFC0000 at link
 	# time.  Moving up from 0x10000000 also allows more sbrk(2) space.
-	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
-	_LT_TAGVAR(archive_expsym_cmds, $1)='sed "s,^,_," $export_symbols >$output_objdir/$soname.expsym~$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--retain-symbols-file,$output_objdir/$soname.expsym ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
+	_LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-h,$soname $wl--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
+	_LT_TAGVAR(archive_expsym_cmds, $1)='sed "s|^|_|" $export_symbols >$output_objdir/$soname.expsym~$CC -shared $pic_flag $libobjs $deplibs $compiler_flags $wl-h,$soname $wl--retain-symbols-file,$output_objdir/$soname.expsym $wl--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
 	;;
       irix5* | irix6*)
         case $cc_basename in
           CC*)
 	    # SGI C++
-	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry $output_objdir/so_locations -o $lib'
 
 	    # Archives containing C++ object files must be created using
 	    # "CC -ar", where "CC" is the IRIX C++ compiler.  This is
@@ -6302,22 +6912,22 @@ if test "$_lt_caught_CXX_error" != yes;
 	    _LT_TAGVAR(old_archive_cmds, $1)='$CC -ar -WR,-u -o $oldlib $oldobjs'
 	    ;;
           *)
-	    if test "$GXX" = yes; then
-	      if test "$with_gnu_ld" = no; then
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	    if test yes = "$GXX"; then
+	      if test no = "$with_gnu_ld"; then
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-soname $wl$soname `test -n "$verstring" && func_echo_all "$wl-set_version $wl$verstring"` $wl-update_registry $wl$output_objdir/so_locations -o $lib'
 	      else
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-soname $wl$soname `test -n "$verstring" && func_echo_all "$wl-set_version $wl$verstring"` -o $lib'
 	      fi
 	    fi
 	    _LT_TAGVAR(link_all_deplibs, $1)=yes
 	    ;;
         esac
-        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
+        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath $wl$libdir'
         _LT_TAGVAR(hardcode_libdir_separator, $1)=:
         _LT_TAGVAR(inherit_rpath, $1)=yes
         ;;
 
-      linux* | k*bsd*-gnu | kopensolaris*-gnu)
+      linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
         case $cc_basename in
           KCC*)
 	    # Kuck and Associates, Inc. (KAI) C++ Compiler
@@ -6325,8 +6935,8 @@ if test "$_lt_caught_CXX_error" != yes;
 	    # KCC will only create a shared library if the output file
 	    # ends with ".so" (or ".sl" for HP-UX), so rename the library
 	    # to its proper name (with version) after linking.
-	    _LT_TAGVAR(archive_cmds, $1)='tempext=`echo $shared_ext | $SED -e '\''s/\([[^()0-9A-Za-z{}]]\)/\\\\\1/g'\''`; templib=`echo $lib | $SED -e "s/\${tempext}\..*/.so/"`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib; mv \$templib $lib'
-	    _LT_TAGVAR(archive_expsym_cmds, $1)='tempext=`echo $shared_ext | $SED -e '\''s/\([[^()0-9A-Za-z{}]]\)/\\\\\1/g'\''`; templib=`echo $lib | $SED -e "s/\${tempext}\..*/.so/"`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib ${wl}-retain-symbols-file,$export_symbols; mv \$templib $lib'
+	    _LT_TAGVAR(archive_cmds, $1)='tempext=`echo $shared_ext | $SED -e '\''s/\([[^()0-9A-Za-z{}]]\)/\\\\\1/g'\''`; templib=`echo $lib | $SED -e "s/\$tempext\..*/.so/"`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib; mv \$templib $lib'
+	    _LT_TAGVAR(archive_expsym_cmds, $1)='tempext=`echo $shared_ext | $SED -e '\''s/\([[^()0-9A-Za-z{}]]\)/\\\\\1/g'\''`; templib=`echo $lib | $SED -e "s/\$tempext\..*/.so/"`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib $wl-retain-symbols-file,$export_symbols; mv \$templib $lib'
 	    # Commands to make compiler produce verbose output that lists
 	    # what "hidden" libraries, object files and flags are used when
 	    # linking a shared library.
@@ -6335,10 +6945,10 @@ if test "$_lt_caught_CXX_error" != yes;
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`$CC $CFLAGS -v conftest.$objext -o libconftest$shared_ext 2>&1 | $GREP "ld"`; rm -f libconftest$shared_ext; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
+	    output_verbose_link_cmd='templist=`$CC $CFLAGS -v conftest.$objext -o libconftest$shared_ext 2>&1 | $GREP "ld"`; rm -f libconftest$shared_ext; list= ; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
 
-	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
-	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
+	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath,$libdir'
+	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl--export-dynamic'
 
 	    # Archives containing C++ object files must be created using
 	    # "CC -Bstatic", where "CC" is the KAI C++ compiler.
@@ -6352,59 +6962,59 @@ if test "$_lt_caught_CXX_error" != yes;
 	    # earlier do not add the objects themselves.
 	    case `$CC -V 2>&1` in
 	      *"Version 7."*)
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
-		_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-soname $wl$soname -o $lib'
+		_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-soname $wl$soname $wl-retain-symbols-file $wl$export_symbols -o $lib'
 		;;
 	      *)  # Version 8.0 or newer
 	        tmp_idyn=
 	        case $host_cpu in
 		  ia64*) tmp_idyn=' -i_dynamic';;
 		esac
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared'"$tmp_idyn"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-		_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared'"$tmp_idyn"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared'"$tmp_idyn"' $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
+		_LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared'"$tmp_idyn"' $libobjs $deplibs $compiler_flags $wl-soname $wl$soname $wl-retain-symbols-file $wl$export_symbols -o $lib'
 		;;
 	    esac
 	    _LT_TAGVAR(archive_cmds_need_lc, $1)=no
-	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
-	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
-	    _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
+	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath,$libdir'
+	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl--export-dynamic'
+	    _LT_TAGVAR(whole_archive_flag_spec, $1)='$wl--whole-archive$convenience $wl--no-whole-archive'
 	    ;;
           pgCC* | pgcpp*)
             # Portland Group C++ compiler
 	    case `$CC -V` in
 	    *pgCC\ [[1-5]].* | *pgcpp\ [[1-5]].*)
 	      _LT_TAGVAR(prelink_cmds, $1)='tpldir=Template.dir~
-		rm -rf $tpldir~
-		$CC --prelink_objects --instantiation_dir $tpldir $objs $libobjs $compile_deplibs~
-		compile_command="$compile_command `find $tpldir -name \*.o | sort | $NL2SP`"'
+               rm -rf $tpldir~
+               $CC --prelink_objects --instantiation_dir $tpldir $objs $libobjs $compile_deplibs~
+               compile_command="$compile_command `find $tpldir -name \*.o | sort | $NL2SP`"'
 	      _LT_TAGVAR(old_archive_cmds, $1)='tpldir=Template.dir~
-		rm -rf $tpldir~
-		$CC --prelink_objects --instantiation_dir $tpldir $oldobjs$old_deplibs~
-		$AR $AR_FLAGS $oldlib$oldobjs$old_deplibs `find $tpldir -name \*.o | sort | $NL2SP`~
-		$RANLIB $oldlib'
+                rm -rf $tpldir~
+                $CC --prelink_objects --instantiation_dir $tpldir $oldobjs$old_deplibs~
+                $AR $AR_FLAGS $oldlib$oldobjs$old_deplibs `find $tpldir -name \*.o | sort | $NL2SP`~
+                $RANLIB $oldlib'
 	      _LT_TAGVAR(archive_cmds, $1)='tpldir=Template.dir~
-		rm -rf $tpldir~
-		$CC --prelink_objects --instantiation_dir $tpldir $predep_objects $libobjs $deplibs $convenience $postdep_objects~
-		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | sort | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
+                rm -rf $tpldir~
+                $CC --prelink_objects --instantiation_dir $tpldir $predep_objects $libobjs $deplibs $convenience $postdep_objects~
+                $CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | sort | $NL2SP` $postdep_objects $compiler_flags $wl-soname $wl$soname -o $lib'
 	      _LT_TAGVAR(archive_expsym_cmds, $1)='tpldir=Template.dir~
-		rm -rf $tpldir~
-		$CC --prelink_objects --instantiation_dir $tpldir $predep_objects $libobjs $deplibs $convenience $postdep_objects~
-		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | sort | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
+                rm -rf $tpldir~
+                $CC --prelink_objects --instantiation_dir $tpldir $predep_objects $libobjs $deplibs $convenience $postdep_objects~
+                $CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | sort | $NL2SP` $postdep_objects $compiler_flags $wl-soname $wl$soname $wl-retain-symbols-file $wl$export_symbols -o $lib'
 	      ;;
 	    *) # Version 6 and above use weak symbols
-	      _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
-	      _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
+	      _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-soname $wl$soname -o $lib'
+	      _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-soname $wl$soname $wl-retain-symbols-file $wl$export_symbols -o $lib'
 	      ;;
 	    esac
 
-	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}--rpath ${wl}$libdir'
-	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
-	    _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl--rpath $wl$libdir'
+	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl--export-dynamic'
+	    _LT_TAGVAR(whole_archive_flag_spec, $1)='$wl--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` $wl--no-whole-archive'
             ;;
 	  cxx*)
 	    # Compaq C++
-	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	    _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname  -o $lib ${wl}-retain-symbols-file $wl$export_symbols'
+	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-soname $wl$soname -o $lib'
+	    _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-soname $wl$soname  -o $lib $wl-retain-symbols-file $wl$export_symbols'
 
 	    runpath_var=LD_RUN_PATH
 	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-rpath $libdir'
@@ -6418,18 +7028,18 @@ if test "$_lt_caught_CXX_error" != yes;
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld"`; templist=`func_echo_all "$templist" | $SED "s/\(^.*ld.*\)\( .*ld .*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "X$list" | $Xsed'
+	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld"`; templist=`func_echo_all "$templist" | $SED "s/\(^.*ld.*\)\( .*ld .*$\)/\1/"`; list= ; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "X$list" | $Xsed'
 	    ;;
 	  xl* | mpixl* | bgxl*)
 	    # IBM XL 8.0 on PPC, with GNU ld
-	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
-	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
-	    _LT_TAGVAR(archive_cmds, $1)='$CC -qmkshrobj $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	    if test "x$supports_anon_versioning" = xyes; then
+	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath $wl$libdir'
+	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl--export-dynamic'
+	    _LT_TAGVAR(archive_cmds, $1)='$CC -qmkshrobj $libobjs $deplibs $compiler_flags $wl-soname $wl$soname -o $lib'
+	    if test yes = "$supports_anon_versioning"; then
 	      _LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $output_objdir/$libname.ver~
-		cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
-		echo "local: *; };" >> $output_objdir/$libname.ver~
-		$CC -qmkshrobj $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
+                cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
+                echo "local: *; };" >> $output_objdir/$libname.ver~
+                $CC -qmkshrobj $libobjs $deplibs $compiler_flags $wl-soname $wl$soname $wl-version-script $wl$output_objdir/$libname.ver -o $lib'
 	    fi
 	    ;;
 	  *)
@@ -6437,10 +7047,10 @@ if test "$_lt_caught_CXX_error" != yes;
 	    *Sun\ C*)
 	      # Sun C++ 5.9
 	      _LT_TAGVAR(no_undefined_flag, $1)=' -zdefs'
-	      _LT_TAGVAR(archive_cmds, $1)='$CC -G${allow_undefined_flag} -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
-	      _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G${allow_undefined_flag} -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-retain-symbols-file ${wl}$export_symbols'
+	      _LT_TAGVAR(archive_cmds, $1)='$CC -G$allow_undefined_flag -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	      _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G$allow_undefined_flag -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-retain-symbols-file $wl$export_symbols'
 	      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
-	      _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	      _LT_TAGVAR(whole_archive_flag_spec, $1)='$wl--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` $wl--no-whole-archive'
 	      _LT_TAGVAR(compiler_needs_object, $1)=yes
 
 	      # Not sure whether something based on
@@ -6498,22 +7108,17 @@ if test "$_lt_caught_CXX_error" != yes;
         _LT_TAGVAR(ld_shlibs, $1)=yes
 	;;
 
-      openbsd2*)
-        # C++ shared libraries are fairly broken
-	_LT_TAGVAR(ld_shlibs, $1)=no
-	;;
-
-      openbsd*)
+      openbsd* | bitrig*)
 	if test -f /usr/libexec/ld.so; then
 	  _LT_TAGVAR(hardcode_direct, $1)=yes
 	  _LT_TAGVAR(hardcode_shlibpath_var, $1)=no
 	  _LT_TAGVAR(hardcode_direct_absolute, $1)=yes
 	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $lib'
-	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
-	  if test -z "`echo __ELF__ | $CC -E - | grep __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
-	    _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-retain-symbols-file,$export_symbols -o $lib'
-	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
-	    _LT_TAGVAR(whole_archive_flag_spec, $1)="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
+	  _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath,$libdir'
+	  if test -z "`echo __ELF__ | $CC -E - | grep __ELF__`"; then
+	    _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-retain-symbols-file,$export_symbols -o $lib'
+	    _LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl-E'
+	    _LT_TAGVAR(whole_archive_flag_spec, $1)=$wlarc'--whole-archive$convenience '$wlarc'--no-whole-archive'
 	  fi
 	  output_verbose_link_cmd=func_echo_all
 	else
@@ -6529,9 +7134,9 @@ if test "$_lt_caught_CXX_error" != yes;
 	    # KCC will only create a shared library if the output file
 	    # ends with ".so" (or ".sl" for HP-UX), so rename the library
 	    # to its proper name (with version) after linking.
-	    _LT_TAGVAR(archive_cmds, $1)='tempext=`echo $shared_ext | $SED -e '\''s/\([[^()0-9A-Za-z{}]]\)/\\\\\1/g'\''`; templib=`echo "$lib" | $SED -e "s/\${tempext}\..*/.so/"`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib; mv \$templib $lib'
+	    _LT_TAGVAR(archive_cmds, $1)='tempext=`echo $shared_ext | $SED -e '\''s/\([[^()0-9A-Za-z{}]]\)/\\\\\1/g'\''`; templib=`echo "$lib" | $SED -e "s/\$tempext\..*/.so/"`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib; mv \$templib $lib'
 
-	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
+	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath,$libdir'
 	    _LT_TAGVAR(hardcode_libdir_separator, $1)=:
 
 	    # Archives containing C++ object files must be created using
@@ -6549,17 +7154,17 @@ if test "$_lt_caught_CXX_error" != yes;
           cxx*)
 	    case $host in
 	      osf3*)
-	        _LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $soname `test -n "$verstring" && func_echo_all "${wl}-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
-	        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
+	        _LT_TAGVAR(allow_undefined_flag, $1)=' $wl-expect_unresolved $wl\*'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-soname $soname `test -n "$verstring" && func_echo_all "$wl-set_version $verstring"` -update_registry $output_objdir/so_locations -o $lib'
+	        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath $wl$libdir'
 		;;
 	      *)
 	        _LT_TAGVAR(allow_undefined_flag, $1)=' -expect_unresolved \*'
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry $output_objdir/so_locations -o $lib'
 	        _LT_TAGVAR(archive_expsym_cmds, $1)='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done~
-	          echo "-hidden">> $lib.exp~
-	          $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname ${wl}-input ${wl}$lib.exp  `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib~
-	          $RM $lib.exp'
+                  echo "-hidden">> $lib.exp~
+                  $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname $wl-input $wl$lib.exp  `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry $output_objdir/so_locations -o $lib~
+                  $RM $lib.exp'
 	        _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-rpath $libdir'
 		;;
 	    esac
@@ -6574,21 +7179,21 @@ if test "$_lt_caught_CXX_error" != yes;
 	    # explicitly linking system object files so we need to strip them
 	    # from the output so that they don't get included in the library
 	    # dependencies.
-	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld" | $GREP -v "ld:"`; templist=`func_echo_all "$templist" | $SED "s/\(^.*ld.*\)\( .*ld.*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
+	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld" | $GREP -v "ld:"`; templist=`func_echo_all "$templist" | $SED "s/\(^.*ld.*\)\( .*ld.*$\)/\1/"`; list= ; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
 	    ;;
 	  *)
-	    if test "$GXX" = yes && test "$with_gnu_ld" = no; then
-	      _LT_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
+	    if test yes,no = "$GXX,$with_gnu_ld"; then
+	      _LT_TAGVAR(allow_undefined_flag, $1)=' $wl-expect_unresolved $wl\*'
 	      case $host in
 	        osf3*)
-	          _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	          _LT_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-soname $wl$soname `test -n "$verstring" && func_echo_all "$wl-set_version $wl$verstring"` $wl-update_registry $wl$output_objdir/so_locations -o $lib'
 		  ;;
 	        *)
-	          _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	          _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib $allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-msym $wl-soname $wl$soname `test -n "$verstring" && func_echo_all "$wl-set_version $wl$verstring"` $wl-update_registry $wl$output_objdir/so_locations -o $lib'
 		  ;;
 	      esac
 
-	      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
+	      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-rpath $wl$libdir'
 	      _LT_TAGVAR(hardcode_libdir_separator, $1)=:
 
 	      # Commands to make compiler produce verbose output that lists
@@ -6634,9 +7239,9 @@ if test "$_lt_caught_CXX_error" != yes;
 	    # Sun C++ 4.2, 5.x and Centerline C++
             _LT_TAGVAR(archive_cmds_need_lc,$1)=yes
 	    _LT_TAGVAR(no_undefined_flag, $1)=' -zdefs'
-	    _LT_TAGVAR(archive_cmds, $1)='$CC -G${allow_undefined_flag}  -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	    _LT_TAGVAR(archive_cmds, $1)='$CC -G$allow_undefined_flag -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	    _LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-	      $CC -G${allow_undefined_flag} ${wl}-M ${wl}$lib.exp -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
+              $CC -G$allow_undefined_flag $wl-M $wl$lib.exp -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
 
 	    _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
 	    _LT_TAGVAR(hardcode_shlibpath_var, $1)=no
@@ -6644,7 +7249,7 @@ if test "$_lt_caught_CXX_error" != yes;
 	      solaris2.[[0-5]] | solaris2.[[0-5]].*) ;;
 	      *)
 		# The compiler driver will combine and reorder linker options,
-		# but understands `-z linker_flag'.
+		# but understands '-z linker_flag'.
 	        # Supported since Solaris 2.6 (maybe 2.5.1?)
 		_LT_TAGVAR(whole_archive_flag_spec, $1)='-z allextract$convenience -z defaultextract'
 	        ;;
@@ -6661,30 +7266,30 @@ if test "$_lt_caught_CXX_error" != yes;
 	    ;;
           gcx*)
 	    # Green Hills C++ Compiler
-	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
+	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-h $wl$soname -o $lib'
 
 	    # The C++ compiler must be used to create the archive.
 	    _LT_TAGVAR(old_archive_cmds, $1)='$CC $LDFLAGS -archive -o $oldlib $oldobjs'
 	    ;;
           *)
 	    # GNU C++ compiler with Solaris linker
-	    if test "$GXX" = yes && test "$with_gnu_ld" = no; then
-	      _LT_TAGVAR(no_undefined_flag, $1)=' ${wl}-z ${wl}defs'
+	    if test yes,no = "$GXX,$with_gnu_ld"; then
+	      _LT_TAGVAR(no_undefined_flag, $1)=' $wl-z ${wl}defs'
 	      if $CC --version | $GREP -v '^2\.7' > /dev/null; then
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-h $wl$soname -o $lib'
 	        _LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-		  $CC -shared $pic_flag -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
+                  $CC -shared $pic_flag -nostdlib $wl-M $wl$lib.exp $wl-h $wl$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
 
 	        # Commands to make compiler produce verbose output that lists
 	        # what "hidden" libraries, object files and flags are used when
 	        # linking a shared library.
 	        output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 	      else
-	        # g++ 2.7 appears to require `-G' NOT `-shared' on this
+	        # g++ 2.7 appears to require '-G' NOT '-shared' on this
 	        # platform.
-	        _LT_TAGVAR(archive_cmds, $1)='$CC -G -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
+	        _LT_TAGVAR(archive_cmds, $1)='$CC -G -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags $wl-h $wl$soname -o $lib'
 	        _LT_TAGVAR(archive_expsym_cmds, $1)='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
-		  $CC -G -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
+                  $CC -G -nostdlib $wl-M $wl$lib.exp $wl-h $wl$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
 
 	        # Commands to make compiler produce verbose output that lists
 	        # what "hidden" libraries, object files and flags are used when
@@ -6692,11 +7297,11 @@ if test "$_lt_caught_CXX_error" != yes;
 	        output_verbose_link_cmd='$CC -G $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 	      fi
 
-	      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-R $wl$libdir'
+	      _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-R $wl$libdir'
 	      case $host_os in
 		solaris2.[[0-5]] | solaris2.[[0-5]].*) ;;
 		*)
-		  _LT_TAGVAR(whole_archive_flag_spec, $1)='${wl}-z ${wl}allextract$convenience ${wl}-z ${wl}defaultextract'
+		  _LT_TAGVAR(whole_archive_flag_spec, $1)='$wl-z ${wl}allextract$convenience $wl-z ${wl}defaultextract'
 		  ;;
 	      esac
 	    fi
@@ -6705,52 +7310,52 @@ if test "$_lt_caught_CXX_error" != yes;
         ;;
 
     sysv4*uw2* | sysv5OpenUNIX* | sysv5UnixWare7.[[01]].[[10]]* | unixware7* | sco3.2v5.0.[[024]]*)
-      _LT_TAGVAR(no_undefined_flag, $1)='${wl}-z,text'
+      _LT_TAGVAR(no_undefined_flag, $1)='$wl-z,text'
       _LT_TAGVAR(archive_cmds_need_lc, $1)=no
       _LT_TAGVAR(hardcode_shlibpath_var, $1)=no
       runpath_var='LD_RUN_PATH'
 
       case $cc_basename in
         CC*)
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	  _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -G $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G $wl-Bexport:$export_symbols $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
 	*)
-	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	  _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  _LT_TAGVAR(archive_cmds, $1)='$CC -shared $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $wl-Bexport:$export_symbols $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
 	  ;;
       esac
       ;;
 
       sysv5* | sco3.2v5* | sco5v6*)
-	# Note: We can NOT use -z defs as we might desire, because we do not
+	# Note: We CANNOT use -z defs as we might desire, because we do not
 	# link with -lc, and that would cause any symbols used from libc to
 	# always be unresolved, which means just about no library would
 	# ever link correctly.  If we're not using GNU ld we use -z text
 	# though, which does catch some bad symbols but isn't as heavy-handed
 	# as -z defs.
-	_LT_TAGVAR(no_undefined_flag, $1)='${wl}-z,text'
-	_LT_TAGVAR(allow_undefined_flag, $1)='${wl}-z,nodefs'
+	_LT_TAGVAR(no_undefined_flag, $1)='$wl-z,text'
+	_LT_TAGVAR(allow_undefined_flag, $1)='$wl-z,nodefs'
 	_LT_TAGVAR(archive_cmds_need_lc, $1)=no
 	_LT_TAGVAR(hardcode_shlibpath_var, $1)=no
-	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-R,$libdir'
+	_LT_TAGVAR(hardcode_libdir_flag_spec, $1)='$wl-R,$libdir'
 	_LT_TAGVAR(hardcode_libdir_separator, $1)=':'
 	_LT_TAGVAR(link_all_deplibs, $1)=yes
-	_LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-Bexport'
+	_LT_TAGVAR(export_dynamic_flag_spec, $1)='$wl-Bexport'
 	runpath_var='LD_RUN_PATH'
 
 	case $cc_basename in
           CC*)
-	    _LT_TAGVAR(archive_cmds, $1)='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	    _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	    _LT_TAGVAR(archive_cmds, $1)='$CC -G $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	    _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -G $wl-Bexport:$export_symbols $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
 	    _LT_TAGVAR(old_archive_cmds, $1)='$CC -Tprelink_objects $oldobjs~
-	      '"$_LT_TAGVAR(old_archive_cmds, $1)"
+              '"$_LT_TAGVAR(old_archive_cmds, $1)"
 	    _LT_TAGVAR(reload_cmds, $1)='$CC -Tprelink_objects $reload_objs~
-	      '"$_LT_TAGVAR(reload_cmds, $1)"
+              '"$_LT_TAGVAR(reload_cmds, $1)"
 	    ;;
 	  *)
-	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
-	    _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	    _LT_TAGVAR(archive_cmds, $1)='$CC -shared $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	    _LT_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $wl-Bexport:$export_symbols $wl-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
 	    ;;
 	esac
       ;;
@@ -6781,10 +7386,10 @@ if test "$_lt_caught_CXX_error" != yes;
     esac
 
     AC_MSG_RESULT([$_LT_TAGVAR(ld_shlibs, $1)])
-    test "$_LT_TAGVAR(ld_shlibs, $1)" = no && can_build_shared=no
+    test no = "$_LT_TAGVAR(ld_shlibs, $1)" && can_build_shared=no
 
-    _LT_TAGVAR(GCC, $1)="$GXX"
-    _LT_TAGVAR(LD, $1)="$LD"
+    _LT_TAGVAR(GCC, $1)=$GXX
+    _LT_TAGVAR(LD, $1)=$LD
 
     ## CAVEAT EMPTOR:
     ## There is no encapsulation within the following macros, do not change
@@ -6811,7 +7416,7 @@ if test "$_lt_caught_CXX_error" != yes;
   lt_cv_path_LD=$lt_save_path_LD
   lt_cv_prog_gnu_ldcxx=$lt_cv_prog_gnu_ld
   lt_cv_prog_gnu_ld=$lt_save_with_gnu_ld
-fi # test "$_lt_caught_CXX_error" != yes
+fi # test yes != "$_lt_caught_CXX_error"
 
 AC_LANG_POP
 ])# _LT_LANG_CXX_CONFIG
@@ -6833,13 +7438,14 @@ AC_REQUIRE([_LT_DECL_SED])
 AC_REQUIRE([_LT_PROG_ECHO_BACKSLASH])
 func_stripname_cnf ()
 {
-  case ${2} in
-  .*) func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%\\\\${2}\$%%"`;;
-  *)  func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%${2}\$%%"`;;
+  case @S|@2 in
+  .*) func_stripname_result=`$ECHO "@S|@3" | $SED "s%^@S|@1%%; s%\\\\@S|@2\$%%"`;;
+  *)  func_stripname_result=`$ECHO "@S|@3" | $SED "s%^@S|@1%%; s%@S|@2\$%%"`;;
   esac
 } # func_stripname_cnf
 ])# _LT_FUNC_STRIPNAME_CNF
 
+
 # _LT_SYS_HIDDEN_LIBDEPS([TAGNAME])
 # ---------------------------------
 # Figure out "hidden" library dependencies from verbose
@@ -6898,12 +7504,18 @@ public class foo {
   }
 };
 _LT_EOF
+], [$1], [GO], [cat > conftest.$ac_ext <<_LT_EOF
+package foo
+func foo() {
+}
+_LT_EOF
 ])
 
 _lt_libdeps_save_CFLAGS=$CFLAGS
 case "$CC $CFLAGS " in #(
 *\ -flto*\ *) CFLAGS="$CFLAGS -fno-lto" ;;
 *\ -fwhopr*\ *) CFLAGS="$CFLAGS -fno-whopr" ;;
+*\ -fuse-linker-plugin*\ *) CFLAGS="$CFLAGS -fno-use-linker-plugin" ;;
 esac
 
 dnl Parse the compiler output and extract the necessary
@@ -6917,13 +7529,13 @@ if AC_TRY_EVAL(ac_compile); then
   pre_test_object_deps_done=no
 
   for p in `eval "$output_verbose_link_cmd"`; do
-    case ${prev}${p} in
+    case $prev$p in
 
     -L* | -R* | -l*)
        # Some compilers place space between "-{L,R}" and the path.
        # Remove the space.
-       if test $p = "-L" ||
-          test $p = "-R"; then
+       if test x-L = "$p" ||
+          test x-R = "$p"; then
 	 prev=$p
 	 continue
        fi
@@ -6939,16 +7551,16 @@ if AC_TRY_EVAL(ac_compile); then
        case $p in
        =*) func_stripname_cnf '=' '' "$p"; p=$lt_sysroot$func_stripname_result ;;
        esac
-       if test "$pre_test_object_deps_done" = no; then
-	 case ${prev} in
+       if test no = "$pre_test_object_deps_done"; then
+	 case $prev in
 	 -L | -R)
 	   # Internal compiler library paths should come after those
 	   # provided the user.  The postdeps already come after the
 	   # user supplied libs so there is no need to process them.
 	   if test -z "$_LT_TAGVAR(compiler_lib_search_path, $1)"; then
-	     _LT_TAGVAR(compiler_lib_search_path, $1)="${prev}${p}"
+	     _LT_TAGVAR(compiler_lib_search_path, $1)=$prev$p
 	   else
-	     _LT_TAGVAR(compiler_lib_search_path, $1)="${_LT_TAGVAR(compiler_lib_search_path, $1)} ${prev}${p}"
+	     _LT_TAGVAR(compiler_lib_search_path, $1)="${_LT_TAGVAR(compiler_lib_search_path, $1)} $prev$p"
 	   fi
 	   ;;
 	 # The "-l" case would never come before the object being
@@ -6956,9 +7568,9 @@ if AC_TRY_EVAL(ac_compile); then
 	 esac
        else
 	 if test -z "$_LT_TAGVAR(postdeps, $1)"; then
-	   _LT_TAGVAR(postdeps, $1)="${prev}${p}"
+	   _LT_TAGVAR(postdeps, $1)=$prev$p
 	 else
-	   _LT_TAGVAR(postdeps, $1)="${_LT_TAGVAR(postdeps, $1)} ${prev}${p}"
+	   _LT_TAGVAR(postdeps, $1)="${_LT_TAGVAR(postdeps, $1)} $prev$p"
 	 fi
        fi
        prev=
@@ -6973,15 +7585,15 @@ if AC_TRY_EVAL(ac_compile); then
 	 continue
        fi
 
-       if test "$pre_test_object_deps_done" = no; then
+       if test no = "$pre_test_object_deps_done"; then
 	 if test -z "$_LT_TAGVAR(predep_objects, $1)"; then
-	   _LT_TAGVAR(predep_objects, $1)="$p"
+	   _LT_TAGVAR(predep_objects, $1)=$p
 	 else
 	   _LT_TAGVAR(predep_objects, $1)="$_LT_TAGVAR(predep_objects, $1) $p"
 	 fi
        else
 	 if test -z "$_LT_TAGVAR(postdep_objects, $1)"; then
-	   _LT_TAGVAR(postdep_objects, $1)="$p"
+	   _LT_TAGVAR(postdep_objects, $1)=$p
 	 else
 	   _LT_TAGVAR(postdep_objects, $1)="$_LT_TAGVAR(postdep_objects, $1) $p"
 	 fi
@@ -7012,51 +7624,6 @@ interix[[3-9]]*)
   _LT_TAGVAR(postdep_objects,$1)=
   _LT_TAGVAR(postdeps,$1)=
   ;;
-
-linux*)
-  case `$CC -V 2>&1 | sed 5q` in
-  *Sun\ C*)
-    # Sun C++ 5.9
-
-    # The more standards-conforming stlport4 library is
-    # incompatible with the Cstd library. Avoid specifying
-    # it if it's in CXXFLAGS. Ignore libCrun as
-    # -library=stlport4 depends on it.
-    case " $CXX $CXXFLAGS " in
-    *" -library=stlport4 "*)
-      solaris_use_stlport4=yes
-      ;;
-    esac
-
-    if test "$solaris_use_stlport4" != yes; then
-      _LT_TAGVAR(postdeps,$1)='-library=Cstd -library=Crun'
-    fi
-    ;;
-  esac
-  ;;
-
-solaris*)
-  case $cc_basename in
-  CC* | sunCC*)
-    # The more standards-conforming stlport4 library is
-    # incompatible with the Cstd library. Avoid specifying
-    # it if it's in CXXFLAGS. Ignore libCrun as
-    # -library=stlport4 depends on it.
-    case " $CXX $CXXFLAGS " in
-    *" -library=stlport4 "*)
-      solaris_use_stlport4=yes
-      ;;
-    esac
-
-    # Adding this requires a known-good setup of shared libraries for
-    # Sun compiler versions before 5.6, else PIC objects from an old
-    # archive will be linked into the output, leading to subtle bugs.
-    if test "$solaris_use_stlport4" != yes; then
-      _LT_TAGVAR(postdeps,$1)='-library=Cstd -library=Crun'
-    fi
-    ;;
-  esac
-  ;;
 esac
 ])
 
@@ -7065,7 +7632,7 @@ case " $_LT_TAGVAR(postdeps, $1) " in
 esac
  _LT_TAGVAR(compiler_lib_search_dirs, $1)=
 if test -n "${_LT_TAGVAR(compiler_lib_search_path, $1)}"; then
- _LT_TAGVAR(compiler_lib_search_dirs, $1)=`echo " ${_LT_TAGVAR(compiler_lib_search_path, $1)}" | ${SED} -e 's! -L! !g' -e 's!^ !!'`
+ _LT_TAGVAR(compiler_lib_search_dirs, $1)=`echo " ${_LT_TAGVAR(compiler_lib_search_path, $1)}" | $SED -e 's! -L! !g' -e 's!^ !!'`
 fi
 _LT_TAGDECL([], [compiler_lib_search_dirs], [1],
     [The directories searched by this compiler when creating a shared library])
@@ -7085,10 +7652,10 @@ _LT_TAGDECL([], [compiler_lib_search_pat
 # --------------------------
 # Ensure that the configuration variables for a Fortran 77 compiler are
 # suitably defined.  These variables are subsequently used by _LT_CONFIG
-# to write the compiler configuration to `libtool'.
+# to write the compiler configuration to 'libtool'.
 m4_defun([_LT_LANG_F77_CONFIG],
 [AC_LANG_PUSH(Fortran 77)
-if test -z "$F77" || test "X$F77" = "Xno"; then
+if test -z "$F77" || test no = "$F77"; then
   _lt_disable_F77=yes
 fi
 
@@ -7100,7 +7667,6 @@ _LT_TAGVAR(export_dynamic_flag_spec, $1)
 _LT_TAGVAR(hardcode_direct, $1)=no
 _LT_TAGVAR(hardcode_direct_absolute, $1)=no
 _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-_LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
 _LT_TAGVAR(hardcode_libdir_separator, $1)=
 _LT_TAGVAR(hardcode_minus_L, $1)=no
 _LT_TAGVAR(hardcode_automatic, $1)=no
@@ -7126,7 +7692,7 @@ _LT_TAGVAR(objext, $1)=$objext
 # the F77 compiler isn't working.  Some variables (like enable_shared)
 # are currently assumed to apply to all compilers on this platform,
 # and will be corrupted by setting them based on a non-working compiler.
-if test "$_lt_disable_F77" != yes; then
+if test yes != "$_lt_disable_F77"; then
   # Code to be used in simple compile tests
   lt_simple_compile_test_code="\
       subroutine t
@@ -7148,7 +7714,7 @@ if test "$_lt_disable_F77" != yes; then
   _LT_LINKER_BOILERPLATE
 
   # Allow CC to be a program name with arguments.
-  lt_save_CC="$CC"
+  lt_save_CC=$CC
   lt_save_GCC=$GCC
   lt_save_CFLAGS=$CFLAGS
   CC=${F77-"f77"}
@@ -7162,21 +7728,25 @@ if test "$_lt_disable_F77" != yes; then
     AC_MSG_RESULT([$can_build_shared])
 
     AC_MSG_CHECKING([whether to build shared libraries])
-    test "$can_build_shared" = "no" && enable_shared=no
+    test no = "$can_build_shared" && enable_shared=no
 
     # On AIX, shared libraries and static libraries use the same namespace, and
     # are all built from PIC.
     case $host_os in
       aix3*)
-        test "$enable_shared" = yes && enable_static=no
+        test yes = "$enable_shared" && enable_static=no
         if test -n "$RANLIB"; then
           archive_cmds="$archive_cmds~\$RANLIB \$lib"
           postinstall_cmds='$RANLIB $lib'
         fi
         ;;
       aix[[4-9]]*)
-	if test "$host_cpu" != ia64 && test "$aix_use_runtimelinking" = no ; then
-	  test "$enable_shared" = yes && enable_static=no
+	if test ia64 != "$host_cpu"; then
+	  case $enable_shared,$with_aix_soname,$aix_use_runtimelinking in
+	  yes,aix,yes) ;;		# shared object as lib.so file only
+	  yes,svr4,*) ;;		# shared object as lib.so archive member only
+	  yes,*) enable_static=no ;;	# shared object in lib.a archive as well
+	  esac
 	fi
         ;;
     esac
@@ -7184,11 +7754,11 @@ if test "$_lt_disable_F77" != yes; then
 
     AC_MSG_CHECKING([whether to build static libraries])
     # Make sure either enable_shared or enable_static is yes.
-    test "$enable_shared" = yes || enable_static=yes
+    test yes = "$enable_shared" || enable_static=yes
     AC_MSG_RESULT([$enable_static])
 
-    _LT_TAGVAR(GCC, $1)="$G77"
-    _LT_TAGVAR(LD, $1)="$LD"
+    _LT_TAGVAR(GCC, $1)=$G77
+    _LT_TAGVAR(LD, $1)=$LD
 
     ## CAVEAT EMPTOR:
     ## There is no encapsulation within the following macros, do not change
@@ -7205,9 +7775,9 @@ if test "$_lt_disable_F77" != yes; then
   fi # test -n "$compiler"
 
   GCC=$lt_save_GCC
-  CC="$lt_save_CC"
-  CFLAGS="$lt_save_CFLAGS"
-fi # test "$_lt_disable_F77" != yes
+  CC=$lt_save_CC
+  CFLAGS=$lt_save_CFLAGS
+fi # test yes != "$_lt_disable_F77"
 
 AC_LANG_POP
 ])# _LT_LANG_F77_CONFIG
@@ -7217,11 +7787,11 @@ AC_LANG_POP
 # -------------------------
 # Ensure that the configuration variables for a Fortran compiler are
 # suitably defined.  These variables are subsequently used by _LT_CONFIG
-# to write the compiler configuration to `libtool'.
+# to write the compiler configuration to 'libtool'.
 m4_defun([_LT_LANG_FC_CONFIG],
 [AC_LANG_PUSH(Fortran)
 
-if test -z "$FC" || test "X$FC" = "Xno"; then
+if test -z "$FC" || test no = "$FC"; then
   _lt_disable_FC=yes
 fi
 
@@ -7233,7 +7803,6 @@ _LT_TAGVAR(export_dynamic_flag_spec, $1)
 _LT_TAGVAR(hardcode_direct, $1)=no
 _LT_TAGVAR(hardcode_direct_absolute, $1)=no
 _LT_TAGVAR(hardcode_libdir_flag_spec, $1)=
-_LT_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
 _LT_TAGVAR(hardcode_libdir_separator, $1)=
 _LT_TAGVAR(hardcode_minus_L, $1)=no
 _LT_TAGVAR(hardcode_automatic, $1)=no
@@ -7259,7 +7828,7 @@ _LT_TAGVAR(objext, $1)=$objext
 # the FC compiler isn't working.  Some variables (like enable_shared)
 # are currently assumed to apply to all compilers on this platform,
 # and will be corrupted by setting them based on a non-working compiler.
-if test "$_lt_disable_FC" != yes; then
+if test yes != "$_lt_disable_FC"; then
   # Code to be used in simple compile tests
   lt_simple_compile_test_code="\
       subroutine t
@@ -7281,7 +7850,7 @@ if test "$_lt_disable_FC" != yes; then
   _LT_LINKER_BOILERPLATE
 
   # Allow CC to be a program name with arguments.
-  lt_save_CC="$CC"
+  lt_save_CC=$CC
   lt_save_GCC=$GCC
   lt_save_CFLAGS=$CFLAGS
   CC=${FC-"f95"}
@@ -7297,21 +7866,25 @@ if test "$_lt_disable_FC" != yes; then
     AC_MSG_RESULT([$can_build_shared])
 
     AC_MSG_CHECKING([whether to build shared libraries])
-    test "$can_build_shared" = "no" && enable_shared=no
+    test no = "$can_build_shared" && enable_shared=no
 
     # On AIX, shared libraries and static libraries use the same namespace, and
     # are all built from PIC.
     case $host_os in
       aix3*)
-        test "$enable_shared" = yes && enable_static=no
+        test yes = "$enable_shared" && enable_static=no
         if test -n "$RANLIB"; then
           archive_cmds="$archive_cmds~\$RANLIB \$lib"
           postinstall_cmds='$RANLIB $lib'
         fi
         ;;
       aix[[4-9]]*)
-	if test "$host_cpu" != ia64 && test "$aix_use_runtimelinking" = no ; then
-	  test "$enable_shared" = yes && enable_static=no
+	if test ia64 != "$host_cpu"; then
+	  case $enable_shared,$with_aix_soname,$aix_use_runtimelinking in
+	  yes,aix,yes) ;;		# shared object as lib.so file only
+	  yes,svr4,*) ;;		# shared object as lib.so archive member only
+	  yes,*) enable_static=no ;;	# shared object in lib.a archive as well
+	  esac
 	fi
         ;;
     esac
@@ -7319,11 +7892,11 @@ if test "$_lt_disable_FC" != yes; then
 
     AC_MSG_CHECKING([whether to build static libraries])
     # Make sure either enable_shared or enable_static is yes.
-    test "$enable_shared" = yes || enable_static=yes
+    test yes = "$enable_shared" || enable_static=yes
     AC_MSG_RESULT([$enable_static])
 
-    _LT_TAGVAR(GCC, $1)="$ac_cv_fc_compiler_gnu"
-    _LT_TAGVAR(LD, $1)="$LD"
+    _LT_TAGVAR(GCC, $1)=$ac_cv_fc_compiler_gnu
+    _LT_TAGVAR(LD, $1)=$LD
 
     ## CAVEAT EMPTOR:
     ## There is no encapsulation within the following macros, do not change
@@ -7343,7 +7916,7 @@ if test "$_lt_disable_FC" != yes; then
   GCC=$lt_save_GCC
   CC=$lt_save_CC
   CFLAGS=$lt_save_CFLAGS
-fi # test "$_lt_disable_FC" != yes
+fi # test yes != "$_lt_disable_FC"
 
 AC_LANG_POP
 ])# _LT_LANG_FC_CONFIG
@@ -7353,7 +7926,7 @@ AC_LANG_POP
 # --------------------------
 # Ensure that the configuration variables for the GNU Java Compiler compiler
 # are suitably defined.  These variables are subsequently used by _LT_CONFIG
-# to write the compiler configuration to `libtool'.
+# to write the compiler configuration to 'libtool'.
 m4_defun([_LT_LANG_GCJ_CONFIG],
 [AC_REQUIRE([LT_PROG_GCJ])dnl
 AC_LANG_SAVE
@@ -7387,7 +7960,7 @@ CC=${GCJ-"gcj"}
 CFLAGS=$GCJFLAGS
 compiler=$CC
 _LT_TAGVAR(compiler, $1)=$CC
-_LT_TAGVAR(LD, $1)="$LD"
+_LT_TAGVAR(LD, $1)=$LD
 _LT_CC_BASENAME([$compiler])
 
 # GCJ did not exist at the time GCC didn't implicitly link libc in.
@@ -7420,11 +7993,82 @@ CFLAGS=$lt_save_CFLAGS
 ])# _LT_LANG_GCJ_CONFIG
 
 
+# _LT_LANG_GO_CONFIG([TAG])
+# --------------------------
+# Ensure that the configuration variables for the GNU Go compiler
+# are suitably defined.  These variables are subsequently used by _LT_CONFIG
+# to write the compiler configuration to 'libtool'.
+m4_defun([_LT_LANG_GO_CONFIG],
+[AC_REQUIRE([LT_PROG_GO])dnl
+AC_LANG_SAVE
+
+# Source file extension for Go test sources.
+ac_ext=go
+
+# Object file extension for compiled Go test sources.
+objext=o
+_LT_TAGVAR(objext, $1)=$objext
+
+# Code to be used in simple compile tests
+lt_simple_compile_test_code="package main; func main() { }"
+
+# Code to be used in simple link tests
+lt_simple_link_test_code='package main; func main() { }'
+
+# ltmain only uses $CC for tagged configurations so make sure $CC is set.
+_LT_TAG_COMPILER
+
+# save warnings/boilerplate of simple test code
+_LT_COMPILER_BOILERPLATE
+_LT_LINKER_BOILERPLATE
+
+# Allow CC to be a program name with arguments.
+lt_save_CC=$CC
+lt_save_CFLAGS=$CFLAGS
+lt_save_GCC=$GCC
+GCC=yes
+CC=${GOC-"gccgo"}
+CFLAGS=$GOFLAGS
+compiler=$CC
+_LT_TAGVAR(compiler, $1)=$CC
+_LT_TAGVAR(LD, $1)=$LD
+_LT_CC_BASENAME([$compiler])
+
+# Go did not exist at the time GCC didn't implicitly link libc in.
+_LT_TAGVAR(archive_cmds_need_lc, $1)=no
+
+_LT_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
+_LT_TAGVAR(reload_flag, $1)=$reload_flag
+_LT_TAGVAR(reload_cmds, $1)=$reload_cmds
+
+## CAVEAT EMPTOR:
+## There is no encapsulation within the following macros, do not change
+## the running order or otherwise move them around unless you know exactly
+## what you are doing...
+if test -n "$compiler"; then
+  _LT_COMPILER_NO_RTTI($1)
+  _LT_COMPILER_PIC($1)
+  _LT_COMPILER_C_O($1)
+  _LT_COMPILER_FILE_LOCKS($1)
+  _LT_LINKER_SHLIBS($1)
+  _LT_LINKER_HARDCODE_LIBPATH($1)
+
+  _LT_CONFIG($1)
+fi
+
+AC_LANG_RESTORE
+
+GCC=$lt_save_GCC
+CC=$lt_save_CC
+CFLAGS=$lt_save_CFLAGS
+])# _LT_LANG_GO_CONFIG
+
+
 # _LT_LANG_RC_CONFIG([TAG])
 # -------------------------
 # Ensure that the configuration variables for the Windows resource compiler
 # are suitably defined.  These variables are subsequently used by _LT_CONFIG
-# to write the compiler configuration to `libtool'.
+# to write the compiler configuration to 'libtool'.
 m4_defun([_LT_LANG_RC_CONFIG],
 [AC_REQUIRE([LT_PROG_RC])dnl
 AC_LANG_SAVE
@@ -7440,7 +8084,7 @@ _LT_TAGVAR(objext, $1)=$objext
 lt_simple_compile_test_code='sample MENU { MENUITEM "&Soup", 100, CHECKED }'
 
 # Code to be used in simple link tests
-lt_simple_link_test_code="$lt_simple_compile_test_code"
+lt_simple_link_test_code=$lt_simple_compile_test_code
 
 # ltmain only uses $CC for tagged configurations so make sure $CC is set.
 _LT_TAG_COMPILER
@@ -7450,7 +8094,7 @@ _LT_COMPILER_BOILERPLATE
 _LT_LINKER_BOILERPLATE
 
 # Allow CC to be a program name with arguments.
-lt_save_CC="$CC"
+lt_save_CC=$CC
 lt_save_CFLAGS=$CFLAGS
 lt_save_GCC=$GCC
 GCC=
@@ -7479,7 +8123,7 @@ AC_DEFUN([LT_PROG_GCJ],
 [m4_ifdef([AC_PROG_GCJ], [AC_PROG_GCJ],
   [m4_ifdef([A][M_PROG_GCJ], [A][M_PROG_GCJ],
     [AC_CHECK_TOOL(GCJ, gcj,)
-      test "x${GCJFLAGS+set}" = xset || GCJFLAGS="-g -O2"
+      test set = "${GCJFLAGS+set}" || GCJFLAGS="-g -O2"
       AC_SUBST(GCJFLAGS)])])[]dnl
 ])
 
@@ -7489,6 +8133,13 @@ dnl aclocal-1.4 backwards compatibility:
 dnl AC_DEFUN([LT_AC_PROG_GCJ], [])
 
 
+# LT_PROG_GO
+# ----------
+AC_DEFUN([LT_PROG_GO],
+[AC_CHECK_TOOL(GOC, gccgo,)
+])
+
+
 # LT_PROG_RC
 # ----------
 AC_DEFUN([LT_PROG_RC],
@@ -7583,7 +8234,7 @@ lt_ac_count=0
 # Add /usr/xpg4/bin/sed as it is typically found on Solaris
 # along with /bin/sed that truncates output.
 for lt_ac_sed in $lt_ac_sed_list /usr/xpg4/bin/sed; do
-  test ! -f $lt_ac_sed && continue
+  test ! -f "$lt_ac_sed" && continue
   cat /dev/null > conftest.in
   lt_ac_count=0
   echo $ECHO_N "0123456789$ECHO_C" >conftest.in
@@ -7600,9 +8251,9 @@ for lt_ac_sed in $lt_ac_sed_list /usr/xp
     $lt_ac_sed -e 's/a$//' < conftest.nl >conftest.out || break
     cmp -s conftest.out conftest.nl || break
     # 10000 chars as input seems more than enough
-    test $lt_ac_count -gt 10 && break
+    test 10 -lt "$lt_ac_count" && break
     lt_ac_count=`expr $lt_ac_count + 1`
-    if test $lt_ac_count -gt $lt_ac_max; then
+    if test "$lt_ac_count" -gt "$lt_ac_max"; then
       lt_ac_max=$lt_ac_count
       lt_cv_path_SED=$lt_ac_sed
     fi
@@ -7626,27 +8277,7 @@ dnl AC_DEFUN([LT_AC_PROG_SED], [])
 # Find out whether the shell is Bourne or XSI compatible,
 # or has some other useful features.
 m4_defun([_LT_CHECK_SHELL_FEATURES],
-[AC_MSG_CHECKING([whether the shell understands some XSI constructs])
-# Try some XSI features
-xsi_shell=no
-( _lt_dummy="a/b/c"
-  test "${_lt_dummy##*/},${_lt_dummy%/*},${_lt_dummy#??}"${_lt_dummy%"$_lt_dummy"}, \
-      = c,a/b,b/c, \
-    && eval 'test $(( 1 + 1 )) -eq 2 \
-    && test "${#_lt_dummy}" -eq 5' ) >/dev/null 2>&1 \
-  && xsi_shell=yes
-AC_MSG_RESULT([$xsi_shell])
-_LT_CONFIG_LIBTOOL_INIT([xsi_shell='$xsi_shell'])
-
-AC_MSG_CHECKING([whether the shell understands "+="])
-lt_shell_append=no
-( foo=bar; set foo baz; eval "$[1]+=\$[2]" && test "$foo" = barbaz ) \
-    >/dev/null 2>&1 \
-  && lt_shell_append=yes
-AC_MSG_RESULT([$lt_shell_append])
-_LT_CONFIG_LIBTOOL_INIT([lt_shell_append='$lt_shell_append'])
-
-if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
+[if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
   lt_unset=unset
 else
   lt_unset=false
@@ -7670,102 +8301,9 @@ _LT_DECL([NL2SP], [lt_NL2SP], [1], [turn
 ])# _LT_CHECK_SHELL_FEATURES
 
 
-# _LT_PROG_FUNCTION_REPLACE (FUNCNAME, REPLACEMENT-BODY)
-# ------------------------------------------------------
-# In `$cfgfile', look for function FUNCNAME delimited by `^FUNCNAME ()$' and
-# '^} FUNCNAME ', and replace its body with REPLACEMENT-BODY.
-m4_defun([_LT_PROG_FUNCTION_REPLACE],
-[dnl {
-sed -e '/^$1 ()$/,/^} # $1 /c\
-$1 ()\
-{\
-m4_bpatsubsts([$2], [$], [\\], [^\([	 ]\)], [\\\1])
-} # Extended-shell $1 implementation' "$cfgfile" > $cfgfile.tmp \
-  && mv -f "$cfgfile.tmp" "$cfgfile" \
-    || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-test 0 -eq $? || _lt_function_replace_fail=:
-])
-
-
-# _LT_PROG_REPLACE_SHELLFNS
-# -------------------------
-# Replace existing portable implementations of several shell functions with
-# equivalent extended shell implementations where those features are available..
-m4_defun([_LT_PROG_REPLACE_SHELLFNS],
-[if test x"$xsi_shell" = xyes; then
-  _LT_PROG_FUNCTION_REPLACE([func_dirname], [dnl
-    case ${1} in
-      */*) func_dirname_result="${1%/*}${2}" ;;
-      *  ) func_dirname_result="${3}" ;;
-    esac])
-
-  _LT_PROG_FUNCTION_REPLACE([func_basename], [dnl
-    func_basename_result="${1##*/}"])
-
-  _LT_PROG_FUNCTION_REPLACE([func_dirname_and_basename], [dnl
-    case ${1} in
-      */*) func_dirname_result="${1%/*}${2}" ;;
-      *  ) func_dirname_result="${3}" ;;
-    esac
-    func_basename_result="${1##*/}"])
-
-  _LT_PROG_FUNCTION_REPLACE([func_stripname], [dnl
-    # pdksh 5.2.14 does not do ${X%$Y} correctly if both X and Y are
-    # positional parameters, so assign one to ordinary parameter first.
-    func_stripname_result=${3}
-    func_stripname_result=${func_stripname_result#"${1}"}
-    func_stripname_result=${func_stripname_result%"${2}"}])
-
-  _LT_PROG_FUNCTION_REPLACE([func_split_long_opt], [dnl
-    func_split_long_opt_name=${1%%=*}
-    func_split_long_opt_arg=${1#*=}])
-
-  _LT_PROG_FUNCTION_REPLACE([func_split_short_opt], [dnl
-    func_split_short_opt_arg=${1#??}
-    func_split_short_opt_name=${1%"$func_split_short_opt_arg"}])
-
-  _LT_PROG_FUNCTION_REPLACE([func_lo2o], [dnl
-    case ${1} in
-      *.lo) func_lo2o_result=${1%.lo}.${objext} ;;
-      *)    func_lo2o_result=${1} ;;
-    esac])
-
-  _LT_PROG_FUNCTION_REPLACE([func_xform], [    func_xform_result=${1%.*}.lo])
-
-  _LT_PROG_FUNCTION_REPLACE([func_arith], [    func_arith_result=$(( $[*] ))])
-
-  _LT_PROG_FUNCTION_REPLACE([func_len], [    func_len_result=${#1}])
-fi
-
-if test x"$lt_shell_append" = xyes; then
-  _LT_PROG_FUNCTION_REPLACE([func_append], [    eval "${1}+=\\${2}"])
-
-  _LT_PROG_FUNCTION_REPLACE([func_append_quoted], [dnl
-    func_quote_for_eval "${2}"
-dnl m4 expansion turns \\\\ into \\, and then the shell eval turns that into \
-    eval "${1}+=\\\\ \\$func_quote_for_eval_result"])
-
-  # Save a `func_append' function call where possible by direct use of '+='
-  sed -e 's%func_append \([[a-zA-Z_]]\{1,\}\) "%\1+="%g' $cfgfile > $cfgfile.tmp \
-    && mv -f "$cfgfile.tmp" "$cfgfile" \
-      || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-  test 0 -eq $? || _lt_function_replace_fail=:
-else
-  # Save a `func_append' function call even when '+=' is not available
-  sed -e 's%func_append \([[a-zA-Z_]]\{1,\}\) "%\1="$\1%g' $cfgfile > $cfgfile.tmp \
-    && mv -f "$cfgfile.tmp" "$cfgfile" \
-      || (rm -f "$cfgfile" && cp "$cfgfile.tmp" "$cfgfile" && rm -f "$cfgfile.tmp")
-  test 0 -eq $? || _lt_function_replace_fail=:
-fi
-
-if test x"$_lt_function_replace_fail" = x":"; then
-  AC_MSG_WARN([Unable to substitute extended shell functions in $ofile])
-fi
-])
-
 # _LT_PATH_CONVERSION_FUNCTIONS
 # -----------------------------
-# Determine which file name conversion functions should be used by
+# Determine what file name conversion functions should be used by
 # func_to_host_file (and, implicitly, by func_to_host_path).  These are needed
 # for certain cross-compile configurations and native mingw.
 m4_defun([_LT_PATH_CONVERSION_FUNCTIONS],
diff -urpN net-snmp-5.8/m4/ltoptions.m4 net-snmp-5.9.1/m4/ltoptions.m4
--- net-snmp-5.8/m4/ltoptions.m4	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/m4/ltoptions.m4	2021-05-26 05:19:35.000000000 +0700
@@ -1,14 +1,14 @@
 # Helper functions for option handling.                    -*- Autoconf -*-
 #
-#   Copyright (C) 2004, 2005, 2007, 2008, 2009 Free Software Foundation,
-#   Inc.
+#   Copyright (C) 2004-2005, 2007-2009, 2011-2015 Free Software
+#   Foundation, Inc.
 #   Written by Gary V. Vaughan, 2004
 #
 # This file is free software; the Free Software Foundation gives
 # unlimited permission to copy and/or distribute it, with or without
 # modifications, as long as this notice is preserved.
 
-# serial 7 ltoptions.m4
+# serial 8 ltoptions.m4
 
 # This is to help aclocal find these macros, as it can't see m4_define.
 AC_DEFUN([LTOPTIONS_VERSION], [m4_if([1])])
@@ -29,7 +29,7 @@ m4_define([_LT_SET_OPTION],
 [m4_define(_LT_MANGLE_OPTION([$1], [$2]))dnl
 m4_ifdef(_LT_MANGLE_DEFUN([$1], [$2]),
         _LT_MANGLE_DEFUN([$1], [$2]),
-    [m4_warning([Unknown $1 option `$2'])])[]dnl
+    [m4_warning([Unknown $1 option '$2'])])[]dnl
 ])
 
 
@@ -75,13 +75,15 @@ m4_if([$1],[LT_INIT],[
   dnl
   dnl If no reference was made to various pairs of opposing options, then
   dnl we run the default mode handler for the pair.  For example, if neither
-  dnl `shared' nor `disable-shared' was passed, we enable building of shared
+  dnl 'shared' nor 'disable-shared' was passed, we enable building of shared
   dnl archives by default:
   _LT_UNLESS_OPTIONS([LT_INIT], [shared disable-shared], [_LT_ENABLE_SHARED])
   _LT_UNLESS_OPTIONS([LT_INIT], [static disable-static], [_LT_ENABLE_STATIC])
   _LT_UNLESS_OPTIONS([LT_INIT], [pic-only no-pic], [_LT_WITH_PIC])
   _LT_UNLESS_OPTIONS([LT_INIT], [fast-install disable-fast-install],
-  		   [_LT_ENABLE_FAST_INSTALL])
+		   [_LT_ENABLE_FAST_INSTALL])
+  _LT_UNLESS_OPTIONS([LT_INIT], [aix-soname=aix aix-soname=both aix-soname=svr4],
+		   [_LT_WITH_AIX_SONAME([aix])])
   ])
 ])# _LT_SET_OPTIONS
 
@@ -112,7 +114,7 @@ AU_DEFUN([AC_LIBTOOL_DLOPEN],
 [_LT_SET_OPTION([LT_INIT], [dlopen])
 AC_DIAGNOSE([obsolete],
 [$0: Remove this warning and the call to _LT_SET_OPTION when you
-put the `dlopen' option into LT_INIT's first parameter.])
+put the 'dlopen' option into LT_INIT's first parameter.])
 ])
 
 dnl aclocal-1.4 backwards compatibility:
@@ -148,7 +150,7 @@ AU_DEFUN([AC_LIBTOOL_WIN32_DLL],
 _LT_SET_OPTION([LT_INIT], [win32-dll])
 AC_DIAGNOSE([obsolete],
 [$0: Remove this warning and the call to _LT_SET_OPTION when you
-put the `win32-dll' option into LT_INIT's first parameter.])
+put the 'win32-dll' option into LT_INIT's first parameter.])
 ])
 
 dnl aclocal-1.4 backwards compatibility:
@@ -157,9 +159,9 @@ dnl AC_DEFUN([AC_LIBTOOL_WIN32_DLL], [])
 
 # _LT_ENABLE_SHARED([DEFAULT])
 # ----------------------------
-# implement the --enable-shared flag, and supports the `shared' and
-# `disable-shared' LT_INIT options.
-# DEFAULT is either `yes' or `no'.  If omitted, it defaults to `yes'.
+# implement the --enable-shared flag, and supports the 'shared' and
+# 'disable-shared' LT_INIT options.
+# DEFAULT is either 'yes' or 'no'.  If omitted, it defaults to 'yes'.
 m4_define([_LT_ENABLE_SHARED],
 [m4_define([_LT_ENABLE_SHARED_DEFAULT], [m4_if($1, no, no, yes)])dnl
 AC_ARG_ENABLE([shared],
@@ -172,14 +174,14 @@ AC_ARG_ENABLE([shared],
     *)
       enable_shared=no
       # Look at the argument we got.  We use all the common list separators.
-      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      lt_save_ifs=$IFS; IFS=$IFS$PATH_SEPARATOR,
       for pkg in $enableval; do
-	IFS="$lt_save_ifs"
+	IFS=$lt_save_ifs
 	if test "X$pkg" = "X$p"; then
 	  enable_shared=yes
 	fi
       done
-      IFS="$lt_save_ifs"
+      IFS=$lt_save_ifs
       ;;
     esac],
     [enable_shared=]_LT_ENABLE_SHARED_DEFAULT)
@@ -211,9 +213,9 @@ dnl AC_DEFUN([AM_DISABLE_SHARED], [])
 
 # _LT_ENABLE_STATIC([DEFAULT])
 # ----------------------------
-# implement the --enable-static flag, and support the `static' and
-# `disable-static' LT_INIT options.
-# DEFAULT is either `yes' or `no'.  If omitted, it defaults to `yes'.
+# implement the --enable-static flag, and support the 'static' and
+# 'disable-static' LT_INIT options.
+# DEFAULT is either 'yes' or 'no'.  If omitted, it defaults to 'yes'.
 m4_define([_LT_ENABLE_STATIC],
 [m4_define([_LT_ENABLE_STATIC_DEFAULT], [m4_if($1, no, no, yes)])dnl
 AC_ARG_ENABLE([static],
@@ -226,14 +228,14 @@ AC_ARG_ENABLE([static],
     *)
      enable_static=no
       # Look at the argument we got.  We use all the common list separators.
-      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      lt_save_ifs=$IFS; IFS=$IFS$PATH_SEPARATOR,
       for pkg in $enableval; do
-	IFS="$lt_save_ifs"
+	IFS=$lt_save_ifs
 	if test "X$pkg" = "X$p"; then
 	  enable_static=yes
 	fi
       done
-      IFS="$lt_save_ifs"
+      IFS=$lt_save_ifs
       ;;
     esac],
     [enable_static=]_LT_ENABLE_STATIC_DEFAULT)
@@ -265,9 +267,9 @@ dnl AC_DEFUN([AM_DISABLE_STATIC], [])
 
 # _LT_ENABLE_FAST_INSTALL([DEFAULT])
 # ----------------------------------
-# implement the --enable-fast-install flag, and support the `fast-install'
-# and `disable-fast-install' LT_INIT options.
-# DEFAULT is either `yes' or `no'.  If omitted, it defaults to `yes'.
+# implement the --enable-fast-install flag, and support the 'fast-install'
+# and 'disable-fast-install' LT_INIT options.
+# DEFAULT is either 'yes' or 'no'.  If omitted, it defaults to 'yes'.
 m4_define([_LT_ENABLE_FAST_INSTALL],
 [m4_define([_LT_ENABLE_FAST_INSTALL_DEFAULT], [m4_if($1, no, no, yes)])dnl
 AC_ARG_ENABLE([fast-install],
@@ -280,14 +282,14 @@ AC_ARG_ENABLE([fast-install],
     *)
       enable_fast_install=no
       # Look at the argument we got.  We use all the common list separators.
-      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      lt_save_ifs=$IFS; IFS=$IFS$PATH_SEPARATOR,
       for pkg in $enableval; do
-	IFS="$lt_save_ifs"
+	IFS=$lt_save_ifs
 	if test "X$pkg" = "X$p"; then
 	  enable_fast_install=yes
 	fi
       done
-      IFS="$lt_save_ifs"
+      IFS=$lt_save_ifs
       ;;
     esac],
     [enable_fast_install=]_LT_ENABLE_FAST_INSTALL_DEFAULT)
@@ -304,14 +306,14 @@ AU_DEFUN([AC_ENABLE_FAST_INSTALL],
 [_LT_SET_OPTION([LT_INIT], m4_if([$1], [no], [disable-])[fast-install])
 AC_DIAGNOSE([obsolete],
 [$0: Remove this warning and the call to _LT_SET_OPTION when you put
-the `fast-install' option into LT_INIT's first parameter.])
+the 'fast-install' option into LT_INIT's first parameter.])
 ])
 
 AU_DEFUN([AC_DISABLE_FAST_INSTALL],
 [_LT_SET_OPTION([LT_INIT], [disable-fast-install])
 AC_DIAGNOSE([obsolete],
 [$0: Remove this warning and the call to _LT_SET_OPTION when you put
-the `disable-fast-install' option into LT_INIT's first parameter.])
+the 'disable-fast-install' option into LT_INIT's first parameter.])
 ])
 
 dnl aclocal-1.4 backwards compatibility:
@@ -319,19 +321,85 @@ dnl AC_DEFUN([AC_ENABLE_FAST_INSTALL], [
 dnl AC_DEFUN([AM_DISABLE_FAST_INSTALL], [])
 
 
+# _LT_WITH_AIX_SONAME([DEFAULT])
+# ----------------------------------
+# implement the --with-aix-soname flag, and support the `aix-soname=aix'
+# and `aix-soname=both' and `aix-soname=svr4' LT_INIT options. DEFAULT
+# is either `aix', `both' or `svr4'.  If omitted, it defaults to `aix'.
+m4_define([_LT_WITH_AIX_SONAME],
+[m4_define([_LT_WITH_AIX_SONAME_DEFAULT], [m4_if($1, svr4, svr4, m4_if($1, both, both, aix))])dnl
+shared_archive_member_spec=
+case $host,$enable_shared in
+power*-*-aix[[5-9]]*,yes)
+  AC_MSG_CHECKING([which variant of shared library versioning to provide])
+  AC_ARG_WITH([aix-soname],
+    [AS_HELP_STRING([--with-aix-soname=aix|svr4|both],
+      [shared library versioning (aka "SONAME") variant to provide on AIX, @<:@default=]_LT_WITH_AIX_SONAME_DEFAULT[@:>@.])],
+    [case $withval in
+    aix|svr4|both)
+      ;;
+    *)
+      AC_MSG_ERROR([Unknown argument to --with-aix-soname])
+      ;;
+    esac
+    lt_cv_with_aix_soname=$with_aix_soname],
+    [AC_CACHE_VAL([lt_cv_with_aix_soname],
+      [lt_cv_with_aix_soname=]_LT_WITH_AIX_SONAME_DEFAULT)
+    with_aix_soname=$lt_cv_with_aix_soname])
+  AC_MSG_RESULT([$with_aix_soname])
+  if test aix != "$with_aix_soname"; then
+    # For the AIX way of multilib, we name the shared archive member
+    # based on the bitwidth used, traditionally 'shr.o' or 'shr_64.o',
+    # and 'shr.imp' or 'shr_64.imp', respectively, for the Import File.
+    # Even when GNU compilers ignore OBJECT_MODE but need '-maix64' flag,
+    # the AIX toolchain works better with OBJECT_MODE set (default 32).
+    if test 64 = "${OBJECT_MODE-32}"; then
+      shared_archive_member_spec=shr_64
+    else
+      shared_archive_member_spec=shr
+    fi
+  fi
+  ;;
+*)
+  with_aix_soname=aix
+  ;;
+esac
+
+_LT_DECL([], [shared_archive_member_spec], [0],
+    [Shared archive member basename, for filename based shared library versioning on AIX])dnl
+])# _LT_WITH_AIX_SONAME
+
+LT_OPTION_DEFINE([LT_INIT], [aix-soname=aix], [_LT_WITH_AIX_SONAME([aix])])
+LT_OPTION_DEFINE([LT_INIT], [aix-soname=both], [_LT_WITH_AIX_SONAME([both])])
+LT_OPTION_DEFINE([LT_INIT], [aix-soname=svr4], [_LT_WITH_AIX_SONAME([svr4])])
+
+
 # _LT_WITH_PIC([MODE])
 # --------------------
-# implement the --with-pic flag, and support the `pic-only' and `no-pic'
+# implement the --with-pic flag, and support the 'pic-only' and 'no-pic'
 # LT_INIT options.
-# MODE is either `yes' or `no'.  If omitted, it defaults to `both'.
+# MODE is either 'yes' or 'no'.  If omitted, it defaults to 'both'.
 m4_define([_LT_WITH_PIC],
 [AC_ARG_WITH([pic],
-    [AS_HELP_STRING([--with-pic],
+    [AS_HELP_STRING([--with-pic@<:@=PKGS@:>@],
 	[try to use only PIC/non-PIC objects @<:@default=use both@:>@])],
-    [pic_mode="$withval"],
-    [pic_mode=default])
-
-test -z "$pic_mode" && pic_mode=m4_default([$1], [default])
+    [lt_p=${PACKAGE-default}
+    case $withval in
+    yes|no) pic_mode=$withval ;;
+    *)
+      pic_mode=default
+      # Look at the argument we got.  We use all the common list separators.
+      lt_save_ifs=$IFS; IFS=$IFS$PATH_SEPARATOR,
+      for lt_pkg in $withval; do
+	IFS=$lt_save_ifs
+	if test "X$lt_pkg" = "X$lt_p"; then
+	  pic_mode=yes
+	fi
+      done
+      IFS=$lt_save_ifs
+      ;;
+    esac],
+    [pic_mode=m4_default([$1], [default])])
 
 _LT_DECL([], [pic_mode], [0], [What type of objects to build])dnl
 ])# _LT_WITH_PIC
@@ -344,7 +412,7 @@ AU_DEFUN([AC_LIBTOOL_PICMODE],
 [_LT_SET_OPTION([LT_INIT], [pic-only])
 AC_DIAGNOSE([obsolete],
 [$0: Remove this warning and the call to _LT_SET_OPTION when you
-put the `pic-only' option into LT_INIT's first parameter.])
+put the 'pic-only' option into LT_INIT's first parameter.])
 ])
 
 dnl aclocal-1.4 backwards compatibility:
diff -urpN net-snmp-5.8/m4/ltsugar.m4 net-snmp-5.9.1/m4/ltsugar.m4
--- net-snmp-5.8/m4/ltsugar.m4	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/m4/ltsugar.m4	2021-05-26 05:19:35.000000000 +0700
@@ -1,6 +1,7 @@
 # ltsugar.m4 -- libtool m4 base layer.                         -*-Autoconf-*-
 #
-# Copyright (C) 2004, 2005, 2007, 2008 Free Software Foundation, Inc.
+# Copyright (C) 2004-2005, 2007-2008, 2011-2015 Free Software
+# Foundation, Inc.
 # Written by Gary V. Vaughan, 2004
 #
 # This file is free software; the Free Software Foundation gives
@@ -33,7 +34,7 @@ m4_define([_lt_join],
 # ------------
 # Manipulate m4 lists.
 # These macros are necessary as long as will still need to support
-# Autoconf-2.59 which quotes differently.
+# Autoconf-2.59, which quotes differently.
 m4_define([lt_car], [[$1]])
 m4_define([lt_cdr],
 [m4_if([$#], 0, [m4_fatal([$0: cannot be called without arguments])],
@@ -44,7 +45,7 @@ m4_define([lt_unquote], $1)
 
 # lt_append(MACRO-NAME, STRING, [SEPARATOR])
 # ------------------------------------------
-# Redefine MACRO-NAME to hold its former content plus `SEPARATOR'`STRING'.
+# Redefine MACRO-NAME to hold its former content plus 'SEPARATOR''STRING'.
 # Note that neither SEPARATOR nor STRING are expanded; they are appended
 # to MACRO-NAME as is (leaving the expansion for when MACRO-NAME is invoked).
 # No SEPARATOR is output if MACRO-NAME was previously undefined (different
diff -urpN net-snmp-5.8/m4/ltversion.m4 net-snmp-5.9.1/m4/ltversion.m4
--- net-snmp-5.8/m4/ltversion.m4	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/m4/ltversion.m4	2021-05-26 05:19:35.000000000 +0700
@@ -1,6 +1,6 @@
 # ltversion.m4 -- version numbers			-*- Autoconf -*-
 #
-#   Copyright (C) 2004 Free Software Foundation, Inc.
+#   Copyright (C) 2004, 2011-2015 Free Software Foundation, Inc.
 #   Written by Scott James Remnant, 2004
 #
 # This file is free software; the Free Software Foundation gives
@@ -9,15 +9,15 @@
 
 # @configure_input@
 
-# serial 3293 ltversion.m4
+# serial 4179 ltversion.m4
 # This file is part of GNU Libtool
 
-m4_define([LT_PACKAGE_VERSION], [2.4])
-m4_define([LT_PACKAGE_REVISION], [1.3293])
+m4_define([LT_PACKAGE_VERSION], [2.4.6])
+m4_define([LT_PACKAGE_REVISION], [2.4.6])
 
 AC_DEFUN([LTVERSION_VERSION],
-[macro_version='2.4'
-macro_revision='1.3293'
+[macro_version='2.4.6'
+macro_revision='2.4.6'
 _LT_DECL(, macro_version, 0, [Which release of libtool.m4 was used?])
 _LT_DECL(, macro_revision, 0)
 ])
diff -urpN net-snmp-5.8/m4/lt~obsolete.m4 net-snmp-5.9.1/m4/lt~obsolete.m4
--- net-snmp-5.8/m4/lt~obsolete.m4	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/m4/lt~obsolete.m4	2021-05-26 05:19:35.000000000 +0700
@@ -1,6 +1,7 @@
 # lt~obsolete.m4 -- aclocal satisfying obsolete definitions.    -*-Autoconf-*-
 #
-#   Copyright (C) 2004, 2005, 2007, 2009 Free Software Foundation, Inc.
+#   Copyright (C) 2004-2005, 2007, 2009, 2011-2015 Free Software
+#   Foundation, Inc.
 #   Written by Scott James Remnant, 2004.
 #
 # This file is free software; the Free Software Foundation gives
@@ -11,7 +12,7 @@
 
 # These exist entirely to fool aclocal when bootstrapping libtool.
 #
-# In the past libtool.m4 has provided macros via AC_DEFUN (or AU_DEFUN)
+# In the past libtool.m4 has provided macros via AC_DEFUN (or AU_DEFUN),
 # which have later been changed to m4_define as they aren't part of the
 # exported API, or moved to Autoconf or Automake where they belong.
 #
@@ -25,7 +26,7 @@
 # included after everything else.  This provides aclocal with the
 # AC_DEFUNs it wants, but when m4 processes it, it doesn't do anything
 # because those macros already exist, or will be overwritten later.
-# We use AC_DEFUN over AU_DEFUN for compatibility with aclocal-1.6. 
+# We use AC_DEFUN over AU_DEFUN for compatibility with aclocal-1.6.
 #
 # Anytime we withdraw an AC_DEFUN or AU_DEFUN, remember to add it here.
 # Yes, that means every name once taken will need to remain here until
diff -urpN net-snmp-5.8/m4/netsnmp_search_libs.m4 net-snmp-5.9.1/m4/netsnmp_search_libs.m4
--- net-snmp-5.8/m4/netsnmp_search_libs.m4	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/m4/netsnmp_search_libs.m4	2021-05-26 05:19:35.000000000 +0700
@@ -25,8 +25,8 @@ AC_DEFUN([NETSNMP_SEARCH_LIBS],
           done]))
      LIBS="${netsnmp_func_search_save_LIBS}"
      [netsnmp_cv_func_$1_]netsnmp_target="${netsnmp_result}"])
- if test "${[netsnmp_cv_func_$1_]netsnmp_target}" != "no" ; then
-    if test "${[netsnmp_cv_func_$1_]netsnmp_target}" != "none required" ; then
+ if test "x${[netsnmp_cv_func_$1_]netsnmp_target}" != "xno" ; then
+    if test "x${[netsnmp_cv_func_$1_]netsnmp_target}" != "xnone required" ; then
        netsnmp_target="${netsnmp_result} ${netsnmp_target_val}"
     fi
     $3
diff -urpN net-snmp-5.8/man/snmp.conf.5.def net-snmp-5.9.1/man/snmp.conf.5.def
--- net-snmp-5.8/man/snmp.conf.5.def	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/man/snmp.conf.5.def	2021-05-26 05:19:35.000000000 +0700
@@ -132,7 +132,8 @@ This value is also used by \fBsnmpd\fR w
 .IP "clientaddrUsesPort no"
 specifies, if clientaddr option contains a port number. Set this option
 to "yes", if clientaddr contains a port number and this port should
-be used for sending outgoing SNMP requests.
+be used for sending outgoing SNMP requests. This option only affects
+IPv4 client addresses and is ignored for IPv6 client addresses.
 .IP "clientRecvBuf INTEGER"
 specifies the desired size of the buffer to be used when receiving
 responses to SNMP requests.
@@ -318,15 +319,15 @@ This directive will be ignored if the pl
 is similar to \fIserverRecvBuf\fR, but applies to the size
 of the buffer used when sending SNMP responses.
 .IP
-.IP "sourceFilterType none|whitelist|blacklist"
+.IP "sourceFilterType none|acceptlist|blocklist"
 specifies whether or not addresses added with \fIsourceFilterAddress\fR are
-whitelisted or blacklisted. The default is none, indicating that incoming
+accepted or blocked. The default is none, indicating that incoming
 packets will not be checked agains the filter list.
 .IP
 .IP "sourceFilterAddress ADDRESS"
 specifies an address to be added to the source address filter list.
 \fIsourceFilterType\fR configuration determines whether or not addresses are
-whitelisted or blacklisted.
+accepted or blocked.
 .IP
 .SH MIB HANDLING
 .IP "mibdirs DIRLIST"
diff -urpN net-snmp-5.8/man/snmpd.8.def net-snmp-5.9.1/man/snmpd.8.def
--- net-snmp-5.8/man/snmpd.8.def	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/man/snmpd.8.def	2021-05-26 05:19:35.000000000 +0700
@@ -55,9 +55,11 @@ the \-D flag and the listed TOKENs.
 Do not fork() from the calling shell.
 .TP
 .B \-g \fIGID
-Change to the numerical group ID
+Change the group ID of the snmpd process into
 .I GID
-after opening listening sockets.
+after opening listening sockets. This overrides the
+.I agentgroup
+configuration file parameter.
 .TP
 .B \-h, \-\-help
 Display a brief usage message and then exit.
@@ -111,10 +113,12 @@ if files only accessible to root (such a
 opened.
 .TP
 .B \-u \fIUID
-Change to the user ID
+Change the user ID of the snmpd process into
 .I UID
 (which can be given in numerical or textual form) after opening
-listening sockets.
+listening sockets. This overrides the
+.I agentuser
+configuration file parameter.
 .TP
 .B \-U
 Instructs the agent to not remove its pid file (see the
diff -urpN net-snmp-5.8/man/snmpd.conf.5.def net-snmp-5.9.1/man/snmpd.conf.5.def
--- net-snmp-5.8/man/snmpd.conf.5.def	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/man/snmpd.conf.5.def	2021-05-26 05:19:35.000000000 +0700
@@ -92,6 +92,28 @@ will be an integer multiple of the numbe
 the calculated number of repeats allow to fit below this number.
 .IP
 Also note that processing of maxGetbulkRepeats is handled first.
+.IP "ifmib_max_num_ifaces NUM"
+Sets the maximum number of interfaces included in IF-MIB data collection.
+For servers with a large number of interfaces (ppp, dummy, bridge, etc)
+the IF-MIB processing will take a large chunk of CPU for ioctl calls
+(on Linux). Setting a reasonable maximum for the CPU used will
+reduce the CPU load for IF-MIB processing.  For example, configuring
+"ifmib_max_num_ifaces 500" will include only the first 500 interfaces
+based on ifindex and ignore all others for IF-MIB processing.
+.IP
+The default (without this configured) is to include all interfaces.
+.IP "include_ifmib_iface_prefix PREFIX1 PREFIX2 ..."
+Sets the interface name prefixes to include in the IF-MIB data collection.
+For servers with a large number of interfaces (ppp, dummy, bridge, etc)
+the IF-MIB processing will take a large chunk of CPU for ioctl calls
+(on Linux). A set of space separated interface name prefixes will
+reduce the CPU load for IF-MIB processing.  For example, configuring
+"include_ifmib_iface_prefix eth dummy lo" will include only interfaces
+with these prefixes and ignore all others for IF-MIB processing. If
+regex support is compiled in, each of the prefixes is a regular
+expression (which is not permitted to contain a space or tab character).
+.IP
+The default (without this configured) is to include all interfaces.
 .SS SNMPv3 Configuration - Real Security
 SNMPv3 is added flexible security models to the SNMP packet structure
 so that multiple security solutions could be used.  SNMPv3 was
@@ -731,13 +753,13 @@ e.g. "loop0"
 Excludes all LInux ramdisk block devices, whose names start with "ram", e.g.
 "ram0"
 .PP
-On Linux systems, it is also possible to report only explicitly whitelisted
+On Linux systems, it is also possible to report only explicitly accepted
 devices. It may take significant amount of time to process diskIOTable data
-on systems with tens of thousands of block devices and whitelisting only the
+on systems with tens of thousands of block devices and accept only the
 important ones avoids large CPU consumption.
 .IP "diskio <device>"
-Enables whitelisting of devices and adds the device to the whitelist. Only
-explicitly whitelisted devices will be reported. This option may be used
+Enables acceptlist of devices and adds the device to the acceptlist. Only
+explicitly acceptlisted devices will be reported. This option may be used
 multiple times.
 .SS System Load Monitoring
 This requires that the agent was built with support for either the
@@ -851,9 +873,9 @@ can configure \fIsnmpd\fR to take a more
 defines the default community string to be used when sending traps.
 Note that this directive must be used prior to any community-based
 trap destination directives that need to use it.
-.IP "trapsink [-profile p] [-name n] [-tag t] HOST [COMMUNITY [PORT]]"
-.IP "trap2sink [-profile p] [-name n] [-tag t] HOST [COMMUNITY [PORT]]"
-.IP "informsink [-profile p] [-name n] [-tag t] HOST [COMMUNITY [PORT]]"
+.IP "trapsink [-profile p] [-name n] [-tag t] [-s src] HOST [COMMUNITY [PORT]]"
+.IP "trap2sink [-profile p] [-name n] [-tag t] [-s src] HOST [COMMUNITY [PORT]]"
+.IP "informsink [-profile p] [-name n] [-tag t] [-s src] HOST [COMMUNITY [PORT]]"
 define the address of a notification receiver that should be sent
 SNMPv1 TRAPs, SNMPv2c TRAP2s, or SNMPv2 INFORM notifications respectively.
 See the section 
@@ -880,6 +902,16 @@ be used for SNMP-NOTIFICATION-MIB table
 which notification filter profile entry will be used for filtering
 outgoing notifications. (See \fInotificationFilter\fR)
 .IP
+The optional src parameter specifies the source address that will
+be used when sending the trap packet to this sink.
+It is specified as a <transport-address>, using the same
+<transport-specifier> as the destination HOST.
+See the section 
+.B LISTENING ADDRESSES
+in the
+.I snmpd(8)
+manual page for more information about the format.
+.IP
 If several sink directives are specified, multiple
 copies of each notification (in the appropriate formats)
 will be generated.
@@ -888,7 +920,7 @@ will be generated.
 It is \fBnot\fR normally appropriate to list two (or all three)
 sink directives with the same destination.
 .RE
-.IP "trapsess [-profile p] [-name n] [-tag t] [SNMPCMD_ARGS] HOST"
+.IP "trapsess [-profile p] [-name n] [-tag t] [-s src] [SNMPCMD_ARGS] HOST"
 provides a more generic mechanism for defining notification destinations.
 .I "SNMPCMD_ARGS"
 should be the command-line options required for an equivalent
@@ -974,7 +1006,9 @@ Note that the event will only be trigger
 first matches.  This monitor entry will not fire again until the
 monitored condition first becomes false, and then matches again.
 NAME is an administrative name for this expression, and is used for
-indexing the \fCmteTriggerTable\fR (and related tables).
+indexing the \fCmteTriggerTable\fR (and related tables). Each monitor
+line must have a unique NAME. Monitor lines with a duplicate name are
+discarded and cause snmpd to log a duplicate index complaint.
 Note also that such monitors use an internal SNMPv3 request to retrieve
 the values being monitored (even if normal agent queries typically use
 SNMPv1 or SNMPv2c).  See the \fIiquerySecName\fP token described above.
diff -urpN net-snmp-5.8/man/snmptrapd.conf.5.def net-snmp-5.9.1/man/snmptrapd.conf.5.def
--- net-snmp-5.8/man/snmptrapd.conf.5.def	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/man/snmptrapd.conf.5.def	2021-05-26 05:19:35.000000000 +0700
@@ -284,6 +284,17 @@ in the
 manual page for more information about the format of listening
 addresses.
 .RE
+.P
+addForwarderInfo 1|yes|true|0|no|false
+.IP
+Each time a trap is forwarded, add an OID with the IP address of the system
+from which the trap has been received. The following OID is
+added: .1.3.6.1.6.3.18.1.3.x (SNMP-COMMUNITY-MIB::snmpTrapAddress.x) where
+x is the lowest index >= 0 that does not yet occur in the trap payload. The end
+recipient (i.e. the monitoring system) can determine the IPv4 address of the
+original sender by looking for the varbind with OID snmpTrapAddress.0. If that
+OID is not populated it means that the trap has been sent directly or in other
+words that it has not been forwarded.
 .SH NOTES
 .IP o
 The daemon blocks while executing the \fItraphandle\fR commands.
diff -urpN net-snmp-5.8/man/snmpusm.1.def net-snmp-5.9.1/man/snmpusm.1.def
--- net-snmp-5.8/man/snmpusm.1.def	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/man/snmpusm.1.def	2021-05-26 05:19:35.000000000 +0700
@@ -83,7 +83,7 @@ with no authentication or privacy settin
 In principle, this user should be useable for 'noAuthNoPriv' requests,
 but in practise the Net-SNMP agent will not allow such an entry
 to be made active.  The user can be created via the createAndWait
-operation instead by using the \-Ca flag.  This will prevent the user
+operation instead by using the \-Cw flag.  This will prevent the user
 from being marked as active in any agent until explicitly activated
 later via the activate command.
 
diff -urpN net-snmp-5.8/mibs/IANA-ADDRESS-FAMILY-NUMBERS-MIB.txt net-snmp-5.9.1/mibs/IANA-ADDRESS-FAMILY-NUMBERS-MIB.txt
--- net-snmp-5.8/mibs/IANA-ADDRESS-FAMILY-NUMBERS-MIB.txt	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/mibs/IANA-ADDRESS-FAMILY-NUMBERS-MIB.txt	2021-05-26 05:19:35.000000000 +0700
@@ -6,7 +6,7 @@ IMPORTS
     TEXTUAL-CONVENTION                  FROM SNMPv2-TC;
 
 ianaAddressFamilyNumbers MODULE-IDENTITY
-    LAST-UPDATED "201409020000Z"  -- September 2, 2014
+    LAST-UPDATED "201911040000Z"  -- November 4, 2019
     ORGANIZATION "IANA"
     CONTACT-INFO
         "Postal:    Internet Assigned Numbers Authority
@@ -23,6 +23,9 @@ ianaAddressFamilyNumbers MODULE-IDENTITY
 
     -- revision history
 
+    REVISION     "201911040000Z"  -- November 4, 2019
+    DESCRIPTION  "Assigned value 16397."
+
     REVISION     "201409020000Z"  -- September 2, 2014
     DESCRIPTION  "Assigned value 16396."
 
@@ -118,6 +121,7 @@ AddressFamilyNumbers ::= TEXTUAL-CONVENT
         ipv664(16394),  -- IPv6/64
         rBridgePortID(16395),  -- RBridge Port ID
         trillNickname(16396),  -- TRILL Nickname
+        universallyUniqueIdentifier(16397),  -- Universally Unique Identifier (UUID)
         reserved(65535)
 
         Requests for new values should be made to IANA via
@@ -165,6 +169,7 @@ AddressFamilyNumbers ::= TEXTUAL-CONVENT
                 ipv664(16394),
                 rBridgePortID(16395),
                 trillNickname(16396),
+                universallyUniqueIdentifier(16397),
                 reserved(65535)
             }
     END
diff -urpN net-snmp-5.8/mibs/IANAifType-MIB.txt net-snmp-5.9.1/mibs/IANAifType-MIB.txt
--- net-snmp-5.8/mibs/IANAifType-MIB.txt	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/mibs/IANAifType-MIB.txt	2021-05-26 05:19:35.000000000 +0700
@@ -5,7 +5,7 @@
        TEXTUAL-CONVENTION          FROM SNMPv2-TC;
 
    ianaifType MODULE-IDENTITY
-       LAST-UPDATED "201703300000Z" -- March 30, 2017
+       LAST-UPDATED "202004020000Z" -- April 2, 2020
        ORGANIZATION "IANA"
        CONTACT-INFO "        Internet Assigned Numbers Authority
 
@@ -19,6 +19,42 @@
                      Convention, and thus the enumerated values of
                      the ifType object defined in MIB-II's ifTable."
 
+       REVISION     "202004020000Z"  -- April 2, 2020
+       DESCRIPTION  "Added reference to ifType definitions registry."
+
+       REVISION     "202001100000Z"  -- January 10, 2020
+       DESCRIPTION  "Addition of IANAifType 299."
+
+       REVISION     "201912030000Z"  -- December 3, 2019
+       DESCRIPTION  "Updated email address for IANA"
+
+       REVISION     "201910160000Z"  -- October 16, 2019
+       DESCRIPTION  "Addition of IANAifTypes 297-298."
+
+       REVISION     "201902140000Z"  -- February 14, 2019
+       DESCRIPTION  "Registration of new tunnelType 18."
+
+       REVISION     "201902080000Z"  -- February 8, 2019
+       DESCRIPTION  "Added missing commas for 295-296."
+
+       REVISION     "201901310000Z"  -- January 31, 2019
+       DESCRIPTION  "Registration of new IANAifTypes 295-296."
+
+       REVISION     "201807040000Z"  -- July 4, 2018
+       DESCRIPTION  "Added missing commas for 291-293."
+
+       REVISION     "201806280000Z"  -- June 28, 2018
+       DESCRIPTION  "Registration of new IANAifType 294."
+
+       REVISION     "201806280000Z"  -- June 28, 2018
+       DESCRIPTION  "Registration of new IANAifType 293."
+
+       REVISION     "201806220000Z"  -- June 22, 2018
+       DESCRIPTION  "Registration of new IANAifType 292."
+
+       REVISION     "201806210000Z"  -- June 21, 2018
+       DESCRIPTION  "Registration of new IANAifType 291."
+
        REVISION     "201703300000Z"  -- March 30, 2017
        DESCRIPTION  "Registration of new IANAifType 290."
 
@@ -324,8 +360,10 @@
                latest arrangements can be obtained by contacting the
                IANA.)
 
-               Requests for new values should be made to IANA via
-               email (iana&iana.org).
+               Interface types must not be directly added to the
+               IANAifType-MIB MIB module.  They must instead be added
+               to the 'ifType definitions' registry at
+               https://www.iana.org/assignments/smi-numbers.
 
                The relationship between the assignment of ifType
                values and of OIDs to particular media-specific MIBs
@@ -639,7 +677,16 @@
                    docsCableNdf (287), -- Cable Narrowband Digital Forward
                    docsCableNdr (288), -- Cable Narrowband Digital Return
                    ptm (289), -- Packet Transfer Mode
-                   ghn (290) -- G.hn port
+                   ghn (290), -- G.hn port
+                   otnOtsi (291), -- Optical Tributary Signal
+                   otnOtuc (292), -- OTN OTUCn
+                   otnOduc (293), -- OTN ODUC
+                   otnOtsig (294), -- OTN OTUC Signal
+                   microwaveCarrierTermination (295), -- air interface of a single microwave carrier
+                   microwaveRadioLinkTerminal (296), -- radio link interface for one or several aggregated microwave carriers
+                   ieee8021axDrni (297), -- IEEE 802.1AX Distributed Resilient Network Interface
+                   ax25 (298), -- AX.25 network interfaces
+                   ieee19061nanocom (299) -- Nanoscale and Molecular Communication
                    }
 
 IANAtunnelType ::= TEXTUAL-CONVENTION
@@ -696,7 +743,8 @@ IANAtunnelType ::= TEXTUAL-CONVENTION
                    teredo(14),       -- Teredo encapsulation
                    ipHttps(15),      -- IPHTTPS
                    softwireMesh(16), -- softwire mesh tunnel
-                   dsLite(17)        -- DS-Lite tunnel
+                   dsLite(17),       -- DS-Lite tunnel
+                   aplusp(18)        -- A+P encapsulation
                }
 
    END
diff -urpN net-snmp-5.8/mibs/UCD-SNMP-MIB.txt net-snmp-5.9.1/mibs/UCD-SNMP-MIB.txt
--- net-snmp-5.8/mibs/UCD-SNMP-MIB.txt	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/mibs/UCD-SNMP-MIB.txt	2021-05-26 05:19:35.000000000 +0700
@@ -746,6 +746,22 @@ memCachedX OBJECT-TYPE
          memory as specifically reserved for this purpose."
     ::= { memory 26 }
 
+memSysAvail OBJECT-TYPE
+    SYNTAX	CounterBasedGauge64
+    UNITS       "kB"
+    MAX-ACCESS	read-only
+    STATUS	current
+    DESCRIPTION
+        "The total amount of available memory, which is an estimate
+         of how much memory is available for starting new applications,
+         without swapping.
+
+         This object will not be implemented on hosts where the
+         underlying operating system does not explicitly identify
+         memory as specifically reserved for this purpose."
+    ::= { memory 27 }
+
+
 memSwapError OBJECT-TYPE
     SYNTAX	UCDErrorFlag
     MAX-ACCESS	read-only
diff -urpN net-snmp-5.8/mibs/rfclist net-snmp-5.9.1/mibs/rfclist
--- net-snmp-5.8/mibs/rfclist	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/mibs/rfclist	2021-05-26 05:19:35.000000000 +0700
@@ -1,4 +1,4 @@
-# updated 2018-01-05
+# updated 2018-12-27
 1155	RFC1155-SMI
 1213	RFC1213-MIB
 1227	SMUX-MIB
@@ -290,3 +290,6 @@
 8096	IPV6-TC:IPV6-MIB:IPV6-ICMP-MIB:IPV6-TCP-MIB:IPV6-UDP-MIB
 8150	MPLS-LPS-MIB
 8173	PTPBASE-MIB
+8389	MAP-E-MIB
+8502	L2L3-VPN-MULTICAST-TC-MIB:L2L3-VPN-MULTICAST-MIB
+8503	BGP-MPLS-LAYER3-VPN-MULTICAST-MIB
diff -urpN net-snmp-5.8/net-snmp-config.in net-snmp-5.9.1/net-snmp-config.in
--- net-snmp-5.8/net-snmp-config.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/net-snmp-config.in	2021-05-26 05:19:35.000000000 +0700
@@ -31,7 +31,9 @@ check_build_dir()
 # effect: returns the (n+1)th argument
 index()
 {
-    eval echo \$`expr $1 + 1`
+    [ $# -gt $1 ] || return
+    shift $1
+    echo $1
 }
 
 # usage: count arguments
@@ -45,7 +47,8 @@ prefix=@prefix@
 exec_prefix=@exec_prefix@
 includedir=@includedir@
 libdir=@libdir@
-datarootdir=@datarootdir@
+# Avoid that configure complains that this script ignores @datarootdir@
+echo "@datarootdir@" >/dev/null
 NSC_LDFLAGS="@LDFLAGS@"
 
 NSC_LIBS="@LIBS@"
@@ -659,7 +662,7 @@ EOF
       fi
       cmd="@CC@ $cflags @CFLAGS@ @DEVFLAGS@ -I. -I${NSC_INCLUDEDIR} -o $outname $tmpfile $cfiles $NSC_LDFLAGS $NSC_LIBDIR $NSC_BASE_AGENT_LIBS $NSC_AGENTLIBS $ldflags"
       echo "running: $cmd"
-      `$cmd`
+      echo `$cmd`
       result=$?
       if test "x$norm" != "x1" ; then
         echo "removing the temporary code file: $tmpfile"
diff -urpN net-snmp-5.8/net-snmp-create-v3-user.in net-snmp-5.9.1/net-snmp-create-v3-user.in
--- net-snmp-5.8/net-snmp-create-v3-user.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/net-snmp-create-v3-user.in	2021-05-26 05:19:35.000000000 +0700
@@ -1,7 +1,5 @@
 #!/bin/sh
 #
-# $Id$
-#
 # this shell script is designed to add new SNMPv3 users
 # to Net-SNMP config file.
 
@@ -16,15 +14,12 @@ Xalgorithm="DES"
 token=rwuser
 
 while test "x$done" = "x" -a "x$1" != "x" -a "x$usage" != "xyes"; do
-case "$1" in
-    -*=*) optarg=`echo "$1" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
-    *) optarg= ;;
-esac
 
 unset shifted
 case $1 in
     --version|--ver*)
       echo @VERSION@
+      exit 0
       ;;
     --help)
       usage="yes"
@@ -42,7 +37,7 @@ case $1 in
 	    shift
 	    ;;
             md5|sha)
-	    Aalgorithm=`echo $1 | tr a-z A-Z`
+	    Aalgorithm=$(echo "$1" | tr a-z A-Z)
 	    shift
 	    ;;
             *)
@@ -63,7 +58,7 @@ case $1 in
 	    shift
 	    ;;
             des|aes|aes128)
-	    Xalgorithm=`echo $1 | tr a-z A-Z`
+	    Xalgorithm=$(echo "$1" | tr a-z A-Z)
 	    shift
 	    ;;
             *)
@@ -124,24 +119,28 @@ fi
 fi
 outdir="@PERSISTENT_DIRECTORY@"
 outfile="$outdir/snmpd.conf"
-line="createUser $user $Aalgorithm \"$apassphrase\" $Xalgorithm \"$xpassphrase\""
+if test "x$xpassphrase" = "x" ; then
+    line="createUser $user $Aalgorithm \"$apassphrase\" $Xalgorithm"
+else
+    line="createUser $user $Aalgorithm \"$apassphrase\" $Xalgorithm \"$xpassphrase\""
+fi
 echo "adding the following line to $outfile:"
-echo "  " $line
+echo "   $line"
 # in case it hasn't ever been started yet, start it.
-if test ! -d $outdir ; then
-    mkdir $outdir
+if test ! -d "$outdir"; then
+    mkdir "$outdir"
 fi
-if test ! -d $outfile ; then
-    touch $outfile
+if test ! -d "$outfile"; then
+    touch "$outfile"
 fi
-echo $line >> $outfile
-prefix="@prefix@"
-datarootdir="@datarootdir@"
+echo "$line" >> "$outfile"
+# Avoid that configure complains that this script ignores @datarootdir@
+echo "@datarootdir@" >/dev/null
 outfile="@datadir@/snmp/snmpd.conf"
 line="$token $user"
 echo "adding the following line to $outfile:"
-echo "  " $line
-if test ! -d $outfile ; then
-    touch $outfile
+echo "   $line"
+if test ! -d "$outfile"; then
+    touch "$outfile"
 fi
-echo $line >> $outfile
+echo "$line" >> $outfile
diff -urpN net-snmp-5.8/netsnmp-agent.pc.in net-snmp-5.9.1/netsnmp-agent.pc.in
--- net-snmp-5.8/netsnmp-agent.pc.in	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/netsnmp-agent.pc.in	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,12 @@
+prefix=@prefix@
+exec_prefix=@exec_prefix@
+includedir=@includedir@
+libdir=@libdir@
+
+Name: netsnmp-agent (@PACKAGE_NAME@)
+Description: SNMP (Simple Network Management Protocol) sub-agent SDK.
+URL: http://www.net-snmp.org
+Version: @PACKAGE_VERSION@
+Cflags: -I${includedir}
+Libs: -L${libdir} -lnetsnmpmibs -lnetsnmpagent -lnetsnmp
+Libs.private: @LDFLAGS@ @LMIBLIBS@ @LAGENTLIBS@ @PERLLDOPTS_FOR_APPS@ @LNETSNMPLIBS@ @LIBS@
diff -urpN net-snmp-5.8/netsnmp.pc.in net-snmp-5.9.1/netsnmp.pc.in
--- net-snmp-5.8/netsnmp.pc.in	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/netsnmp.pc.in	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,12 @@
+prefix=@prefix@
+exec_prefix=@exec_prefix@
+includedir=@includedir@
+libdir=@libdir@
+
+Name: netsnmp (@PACKAGE_NAME@)
+Description: SNMP (Simple Network Management Protocol) daemon and applications.
+URL: http://www.net-snmp.org
+Version: @PACKAGE_VERSION@
+Cflags: -I${includedir}
+Libs: -L${libdir} -lnetsnmp
+Libs.private: @LDFLAGS@ @LNETSNMPLIBS@ @LIBS@ @PERLLDOPTS_FOR_APPS@
diff -urpN net-snmp-5.8/perl/ASN/ASN.pm net-snmp-5.9.1/perl/ASN/ASN.pm
--- net-snmp-5.8/perl/ASN/ASN.pm	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/ASN/ASN.pm	2021-05-26 05:19:35.000000000 +0700
@@ -66,7 +66,7 @@ use vars qw(@ISA %EXPORT_TAGS @EXPORT_OK
 	ASN_UNSIGNED
 	ASN_UNSIGNED64
 );
-$VERSION = '5.08';
+$VERSION = '5.0901';
 
 sub AUTOLOAD {
     # This AUTOLOAD is used to 'autoload' constants from the constant()
diff -urpN net-snmp-5.8/perl/ASN/ASN.xs net-snmp-5.9.1/perl/ASN/ASN.xs
--- net-snmp-5.8/perl/ASN/ASN.xs	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/ASN/ASN.xs	2021-05-26 05:19:35.000000000 +0700
@@ -1,7 +1,4 @@
 /* -*- C -*- */
-#if defined(_WIN32) && !defined(_WIN32_WINNT)
-#define _WIN32_WINNT 0x501
-#endif
 
 #include "EXTERN.h"
 #include "perl.h"
diff -urpN net-snmp-5.8/perl/ASN/Makefile.PL net-snmp-5.9.1/perl/ASN/Makefile.PL
--- net-snmp-5.8/perl/ASN/Makefile.PL	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/ASN/Makefile.PL	2021-05-26 05:19:35.000000000 +0700
@@ -1,5 +1,6 @@
 use strict;
 use warnings;
+use Config;
 use Cwd 'abs_path';
 use ExtUtils::MakeMaker;
 use File::Basename;
@@ -25,15 +26,13 @@ sub AsnInitMakeParams {
 		  'PREREQ_PM'           => {},
 		  );
 
-    if ($ENV{'OSTYPE'} eq 'msys') {
-      $Params{'DEFINE'} = "-DMINGW_PERL";
-    }
+    AddCommonParams(\%Params);
                   
     my ($snmp_lib, $snmp_llib, $sep);
 
-    if (($Config{'osname'} eq 'MSWin32' && $ENV{'OSTYPE'} eq '')) {
-      $opts = NetSNMPGetOpts();	
-      $Params{'DEFINE'} = "-DMSVC_PERL -D_CRT_SECURE_NO_WARNINGS -D_CRT_NONSTDC_NO_WARNINGS";
+    $opts = NetSNMPGetOpts();
+
+    if ($Config{'osname'} eq 'MSWin32' && !defined($ENV{'OSTYPE'})) {
       $sep = '\\';
       my $snmp_lib_file = 'netsnmp.lib';
       my $snmp_link_lib = 'netsnmp';
@@ -50,7 +49,7 @@ sub AsnInitMakeParams {
 	$Params{'LIBS'} = "-L" . $MakefileSubs::basedir . "\\win32\\$lib_dir\\ -l$snmp_link_lib";
       }
       else {
-	my @LibDirs = split (';',$ENV{LIB});
+	my @LibDirs = split($Config{path_sep}, $ENV{LIB});
         my $LibDir;
 	if ($opts->{'prefix'}) {
 	  push (@LibDirs,"$ENV{'NET-SNMP-PATH'}${sep}lib");
@@ -72,31 +71,20 @@ sub AsnInitMakeParams {
 	}
 	$Params{LIBS} = "-L$LibDir -l$snmp_link_lib";
       }
-
-      $Params{'INC'} = "-I" . $MakefileSubs::basedir . "\\include\\ -I" . $MakefileSubs::basedir . "\\include\\net-snmp\\ -I" . $MakefileSubs::basedir . "\\win32\\ ";
     }
     else
     {
-      $opts = NetSNMPGetOpts();
-      $Params{'LDDLFLAGS'} = "$Config{lddlflags} " . `$opts->{'nsconfig'} --ldflags`;
-      $Params{'LIBS'}    = `$opts->{'nsconfig'} --libs`;
+      $Params{'LIBS'}    = `$opts->{'nsconfig'} --libs` or
+          die "net-snmp-config failed\n";
       chomp($Params{'LIBS'});
-      $Params{'CCFLAGS'} = `$opts->{'nsconfig'} --cflags`;
-      chomp($Params{'CCFLAGS'});
-      $Params{'CCFLAGS'} .= " " . $Config{'ccflags'};
-      $lib_version = `$opts->{'nsconfig'} --version`;
+      $lib_version = `$opts->{'nsconfig'} --version` or
+          die "net-snmp-config failed\n";
       
       if (lc($opts->{'insource'}) eq "true") {
 	$Params{'LIBS'} =
             "-L" . abs_path("../../snmplib/.libs") .
             " -L" . abs_path("../../snmplib") .
             " " . $Params{'LIBS'};
-	$Params{'CCFLAGS'} = "-I../../include " . $Params{'CCFLAGS'};
-      }
-      $Params{'CCFLAGS'} =~ s/ -W(all|inline|strict-prototypes|write-strings|cast-qual|no-char-subscripts)//g; # ignore developer warnings
-      $Params{'CCFLAGS'} .= ' -Wformat';
-      if ($Params{'LIBS'} eq "" || $Params{'CCFLAGS'} eq "") {
-	die "You need to install net-snmp first (I can't find net-snmp-config)";
       }
     }
     return (%Params);
diff -urpN net-snmp-5.8/perl/ASN/test.pl net-snmp-5.9.1/perl/ASN/test.pl
--- net-snmp-5.8/perl/ASN/test.pl	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/ASN/test.pl	2021-05-26 05:19:35.000000000 +0700
@@ -1,28 +1,25 @@
+#!./perl
+#
 # Before `make install' is performed this script should be runnable with
 # `make test'. After `make install' it should work as `perl test.pl'
 
-######################### We start with some black magic to print on failure.
+use strict;
+use warnings;
+use Test;
+
+BEGIN {
+    $| = 1;
+    plan tests => 9;
+}
 
-# Change 1..1 below to 1..last_test_to_print .
-# (It may become useful if the test is moved to ./t subdirectory.)
-
-BEGIN { $| = 1; print "1..9\n"; }
-END {print "not ok 1\n" unless $loaded;}
 use NetSNMP::ASN (':all');
-$loaded = 1;
-print "ok 1\n";
-
-######################### End of black magic.
-
-# Insert your test code below (better if it prints "ok 13"
-# (correspondingly "not ok 13") depending on the success of chunk 13
-# of the test code):
+ok(1);
 
-print ((ASN_INTEGER == 2) ? "ok 2\n" : "not ok 2\n");
-print ((ASN_OCTET_STR == 4) ? "ok 3\n" : "not ok 3\bn");
-print ((ASN_COUNTER == 0x41) ? "ok 4\n" : "not ok 4\n");
-print ((ASN_UNSIGNED == 0x42) ? "ok 5\n" : "not ok 5\n");
-print ((ASN_COUNTER64 == 0x46) ? "ok 6\n" : "not ok 6\n");
-print ((ASN_IPADDRESS == 0x40) ? "ok 7\n" : "not ok 7\n");
-print ((ASN_NULL == 5) ? "ok 8\n" : "not ok 8\n");
-print ((ASN_TIMETICKS == 0x43) ? "ok 9\n" : "not ok 9\n");
+ok(ASN_INTEGER, 2);
+ok(ASN_OCTET_STR, 4);
+ok(ASN_COUNTER, 0x41);
+ok(ASN_UNSIGNED, 0x42);
+ok(ASN_COUNTER64, 0x46);
+ok(ASN_IPADDRESS, 0x40);
+ok(ASN_NULL, 5);
+ok(ASN_TIMETICKS, 0x43);
diff -urpN net-snmp-5.8/perl/AnyData_SNMP/Storage.pm net-snmp-5.9.1/perl/AnyData_SNMP/Storage.pm
--- net-snmp-5.8/perl/AnyData_SNMP/Storage.pm	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/AnyData_SNMP/Storage.pm	2021-05-26 05:19:35.000000000 +0700
@@ -6,7 +6,7 @@ package AnyData::Storage::SNMP;
 ##   scalar sets?
 ##   multi-hosts
 
-$AnyData::Storage::VERSION = '5.08';
+$AnyData::Storage::VERSION = '5.0901';
 use strict;
 use warnings;
 
diff -urpN net-snmp-5.8/perl/Makefile.PL net-snmp-5.9.1/perl/Makefile.PL
--- net-snmp-5.8/perl/Makefile.PL	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/Makefile.PL	2021-05-26 05:19:35.000000000 +0700
@@ -5,17 +5,10 @@ use Config;
 require 5;
 use MakefileSubs;
 
-WriteMakefile(TopLevelInitMakeParams());
+# Prevent that MakeMaker complains about unknown parameter names.
+NetSNMPGetOpts();
 
-sub TopLevelInitMakeParams {
-    my $nsconfig="net-snmp-config"; # in path by default
-    my %Params = (
-		  'NAME' => 'Bundle::NetSNMP',
-		  'DIR' => [qw(default_store ASN OID agent SNMP TrapReceiver)],
-		  );
-
-    # bogus, but these options need to be passed to the lower levels
-    my $opts = NetSNMPGetOpts("./");
-
-    return(%Params);
-}
+WriteMakefile(
+    'NAME' => 'Bundle::NetSNMP',
+    'DIR' => [qw(default_store ASN OID agent SNMP TrapReceiver)],
+    );
diff -urpN net-snmp-5.8/perl/MakefileSubs.pm net-snmp-5.9.1/perl/MakefileSubs.pm
--- net-snmp-5.8/perl/MakefileSubs.pm	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/MakefileSubs.pm	2021-05-26 05:19:35.000000000 +0700
@@ -3,91 +3,125 @@ package MakefileSubs;
 use strict;
 use warnings;
 use Config;
+use Cwd 'abs_path';
+use File::Basename;
+use File::Spec;
 use Getopt::Long;
 use Exporter;
 use vars qw(@ISA @EXPORT_OK);
 
 our $VERSION = 1.00;
 our @ISA     = qw(Exporter);
-our @EXPORT  = qw(NetSNMPGetOpts find_files Check_Version floatize_version);
+our @EXPORT  = qw(NetSNMPGetOpts AddCommonParams find_files Check_Version
+                  floatize_version);
 our $basedir;
 
-sub NetSNMPGetOpts {
-    my %ret;
-    my $rootpath = shift;
-    $rootpath = "../" if (!$rootpath);
-    $rootpath .= '/' if ($rootpath !~ /\/$/);
-
-    if (($Config{'osname'} eq 'MSWin32' && $ENV{'OSTYPE'} eq '')) {
-
-      # Grab command line options first.  Only used if environment variables are not set
-      GetOptions("NET-SNMP-IN-SOURCE=s" => \$ret{'insource'},
-        "NET-SNMP-PATH=s"      => \$ret{'prefix'},
-        "NET-SNMP-DEBUG=s"     => \$ret{'debug'});
-
-      if ($ENV{'NET-SNMP-IN-SOURCE'})
-      {
-	$ret{'insource'} = $ENV{'NET-SNMP-IN-SOURCE'};
-        undef ($ret{'prefix'});
-      }
-      elsif ($ENV{'NET-SNMP-PATH'})
-      {
-	$ret{'prefix'} = $ENV{'NET-SNMP-PATH'};
-      }
-
-      if ($ENV{'NET-SNMP-DEBUG'})
-      {
-	$ret{'debug'} = $ENV{'NET-SNMP-DEBUG'};
-      }
-
-      # Update environment variables in case they are needed
-      $ENV{'NET-SNMP-IN-SOURCE'}    = $ret{'insource'};
-      $ENV{'NET-SNMP-PATH'}         = $ret{'prefix'};
-      $ENV{'NET-SNMP-DEBUG'}        = $ret{'debug'};
-
-      $basedir = abs_path($0);
-      while (1) {
-          my $basename = basename($basedir);
-          last if (length($basename) <= 2);
-          $basedir = dirname($basedir);
-          last if ($basename eq "perl");
-      }
-      print "Net-SNMP base directory: $basedir\n";
-      if ($basedir =~ / /) {
+BEGIN {
+    $basedir = abs_path($0);
+    while (1) {
+	my $basename = basename($basedir);
+	last if (length($basename) <= 2);
+	$basedir = dirname($basedir);
+	last if ($basename eq "perl");
+    }
+    if ($Config{'osname'} eq 'MSWin32' && $basedir =~ / /) {
         die "\nA space has been detected in the base directory.  This is not " .
             "supported\nPlease rename the folder and try again.\n\n";
-      }
     }
-    else
-    {
-      if ($ENV{'NET-SNMP-CONFIG'} &&
-        $ENV{'NET-SNMP-IN-SOURCE'}) {
+}
+
+sub NetSNMPGetOpts {
+    my %ret;
+    my $rootpath = $basedir;
+
+    if ($ENV{'NET-SNMP-CONFIG'} && $ENV{'NET-SNMP-IN-SOURCE'}) {
 	# have env vars, pull from there
 	$ret{'nsconfig'} = $ENV{'NET-SNMP-CONFIG'};
 	$ret{'insource'} = $ENV{'NET-SNMP-IN-SOURCE'};
-      } else {
+	$ret{'define'}   = $ENV{'NET-SNMP-DEFINE'};
+	$ret{'inc'}      = $ENV{'NET-SNMP-INC'};
+	$ret{'cflags'}   = $ENV{'NET-SNMP-CFLAGS'};
+	# $ret{'prefix'} is not used on Windows.
+    } else {
 	# don't have env vars, pull from command line and put there
-	GetOptions("NET-SNMP-CONFIG=s" => \$ret{'nsconfig'},
-	           "NET-SNMP-IN-SOURCE=s" => \$ret{'insource'});
+	GetOptions("NET-SNMP-CONFIG=s"    => \$ret{'nsconfig'},
+	           "NET-SNMP-IN-SOURCE=s" => \$ret{'insource'},
+		   "NET-SNMP-DEFINE=s"    => \$ret{'define'},
+		   "NET-SNMP-INC=s"       => \$ret{'inc'},
+		   "NET-SNMP-CFLAGS=s"    => \$ret{'cflags'},
+		   "NET-SNMP-PATH=s"      => \$ret{'prefix'});
+
+	my $use_default_nsconfig;
+
+	if ($ret{'insource'}) {
+	    if (lc($ret{'insource'}) eq "true" && !defined($ret{'nsconfig'})) {
+		$use_default_nsconfig = 1;
+	    }
+	}
 
-	if (lc($ret{'insource'}) eq "true" && $ret{'nsconfig'} eq "") {
-	    $ret{'nsconfig'}="sh ROOTPATH../net-snmp-config";
-	} elsif ($ret{'nsconfig'} eq "") {
+	if ($use_default_nsconfig) {
+	    $ret{'nsconfig'}="sh " . File::Spec->catfile(${rootpath}, "..",
+							 "net-snmp-config");
+	} elsif (!defined($ret{'nsconfig'})) {
 	    $ret{'nsconfig'}="net-snmp-config";
 	}
 
 	$ENV{'NET-SNMP-CONFIG'}    = $ret{'nsconfig'};
 	$ENV{'NET-SNMP-IN-SOURCE'} = $ret{'insource'};
-      }
+	$ENV{'NET-SNMP-DEFINE'}    = $ret{'define'};
+	$ENV{'NET-SNMP-INC'}       = $ret{'inc'};
+	$ENV{'NET-SNMP-CFLAGS'}    = $ret{'cflags'};
+	$ENV{'NET-SNMP-PATH'}      = $ret{'prefix'};
     }
-
-    $ret{'nsconfig'} =~ s/ROOTPATH/$rootpath/;
-
+    
     $ret{'rootpath'} = $rootpath;
+    $ret{'debug'} = 'false';
 
     \%ret;
 }
 
+sub append {
+    if ($_[0] && $_[1]) {
+	$_[0] = $_[0] . " " . $_[1];
+    } elsif ($_[1]) {
+	$_[0] = $_[1];
+    }
+}
+
+sub AddCommonParams {
+    my $Params = shift;
+    my $opts = NetSNMPGetOpts();
+
+    append($Params->{'DEFINE'},  $opts->{'define'});
+    append($Params->{'INC'},     $opts->{'inc'});
+    append($Params->{'CCFLAGS'}, $opts->{'cflags'});
+
+    if ($Config{'osname'} eq 'MSWin32') {
+	# Microsoft Visual Studio.
+	append($Params->{'DEFINE'}, "-DMSVC_PERL -D_CRT_SECURE_NO_WARNINGS -D_CRT_NONSTDC_NO_WARNINGS");
+	append($Params->{'INC'},
+	       "-I" . File::Spec->catdir($basedir, "include") . " " .
+	       "-I" . File::Spec->catdir($basedir, "win32") . " ");
+    } else {
+	# Unix or MinGW.
+	append($Params->{'LDDLFLAGS'}, $Config{'lddlflags'});
+	my $ldflags = `$opts->{'nsconfig'} --ldflags` or
+	    die "net-snmp-config failed\n";
+	chomp($ldflags);
+	append($Params->{'LDDLFLAGS'}, $ldflags);
+	append($Params->{'CCFLAGS'},
+	       "-I" . File::Spec->catdir($basedir, "include"));
+	my $cflags = `$opts->{'nsconfig'} --cflags` or
+	    die "net-snmp-config failed\n";
+	chomp($cflags);
+	append($Params->{'CCFLAGS'}, $cflags);
+	append($Params->{'CCFLAGS'}, $Config{'ccflags'});
+	# Suppress known Perl header shortcomings.
+	$Params->{'CCFLAGS'} =~ s/ -W(cast-qual|write-strings)//g;
+	append($Params->{'CCFLAGS'}, '-Wformat');
+    }
+}
+
 sub find_files {
     my($f,$d) = @_;
     my ($dir,$found,$file);
@@ -103,11 +137,10 @@ sub find_files {
 }
 
 
-sub Check_Version
-{
+sub Check_Version {
   my $lib_version = shift;
 
-  if (($Config{'osname'} ne 'MSWin32' || $ENV{'OSTYPE'} ne '')) {
+  if ($Config{'osname'} ne 'MSWin32') {
     my $foundversion = 0;
     return if ($ENV{'NETSNMP_DONT_CHECK_VERSION'});
     open(I,"<Makefile");
diff -urpN net-snmp-5.8/perl/OID/Makefile.PL net-snmp-5.9.1/perl/OID/Makefile.PL
--- net-snmp-5.8/perl/OID/Makefile.PL	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/OID/Makefile.PL	2021-05-26 05:19:35.000000000 +0700
@@ -23,14 +23,13 @@ sub OidInitMakeParams {
 		  'PREREQ_PM'           => {},
 		  );
 
-    if ($ENV{'OSTYPE'} eq 'msys') {
-      $Params{'DEFINE'} = "-DMINGW_PERL";
-    }
+    AddCommonParams(\%Params);
                   
     my ($snmp_lib, $snmp_llib, $sep);
-    if (($Config{'osname'} eq 'MSWin32' && $ENV{'OSTYPE'} eq '')) {
-      $opts = NetSNMPGetOpts();	
-      $Params{'DEFINE'} = "-DMSVC_PERL -D_CRT_SECURE_NO_WARNINGS -D_CRT_NONSTDC_NO_WARNINGS";
+
+    $opts = NetSNMPGetOpts();
+
+    if ($Config{'osname'} eq 'MSWin32' && !defined($ENV{'OSTYPE'})) {
       $sep = '\\';
       my $snmp_lib_file = 'netsnmp.lib';
       my $snmp_link_lib = 'netsnmp';
@@ -47,7 +46,7 @@ sub OidInitMakeParams {
 	$Params{'LIBS'} = "-L" . $MakefileSubs::basedir . "\\win32\\$lib_dir\\ -l$snmp_link_lib";
       }
       else {
-	my @LibDirs = split (';',$ENV{LIB});
+	my @LibDirs = split($Config{path_sep}, $ENV{LIB});
         my $LibDir;
 	if ($opts->{'prefix'}) {
 	  push (@LibDirs,"$ENV{'NET-SNMP-PATH'}${sep}lib");
@@ -69,32 +68,21 @@ sub OidInitMakeParams {
 	}
 	$Params{LIBS} = "-L$LibDir -l$snmp_link_lib";
       }
-
-      $Params{'INC'} = "-I" . $MakefileSubs::basedir . "\\include\\ -I" . $MakefileSubs::basedir . "\\include\\net-snmp\\ -I" . $MakefileSubs::basedir . "\\win32\\ ";
     }
     else {
-	$opts = NetSNMPGetOpts();
-	$Params{'LDDLFLAGS'} = "$Config{lddlflags} " . `$opts->{'nsconfig'} --ldflags`;
- 	$Params{'LIBS'}    = `$opts->{'nsconfig'} --libs`;
+	$Params{'LIBS'}    = `$opts->{'nsconfig'} --libs` or
+	    die "net-snmp-config failed\n";
 	chomp($Params{'LIBS'});
-	$Params{'CCFLAGS'} = `$opts->{'nsconfig'} --cflags`;
-	chomp($Params{'CCFLAGS'});
-	$Params{'CCFLAGS'} .= " " . $Config{'ccflags'};
-        $lib_version = `$opts->{'nsconfig'} --version`;
+        $lib_version = `$opts->{'nsconfig'} --version` or
+	    die "net-snmp-config failed\n";
 	if (lc($opts->{'insource'}) eq "true") {
 	    $Params{'LIBS'} =
                 "-L" . abs_path("../../snmplib/.libs") .
                 " -L" . abs_path("../../snmplib") .
                 " " . $Params{'LIBS'};
-	    $Params{'CCFLAGS'} = "-I../../include " . $Params{'CCFLAGS'};
 #	} else {
 #	    $Params{'PREREQ_PM'} = {'SNMP' => '5.0'};
 	}
-	$Params{'CCFLAGS'} =~ s/ -W(all|inline|strict-prototypes|write-strings|cast-qual|no-char-subscripts)//g; # ignore developer warnings
-        $Params{'CCFLAGS'} .= ' -Wformat';
-	if ($Params{'LIBS'} eq "" || $Params{'CCFLAGS'} eq "") {
-	    die "You need to install net-snmp first (I can't find net-snmp-config)";
-	}
     }
 
     return(%Params);
diff -urpN net-snmp-5.8/perl/OID/OID.pm net-snmp-5.9.1/perl/OID/OID.pm
--- net-snmp-5.8/perl/OID/OID.pm	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/OID/OID.pm	2021-05-26 05:19:35.000000000 +0700
@@ -92,7 +92,7 @@ use vars qw(@ISA %EXPORT_TAGS @EXPORT_OK
 	snmp_oid_compare
         compare
 );
-$VERSION = '5.08';
+$VERSION = '5.0901';
 
 sub new {
     my $type = shift;
diff -urpN net-snmp-5.8/perl/OID/OID.xs net-snmp-5.9.1/perl/OID/OID.xs
--- net-snmp-5.8/perl/OID/OID.xs	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/OID/OID.xs	2021-05-26 05:19:35.000000000 +0700
@@ -1,7 +1,4 @@
 /* -*- C -*- */
-#if defined(_WIN32) && !defined(_WIN32_WINNT)
-#define _WIN32_WINNT 0x501
-#endif
 
 #include "EXTERN.h"
 #include "perl.h"
@@ -45,13 +42,8 @@ static int __sprint_num_objid _((char *,
 #define USE_ENUMS 1
 #define USE_SPRINT_VALUE 2
 static int
-__snprint_value (buf, buf_len, var, tp, type, flag)
-char * buf;
-size_t buf_len;
-netsnmp_variable_list * var;
-struct tree * tp;
-int type;
-int flag;
+__snprint_value(char *buf, size_t buf_len, netsnmp_variable_list *var,
+                struct tree *tp, int type, int flag)
 {
    int len = 0;
    u_char* ip;
@@ -236,7 +228,7 @@ nsop_to_array(oid1)
         int i;
 
     PPCODE:
-        EXTEND(SP, oid1->len);
+        EXTEND(SP, (int)oid1->len);
         for(i=0; i < (int)oid1->len; i++) {
             PUSHs(sv_2mortal(newSVnv(oid1->name[i])));
         }
diff -urpN net-snmp-5.8/perl/OID/netsnmp-feature-definitions.h net-snmp-5.9.1/perl/OID/netsnmp-feature-definitions.h
--- net-snmp-5.8/perl/OID/netsnmp-feature-definitions.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/OID/netsnmp-feature-definitions.h	2021-05-26 05:19:35.000000000 +0700
@@ -1,6 +1,6 @@
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-features.h>
 
-netsnmp_feature_require(snprint_objid)
-netsnmp_feature_require(snprint_value)
+netsnmp_feature_require(snprint_objid);
+netsnmp_feature_require(snprint_value);
 
diff -urpN net-snmp-5.8/perl/OID/test.pl net-snmp-5.9.1/perl/OID/test.pl
--- net-snmp-5.8/perl/OID/test.pl	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/OID/test.pl	2021-05-26 05:19:35.000000000 +0700
@@ -1,12 +1,18 @@
+#!./perl
+#
 # Before `make install' is performed this script should be runnable with
 # `make test'. After `make install' it should work as `perl test.pl'
 
-#########################
+use strict;
+use warnings;
+use Cwd qw(abs_path);
+use Test;
 
-# change 'tests => 1' to 'tests => last_test_to_print';
+BEGIN {
+    plan tests => 38;
+}
 
-use Test;
-BEGIN { eval "use Cwd qw(abs_path)"; plan tests => 38 ; $ENV{'SNMPCONFPATH'} = 'nopath' ; $ENV{'MIBDIRS'} = '+' . abs_path("../../mibs"); };
+require "../SNMP/t/readsnmptest.pl";
 use NetSNMP::OID;
 
 ok(1); # If we made it this far, we're ok.
@@ -70,7 +76,7 @@ ok($a[0] == 1 && $a[1] == 3 && $a[2] ==
 $oid->append(".1.2.3");
 ok("$oid" eq "directory.2.3");
 
-$oidmore = $oid + ".8.9.10";
+my $oidmore = $oid + ".8.9.10";
 ok($oidmore == new NetSNMP::OID("directory.2.3.8.9.10"));
 ok("$oid" eq "directory.2.3");
 ok(ref($oidmore) eq "NetSNMP::OID");
@@ -79,7 +85,7 @@ ok(ref($oidmore) eq "NetSNMP::OID");
 $oidmore += ".11";
 ok($oidmore == new NetSNMP::OID("directory.2.3.8.9.10.11"));
 
-$oidstr = $oidmore + "\"wes\"";
+my $oidstr = $oidmore + "\"wes\"";
 ok($oidstr == new NetSNMP::OID("directory.2.3.8.9.10.11.3.119.101.115"));
 
 $oidstr = $oidmore + "\'wes\'";
@@ -123,7 +129,7 @@ else {
 $newtest = new NetSNMP::OID ("snmpNotifyRowStatus.105.110.116.101.114.110.97.108.48");
 
 if ($newtest) {
-  $arrayback = $newtest->get_indexes();
+  my $arrayback = $newtest->get_indexes();
   
   ok($#$arrayback == 0 &&
     $arrayback->[0] eq 'internal0'
diff -urpN net-snmp-5.8/perl/SNMP/Makefile.PL net-snmp-5.9.1/perl/SNMP/Makefile.PL
--- net-snmp-5.8/perl/SNMP/Makefile.PL	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/Makefile.PL	2021-05-26 05:19:35.000000000 +0700
@@ -1,9 +1,12 @@
 use strict;
 use warnings;
-use ExtUtils::MakeMaker;
-require 5;
+use Carp;
 use Config;
+use Cwd 'abs_path';
+use ExtUtils::MakeMaker;
+use File::Spec;
 use MakefileSubs;
+require 5;
 
 my $lib_version;
 my $opts;
@@ -28,14 +31,13 @@ sub SnmpInitMakeParams {
 		  realclean        => { FILES => 'host' },
 		  );
 
-    if ($ENV{'OSTYPE'} eq 'msys') {
-      $Params{'DEFINE'} = "-DMINGW_PERL";
-    }
+    AddCommonParams(\%Params);
                                     
     my ($snmp_lib, $snmp_llib, $sep);
-    if (($Config{'osname'} eq 'MSWin32' && $ENV{'OSTYPE'} eq '')) {
-      $opts = NetSNMPGetOpts();	
-      $Params{'DEFINE'} = "-DMSVC_PERL -D_CRT_SECURE_NO_WARNINGS -D_CRT_NONSTDC_NO_WARNINGS";
+
+    $opts = NetSNMPGetOpts();
+
+    if ($Config{'osname'} eq 'MSWin32' && !defined($ENV{'OSTYPE'})) {
       $sep = '\\';
       my $snmp_lib_file = 'netsnmp.lib';
       my $snmp_link_lib = 'netsnmp';
@@ -52,7 +54,7 @@ sub SnmpInitMakeParams {
 	$Params{'LIBS'} = "-L" . $MakefileSubs::basedir . "\\win32\\$lib_dir\\ -l$snmp_link_lib";
       }
       else {
-	my @LibDirs = split (';',$ENV{LIB});
+	my @LibDirs = split($Config{path_sep}, $ENV{LIB});
         my $LibDir;
 	if ($opts->{'prefix'}) {
 	  push (@LibDirs,"$ENV{'NET-SNMP-PATH'}${sep}lib");
@@ -74,47 +76,29 @@ sub SnmpInitMakeParams {
 	}
 	$Params{LIBS} = "-L$LibDir -l$snmp_link_lib";
       }
-
-      $Params{'INC'} = "-I" . $MakefileSubs::basedir . "\\include\\ -I" . $MakefileSubs::basedir . "\\include\\net-snmp\\ -I" . $MakefileSubs::basedir . "\\win32\\ ";
     }
     else {
-	$opts = NetSNMPGetOpts();
-	$Params{'LDDLFLAGS'} = "$Config{lddlflags} " . `$opts->{'nsconfig'} --ldflags`;
 	if (!$ENV{'NETSNMP_LIBS'}) {
-	    $Params{'LIBS'}    = `$opts->{'nsconfig'} --libs`;
+	    $Params{'LIBS'}    = `$opts->{'nsconfig'} --libs` or
+		die "net-snmp-config failed\n";
 	    chomp($Params{'LIBS'});
 	} else {
 	    $Params{'LIBS'} = $ENV{'NETSNMP_LIBS'};
 	}
-	if (!$ENV{'NETSNMP_CCFLAGS'}) {
-	    $Params{'CCFLAGS'} = `$opts->{'nsconfig'} --cflags`;
-	    chomp($Params{'CCFLAGS'});
-	    $Params{'CCFLAGS'} .= " " . $Config{'ccflags'};
-	} else {
-	    $Params{'CCFLAGS'} = $ENV{'NETSNMP_CCFLAGS'};
-	}
-        $lib_version = `$opts->{'nsconfig'} --version`;
+        $lib_version = `$opts->{'nsconfig'} --version` or
+	    die "net-snmp-config failed\n";
 	if (lc($opts->{'insource'}) eq "true") {
 	    $Params{'LIBS'} =
                 "-L" . abs_path("../../snmplib/.libs") .
                 " -L" . abs_path("../../snmplib") .
                 " " . $Params{'LIBS'};
-	    $Params{'CCFLAGS'} = "-I../../include " . $Params{'CCFLAGS'};
 #	} else {
 #	    $Params{'PREREQ_PM'} = { 'NetSNMP::default_store' => 0.01 };
 	}
-	$Params{'CCFLAGS'} =~ s/ -W(all|inline|strict-prototypes|write-strings|cast-qual|no-char-subscripts)//g; # ignore developer warnings
-        $Params{'CCFLAGS'} .= ' -Wformat';
-	if (!$ENV{'NETSNMP_PREFIX'}) {
-	    $prefix            = `$opts->{'nsconfig'} --prefix`;
-	    chomp($prefix);
-	    $sep = '/';
-	} else {
-	    $prefix = $ENV{'NETSNMP_PREFIX'};
-	}
-	if ($Params{'LIBS'} eq "" || $Params{'CCFLAGS'} eq "") {
-	    die "You need to install net-snmp first (I can't find net-snmp-config)";
-	}
+	$prefix = ($opts->{'prefix'} or `$opts->{'nsconfig'} --prefix` or
+	    die "net-snmp-config failed\n");
+	chomp($prefix);
+	$sep = '/';
     }
 
     return(%Params);
@@ -122,97 +106,73 @@ sub SnmpInitMakeParams {
 }
 
 sub GetTestInfo {
-    my $sep = ($^O =~ /win32/i ? '\\' : '/');
-    my $info_file = "t${sep}snmptest.cmd";
-    my $snmpd_path1 = "${prefix}${sep}sbin";
-    my $snmpd_path2 = "${sep}usr${sep}sbin";
-    my $snmpd_path3 = "${sep}usr${sep}bin";
+    my $info_file = File::Spec->catfile("t", "snmptest.cmd");
 
     open(H, ">$info_file") || die "Error: could not open file '$info_file'($!)";
 
     my ($mibdir, $snmpd, $snmptrapd);
 
-        # Windows
-        if ($Config{'osname'} eq 'MSWin32' && $ENV{'OSTYPE'} eq '') {
-          my $win32_snmpd_path = $ENV{'NET-SNMP-PATH'} . $sep . "bin";
-          if (lc ($opts->{'insource'}) eq "true") {
-            $mibdir = "../../mibs";
-            if (lc($opts->{'debug'}) eq "true") {
-              $snmpd = "../../win32/bin/debug";
-              $snmptrapd = "../../win32/bin/debug";
-            }
-            else {
-              $snmpd = "../../win32/bin/release";
-              $snmptrapd = "../../win32/bin/release";
-            }
-          } else {
-            $mibdir = $ENV{'NET-SNMP-PATH'} . "${sep}share${sep}snmp${sep}mibs";
+    # Windows
+    if ($Config{'osname'} eq 'MSWin32' && !defined($ENV{'OSTYPE'})) {
+	if (lc ($opts->{'insource'}) eq "true") {
+            $mibdir = abs_path("../../mibs");
+	    my $cfg = lc($opts->{'debug'}) eq "true" ? "debug" : "release";
+	    $snmpd = abs_path("../../win32/bin/$cfg/snmpd.exe");
+	    $snmptrapd = abs_path("../../win32/bin/$cfg/snmptrapd.exe");
+	} else {
+	    my $win32_snmpd_path = File::Spec->catdir($ENV{'NET-SNMP-PATH'},
+						      "bin");
+            $mibdir = File::Spec->catdir($ENV{'NET-SNMP-PATH'}, "share",
+					 "snmp", "mibs");
             $snmpd = find_files(["snmpd.exe"], [$win32_snmpd_path]);
             $snmptrapd = find_files(["snmptrapd.exe"], [$win32_snmpd_path]);
-          }
-        }
-
-        # Unix
-        else {
-          if (lc($opts->{'insource'}) eq "true") {
-            $mibdir = "../../mibs";
-            $snmpd = "../../agent/snmpd";
-            $snmptrapd = "../../apps/snmptrapd";
-          } else {
-            $mibdir = "${prefix}${sep}share${sep}snmp${sep}mibs";
+	}
+    }
+    # Unix
+    else {
+	if (lc($opts->{'insource'}) eq "true") {
+            $mibdir = abs_path("../../mibs");
+            $snmpd = abs_path("../../agent/snmpd");
+            $snmptrapd = abs_path("../../apps/snmptrapd");
+	} else {
+            croak "\$prefix has not been set" if (!defined($prefix));
+            $mibdir = "${prefix}/share/snmp/mibs";
+            my $snmpd_path1 = abs_path("${prefix}/sbin");
+            my $snmpd_path2 = "/usr/sbin";
             $snmpd = find_files(["snmpd"], [$snmpd_path1, $snmpd_path2]);
             $snmptrapd = find_files(["snmptrapd"], [$snmpd_path1, $snmpd_path2]);
-          }
-        }
+	}
+    }
 
-	$mibdir = find_files(["NET-SNMP-MIB.txt"],[$mibdir]);
+    $mibdir = find_files(["NET-SNMP-MIB.txt"], [$mibdir]);
 
-	$mibdir ||= prompt("Unable to locate the MIBs, Please enter the path: ",
-			   $mibdir);
-	$snmpd ||= prompt("Unable to locate \"snmpd\". Please enter the path: ",
-			  $snmpd_path1);
-	$snmptrapd ||=
-	    prompt("Unable to locate \"snmptrapd\". Please enter the path: ",
-		   $snmpd_path1);
-
-        if ($Config{'osname'} eq 'MSWin32' && $ENV{'OSTYPE'} eq '') {
-          $snmpd = $snmpd . $sep . "snmpd.exe";
-          $snmptrapd = $snmptrapd . $sep . "snmptrapd.exe";
-        }
-        else {
-          if ($ENV{'OSTYPE'} eq 'msys') {
-            $snmpd =~ s/snmpd$/snmpd.exe/;
-            $snmptrapd =~ s/snmptrapd$/snmptrapd.exe/;
-          }
-          else
-          {
-            $snmpd =~ s/($sep)?(snmpd)?$/${sep}snmpd/;
-            $snmptrapd =~ s/($sep)?(snmptrapd)?$/${sep}snmptrapd/;
-          }
-        }
-
-	print H "SNMPD => $snmpd\n";
-	print H "SNMPTRAPD => $snmptrapd\n";
-	print H "MIBDIR => $mibdir\n";
-
-	if (!(lc($opts->{'insource'}) eq "true")) {
-	    if (-e $snmpd and -r $snmpd) {
-		if (not -x $snmpd) {
-		    warn("Error: $snmpd not executable. 'make test' will not work.\n");
-		}
-	    } else {
-		warn("Error: $snmpd does not exist or is unreadable. 'make test' will not work.\n");
+    $mibdir ||= prompt("Unable to locate the MIBs, Please enter the path: ",
+		       $mibdir);
+    $snmpd ||= prompt("Unable to locate \"snmpd\". Please enter the path: ");
+    $snmptrapd ||=
+	prompt("Unable to locate \"snmptrapd\". Please enter the path: ");
+
+    print H "SNMPD => $snmpd\n";
+    print H "SNMPTRAPD => $snmptrapd\n";
+    print H "MIBDIR => $mibdir\n";
+
+    if (!(lc($opts->{'insource'}) eq "true")) {
+	if (-e $snmpd and -r $snmpd) {
+	    if (not -x $snmpd) {
+		warn("Error: $snmpd not executable. 'make test' will not work.\n");
 	    }
+	} else {
+	    warn("Error: $snmpd does not exist or is unreadable. 'make test' will not work.\n");
+	}
 
-	    if (-e $snmptrapd and -r $snmptrapd) {
-		if (not -x $snmptrapd) {
-		    warn("Error: $snmptrapd not executable. 'make test' will not work.\n");
-		}
-	    } else {
-		warn("Error: $snmptrapd does not exist or is unreadable. 'make test' will not work.\n");
+	if (-e $snmptrapd and -r $snmptrapd) {
+	    if (not -x $snmptrapd) {
+		warn("Error: $snmptrapd not executable. 'make test' will not work.\n");
 	    }
+	} else {
+	    warn("Error: $snmptrapd does not exist or is unreadable. 'make test' will not work.\n");
 	}
-# end of else
+    }
     close H;
 }
 
diff -urpN net-snmp-5.8/perl/SNMP/README net-snmp-5.9.1/perl/SNMP/README
--- net-snmp-5.8/perl/SNMP/README	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/README	2021-05-26 05:19:35.000000000 +0700
@@ -142,16 +142,7 @@ Installation:
    C++ 6.0 and Microsoft Microsoft Development Environment 2003/2003 
    (MSVC 7.0/7.1).  See the following sections for Cygwin and MinGW.
 
-   ActiveState Perl is required.  
-
-   Note: With ActiveState Perl (currently at 5.8.2 build 808) and possibly other 
-         versions of Perl on Windows, if a Perl script modifies a
-         system environment variable and then calls a C function, the
-         C function will not see the new environment variable.  This
-         problem can be seen with the failure of test #3 in the SNMP
-         conf test (perl/SNMP/t/conf.t).  The change to the
-         SNMPCONFPATH env variable is not seen by the calls to the C
-         SNMP module.
+   Perl binaries build with MSVC++ are required.
 
    Note: The source code should *not* be in a folder that contains a space.  For
          example, compiling in your 'My Documents' or your Desktop (usually
@@ -294,94 +285,9 @@ Installation:
          example, compiling in your 'My Documents' or your Desktop (usually
          c:\Documents and Settings\xxxx\Desktop) is not supported.
           
-   These directions are for MinGW 3.1.0 with MSYS 1.0.9 and ActiveState Perl.
-   Compiling the Perl modules using a MinGW built Perl environment has not
-   been tested.
-
-   Note: With ActiveState Perl (currently at 5.8.2 build 808) and
-         possibly other versions of Perl on Windows, if a Perl script
-         modifies a system environment variable and then calls a C
-         function, the C function will not see the new environment
-         variable.  This problem can be seen with the failure of test
-         #3 in the SNMP conf test (perl/SNMP/t/conf.t).  The change to
-         the SNMPCONFPATH env variable is not seen by the calls to the
-         C SNMP module.
-
-   The main Net-SNMP package must be compiled with the regex library.  
-   See Net-SNMP README.win32 for compiling with MinGW.
-
-   The following additional software is required:
-
-    dmake:
-    http://www.cpan.org/authors/id/GSAR/dmake-4.1pl1-win32.zip  
-
-    ExtUtils-FakeConfig:
-    http://search.cpan.org/~mbarbon/ExtUtils-FakeConfig-0.05/
-
-   Note: A PPM package is available from ActiveState for
-          ExtUtils-FakeConfig, but it does not include the
-          make_implib.pl script.  Downloading from CPAN is
-          recommended.
-
-   Installing DMAKE and ExtUtils-FakeConfig:
-   -----------------------------------------
-
-   1.  Install DMAKE as described in the README.NOW contained in the DMAKE .ZIP 
-       file ensuring the DMAKE program can be found in the system path.
-
-   2.  Extract ExtUtils-FakeConfig-0.05.zip to a temporary folder.
-
-   3.  Add the MinGW bin folder to your system path.
-
-   4.  Open a Windows command prompt (cmd) and cd into
-       ExtUtils-FakeConfig-0.05 and typet he following to build and
-       install the ExtUtils-FakeConfig module:
-
-       perl Makefile.PL
-       dmake
-       dmake install
-
-   5.  A Perl import library needs to be created using the ExtUtils-FakeConfig 
-       make_implib.pl script.  
-
-       For ActiveState Perl 5.6.x installed to c:\Perl, type the
-       following on one line:
-
-         perl script/make_implib.pl --output-dir=C:/Perl/lib/CORE 
-           --output-lib=libperl56.a --target=mingw c:/Perl/bin/Perl56.dll
-
-       For ActiveState Perl 5.8.x installed to c:\Perl, type the
-       following on one line:
-
-         perl script/make_implib.pl --output-dir=C:/Perl/lib/CORE 
-           --output-lib=libperl58.a --target=mingw c:/Perl/bin/Perl58.dll
-
-
-Building the Perl module:
--------------------------
-
-   1.  Complete the section titled 'Installing DMAKE and ExtUtils-FakeConfig'
-
-   2.  Open an MSYS shell and cd into the net-snmp/Perl folder and type the 
-       following on one line:
-
-         perl -MConfig_m Makefile.PL -NET-SNMP-IN-SOURCE=true DEFINE=-DMINGW_PERL
-
-   3.  Open a Windows command prompt (cmd) and cd into the net-snmp/perl folder 
-       and type:
-
-         dmake
-         dmake test
-         dmake install
-
-       Note:  'dmake test' will automatically start and stop the agent(snmpd) and 
-              trap receiver (snmptrapd) while testing the SNMP module.  
-
-   4.  Remove the MinGW bin folder to your system path if it was not already in
-       your path for step 3 of 'Installing DMAKE and ExtUtils-FakeConfig'.
-
 
-   Operational Description:
+Operational Description:
+------------------------
 
    The basic operations of the SNMP protocol are provided by this module
    through an object oriented interface for modularity and ease of use.
diff -urpN net-snmp-5.8/perl/SNMP/SNMP.pm net-snmp-5.9.1/perl/SNMP/SNMP.pm
--- net-snmp-5.8/perl/SNMP/SNMP.pm	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/SNMP.pm	2021-05-26 05:19:35.000000000 +0700
@@ -7,7 +7,7 @@
 #     modify it under the same terms as Perl itself.
 
 package SNMP;
-$VERSION = '5.08';   # current release version number
+$VERSION = '5.0901';   # current release version number
 
 use strict;
 use warnings;
@@ -1185,7 +1185,7 @@ sub trap {
      $varbind_list_ref = $vars if ref($$vars[0]) =~ /ARRAY/;
    }
 
-   if ($this->{Version} eq '1') {
+   if ($this->{Version} =~ '^1') {
        my $enterprise = $param{enterprise} || 'ucdavis';
        $enterprise = SNMP::translateObj($enterprise)
 	   unless $enterprise =~ /^[\.\d]+$/;
@@ -1200,6 +1200,8 @@ sub trap {
        my $trap_oid = $param{oid} || $param{trapoid} || '.0.0';
        my $uptime = $param{uptime} || SNMP::_sys_uptime();
        @res = SNMP::_trapV2($this, $uptime, $trap_oid, $varbind_list_ref);
+   } else {
+     warn("error:trap: Unsupported SNMP version " . $this->{Version} . "\n");
    }
 
    return(wantarray() ? @res : $res[0]);
@@ -1234,7 +1236,7 @@ sub inform {
    my $trap_oid = $param{oid} || $param{trapoid};
    my $uptime = $param{uptime} || SNMP::_sys_uptime();
 
-   if($this->{Version} eq '3') {
+   if ($this->{Version} =~ '^[23]') {
      @res = SNMP::_inform($this, $uptime, $trap_oid, $varbind_list_ref, $cb);
    } else {
      warn("error:inform: This version doesn't support the command\n");
@@ -1661,7 +1663,9 @@ The default is 'noAuthNoPriv'.
 =item SecEngineId
 
 The SNMPv3 security engineID to use (if the snmpv3 security model
-needs it; for example USM).
+needs it; for example USM). The format is as a string without the leading '0x'.
+So if snmptrapd.conf has C<-e 0x8000000001020304>, use C<< SecEngineId =>
+'8000000001020304' >>.
 
 The default is <none>, security engineID and it will be probed if not
 supplied (v3)
diff -urpN net-snmp-5.8/perl/SNMP/SNMP.xs net-snmp-5.9.1/perl/SNMP/SNMP.xs
--- net-snmp-5.8/perl/SNMP/SNMP.xs	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/SNMP.xs	2021-05-26 05:19:35.000000000 +0700
@@ -7,10 +7,6 @@
      This program is free software; you can redistribute it and/or
      modify it under the same terms as Perl itself.
 */
-#define WIN32SCK_IS_STDSCK
-#if defined(_WIN32) && !defined(_WIN32_WINNT)
-#define _WIN32_WINNT 0x501
-#endif
 
 #include "EXTERN.h"
 #include "perl.h"
@@ -121,10 +117,6 @@ static struct tree * __tag2oid _((char *
 static int __concat_oid_str _((oid *, size_t *, char *));
 static int __add_var_val_str _((netsnmp_pdu *, oid *, size_t, char *,
                                  int, int));
-static int __send_sync_pdu _((netsnmp_session *, netsnmp_pdu *,
-                              netsnmp_pdu **, int , SV *, SV *, SV *));
-static int __snmp_xs_cb __P((int, netsnmp_session *, int,
-                             netsnmp_pdu *, void *));
 static SV* __push_cb_args2 _((SV * sv, SV * esv, SV * tsv));
 #define __push_cb_args(a,b) __push_cb_args2(a,b,NULL)
 static int __call_callback _((SV * sv, int flags));
@@ -177,7 +169,7 @@ static int _bulkwalk_async_cb _((int op,
 				     netsnmp_pdu *pdu, void *context_ptr));
 
 /* Prototype for error handler */
-void snmp_return_err( struct snmp_session *ss, SV *err_str, SV *err_num, SV *err_ind );
+void snmp_return_err(void *ss, SV *err_str, SV *err_num, SV *err_ind);
 
 /* Structure to hold valid context sessions. */
 struct valid_contexts {
@@ -979,8 +971,7 @@ __add_var_val_str(pdu, name, name_length
     }
 
     vars->next_variable = NULL;
-    vars->name = netsnmp_malloc(name_length * sizeof(oid));
-    memcpy((char *)vars->name, (char *)name, name_length * sizeof(oid));
+    vars->name = netsnmp_memdup(name, name_length * sizeof(oid));
     vars->name_length = name_length;
     switch (type) {
       case TYPE_INTEGER:
@@ -1030,23 +1021,19 @@ as_uint:
       case TYPE_OPAQUE:
         vars->type = ASN_OCTET_STR;
 as_oct:
-        vars->val.string = netsnmp_malloc(len);
+        vars->val.string = netsnmp_memdup(val && len ? val : "", len ? len : 1);
         vars->val_len = len;
-        if (val && len)
-            memcpy((char *)vars->val.string, val, len);
-        else {
+        if (!val)
             ret = FAILURE;
-            vars->val.string = (u_char *) netsnmp_strdup("");
-            vars->val_len = 0;
-        }
         break;
 
       case TYPE_IPADDR:
         vars->type = ASN_IPADDRESS;
-        vars->val.integer = netsnmp_malloc(sizeof(in_addr_t));
-        if (val)
-            *((in_addr_t *)vars->val.integer) = inet_addr(val);
-        else {
+        if (val) {
+            const in_addr_t addr = inet_addr(val);
+
+            vars->val.integer = netsnmp_memdup(&addr, sizeof(addr));
+        } else {
             ret = FAILURE;
             *(vars->val.integer) = 0;
         }
@@ -1063,8 +1050,7 @@ as_oct:
 	    ret = FAILURE;
         } else {
             vars->val_len *= sizeof(oid);
-            vars->val.objid = netsnmp_malloc(vars->val_len);
-            memcpy((char *)vars->val.objid, (char *)oidbuf, vars->val_len);
+            vars->val.objid = netsnmp_memdup(oidbuf, vars->val_len);
         }
         break;
 
@@ -1081,15 +1067,9 @@ as_oct:
 /* takes ss and pdu as input and updates the 'response' argument */
 /* the input 'pdu' argument will be freed */
 static int
-__send_sync_pdu(ss, pdu, response, retry_nosuch,
-	        err_str_sv, err_num_sv, err_ind_sv)
-netsnmp_session *ss;
-netsnmp_pdu *pdu;
-netsnmp_pdu **response;
-int retry_nosuch;
-SV * err_str_sv;
-SV * err_num_sv;
-SV * err_ind_sv;
+__send_sync_pdu(void *ss, netsnmp_pdu *pdu, netsnmp_pdu **response,
+                int retry_nosuch, SV *err_str_sv, SV *err_num_sv,
+                SV *err_ind_sv)
 {
    int status;
    long command = pdu->command;
@@ -1162,12 +1142,8 @@ retry:
 }
 
 static int
-__snmp_xs_cb (op, ss, reqid, pdu, cb_data)
-int op;
-netsnmp_session *ss;
-int reqid;
-netsnmp_pdu *pdu;
-void *cb_data;
+__snmp_xs_cb(int op, netsnmp_session *ss, int reqid, netsnmp_pdu *pdu,
+             void *cb_data)
 {
   SV *varlist_ref;
   AV *varlist;
@@ -1227,12 +1203,8 @@ void *cb_data;
         reply_pdu->command = SNMP_MSG_RESPONSE;
         reply_pdu->reqid = pdu->reqid;
         reply_pdu->errstat = reply_pdu->errindex = 0;
-	if(api_mode == SNMP_API_SINGLE)
-	{
-        	snmp_sess_send(ss, reply_pdu);
-	} else {
-	        snmp_send(ss, reply_pdu);
-	}
+        if (!snmp_send(ss, reply_pdu))
+            snmp_free_pdu(reply_pdu);
       } else {
         warn("Couldn't clone PDU for inform response");
       }
@@ -1764,7 +1736,7 @@ _bulkwalk_send_pdu(walk_context *context
    */
 
    SV **sess_ptr_sv = hv_fetch((HV*)SvRV(context->sess_ref), "SessPtr", 7, 1);
-   netsnmp_session *ss = (SnmpSession *)SvIV((SV*)SvRV(*sess_ptr_sv));
+   void *ss = (void *)SvIV((SV*)SvRV(*sess_ptr_sv));
    SV **err_str_svp = hv_fetch((HV*)SvRV(context->sess_ref), "ErrorStr", 8, 1);
    SV **err_num_svp = hv_fetch((HV*)SvRV(context->sess_ref), "ErrorNum", 8, 1);
    SV **err_ind_svp = hv_fetch((HV*)SvRV(context->sess_ref), "ErrorInd", 8, 1);
@@ -2466,7 +2438,7 @@ not_there:
   snmp_error or snmp_sess_error to populate ErrorStr,ErrorNum, and ErrorInd
   in SNMP::Session objects
 */
-void snmp_return_err( struct snmp_session *ss, SV *err_str, SV *err_num, SV *err_ind )
+void snmp_return_err(void *ss, SV *err_str, SV *err_num, SV *err_ind)
 {
 	int err;
 	int liberr;
@@ -2552,7 +2524,7 @@ snmp_new_session(version, community, pee
 	CODE:
 	{
 	   SnmpSession session = {0};
-	   SnmpSession *ss = NULL;
+	   void *ss = NULL;
            int verbose = SvIV(perl_get_sv("SNMP::verbose", 0x01 | 0x04));
 
            snmp_sess_init(&session);
@@ -2631,8 +2603,9 @@ snmp_new_v3_session(version, peer, retri
 	CODE:
 	{
 	   SnmpSession session = {0};
-	   SnmpSession *ss = NULL;
+	   void *ss = NULL;
            int verbose = SvIV(perl_get_sv("SNMP::verbose", 0x01 | 0x04));
+           int auth_type, priv_type;
 
            snmp_sess_init(&session);
 
@@ -2664,25 +2637,25 @@ snmp_new_v3_session(version, peer, retri
                              (char **) &session.contextEngineID);
            session.engineBoots = eng_boots;
            session.engineTime = eng_time;
-#ifndef NETSNMP_DISABLE_MD5
-           if (!strcmp(auth_proto, "MD5")) {
-               session.securityAuthProto = 
-                  snmp_duplicate_objid(usmHMACMD5AuthProtocol,
-                                          OID_LENGTH(usmHMACMD5AuthProtocol));
-              session.securityAuthProtoLen = OID_LENGTH(usmHMACMD5AuthProtocol);
-           } else
-#endif
-               if (!strcmp(auth_proto, "SHA")) {
-               session.securityAuthProto = 
-                   snmp_duplicate_objid(usmHMACSHA1AuthProtocol,
-                                        OID_LENGTH(usmHMACSHA1AuthProtocol));
-              session.securityAuthProtoLen = OID_LENGTH(usmHMACSHA1AuthProtocol);
-           } else if (!strcmp(auth_proto, "DEFAULT")) {
+           /* NETSNMP_USMAUTH_* */
+           auth_type = usm_lookup_auth_type(auth_proto);
+           if (auth_type >= 0) {
+               const netsnmp_auth_alg_info *auth_alg_info =
+                   sc_find_auth_alg_bytype(auth_type);
+               if (auth_alg_info) {
+                   session.securityAuthProto = 
+                       snmp_duplicate_objid(auth_alg_info->alg_oid,
+                                            auth_alg_info->oid_len);
+                   session.securityAuthProtoLen = auth_alg_info->oid_len;
+               }
+           }
+           if (strcmp(auth_proto, "DEFAULT") == 0) {
                const oid *theoid =
                    get_default_authtype(&session.securityAuthProtoLen);
                session.securityAuthProto = 
                    snmp_duplicate_objid(theoid, session.securityAuthProtoLen);
-           } else {
+           }
+           if (session.securityAuthProto == NULL) {
               if (verbose)
                  warn("error:snmp_new_v3_session:Unsupported authentication protocol(%s)\n", auth_proto);
               goto end;
@@ -2714,25 +2687,24 @@ snmp_new_v3_session(version, peer, retri
                    }
                }
            }
-#ifndef NETSNMP_DISABLE_DES
-           if (!strcmp(priv_proto, "DES")) {
-              session.securityPrivProto =
-                  snmp_duplicate_objid(usmDESPrivProtocol,
-                                       OID_LENGTH(usmDESPrivProtocol));
-              session.securityPrivProtoLen = OID_LENGTH(usmDESPrivProtocol);
-           } else
-#endif
-               if (!strncmp(priv_proto, "AES", 3)) {
-              session.securityPrivProto =
-                  snmp_duplicate_objid(usmAESPrivProtocol,
-                                       OID_LENGTH(usmAESPrivProtocol));
-              session.securityPrivProtoLen = OID_LENGTH(usmAESPrivProtocol);
-           } else if (!strcmp(priv_proto, "DEFAULT")) {
+           priv_type = usm_lookup_priv_type(priv_proto);
+           if (priv_type >= 0) {
+               const netsnmp_priv_alg_info *priv_alg_info =
+                   sc_get_priv_alg_bytype(priv_type);
+               if (priv_alg_info) {
+                   session.securityPrivProto =
+                       snmp_duplicate_objid(priv_alg_info->alg_oid,
+                                            priv_alg_info->oid_len);
+                   session.securityPrivProtoLen = priv_alg_info->oid_len;
+               }
+           }
+           if (strcmp(priv_proto, "DEFAULT") == 0) {
                const oid *theoid =
                    get_default_privtype(&session.securityPrivProtoLen);
                session.securityPrivProto = 
                    snmp_duplicate_objid(theoid, session.securityPrivProtoLen);
-           } else {
+           }
+           if (session.securityPrivProto == NULL) {
               if (verbose)
                  warn("error:snmp_new_v3_session:Unsupported privacy protocol(%s)\n", priv_proto);
               goto end;
@@ -3058,7 +3030,7 @@ snmp_set(sess_ref, varlist_ref, perl_cal
            AV *varbind;
 	   I32 varlist_len;
 	   I32 varlist_ind;
-           SnmpSession *ss;
+           void *ss;
            netsnmp_pdu *pdu, *response;
            struct tree *tp;
 	   oid *oid_arr;
@@ -3211,6 +3183,7 @@ snmp_catch(sess_ref, perl_callback)
         SV *    perl_callback
 	PPCODE:
 	{
+           void *sess_ptr;
 	   netsnmp_session *ss;
            SV **sess_ptr_sv;
            SV **err_str_svp;
@@ -3219,7 +3192,7 @@ snmp_catch(sess_ref, perl_callback)
 
            if (SvROK(sess_ref)) {
               sess_ptr_sv = hv_fetch((HV*)SvRV(sess_ref), "SessPtr", 7, 1);
-	      ss = (SnmpSession *)SvIV((SV*)SvRV(*sess_ptr_sv));
+	      sess_ptr = (void *)SvIV((SV*)SvRV(*sess_ptr_sv));
               err_str_svp = hv_fetch((HV*)SvRV(sess_ref), "ErrorStr", 8, 1);
               err_num_svp = hv_fetch((HV*)SvRV(sess_ref), "ErrorNum", 8, 1);
               err_ind_svp = hv_fetch((HV*)SvRV(sess_ref), "ErrorInd", 8, 1);
@@ -3227,6 +3200,8 @@ snmp_catch(sess_ref, perl_callback)
               sv_setiv(*err_num_svp, 0);
               sv_setiv(*err_ind_svp, 0);
 
+              ss = api_mode == SNMP_API_SINGLE ? snmp_sess_session(sess_ptr) :
+                  sess_ptr;
               ss->callback = NULL;
               ss->callback_magic = NULL;
 
@@ -3264,7 +3239,7 @@ snmp_get(sess_ref, retry_nosuch, varlist
            AV *varbind;
            I32 varlist_len;
            I32 varlist_ind;
-           netsnmp_session *ss;
+           void *ss;
            netsnmp_pdu *pdu, *response;
            netsnmp_variable_list *vars;
            struct tree *tp;
@@ -3490,7 +3465,7 @@ snmp_getnext(sess_ref, varlist_ref, perl
            AV *varbind;
            I32 varlist_len;
            I32 varlist_ind;
-           netsnmp_session *ss;
+           void *ss;
            netsnmp_pdu *pdu, *response;
            netsnmp_variable_list *vars;
            struct tree *tp;
@@ -3742,7 +3717,7 @@ snmp_getbulk(sess_ref, nonrepeaters, max
            AV *varbind;
 	   I32 varlist_len;
 	   I32 varlist_ind;
-           netsnmp_session *ss;
+           void *ss;
            netsnmp_pdu *pdu, *response;
            netsnmp_variable_list *vars;
            struct tree *tp;
@@ -3981,7 +3956,7 @@ snmp_bulkwalk(sess_ref, nonrepeaters, ma
            AV *varbind;
 	   I32 varlist_len;
 	   I32 varlist_ind;
-           netsnmp_session *ss;
+           void *ss;
            netsnmp_pdu *pdu = NULL;
 	   oid oid_arr[MAX_OID_LEN];
 	   size_t oid_arr_len;
@@ -4291,7 +4266,7 @@ snmp_trapV1(sess_ref,enterprise,agent,ge
            AV *varbind;
 	   I32 varlist_len;
 	   I32 varlist_ind;
-           SnmpSession *ss;
+           void *ss;
            netsnmp_pdu *pdu = NULL;
            struct tree *tp;
 	   oid *oid_arr;
@@ -4435,7 +4410,7 @@ snmp_trapV2(sess_ref,uptime,trap_oid,var
            AV *varbind;
 	   I32 varlist_len;
 	   I32 varlist_ind;
-           SnmpSession *ss;
+           void *ss;
            netsnmp_pdu *pdu = NULL;
            struct tree *tp;
 	   oid *oid_arr;
@@ -4581,7 +4556,7 @@ snmp_inform(sess_ref,uptime,trap_oid,var
            AV *varbind;
 	   I32 varlist_len;
 	   I32 varlist_ind;
-           SnmpSession *ss;
+           void *ss;
            netsnmp_pdu *pdu = NULL;
            netsnmp_pdu *response;
            struct tree *tp;
@@ -4978,7 +4953,7 @@ snmp_main_loop(timeout_sec,timeout_usec,
 	int 	timeout_sec
 	int 	timeout_usec
 	SV *	perl_callback
-	SnmpSession *ss
+	void *  ss
 	CODE:
 	{
         int numfds, fd_count;
@@ -5215,11 +5190,11 @@ snmp_mib_node_FETCH(tp_ref, key)
                     mib_hv = perl_get_hv("SNMP::MIB", FALSE);
                     if (SvMAGICAL(mib_hv)) mg = mg_find((SV*)mib_hv, 'P');
                     if (mg) mib_tied_href = (SV*)mg->mg_obj;
-                    next_node_href = newRV((SV*)newHV());
                     __tp_sprint_num_objid(str_buf, tp);
                     nn_hrefp = hv_fetch((HV*)SvRV(mib_tied_href),
                                         str_buf, strlen(str_buf), 1);
                     if (!SvROK(*nn_hrefp)) {
+                       next_node_href = newRV((SV*)newHV());
                        sv_setsv(*nn_hrefp, next_node_href);
                        ENTER ;
                        SAVETMPS ;
@@ -5344,11 +5319,11 @@ snmp_mib_node_FETCH(tp_ref, key)
                  mib_hv = perl_get_hv("SNMP::MIB", FALSE);
                  if (SvMAGICAL(mib_hv)) mg = mg_find((SV*)mib_hv, 'P');
                  if (mg) mib_tied_href = (SV*)mg->mg_obj;
-                 next_node_href = newRV((SV*)newHV());
                  __tp_sprint_num_objid(str_buf, tp);
                  nn_hrefp = hv_fetch((HV*)SvRV(mib_tied_href),
                                      str_buf, strlen(str_buf), 1);
                  if (!SvROK(*nn_hrefp)) {
+                 next_node_href = newRV((SV*)newHV());
                  sv_setsv(*nn_hrefp, next_node_href);
                  ENTER ;
                  SAVETMPS ;
@@ -5466,7 +5441,7 @@ snmp_session_DESTROY(sess_ptr)
 	{
  	 if(api_mode == SNMP_API_SINGLE)
 	 {
-           snmp_sess_close( sess_ptr );
+           snmp_sess_close( (struct session_list *) sess_ptr );
 	 } else { 
            snmp_close( sess_ptr );
 	 }
diff -urpN net-snmp-5.8/perl/SNMP/netsnmp-feature-definitions.h net-snmp-5.9.1/perl/SNMP/netsnmp-feature-definitions.h
--- net-snmp-5.8/perl/SNMP/netsnmp-feature-definitions.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/netsnmp-feature-definitions.h	2021-05-26 05:19:35.000000000 +0700
@@ -1,8 +1,8 @@
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-features.h>
 
-netsnmp_feature_require(snprint_objid)
-netsnmp_feature_require(snprint_value)
-netsnmp_feature_require(find_module)
-netsnmp_feature_require(get_tc_description)
+netsnmp_feature_require(snprint_objid);
+netsnmp_feature_require(snprint_value);
+netsnmp_feature_require(find_module);
+netsnmp_feature_require(get_tc_description);
 
diff -urpN net-snmp-5.8/perl/SNMP/t/async.t net-snmp-5.9.1/perl/SNMP/t/async.t
--- net-snmp-5.8/perl/SNMP/t/async.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/t/async.t	2021-05-26 05:19:35.000000000 +0700
@@ -1,20 +1,15 @@
 #!./perl
+
+use strict;
+use warnings;
+
 BEGIN {
-    unless(grep /blib/, @INC) {
-        chdir 't' if -d 't';
-        @INC = '../lib' if -d '../lib';
-    }
     eval "use Cwd qw(abs_path)";
-    $ENV{'SNMPCONFPATH'} = 'nopath';
-    $ENV{'MIBDIRS'} = '+' . abs_path("../../mibs");
-
-    $skipped_tests = ($^O =~ /win32/i) ? 20 : 0;
 }
 
 use Test;
-BEGIN {plan tests => 20 - $skipped_tests}
+BEGIN {plan tests => ($^O =~ /win32/i) ? 0 : 20}
 use SNMP;
-use vars qw($agent_port $comm $agent_host);
 
 if ($^O =~ /win32/i) {
   warn "Win32/Win64 detected - skipping async calls\n";
@@ -22,6 +17,7 @@ if ($^O =~ /win32/i) {
 }
 
 require "t/startagent.pl";
+use vars qw($agent_host $agent_port $comm);
 
 
 sub cb1; # forward reference
diff -urpN net-snmp-5.8/perl/SNMP/t/bulkwalk.t net-snmp-5.9.1/perl/SNMP/t/bulkwalk.t
--- net-snmp-5.8/perl/SNMP/t/bulkwalk.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/t/bulkwalk.t	2021-05-26 05:19:35.000000000 +0700
@@ -1,36 +1,25 @@
 #!./perl
 #
-# $Id$
-#
 # Test bulkwalk functionality.
 
-BEGIN {
-    unless(grep /blib/, @INC) {
-        chdir 't' if -d 't';
-        @INC = '../lib' if -d '../lib';
-    }
-    eval "use Cwd qw(abs_path)";
-    $ENV{'SNMPCONFPATH'} = 'nopath';
-    $ENV{'MIBDIRS'} = '+' . abs_path("../../mibs");
-    $skipped_tests = ($^O =~ /win32/i) ? 21 : 0;
-}
+use strict;
+use warnings;
+use Cwd qw(abs_path);
 use Test;
-BEGIN { $num = 62 - $skipped_tests; plan test => $num; }
+
+BEGIN { plan test => ($^O =~ /win32/i) ? 43 : 64; }
 
 use SNMP;
 
 require "t/startagent.pl";
-
-use vars qw($agent_port $comm2 $agent_host);
+use vars qw($agent_host $agent_port $comm2);
 
 $SNMP::debugging = 0;
 $SNMP::verbose = 0;
 
-#print "1..$num\n";
-
 ######################################################################
 # Fire up a session.
-$s1 = new SNMP::Session(
+my $s1 = new SNMP::Session(
     'DestHost'   => $agent_host,
     'Community'  => $comm2,
     'RemotePort' => $agent_port,
@@ -43,14 +32,13 @@ ok(defined($s1));
 
 ######################################################################
 # 
-# Attempt to use the bulkwalk method to get a few variables from the
-# SNMP agent.
-# test 1
-$vars = new SNMP::VarList ( ['sysUpTime'], ['ifNumber'], # NON-repeaters
-			    ['ifSpeed'], ['ifDescr']);	 # Repeated variables.
+print("# Attempt to use the bulkwalk method to get a few variables from the SNMP agent.\n");
+print("# test 1\n");
+my $vars = new SNMP::VarList(['sysUpTime'], ['ifNumber'], # NON-repeaters
+			     ['ifSpeed'], ['ifDescr']);	 # Repeated variables.
 
-$expect = scalar @$vars;
-@list = $s1->bulkwalk(2, 16, $vars);
+my $expect = scalar @$vars;
+my @list = $s1->bulkwalk(2, 256, $vars);
 
 ok($s1->{ErrorNum} == 0);
 
@@ -59,10 +47,10 @@ ok($s1->{ErrorNum} == 0);
 ok(scalar @list == $expect);
 if (defined($list[0][0])) {
   # Sanity check the returned values.  list[0] is sysUptime nonrepeater.
-  ok($list[0][0]->tag eq ".1.3.6.1.2.1.1.3");	# check system.sysUptime OID
-  ok($list[0][0]->iid eq "0");			# check system.sysUptime.0 IID
+  ok($list[0][0]->tag, ".1.3.6.1.2.1.1.3");	# check system.sysUptime OID
+  ok($list[0][0]->iid, "0");			# check system.sysUptime.0 IID
   ok($list[0][0]->val =~ m/^\d+$/);		# Uptime is numeric 
-  ok($list[0][0]->type eq "TICKS");		# Uptime should be in ticks.
+  ok($list[0][0]->type, "TICKS");		# Uptime should be in ticks.
 }
 else {
   ok(0);
@@ -70,13 +58,14 @@ else {
   ok(0);
   ok(0);
 }
+my $ifaces = 0;
 if (defined($list[1][0])) {
   # Find out how many interfaces to expect.  list[1] is ifNumber nonrepeater.
-  ok($list[1][0]->tag eq ".1.3.6.1.2.1.2.1");	# Should be system.ifNumber OID.
-  ok($list[1][0]->iid eq "0");			# system.ifNumber.0 IID.
+  ok($list[1][0]->tag, ".1.3.6.1.2.1.2.1");	# Should be system.ifNumber OID.
+  ok($list[1][0]->iid, "0");			# system.ifNumber.0 IID.
   ok($list[1][0]->val =~ m/^\d+$/);		# Number is all numeric 
   #XXX: test fails due SMIv1 codes being returned intstead of SMIv2...
-  #ok($list[1][0]->type eq "INTEGER32");		# Number should be integer.
+  #ok($list[1][0]->type, "INTEGER32");		# Number should be integer.
 
   $ifaces = $list[1][0]->val;
 }
@@ -85,7 +74,9 @@ else {
   ok(0);
   ok(0);
 }
-    
+
+print("# Expecting $ifaces network interfaces.\n");
+
 # Make sure we got an ifSpeed for each interface.  list[2] is ifSpeed repeater.
 ok(scalar @{$list[2]} == $ifaces);
 # Make sure we got an ifDescr for each interface.  list[3] is ifDescr repeater.
@@ -93,10 +84,10 @@ ok(scalar @{$list[3]} == $ifaces);
 
 if (defined($list[2][0])) {
   # Test for reasonable values from the agent.
-  ok($list[2][0]->tag eq ".1.3.6.1.2.1.2.2.1.5");	# Should be system.ifSpeed OID.
-  ok($list[2][0]->iid eq "1");			# Instance should be 1.
+  ok($list[2][0]->tag, ".1.3.6.1.2.1.2.2.1.5");	# Should be system.ifSpeed OID.
+  ok($list[2][0]->iid, "1");			# Instance should be 1.
   ok($list[2][0]->val =~ m/^\d+$/);		# Number is all numeric 
-  ok($list[2][0]->type eq "GAUGE");		# Number should be a gauge.
+  ok($list[2][0]->type, "GAUGE");		# Number should be a gauge.
 }
 else {
   ok(0);
@@ -105,30 +96,23 @@ else {
   ok(0);
 }
 
-if (defined($list[3][0])) {
-  ok($list[3][0]->tag eq ".1.3.6.1.2.1.2.2.1.2");	# Should be system.ifDescr OID.
-  ok($list[3][0]->iid eq "1");			# Instance should be 1.
-
-  # The first interface is probably loopback.  Check this.
-  ok($list[3][0]->type eq "OCTETSTR");		# Description is a string.
-
-  # This might fail on systems that don't have lo0/loopback as their first
-  # interface. Please adjust accordingly.
-  $loopback = $list[3][0]->val;
-  if ($^O =~ /win32/i) {
-    ok(($loopback =~ /loopback/i));
-  } elsif ($^O =~ /(irix|hpux)/i) {
-    # IRIX/HP-UX may have lo0 at the *end* of the interface list,
-    # so just check for a non-empty string
-    ok(($loopback ne ''));
-  } elsif ($^O eq 'freebsd') {
-    $loopback = $list[3][-1]->val;
-    ok(($loopback =~ /^lo/));
-  } else {
-    ok(($loopback =~ /^lo/));
-  }
+print("# Looking up loopback network interface ...\n");
+ok(ref($list[3]), 'SNMP::VarList');
+my $found;
+for my $ifdescr (@{$list[3]}) {
+  ok(ref($ifdescr), 'SNMP::Varbind');
+  print("# " . $ifdescr->val . "\n");
+  next if (!($ifdescr->val =~ /Software Loopback Interface/) and
+	   !($ifdescr->val =~ /^lo/));
+  $found = $ifdescr->val;
+  ok(1);
+  ok($ifdescr->tag, ".1.3.6.1.2.1.2.2.1.2");	# Should be system.ifDescr OID.
+  ok($ifdescr->iid =~ m/^\d+$/);		# Instance should be 1.
+  ok($ifdescr->type, "OCTETSTR");		# Description is a string.
+  last;
 }
-else {
+if (!$found) {
+  ok(0);
   ok(0);
   ok(0);
   ok(0);
@@ -136,13 +120,12 @@ else {
 }
   
 ###############################################################################
-# Attempt to use the bulkwalk method to get only non-repeaters
-# test 2
+print("# Attempt to use the bulkwalk method to get only non-repeaters.\n");
+print("# test 2\n");
 $vars = new SNMP::VarList ( ['sysUpTime'], ['ifNumber'] ); # NON-repeaters
 
 $expect = scalar @$vars;
 @list = $s1->bulkwalk(2, 0, $vars);
-#@list = $s1->bulkwalk(2, 16, $vars);
 ok($s1->{ErrorNum} == 0);
 
 # Did we get back the list of references to returned values?
@@ -151,10 +134,10 @@ ok(scalar @list == $expect);
 
 if (defined($list[0][0])) {
   # Sanity check the returned values.  list[0] is sysUptime nonrepeater.
-  ok($list[0][0]->tag eq ".1.3.6.1.2.1.1.3");	# check system.sysUptime OID
-  ok($list[0][0]->iid eq "0");			# check system.sysUptime.0 IID
+  ok($list[0][0]->tag, ".1.3.6.1.2.1.1.3");	# check system.sysUptime OID
+  ok($list[0][0]->iid, "0");			# check system.sysUptime.0 IID
   ok($list[0][0]->val =~ m/^\d+$/);		# Uptime is numeric 
-  ok($list[0][0]->type eq "TICKS");		# Uptime should be in ticks.
+  ok($list[0][0]->type, "TICKS");		# Uptime should be in ticks.
 }
 else {
   ok(0);
@@ -165,11 +148,11 @@ else {
 
 if (defined($list[1][0])) {
   # Find out how many interfaces to expect.  list[1] is ifNumber nonrepeater.
-  ok($list[1][0]->tag eq ".1.3.6.1.2.1.2.1");	# Should be system.ifNumber OID.
-  ok($list[1][0]->iid eq "0");			# system.ifNumber.0 IID.
+  ok($list[1][0]->tag, ".1.3.6.1.2.1.2.1");	# Should be system.ifNumber OID.
+  ok($list[1][0]->iid, "0");			# system.ifNumber.0 IID.
   ok($list[1][0]->val =~ m/^\d+$/);		# Number is all numeric 
   #XXX: test fails due SMIv1 codes being returned intstead of SMIv2...
-  #ok($list[1][0]->type eq "INTEGER32");		# Number should be integer.
+  #ok($list[1][0]->type, "INTEGER32");		# Number should be integer.
   $ifaces = $list[1][0]->val;
 }
 else {
@@ -179,12 +162,12 @@ else {
 }
 
 ###############################################################################
-# Attempt to use the bulkwalk method to get only repeated variables
-# test 3
+print("# Attempt to use the bulkwalk method to get only repeated variables\n");
+print("# test 3\n");
 $vars = new SNMP::VarList ( ['ifIndex'], ['ifSpeed'] ); # repeaters
 
 $expect = scalar @$vars;
-@list = $s1->bulkwalk(0, 16, $vars);
+@list = $s1->bulkwalk(0, 256, $vars);
 ok($s1->{ErrorNum} == 0);
 
 # Did we get back the list of references to returned values?
@@ -199,11 +182,11 @@ ok(scalar @{$list[1]} == $ifaces);
 
 if (defined($list[0][0])) {
   # Test for reasonable values from the agent.
-  ok($list[0][0]->tag eq ".1.3.6.1.2.1.2.2.1.1");	# Should be system.ifIndex OID.
-  ok($list[0][0]->iid eq "1");			# Instance should be 1.
+  ok($list[0][0]->tag, ".1.3.6.1.2.1.2.2.1.1");	# Should be system.ifIndex OID.
+  ok($list[0][0]->iid, "1");			# Instance should be 1.
   ok($list[0][0]->val =~ m/^\d+$/);		# Number is all numeric 
   #XXX: test fails due SMIv1 codes being returned intstead of SMIv2...
-  #ok($list[0][0]->type eq "INTEGER32");		# Number should be an integer.
+  #ok($list[0][0]->type, "INTEGER32");		# Number should be an integer.
 }
 else {
   ok(0);
@@ -212,10 +195,10 @@ else {
 }
 
 if (defined($list[1][0])) {
-  ok($list[1][0]->tag eq ".1.3.6.1.2.1.2.2.1.5");	# Should be system.ifSpeed OID.
-  ok($list[1][0]->iid eq "1");			# Instance should be 1.
+  ok($list[1][0]->tag, ".1.3.6.1.2.1.2.2.1.5");	# Should be system.ifSpeed OID.
+  ok($list[1][0]->iid, "1");			# Instance should be 1.
   ok($list[1][0]->val =~ m/^\d+$/);		# Number is all numeric 
-  ok($list[1][0]->type eq "GAUGE");		# Number should be a gauge.
+  ok($list[1][0]->type, "GAUGE");		# Number should be a gauge.
 }
 else {
   ok(0);
@@ -228,9 +211,8 @@ else {
 #  Asynchronous Bulkwalk Methods
 ######################################################################
 # 
-# Attempt to use the bulkwalk method to get a few variables from the
-# SNMP agent.
-# test 4
+print("# Attempt to use the bulkwalk method to get a few variables from the SNMP agent.\n");
+print("# test 4\n");
 sub async_cb1 {
     my ($vars, $list) = @_;
     ok(defined $list && ref($list) =~ m/ARRAY/);
@@ -243,10 +225,10 @@ sub async_cb1 {
     if (defined($list->[0][0])) {
       # Sanity check the returned values.  First is sysUptime nonrepeater.
       $vbr = $list->[0][0];
-      ok($vbr->tag eq ".1.3.6.1.2.1.1.3");	# check system.sysUptime OID
-      ok($vbr->iid eq "0");			# check system.sysUptime.0 IID
+      ok($vbr->tag, ".1.3.6.1.2.1.1.3");	# check system.sysUptime OID
+      ok($vbr->iid, "0");			# check system.sysUptime.0 IID
       ok($vbr->val =~ m/^\d+$/);			# Uptime is numeric 
-      ok($vbr->type eq "TICKS");			# Uptime should be in ticks.
+      ok($vbr->type, "TICKS");			# Uptime should be in ticks.
     }
     else {
       ok(0);
@@ -258,11 +240,11 @@ sub async_cb1 {
     if (defined($list->[1][0])) {
       # Find out how many interfaces to expect.  Next is ifNumber nonrepeater.
       $vbr = $list->[1][0];
-      ok($vbr->tag eq ".1.3.6.1.2.1.2.1");	# Should be system.ifNumber OID.
-      ok($vbr->iid eq "0");			# system.ifNumber.0 IID.
+      ok($vbr->tag, ".1.3.6.1.2.1.2.1");	# Should be system.ifNumber OID.
+      ok($vbr->iid, "0");			# system.ifNumber.0 IID.
       ok($vbr->val =~ m/^\d+$/);			# Number is all numeric 
       #XXX: test fails due SMIv1 codes being returned intstead of SMIv2...
-      #    ok($vbr->type eq "INTEGER32");		# Number should be integer.
+      #    ok($vbr->type, "INTEGER32");		# Number should be integer.
       $ifaces = $vbr->[2];
     }
     else {
@@ -276,10 +258,10 @@ sub async_cb1 {
     
     if (defined($list->[2][0])) {
       $vbr = $list->[2][0];
-      ok($vbr->tag eq ".1.3.6.1.2.1.2.2.1.5");	# Should be ifSpeed OID
-      ok($vbr->iid eq "1");			# Instance should be 1.
+      ok($vbr->tag, ".1.3.6.1.2.1.2.2.1.5");	# Should be ifSpeed OID
+      ok($vbr->iid, "1");			# Instance should be 1.
       ok($vbr->val =~ m/^\d+$/);			# Number is all numeric 
-      ok($vbr->type eq "GAUGE");			# Should be a gauge.
+      ok($vbr->type, "GAUGE");			# Should be a gauge.
 
       ok(scalar @{$list->[3]} == $ifaces);
     }
@@ -290,29 +272,18 @@ sub async_cb1 {
       ok(0);
       ok(0);
     }
-  
-    if (defined($list->[3][0])) {
-      $vbr = $list->[3][0];
-      ok($vbr->tag eq ".1.3.6.1.2.1.2.2.1.2");	# Should be ifDescr OID
-      ok($vbr->iid eq "1");			# Instance should be 1.
-
-      # The first interface is probably loopback.  Check this.
-      ok($vbr->type eq "OCTETSTR");
-
-      # This might fail on systems that don't have lo0/loopback as their first
-      # interface. Please adjust accordingly.
-      if ($^O =~ /(irix|hpux)/i) {
-        # IRIX/HP-UX may have lo0 at the *end* of the interface list,
-        # so just check for a non-empty string
-        ok(($vbr->val ne ''));
-      } elsif ($^O eq 'freebsd') {
-        $vbr = $list->[3][-1];
-        ok(($vbr->val =~ /^lo/));
-      } else {
-        ok(($vbr->val =~ /^lo/));
-      }
+
+    for my $ifdescr (@{$list->[3]}) {
+      next if (!($ifdescr->val =~ /Software Loopback Interface/) and
+	       !($ifdescr->val =~ /^lo/));
+      ok(1);
+      # Should be system.ifDescr OID.
+      ok($ifdescr->tag, ".1.3.6.1.2.1.2.2.1.2");
+      ok($ifdescr->iid >= 1);			# Instance should be >= 1.
+      ok($ifdescr->type, "OCTETSTR");		# Description is a string.
+      last;
     }
-    else {
+    if (!defined($list->[3][0])) {
       ok(0);
       ok(0);
       ok(0);
@@ -329,7 +300,7 @@ if ($^O =~ /win32/i) {
   warn "Win32/Win64 detected - skipping async calls\n";
 }
 else {
-  @list = $s1->bulkwalk(2, 16, $vars, [ \&async_cb1, $vars ] );
+  @list = $s1->bulkwalk(2, 256, $vars, [ \&async_cb1, $vars ] );
   ok($s1->{ErrorNum} == 0);
   SNMP::MainLoop();
 }
diff -urpN net-snmp-5.8/perl/SNMP/t/conf.t net-snmp-5.9.1/perl/SNMP/t/conf.t
--- net-snmp-5.8/perl/SNMP/t/conf.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/t/conf.t	2021-05-26 05:19:35.000000000 +0700
@@ -1,10 +1,9 @@
 #!./perl
 
+use strict;
+use warnings;
+
 BEGIN {
-    unless(grep /blib/, @INC) {
-        chdir 't' if -d 't';
-        @INC = '../lib' if -d '../lib';
-    }
     $ENV{'MIBS'} = '';
 }
 
@@ -13,12 +12,11 @@ BEGIN {
 # serious problem because they linked with static libraries instead of
 # shared ones as the memory space is different.
 
+use Config;
 use Test;
 BEGIN {plan tests => 3}
 
-my $envsep = ($^O =~ /win32/i) ? ';' : ':';
-
-SNMP::setenv('SNMPCONFPATH', '.' . $envsep . 't', 1);
+SNMP::setenv('SNMPCONFPATH', '.' . $Config{path_sep} . 't', 1);
 
 ok(1); # just start up
 
@@ -26,8 +24,8 @@ use SNMP;
 use NetSNMP::default_store(':all');
 
 # should be 0, as it's un-initialized
-$myint = netsnmp_ds_get_int(NETSNMP_DS_LIBRARY_ID, 
-			    NETSNMP_DS_LIB_NUMERIC_TIMETICKS);
+my $myint = netsnmp_ds_get_int(NETSNMP_DS_LIBRARY_ID, 
+			       NETSNMP_DS_LIB_NUMERIC_TIMETICKS);
 
 ok($myint == 0);
 
diff -urpN net-snmp-5.8/perl/SNMP/t/dump-session.t net-snmp-5.9.1/perl/SNMP/t/dump-session.t
--- net-snmp-5.8/perl/SNMP/t/dump-session.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/t/dump-session.t	2021-05-26 05:19:35.000000000 +0700
@@ -1,23 +1,18 @@
 #!./perl
 
 use strict;
+use warnings;
 use Test;
 
 BEGIN {
-    unless(grep /blib/, @INC) {
-        chdir 't' if -d 't';
-        @INC = '../lib' if -d '../lib';
-    }
     eval "use Cwd qw(abs_path)";
-    $ENV{'SNMPCONFPATH'} = 'nopath';
-    $ENV{'MIBDIRS'} = '+' . abs_path("../../mibs");
     plan tests => 1;
 }
 
 use SNMP;
 use Data::Dumper;
-use vars qw($agent_port $comm $agent_host);
 require "t/startagent.pl";
+use vars qw($agent_host $agent_port $comm);
 
 # See also https://sourceforge.net/p/net-snmp/bugs/2488/
 
@@ -27,3 +22,5 @@ my $s = new SNMP::Session(DestHost=>$age
 print Dumper($s->get('anything'));
 
 ok(1);
+
+snmptest_cleanup();
diff -urpN net-snmp-5.8/perl/SNMP/t/get.t net-snmp-5.9.1/perl/SNMP/t/get.t
--- net-snmp-5.8/perl/SNMP/t/get.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/t/get.t	2021-05-26 05:19:35.000000000 +0700
@@ -1,19 +1,16 @@
 #!./perl
 
+use strict;
+use warnings;
+use Test;
+
 BEGIN {
-    unless(grep /blib/, @INC) {
-        chdir 't' if -d 't';
-        @INC = '../lib' if -d '../lib';
-    }
     eval "use Cwd qw(abs_path)";
-    $ENV{'SNMPCONFPATH'} = 'nopath';
-    $ENV{'MIBDIRS'} = '+' . abs_path("../../mibs");
+    plan tests => 17
 }
-use Test;
-BEGIN { $n = 17; plan tests => $n }
 use SNMP;
-use vars qw($agent_port $comm $agent_host);
 require "t/startagent.pl";
+use vars qw($agent_host $agent_port $comm);
 $SNMP::debugging = 0;
 $SNMP::verbose = 0;
 $SNMP::dump_packet = 0;
@@ -26,7 +23,7 @@ my $name = "gmarzot\@nortelnetworks.com"
 my $s1;
 
 # create list of varbinds for GETS, val field can be null or omitted
-$vars = new SNMP::VarList (
+my $vars = new SNMP::VarList(
 			   ['sysDescr', '0', ''],
 			   ['sysObjectID', '0'],
 			   ['sysUpTime', '0'],
@@ -86,7 +83,7 @@ $vars = new SNMP::VarList (
 
 ######################################################################
 # Get the standard Vars and check that we got some defined vars back
-@ret = $s1->get($vars);
+my @ret = $s1->get($vars);
 ok(!$s1->{ErrorStr} and defined($ret[0]));
 #print STDERR "Error string = $s1->{ErrorStr}:$s1->{ErrorInd}\n";
 ######################################################################
@@ -96,7 +93,7 @@ ok($#ret == $#{$vars});
 ################################################
 
 # Test for a string
-$contact = $s1->get('sysContact.0');
+my $contact = $s1->get('sysContact.0');
 #print("contact is : $contact\n");
 ok( defined($contact));
 
@@ -106,49 +103,49 @@ $name = $s1->get('sysName.0');
 ok( defined($name));
 
 
-$location = $s1->get('sysLocation.0');
+my $location = $s1->get('sysLocation.0');
 #print("Location is : $location\n");
 ok( defined($location));
 #########################################
 
 
 # Test for an integer
-$ttl = $s1->get('ipDefaultTTL.0');
+my $ttl = $s1->get('ipDefaultTTL.0');
 #print("TTL is : $ttl\n");
 ok( defined($ttl));
 ########################################
 
 
 # Test for a TimeTicks
-$time = $s1->get('sysUpTime.0');
+my $time = $s1->get('sysUpTime.0');
 #print("up time is : $time hundredths of a second\n");
 ok( defined($time));
 #########################################
 
 
 #Test for a Counter32 type.
-$totalDatagramsReceived = $s1->get('ipInHdrErrors.0');
+my $totalDatagramsReceived = $s1->get('ipInHdrErrors.0');
 #print("totalDatagramsReceived is : $totalDatagramsReceived\n");
 ok( defined($totalDatagramsReceived));
 ################################################
 
 
 #Test for a PhysicalAddr type
-$physaddr = $s1->get('ipNetToMediaPhysAddress.0');
+my $physaddr = $s1->get('ipNetToMediaPhysAddress.0');
 #print("physical addr is : $physaddr \n");
 ok( defined($physaddr));
 ##############################################
 
 
 #Test for a IpAddr type
-$ipaddr = $s1->get('ipAdEntAddr.0');
+my $ipaddr = $s1->get('ipAdEntAddr.0');
 #print("Ip address is : $ipaddr \n");
 ok( defined($ipaddr));
 ##############################################
 
 
 #Test for a OID type
-$trapOID = $s1->get('snmpTrapOID.0');
+my $trapOID = $s1->get('snmpTrapOID.0');
 #print("trap OID is : $trapOID $s1->{ErrorStr}\n");
 ok( defined($trapOID));
 ##############################################
@@ -193,20 +190,20 @@ ok(defined($oid));
 #############################################
 
 # String test
-$descr = $s1->get('sysORDescr.1');
+my $descr = $s1->get('sysORDescr.1');
 #print("Sys Descr is : $descr\n");
 ok(defined($descr));
 #############################################
 
 # string String test
-$ifname = $s1->get('ifDescr.1');
+my $ifname = $s1->get('ifDescr.1');
 #print("ifname is : $ifname $s1->{ErrorStr}\n");
 ok(defined($ifname));
 #############################################
 
 
 # Try getting some unknown(wrong ?) data
-$unknown = $s1->get('ifmyData.0');
+my $unknown = $s1->get('ifmyData.0');
 ok(!defined($unknown));
 ##############################################
 
diff -urpN net-snmp-5.8/perl/SNMP/t/getnext.t net-snmp-5.9.1/perl/SNMP/t/getnext.t
--- net-snmp-5.8/perl/SNMP/t/getnext.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/t/getnext.t	2021-05-26 05:19:35.000000000 +0700
@@ -1,20 +1,17 @@
 #!./perl
 
+use strict;
+use warnings;
+
 BEGIN {
-    unless(grep /blib/, @INC) {
-        chdir 't' if -d 't';
-        @INC = '../lib' if -d '../lib';
-    }
     eval "use Cwd qw(abs_path)";
-    $ENV{'SNMPCONFPATH'} = 'nopath';
-    $ENV{'MIBDIRS'} = '+' . abs_path("../../mibs");
 }
 
 use Test;
 BEGIN { plan tests => 9 }
 use SNMP;
-use vars qw($agent_port $comm $agent_host);
 require "t/startagent.pl";
+use vars qw($agent_host $agent_port $comm);
 
 
 my $junk_oid = ".1.3.6.1.2.1.1.1.1.1.1";
@@ -24,10 +21,6 @@ my $junk_host = 'no.host.here';
 my $name = "gmarzot\@nortelnetworks.com";
 
 $SNMP::debugging = 0;
-my $n = 9;  # Number of tests to run
-
-#print "1..$n\n";
-#if ($n == 0) { exit 0; }
 
 # create list of varbinds for GETS, val field can be null or omitted
 my $vars = new SNMP::VarList (
diff -urpN net-snmp-5.8/perl/SNMP/t/mib.t net-snmp-5.9.1/perl/SNMP/t/mib.t
--- net-snmp-5.8/perl/SNMP/t/mib.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/t/mib.t	2021-05-26 05:19:35.000000000 +0700
@@ -2,14 +2,11 @@
 
 # Written by John Stoffel (jfs@fluent.com) - 10/13/1997
 
+use strict;
+use warnings;
+
 BEGIN {
-    unless(grep /blib/, @INC) {
-        chdir 't' if -d 't';
-        @INC = '../lib' if -d '../lib';
-    }
     eval "use Cwd qw(abs_path)";
-    $ENV{'SNMPCONFPATH'} = 'nopath';
-    $ENV{'MIBDIRS'} = '+' . abs_path("../../mibs");
     $ENV{'MIBS'} = 'ALL';
 }
 
@@ -17,31 +14,36 @@ BEGIN {
 $SNMP::save_descriptions = 1;
 
 use Test;
-BEGIN {plan tests => 35}
+BEGIN {plan tests => 38}
 use SNMP;
+use Data::Dumper;
 
 $SNMP::verbose = 0;
 $SNMP::best_guess = 2;
 
-use vars qw($bad_oid);
 require "t/startagent.pl";
+use vars qw($bad_name $bad_oid $name $name_long $name_module $name_module2
+            $name_module_long $name_module_long2 $oid);
+require "t/startagent.pl";
+
+my $DEBUG;
 
 #############################  1  ######################################
 #check if
 my $res = $SNMP::MIB{sysDescr}{label};
-#print("Label is:$res\n");
+print STDERR ("Test 1: label is $res\n") if ($DEBUG);
 ok("sysDescr" eq $res);
-#print("\n");
+print STDERR ("\n") if ($DEBUG);
 #############################  2  ######################################
 $res =  $SNMP::MIB{sysDescr}{objectID};
-#print("OID is: $res\n");
+print STDERR ("Test 2: OID is $res\n") if ($DEBUG);
 ok(defined($res));
-#print("\n");
+print STDERR ("\n") if ($DEBUG);
 #############################  3  ######################################
 $res =  $SNMP::MIB{sysDescr}{access};
-#print("access is: $res\n");
+print STDERR ("Test 3: access is $res\n") if ($DEBUG);
 ok($res eq 'ReadOnly');
-#print("\n");
+print STDERR ("\n") if ($DEBUG);
 ##############################  4  ###################################
 $res =  $SNMP::MIB{sysLocation}{access};
 #$res =  $SNMP::MIB{sysORIndex}{access};
@@ -51,60 +53,61 @@ $res =  $SNMP::MIB{sysLocation}{type};
 ok($res eq 'OCTETSTR');
 #############################  6  ####################################
 $res =  $SNMP::MIB{sysLocation}{status};
-#print STDERR ("status is: $res\n");
+print STDERR ("Test 6: status is $res\n") if ($DEBUG);
 ok($res eq 'Current');
-#print STDERR ("\n");
+print STDERR ("\n") if ($DEBUG);
 #############################  7  #################################
 $res =  $SNMP::MIB{sysORTable}{access};
-#print("access is: $res\n");
+print STDERR ("Test 7: access is $res\n") if ($DEBUG);
 ok($res eq 'NoAccess');
-#print("\n");
+print STDERR ("\n") if ($DEBUG);
 #############################  8  ###############################
 $res = $SNMP::MIB{sysLocation}{subID};
-#print("subID is: $res\n");
+print STDERR ("Test 8: subID is $res\n") if ($DEBUG);
 ok(defined($res));
-#print("\n");
+print STDERR ("\n") if ($DEBUG);
 ############################  9  ##############################
 $res = $SNMP::MIB{sysLocation}{syntax};
-#print("syntax is: $res\n");
+print STDERR ("Test 9: syntax is $res\n") if ($DEBUG);
 ok($res eq 'DisplayString');
-#print("\n");
+print STDERR ("\n") if ($DEBUG);
 ############################  10  ###########################
 $res = $SNMP::MIB{ipAdEntAddr}{syntax};
+print STDERR ("Test 10: syntax is $res\n") if ($DEBUG);
 ok($res eq 'IPADDR');
-#print("\n");
+print STDERR ("\n") if ($DEBUG);
 ##########################  11  ##########################
 $res = $SNMP::MIB{atNetAddress}{syntax};
-#print ("syntax is: $res\n");
+print STDERR ("Test 11: syntax is $res\n") if ($DEBUG);
 ok($res eq 'NETADDR');
-#print("\n");
+print STDERR ("\n") if ($DEBUG);
 ########################   12  ###############################
 $res = $SNMP::MIB{ipReasmOKs}{syntax};
-#print("syntax is: $res\n");
+print STDERR ("Test 12: syntax is $res\n") if ($DEBUG);
 ok($res eq 'COUNTER');
-#print("\n");
+print STDERR ("\n") if ($DEBUG);
 ######################   13  ##############################
 $res = $SNMP::MIB{sysDescr}{moduleID};
-#print("Module ID is: $res\n");
+print STDERR ("Test 13: module ID is $res\n") if ($DEBUG);
 ok(defined($res));
-#print("\n");
+print STDERR ("\n") if ($DEBUG);
 ######################  14   #########################
-$des = $SNMP::MIB{atNetAddress}{description};
-#print("des is --> $des\n");
+my $des = $SNMP::MIB{atNetAddress}{description};
+print STDERR ("Test 14: des is $des\n") if ($DEBUG);
 ok(defined($des));
-#print("\n");
+print STDERR ("\n") if ($DEBUG);
 
 ######################  15   #########################
 $res = $SNMP::MIB{atNetAddress}{nextNode};
-#print("res is --> $res\n");
+print STDERR ("Test 15: res is $res\n") if ($DEBUG);
 ok(ref($res) eq "HASH");
-#print("\n");
+print STDERR ("\n") if ($DEBUG);
 
 ########################  16   #########################
 $res = $SNMP::MIB{sysDescr}{children};
-#print("res is --> $res\n");
+print STDERR ("Test 16: res is " . Dumper($res) . "\n") if ($DEBUG);
 ok(ref($res) eq "ARRAY");
-#print("\n");
+print STDERR ("\n") if ($DEBUG);
 ####################  17   #########################
 
 $res = $SNMP::MIB{sysDescr}{badField};
@@ -113,17 +116,15 @@ ok(!defined($res));
 
 ######################  18   #########################
 $res = $SNMP::MIB{sysDescr}{hint};
-#print("res is --> $res\n");
-#XXX: test fails due SMIv1 codes being returned intstead of SMIv2...
-#ok(defined($res) && $res =~ /^255a/);
-#print("\n");
+print STDERR ("Test 18: res is " . Dumper($res) . "\n") if ($DEBUG);
+ok(defined($res) && $res =~ /^255a/);
+print STDERR ("\n") if ($DEBUG);
 ######################  19   #########################
 
 $res = $SNMP::MIB{ifPhysAddress}{hint};
-#print("res is --> $res\n");
-#XXX: test fails due SMIv1 codes being returned intstead of SMIv2...
-#ok(defined($res) && $res =~ /^1x:/);
-#print("\n");
+print STDERR ("Test 19: res is " . Dumper($res) . "\n") if ($DEBUG);
+ok(defined($res) && $res =~ /^1x:/);
+print STDERR ("\n") if ($DEBUG);
 
 
 ######################  some translate tests  #######
@@ -139,8 +140,7 @@ ok(!defined($type1));
 # getType() supports numeric OIDs now
 
 my $type2 = SNMP::getType($oid);
-#XXX: test fails due SMIv1 codes being returned intstead of SMIv2...
-#ok(defined($type2) && $type2 =~ /OCTETSTR/);
+ok(defined($type2) && $type2 =~ /OCTETSTR/);
 
 ######################################################################
 # This tests that sysDescr returns a valid type.
@@ -151,7 +151,7 @@ ok(defined($type3));
 ######################################################################
 # Translation tests from Name -> OID
 # sysDescr to .1.3.6.1.2.1.1.1
-$oid_tag = SNMP::translateObj($name);
+my $oid_tag = SNMP::translateObj($name);
 ok($oid eq $oid_tag);
 
 ######################################################################
@@ -176,7 +176,7 @@ ok(!defined($oid_tag));
 ######################################################################
 # OID -> name
 # .1.3.6.1.2.1.1.1 to sysDescr
-$name_tag = SNMP::translateObj($oid);
+my $name_tag = SNMP::translateObj($oid);
 ok($name eq $name_tag);
 
 ######################################################################
@@ -184,7 +184,6 @@ ok($name eq $name_tag);
 # .1.3.6.1.2.1.1.1 to RFC1213-MIB::sysDescr or
 # .1.3.6.1.2.1.1.1 to SNMPv2-MIB::sysDescr
 $name_tag = SNMP::translateObj($oid,0,1);
-$name_module2 = $name_module2; # To eliminate 'only use once' variable warning
 ok(($name_module eq $name_tag) || ($name_module2 eq $name_tag));
 
 ######################################################################
@@ -197,8 +196,6 @@ ok($name_long eq $name_tag);
 # OID -> name
 # .1.3.6.1.2.1.1.1 to RFC1213-MIB::.iso.org.dod.internet.mgmt.mib-2.system.sysDescr or
 # .1.3.6.1.2.1.1.1 to SNMPv2-MIB::.iso.org.dod.internet.mgmt.mib-2.system.sysDescr
-$name_module_long = $name_module_long; # To eliminate 'only use once' variable warning
-$name_module_long2 = $name_module_long2; # To eliminate 'only use once' variable warning
 $name_tag = SNMP::translateObj($oid,1,1);
 ok(($name_module_long eq $name_tag) || ($name_module_long2 eq $name_tag));
 
@@ -213,9 +210,9 @@ ok($name ne $name_tag);
 ######################################################################
 # ranges
 
-$node = $SNMP::MIB{snmpTargetAddrMMS};
+my $node = $SNMP::MIB{snmpTargetAddrMMS};
 ok($node);
-$ranges = $node->{ranges};
+my $ranges = $node->{ranges};
 ok($ranges and ref $ranges eq 'ARRAY');
 ok(@$ranges == 2);
 ok($$ranges[0]{low} == 0);
diff -urpN net-snmp-5.8/perl/SNMP/t/mibload.t net-snmp-5.9.1/perl/SNMP/t/mibload.t
--- net-snmp-5.8/perl/SNMP/t/mibload.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/t/mibload.t	2021-05-26 05:19:35.000000000 +0700
@@ -1,54 +1,35 @@
 #!./perl
 
+use strict;
+use warnings;
+
 BEGIN {
-    unless(grep /blib/, @INC) {
-        chdir 't' if -d 't';
-        @INC = '../lib' if -d '../lib';
-    }
     eval "use Cwd qw(abs_path)";
-    $ENV{'SNMPCONFPATH'} = 'nopath';
-    $ENV{'MIBDIRS'} = '+' . abs_path("../../mibs");
 }
 
+use File::Spec;
 use Test;
 BEGIN {plan tests => 7}
 use SNMP;
 
 require "t/startagent.pl";
-
 use vars qw($mibdir);
 
 $SNMP::verbose = 0;
 
-my $mib_file = 't/mib.txt';
+my $mib_file = File::Spec->catfile('t', 'mib.txt');
 my $junk_mib_file = 'mib.txt';
 
-my $mibfile1;
-my @mibdir;
-my $mibfile2;
-
-if ($^O =~ /win32/i) {
-  $mibdir =~ s"/"\\"g;
-  $mibfile1 = "$mibdir\\TCP-MIB.txt";
-  @mibdir = ("$mibdir");
-  $mibfile2 = "$mibdir\\IPV6-TCP-MIB.txt";
-}
-else {
-  $mibfile1 = "$mibdir/TCP-MIB.txt";
-  @mibdir = ("$mibdir");
-  $mibfile2 = "$mibdir/IPV6-TCP-MIB.txt";
-}
-
-if ($^O =~ /win32/i) {
-  $mibdir =~ s"/"\\"g;
-}
+my $mibfile1 = File::Spec->catfile($mibdir, "TCP-MIB.txt");
+my @mibdir = ("$mibdir");
+my $mibfile2 = File::Spec->catfile($mibdir, "IPV6-TCP-MIB.txt");
 
 
 ######################################################################
 # See if we can find a mib to use, return of 0 means the file wasn't
 # found or isn't readable.
 
-$res = SNMP::setMib($junk_mib_file,1);
+my $res = SNMP::setMib($junk_mib_file,1);
 ok(defined(!$res));
 ######################################################################
 # Now we give the right name
@@ -81,9 +62,9 @@ ok(!defined($res));
 ########################  5  ############################
 # add mib file
 
-$res1 = SNMP::addMibFiles($mibfile1);
+my $res1 = SNMP::addMibFiles($mibfile1);
 ok(defined($res1));
-$res2 = SNMP::addMibFiles($mibfile2);
+my $res2 = SNMP::addMibFiles($mibfile2);
 ok(defined($res2));
 
 $res = $SNMP::MIB{ipv6TcpConnState}{moduleID};
diff -urpN net-snmp-5.8/perl/SNMP/t/notify.t net-snmp-5.9.1/perl/SNMP/t/notify.t
--- net-snmp-5.8/perl/SNMP/t/notify.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/t/notify.t	2021-05-26 05:19:35.000000000 +0700
@@ -1,19 +1,17 @@
 #!./perl
 
+use strict;
+use warnings;
+use Test;
+
 BEGIN {
-    unless(grep /blib/, @INC) {
-        chdir 't' if -d 't';
-        @INC = '../lib' if -d '../lib';
-    }
     eval "use Cwd qw(abs_path)";
-    $ENV{'SNMPCONFPATH'} = 'nopath';
-    $ENV{'MIBDIRS'} = '+' . abs_path("../../mibs");
+    plan tests => 11;
 }
-use Test;
-BEGIN { $n = 11; plan tests => $n }
 use SNMP;
-use vars qw($agent_port $comm $comm2 $trap_port $agent_host $sec_name $priv_pass $auth_pass $bad_name);
 require 't/startagent.pl';
+use vars qw($agent_host $agent_port $auth_pass $bad_name $comm $comm2
+            $priv_pass $sec_name $trap_port);
 $SNMP::debugging = 0;
 
 my $res;
@@ -30,7 +28,10 @@ ok(defined($s1));
 ########################  2  ############################
 # test v1 trap
 if (defined($s1)) {
-  $res = $s1->trap(enterprise => $enterprise, agent=>$agent_host, generic=>$generic,[[sysContact, 0, 'root@localhost'], [sysLocation, 0, 'here']] );
+    $res = $s1->trap(enterprise => $enterprise, agent=>$agent_host,
+		     generic => $generic,
+		     [['sysContact', 0, 'root@localhost'],
+		      ['sysLocation', 0, 'here']] );
 }
 ok($res =~ /^0 but true/);
 
@@ -38,7 +39,8 @@ ok($res =~ /^0 but true/);
 # test with wrong varbind
 undef $res;
 if (defined($s1)) {
-  $res = $s1->trap([[$bad_name, 0, 'root@localhost'], [sysLocation, 0, 'here']] );
+    $res = $s1->trap([[$bad_name, 0, 'root@localhost'],
+		      ['sysLocation', 0, 'here']] );
   #print("res is $res\n");
 }
 ok(!defined($res));
@@ -54,7 +56,9 @@ ok(defined($s2));
 # test v2 trap
 undef $res;
 if (defined($s2)) {
-  $res = $s2->trap(uptime=>200, trapoid=>'coldStart',[[sysContact, 0, 'root@localhost'], [sysLocation, 0, 'here']] );
+    $res = $s2->trap(uptime=>200, trapoid=>'coldStart',
+		     [['sysContact', 0, 'root@localhost'],
+		      ['sysLocation', 0, 'here']] );
   #print("res is $res\n");
 }
 ok($res =~ /^0 but true/);
@@ -62,7 +66,8 @@ ok($res =~ /^0 but true/);
 # no trapoid and uptime given. Should take defaults...
 my $ret;
 if (defined($s2)) {
-  $ret = $s2->trap([[sysContact, 0, 'root@localhost'], [sysLocation, 0, 'here']] );
+    $ret = $s2->trap([['sysContact', 0, 'root@localhost'],
+		      ['sysLocation', 0, 'here']] );
   #print("res is $ret\n");
 }
 ok(defined($ret));
@@ -85,20 +90,27 @@ ok(defined($s3));
 
 ########################  9  ############################
 if (defined($s3)) {
-  $res = $s3->inform(uptime=>111, trapoid=>'coldStart', [[sysContact, 0, 'root@localhost'], [sysLocation, 0, 'here']] );
+    $res = $s3->inform(uptime=>111, trapoid=>'coldStart',
+		       [['sysContact', 0, 'root@localhost'],
+			['sysLocation', 0, 'here']] );
 }
-ok($res =~ /^0 but true/);
+ok(defined($res) && $res =~ /^0 but true/);
 
 ######################## 10  ############################
 # Fire up a v3 trap session.
-$s3 = new SNMP::Session(Version=>3, DestHost=> $agent_host, RemotePort=>$trap_port, SecName => $sec_name, SecLevel => authPriv, AuthPass => $auth_pass, PrivPass => $priv_pass);
+$s3 = new SNMP::Session(Version => 3, DestHost=> $agent_host,
+			RemotePort => $trap_port, SecName => $sec_name,
+			SecLevel => 'authPriv', AuthPass => $auth_pass,
+			PrivPass => $priv_pass);
 ok(defined($s3));
 
 ######################## 11  ############################
 undef $res;
 if (defined($s3)) {
-    $res = $s3->inform(uptime=>111, trapoid=>'coldStart', [[sysContact, 0, 'root@localhost'], [sysLocation, 0, 'here']] );
-    print "res = $res\n";
+    $res = $s3->inform(uptime=>111, trapoid=>'coldStart',
+		       [['sysContact', 0, 'root@localhost'],
+			['sysLocation', 0, 'here']] );
+    print "# res = " . ($res ? $res : "(undefined)") . "\n";
 }
   
 ok(defined($res) && ($res =~ /^0 but true/));
diff -urpN net-snmp-5.8/perl/SNMP/t/readsnmptest.pl net-snmp-5.9.1/perl/SNMP/t/readsnmptest.pl
--- net-snmp-5.8/perl/SNMP/t/readsnmptest.pl	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/t/readsnmptest.pl	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,45 @@
+#!./perl
+
+use strict;
+use warnings;
+use Cwd qw(getcwd);
+use Exporter;
+
+our @ISA = 'Exporter';
+our @EXPORT_OK = qw($agent_host $agent_port $mibdir $snmpd_cmd $snmptrapd_cmd);
+our ($agent_host, $agent_port, $mibdir, $snmpd_cmd, $snmptrapd_cmd);
+
+if (open(CMD, "<../SNMP/t/snmptest.cmd")) {
+  while (my $line = <CMD>) {
+    if ($line =~ /HOST\s*=>\s*(.*?)\s+$/) {
+      $agent_host = $1;
+    } elsif ($line =~ /MIBDIR\s*=>\s*(.*?)\s+$/) {
+      $mibdir = $1;
+    } elsif ($line =~ /AGENT_PORT\s*=>\s*(.*?)\s+$/) {
+      $agent_port = $1;
+    } elsif ($line =~ /SNMPD\s*=>\s*(.*?)\s+$/) {
+      $snmpd_cmd = $1;
+    } elsif ($line =~ /SNMPTRAPD\s*=>\s*(.*?)\s+$/) {
+      $snmptrapd_cmd = $1;
+    }
+  } # end of while
+  close CMD;
+} else {
+  die ("Could not start agent. Couldn't find snmptest.cmd file\n");
+}
+
+# On Windows %ENV changes only affect new processes but not the current
+# process. Hence write the MIB dir into an snmp.conf file instead of setting
+# $ENV{'MIBDIRS'}.
+open(H, ">snmp.conf") or die "Failed to open snmp.conf: $!";
+print H "mibdirs +$mibdir\n";
+close(H);
+# use SNMP;
+# SNMP::register_debug_tokens("get_mib_directory");
+# SNMP::register_debug_tokens("read_config");
+use NetSNMP::default_store (':all');
+netsnmp_ds_set_string(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_CONFIGURATION_DIR,
+		      getcwd()) == 0 or
+    die "Failed to set configuration directory";
+
+1;
diff -urpN net-snmp-5.8/perl/SNMP/t/session.t net-snmp-5.9.1/perl/SNMP/t/session.t
--- net-snmp-5.8/perl/SNMP/t/session.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/t/session.t	2021-05-26 05:19:35.000000000 +0700
@@ -1,19 +1,17 @@
 #!./perl
 
+use strict;
+use warnings;
+
 BEGIN {
-    unless(grep /blib/, @INC) {
-        chdir 't' if -d 't';
-        @INC = '../lib' if -d '../lib';
-    }
     eval "use Cwd qw(abs_path)";
-    $ENV{'SNMPCONFPATH'} = 'nopath';
-    $ENV{'MIBDIRS'} = '+' . abs_path("../../mibs");
 }
 use Test;
 BEGIN { plan tests => 5}
 use SNMP;
-use vars qw($agent_port $comm $agent_host $bad_auth_pass $auth_pass $sec_name $bad_sec_name $bad_version $bad_priv_pass $priv_pass);
 require "t/startagent.pl";
+use vars qw($agent_host $agent_port $auth_pass $bad_auth_pass $bad_priv_pass
+            $bad_sec_name $bad_version $comm $priv_pass $sec_name);
 
 $SNMP::debugging = 0;
 
diff -urpN net-snmp-5.8/perl/SNMP/t/set.t net-snmp-5.9.1/perl/SNMP/t/set.t
--- net-snmp-5.8/perl/SNMP/t/set.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/t/set.t	2021-05-26 05:19:35.000000000 +0700
@@ -1,19 +1,16 @@
 #!./perl
 
+use strict;
+use warnings;
+
 BEGIN {
-    unless(grep /blib/, @INC) {
-        chdir 't' if -d 't';
-        @INC = '../lib' if -d '../lib';
-    }
     eval "use Cwd qw(abs_path)";
-    $ENV{'SNMPCONFPATH'} = 'nopath';
-    $ENV{'MIBDIRS'} = '+' . abs_path("../../mibs");
 }
 use Test;
 BEGIN { plan tests => 7 }
 use SNMP;
-use vars qw($agent_port $comm $agent_host);
 require "t/startagent.pl";
+use vars qw($agent_host $agent_port $comm);
 
 
 my $junk_oid = ".1.3.6.1.2.1.1.1.1.1.1";
@@ -23,10 +20,6 @@ my $junk_host = 'no.host.here';
 my $name = "gmarzot\@nortelnetworks.com";
 
 $SNMP::debugging = 0;
-$n = 15;  # Number of tests to run
-
-#print "1..$n\n";
-if ($n == 0) { exit 0; }
 
 # create list of varbinds for GETS, val field can be null or omitted
 my $vars = new SNMP::VarList (
@@ -82,10 +75,10 @@ my $vars = new SNMP::VarList (
 #######################  2  ##########################################
 # Set some value and see if the value is set properly.
 
-$originalLocation = $s1->get('sysLocation.0');
-$value = 'Router Management Labs';
+my $originalLocation = $s1->get('sysLocation.0');
+my $value = 'Router Management Labs';
 $s1->set('sysLocation.0', $value);
-$finalvalue = $s1->get('sysLocation.0');
+my $finalvalue = $s1->get('sysLocation.0');
 ok($originalLocation ne $finalvalue);
 #print STDERR "Error string = $s1->{ErrorStr}:$s1->{ErrorInd}\n";
 #print("set value is: $finalvalue\n\n");
@@ -111,9 +104,9 @@ $s1->set('sysLocation.0', $originalLocat
 #######################   4   #####################################
 
 # Test for an integer (READ-ONLY)
-$originalservice = $s1->get('sysServices.0');
+my $originalservice = $s1->get('sysServices.0');
 #print("services is: $originalservice\n");
-$junk_service = "Nortel Networks";
+my $junk_service = "Nortel Networks";
 $s1->set('sysServices.0', $junk_service);
 
 $finalvalue = $s1->get('sysServices.0');
@@ -130,9 +123,9 @@ $s1->set('sysServices.0',$originalservic
 # If any other value is tried to be set, it doesn't set and
 # retains the old value.
 
-$originalTrap = $s1->get('snmpEnableAuthenTraps.0');
+my $originalTrap = $s1->get('snmpEnableAuthenTraps.0');
 #print("trap is -- $originalTrap\n");
-$junk_trap = "Nortel Networks";
+my $junk_trap = "Nortel Networks";
 $s1->set('snmpEnableAuthenTraps.0', $junk_trap);
 $finalvalue = $s1->get('snmpEnableAuthenTraps.0');
 #print("final trap is: $finalvalue\n");
@@ -201,9 +194,9 @@ ok($s1->{ErrorStr} =~ /^Bad/ );
 # OID test
 my $oldoid = $s1->get("sysORID.1");
 #print("OID is : $oldoid\n");
-$junk_OID = ".6.6.6.6.6.6";
+my $junk_OID = ".6.6.6.6.6.6";
 $s1->set('sysORID.1', $junk_OID);
-$newOID = $s1->get("sysORID.1");
+my $newOID = $s1->get("sysORID.1");
 #print("new oid is $newOID\n");
 ok($oldoid eq $newOID);
 #print STDERR "Error string = $s1->{ErrorStr}:$s1->{ErrorInd}\n";
@@ -211,7 +204,7 @@ ok($oldoid eq $newOID);
 ################  14  ##########################
 
 # Try setting an unregistered OID.
-$junk_data = 'hehehe';
+my $junk_data = 'hehehe';
 $s1->set('ifmyData.0', $junk_data);
 
 #print STDERR "Error string = $s1->{ErrorStr}:$s1->{ErrorInd}\n";
diff -urpN net-snmp-5.8/perl/SNMP/t/startagent.pl net-snmp-5.9.1/perl/SNMP/t/startagent.pl
--- net-snmp-5.8/perl/SNMP/t/startagent.pl	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/SNMP/t/startagent.pl	2021-05-26 05:19:35.000000000 +0700
@@ -1,44 +1,61 @@
-# common parameters used in SNMP::Session creation and tests
-$agent_host = 'localhost';
-$agent_port = 8765;
-$trap_port = 8764;
-$mibdir = '/usr/local/share/snmp/mibs';
-$comm = 'v1_private';
-$comm2 = 'v2c_private';
-$comm3 = 'v3_private';
-$sec_name = 'v3_user';
-$oid = '.1.3.6.1.2.1.1.1';
-$name = 'sysDescr';
-$name_module = 'RFC1213-MIB::sysDescr';
-$name_module2 = 'SNMPv2-MIB::sysDescr';
-$name_long = '.iso.org.dod.internet.mgmt.mib-2.system.sysDescr';
-$name_module_long = 'RFC1213-MIB::.iso.org.dod.internet.mgmt.mib-2.system.sysDescr';
-$name_module_long2 = 'SNMPv2-MIB::.iso.org.dod.internet.mgmt.mib-2.system.sysDescr';
-$auth_pass = 'test_pass_auth';
-$priv_pass = 'test_pass_priv';
+#!./perl
+
+use strict;
+use warnings;
+use Exporter;
+
+#Open the snmptest.cmd file and get the info
+require "t/readsnmptest.pl";
+use vars qw($agent_host $agent_port $mibdir $snmpd_cmd $snmptrapd_cmd);
+
+our @ISA = 'Exporter';
+our @EXPORT_OK = qw($agent_host $agent_port $mibdir
+$trap_port $comm $comm2 $comm3 $sec_name $oid $name
+$name_module $name_module2 $name_long $name_module_long $name_module_long2
+$auth_pass $priv_pass $bad_comm $bad_name $bad_oid $bad_port $bad_host
+$bad_auth_pass $bad_priv_pass $bad_sec_name $bad_version);
 
-# don't use any .conf files other than those specified.
-$ENV{'SNMPCONFPATH'} |= "bogus";
+# common parameters used in SNMP::Session creation and tests
+$agent_host = 'localhost' if (!defined($agent_host));
+$agent_port = 8765 if (!defined($agent_port));
+our $trap_port = 8764;
+$mibdir = '/usr/local/share/snmp/mibs' if (!defined($mibdir));
+our $comm = 'v1_private';
+our $comm2 = 'v2c_private';
+our $comm3 = 'v3_private';
+our $sec_name = 'v3_user';
+our $oid = '.1.3.6.1.2.1.1.1';
+our $name = 'sysDescr';
+our $name_module = 'RFC1213-MIB::sysDescr';
+our $name_module2 = 'SNMPv2-MIB::sysDescr';
+our $name_long = '.iso.org.dod.internet.mgmt.mib-2.system.sysDescr';
+our $name_module_long = 'RFC1213-MIB::.iso.org.dod.internet.mgmt.mib-2.system.sysDescr';
+our $name_module_long2 = 'SNMPv2-MIB::.iso.org.dod.internet.mgmt.mib-2.system.sysDescr';
+our $auth_pass = 'test_pass_auth';
+our $priv_pass = 'test_pass_priv';
 
 # erroneous input to test failure cases
-$bad_comm = 'BAD_COMMUNITY';
-$bad_name = "badName";
-$bad_oid = ".1.3.6.1.2.1.1.1.1.1.1";
-$bad_host = 'bad.host.here';
-$bad_port = '9999999';
-$bad_auth_pass = 'bad_auth_pass';
-$bad_priv_pass = 'bad_priv_pass';
-$bad_sec_name = 'bad_sec_name';
-$bad_version = 7;
-
-local $snmpd_cmd;
-local $snmptrapd_cmd;
-my $line;
+our $bad_comm = 'BAD_COMMUNITY';
+our $bad_name = "badName";
+our $bad_oid = ".1.3.6.1.2.1.1.1.1.1.1";
+our $bad_host = 'bad.host.here';
+our $bad_port = '9999999';
+our $bad_auth_pass = 'bad_auth_pass';
+our $bad_priv_pass = 'bad_priv_pass';
+our $bad_sec_name = 'bad_sec_name';
+our $bad_version = 7;
 
 if ($^O =~ /win32/i) {
   require Win32::Process;
 }
 
+# Variant of sleep that accepts a floating point number as argument.
+sub delay {
+  my ($timeout) = @_;
+
+  select(undef, undef, undef, $timeout);
+}
+
 sub run_async {
   my ($pidfile, $cmd, @args) = @_;
   if (-r "$cmd" and -x "$cmd") {
@@ -49,8 +66,8 @@ sub run_async {
       system "$cmd @args 2>&1";
     }
     # Wait at most three seconds for the pid file to appear.
-    for ($i = 0; ($i < 3) && ! (-r "$pidfile"); ++$i) {
-      sleep 1;
+    for (my $i = 0; ($i < 30) && ! (-r "$pidfile"); ++$i) {
+      delay 0.1;
     }
   } else {
     warn "Couldn't run $cmd\n";
@@ -58,52 +75,40 @@ sub run_async {
 }
 
 sub snmptest_cleanup {
-  kill_by_pid_file("t/snmpd.pid");
+  my $ignore_failures = shift;
+
+  kill_by_pid_file("t/snmpd.pid", $ignore_failures);
   unlink("t/snmpd.pid");
-  kill_by_pid_file("t/snmptrapd.pid");
+  kill_by_pid_file("t/snmptrapd.pid", $ignore_failures);
   unlink("t/snmptrapd.pid");
 }
 
 sub kill_by_pid_file {
-  if ((-e "$_[0]") && (-r "$_[0]")) {
-    if ($^O !~ /win32/i) {
-      # Unix or Windows + Cygwin.
-      system "kill `cat $_[0]` > /dev/null 2>&1";
-    } else {
-      # Windows + MSVC or Windows + MinGW.
-      open(H, "<$_[0]");
-      my $pid = (<H>);
-      close (H);
-      if ($pid > 0) {
-        Win32::Process::KillProcess($pid, 0)
-      }
-    }
+  my $pidfile = shift;
+  my $ignore_failures = shift;
+
+  if (!open(H, "<$pidfile")) {
+    return;
+  }
+  my $pid = (<H>);
+  close (H);
+  if (!$pid) {
+    defined($ignore_failures) or die "Reading $pidfile failed\n";
+    return;
+  }
+  if ($^O !~ /win32/i) {
+    # Unix or Windows + Cygwin.
+    system "kill $pid > /dev/null 2>&1";
+  } else {
+    # Windows + MSVC or Windows + MinGW.
+    Win32::Process::KillProcess($pid, 0);
   }
+  return 1;
 }
 
 
 # Stop any processes started during a previous test.
-snmptest_cleanup();
-
-#Open the snmptest.cmd file and get the info
-if (open(CMD, "<t/snmptest.cmd")) {
-  while ($line = <CMD>) {
-    if ($line =~ /HOST\s*=>\s*(.*?)\s+$/) {
-      $agent_host = $1;
-    } elsif ($line =~ /MIBDIR\s*=>\s*(.*?)\s+$/) {
-      $mibdir = $1;
-    } elsif ($line =~ /AGENT_PORT\s*=>\s*(.*?)\s+$/) {
-      $agent_port = $1;
-    } elsif ($line =~ /SNMPD\s*=>\s*(.*?)\s+$/) {
-      $snmpd_cmd = $1;
-    } elsif ($line =~ /SNMPTRAPD\s*=>\s*(.*?)\s+$/) {
-      $snmptrapd_cmd = $1;
-    }
-  } # end of while
-  close CMD;
-} else {
-  die ("Could not start agent. Couldn't find snmptest.cmd file\n");
-}
+snmptest_cleanup(1);
 
 # Start snmpd and snmptrapd.
 
diff -urpN net-snmp-5.8/perl/TrapReceiver/Makefile.PL net-snmp-5.9.1/perl/TrapReceiver/Makefile.PL
--- net-snmp-5.8/perl/TrapReceiver/Makefile.PL	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/TrapReceiver/Makefile.PL	2021-05-26 05:19:35.000000000 +0700
@@ -52,14 +52,13 @@ sub TrapReceiverInitMakeParams {
 		 );
 
 
-    if ($ENV{'OSTYPE'} eq 'msys') {
-      $Params{'DEFINE'} = "-DMINGW_PERL";
-    }
+    AddCommonParams(\%Params);
 
     my ($snmp_lib, $snmp_llib, $sep);
-    if (($Config{'osname'} eq 'MSWin32' && $ENV{'OSTYPE'} eq '')) {
-      $opts = NetSNMPGetOpts();	
-      $Params{'DEFINE'} = "-DMSVC_PERL -D_CRT_SECURE_NO_WARNINGS -D_CRT_NONSTDC_NO_WARNINGS";
+
+    $opts = NetSNMPGetOpts();
+
+    if ($Config{'osname'} eq 'MSWin32' && !defined($ENV{'OSTYPE'})) {
       $sep = '\\';
       my $snmp_lib_file = 'netsnmp.lib';
       my $snmp_link_lib = 'netsnmp';
@@ -80,7 +79,7 @@ sub TrapReceiverInitMakeParams {
                 "-l$mibs_link_lib -l$trapd_link_lib ";
       }
       else {
-	my @LibDirs = split (';',$ENV{LIB});
+	my @LibDirs = split($Config{path_sep}, $ENV{LIB});
         my $LibDir;
 	if ($opts->{'prefix'}) {
 	  push (@LibDirs,"$ENV{'NET-SNMP-PATH'}${sep}lib");
@@ -102,21 +101,11 @@ sub TrapReceiverInitMakeParams {
 	}
 	$Params{LIBS} = "-L$LibDir -l$snmp_link_lib -l$agent_link_lib -l$mibs_link_lib -l$trapd_link_lib ";
       }
-
-      $Params{'INC'} = "-I" . $MakefileSubs::basedir . "\\include\\ -I" . $MakefileSubs::basedir . "\\include\\net-snmp\\ -I" . $MakefileSubs::basedir . "\\win32\\ ";
     }
     else {
-	$opts = NetSNMPGetOpts();
-	$Params{'LDDLFLAGS'} = "$Config{lddlflags} " . `$opts->{'nsconfig'} --ldflags`;
-	$Params{'LIBS'} = '-lnetsnmptrapd ' . `$opts->{'nsconfig'} --base-agent-libs`;
+	$Params{'LIBS'} = '-lnetsnmptrapd ' . `$opts->{'nsconfig'} --base-agent-libs` or
+	    die "net-snmp-config failed\n";
 	chomp($Params{'LIBS'});
-	if (!$ENV{'NETSNMP_CCFLAGS'}) {
-	    $Params{'CCFLAGS'} = `$opts->{'nsconfig'} --cflags`;
-	    chomp($Params{'CCFLAGS'});
-	    $Params{'CCFLAGS'} .= " " . $Config{'ccflags'};
-	} else {
-	    $Params{'CCFLAGS'} = $ENV{'NETSNMP_CCFLAGS'};
-	}
 
 	if (lc($opts->{'insource'}) eq "true") {
             $Params{'LIBS'} =
@@ -127,17 +116,12 @@ sub TrapReceiverInitMakeParams {
                 " -L" . abs_path("../../snmplib/.libs") .
                 " -L" . abs_path("../../snmplib") .
                 " " . $Params{'LIBS'};
-	    $Params{'CCFLAGS'} = "-I../../include " . $Params{'CCFLAGS'};
 	} else {
             $Params{'LIBS'} = `$opts->{'nsconfig'} --libdir` . " $Params{'LIBS'}";
         }
 
-	$Params{'CCFLAGS'} =~ s/ -W(all|inline|strict-prototypes|write-strings|cast-qual|no-char-subscripts)//g; # ignore developer warnings
-        $Params{'CCFLAGS'} .= ' -Wformat';
-	if ($Params{'CCFLAGS'} eq "") {
-	    die "You need to install net-snmp first (I can't find net-snmp-config)";
-	}
-        $lib_version = `$opts->{'nsconfig'} --version`;
+        $lib_version = `$opts->{'nsconfig'} --version` or
+	    die "net-snmp-config failed\n";
     }
 
     return(%Params);
diff -urpN net-snmp-5.8/perl/TrapReceiver/TrapReceiver.pm net-snmp-5.9.1/perl/TrapReceiver/TrapReceiver.pm
--- net-snmp-5.8/perl/TrapReceiver/TrapReceiver.pm	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/TrapReceiver/TrapReceiver.pm	2021-05-26 05:19:35.000000000 +0700
@@ -47,7 +47,7 @@ require NetSNMP::OID;
 	NETSNMPTRAPD_PRE_HANDLER
 );
 
-$VERSION = '5.08';
+$VERSION = '5.0901';
 
 # sub new {
 #     my $type = shift;
diff -urpN net-snmp-5.8/perl/TrapReceiver/TrapReceiver.xs net-snmp-5.9.1/perl/TrapReceiver/TrapReceiver.xs
--- net-snmp-5.8/perl/TrapReceiver/TrapReceiver.xs	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/TrapReceiver/TrapReceiver.xs	2021-05-26 05:19:35.000000000 +0700
@@ -1,7 +1,4 @@
 /* -*- c -*- */
-#if defined(_WIN32) && !defined(_WIN32_WINNT)
-#define _WIN32_WINNT 0x501
-#endif
 
 #include "EXTERN.h"
 #include "perl.h"
diff -urpN net-snmp-5.8/perl/TrapReceiver/netsnmp-feature-definitions.h net-snmp-5.9.1/perl/TrapReceiver/netsnmp-feature-definitions.h
--- net-snmp-5.8/perl/TrapReceiver/netsnmp-feature-definitions.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/TrapReceiver/netsnmp-feature-definitions.h	2021-05-26 05:19:35.000000000 +0700
@@ -1,6 +1,6 @@
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-features.h>
 
-netsnmp_feature_require(netsnmp_add_default_traphandler)
-netsnmp_feature_require(memory_free)
+netsnmp_feature_require(netsnmp_add_default_traphandler);
+netsnmp_feature_require(memory_free);
 
diff -urpN net-snmp-5.8/perl/TrapReceiver/t/1.t net-snmp-5.9.1/perl/TrapReceiver/t/1.t
--- net-snmp-5.8/perl/TrapReceiver/t/1.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/TrapReceiver/t/1.t	2021-05-26 05:19:35.000000000 +0700
@@ -1,13 +1,19 @@
+#!./perl
+#
 # Before `make install' is performed this script should be runnable with
 # `make test'. After `make install' it should work as `perl 1.t'
 
 #########################
 
-# change 'tests => 2' to 'tests => last_test_to_print';
-
+use strict;
+use warnings;
 use Test;
-BEGIN { plan tests => 2 };
-# use NetSNMP::TrapReceiver;  # we can't include this directly in a module.
+
+BEGIN {
+    plan tests => 8
+}
+
+use NetSNMP::TrapReceiver;
 ok(1); # If we made it this far, we're ok.  Bogus test!
 
 
@@ -17,18 +23,17 @@ foreach my $constname (qw(
 	NETSNMPTRAPD_HANDLER_FAIL NETSNMPTRAPD_HANDLER_FINISH
 	NETSNMPTRAPD_HANDLER_OK NETSNMPTRAPD_POST_HANDLER
 	NETSNMPTRAPD_PRE_HANDLER)) {
-  next if (eval "my \$a = $constname; 1");
-  if ($@ =~ /^Your vendor has not defined NetSNMP::TrapReceiver macro $constname/) {
-    print "# pass: $@";
-  } else {
-    print "# fail: $@";
-    $fail = 1;    
-  }
-}
-if ($fail) {
-  print "not ok 2\n";
-} else {
-  print "ok 2\n";
+    if (eval "my \$a = $constname; 1") {
+	ok(1);
+	next;
+    }
+    if ($@ =~ /^Your vendor has not defined NetSNMP::TrapReceiver macro $constname/) {
+	print "# pass: $@";
+	ok(1);
+    } else {
+	print "# fail: $@";
+	ok(0);
+    }
 }
 
 #########################
diff -urpN net-snmp-5.8/perl/agent/Makefile.PL net-snmp-5.9.1/perl/agent/Makefile.PL
--- net-snmp-5.8/perl/agent/Makefile.PL	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/agent/Makefile.PL	2021-05-26 05:19:35.000000000 +0700
@@ -25,14 +25,13 @@ sub AgentInitMakeParams {
 		  'PREREQ_PM'           => {},
 		  );
 
-    if ($ENV{'OSTYPE'} eq 'msys') {
-      $Params{'DEFINE'} = "-DMINGW_PERL";
-    }
+    AddCommonParams(\%Params);
                                    
     my ($snmp_lib, $snmp_llib, $sep);
-    if (($Config{'osname'} eq 'MSWin32' && $ENV{'OSTYPE'} eq '')) {
-      $opts = NetSNMPGetOpts();	
-      $Params{'DEFINE'} = "-DMSVC_PERL -D_CRT_SECURE_NO_WARNINGS -D_CRT_NONSTDC_NO_WARNINGS";
+
+    $opts = NetSNMPGetOpts();
+
+    if ($Config{'osname'} eq 'MSWin32' && !defined($ENV{'OSTYPE'})) {
       $sep = '\\';
       my $snmp_lib_file = 'netsnmp.lib';
       my $snmp_link_lib = 'netsnmp';
@@ -52,7 +51,7 @@ sub AgentInitMakeParams {
                 "-l$mibs_link_lib";
       }
       else {
-	my @LibDirs = split (';',$ENV{LIB});
+	my @LibDirs = split($Config{path_sep}, $ENV{LIB});
         my $LibDir;
 	if ($opts->{'prefix'}) {
 	  push (@LibDirs,"$ENV{'NET-SNMP-PATH'}${sep}lib");
@@ -74,18 +73,13 @@ sub AgentInitMakeParams {
 	}
 	$Params{LIBS} = "-L$LibDir -l$snmp_link_lib -l$agent_link_lib -l$mibs_link_lib";
       }
-
-      $Params{'INC'} = "-I" . $MakefileSubs::basedir . "\\include\\ -I" . $MakefileSubs::basedir . "\\include\\net-snmp\\ -I" . $MakefileSubs::basedir . "\\win32\\ ";
     }
     else {
-	$opts = NetSNMPGetOpts();
-	$Params{'LDDLFLAGS'} = "$Config{lddlflags} " . `$opts->{'nsconfig'} --ldflags`;
-	$Params{'LIBS'}   = `$opts->{'nsconfig'} --base-agent-libs`;
+	$Params{'LIBS'}   = `$opts->{'nsconfig'} --base-agent-libs` or
+	    die "net-snmp-config failed\n";
 	chomp($Params{'LIBS'});
-	$Params{'CCFLAGS'} = `$opts->{'nsconfig'} --cflags`;
-	chomp($Params{'CCFLAGS'});
-	$Params{'CCFLAGS'} .= " " . $Config{'ccflags'};
-        $lib_version = `$opts->{'nsconfig'} --version`;
+        $lib_version = `$opts->{'nsconfig'} --version` or
+	    die "net-snmp-config failed\n";
 	if (lc($opts->{'insource'}) eq "true") {
 	    $Params{'LIBS'} =
                 "-L" . abs_path("../../snmplib/.libs") .
@@ -93,16 +87,10 @@ sub AgentInitMakeParams {
                 " -L" . abs_path("../../agent/.libs") .
                 " -L" . abs_path("../../agent") .
                 " " . $Params{'LIBS'};
-	    $Params{'CCFLAGS'} = "-I../../include " . $Params{'CCFLAGS'};
 #	} else {
 	    $Params{'LIBS'} = `$opts->{'nsconfig'} --libdir` . $Params{'LIBS'};
 #	    $Params{'PREREQ_PM'} = {'NetSNMP::OID' => '0.1'};
 	}
-	$Params{'CCFLAGS'} =~ s/ -W(all|inline|strict-prototypes|write-strings|cast-qual|no-char-subscripts)//g; # ignore developer warnings
-        $Params{'CCFLAGS'} .= ' -Wformat';
-	if ($Params{'LIBS'} eq "" || $Params{'CCFLAGS'} eq "") {
-	    die "You need to install net-snmp first (I can't find net-snmp-config)";
-	}
     }
 
     return(%Params);
diff -urpN net-snmp-5.8/perl/agent/Support/Makefile.PL net-snmp-5.9.1/perl/agent/Support/Makefile.PL
--- net-snmp-5.8/perl/agent/Support/Makefile.PL	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/agent/Support/Makefile.PL	2021-05-26 05:19:35.000000000 +0700
@@ -23,15 +23,13 @@ sub SupportInitMakeParams {
 		  'PREREQ_PM'           => {},
 		  );
 
-    if ($ENV{'OSTYPE'} eq 'msys') {
-      $Params{'DEFINE'} = "-DMINGW_PERL";
-    }
+    AddCommonParams(\%Params);
                   
     my ($snmp_lib, $snmp_llib, $sep);
 
-    if (($Config{'osname'} eq 'MSWin32' && $ENV{'OSTYPE'} eq '')) {
-      $opts = NetSNMPGetOpts();	
-      $Params{'DEFINE'} = "-DMSVC_PERL -D_CRT_SECURE_NO_WARNINGS -D_CRT_NONSTDC_NO_WARNINGS";
+    $opts = NetSNMPGetOpts();
+
+    if ($Config{'osname'} eq 'MSWin32' && !defined($ENV{'OSTYPE'})) {
       $sep = '\\';
       my $snmp_lib_file = 'netsnmp.lib';
       my $snmp_link_lib = 'netsnmp';
@@ -48,7 +46,7 @@ sub SupportInitMakeParams {
 	$Params{'LIBS'} = "-L" . $MakefileSubs::basedir . "\\win32\\$lib_dir\\ -l$snmp_link_lib";
       }
       else {
-	my @LibDirs = split (';',$ENV{LIB});
+	my @LibDirs = split($Config{path_sep}, $ENV{LIB});
         my $LibDir;
 	if ($opts->{'prefix'}) {
 	  push (@LibDirs,"$ENV{'NET-SNMP-PATH'}${sep}lib");
@@ -70,30 +68,20 @@ sub SupportInitMakeParams {
 	}
 	$Params{LIBS} = "-L$LibDir -l$snmp_link_lib";
       }
-
-      $Params{'INC'} = "-I" . $MakefileSubs::basedir . "\\include\\ -I" . $MakefileSubs::basedir . "\\include\\net-snmp\\ -I" . $MakefileSubs::basedir . "\\win32\\ ";
     }
     else
     {
-      $opts = NetSNMPGetOpts("../../");
-      $Params{'LIBS'}    = `$opts->{'nsconfig'} --libs`;
+      $Params{'LIBS'}    = `$opts->{'nsconfig'} --libs` or
+          die "net-snmp-config failed\n";
       chomp($Params{'LIBS'});
-      $Params{'CCFLAGS'} = `$opts->{'nsconfig'} --cflags`;
-      chomp($Params{'CCFLAGS'});
-      $Params{'CCFLAGS'} .= " " . $Config{'ccflags'};
-      $lib_version = `$opts->{'nsconfig'} --version`;
+      $lib_version = `$opts->{'nsconfig'} --version` or
+          die "net-snmp-config failed\n";
       
       if (lc($opts->{'insource'}) eq "true") {
 	$Params{'LIBS'} =
             "-L" . abs_path("../../../snmplib/.libs") .
             " -L" . abs_path("../../../snmplib") .
             " " . $Params{'LIBS'};
-	$Params{'CCFLAGS'} = "-I../../include " . $Params{'CCFLAGS'};
-      }
-      $Params{'CCFLAGS'} =~ s/ -W(all|inline|strict-prototypes|write-strings|cast-qual|no-char-subscripts)//g; # ignore developer warnings
-      $Params{'CCFLAGS'} .= ' -Wformat';
-      if ($Params{'LIBS'} eq "" || $Params{'CCFLAGS'} eq "") {
-	die "You need to install net-snmp first (I can't find net-snmp-config)";
       }
     }
     return (%Params);
diff -urpN net-snmp-5.8/perl/agent/Support/Support.pm net-snmp-5.9.1/perl/agent/Support/Support.pm
--- net-snmp-5.8/perl/agent/Support/Support.pm	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/agent/Support/Support.pm	2021-05-26 05:19:35.000000000 +0700
@@ -26,7 +26,7 @@ use vars qw(@ISA @EXPORT @EXPORT_OK $VER
 @ISA       = qw(Exporter getLeaf);
 @EXPORT    = qw(registerAgent getOidElement setOidElement);
 @EXPORT_OK = qw();
-$VERSION = '5.08';
+$VERSION = '5.0901';
 
 use strict;
 use warnings;
diff -urpN net-snmp-5.8/perl/agent/agent.pm net-snmp-5.9.1/perl/agent/agent.pm
--- net-snmp-5.8/perl/agent/agent.pm	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/agent/agent.pm	2021-05-26 05:19:35.000000000 +0700
@@ -87,7 +87,7 @@ use vars qw(@ISA %EXPORT_TAGS @EXPORT_OK
 	SNMP_ERR_AUTHORIZATIONERROR
 	SNMP_ERR_NOTWRITABLE
 );
-$VERSION = '5.08';
+$VERSION = '5.0901';
 
 sub AUTOLOAD {
     # This AUTOLOAD is used to 'autoload' constants from the constant()
diff -urpN net-snmp-5.8/perl/agent/agent.xs net-snmp-5.9.1/perl/agent/agent.xs
--- net-snmp-5.8/perl/agent/agent.xs	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/agent/agent.xs	2021-05-26 05:19:35.000000000 +0700
@@ -1,7 +1,4 @@
 /* -*- C -*- */
-#if defined(_WIN32) && !defined(_WIN32_WINNT)
-#define _WIN32_WINNT 0x501
-#endif
 
 #include "EXTERN.h"
 #include "perl.h"
@@ -601,6 +598,7 @@ nari_setValue(me, type, value)
         netsnmp_request_info *request;
         u_long utmp;
         long ltmp;
+        double dtmp;
         uint64_t ulltmp;
         struct counter64 c64;
 	oid myoid[MAX_OID_LEN];
@@ -633,7 +631,21 @@ nari_setValue(me, type, value)
 		  RETVAL = 1;
 		  break;
 	      }
-	      else if (SvPOKp(value)) {
+	      else if (SvTYPE(value) == SVt_NV || SvNOK(value)) {
+		  /* Might be ok - got a double that might be an actual integer */
+		  dtmp = SvNVX(value);
+		  ltmp = SvIV(value);
+		  if (dtmp != ltmp) {
+			snmp_log(LOG_ERR, "Could not convert double to integer in setValue: '%f'", dtmp);
+			RETVAL = 0;
+			break;
+		  }
+		  snmp_set_var_typed_value(request->requestvb, (u_char)type,
+					   (u_char *) &ltmp, sizeof(ltmp));
+		  RETVAL = 1;
+		  break;
+	      }
+	      else if (SvPOK(value)) {
 	          /* Might be OK - got a string, so try to convert it, allowing base 10, octal, and hex forms */
 	          stringptr = SvPV(value, stringlen);
 		  ltmp = strtol( stringptr, NULL, 0 );
@@ -649,8 +661,8 @@ nari_setValue(me, type, value)
 		  break;
 	      }
 	      else {
-		snmp_log(LOG_ERR, "Non-integer value passed to setValue with ASN_INTEGER: type was %lu\n",
-			(unsigned long)SvTYPE(value));
+		snmp_log(LOG_ERR, "Non-integer value passed to setValue with ASN_INTEGER: type was %lu flags %#lx\n",
+			(unsigned long)SvTYPE(value), (unsigned long)SvFLAGS(value));
 		RETVAL = 0;
 		break;
 	      }
@@ -669,7 +681,21 @@ nari_setValue(me, type, value)
 		  RETVAL = 1;
 		  break;
 	      }
-	      else if (SvPOKp(value)) {
+	      else if (SvTYPE(value) == SVt_NV || SvNOK(value)) {
+		  /* Might be ok - got a double that might be an actual unsigned */
+		  dtmp = SvNVX(value);
+		  utmp = SvIV(value);
+		  if (dtmp != utmp) {
+			snmp_log(LOG_ERR, "Could not convert double to unsigned in setValue: '%f'", dtmp);
+			RETVAL = 0;
+			break;
+		  }
+		  snmp_set_var_typed_value(request->requestvb, (u_char)type,
+					   (u_char *) &utmp, sizeof(utmp));
+		  RETVAL = 1;
+		  break;
+	      }
+	      else if (SvPOK(value)) {
 	          /* Might be OK - got a string, so try to convert it, allowing base 10, octal, and hex forms */
 	          stringptr = SvPV(value, stringlen);
 		  utmp = strtoul( stringptr, NULL, 0 );
@@ -685,8 +711,8 @@ nari_setValue(me, type, value)
 		  break;
 	      }
 	      else {
-		snmp_log(LOG_ERR, "Non-unsigned-integer value passed to setValue with ASN_UNSIGNED/ASN_COUNTER/ASN_TIMETICKS: type was %lu\n",
-			(unsigned long)SvTYPE(value));
+		snmp_log(LOG_ERR, "Non-unsigned-integer value passed to setValue with ASN_UNSIGNED/ASN_COUNTER/ASN_TIMETICKS: type was %lu flags %#lx\n",
+			(unsigned long)SvTYPE(value), (unsigned long)SvFLAGS(value));
 		RETVAL = 0;
 		break;
 	      }
@@ -698,7 +724,21 @@ nari_setValue(me, type, value)
 		  ulltmp = SvIV(value);
 		  RETVAL = 1;
 	      }
-	      else if (SvPOKp(value)) {
+	      else if (SvTYPE(value) == SVt_NV || SvNOK(value)) {
+		  /* Might be ok - got a double that might be an actual unsigned */
+		  dtmp = SvNVX(value);
+		  ulltmp = SvIV(value);
+		  if (dtmp != ulltmp) {
+			snmp_log(LOG_ERR, "Could not convert double to unsigned in setValue: '%f'", dtmp);
+			RETVAL = 0;
+			break;
+		  }
+		  snmp_set_var_typed_value(request->requestvb, (u_char)type,
+					   (u_char *) &ulltmp, sizeof(ulltmp));
+		  RETVAL = 1;
+		  break;
+	      }
+	      else if (SvPOK(value)) {
 	          /* Might be OK - got a string, so try to convert it, allowing base 10, octal, and hex forms */
 	          stringptr = SvPV(value, stringlen);
 	          errno = 0;
@@ -711,8 +751,8 @@ nari_setValue(me, type, value)
 		      RETVAL = 1;
 	      }
 	      else {
-		snmp_log(LOG_ERR, "Non-unsigned-integer value passed to setValue with ASN_COUNTER64: type was %lu\n",
-			(unsigned long)SvTYPE(value));
+		snmp_log(LOG_ERR, "Non-unsigned-integer value passed to setValue with ASN_COUNTER64: type was %lu flags %#lx\n",
+			(unsigned long)SvTYPE(value), (unsigned long)SvFLAGS(value));
 		RETVAL = 0;
 	      }
 	      if (RETVAL) {
@@ -727,9 +767,9 @@ nari_setValue(me, type, value)
           case ASN_BIT_STR:
           case ASN_OPAQUE:
 	      /* Check that we have been passed something with a string value (or a blessed scalar) */
-	      if (!SvPOKp(value) && (SvTYPE(value) != SVt_PVMG)) {
-		snmp_log(LOG_ERR, "Non-string value passed to setValue with ASN_OCTET_STR/ASN_BIT_STR: type was %lu\n",
-			(unsigned long)SvTYPE(value));
+	      if (!SvPOK(value) && (SvTYPE(value) != SVt_PVMG)) {
+		snmp_log(LOG_ERR, "Non-string value passed to setValue with ASN_OCTET_STR/ASN_BIT_STR: type was %lu flags %#lx\n",
+			(unsigned long)SvTYPE(value), (unsigned long)SvFLAGS(value));
 		RETVAL = 0;
 		break;
 	      }
@@ -754,9 +794,9 @@ nari_setValue(me, type, value)
 	       */
 
 	      /* Check that we have been passed something with a string value (or a blessed scalar) */
-	      if (!SvPOKp(value) && (SvTYPE(value) != SVt_PVMG)) {
-		snmp_log(LOG_ERR, "Non-string value passed to setValue with ASN_IPADDRESS: type was %lu\n",
-			(unsigned long)SvTYPE(value));
+	      if (!SvPOK(value) && (SvTYPE(value) != SVt_PVMG)) {
+		snmp_log(LOG_ERR, "Non-string value passed to setValue with ASN_IPADDRESS: type was %lu flags %#lx\n",
+			(unsigned long)SvTYPE(value), (unsigned long)SvFLAGS(value));
 		RETVAL = 0;
 		break;
 	      }
@@ -781,9 +821,9 @@ nari_setValue(me, type, value)
 
           case ASN_OBJECT_ID:
 	      /* Check that we have been passed something with a string value (or a blessed scalar) */
-	      if (!SvPOKp(value) && (SvTYPE(value) != SVt_PVMG)) {
-		snmp_log(LOG_ERR, "Non-string value passed to setValue with ASN_OBJECT_ID: type was %lu\n",
-			(unsigned long)SvTYPE(value));
+	      if (!SvPOK(value) && (SvTYPE(value) != SVt_PVMG)) {
+		snmp_log(LOG_ERR, "Non-string value passed to setValue with ASN_OBJECT_ID: type was %lu flags %#lx\n",
+			(unsigned long)SvTYPE(value), (unsigned long)SvFLAGS(value));
 		RETVAL = 0;
 		break;
 	      }
diff -urpN net-snmp-5.8/perl/agent/default_store/Makefile.PL net-snmp-5.9.1/perl/agent/default_store/Makefile.PL
--- net-snmp-5.8/perl/agent/default_store/Makefile.PL	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/agent/default_store/Makefile.PL	2021-05-26 05:19:35.000000000 +0700
@@ -19,14 +19,13 @@ sub AgentDefaultStoreInitMakeParams {
 		  'XSPROTOARG'          => '-prototypes',
 		  );
 
-    if ($ENV{'OSTYPE'} eq 'msys') {
-      $Params{'DEFINE'} = "-DMINGW_PERL";
-    }
+    AddCommonParams(\%Params);
                                    
     my ($snmp_lib, $snmp_llib, $sep);
-    if (($Config{'osname'} eq 'MSWin32' && $ENV{'OSTYPE'} eq '')) {
-      $opts = NetSNMPGetOpts();	
-      $Params{'DEFINE'} = "-DMSVC_PERL -D_CRT_SECURE_NO_WARNINGS -D_CRT_NONSTDC_NO_WARNINGS";
+
+    $opts = NetSNMPGetOpts();
+
+    if ($Config{'osname'} eq 'MSWin32' && !defined($ENV{'OSTYPE'})) {
       $sep = '\\';
       my $snmp_lib_file = 'netsnmp.lib';
       my $snmp_link_lib = 'netsnmp';
@@ -43,7 +42,7 @@ sub AgentDefaultStoreInitMakeParams {
 	$Params{'LIBS'} = "-L" . $MakefileSubs::basedir . "\\win32\\$lib_dir\\ -l$snmp_link_lib";
       }
       else {
-	my @LibDirs = split (';',$ENV{LIB});
+	my @LibDirs = split($Config{path_sep}, $ENV{LIB});
         my $LibDir;
 	if ($opts->{'prefix'}) {
 	  push (@LibDirs,"$ENV{'NET-SNMP-PATH'}${sep}lib");
@@ -65,28 +64,18 @@ sub AgentDefaultStoreInitMakeParams {
 	}
 	$Params{LIBS} = "-L$LibDir -l$snmp_link_lib";
       }
-
-      $Params{'INC'} = "-I" . $MakefileSubs::basedir . "\\include\\ -I" . $MakefileSubs::basedir . "\\include\\net-snmp\\ -I" . $MakefileSubs::basedir . "\\win32\\ ";
     }
     else {
-	$opts = NetSNMPGetOpts("../../");
-	$Params{'LIBS'}    = `$opts->{'nsconfig'} --libs`;
+	$Params{'LIBS'}    = `$opts->{'nsconfig'} --libs` or
+	    die "net-snmp-config failed\n";
 	chomp($Params{'LIBS'});
-	$Params{'CCFLAGS'} = `$opts->{'nsconfig'} --cflags`;
-	chomp($Params{'CCFLAGS'});
-	$Params{'CCFLAGS'} .= " " . $Config{'ccflags'};
-        $lib_version = `$opts->{'nsconfig'} --version`;
+        $lib_version = `$opts->{'nsconfig'} --version` or
+	    die "net-snmp-config failed\n";
 	if ($opts->{'insource'} eq "true") {
 	    $Params{'LIBS'} =
                 "-L" . abs_path("../../../snmplib/.libs") .
                 " -L" . abs_path("../../../snmplib") .
                 " " . $Params{'LIBS'};
-	    $Params{'CCFLAGS'} = "-I../../../include " . $Params{'CCFLAGS'};
-	}
-	$Params{'CCFLAGS'} =~ s/ -W(all|inline|strict-prototypes|write-strings|cast-qual|no-char-subscripts)//g; # ignore developer warnings
-        $Params{'CCFLAGS'} .= ' -Wformat';
-	if ($Params{'LIBS'} eq "" || $Params{'CCFLAGS'} eq "") {
-	    die "You need to install net-snmp first (I can't find net-snmp-config)";
 	}
     }
 
diff -urpN net-snmp-5.8/perl/agent/default_store/default_store.pm net-snmp-5.9.1/perl/agent/default_store/default_store.pm
--- net-snmp-5.8/perl/agent/default_store/default_store.pm	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/agent/default_store/default_store.pm	2021-05-26 05:19:35.000000000 +0700
@@ -96,7 +96,7 @@ use vars qw(@ISA %EXPORT_TAGS @EXPORT_OK
 				   NETSNMP_DS_AGENT_MAX_GETBULKREPEATS
 				   NETSNMP_DS_AGENT_MAX_GETBULKRESPONSES
 );
-$VERSION = '5.08';
+$VERSION = '5.0901';
 
 sub AUTOLOAD {
     # This AUTOLOAD is used to 'autoload' constants from the constant()
diff -urpN net-snmp-5.8/perl/agent/default_store/default_store.xs net-snmp-5.9.1/perl/agent/default_store/default_store.xs
--- net-snmp-5.8/perl/agent/default_store/default_store.xs	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/agent/default_store/default_store.xs	2021-05-26 05:19:35.000000000 +0700
@@ -1,7 +1,3 @@
-#if defined(_WIN32) && !defined(_WIN32_WINNT)
-#define _WIN32_WINNT 0x501
-#endif
-
 #include "EXTERN.h"
 #include "perl.h"
 #include "XSUB.h"
diff -urpN net-snmp-5.8/perl/agent/netsnmp-feature-definitions.h net-snmp-5.9.1/perl/agent/netsnmp-feature-definitions.h
--- net-snmp-5.8/perl/agent/netsnmp-feature-definitions.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/agent/netsnmp-feature-definitions.h	2021-05-26 05:19:35.000000000 +0700
@@ -1,6 +1,6 @@
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-features.h>
 
-netsnmp_feature_require(agent_check_and_process)
-netsnmp_feature_require(snmp_enable_stderrlog)
+netsnmp_feature_require(agent_check_and_process);
+netsnmp_feature_require(snmp_enable_stderrlog);
 
diff -urpN net-snmp-5.8/perl/default_store/Makefile.PL net-snmp-5.9.1/perl/default_store/Makefile.PL
--- net-snmp-5.8/perl/default_store/Makefile.PL	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/default_store/Makefile.PL	2021-05-26 05:19:35.000000000 +0700
@@ -18,14 +18,13 @@ sub DefaultStoreInitMakeParams {
 		  'XSPROTOARG'          => '-prototypes',
 		  );
 
-    if ($ENV{'OSTYPE'} eq 'msys') {
-      $Params{'DEFINE'} = "-DMINGW_PERL";
-    }                 
+    AddCommonParams(\%Params);
                   
     my ($snmp_lib, $snmp_llib, $sep);
-    if (($Config{'osname'} eq 'MSWin32' && $ENV{'OSTYPE'} eq '')) {
-      $opts = NetSNMPGetOpts();	
-      $Params{'DEFINE'} = "-DMSVC_PERL -D_CRT_SECURE_NO_WARNINGS -D_CRT_NONSTDC_NO_WARNINGS";
+
+    $opts = NetSNMPGetOpts();
+
+    if ($Config{'osname'} eq 'MSWin32' && !defined($ENV{'OSTYPE'})) {
       $sep = '\\';
       my $snmp_lib_file = 'netsnmp.lib';
       my $snmp_link_lib = 'netsnmp';
@@ -42,7 +41,7 @@ sub DefaultStoreInitMakeParams {
 	$Params{'LIBS'} = "-L" . $MakefileSubs::basedir . "\\win32\\$lib_dir\\ -l$snmp_link_lib";
       }
       else {
-	my @LibDirs = split (';',$ENV{LIB});
+	my @LibDirs = split($Config{path_sep}, $ENV{LIB});
         my $LibDir;
 	if ($opts->{'prefix'}) {
 	  push (@LibDirs,"$ENV{'NET-SNMP-PATH'}${sep}lib");
@@ -64,29 +63,18 @@ sub DefaultStoreInitMakeParams {
 	}
 	$Params{LIBS} = "-L$LibDir -l$snmp_link_lib";
       }
-
-      $Params{'INC'} = "-I" . $MakefileSubs::basedir . "\\include\\ -I" . $MakefileSubs::basedir . "\\include\\net-snmp\\ -I" . $MakefileSubs::basedir . "\\win32\\ ";
     }
     else {
-	$opts = NetSNMPGetOpts();
-	$Params{'LDDLFLAGS'} = "$Config{lddlflags} " . `$opts->{'nsconfig'} --ldflags`;
-	$Params{'LIBS'}    = `$opts->{'nsconfig'} --libs`;
+	$Params{'LIBS'}    = `$opts->{'nsconfig'} --libs` or
+	    die "net-snmp-config failed\n";
 	chomp($Params{'LIBS'});
-	$Params{'CCFLAGS'} = `$opts->{'nsconfig'} --cflags`;
-	chomp($Params{'CCFLAGS'});
-	$Params{'CCFLAGS'} .= " " . $Config{'ccflags'};
-        $lib_version = `$opts->{'nsconfig'} --version`;
+        $lib_version = `$opts->{'nsconfig'} --version` or
+	    die "net-snmp-config failed\n";
 	if (lc($opts->{'insource'}) eq "true") {
 	    $Params{'LIBS'} =
                 "-L" . abs_path("../../snmplib/.libs") .
                 " -L" . abs_path("../../snmplib") .
                 " " . $Params{'LIBS'};
-	    $Params{'CCFLAGS'} = "-I../../include " . $Params{'CCFLAGS'};
-	}
-	$Params{'CCFLAGS'} =~ s/ -W(all|inline|strict-prototypes|write-strings|cast-qual|no-char-subscripts)//g; # ignore developer warnings
-        $Params{'CCFLAGS'} .= ' -Wformat';
-	if ($Params{'LIBS'} eq "" || $Params{'CCFLAGS'} eq "") {
-	    die "You need to install net-snmp first (I can't find net-snmp-config)";
 	}
     }
 
diff -urpN net-snmp-5.8/perl/default_store/default_store.pm net-snmp-5.9.1/perl/default_store/default_store.pm
--- net-snmp-5.8/perl/default_store/default_store.pm	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/default_store/default_store.pm	2021-05-26 05:19:35.000000000 +0700
@@ -202,7 +202,7 @@ use vars qw(@ISA %EXPORT_TAGS @EXPORT_OK
 				   NETSNMP_DS_LIB_KSM_SERVICE_NAME
 				   NETSNMP_DS_LIB_SBSM_LOCAL_PWD
 );
-$VERSION = '5.08';
+$VERSION = '5.0901';
 
 sub AUTOLOAD {
     # This AUTOLOAD is used to 'autoload' constants from the constant()
diff -urpN net-snmp-5.8/perl/default_store/default_store.xs net-snmp-5.9.1/perl/default_store/default_store.xs
--- net-snmp-5.8/perl/default_store/default_store.xs	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/default_store/default_store.xs	2021-05-26 05:19:35.000000000 +0700
@@ -1,7 +1,3 @@
-#if defined(_WIN32) && !defined(_WIN32_WINNT)
-#define _WIN32_WINNT 0x501
-#endif
-
 #include "EXTERN.h"
 #include "perl.h"
 #include "XSUB.h"
diff -urpN net-snmp-5.8/perl/default_store/test.pl net-snmp-5.9.1/perl/default_store/test.pl
--- net-snmp-5.8/perl/default_store/test.pl	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/perl/default_store/test.pl	2021-05-26 05:19:35.000000000 +0700
@@ -1,131 +1,119 @@
-# Before `make install' is performed this script should be runnable with
-# `make test'. After `make install' it should work as `perl test.pl'
-
-######################### We start with some black magic to print on failure.
-
-# Change 1..1 below to 1..last_test_to_print .
-# (It may become useful if the test is moved to ./t subdirectory.)
+#!./perl
 
 use strict;
 use warnings;
+use Test;
 
 my %tests;
-my $loaded;
 
-BEGIN { $| = 1; 
+BEGIN {
+    # Force a flush after every print statement.
+    $| = 1;
+
+    %tests = ( 
+	"NETSNMP_DS_MAX_IDS"                     => 3,
+	"NETSNMP_DS_MAX_SUBIDS"                  => 48,
+	"NETSNMP_DS_LIBRARY_ID"                  => 0,
+	"NETSNMP_DS_APPLICATION_ID"              => 1,
+	"NETSNMP_DS_TOKEN_ID"                    => 2,
+	"NETSNMP_DS_LIB_MIB_ERRORS"              => 0,
+	"NETSNMP_DS_LIB_SAVE_MIB_DESCRS"         => 1,
+	"NETSNMP_DS_LIB_MIB_COMMENT_TERM"        => 2,
+	"NETSNMP_DS_LIB_MIB_PARSE_LABEL"         => 3,
+	"NETSNMP_DS_LIB_DUMP_PACKET"             => 4,
+	"NETSNMP_DS_LIB_LOG_TIMESTAMP"           => 5,
+	"NETSNMP_DS_LIB_DONT_READ_CONFIGS"       => 6,
+	"NETSNMP_DS_LIB_MIB_REPLACE"             => 7,
+	"NETSNMP_DS_LIB_PRINT_NUMERIC_ENUM"      => 8,
+	"NETSNMP_DS_LIB_PRINT_NUMERIC_OIDS"      => 9,
+	"NETSNMP_DS_LIB_DONT_BREAKDOWN_OIDS"     => 10,
+	"NETSNMP_DS_LIB_ALARM_DONT_USE_SIG"      => 11,
+	"NETSNMP_DS_LIB_PRINT_FULL_OID"          => 12,
+	"NETSNMP_DS_LIB_QUICK_PRINT"             => 13,
+	"NETSNMP_DS_LIB_RANDOM_ACCESS"           => 14,
+	"NETSNMP_DS_LIB_REGEX_ACCESS"            => 15,
+	"NETSNMP_DS_LIB_DONT_CHECK_RANGE"        => 16,
+	"NETSNMP_DS_LIB_NO_TOKEN_WARNINGS"       => 17,
+	"NETSNMP_DS_LIB_NUMERIC_TIMETICKS"       => 18,
+	"NETSNMP_DS_LIB_ESCAPE_QUOTES"           => 19,
+	"NETSNMP_DS_LIB_REVERSE_ENCODE"          => 20,
+	"NETSNMP_DS_LIB_PRINT_BARE_VALUE"        => 21,
+	"NETSNMP_DS_LIB_EXTENDED_INDEX"          => 22,
+	"NETSNMP_DS_LIB_PRINT_HEX_TEXT"          => 23,
+	"NETSNMP_DS_LIB_PRINT_UCD_STYLE_OID"     => 24,
+	"NETSNMP_DS_LIB_READ_UCD_STYLE_OID"      => 25,
+	"NETSNMP_DS_LIB_HAVE_READ_PREMIB_CONFIG" => 26,
+	"NETSNMP_DS_LIB_HAVE_READ_CONFIG"        => 27,
+	"NETSNMP_DS_LIB_QUICKE_PRINT"            => 28,
+	"NETSNMP_DS_LIB_DONT_PRINT_UNITS"        => 29,
+	"NETSNMP_DS_LIB_NO_DISPLAY_HINT"         => 30,
+	"NETSNMP_DS_LIB_16BIT_IDS"               => 31,
+	"NETSNMP_DS_LIB_DONT_PERSIST_STATE"      => 32,
+	"NETSNMP_DS_LIB_2DIGIT_HEX_OUTPUT"       => 33,
+	"NETSNMP_DS_LIB_IGNORE_NO_COMMUNITY"     => 34,
+	"NETSNMP_DS_LIB_DISABLE_PERSISTENT_LOAD" => 35,
+	"NETSNMP_DS_LIB_DISABLE_PERSISTENT_SAVE" => 36,
+	"NETSNMP_DS_LIB_APPEND_LOGFILES"         => 37,
+	"NETSNMP_DS_LIB_CLIENT_ADDR_USES_PORT"   => 42,
+	"NETSNMP_DS_LIB_MIB_WARNINGS"            => 0,
+	"NETSNMP_DS_LIB_SECLEVEL"                => 1,
+	"NETSNMP_DS_LIB_SNMPVERSION"             => 2,
+	"NETSNMP_DS_LIB_DEFAULT_PORT"            => 3,
+	"NETSNMP_DS_LIB_OID_OUTPUT_FORMAT"       => 4,
+	"NETSNMP_DS_LIB_STRING_OUTPUT_FORMAT"    => 5,
+	"NETSNMP_DS_LIB_HEX_OUTPUT_LENGTH"       => 6,
+	"NETSNMP_DS_LIB_SERVERSENDBUF"           => 7,
+	"NETSNMP_DS_LIB_SERVERRECVBUF"           => 8,
+	"NETSNMP_DS_LIB_CLIENTSENDBUF"           => 9,
+	"NETSNMP_DS_LIB_CLIENTRECVBUF"           => 10,
+	"NETSNMP_DS_SNMP_VERSION_1"              => 128,
+	"NETSNMP_DS_SNMP_VERSION_2c"             => 1,
+	"NETSNMP_DS_SNMP_VERSION_3"              => 3,
+	"NETSNMP_DS_LIB_SECNAME"                 => 0,
+	"NETSNMP_DS_LIB_CONTEXT"                 => 1,
+	"NETSNMP_DS_LIB_PASSPHRASE"              => 2,
+	"NETSNMP_DS_LIB_AUTHPASSPHRASE"          => 3,
+	"NETSNMP_DS_LIB_PRIVPASSPHRASE"          => 4,
+	"NETSNMP_DS_LIB_OPTIONALCONFIG"          => 5,
+	"NETSNMP_DS_LIB_APPTYPE"                 => 6,
+	"NETSNMP_DS_LIB_COMMUNITY"               => 7,
+	"NETSNMP_DS_LIB_PERSISTENT_DIR"          => 8,
+	"NETSNMP_DS_LIB_CONFIGURATION_DIR"       => 9,
+	"NETSNMP_DS_LIB_SECMODEL"                => 10,
+	"NETSNMP_DS_LIB_MIBDIRS"                 => 11,
+	"NETSNMP_DS_LIB_OIDSUFFIX"               => 12,
+	"NETSNMP_DS_LIB_OIDPREFIX"               => 13,
+	"NETSNMP_DS_LIB_CLIENT_ADDR"             => 14,
+	"NETSNMP_DS_LIB_TEMP_FILE_PATTERN"       => 15,
+	"NETSNMP_DS_LIB_AUTHMASTERKEY"           => 16,
+	"NETSNMP_DS_LIB_PRIVMASTERKEY"           => 17,
+	"NETSNMP_DS_LIB_AUTHLOCALIZEDKEY"        => 18,
+	"NETSNMP_DS_LIB_PRIVLOCALIZEDKEY"        => 19,
+	"NETSNMP_DS_LIB_APPTYPES"                => 20,
+	"NETSNMP_DS_LIB_KSM_KEYTAB"              => 21,
+	"NETSNMP_DS_LIB_KSM_SERVICE_NAME"        => 22,
+	);
+
+    plan tests => scalar(keys(%tests)) + 10; 
+}
 
-	%tests = ( 
-                  "NETSNMP_DS_MAX_IDS"                     => 3,
-                  "NETSNMP_DS_MAX_SUBIDS"                  => 48,
-                  "NETSNMP_DS_LIBRARY_ID"                  => 0,
-                  "NETSNMP_DS_APPLICATION_ID"              => 1,
-                  "NETSNMP_DS_TOKEN_ID"                    => 2,
-                  "NETSNMP_DS_LIB_MIB_ERRORS"              => 0,
-                  "NETSNMP_DS_LIB_SAVE_MIB_DESCRS"         => 1,
-                  "NETSNMP_DS_LIB_MIB_COMMENT_TERM"        => 2,
-                  "NETSNMP_DS_LIB_MIB_PARSE_LABEL"         => 3,
-                  "NETSNMP_DS_LIB_DUMP_PACKET"             => 4,
-                  "NETSNMP_DS_LIB_LOG_TIMESTAMP"           => 5,
-                  "NETSNMP_DS_LIB_DONT_READ_CONFIGS"       => 6,
-                  "NETSNMP_DS_LIB_MIB_REPLACE"             => 7,
-                  "NETSNMP_DS_LIB_PRINT_NUMERIC_ENUM"      => 8,
-                  "NETSNMP_DS_LIB_PRINT_NUMERIC_OIDS"      => 9,
-                  "NETSNMP_DS_LIB_DONT_BREAKDOWN_OIDS"     => 10,
-                  "NETSNMP_DS_LIB_ALARM_DONT_USE_SIG"      => 11,
-                  "NETSNMP_DS_LIB_PRINT_FULL_OID"          => 12,
-                  "NETSNMP_DS_LIB_QUICK_PRINT"             => 13,
-                  "NETSNMP_DS_LIB_RANDOM_ACCESS"           => 14,
-                  "NETSNMP_DS_LIB_REGEX_ACCESS"            => 15,
-                  "NETSNMP_DS_LIB_DONT_CHECK_RANGE"        => 16,
-                  "NETSNMP_DS_LIB_NO_TOKEN_WARNINGS"       => 17,
-                  "NETSNMP_DS_LIB_NUMERIC_TIMETICKS"       => 18,
-                  "NETSNMP_DS_LIB_ESCAPE_QUOTES"           => 19,
-                  "NETSNMP_DS_LIB_REVERSE_ENCODE"          => 20,
-                  "NETSNMP_DS_LIB_PRINT_BARE_VALUE"        => 21,
-                  "NETSNMP_DS_LIB_EXTENDED_INDEX"          => 22,
-                  "NETSNMP_DS_LIB_PRINT_HEX_TEXT"          => 23,
-                  "NETSNMP_DS_LIB_PRINT_UCD_STYLE_OID"     => 24,
-                  "NETSNMP_DS_LIB_READ_UCD_STYLE_OID"      => 25,
-                  "NETSNMP_DS_LIB_HAVE_READ_PREMIB_CONFIG" => 26,
-                  "NETSNMP_DS_LIB_HAVE_READ_CONFIG"        => 27,
-                  "NETSNMP_DS_LIB_QUICKE_PRINT"            => 28,
-                  "NETSNMP_DS_LIB_DONT_PRINT_UNITS"        => 29,
-                  "NETSNMP_DS_LIB_NO_DISPLAY_HINT"         => 30,
-                  "NETSNMP_DS_LIB_16BIT_IDS"               => 31,
-                  "NETSNMP_DS_LIB_DONT_PERSIST_STATE"      => 32,
-                  "NETSNMP_DS_LIB_2DIGIT_HEX_OUTPUT"       => 33,
-                  "NETSNMP_DS_LIB_IGNORE_NO_COMMUNITY"     => 34,
-                  "NETSNMP_DS_LIB_DISABLE_PERSISTENT_LOAD" => 35,
-                  "NETSNMP_DS_LIB_DISABLE_PERSISTENT_SAVE" => 36,
-                  "NETSNMP_DS_LIB_APPEND_LOGFILES"         => 37,
-                  "NETSNMP_DS_LIB_CLIENT_ADDR_USES_PORT"   => 42,
-                  "NETSNMP_DS_LIB_MIB_WARNINGS"            => 0,
-                  "NETSNMP_DS_LIB_SECLEVEL"                => 1,
-                  "NETSNMP_DS_LIB_SNMPVERSION"             => 2,
-                  "NETSNMP_DS_LIB_DEFAULT_PORT"            => 3,
-                  "NETSNMP_DS_LIB_OID_OUTPUT_FORMAT"       => 4,
-                  "NETSNMP_DS_LIB_STRING_OUTPUT_FORMAT"    => 5,
-                  "NETSNMP_DS_LIB_HEX_OUTPUT_LENGTH"       => 6,
-                  "NETSNMP_DS_LIB_SERVERSENDBUF"           => 7,
-                  "NETSNMP_DS_LIB_SERVERRECVBUF"           => 8,
-                  "NETSNMP_DS_LIB_CLIENTSENDBUF"           => 9,
-                  "NETSNMP_DS_LIB_CLIENTRECVBUF"           => 10,
-                  "NETSNMP_DS_SNMP_VERSION_1"              => 128,
-                  "NETSNMP_DS_SNMP_VERSION_2c"             => 1,
-                  "NETSNMP_DS_SNMP_VERSION_3"              => 3,
-                  "NETSNMP_DS_LIB_SECNAME"                 => 0,
-                  "NETSNMP_DS_LIB_CONTEXT"                 => 1,
-                  "NETSNMP_DS_LIB_PASSPHRASE"              => 2,
-                  "NETSNMP_DS_LIB_AUTHPASSPHRASE"          => 3,
-                  "NETSNMP_DS_LIB_PRIVPASSPHRASE"          => 4,
-                  "NETSNMP_DS_LIB_OPTIONALCONFIG"          => 5,
-                  "NETSNMP_DS_LIB_APPTYPE"                 => 6,
-                  "NETSNMP_DS_LIB_COMMUNITY"               => 7,
-                  "NETSNMP_DS_LIB_PERSISTENT_DIR"          => 8,
-                  "NETSNMP_DS_LIB_CONFIGURATION_DIR"       => 9,
-                  "NETSNMP_DS_LIB_SECMODEL"                => 10,
-                  "NETSNMP_DS_LIB_MIBDIRS"                 => 11,
-                  "NETSNMP_DS_LIB_OIDSUFFIX"               => 12,
-                  "NETSNMP_DS_LIB_OIDPREFIX"               => 13,
-                  "NETSNMP_DS_LIB_CLIENT_ADDR"             => 14,
-                  "NETSNMP_DS_LIB_TEMP_FILE_PATTERN"       => 15,
-                  "NETSNMP_DS_LIB_AUTHMASTERKEY"           => 16,
-                  "NETSNMP_DS_LIB_PRIVMASTERKEY"           => 17,
-                  "NETSNMP_DS_LIB_AUTHLOCALIZEDKEY"        => 18,
-                  "NETSNMP_DS_LIB_PRIVLOCALIZEDKEY"        => 19,
-                  "NETSNMP_DS_LIB_APPTYPES"                => 20,
-                  "NETSNMP_DS_LIB_KSM_KEYTAB"              => 21,
-                  "NETSNMP_DS_LIB_KSM_SERVICE_NAME"        => 22,
-		  );
-
-	print "1.." . (scalar(keys(%tests)) + 10) . "\n"; 
-    }
-END {print "not ok 1\n" unless $loaded;}
 use NetSNMP::default_store (':all');
-$loaded = 1;
-print "ok 1\n";
+ok(1);
 
 ######################### End of black magic.
 
-# Insert your test code below (better if it prints "ok 13"
-# (correspondingly "not ok 13") depending on the success of chunk 13
-# of the test code):
-
-print ((netsnmp_ds_set_string(1, 1, "hi there") == 0) ? "ok 2\n" : "not ok 2\n"); 
-print ((netsnmp_ds_get_string(1, 1) eq "hi there") ? "ok 3\n" : "not ok 3\n"); 
-print ((netsnmp_ds_set_int(1, 1, 42) == 0) ? "ok 4\n" : "not ok 4\n"); 
-print ((netsnmp_ds_get_int(1, 1) == 42) ? "ok 5\n" : "not ok 5\n"); 
-print ((netsnmp_ds_get_int(1, 2) == 0) ? "ok 6\n" : "not ok 6\n"); 
-print ((NETSNMP_DS_LIB_REGEX_ACCESS == 15) ? "ok 7\n" : "not ok 7\n"); 
-print ((netsnmp_ds_get_int(NETSNMP_DS_APPLICATION_ID, 1) == 42) ? "ok 8\n" : "not ok 8\n"); 
-print ((netsnmp_ds_set_int(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_DEFAULT_PORT, 9161) == 0) ? "ok 9\n" : "not ok 9\n");
-print ((netsnmp_ds_get_int(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_DEFAULT_PORT) == 9161) ? "ok 10\n" : "not ok 10\n");
+ok(netsnmp_ds_set_string(1, 1, "hi there") == 0); 
+ok(netsnmp_ds_get_string(1, 1) eq "hi there"); 
+ok(netsnmp_ds_set_int(1, 1, 42) == 0); 
+ok(netsnmp_ds_get_int(1, 1) == 42); 
+ok(netsnmp_ds_get_int(1, 2) == 0); 
+ok(NETSNMP_DS_LIB_REGEX_ACCESS == 15); 
+ok(netsnmp_ds_get_int(NETSNMP_DS_APPLICATION_ID, 1) == 42); 
+ok(netsnmp_ds_set_int(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_DEFAULT_PORT, 9161) == 0);
+ok(netsnmp_ds_get_int(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_DEFAULT_PORT) == 9161);
 
-my $c = 10;
 foreach my $i (keys(%tests)) {
-    my $str = "NetSNMP::default_store::$i";
-    my $val = eval $str;
-#    print "$i -> $val -> $tests{$i}\n";
-    $c++;
-    print (($val eq $tests{$i})?"ok $c\n" : "not ok $c\n#  error:  name=$i value_expected=$tests{$i}  value_got=$val \n");
+    my $val = eval("NetSNMP::default_store::$i");
+    # print "$i -> $val -> $tests{$i}\n";
+    ok($val eq $tests{$i});
 }
diff -urpN net-snmp-5.8/python/netsnmp/__init__.py net-snmp-5.9.1/python/netsnmp/__init__.py
--- net-snmp-5.8/python/netsnmp/__init__.py	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/python/netsnmp/__init__.py	2021-05-26 05:19:35.000000000 +0700
@@ -1 +1 @@
-from client import *
+from .client import *
diff -urpN net-snmp-5.8/python/netsnmp/client.py net-snmp-5.9.1/python/netsnmp/client.py
--- net-snmp-5.8/python/netsnmp/client.py	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/python/netsnmp/client.py	2021-05-26 05:19:35.000000000 +0700
@@ -1,3 +1,4 @@
+from __future__ import print_function
 import re
 from sys import stderr
 import netsnmp
@@ -34,12 +35,12 @@ def _parse_session_args(kargs):
         'TheirHostname':'',
         'TrustCert':''
         }
-    keys = kargs.keys()
+    keys = list(kargs.keys())
     for key in keys:
-        if sessArgs.has_key(key):
+        if key in sessArgs:
             sessArgs[key] = kargs[key]
         else:
-            print >>stderr, "ERROR: unknown key", key
+            print("ERROR: unknown key", key, file=stderr)
     return sessArgs
 
 def STR(obj):
@@ -132,7 +133,7 @@ class Session(object):
 
         sess_args = _parse_session_args(args)
 
-        for k, v in sess_args.items():
+        for k, v in list(sess_args.items()):
             self.__dict__[k] = v
 
 
diff -urpN net-snmp-5.8/python/netsnmp/client_intf.c net-snmp-5.9.1/python/netsnmp/client_intf.c
--- net-snmp-5.8/python/netsnmp/client_intf.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/python/netsnmp/client_intf.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,3 +1,5 @@
+#define PY_SSIZE_T_CLEAN
+
 #include <Python.h>
 
 #if PY_VERSION_HEX < 0x02050000
@@ -43,18 +45,7 @@ typedef int Py_ssize_t;
 
 typedef netsnmp_session SnmpSession;
 typedef struct tree SnmpMibNode;
-static int __is_numeric_oid (char*);
-static int __is_leaf (struct tree*);
-static int __translate_asn_type (int);
-static int __snprint_value (char **, size_t *,
-                            netsnmp_variable_list*, struct tree *,
-                            int, int);
-static int __sprint_num_objid (char **, size_t *, oid *, int);
-static int __scan_num_objid (char *, oid *, size_t *);
-static int __get_type_str (int, char *);
-static int __get_label_iid (char *, char **, char **, int);
-static struct tree * __tag2oid (char *, char *, oid  *, int  *, int *, int);
-static int __concat_oid_str (oid *, int *, char *);
+
 #define USE_NUMERIC_OIDS 0x08
 #define NON_LEAF_NAME 0x04
 #define USE_LONG_NAMES 0x02
@@ -63,45 +54,6 @@ static int __concat_oid_str (oid *, int
 
 static int _debug_level;
 
-
-void
-__libraries_init(char *appname)
-{
-  static int have_inited = 0;
-
-  if (have_inited)
-    return;
-  have_inited = 1;
-
-  netsnmp_ds_set_boolean(NETSNMP_DS_LIBRARY_ID,
-                         NETSNMP_DS_LIB_QUICK_PRINT, 1);
-  snmp_enable_stderrlog();
-  init_snmp(appname);
-
-  netsnmp_ds_set_boolean(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_DONT_BREAKDOWN_OIDS, 1);
-  netsnmp_ds_set_int(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_PRINT_SUFFIX_ONLY, 1);
-  netsnmp_ds_set_int(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_OID_OUTPUT_FORMAT,
-		     NETSNMP_OID_OUTPUT_SUFFIX);
-}
-
-static int
-__is_numeric_oid(char* oidstr)
-{
-  if (!oidstr) return 0;
-  for (; *oidstr; oidstr++) {
-     if (isalpha((int)*oidstr)) return 0;
-  }
-  return(1);
-}
-
-static int
-__is_leaf(struct tree* tp)
-{
-   char buf[MAX_TYPE_NAME_LEN];
-   return (tp && (__get_type_str(tp->type,buf) ||
-		  (tp->parent && __get_type_str(tp->parent->type,buf) )));
-}
-
 struct type_table_entry {
     uint8_t	mib_type;
     uint8_t	asn_type;
@@ -137,6 +89,69 @@ static const struct type_table_entry typ
     { }
 };
 
+
+void
+__libraries_init(const char *appname)
+{
+  static int have_inited = 0;
+
+  if (have_inited)
+    return;
+  have_inited = 1;
+
+  netsnmp_ds_set_boolean(NETSNMP_DS_LIBRARY_ID,
+                         NETSNMP_DS_LIB_QUICK_PRINT, 1);
+  snmp_enable_stderrlog();
+  init_snmp(appname);
+
+  netsnmp_ds_set_boolean(NETSNMP_DS_LIBRARY_ID,
+                         NETSNMP_DS_LIB_DONT_BREAKDOWN_OIDS, 1);
+  netsnmp_ds_set_int(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_PRINT_SUFFIX_ONLY,
+                     1);
+  netsnmp_ds_set_int(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_OID_OUTPUT_FORMAT,
+		     NETSNMP_OID_OUTPUT_SUFFIX);
+}
+
+static int
+__is_numeric_oid(const char *oidstr)
+{
+  if (!oidstr)
+      return 0;
+  for (; *oidstr; oidstr++) {
+     if (isalpha((unsigned char)*oidstr))
+         return 0;
+  }
+  return 1;
+}
+
+static int
+__get_type_str(int type, char *str)
+{
+    const struct type_table_entry *e;
+
+    for (e = type_table; e->name; e++) {
+        if (type == e->mib_type) {
+            strcpy(str, e->name);
+            return SUCCESS;
+        }
+    }
+
+    strcpy(str, "");
+    if (_debug_level)
+        printf("__get_type_str:FAILURE(%d)\n", type);
+
+    return FAILURE;
+}
+
+static int
+__is_leaf(struct tree* tp)
+{
+   char buf[MAX_TYPE_NAME_LEN];
+
+   return tp && (__get_type_str(tp->type,buf) ||
+                 (tp->parent && __get_type_str(tp->parent->type,buf)));
+}
+
 #ifndef NETSNMP_NO_WRITE_SUPPORT
 static int
 __translate_appl_type(const char *typestr)
@@ -185,19 +200,33 @@ static void *enlarge_buffer(char **buf,
     return *buf;
 }
 
+static int
+__sprint_num_objid(char **buf, size_t *buf_len, const oid *objid, int len)
+{
+   char *p, *end;
+   int i;
+
+   enlarge_buffer(buf, buf_len, len * 16);
+   p = *buf;
+   end = *buf + *buf_len;
+   (*buf)[0] = '\0';
+   for (i = 0; i < len; i++)
+       p += snprintf(p, end - p, ".%lu", *objid++);
+
+   return SUCCESS;
+}
+
 #define USE_BASIC 0
 #define USE_ENUMS 1
 #define USE_SPRINT_VALUE 2
 static int
-__snprint_value(char **buf, size_t *buf_len, netsnmp_variable_list *var,
-                struct tree *tp, int type, int flag)
+__snprint_value(char **buf, size_t *buf_len, const netsnmp_variable_list *var,
+                const struct tree *tp, int type, int flag)
 {
-   size_t out_len = 0;
-   int len = 0;
+   size_t out_len = 0, len = 0;
    u_char* ip;
    struct enum_list *ep;
 
-
    enlarge_buffer(buf, buf_len, 32);
    (*buf)[0] = '\0';
    if (flag == USE_SPRINT_VALUE) {
@@ -228,7 +257,7 @@ __snprint_value(char **buf, size_t *buf_
         case ASN_COUNTER:
         case ASN_TIMETICKS:
         case ASN_UINTEGER:
-           snprintf(*buf, *buf_len, "%lu", (unsigned long) *var->val.integer);
+           snprintf(*buf, *buf_len, "%lu", *var->val.integer);
            len = STRLEN(*buf);
            break;
 
@@ -251,8 +280,8 @@ __snprint_value(char **buf, size_t *buf_
            break;
 
         case ASN_OBJECT_ID:
-          __sprint_num_objid(buf, buf_len, (oid *)(var->val.objid),
-                             var->val_len/sizeof(oid));
+          __sprint_num_objid(buf, buf_len, var->val.objid,
+                             var->val_len / sizeof(oid));
           len = STRLEN(*buf);
           break;
 
@@ -271,13 +300,13 @@ __snprint_value(char **buf, size_t *buf_
         case ASN_OPAQUE_COUNTER64:
         case ASN_OPAQUE_U64:
 #endif
-          printU64(*buf,(struct counter64 *)var->val.counter64);
+          printU64(*buf, var->val.counter64);
           len = STRLEN(*buf);
           break;
 
 #ifdef OPAQUE_SPECIAL_TYPES
         case ASN_OPAQUE_I64:
-          printI64(*buf,(struct counter64 *)var->val.counter64);
+          printI64(*buf, var->val.counter64);
           len = STRLEN(*buf);
           break;
 #endif
@@ -310,27 +339,13 @@ __snprint_value(char **buf, size_t *buf_
 }
 
 static int
-__sprint_num_objid(char **buf, size_t *buf_len, oid *objid, int len)
+__scan_num_objid(const char *buf, oid *objid, size_t *len)
 {
-   char *p, *end;
-   int i;
+   const char *cp;
 
-   enlarge_buffer(buf, buf_len, len * 16);
-   p = *buf;
-   end = *buf + *buf_len;
-   (*buf)[0] = '\0';
-   for (i = 0; i < len; i++)
-       p += snprintf(p, end - p, ".%lu", *objid++);
-
-   return SUCCESS;
-}
-
-static int
-__scan_num_objid(char *buf, oid *objid, size_t *len)
-{
-   char *cp;
    *len = 0;
-   if (*buf == '.') buf++;
+   if (*buf == '.')
+       buf++;
    cp = buf;
    while (*buf) {
       if (*buf++ == '.') {
@@ -339,7 +354,7 @@ __scan_num_objid(char *buf, oid *objid,
          (*len)++;
          cp = buf;
       } else {
-         if (isalpha((int)*buf)) {
+         if (isalpha((unsigned char)*buf)) {
 	    return FAILURE;
          }
       }
@@ -350,30 +365,11 @@ __scan_num_objid(char *buf, oid *objid,
    return SUCCESS;
 }
 
-static int
-__get_type_str(int type, char * str)
-{
-    const struct type_table_entry *e;
-
-    for (e = type_table; e->name; e++) {
-        if (type == e->mib_type) {
-            strcpy(str, e->name);
-            return SUCCESS;
-        }
-    }
-
-    strcpy(str, "");
-    if (_debug_level)
-        printf("__get_type_str:FAILURE(%d)\n", type);
-
-    return FAILURE;
-}
-
-/* does a destructive disection of <label1>...<labeln>.<iid> returning
+/* does a destructive dissection of <label1>...<labeln>.<iid> returning
    <labeln> and <iid> in seperate strings (note: will destructively
    alter input string, 'name') */
 static int
-__get_label_iid(char *name, char **last_label, char **iid, int flag)
+__get_label_iid(char *name, const char **last_label, const char **iid, int flag)
 {
    char *lcp;
    char *icp;
@@ -382,45 +378,45 @@ __get_label_iid(char *name, char **last_
 
    *last_label = *iid = NULL;
 
-   if (len == 0) return(FAILURE);
+   if (len == 0)
+       return FAILURE;
 
    /* Handle case where numeric oid's have been requested.  The input 'name'
    ** in this case should be a numeric OID -- return failure if not.
    */
    if ((flag & USE_NUMERIC_OIDS)) {
       if (!__is_numeric_oid(name))
-       return(FAILURE);
+         return FAILURE;
 
       /* Walk backward through the string, looking for first two '.' chars */
       lcp = &(name[len]);
       icp = NULL;
       while (lcp > name) {
-       if (*lcp == '.') {
-
-          /* If this is the first occurence of '.', note it in icp.
-          ** Otherwise, this must be the second occurrence, so break
-          ** out of the loop.
-          */
-          if (icp == NULL)
-             icp = lcp;
-          else
-             break;
-       }
-       lcp --;
+         if (*lcp == '.') {
+            /* If this is the first occurrence of '.', note it in icp.
+            ** Otherwise, this must be the second occurrence, so break
+            ** out of the loop.
+            */
+            if (icp == NULL)
+               icp = lcp;
+            else
+               break;
+         }
+         lcp --;
       }
 
       /* Make sure we found at least a label and index. */
       if (!icp)
-         return(FAILURE);
+         return FAILURE;
 
       /* Push forward past leading '.' chars and separate the strings. */
-      lcp ++;
-      *icp ++ = '\0';
+      lcp++;
+      *icp++ = '\0';
 
-      *last_label = (flag & USE_LONG_NAMES) ? name : lcp;
+      *last_label = flag & USE_LONG_NAMES ? name : lcp;
       *iid        = icp;
 
-      return(SUCCESS);
+      return SUCCESS;
    }
 
    lcp = icp = &(name[len]);
@@ -434,12 +430,14 @@ __get_label_iid(char *name, char **last_
            icp = lcp;
         }
       }
-      if (!found_label && isalpha((int)*lcp)) found_label = 1;
+      if (!found_label && isalpha((unsigned char)*lcp))
+         found_label = 1;
       lcp--;
    }
 
-   if (!found_label || (!isdigit((int)*(icp+1)) && (flag & FAIL_ON_NULL_IID)))
-      return(FAILURE);
+   if (!found_label || (!isdigit((unsigned char)*(icp+1)) &&
+                        (flag & FAIL_ON_NULL_IID)))
+      return FAILURE;
 
    if (flag & NON_LEAF_NAME) { /* dont know where to start instance id */
      /* put the whole thing in label */
@@ -471,23 +469,58 @@ __get_label_iid(char *name, char **last_
 
    *iid = icp;
 
-   return(SUCCESS);
+   return SUCCESS;
+}
+
+/* function: __concat_oid_str
+ *
+ * This function converts a dotted-decimal string, soid_str, to an array
+ * of oid types and concatenates them on doid_arr begining at the index
+ * specified by doid_arr_len.
+ *
+ * returns : SUCCESS, FAILURE
+ */
+static int
+__concat_oid_str(oid *doid_arr, size_t *doid_arr_len, const char *soid_str)
+{
+   char *soid_buf;
+   char *cp;
+   char *st;
+
+   if (!soid_str || !*soid_str)
+      return SUCCESS; /* successfully added nothing */
+   if (*soid_str == '.')
+      soid_str++;
+   soid_buf = strdup(soid_str);
+   if (!soid_buf)
+       return FAILURE;
+   cp = strtok_r(soid_buf,".",&st);
+   while (cp) {
+     sscanf(cp, "%lu", &(doid_arr[(*doid_arr_len)++]));
+     /* doid_arr[(*doid_arr_len)++] =  atoi(cp); */
+     cp = strtok_r(NULL,".",&st);
+   }
+   free(soid_buf);
+   return SUCCESS;
 }
 
 /* Convert a tag (string) to an OID array              */
 /* Tag can be either a symbolic name, or an OID string */
 static struct tree *
-__tag2oid(char *tag, char *iid, oid  *oid_arr, int  *oid_arr_len, int *type,
-          int best_guess)
+__tag2oid(const char *tag, const char *iid, oid *oid_arr, size_t *oid_arr_len,
+          int *type, int best_guess)
 {
    struct tree *tp = NULL;
    struct tree *rtp = NULL;
    oid newname[MAX_OID_LEN], *op;
    size_t newname_len = 0;
 
-   if (type) *type = TYPE_UNKNOWN;
-   if (oid_arr_len) *oid_arr_len = 0;
-   if (!tag) goto done;
+   if (type)
+      *type = TYPE_UNKNOWN;
+   if (oid_arr_len)
+      *oid_arr_len = 0;
+   if (!tag)
+      goto done;
 
    /*********************************************************/
    /* best_guess = 0 - same as no switches (read_objid)     */
@@ -522,9 +555,11 @@ __tag2oid(char *tag, char *iid, oid  *oi
      else {
        rtp = tp = get_tree(newname, newname_len, get_tree_head());
      }
-     if (type) *type = (tp ? tp->type : TYPE_UNKNOWN);
-     if ((oid_arr == NULL) || (oid_arr_len == NULL)) return rtp;
-     memcpy(oid_arr,(char*)newname,newname_len*sizeof(oid));
+     if (type)
+        *type = (tp ? tp->type : TYPE_UNKNOWN);
+     if ((oid_arr == NULL) || (oid_arr_len == NULL))
+        return rtp;
+     memcpy(oid_arr, newname, newname_len * sizeof(oid));
      *oid_arr_len = newname_len;
    }
 
@@ -546,9 +581,11 @@ __tag2oid(char *tag, char *iid, oid  *oi
       else {
 	rtp = tp = get_tree(newname, newname_len, get_tree_head());
       }
-      if (type) *type = (tp ? tp->type : TYPE_UNKNOWN);
-      if ((oid_arr == NULL) || (oid_arr_len == NULL)) return rtp;
-      memcpy(oid_arr,(char*)newname,newname_len*sizeof(oid));
+      if (type)
+         *type = (tp ? tp->type : TYPE_UNKNOWN);
+      if ((oid_arr == NULL) || (oid_arr_len == NULL))
+         return rtp;
+      memcpy(oid_arr, newname, newname_len*sizeof(oid));
       *oid_arr_len = newname_len;
    }
 
@@ -557,8 +594,10 @@ __tag2oid(char *tag, char *iid, oid  *oi
    else {
       rtp = tp = find_node(tag, get_tree_head());
       if (tp) {
-         if (type) *type = tp->type;
-         if ((oid_arr == NULL) || (oid_arr_len == NULL)) return rtp;
+         if (type)
+            *type = tp->type;
+         if ((oid_arr == NULL) || (oid_arr_len == NULL))
+            return rtp;
          /* code taken from get_node in snmp_client.c */
          for(op = newname + MAX_OID_LEN - 1; op >= newname; op--){
            *op = tp->subid;
@@ -578,43 +617,13 @@ __tag2oid(char *tag, char *iid, oid  *oi
    return(rtp);
 }
 
-/* function: __concat_oid_str
- *
- * This function converts a dotted-decimal string, soid_str, to an array
- * of oid types and concatenates them on doid_arr begining at the index
- * specified by doid_arr_len.
- *
- * returns : SUCCESS, FAILURE
- */
-static int
-__concat_oid_str(oid *doid_arr, int *doid_arr_len, char *soid_str)
-{
-   char *soid_buf;
-   char *cp;
-   char *st;
-
-   if (!soid_str || !*soid_str) return SUCCESS;/* successfully added nothing */
-   if (*soid_str == '.') soid_str++;
-   soid_buf = strdup(soid_str);
-   if (!soid_buf)
-       return FAILURE;
-   cp = strtok_r(soid_buf,".",&st);
-   while (cp) {
-     sscanf(cp, "%lu", &(doid_arr[(*doid_arr_len)++]));
-     /* doid_arr[(*doid_arr_len)++] =  atoi(cp); */
-     cp = strtok_r(NULL,".",&st);
-   }
-   free(soid_buf);
-   return(SUCCESS);
-}
-
 #ifndef NETSNMP_NO_WRITE_SUPPORT
 /*
  * add a varbind to PDU
  */
 static int
-__add_var_val_str(netsnmp_pdu *pdu, oid *name, int name_length, char *val,
-                  int len, int type)
+__add_var_val_str(netsnmp_pdu *pdu, const oid *name, int name_length,
+                  const char *val, int len, int type)
 {
     netsnmp_variable_list *vars;
     oid oidbuf[MAX_OID_LEN];
@@ -684,11 +693,9 @@ UINT:
       case TYPE_OPAQUE:
         vars->type = ASN_OCTET_STR;
 OCT:
-        vars->val.string = malloc(len);
+        vars->val.string = netsnmp_memdup(val, len);
         vars->val_len = len;
-        if (val && len)
-            memcpy((char *)vars->val.string, val, len);
-        else {
+        if (!vars->val.string && len) {
             ret = FAILURE;
             vars->val.string = (u_char*)strdup("");
             vars->val_len = 0;
@@ -739,8 +746,9 @@ OCT:
 /* takes ss and pdu as input and updates the 'response' argument */
 /* the input 'pdu' argument will be freed */
 static int
-__send_sync_pdu(netsnmp_session *ss, netsnmp_pdu *pdu, netsnmp_pdu **response,
-                int retry_nosuch, char *err_str, int *err_num, int *err_ind)
+__send_sync_pdu(struct session_list *ss, netsnmp_pdu *pdu,
+                netsnmp_pdu **response, int retry_nosuch,
+                char *err_str, int *err_num, int *err_ind)
 {
    int status = 0;
    long command = pdu->command;
@@ -766,7 +774,8 @@ retry:
    status = snmp_sess_synch_response(ss, pdu, response);
    Py_END_ALLOW_THREADS
 
-   if ((*response == NULL) && (status == STAT_SUCCESS)) status = STAT_ERROR;
+   if ((*response == NULL) && (status == STAT_SUCCESS))
+      status = STAT_ERROR;
 
    switch (status) {
       case STAT_SUCCESS:
@@ -776,9 +785,11 @@ retry:
 
             case SNMP_ERR_NOSUCHNAME:
                if (retry_nosuch && (pdu = snmp_fix_pdu(*response, command))) {
-                  if (*response) snmp_free_pdu(*response);
+                  if (*response)
+                     snmp_free_pdu(*response);
                   goto retry;
                }
+               /* fall through */
 
             /* Pv1, SNMPsec, Pv2p, v2c, v2u, v2*, and SNMPv3 PDUs */
             case SNMP_ERR_TOOBIG:
@@ -801,9 +812,9 @@ retry:
             /* in SNMPv2c, SNMPv2u, SNMPv2*, and SNMPv3 PDUs */
             case SNMP_ERR_INCONSISTENTNAME:
             default:
-               strlcpy(err_str, (char*)snmp_errstring((*response)->errstat),
+               strlcpy(err_str, snmp_errstring((*response)->errstat),
 		       STR_BUF_SIZE);
-               *err_num = (int)(*response)->errstat;
+               *err_num = (*response)->errstat;
 	       *err_ind = (*response)->errindex;
                status = (*response)->errstat;
                break;
@@ -818,14 +829,15 @@ retry:
 
       default:
          strcat(err_str, "send_sync_pdu: unknown status");
-         *err_num = ss->s_snmp_errno;
+         *err_num = ss->session->s_snmp_errno;
          break;
    }
 done:
    if (tmp_err_str) {
    	free(tmp_err_str);
    }
-   if (_debug_level && *err_num) printf("XXX sync PDU: %s\n", err_str);
+   if (_debug_level && *err_num)
+      printf("XXX sync PDU: %s\n", err_str);
    return(status);
 }
 
@@ -837,40 +849,51 @@ py_netsnmp_construct_varbind(void)
   PyObject *callable;
 
   module = PyImport_ImportModule("netsnmp");
+  if (!module)
+      return NULL;
   dict = PyModule_GetDict(module);
-
+  if (!dict)
+      return NULL;
   callable = PyDict_GetItemString(dict, "Varbind");
-
+  if (!callable)
+      return NULL;
   return PyObject_CallFunction(callable, "");
 }
 
+/*
+ * Retrieve attribute @attr_name of @obj, store it in buffer @val and
+ * store its length in *@len. Terminate @val with '\0' if @len == NULL.
+ */
 static int
-py_netsnmp_attr_string(PyObject *obj, char * attr_name, char **val,
-    Py_ssize_t *len)
+py_netsnmp_attr_string(PyObject *obj, const char *attr_name, const char **val,
+                       Py_ssize_t *len)
 {
   *val = NULL;
   if (obj && attr_name && PyObject_HasAttrString(obj, attr_name)) {
     PyObject *attr = PyObject_GetAttrString(obj, attr_name);
     if (attr) {
-      int retval;
-      retval = PyString_AsStringAndSize(attr, val, len);
+      *val = PyUnicode_AsUTF8AndSize(attr, len);
       Py_DECREF(attr);
-      return retval;
+      return 0;
     }
   }
 
   return -1;
 }
 
-static long long
-py_netsnmp_attr_long(PyObject *obj, char * attr_name)
+/*
+ * Retrieve attribute @attr_name of @obj and return it as a long. Returns -1
+ * on error.
+ */
+static long
+py_netsnmp_attr_long(PyObject *obj, const char *attr_name)
 {
-  long long val = -1;
+  long val = -1;
 
-  if (obj && attr_name  && PyObject_HasAttrString(obj, attr_name)) {
+  if (obj && attr_name && PyObject_HasAttrString(obj, attr_name)) {
     PyObject *attr = PyObject_GetAttrString(obj, attr_name);
     if (attr) {
-      val = PyInt_AsLong(attr);
+      val = PyLong_AsLong(attr);
       Py_DECREF(attr);
     }
   }
@@ -878,12 +901,16 @@ py_netsnmp_attr_long(PyObject *obj, char
   return val;
 }
 
+/*
+ * Retrieve attribute @attr_name of @obj and return it as a void ponter.
+ * Returns NULL on error.
+ */
 static void *
-py_netsnmp_attr_void_ptr(PyObject *obj, char * attr_name)
+py_netsnmp_attr_void_ptr(PyObject *obj, const char *attr_name)
 {
   void *val = NULL;
 
-  if (obj && attr_name  && PyObject_HasAttrString(obj, attr_name)) {
+  if (obj && attr_name && PyObject_HasAttrString(obj, attr_name)) {
     PyObject *attr = PyObject_GetAttrString(obj, attr_name);
     if (attr) {
       val = PyLong_AsVoidPtr(attr);
@@ -907,15 +934,32 @@ py_netsnmp_verbose(void)
   return verbose;
 }
 
+static int is_hex(const char* str, int len)
+{
+    const unsigned char *cp = (const unsigned char *) str;
+    int i;
+
+    for (i = 0; i < len; i++, cp++)
+        if (!isprint(*cp) && !isspace(*cp))
+            return 1;
+
+    return 0;
+}
+
+/*
+ * Set attribute @attr_name of @obj to the string @val.
+ */
 static int
-py_netsnmp_attr_set_string(PyObject *obj, char *attr_name,
-			   char *val, size_t len)
+py_netsnmp_attr_set_string(PyObject *obj, const char *attr_name,
+			   const char *val, size_t len)
 {
   int ret = -1;
+
   if (obj && attr_name) {
-    PyObject* val_obj =  (val ?
-			  Py_BuildValue("s#", val, len) :
-			  Py_BuildValue(""));
+    int hex = is_hex(val, len);
+    PyObject* val_obj = val ? Py_BuildValue(hex ? "y#" : "s#", val, len) :
+        Py_BuildValue("");
+
     if (!val_obj)
         return -1;
     ret = PyObject_SetAttrString(obj, attr_name, val_obj);
@@ -955,13 +999,13 @@ __py_netsnmp_update_session_errors(PyObj
 
     py_netsnmp_attr_set_string(session, "ErrorStr", err_str, STRLEN(err_str));
 
-    tmp_for_conversion = PyInt_FromLong(err_num);
+    tmp_for_conversion = PyLong_FromLong(err_num);
     if (!tmp_for_conversion)
         return; /* nothing better to do? */
     PyObject_SetAttrString(session, "ErrorNum", tmp_for_conversion);
     Py_DECREF(tmp_for_conversion);
 
-    tmp_for_conversion = PyInt_FromLong(err_ind);
+    tmp_for_conversion = PyLong_FromLong(err_ind);
     if (!tmp_for_conversion)
         return; /* nothing better to do? */
     PyObject_SetAttrString(session, "ErrorInd", tmp_for_conversion);
@@ -978,7 +1022,7 @@ netsnmp_create_session(PyObject *self, P
   int  retries;
   int  timeout;
   SnmpSession session = {0};
-  SnmpSession *ss = NULL;
+  struct session_list *ss = NULL;
   int verbose = py_netsnmp_verbose();
 
   if (!PyArg_ParseTuple(args, "issiii", &version,
@@ -1025,7 +1069,7 @@ netsnmp_create_session(PyObject *self, P
       printf("error:snmp_new_session: Couldn't open SNMP session");
   }
  end:
-  return PyLong_FromVoidPtr((void *)ss);
+  return PyLong_FromVoidPtr(ss);
 }
 
 static PyObject *
@@ -1049,7 +1093,7 @@ netsnmp_create_session_v3(PyObject *self
   int     eng_boots;
   int     eng_time;
   SnmpSession session = {0};
-  SnmpSession *ss = NULL;
+  struct session_list *ss = NULL;
   int verbose = py_netsnmp_verbose();
 
   if (!PyArg_ParseTuple(args, "isiiisisssssssii", &version,
@@ -1164,7 +1208,7 @@ netsnmp_create_session_v3(PyObject *self
   free (session.securityEngineID);
   free (session.contextEngineID);
 
-  return PyLong_FromVoidPtr((void *)ss);
+  return PyLong_FromVoidPtr(ss);
 }
 
 static PyObject *
@@ -1184,7 +1228,7 @@ netsnmp_create_session_tunneled(PyObject
   char *  their_hostname;
   char *  trust_cert;
   SnmpSession session = {0};
-  SnmpSession *ss = NULL;
+  struct session_list *ss;
   int verbose = py_netsnmp_verbose();
 
   if (!PyArg_ParseTuple(args, "isiiisissssss", &version,
@@ -1250,250 +1294,86 @@ netsnmp_create_session_tunneled(PyObject
                                                        trust_cert));
 
   ss = snmp_sess_open(&session);
-
-  if (!ss)
-      return NULL;
-  /*
-   * Note: on a 64-bit system the statement below discards the upper 32 bits of
-   * "ss", which is most likely a bug.
-   */
-  return Py_BuildValue("i", (int)(uintptr_t)ss);
+  return ss ? PyLong_FromVoidPtr(ss) : NULL;
 }
 
 static PyObject *
 netsnmp_delete_session(PyObject *self, PyObject *args)
 {
   PyObject *session;
-  SnmpSession *ss = NULL;
+  struct session_list *ss;
 
   if (!PyArg_ParseTuple(args, "O", &session)) {
     return NULL;
   }
 
-  ss = (SnmpSession *)py_netsnmp_attr_void_ptr(session, "sess_ptr");
+  ss = py_netsnmp_attr_void_ptr(session, "sess_ptr");
 
   snmp_sess_close(ss);
   return (Py_BuildValue(""));
 }
 
 
-static PyObject *
-netsnmp_get(PyObject *self, PyObject *args)
-{
-  PyObject *session;
-  PyObject *varlist;
-  PyObject *varbind;
-  PyObject *val_tuple = NULL;
-  int varlist_len = 0;
-  int varlist_ind;
-  netsnmp_session *ss;
-  netsnmp_pdu *pdu, *response;
-  netsnmp_variable_list *vars;
-  struct tree *tp;
-  int len;
-  oid *oid_arr;
-  int oid_arr_len = MAX_OID_LEN;
-  int type;
-  char type_str[MAX_TYPE_NAME_LEN];
-  u_char *str_buf = NULL;
-  size_t str_buf_len = 0;
-  size_t out_len = 0;
-  int buf_over = 0;
-  char *tag;
-  char *iid;
-  int getlabel_flag = NO_FLAGS;
-  int sprintval_flag = USE_BASIC;
-  int verbose = py_netsnmp_verbose();
-  int old_format;
-  int best_guess;
-  int retry_nosuch;
-  int err_ind;
-  int err_num;
-  char err_str[STR_BUF_SIZE];
-  char *tmpstr;
-  Py_ssize_t tmplen;
-
-  oid_arr = calloc(MAX_OID_LEN, sizeof(oid));
-
-  if (oid_arr && args) {
-
-    if (!PyArg_ParseTuple(args, "OO", &session, &varlist)) {
-      goto done;
-    }
-
-    ss = (SnmpSession *)py_netsnmp_attr_void_ptr(session, "sess_ptr");
-
-    if (py_netsnmp_attr_string(session, "ErrorStr", &tmpstr, &tmplen) < 0) {
-      goto done;
-    }
-
-    if (py_netsnmp_attr_long(session, "UseLongNames"))
-      getlabel_flag |= USE_LONG_NAMES;
-    if (py_netsnmp_attr_long(session, "UseNumeric"))
-      getlabel_flag |= USE_NUMERIC_OIDS;
-    if (py_netsnmp_attr_long(session, "UseEnums"))
-      sprintval_flag = USE_ENUMS;
-    if (py_netsnmp_attr_long(session, "UseSprintValue"))
-      sprintval_flag = USE_SPRINT_VALUE;
-    best_guess = py_netsnmp_attr_long(session, "BestGuess");
-    retry_nosuch = py_netsnmp_attr_long(session, "RetryNoSuch");
-
-    pdu = snmp_pdu_create(SNMP_MSG_GET);
-
-    if (varlist) {
-      PyObject *varlist_iter = PyObject_GetIter(varlist);
-
-      while (varlist_iter && (varbind = PyIter_Next(varlist_iter))) {
-	if (py_netsnmp_attr_string(varbind, "tag", &tag, NULL) < 0 ||
-	    py_netsnmp_attr_string(varbind, "iid", &iid, NULL) < 0)
-	{
-	  oid_arr_len = 0;
-	} else {
-	  tp = __tag2oid(tag, iid, oid_arr, &oid_arr_len, NULL, best_guess);
-	}
-
-	if (oid_arr_len) {
-	  snmp_add_null_var(pdu, oid_arr, oid_arr_len);
-	  varlist_len++;
-	} else {
-	  if (verbose)
-	    printf("error: get: unknown object ID (%s)",
-		   (tag ? tag : "<null>"));
-	  snmp_free_pdu(pdu);
-	  Py_DECREF(varbind);
-	  goto done;
-	}
-	/* release reference when done */
-	Py_DECREF(varbind);
-      }
-
-      Py_DECREF(varlist_iter);
-
-      if (PyErr_Occurred()) {
-	/* propagate error */
-	if (verbose)
-	  printf("error: get: unknown python error");
-	snmp_free_pdu(pdu);
-	goto done;
-      }
-    }
-
-    __send_sync_pdu(ss, pdu, &response, retry_nosuch, err_str, &err_num,
-                    &err_ind);
-    __py_netsnmp_update_session_errors(session, err_str, err_num, err_ind);
-
-    /*
-    ** Set up for numeric or full OID's, if necessary.  Save the old
-    ** output format so that it can be restored when we finish -- this
-    ** is a library-wide global, and has to be set/restored for each
-    ** session.
-    */
-    old_format = netsnmp_ds_get_int(NETSNMP_DS_LIBRARY_ID,
-				    NETSNMP_DS_LIB_OID_OUTPUT_FORMAT);
-
-    if (py_netsnmp_attr_long(session, "UseLongNames")) {
-      getlabel_flag |= USE_LONG_NAMES;
-
-      netsnmp_ds_set_int(NETSNMP_DS_LIBRARY_ID,
-			 NETSNMP_DS_LIB_OID_OUTPUT_FORMAT,
-			 NETSNMP_OID_OUTPUT_FULL);
-    }
-    /* Setting UseNumeric forces UseLongNames on so check for UseNumeric
-       after UseLongNames (above) to make sure the final outcome of
-       NETSNMP_DS_LIB_OID_OUTPUT_FORMAT is NETSNMP_OID_OUTPUT_NUMERIC */
-    if (py_netsnmp_attr_long(session, "UseNumeric")) {
-      getlabel_flag |= USE_LONG_NAMES;
-      getlabel_flag |= USE_NUMERIC_OIDS;
-
-      netsnmp_ds_set_int(NETSNMP_DS_LIBRARY_ID,
-			 NETSNMP_DS_LIB_OID_OUTPUT_FORMAT,
-			 NETSNMP_OID_OUTPUT_NUMERIC);
-    }
+static int build_python_varbind(PyObject *varbind, netsnmp_variable_list *vars,
+                                int varlist_ind, int sprintval_flag, int *len,
+                                char **str_buf)
+{
+    struct tree *tp;
+    int type;
+    char type_str[MAX_TYPE_NAME_LEN];
+    size_t str_buf_len = 0;
+    size_t out_len = 0;
+    int buf_over = 0;
+    const char *tag;
+    const char *iid;
+    int getlabel_flag = NO_FLAGS;
+
+    if (!PyObject_HasAttrString(varbind, "tag"))
+        return TYPE_OTHER;
+
+    if (*str_buf == NULL) {
+        *str_buf = netsnmp_malloc(STR_BUF_SIZE);
+        str_buf_len = STR_BUF_SIZE;
+    }
+    strcpy(*str_buf, ".");
+    out_len = 0;
+    tp = netsnmp_sprint_realloc_objid_tree((u_char **)str_buf, &str_buf_len,
+                                           &out_len, 1, &buf_over,
+                                           vars->name, vars->name_length);
+    if (_debug_level)
+        printf("%s:str_buf:%s:%d:%d\n", __func__, *str_buf, (int)str_buf_len,
+               (int)out_len);
 
-    val_tuple = PyTuple_New(varlist_len);
-    /* initialize return tuple */
-    for (varlist_ind = 0; varlist_ind < varlist_len; varlist_ind++) {
-      PyTuple_SetItem(val_tuple, varlist_ind, Py_BuildValue(""));
+    if (__is_leaf(tp)) {
+        type = tp->type ? tp->type : tp->parent->type;
+        getlabel_flag &= ~NON_LEAF_NAME;
+        if (_debug_level)
+            printf("%s:is_leaf:%d\n", __func__, type);
+    } else {
+        getlabel_flag |= NON_LEAF_NAME;
+        type = __translate_asn_type(vars->type);
+        if (_debug_level)
+            printf("%s:!is_leaf:%d\n", __func__, tp->type);
     }
+    __get_label_iid(*str_buf, &tag, &iid, getlabel_flag);
 
-    for(vars = (response ? response->variables : NULL), varlist_ind = 0;
-	vars && (varlist_ind < varlist_len);
-	vars = vars->next_variable, varlist_ind++) {
-
-      varbind = PySequence_GetItem(varlist, varlist_ind);
-
-      if (PyObject_HasAttrString(varbind, "tag")) {
-        if (str_buf == NULL) {
-          str_buf = (u_char *) netsnmp_malloc(STR_BUF_SIZE);
-          str_buf_len = STR_BUF_SIZE;
-        }
-	*str_buf = '.';
-	*(str_buf+1) = '\0';
-	out_len = 0;
-	tp = netsnmp_sprint_realloc_objid_tree(&str_buf, &str_buf_len,
-					       &out_len, 1, &buf_over,
-					       vars->name,vars->name_length);
-	if (_debug_level) 
-            printf("netsnmp_get:str_buf:%s:%d:%d\n", str_buf,
-                   (int)str_buf_len, (int)out_len);
-
-	if (__is_leaf(tp)) {
-	  type = (tp->type ? tp->type : tp->parent->type);
-	  getlabel_flag &= ~NON_LEAF_NAME;
-	  if (_debug_level) printf("netsnmp_get:is_leaf:%d\n",type);
-	} else {
-	  getlabel_flag |= NON_LEAF_NAME;
-	  type = __translate_asn_type(vars->type);
-	  if (_debug_level) printf("netsnmp_get:!is_leaf:%d\n",tp->type);
-	}
-	__get_label_iid((char *) str_buf, &tag, &iid, getlabel_flag);
-
-	py_netsnmp_attr_set_string(varbind, "tag", tag, STRLEN(tag));
-	py_netsnmp_attr_set_string(varbind, "iid", iid, STRLEN(iid));
+    py_netsnmp_attr_set_string(varbind, "tag", tag, STRLEN(tag));
+    py_netsnmp_attr_set_string(varbind, "iid", iid, STRLEN(iid));
 
-	__get_type_str(type, type_str);
+    __get_type_str(type, type_str);
 
-	py_netsnmp_attr_set_string(varbind, "type", type_str, strlen(type_str));
+    py_netsnmp_attr_set_string(varbind, "type", type_str, strlen(type_str));
 
-	len = __snprint_value((char **)&str_buf, &str_buf_len,
-                              vars, tp, type, sprintval_flag);
-	str_buf[len] = '\0';
-	py_netsnmp_attr_set_string(varbind, "val", (char *) str_buf, len);
-
-	/* save in return tuple as well */
-	if ((type == SNMP_ENDOFMIBVIEW) ||
-			(type == SNMP_NOSUCHOBJECT) ||
-			(type == SNMP_NOSUCHINSTANCE)) {
-		/* Translate error to None */
-		PyTuple_SetItem(val_tuple, varlist_ind,
-			Py_BuildValue(""));
-	} else {
-		PyTuple_SetItem(val_tuple, varlist_ind,
-			Py_BuildValue("s#", str_buf, len));
-	}
-	Py_DECREF(varbind);
-      } else {
-	printf("netsnmp_get: bad varbind (%d)\n", varlist_ind);
-	Py_XDECREF(varbind);
-      }
-    }
-
-    /* Reset the library's behavior for numeric/symbolic OID's. */
-    netsnmp_ds_set_int(NETSNMP_DS_LIBRARY_ID,
-		       NETSNMP_DS_LIB_OID_OUTPUT_FORMAT,
-		       old_format);
-
-    if (response) snmp_free_pdu(response);
-  }
-
- done:
-  free(oid_arr);
-  if (str_buf != NULL) netsnmp_free(str_buf);
-  return (val_tuple ? val_tuple : Py_BuildValue(""));
+    *len = __snprint_value(str_buf, &str_buf_len, vars, tp, type,
+                           sprintval_flag);
+    (*str_buf)[*len] = '\0';
+    py_netsnmp_attr_set_string(varbind, "val", *str_buf, *len);
+    return type;
 }
 
 static PyObject *
-netsnmp_getnext(PyObject *self, PyObject *args)
+netsnmp_get_or_getnext(PyObject *self, PyObject *args, int pdu_type,
+                       const char *func_name)
 {
   PyObject *session;
   PyObject *varlist;
@@ -1501,21 +1381,16 @@ netsnmp_getnext(PyObject *self, PyObject
   PyObject *val_tuple = NULL;
   int varlist_len = 0;
   int varlist_ind;
-  netsnmp_session *ss;
+  struct session_list *ss;
   netsnmp_pdu *pdu, *response;
   netsnmp_variable_list *vars;
-  struct tree *tp;
   int len;
   oid *oid_arr;
-  int oid_arr_len = MAX_OID_LEN;
+  size_t oid_arr_len = MAX_OID_LEN;
   int type;
-  char type_str[MAX_TYPE_NAME_LEN];
-  u_char *str_buf = NULL;
-  size_t str_buf_len = 0;
-  size_t out_len = 0;
-  int buf_over = 0;
-  char *tag;
-  char *iid = NULL;
+  char *str_buf = NULL;
+  const char *tag;
+  const char *iid;
   int getlabel_flag = NO_FLAGS;
   int sprintval_flag = USE_BASIC;
   int verbose = py_netsnmp_verbose();
@@ -1525,9 +1400,11 @@ netsnmp_getnext(PyObject *self, PyObject
   int err_ind;
   int err_num;
   char err_str[STR_BUF_SIZE];
-  char *tmpstr;
+  const char *tmpstr;
   Py_ssize_t tmplen;
 
+  netsnmp_assert(pdu_type == SNMP_MSG_GET || pdu_type == SNMP_MSG_GETNEXT);
+
   oid_arr = calloc(MAX_OID_LEN, sizeof(oid));
 
   if (oid_arr && args) {
@@ -1536,14 +1413,16 @@ netsnmp_getnext(PyObject *self, PyObject
       goto done;
     }
 
-    ss = (SnmpSession *)py_netsnmp_attr_void_ptr(session, "sess_ptr");
+    ss = py_netsnmp_attr_void_ptr(session, "sess_ptr");
 
     if (py_netsnmp_attr_string(session, "ErrorStr", &tmpstr, &tmplen) < 0) {
       goto done;
     }
-    memcpy(&err_str, tmpstr, tmplen);
-    err_num = py_netsnmp_attr_long(session, "ErrorNum");
-    err_ind = py_netsnmp_attr_long(session, "ErrorInd");
+    if (pdu_type == SNMP_MSG_GETNEXT) {
+        memcpy(&err_str, tmpstr, tmplen);
+        err_num = py_netsnmp_attr_long(session, "ErrorNum");
+        err_ind = py_netsnmp_attr_long(session, "ErrorInd");
+    }
 
     if (py_netsnmp_attr_long(session, "UseLongNames"))
       getlabel_flag |= USE_LONG_NAMES;
@@ -1556,7 +1435,7 @@ netsnmp_getnext(PyObject *self, PyObject
     best_guess = py_netsnmp_attr_long(session, "BestGuess");
     retry_nosuch = py_netsnmp_attr_long(session, "RetryNoSuch");
 
-    pdu = snmp_pdu_create(SNMP_MSG_GETNEXT);
+    pdu = snmp_pdu_create(pdu_type);
 
     if (varlist) {
       PyObject *varlist_iter = PyObject_GetIter(varlist);
@@ -1567,19 +1446,19 @@ netsnmp_getnext(PyObject *self, PyObject
 	{
 	  oid_arr_len = 0;
 	} else {
-	  tp = __tag2oid(tag, iid, oid_arr, &oid_arr_len, NULL, best_guess);
+	  __tag2oid(tag, iid, oid_arr, &oid_arr_len, NULL, best_guess);
 	}
 
 	if (_debug_level)
-	  printf("netsnmp_getnext: filling request: %s:%s:%d:%d\n",
-		 tag, iid, oid_arr_len,best_guess);
+            printf("%s: filling request: %s:%s:%zd:%d\n", func_name, tag, iid,
+                   oid_arr_len, best_guess);
 
 	if (oid_arr_len) {
 	  snmp_add_null_var(pdu, oid_arr, oid_arr_len);
 	  varlist_len++;
 	} else {
 	  if (verbose)
-	    printf("error: getnext: unknown object ID (%s)",
+	    printf("error: get: unknown object ID (%s)",
 		   (tag ? tag : "<null>"));
 	  snmp_free_pdu(pdu);
 	  Py_DECREF(varbind);
@@ -1594,7 +1473,7 @@ netsnmp_getnext(PyObject *self, PyObject
       if (PyErr_Occurred()) {
 	/* propagate error */
 	if (verbose)
-	  printf("error: getnext: unknown python error");
+	  printf("error: get: unknown python error");
 	snmp_free_pdu(pdu);
 	goto done;
       }
@@ -1643,60 +1522,26 @@ netsnmp_getnext(PyObject *self, PyObject
 	vars = vars->next_variable, varlist_ind++) {
 
       varbind = PySequence_GetItem(varlist, varlist_ind);
-
-      if (PyObject_HasAttrString(varbind, "tag")) {
-        if (str_buf == NULL) {
-          str_buf = (u_char *) netsnmp_malloc(STR_BUF_SIZE);
-          str_buf_len = STR_BUF_SIZE;
-        }
-	*str_buf = '.';
-	*(str_buf+1) = '\0';
-	out_len = 0;
-	tp = netsnmp_sprint_realloc_objid_tree(&str_buf, &str_buf_len,
-					       &out_len, 1, &buf_over,
-					       vars->name,vars->name_length);
-
-	if (__is_leaf(tp)) {
-	  type = (tp->type ? tp->type : tp->parent->type);
-	  getlabel_flag &= ~NON_LEAF_NAME;
-	} else {
-	  getlabel_flag |= NON_LEAF_NAME;
-	  type = __translate_asn_type(vars->type);
-	}
-
-	__get_label_iid((char *) str_buf, &tag, &iid, getlabel_flag);
-
-	if (_debug_level)
-	  printf("netsnmp_getnext: filling response: %s:%s\n", tag, iid);
-
-	py_netsnmp_attr_set_string(varbind, "tag", tag, STRLEN(tag));
-	py_netsnmp_attr_set_string(varbind, "iid", iid, STRLEN(iid));
-
-	__get_type_str(type, type_str);
-
-	py_netsnmp_attr_set_string(varbind, "type", type_str,
-				   strlen(type_str));
-
-	len = __snprint_value((char **)&str_buf, &str_buf_len,
-                              vars, tp, type, sprintval_flag);
-	str_buf[len] = '\0';
-
-	py_netsnmp_attr_set_string(varbind, "val", (char *) str_buf, len);
-
-	/* save in return tuple as well */
-	if ((type == SNMP_ENDOFMIBVIEW) ||
-			(type == SNMP_NOSUCHOBJECT) ||
-			(type == SNMP_NOSUCHINSTANCE)) {
-		/* Translate error to None */
-		PyTuple_SetItem(val_tuple, varlist_ind,
-			Py_BuildValue(""));
-	} else {
-		PyTuple_SetItem(val_tuple, varlist_ind,
-			Py_BuildValue("s#", str_buf, len));
-	}
-	Py_DECREF(varbind);
+      type = build_python_varbind(varbind, vars, varlist_ind, sprintval_flag,
+                                  &len, &str_buf);
+      if (type != TYPE_OTHER) {
+          /* save in return tuple as well */
+          if ((type == SNMP_ENDOFMIBVIEW) ||
+              (type == SNMP_NOSUCHOBJECT) ||
+              (type == SNMP_NOSUCHINSTANCE)) {
+              /* Translate error to None */
+              PyTuple_SetItem(val_tuple, varlist_ind,
+                              Py_BuildValue(""));
+          } else {
+              const int hex = is_hex(str_buf, len);
+
+              PyTuple_SetItem(val_tuple, varlist_ind,
+                              Py_BuildValue(hex ? "y#" : "s#",
+                                            str_buf, len));
+          }
+          Py_DECREF(varbind);
       } else {
-	printf("netsnmp_getnext: bad varbind (%d)\n", varlist_ind);
+	printf("%s: bad varbind (%d)\n", func_name, varlist_ind);
 	Py_XDECREF(varbind);
       }
     }
@@ -1706,16 +1551,30 @@ netsnmp_getnext(PyObject *self, PyObject
 		       NETSNMP_DS_LIB_OID_OUTPUT_FORMAT,
 		       old_format);
 
-    if (response) snmp_free_pdu(response);
+    if (response)
+       snmp_free_pdu(response);
   }
 
  done:
   free(oid_arr);
-  if (str_buf != NULL) netsnmp_free(str_buf);
+  if (str_buf != NULL)
+     netsnmp_free(str_buf);
   return (val_tuple ? val_tuple : Py_BuildValue(""));
 }
 
 static PyObject *
+netsnmp_get(PyObject *self, PyObject *args)
+{
+    return netsnmp_get_or_getnext(self, args, SNMP_MSG_GET, __func__);
+}
+
+static PyObject *
+netsnmp_getnext(PyObject *self, PyObject *args)
+{
+    return netsnmp_get_or_getnext(self, args, SNMP_MSG_GETNEXT, __func__);
+}
+
+static PyObject *
 netsnmp_walk(PyObject *self, PyObject *args)
 {
   PyObject *session;
@@ -1726,25 +1585,19 @@ netsnmp_walk(PyObject *self, PyObject *a
   PyObject *varbinds  = NULL;
   int varlist_len = 0;
   int varlist_ind;
-  netsnmp_session *ss;
+  struct session_list *ss;
   netsnmp_pdu *pdu, *response;
   netsnmp_pdu *newpdu;
   netsnmp_variable_list *vars, *oldvars;
-  struct tree *tp;
   int len;
   oid **oid_arr = NULL;
-  int *oid_arr_len = NULL;
+  size_t *oid_arr_len = NULL;
   oid **oid_arr_broken_check = NULL;
-  int *oid_arr_broken_check_len = NULL;
-  int type;
-  char type_str[MAX_TYPE_NAME_LEN];
+  size_t *oid_arr_broken_check_len = NULL;
   int status;
-  u_char *str_buf = NULL;
-  size_t str_buf_len = 0;
-  size_t out_len = 0;
-  int buf_over = 0;
-  char *tag;
-  char *iid = NULL;
+  char *str_buf = NULL;
+  const char *tag;
+  const char *iid = NULL;
   int getlabel_flag = NO_FLAGS;
   int sprintval_flag = USE_BASIC;
   int verbose = py_netsnmp_verbose();
@@ -1756,7 +1609,7 @@ netsnmp_walk(PyObject *self, PyObject *a
   char err_str[STR_BUF_SIZE];
   int notdone = 1;
   int result_count = 0;
-  char *tmpstr;
+  const char *tmpstr;
   Py_ssize_t tmplen;
 
   if (args) {
@@ -1772,7 +1625,7 @@ netsnmp_walk(PyObject *self, PyObject *a
     if ((varbinds = PyObject_GetAttrString(varlist, "varbinds")) == NULL) {
       goto done;
     }
-    ss = (SnmpSession *)py_netsnmp_attr_void_ptr(session, "sess_ptr");
+    ss = py_netsnmp_attr_void_ptr(session, "sess_ptr");
 
     if (py_netsnmp_attr_string(session, "ErrorStr", &tmpstr, &tmplen) < 0) {
       goto done;
@@ -1802,8 +1655,9 @@ netsnmp_walk(PyObject *self, PyObject *a
     }
     Py_DECREF(varlist_iter);
 
-    oid_arr_len              = calloc(varlist_len, sizeof(int));
-    oid_arr_broken_check_len = calloc(varlist_len, sizeof(int));
+    oid_arr_len              = calloc(varlist_len, sizeof(*oid_arr_len));
+    oid_arr_broken_check_len = calloc(varlist_len,
+                                      sizeof(*oid_arr_broken_check_len));
 
     oid_arr                  = calloc(varlist_len, sizeof(oid *));
     oid_arr_broken_check     = calloc(varlist_len, sizeof(oid *));
@@ -1827,14 +1681,13 @@ netsnmp_walk(PyObject *self, PyObject *a
       {
         oid_arr_len[varlist_ind] = 0;
       } else {
-        tp = __tag2oid(tag, iid,
-                       oid_arr[varlist_ind], &oid_arr_len[varlist_ind],
-                       NULL, best_guess);
+        __tag2oid(tag, iid, oid_arr[varlist_ind], &oid_arr_len[varlist_ind],
+                  NULL, best_guess);
       }
 
       if (_debug_level)
-	printf("netsnmp_walk: filling request: %s:%s:%d:%d\n",
-	       tag, iid, oid_arr_len[varlist_ind],best_guess);
+	printf("netsnmp_walk: filling request: %s:%s:%zd:%d\n",
+	       tag, iid, oid_arr_len[varlist_ind], best_guess);
 
       if (oid_arr_len[varlist_ind]) {
         snmp_add_null_var(pdu, oid_arr[varlist_ind], oid_arr_len[varlist_ind]);
@@ -1978,45 +1831,12 @@ netsnmp_walk(PyObject *self, PyObject *a
               }
 
               varbind = py_netsnmp_construct_varbind();
+              if (varbind && build_python_varbind(varbind, vars, varlist_ind,
+                                       sprintval_flag, &len, &str_buf) !=
+                  TYPE_OTHER) {
+                  const int hex = is_hex(str_buf, len);
 
-              if (PyObject_HasAttrString(varbind, "tag")) {
-                  if (str_buf == NULL) {
-                      str_buf = (u_char *) netsnmp_malloc(STR_BUF_SIZE);
-                      str_buf_len = STR_BUF_SIZE;
-                  }
-                  str_buf[0] = '.';
-                  str_buf[1] = '\0';
-                  out_len = 0;
-                  tp = netsnmp_sprint_realloc_objid_tree(&str_buf, &str_buf_len,
-                                                         &out_len, 1, &buf_over,
-                                                         vars->name,vars->name_length);
-
-                  if (__is_leaf(tp)) {
-                      type = (tp->type ? tp->type : tp->parent->type);
-                      getlabel_flag &= ~NON_LEAF_NAME;
-                  } else {
-                      getlabel_flag |= NON_LEAF_NAME;
-                      type = __translate_asn_type(vars->type);
-                  }
-
-                  __get_label_iid((char *) str_buf, &tag, &iid, getlabel_flag);
-
-                  if (_debug_level) printf("netsnmp_walk: filling response: %s:%s\n", tag, iid);
-
-                  py_netsnmp_attr_set_string(varbind, "tag", tag, STRLEN(tag));
-                  py_netsnmp_attr_set_string(varbind, "iid", iid, STRLEN(iid));
-
-                  __get_type_str(type, type_str);
-
-                  py_netsnmp_attr_set_string(varbind, "type", type_str,
-                                             strlen(type_str));
-
-                  len = __snprint_value((char **)&str_buf, &str_buf_len,
-                                        vars, tp, type, sprintval_flag);
-                  str_buf[len] = '\0';
-
-                  py_netsnmp_attr_set_string(varbind, "val", (char *) str_buf,
-                                             len);
+                  py_netsnmp_attr_set_string(varbind, "val", str_buf, len);
 
                   /* push the varbind onto the return varbinds */
                   PyList_Append(varbinds, varbind);
@@ -2025,7 +1845,8 @@ netsnmp_walk(PyObject *self, PyObject *a
                   /* save in return tuple as well - steals ref */
                   _PyTuple_Resize(&val_tuple, result_count+1);
                   PyTuple_SetItem(val_tuple, result_count++,
-                                  Py_BuildValue("s#", str_buf, len));
+                                  Py_BuildValue(hex ? "y#" : "s#", str_buf,
+                                                len));
               } else {
                   /* Return None for this variable. */
                   _PyTuple_Resize(&val_tuple, result_count+1);
@@ -2071,7 +1892,8 @@ netsnmp_walk(PyObject *self, PyObject *a
   }
   free(oid_arr);
   free(oid_arr_broken_check);
-  if (str_buf != NULL) netsnmp_free(str_buf);
+  if (str_buf != NULL)
+     netsnmp_free(str_buf);
   return (val_tuple ? val_tuple : Py_BuildValue(""));
 }
 
@@ -2088,21 +1910,15 @@ netsnmp_getbulk(PyObject *self, PyObject
   PyObject *varbinds_iter;
   PyObject *val_tuple = NULL;
   int varbind_ind;
-  netsnmp_session *ss;
+  struct session_list *ss;
   netsnmp_pdu *pdu, *response;
   netsnmp_variable_list *vars;
-  struct tree *tp;
   int len;
   oid *oid_arr;
-  int oid_arr_len = MAX_OID_LEN;
-  int type;
-  char type_str[MAX_TYPE_NAME_LEN];
-  u_char *str_buf = NULL;
-  size_t str_buf_len = 0;
-  size_t out_len = 0;
-  int buf_over = 0;
-  char *tag;
-  char *iid;
+  size_t oid_arr_len = MAX_OID_LEN;
+  char *str_buf = NULL;
+  const char *tag;
+  const char *iid;
   int getlabel_flag = NO_FLAGS;
   int sprintval_flag = USE_BASIC;
   int verbose = py_netsnmp_verbose();
@@ -2112,7 +1928,7 @@ netsnmp_getbulk(PyObject *self, PyObject
   int err_ind;
   int err_num;
   char err_str[STR_BUF_SIZE];
-  char *tmpstr;
+  const char *tmpstr;
   Py_ssize_t tmplen;
 
   oid_arr = calloc(MAX_OID_LEN, sizeof(oid));
@@ -2126,7 +1942,7 @@ netsnmp_getbulk(PyObject *self, PyObject
 
     if (varlist && (varbinds = PyObject_GetAttrString(varlist, "varbinds"))) {
 
-      ss = (SnmpSession *)py_netsnmp_attr_void_ptr(session, "sess_ptr");
+      ss = py_netsnmp_attr_void_ptr(session, "sess_ptr");
 
       if (py_netsnmp_attr_string(session, "ErrorStr", &tmpstr, &tmplen) < 0) {
         goto done;
@@ -2159,7 +1975,7 @@ netsnmp_getbulk(PyObject *self, PyObject
         {
           oid_arr_len = 0;
         } else {
-          tp = __tag2oid(tag, iid, oid_arr, &oid_arr_len, NULL, best_guess);
+          __tag2oid(tag, iid, oid_arr, &oid_arr_len, NULL, best_guess);
         }
 
 	if (oid_arr_len) {
@@ -2238,50 +2054,17 @@ netsnmp_getbulk(PyObject *self, PyObject
 	    vars = vars->next_variable, varbind_ind++) {
 
 	  varbind = py_netsnmp_construct_varbind();
+          if (varbind && build_python_varbind(varbind, vars, varbind_ind,
+                              sprintval_flag, &len, &str_buf) != TYPE_OTHER) {
+            const int hex = is_hex(str_buf, len);
 
-	  if (PyObject_HasAttrString(varbind, "tag")) {
-            if (str_buf == NULL) {
-              str_buf = (u_char *) netsnmp_malloc(STR_BUF_SIZE);
-              str_buf_len = STR_BUF_SIZE;
-            }
-	    *str_buf = '.';
-	    *(str_buf+1) = '\0';
-	    out_len = 0;
-	    buf_over = 0;
-	    tp = netsnmp_sprint_realloc_objid_tree(&str_buf, &str_buf_len,
-						   &out_len, 1, &buf_over,
-						   vars->name,vars->name_length);
-	    if (__is_leaf(tp)) {
-	      type = (tp->type ? tp->type : tp->parent->type);
-	      getlabel_flag &= ~NON_LEAF_NAME;
-	    } else {
-	      getlabel_flag |= NON_LEAF_NAME;
-	      type = __translate_asn_type(vars->type);
-	    }
-
-	    __get_label_iid((char *) str_buf, &tag, &iid, getlabel_flag);
-
-	    py_netsnmp_attr_set_string(varbind, "tag", tag, STRLEN(tag));
-	    py_netsnmp_attr_set_string(varbind, "iid", iid, STRLEN(iid));
-
-	    __get_type_str(type, type_str);
-
-	    py_netsnmp_attr_set_string(varbind, "type", type_str,
-				       strlen(type_str));
-
-	    len = __snprint_value((char **)&str_buf, &str_buf_len,
-				  vars, tp, type, sprintval_flag);
-	    str_buf[len] = '\0';
-
-	    py_netsnmp_attr_set_string(varbind, "val", (char *) str_buf, len);
-
-	    /* push varbind onto varbinds */
+            /* push varbind onto varbinds */
 	    PyList_Append(varbinds, varbind);
 
 	    /* save in return tuple as well - steals ref */
 	    _PyTuple_Resize(&val_tuple, varbind_ind+1);
 	    PyTuple_SetItem(val_tuple, varbind_ind,
-			       Py_BuildValue("s#", str_buf, len));
+                            Py_BuildValue(hex ? "y#" : "s#", str_buf, len));
 
 	    Py_DECREF(varbind);
 
@@ -2301,7 +2084,8 @@ netsnmp_getbulk(PyObject *self, PyObject
 			 NETSNMP_DS_LIB_OID_OUTPUT_FORMAT,
 			 old_format);
 
-      if (response) snmp_free_pdu(response);
+      if (response)
+         snmp_free_pdu(response);
 
       Py_DECREF(varbinds);
 
@@ -2319,7 +2103,8 @@ netsnmp_getbulk(PyObject *self, PyObject
 
  done:
   free(oid_arr);
-  if (str_buf != NULL) netsnmp_free(str_buf);
+  if (str_buf != NULL)
+     netsnmp_free(str_buf);
   return (val_tuple ? val_tuple : Py_BuildValue(""));
 }
 
@@ -2330,19 +2115,19 @@ netsnmp_set(PyObject *self, PyObject *ar
 #ifndef NETSNMP_NO_WRITE_SUPPORT
   PyObject *session;
   PyObject *varlist;
-  PyObject *varbind;
-  netsnmp_session *ss;
+  PyObject *varbind = NULL;
+  struct session_list *ss;
   netsnmp_pdu *pdu, *response;
   struct tree *tp;
-  char *tag;
-  char *iid;
-  char *val;
-  char *type_str;
+  const char *tag;
+  const char *iid;
+  const char *val;
+  const char *type_str;
   int len;
   oid *oid_arr;
-  int oid_arr_len = MAX_OID_LEN;
+  size_t oid_arr_len = MAX_OID_LEN;
   int type;
-  u_char tmp_val_str[STR_BUF_SIZE];
+  char* tmp_val_str = NULL;
   int use_enums;
   struct enum_list *ep;
   int verbose = py_netsnmp_verbose();
@@ -2351,7 +2136,7 @@ netsnmp_set(PyObject *self, PyObject *ar
   int err_ind;
   int err_num;
   char err_str[STR_BUF_SIZE];
-  char *tmpstr;
+  const char *tmpstr;
   Py_ssize_t tmplen;
 
   oid_arr = calloc(MAX_OID_LEN, sizeof(oid));
@@ -2362,7 +2147,7 @@ netsnmp_set(PyObject *self, PyObject *ar
       goto done;
     }
 
-    ss = (SnmpSession *)py_netsnmp_attr_void_ptr(session, "sess_ptr");
+    ss = py_netsnmp_attr_void_ptr(session, "sess_ptr");
 
     /* PyObject_SetAttrString(); */
     if (py_netsnmp_attr_string(session, "ErrorStr", &tmpstr, &tmplen) < 0) {
@@ -2413,23 +2198,20 @@ netsnmp_set(PyObject *self, PyObject *ar
 	  snmp_free_pdu(pdu);
 	  goto done;
 	}
-	memset(tmp_val_str, 0, sizeof(tmp_val_str));
-        if ( tmplen >= sizeof(tmp_val_str)) {
-            tmplen = sizeof(tmp_val_str)-1;
-        }
-	memcpy(tmp_val_str, val, tmplen);
-	if (type==TYPE_INTEGER && use_enums && tp && tp->enums) {
-	  for(ep = tp->enums; ep; ep = ep->next) {
+	if (type == TYPE_INTEGER && use_enums && tp && tp->enums) {
+	  for (ep = tp->enums; ep; ep = ep->next) {
 	    if (val && !strcmp(ep->label, val)) {
-              snprintf((char *) tmp_val_str, sizeof(tmp_val_str), "%d",
-                      ep->value);
+              if (asprintf(&tmp_val_str, "%d", ep->value) < 0)
+                tmp_val_str = NULL;
 	      break;
 	    }
 	  }
-	}
+	} else {
+            tmp_val_str = netsnmp_memdup(val, tmplen);
+        }
 	len = (int)tmplen;
-	status = __add_var_val_str(pdu, oid_arr, oid_arr_len,
-                                   (char *) tmp_val_str, len, type);
+	status = __add_var_val_str(pdu, oid_arr, oid_arr_len, tmp_val_str, len,
+                                   type);
 
 	if (verbose && status == FAILURE)
 	  printf("error: set: adding variable/value to PDU");
@@ -2453,7 +2235,8 @@ netsnmp_set(PyObject *self, PyObject *ar
 			     err_str, &err_num, &err_ind);
     __py_netsnmp_update_session_errors(session, err_str, err_num, err_ind);
 
-    if (response) snmp_free_pdu(response);
+    if (response)
+       snmp_free_pdu(response);
 
     if (status == STAT_SUCCESS)
       ret = Py_BuildValue("i",1); /* success, return True */
@@ -2490,11 +2273,26 @@ static PyMethodDef ClientMethods[] = {
   {NULL, NULL, 0, NULL}        /* Sentinel */
 };
 
+#if PY_VERSION_HEX < 0x03000000
 PyMODINIT_FUNC
 initclient_intf(void)
 {
     (void) Py_InitModule("client_intf", ClientMethods);
 }
+#else
+static PyModuleDef module_def = {
+    .m_base = PyModuleDef_HEAD_INIT,
+    .m_name = "client_intf",
+    .m_size = -1,
+    .m_methods = ClientMethods,
+};
+
+PyMODINIT_FUNC
+PyInit_client_intf(void)
+{
+    return PyModule_Create(&module_def);
+}
+#endif
 
 
 
diff -urpN net-snmp-5.8/python/netsnmp/netsnmp-feature-definitions.h net-snmp-5.9.1/python/netsnmp/netsnmp-feature-definitions.h
--- net-snmp-5.8/python/netsnmp/netsnmp-feature-definitions.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/python/netsnmp/netsnmp-feature-definitions.h	2021-05-26 05:19:35.000000000 +0700
@@ -1,7 +1,7 @@
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-features.h>
 
-netsnmp_feature_require(enable_stderrlog)
-netsnmp_feature_require(memory_malloc)
-netsnmp_feature_require(memory_free)
+netsnmp_feature_require(enable_stderrlog);
+netsnmp_feature_require(memory_malloc);
+netsnmp_feature_require(memory_free);
 
diff -urpN net-snmp-5.8/python/netsnmp/tests/test.py net-snmp-5.9.1/python/netsnmp/tests/test.py
--- net-snmp-5.8/python/netsnmp/tests/test.py	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/python/netsnmp/tests/test.py	2021-05-26 05:19:35.000000000 +0700
@@ -9,10 +9,15 @@ def snmp_dest(**kwargs):
     """Return information about how to communicate with snmpd"""
     dest = {
         'Version':    1,
-        'DestHost':   'localhost:' + os.environ.get("SNMP_SNMPD_PORT", 161),
+        'DestHost':   'localhost:' + str(os.environ.get("SNMP_SNMPD_PORT", 161)),
+         # Both the community strings "public" and "private"
+         # cannot be used to set variables using "snmpset"
+         # operations. Run the "snmpset" tests after replacing
+         # the following 'Community' string with any other
+         # configured community string from the snmpd.conf file.  
         'Community':  'public',
     }
-    for key, value in kwargs.iteritems():
+    for key, value in kwargs.items():
         dest[key] = value
     return dest
 
@@ -62,107 +67,112 @@ class BasicTests(unittest.TestCase):
         self.assertEqual(var.iid, '')
 
     def test_v1_get(self):
-        print "\n"
-        print "---v1 GET tests -------------------------------------\n"
+        print("\n")
+        print("---v1 GET tests -------------------------------------\n")
         var = netsnmp.Varbind('.1.3.6.1.2.1.1.1', '0')
         res = netsnmp.snmpget(var, **snmp_dest())
 
-        print "v1 snmpget result: ", res, "\n"
+        print("v1 snmpget result: ", res, "\n")
         self.assertEqual(len(res), 1)
 
-        print "v1 get var: ", var.tag, var.iid, "=", var.val, '(', var.type, ')'
+        print("v1 get var: ", var.tag, var.iid, "=", var.val, '(', var.type, ')')
         self.assertEqual(var.tag, 'sysDescr')
         self.assertEqual(var.iid, '0')
         self.assertEqual(var.val, res[0])
         self.assertEqual(var.type, 'OCTETSTR')
 
     def test_v1_getnext(self):
-        print "\n"
-        print "---v1 GETNEXT tests-------------------------------------\n"
+        print("\n")
+        print("---v1 GETNEXT tests-------------------------------------\n")
         var = netsnmp.Varbind('.1.3.6.1.2.1.1.1', '0')
         res = netsnmp.snmpgetnext(var, **snmp_dest())
 
-        print "v1 snmpgetnext result: ", res, "\n"
+        print("v1 snmpgetnext result: ", res, "\n")
         self.assertEqual(len(res), 1)
 
-        print "v1 getnext var: ", var.tag, var.iid, "=", var.val, '(', var.type, ')'
+        print("v1 getnext var: ", var.tag, var.iid, "=", var.val, '(', var.type, ')')
         self.assertTrue(var.tag is not None)
         self.assertTrue(var.iid is not None)
         self.assertTrue(var.val is not None)
         self.assertTrue(var.type is not None)
 
     def test_v1_set(self):
-        print "\n"
-        print "---v1 SET tests-------------------------------------\n"
-        var = netsnmp.Varbind('sysLocation', '0', 'my new location')
+        print("\n")
+        print("---v1 SET tests-------------------------------------\n")
+        # snmpset fails for the 'sysLocation' variable, 
+        # as the syslocation token is configured in the
+        # snmpd.conf file, which disables write access
+        # to the variable.
+        # Hence using the 'sysName' variable for the set tests.
+        var = netsnmp.Varbind('sysName', '0', 'my new name')
         res = netsnmp.snmpset(var, **snmp_dest())
 
-        print "v1 snmpset result: ", res, "\n"
+        print("v1 snmpset result: ", res, "\n")
         self.assertEqual(res, 1)
 
-        print "v1 set var: ", var.tag, var.iid, "=", var.val, '(', var.type, ')'
-        self.assertEqual(var.tag, 'sysLocation')
+        print("v1 set var: ", var.tag, var.iid, "=", var.val, '(', var.type, ')')
+        self.assertEqual(var.tag, 'sysName')
         self.assertEqual(var.iid, '0')
-        self.assertEqual(var.val, 'my new location')
+        self.assertEqual(var.val, 'my new name')
         self.assertTrue(var.type is None)
 
     def test_v1_walk(self):
-        print "\n"
-        print "---v1 walk tests-------------------------------------\n"
+        print("\n")
+        print("---v1 walk tests-------------------------------------\n")
         varlist = netsnmp.VarList(netsnmp.Varbind('system'))
 
-        print "v1 varlist walk in: "
+        print("v1 varlist walk in: ")
         for var in varlist:
-            print "  ", var.tag, var.iid, "=", var.val, '(', var.type, ')'
+            print("  ", var.tag, var.iid, "=", var.val, '(', var.type, ')')
 
         res = netsnmp.snmpwalk(varlist, **snmp_dest())
-        print "v1 snmpwalk result: ", res, "\n"
+        print("v1 snmpwalk result: ", res, "\n")
         self.assertTrue(len(res) > 0)
 
         for var in varlist:
-            print var.tag, var.iid, "=", var.val, '(', var.type, ')'
+            print(var.tag, var.iid, "=", var.val, '(', var.type, ')')
 
     def test_v1_walk_2(self):
-        print "\n"
-        print "---v1 walk 2-------------------------------------\n"
+        print("\n")
+        print("---v1 walk 2-------------------------------------\n")
 
-        print "v1 varbind walk in: "
+        print("v1 varbind walk in: ")
         var = netsnmp.Varbind('system')
         self.assertEqual(var.tag, 'system')
         self.assertEqual(var.iid, '')
         self.assertEqual(var.val, None)
         self.assertEqual(var.type, None)
         res = netsnmp.snmpwalk(var, **snmp_dest())
-        print "v1 snmpwalk result (should be = orig): ", res, "\n"
+        print("v1 snmpwalk result (should be = orig): ", res, "\n")
         self.assertTrue(len(res) > 0)
 
-        print var.tag, var.iid, "=", var.val, '(', var.type, ')'
+        print(var.tag, var.iid, "=", var.val, '(', var.type, ')')
         self.assertEqual(var.tag, 'system')
         self.assertEqual(var.iid, '')
         self.assertEqual(var.val, None)
         self.assertEqual(var.type, None)
 
     def test_v1_mv_get(self):
-        print "\n"
-        print "---v1 multi-varbind test-------------------------------------\n"
+        print("\n")
+        print("---v1 multi-varbind test-------------------------------------\n")
         sess = setup_v1()
 
         varlist = netsnmp.VarList(netsnmp.Varbind('sysUpTime', 0),
                                   netsnmp.Varbind('sysContact', 0),
                                   netsnmp.Varbind('sysLocation', 0))
         vals = sess.get(varlist)
-        print "v1 sess.get result: ", vals, "\n"
+        print("v1 sess.get result: ", vals, "\n")
         self.assertTrue(len(vals) > 0)
 
         for var in varlist:
-            print var.tag, var.iid, "=", var.val, '(', var.type, ')'
+            print(var.tag, var.iid, "=", var.val, '(', var.type, ')')
 
         vals = sess.getnext(varlist)
-        print "v1 sess.getnext result: ", vals, "\n"
+        print("v1 sess.getnext result: ", vals, "\n")
         self.assertTrue(len(vals) > 0)
 
         for var in varlist:
-            print var.tag, var.iid, "=", var.val, '(', var.type, ')'
+            print(var.tag, var.iid, "=", var.val, '(', var.type, ')')
 
         varlist = netsnmp.VarList(netsnmp.Varbind('sysUpTime'),
                                   netsnmp.Varbind('sysORLastChange'),
@@ -171,71 +181,87 @@ class BasicTests(unittest.TestCase):
                                   netsnmp.Varbind('sysORUpTime'))
 
         vals = sess.getbulk(2, 8, varlist)
-        print "v1 sess.getbulk result: ", vals, "\n"
+        print("v1 sess.getbulk result: ", vals, "\n")
         self.assertEqual(vals, None) # GetBulk is not supported for v1
 
         for var in varlist:
-            print var.tag, var.iid, "=", var.val, '(', var.type, ')'
+            print(var.tag, var.iid, "=", var.val, '(', var.type, ')')
 
     def test_v1_set_2(self):
-        print "\n"
-        print "---v1 set2-------------------------------------\n"
+        print("\n")
+        print("---v1 set2-------------------------------------\n")
 
         sess = setup_v1()
+        # snmpset fails for the 'sysLocation' variable, 
+        # as the syslocation token is configured in the
+        # snmpd.conf file, which disables write access
+        # to the variable.
+        # Hence using the 'sysName' variable for the set tests.
         varlist = netsnmp.VarList(
-            netsnmp.Varbind('sysLocation', '0', 'my newer location'))
+            netsnmp.Varbind('sysName', '0', 'my newer name'))
         res = sess.set(varlist)
-        print "v1 sess.set result: ", res, "\n"
+        print("v1 sess.set result: ", res, "\n")
 
     def test_v1_walk_3(self):
-        print "\n"
-        print "---v1 walk3-------------------------------------\n"
+        print("\n")
+        print("---v1 walk3-------------------------------------\n")
 
         sess = setup_v1()
         varlist = netsnmp.VarList(netsnmp.Varbind('system'))
 
         vals = sess.walk(varlist)
-        print "v1 sess.walk result: ", vals, "\n"
+        print("v1 sess.walk result: ", vals, "\n")
         self.assertTrue(len(vals) > 0)
 
         for var in varlist:
-            print "  ", var.tag, var.iid, "=", var.val, '(', var.type, ')'
+            print("  ", var.tag, var.iid, "=", var.val, '(', var.type, ')')
+
+    def test_v1_walk_4(self):
+        print("\n")
+        print("---v1 walk4-------------------------------------\n")
+
+        sess = setup_v1()
+        varlist = netsnmp.VarList(netsnmp.Varbind('.1'))
+
+        vals = sess.walk(varlist)
+        print("v1 sess.walk length: ", len(vals), "\n")
+        self.assertTrue(len(vals) > 0)
 
     def test_v2c_get(self):
-        print "\n"
-        print "---v2c get-------------------------------------\n"
+        print("\n")
+        print("---v2c get-------------------------------------\n")
 
         sess = setup_v2()
         varlist = netsnmp.VarList(netsnmp.Varbind('sysUpTime', 0),
                                   netsnmp.Varbind('sysContact', 0),
                                   netsnmp.Varbind('sysLocation', 0))
         vals = sess.get(varlist)
-        print "v2 sess.get result: ", vals, "\n"
+        print("v2 sess.get result: ", vals, "\n")
         self.assertEqual(len(vals), 3)
 
     def test_v2c_getnext(self):
-        print "\n"
-        print "---v2c getnext-------------------------------------\n"
+        print("\n")
+        print("---v2c getnext-------------------------------------\n")
 
         sess = setup_v2()
         varlist = netsnmp.VarList(netsnmp.Varbind('sysUpTime', 0),
                                   netsnmp.Varbind('sysContact', 0),
                                   netsnmp.Varbind('sysLocation', 0))
         for var in varlist:
-            print var.tag, var.iid, "=", var.val, '(', var.type, ')'
-        print "\n"
+            print(var.tag, var.iid, "=", var.val, '(', var.type, ')')
+        print("\n")
 
         vals = sess.getnext(varlist)
-        print "v2 sess.getnext result: ", vals, "\n"
+        print("v2 sess.getnext result: ", vals, "\n")
         self.assertTrue(len(vals) > 0)
 
         for var in varlist:
-            print var.tag, var.iid, "=", var.val, '(', var.type, ')'
-        print "\n"
+            print(var.tag, var.iid, "=", var.val, '(', var.type, ')')
+        print("\n")
 
     def test_v2c_getbulk(self):
-        print "\n"
-        print "---v2c getbulk-------------------------------------\n"
+        print("\n")
+        print("---v2c getbulk-------------------------------------\n")
 
         sess = setup_v2()
         varlist = netsnmp.VarList(netsnmp.Varbind('sysUpTime'),
@@ -245,71 +271,75 @@ class BasicTests(unittest.TestCase):
                                   netsnmp.Varbind('sysORUpTime'))
 
         vals = sess.getbulk(2, 8, varlist)
-        print "v2 sess.getbulk result: ", vals, "\n"
+        print("v2 sess.getbulk result: ", vals, "\n")
         self.assertTrue(len(vals) > 0)
 
         for var in varlist:
-            print var.tag, var.iid, "=", var.val, '(', var.type, ')'
-        print "\n"
+            print(var.tag, var.iid, "=", var.val, '(', var.type, ')')
+        print("\n")
 
     def test_v2c_set(self):
-        print "\n"
-        print "---v2c set-------------------------------------\n"
+        print("\n")
+        print("---v2c set-------------------------------------\n")
 
         sess = setup_v2()
-
+        # snmpset fails for the 'sysLocation' variable, 
+        # as the syslocation token is configured in the
+        # snmpd.conf file, which disables write access
+        # to the variable.
+        # Hence using the 'sysName' variable for the set tests.
         varlist = netsnmp.VarList(
-            netsnmp.Varbind('sysLocation', '0', 'my even newer location'))
+            netsnmp.Varbind('sysName', '0', 'my even newer name'))
 
         res = sess.set(varlist)
-        print "v2 sess.set result: ", res, "\n"
+        print("v2 sess.set result: ", res, "\n")
         self.assertEqual(res, 1)
 
     def test_v2c_walk(self):
-        print "\n"
-        print "---v2c walk-------------------------------------\n"
+        print("\n")
+        print("---v2c walk-------------------------------------\n")
 
         sess = setup_v2()
 
         varlist = netsnmp.VarList(netsnmp.Varbind('system'))
 
         vals = sess.walk(varlist)
-        print "v2 sess.walk result: ", vals, "\n"
+        print("v2 sess.walk result: ", vals, "\n")
         self.assertTrue(len(vals) > 0)
 
         for var in varlist:
-            print "  ", var.tag, var.iid, "=", var.val, '(', var.type, ')'
+            print("  ", var.tag, var.iid, "=", var.val, '(', var.type, ')')
 
     def test_v3_get(self):
-        print "\n"
+        print("\n")
         sess = setup_v3();
         varlist = netsnmp.VarList(netsnmp.Varbind('sysUpTime', 0),
                                   netsnmp.Varbind('sysContact', 0),
                                   netsnmp.Varbind('sysLocation', 0))
-        print "---v3 get-------------------------------------\n"
+        print("---v3 get-------------------------------------\n")
         vals = sess.get(varlist)
-        print "v3 sess.get result: ", vals, "\n"
+        print("v3 sess.get result: ", vals, "\n")
         self.assertTrue(len(vals) > 0)
 
         for var in varlist:
-            print var.tag, var.iid, "=", var.val, '(', var.type, ')'
-        print "\n"
+            print(var.tag, var.iid, "=", var.val, '(', var.type, ')')
+        print("\n")
 
     def test_v3_getnext(self):
-        print "\n"
-        print "---v3 getnext-------------------------------------\n"
+        print("\n")
+        print("---v3 getnext-------------------------------------\n")
 
         sess = setup_v3();
         varlist = netsnmp.VarList(netsnmp.Varbind('sysUpTime', 0),
                                   netsnmp.Varbind('sysContact', 0),
                                   netsnmp.Varbind('sysLocation', 0))
         vals = sess.getnext(varlist)
-        print "v3 sess.getnext result: ", vals, "\n"
+        print("v3 sess.getnext result: ", vals, "\n")
         self.assertTrue(len(vals) > 0)
 
         for var in varlist:
-            print var.tag, var.iid, "=", var.val, '(', var.type, ')'
-        print "\n"
+            print(var.tag, var.iid, "=", var.val, '(', var.type, ')')
+        print("\n")
 
     def test_v3_getbulk(self):
         sess = setup_v3();
@@ -320,47 +350,52 @@ class BasicTests(unittest.TestCase):
                                   netsnmp.Varbind('sysORUpTime'))
 
         vals = sess.getbulk(2, 8, varlist)
-        print "v3 sess.getbulk result: ", vals, "\n"
+        print("v3 sess.getbulk result: ", vals, "\n")
         self.assertTrue(len(vals) > 0)
 
         for var in varlist:
-            print var.tag, var.iid, "=", var.val, '(', var.type, ')'
-        print "\n"
+            print(var.tag, var.iid, "=", var.val, '(', var.type, ')')
+        print("\n")
 
     def test_v3_set(self):
-        print "\n"
-        print "---v3 set-------------------------------------\n"
+        print("\n")
+        print("---v3 set-------------------------------------\n")
 
         sess = setup_v3();
+        # snmpset fails for the 'sysLocation' variable, 
+        # as the syslocation token is configured in the
+        # snmpd.conf file, which disables write access
+        # to the variable.
+        # Hence using the 'sysName' variable for the set tests.
         varlist = netsnmp.VarList(
-            netsnmp.Varbind('sysLocation', '0', 'my final destination'))
+            netsnmp.Varbind('sysName', '0', 'my final name'))
         res = sess.set(varlist)
-        print "v3 sess.set result: ", res, "\n"
+        print("v3 sess.set result: ", res, "\n")
         self.assertEqual(res, 1)
 
     def test_v3_walk(self):
-        print "\n"
-        print "---v3 walk-------------------------------------\n"
+        print("\n")
+        print("---v3 walk-------------------------------------\n")
         sess = setup_v3();
         varlist = netsnmp.VarList(netsnmp.Varbind('system'))
 
         vals = sess.walk(varlist)
-        print "v3 sess.walk result: ", vals, "\n"
+        print("v3 sess.walk result: ", vals, "\n")
         self.assertTrue(len(vals) > 0)
 
         for var in varlist:
-            print "  ", var.tag, var.iid, "=", var.val, '(', var.type, ')'
+            print("  ", var.tag, var.iid, "=", var.val, '(', var.type, ')')
 
 
 class SetTests(unittest.TestCase):
     """SNMP set tests for the Net-SNMP Python interface"""
     def testFuncs(self):
         """Test code"""
-        print "\n-------------- SET Test Start ----------------------------\n"
+        print("\n-------------- SET Test Start ----------------------------\n")
 
         var = netsnmp.Varbind('sysUpTime', '0')
         res = netsnmp.snmpget(var, **snmp_dest())
-        print "uptime = ", res[0]
+        print("uptime = ", res[0])
         self.assertEqual(len(res), 1)
 
 
@@ -370,19 +405,19 @@ class SetTests(unittest.TestCase):
 
         var = netsnmp.Varbind('sysUpTime', '0')
         res = netsnmp.snmpget(var, **snmp_dest())
-        print "uptime = ", res[0]
+        print("uptime = ", res[0])
         self.assertEqual(len(res), 1)
 
         var = netsnmp.Varbind('nsCacheEntry')
         res = netsnmp.snmpgetnext(var, **snmp_dest())
-        print "var = ", var.tag, var.iid, "=", var.val, '(', var.type, ')'
+        print("var = ", var.tag, var.iid, "=", var.val, '(', var.type, ')')
         self.assertEqual(len(res), 1)
 
         var.val = 65
         res = netsnmp.snmpset(var, **snmp_dest())
         self.assertEqual(res, 1)
         res = netsnmp.snmpget(var, **snmp_dest())
-        print "var = ", var.tag, var.iid, "=", var.val, '(', var.type, ')'
+        print("var = ", var.tag, var.iid, "=", var.val, '(', var.type, ')')
         self.assertEqual(len(res), 1)
         self.assertEqual(res[0], '65');
 
@@ -394,7 +429,7 @@ class SetTests(unittest.TestCase):
             netsnmp.Varbind('.1.3.6.1.6.3.12.1.2.1.9.116.101.115.116', '', 4))
         res = sess.set(varlist)
 
-        print "res = ", res
+        print("res = ", res)
         self.assertEqual(res, 1)
 
         varlist = netsnmp.VarList(netsnmp.Varbind('snmpTargetAddrTDomain'),
@@ -414,15 +449,15 @@ class SetTests(unittest.TestCase):
         self.assertEqual(varlist[2].val, '3')
 
         for var in varlist:
-            print var.tag, var.iid, "=", var.val, '(', var.type, ')'
-        print "\n"
+            print(var.tag, var.iid, "=", var.val, '(', var.type, ')')
+        print("\n")
 
         varlist = netsnmp.VarList(
             netsnmp.Varbind('.1.3.6.1.6.3.12.1.2.1.9.116.101.115.116', '', 6))
 
         res = sess.set(varlist)
 
-        print "res = ", res
+        print("res = ", res)
         self.assertEqual(res, 1)
 
         varlist = netsnmp.VarList(netsnmp.Varbind('snmpTargetAddrTDomain'),
@@ -436,11 +471,57 @@ class SetTests(unittest.TestCase):
         self.assertNotEqual(varlist[2].tag, 'snmpTargetAddrRowStatus')
 
         for var in varlist:
-            print var.tag, var.iid, "=", var.val, '(', var.type, ')'
-        print "\n"
+            print(var.tag, var.iid, "=", var.val, '(', var.type, ')')
+        print("\n")
+
+        print("\n-------------- SET Test End ----------------------------\n")
 
-        print "\n-------------- SET Test End ----------------------------\n"
 
+class HexStringGet(unittest.TestCase):
+    """SNMP hex string tests for the Net-SNMP Python interface"""
+    def testFunc(self):
+        """HexStringGet"""
+        session = setup_v2()
+
+        # snmpEngineID.0
+        varlist = netsnmp.VarList(netsnmp.Varbind('.1.3.6.1.6.3.10.2.1.1.0'))
+        session.get(varlist)
+        for var in varlist:
+            print(var)
+        self.assertEqual(varlist[0].iid, '0');
+        self.assertEqual(varlist[0].type, 'OCTETSTR');
+
+class HexStringGetNext(unittest.TestCase):
+    """SNMP hex string tests for the Net-SNMP Python interface"""
+    def testFunc(self):
+        """HexStringGetNext"""
+        session = setup_v2()
+
+        varlist = netsnmp.VarList(netsnmp.Varbind('.1.3.6.1.6.3.10'))
+        session.walk(varlist)
+        for var in varlist:
+            print(var)
+        self.assertEqual(varlist[0].iid, '0');
+
+class HexStringSet(unittest.TestCase):
+    """SNMP hex string tests for the Net-SNMP Python interface"""
+    def testFunc(self):
+        """HexStringSet"""
+        session = setup_v2()
+
+        varlist = netsnmp.VarList(netsnmp.Varbind('.1.3.6.1.6.3.10.2.1.1.0'))
+        session.get(varlist)
+        print("varlist length =", len(varlist))
+        for var in varlist:
+            print(var)
+        self.assertEqual(varlist[0].iid, '0');
+        res = netsnmp.snmpset(var, **snmp_dest());
+        print("first SNMP set result:", res)
+        self.assertEqual(res, 0)
+        var.val = ""
+        res = netsnmp.snmpset(var, **snmp_dest());
+        print("second SNMP set result:", res)
+        self.assertEqual(res, 0)
 
 if __name__ == '__main__':
     unittest.main()
diff -urpN net-snmp-5.8/python/setup.py net-snmp-5.9.1/python/setup.py
--- net-snmp-5.8/python/setup.py	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/python/setup.py	2021-05-26 05:19:35.000000000 +0700
@@ -2,30 +2,29 @@ from distutils.core import setup, Extens
 from setuptools import setup, Extension, find_packages
 import os
 import re
-import string
 import sys
 
 intree=0
 
 args = sys.argv[:]
 for arg in args:
-    if string.find(arg,'--basedir=') == 0:
-        basedir = string.split(arg,'=')[1]
-	sys.argv.remove(arg)
+    if arg.find('--basedir=') == 0:
+        basedir = arg.split('=')[1]
+        sys.argv.remove(arg)
         intree=1
 
 if intree:
     netsnmp_libs = os.popen(basedir+'/net-snmp-config --libs').read()
     libdir = os.popen(basedir+'/net-snmp-config --build-lib-dirs '+basedir).read()
     incdir = os.popen(basedir+'/net-snmp-config --build-includes '+basedir).read() + " " + os.popen(basedir+'/net-snmp-config --base-cflags '+basedir).read()
-    libs = re.findall(r"-l(\S+)", netsnmp_libs)
-    libdirs = re.findall(r"-L(\S+)", libdir)
-    incdirs = re.findall(r"-I(\S+)", incdir)
+    libs = re.findall(r"(?:^|\s+)-l(\S+)", netsnmp_libs)
+    libdirs = re.findall(r"(?:^|\s+)-L(\S+)", libdir)
+    incdirs = re.findall(r"(?:^|\s+)-I(\S+)", incdir)
 else:
     netsnmp_libs = os.popen('net-snmp-config --libs').read()
-    libdirs = re.findall(r"-L(\S+)", netsnmp_libs)
+    libdirs = re.findall(r"(?:^|\s+)-L(\S+)", netsnmp_libs)
     incdirs = []
-    libs = re.findall(r"-l(\S+)", netsnmp_libs)
+    libs = re.findall(r"(?:^|\s+)-l(\S+)", netsnmp_libs)
 
 setup(
     name="netsnmp-python", version="1.0a1",
diff -urpN net-snmp-5.8/snmplib/Makefile.depend net-snmp-5.9.1/snmplib/Makefile.depend
--- net-snmp-5.8/snmplib/Makefile.depend	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/Makefile.depend	2021-05-26 05:19:35.000000000 +0700
@@ -1,6 +1,9 @@
 # DO NOT DELETE THIS LINE -- make depend depends on it.
 
 ./asn1.lo: ../include/net-snmp/net-snmp-config.h
+./asn1.lo: ../include/net-snmp/system/linux.h
+./asn1.lo: ../include/net-snmp/system/sysv.h
+./asn1.lo: ../include/net-snmp/system/generic.h
 ./asn1.lo: ../include/net-snmp/machine/generic.h
 ./asn1.lo: ../include/net-snmp/output_api.h ../include/net-snmp/types.h
 ./asn1.lo: ../include/net-snmp/library/oid.h
@@ -23,7 +26,9 @@
 ./asn1.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./asn1.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./asn1.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./asn1.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./asn1.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./asn1.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./asn1.lo: ../include/net-snmp/library/ucd_compat.h
 ./asn1.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./asn1.lo: ../include/net-snmp/library/parse.h
@@ -52,8 +57,14 @@
 ./asn1.lo: ../include/net-snmp/library/snmp_assert.h
 ./asn1.lo: ../include/net-snmp/version.h
 ./asprintf.lo: ../include/net-snmp/net-snmp-config.h
+./asprintf.lo: ../include/net-snmp/system/linux.h
+./asprintf.lo: ../include/net-snmp/system/sysv.h
+./asprintf.lo: ../include/net-snmp/system/generic.h
 ./asprintf.lo: ../include/net-snmp/machine/generic.h
 ./callback.lo: ../include/net-snmp/net-snmp-config.h
+./callback.lo: ../include/net-snmp/system/linux.h
+./callback.lo: ../include/net-snmp/system/sysv.h
+./callback.lo: ../include/net-snmp/system/generic.h
 ./callback.lo: ../include/net-snmp/machine/generic.h
 ./callback.lo: ../include/net-snmp/net-snmp-features.h
 ./callback.lo: ../include/net-snmp/types.h
@@ -82,7 +93,9 @@
 ./callback.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./callback.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./callback.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./callback.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./callback.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./callback.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./callback.lo: ../include/net-snmp/library/ucd_compat.h
 ./callback.lo: ../include/net-snmp/library/mib.h
 ./callback.lo: ../include/net-snmp/mib_api.h
@@ -108,10 +121,66 @@
 ./callback.lo: ../include/net-snmp/library/snmp_assert.h
 ./callback.lo: ../include/net-snmp/version.h
 ./cert_util.lo: ../include/net-snmp/net-snmp-config.h
+./cert_util.lo: ../include/net-snmp/system/linux.h
+./cert_util.lo: ../include/net-snmp/system/sysv.h
+./cert_util.lo: ../include/net-snmp/system/generic.h
 ./cert_util.lo: ../include/net-snmp/machine/generic.h
 ./cert_util.lo: ../include/net-snmp/net-snmp-features.h
+./cert_util.lo: ../include/net-snmp/types.h
+./cert_util.lo: ../include/net-snmp/library/oid.h
+./cert_util.lo: ../include/net-snmp/library/types.h
+./cert_util.lo: ../include/net-snmp/definitions.h
+./cert_util.lo: ../include/net-snmp/library/snmp_api.h
+./cert_util.lo: ../include/net-snmp/varbind_api.h
+./cert_util.lo: ../include/net-snmp/library/snmp_client.h
+./cert_util.lo: ../include/net-snmp/pdu_api.h
+./cert_util.lo: ../include/net-snmp/library/asn1.h
+./cert_util.lo: ../include/net-snmp/output_api.h
+./cert_util.lo: ../include/net-snmp/library/netsnmp-attribute-format.h
+./cert_util.lo: ../include/net-snmp/library/snmp_debug.h
+./cert_util.lo: ../include/net-snmp/library/snmp_logging.h
+./cert_util.lo: ../include/net-snmp/session_api.h
+./cert_util.lo: ../include/net-snmp/library/callback.h
+./cert_util.lo: ../include/net-snmp/library/snmp_transport.h
+./cert_util.lo: ../include/net-snmp/library/snmp_service.h
+./cert_util.lo: ../include/net-snmp/library/snmpCallbackDomain.h
+./cert_util.lo: ../include/net-snmp/library/snmpUnixDomain.h
+./cert_util.lo: ../include/net-snmp/library/snmpUDPDomain.h
+./cert_util.lo: ../include/net-snmp/library/snmpUDPIPv4BaseDomain.h
+./cert_util.lo: ../include/net-snmp/library/snmpIPv4BaseDomain.h
+./cert_util.lo: ../include/net-snmp/library/snmpUDPBaseDomain.h
+./cert_util.lo: ../include/net-snmp/library/snmpTCPDomain.h
+./cert_util.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
+./cert_util.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./cert_util.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
+./cert_util.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./cert_util.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
+./cert_util.lo: ../include/net-snmp/library/ucd_compat.h
+./cert_util.lo: ../include/net-snmp/library/mib.h
+./cert_util.lo: ../include/net-snmp/mib_api.h
+./cert_util.lo: ../include/net-snmp/library/parse.h
+./cert_util.lo: ../include/net-snmp/library/oid_stash.h
+./cert_util.lo: ../include/net-snmp/library/snmp_impl.h
+./cert_util.lo: ../include/net-snmp/library/snmp.h
+./cert_util.lo: ../include/net-snmp/library/snmp-tc.h
+./cert_util.lo: ../include/net-snmp/config_api.h
+./cert_util.lo: ../include/net-snmp/library/read_config.h
+./cert_util.lo: ../include/net-snmp/library/default_store.h
+./cert_util.lo: ../include/net-snmp/net-snmp-config.h
+./cert_util.lo: ../include/net-snmp/library/snmp_parse_args.h
+./cert_util.lo: ../include/net-snmp/library/snmp_enum.h
+./cert_util.lo: ../include/net-snmp/library/vacm.h
+./cert_util.lo: ../include/net-snmp/library/snmp_assert.h
+./cert_util.lo: ../include/net-snmp/library/system.h
+./cert_util.lo: ../include/net-snmp/library/tools.h
+./cert_util.lo: ../include/net-snmp/library/container.h
+./cert_util.lo: ../include/net-snmp/library/factory.h
+./cert_util.lo: ../include/net-snmp/library/data_list.h
+./cert_util.lo: ../include/net-snmp/library/file_utils.h
+./cert_util.lo: ../include/net-snmp/library/dir_utils.h
+./cert_util.lo: ../include/net-snmp/library/cert_util.h
+./cert_util.lo: ../include/net-snmp/library/snmp_openssl.h
 ./check_varbind.lo: ../include/net-snmp/net-snmp-config.h
-./check_varbind.lo: ../include/net-snmp/machine/generic.h
 ./check_varbind.lo: ../include/net-snmp/net-snmp-includes.h
 ./check_varbind.lo: ../include/net-snmp/definitions.h
 ./check_varbind.lo: ../include/net-snmp/types.h
@@ -139,7 +208,9 @@
 ./check_varbind.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./check_varbind.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./check_varbind.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./check_varbind.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./check_varbind.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./check_varbind.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./check_varbind.lo: ../include/net-snmp/library/ucd_compat.h
 ./check_varbind.lo: ../include/net-snmp/library/mib.h
 ./check_varbind.lo: ../include/net-snmp/mib_api.h
@@ -169,7 +240,6 @@
 ./check_varbind.lo: ../include/net-snmp/config_api.h
 ./check_varbind.lo: ../include/net-snmp/library/read_config.h
 ./check_varbind.lo: ../include/net-snmp/library/default_store.h
-./check_varbind.lo: ../include/net-snmp/net-snmp-config.h
 ./check_varbind.lo: ../include/net-snmp/library/snmp_parse_args.h
 ./check_varbind.lo: ../include/net-snmp/library/snmp_enum.h
 ./check_varbind.lo: ../include/net-snmp/library/vacm.h
@@ -181,8 +251,8 @@
 ./check_varbind.lo: ../include/net-snmp/library/lcd_time.h
 ./check_varbind.lo: ../include/net-snmp/library/snmp_secmod.h
 ./check_varbind.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./check_varbind.lo: ../include/net-snmp/library/snmptsm.h
 ./check_varbind.lo: ../include/net-snmp/library/snmpusm.h
+./check_varbind.lo: ../include/net-snmp/library/snmptsm.h
 ./closedir.lo: ../include/net-snmp/net-snmp-config.h
 ./closedir.lo: ../include/net-snmp/types.h
 ./closedir.lo: ../include/net-snmp/library/oid.h
@@ -210,7 +280,9 @@
 ./closedir.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./closedir.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./closedir.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./closedir.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./closedir.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./closedir.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./closedir.lo: ../include/net-snmp/library/ucd_compat.h
 ./closedir.lo: ../include/net-snmp/library/mib.h
 ./closedir.lo: ../include/net-snmp/mib_api.h
@@ -249,7 +321,9 @@
 ./container.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./container.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./container.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./container.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./container.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./container.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./container.lo: ../include/net-snmp/library/ucd_compat.h
 ./container.lo: ../include/net-snmp/library/mib.h
 ./container.lo: ../include/net-snmp/mib_api.h
@@ -289,8 +363,8 @@
 ./container.lo: ../include/net-snmp/library/lcd_time.h
 ./container.lo: ../include/net-snmp/library/snmp_secmod.h
 ./container.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./container.lo: ../include/net-snmp/library/snmptsm.h
 ./container.lo: ../include/net-snmp/library/snmpusm.h
+./container.lo: ../include/net-snmp/library/snmptsm.h
 ./container.lo: ../include/net-snmp/library/container_null.h
 ./container_binary_array.lo: ../include/net-snmp/net-snmp-config.h
 ./container_binary_array.lo: ../include/net-snmp/net-snmp-includes.h
@@ -320,7 +394,9 @@
 ./container_binary_array.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./container_binary_array.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./container_binary_array.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./container_binary_array.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./container_binary_array.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./container_binary_array.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./container_binary_array.lo: ../include/net-snmp/library/ucd_compat.h
 ./container_binary_array.lo: ../include/net-snmp/library/mib.h
 ./container_binary_array.lo: ../include/net-snmp/mib_api.h
@@ -361,8 +437,8 @@
 ./container_binary_array.lo: ../include/net-snmp/library/lcd_time.h
 ./container_binary_array.lo: ../include/net-snmp/library/snmp_secmod.h
 ./container_binary_array.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./container_binary_array.lo: ../include/net-snmp/library/snmptsm.h
 ./container_binary_array.lo: ../include/net-snmp/library/snmpusm.h
+./container_binary_array.lo: ../include/net-snmp/library/snmptsm.h
 ./container_iterator.lo: ../include/net-snmp/net-snmp-config.h
 ./container_iterator.lo: ../include/net-snmp/net-snmp-features.h
 ./container_iterator.lo: ../include/net-snmp/net-snmp-includes.h
@@ -392,7 +468,9 @@
 ./container_iterator.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./container_iterator.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./container_iterator.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./container_iterator.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./container_iterator.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./container_iterator.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./container_iterator.lo: ../include/net-snmp/library/ucd_compat.h
 ./container_iterator.lo: ../include/net-snmp/library/mib.h
 ./container_iterator.lo: ../include/net-snmp/mib_api.h
@@ -432,8 +510,8 @@
 ./container_iterator.lo: ../include/net-snmp/library/lcd_time.h
 ./container_iterator.lo: ../include/net-snmp/library/snmp_secmod.h
 ./container_iterator.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./container_iterator.lo: ../include/net-snmp/library/snmptsm.h
 ./container_iterator.lo: ../include/net-snmp/library/snmpusm.h
+./container_iterator.lo: ../include/net-snmp/library/snmptsm.h
 ./container_list_ssll.lo: ../include/net-snmp/net-snmp-config.h
 ./container_list_ssll.lo: ../include/net-snmp/net-snmp-features.h
 ./container_list_ssll.lo: ../include/net-snmp/net-snmp-includes.h
@@ -463,7 +541,9 @@
 ./container_list_ssll.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./container_list_ssll.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./container_list_ssll.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./container_list_ssll.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./container_list_ssll.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./container_list_ssll.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./container_list_ssll.lo: ../include/net-snmp/library/ucd_compat.h
 ./container_list_ssll.lo: ../include/net-snmp/library/mib.h
 ./container_list_ssll.lo: ../include/net-snmp/mib_api.h
@@ -503,8 +583,8 @@
 ./container_list_ssll.lo: ../include/net-snmp/library/lcd_time.h
 ./container_list_ssll.lo: ../include/net-snmp/library/snmp_secmod.h
 ./container_list_ssll.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./container_list_ssll.lo: ../include/net-snmp/library/snmptsm.h
 ./container_list_ssll.lo: ../include/net-snmp/library/snmpusm.h
+./container_list_ssll.lo: ../include/net-snmp/library/snmptsm.h
 ./container_null.lo: ../include/net-snmp/net-snmp-config.h
 ./container_null.lo: ../include/net-snmp/net-snmp-features.h
 ./container_null.lo: ../include/net-snmp/net-snmp-includes.h
@@ -534,7 +614,9 @@
 ./container_null.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./container_null.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./container_null.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./container_null.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./container_null.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./container_null.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./container_null.lo: ../include/net-snmp/library/ucd_compat.h
 ./container_null.lo: ../include/net-snmp/library/mib.h
 ./container_null.lo: ../include/net-snmp/mib_api.h
@@ -574,8 +656,8 @@
 ./container_null.lo: ../include/net-snmp/library/lcd_time.h
 ./container_null.lo: ../include/net-snmp/library/snmp_secmod.h
 ./container_null.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./container_null.lo: ../include/net-snmp/library/snmptsm.h
 ./container_null.lo: ../include/net-snmp/library/snmpusm.h
+./container_null.lo: ../include/net-snmp/library/snmptsm.h
 ./container_null.lo: ../include/net-snmp/library/container_null.h
 ./data_list.lo: ../include/net-snmp/net-snmp-config.h
 ./data_list.lo: ../include/net-snmp/net-snmp-features.h
@@ -605,7 +687,9 @@
 ./data_list.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./data_list.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./data_list.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./data_list.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./data_list.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./data_list.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./data_list.lo: ../include/net-snmp/library/ucd_compat.h
 ./data_list.lo: ../include/net-snmp/library/mib.h
 ./data_list.lo: ../include/net-snmp/mib_api.h
@@ -645,8 +729,8 @@
 ./data_list.lo: ../include/net-snmp/library/lcd_time.h
 ./data_list.lo: ../include/net-snmp/library/snmp_secmod.h
 ./data_list.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./data_list.lo: ../include/net-snmp/library/snmptsm.h
 ./data_list.lo: ../include/net-snmp/library/snmpusm.h
+./data_list.lo: ../include/net-snmp/library/snmptsm.h
 ./default_store.lo: ../include/net-snmp/net-snmp-config.h
 ./default_store.lo: ../include/net-snmp/net-snmp-features.h
 ./default_store.lo: ../include/net-snmp/types.h
@@ -675,7 +759,9 @@
 ./default_store.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./default_store.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./default_store.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./default_store.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./default_store.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./default_store.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./default_store.lo: ../include/net-snmp/library/ucd_compat.h
 ./default_store.lo: ../include/net-snmp/library/mib.h
 ./default_store.lo: ../include/net-snmp/mib_api.h
@@ -734,7 +820,9 @@
 ./dir_utils.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./dir_utils.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./dir_utils.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./dir_utils.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./dir_utils.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./dir_utils.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./dir_utils.lo: ../include/net-snmp/library/ucd_compat.h
 ./dir_utils.lo: ../include/net-snmp/library/mib.h
 ./dir_utils.lo: ../include/net-snmp/mib_api.h
@@ -774,8 +862,8 @@
 ./dir_utils.lo: ../include/net-snmp/library/lcd_time.h
 ./dir_utils.lo: ../include/net-snmp/library/snmp_secmod.h
 ./dir_utils.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./dir_utils.lo: ../include/net-snmp/library/snmptsm.h
 ./dir_utils.lo: ../include/net-snmp/library/snmpusm.h
+./dir_utils.lo: ../include/net-snmp/library/snmptsm.h
 ./dir_utils.lo: ../include/net-snmp/library/file_utils.h
 ./dir_utils.lo: ../include/net-snmp/library/dir_utils.h
 ./fd_event_manager.lo: ../include/net-snmp/net-snmp-config.h
@@ -806,7 +894,9 @@
 ./fd_event_manager.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./fd_event_manager.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./fd_event_manager.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./fd_event_manager.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./fd_event_manager.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./fd_event_manager.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./fd_event_manager.lo: ../include/net-snmp/library/ucd_compat.h
 ./fd_event_manager.lo: ../include/net-snmp/library/mib.h
 ./fd_event_manager.lo: ../include/net-snmp/mib_api.h
@@ -847,8 +937,8 @@
 ./fd_event_manager.lo: ../include/net-snmp/library/lcd_time.h
 ./fd_event_manager.lo: ../include/net-snmp/library/snmp_secmod.h
 ./fd_event_manager.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./fd_event_manager.lo: ../include/net-snmp/library/snmptsm.h
 ./fd_event_manager.lo: ../include/net-snmp/library/snmpusm.h
+./fd_event_manager.lo: ../include/net-snmp/library/snmptsm.h
 ./fd_event_manager.lo: ../include/net-snmp/library/fd_event_manager.h
 ./fd_event_manager.lo: ../include/net-snmp/library/large_fd_set.h
 ./file_utils.lo: ../include/net-snmp/net-snmp-config.h
@@ -880,7 +970,9 @@
 ./file_utils.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./file_utils.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./file_utils.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./file_utils.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./file_utils.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./file_utils.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./file_utils.lo: ../include/net-snmp/library/ucd_compat.h
 ./file_utils.lo: ../include/net-snmp/library/mib.h
 ./file_utils.lo: ../include/net-snmp/mib_api.h
@@ -920,8 +1012,8 @@
 ./file_utils.lo: ../include/net-snmp/library/lcd_time.h
 ./file_utils.lo: ../include/net-snmp/library/snmp_secmod.h
 ./file_utils.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./file_utils.lo: ../include/net-snmp/library/snmptsm.h
 ./file_utils.lo: ../include/net-snmp/library/snmpusm.h
+./file_utils.lo: ../include/net-snmp/library/snmptsm.h
 ./file_utils.lo: ../include/net-snmp/library/file_utils.h
 ./getopt.lo: ../include/net-snmp/net-snmp-config.h
 ./getopt.lo: ../include/net-snmp/library/getopt.h
@@ -952,7 +1044,9 @@
 ./gettimeofday.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./gettimeofday.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./gettimeofday.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./gettimeofday.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./gettimeofday.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./gettimeofday.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./gettimeofday.lo: ../include/net-snmp/library/ucd_compat.h
 ./gettimeofday.lo: ../include/net-snmp/library/mib.h
 ./gettimeofday.lo: ../include/net-snmp/mib_api.h
@@ -990,7 +1084,9 @@
 ./inet_ntop.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./inet_ntop.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./inet_ntop.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./inet_ntop.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./inet_ntop.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./inet_ntop.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./inet_ntop.lo: ../include/net-snmp/library/ucd_compat.h
 ./inet_ntop.lo: ../include/net-snmp/library/mib.h
 ./inet_ntop.lo: ../include/net-snmp/mib_api.h
@@ -1027,7 +1123,9 @@
 ./inet_pton.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./inet_pton.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./inet_pton.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./inet_pton.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./inet_pton.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./inet_pton.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./inet_pton.lo: ../include/net-snmp/library/ucd_compat.h
 ./inet_pton.lo: ../include/net-snmp/library/mib.h
 ./inet_pton.lo: ../include/net-snmp/mib_api.h
@@ -1063,7 +1161,9 @@
 ./int64.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./int64.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./int64.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./int64.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./int64.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./int64.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./int64.lo: ../include/net-snmp/library/ucd_compat.h
 ./int64.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./int64.lo: ../include/net-snmp/library/parse.h
@@ -1102,7 +1202,9 @@
 ./keytools.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./keytools.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./keytools.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./keytools.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./keytools.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./keytools.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./keytools.lo: ../include/net-snmp/library/ucd_compat.h
 ./keytools.lo: ../include/net-snmp/library/mib.h
 ./keytools.lo: ../include/net-snmp/mib_api.h
@@ -1160,7 +1262,9 @@
 ./large_fd_set.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./large_fd_set.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./large_fd_set.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./large_fd_set.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./large_fd_set.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./large_fd_set.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./large_fd_set.lo: ../include/net-snmp/library/ucd_compat.h
 ./large_fd_set.lo: ../include/net-snmp/library/mib.h
 ./large_fd_set.lo: ../include/net-snmp/mib_api.h
@@ -1201,13 +1305,12 @@
 ./large_fd_set.lo: ../include/net-snmp/library/lcd_time.h
 ./large_fd_set.lo: ../include/net-snmp/library/snmp_secmod.h
 ./large_fd_set.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./large_fd_set.lo: ../include/net-snmp/library/snmptsm.h
 ./large_fd_set.lo: ../include/net-snmp/library/snmpusm.h
+./large_fd_set.lo: ../include/net-snmp/library/snmptsm.h
 ./large_fd_set.lo: ../include/net-snmp/library/large_fd_set.h
 ./lcd_time.lo: ../include/net-snmp/net-snmp-config.h
 ./lcd_time.lo: ../include/net-snmp/net-snmp-features.h
-./lcd_time.lo: ../include/net-snmp/types.h
-./lcd_time.lo: ../include/net-snmp/library/oid.h
+./lcd_time.lo: ../include/net-snmp/types.h ../include/net-snmp/library/oid.h
 ./lcd_time.lo: ../include/net-snmp/library/types.h
 ./lcd_time.lo: ../include/net-snmp/definitions.h
 ./lcd_time.lo: ../include/net-snmp/library/snmp_api.h
@@ -1232,7 +1335,9 @@
 ./lcd_time.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./lcd_time.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./lcd_time.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./lcd_time.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./lcd_time.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./lcd_time.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./lcd_time.lo: ../include/net-snmp/library/ucd_compat.h
 ./lcd_time.lo: ../include/net-snmp/library/mib.h
 ./lcd_time.lo: ../include/net-snmp/mib_api.h
@@ -1265,8 +1370,7 @@
 ./lcd_time.lo: ../include/net-snmp/library/transform_oids.h
 ./md5.lo: ../include/net-snmp/net-snmp-config.h
 ./md5.lo: ../include/net-snmp/net-snmp-includes.h
-./md5.lo: ../include/net-snmp/definitions.h
-./md5.lo: ../include/net-snmp/types.h
+./md5.lo: ../include/net-snmp/definitions.h ../include/net-snmp/types.h
 ./md5.lo: ../include/net-snmp/library/oid.h
 ./md5.lo: ../include/net-snmp/library/types.h
 ./md5.lo: ../include/net-snmp/library/snmp_api.h
@@ -1290,7 +1394,9 @@
 ./md5.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./md5.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./md5.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./md5.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./md5.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./md5.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./md5.lo: ../include/net-snmp/library/ucd_compat.h
 ./md5.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./md5.lo: ../include/net-snmp/library/parse.h
@@ -1328,13 +1434,12 @@
 ./md5.lo: ../include/net-snmp/library/lcd_time.h
 ./md5.lo: ../include/net-snmp/library/snmp_secmod.h
 ./md5.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./md5.lo: ../include/net-snmp/library/snmptsm.h
 ./md5.lo: ../include/net-snmp/library/snmpusm.h
+./md5.lo: ../include/net-snmp/library/snmptsm.h
 ./md5.lo: ../include/net-snmp/library/md5.h
 ./mib.lo: ../include/net-snmp/net-snmp-config.h
 ./mib.lo: ../include/net-snmp/net-snmp-features.h
-./mib.lo: ../include/net-snmp/types.h
-./mib.lo: ../include/net-snmp/library/oid.h
+./mib.lo: ../include/net-snmp/types.h ../include/net-snmp/library/oid.h
 ./mib.lo: ../include/net-snmp/library/types.h
 ./mib.lo: ../include/net-snmp/definitions.h
 ./mib.lo: ../include/net-snmp/library/snmp_api.h
@@ -1358,7 +1463,9 @@
 ./mib.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./mib.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./mib.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./mib.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./mib.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./mib.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./mib.lo: ../include/net-snmp/library/ucd_compat.h
 ./mib.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./mib.lo: ../include/net-snmp/library/parse.h
@@ -1417,7 +1524,9 @@
 ./oid_stash.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./oid_stash.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./oid_stash.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./oid_stash.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./oid_stash.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./oid_stash.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./oid_stash.lo: ../include/net-snmp/library/ucd_compat.h
 ./oid_stash.lo: ../include/net-snmp/library/mib.h
 ./oid_stash.lo: ../include/net-snmp/mib_api.h
@@ -1457,8 +1566,8 @@
 ./oid_stash.lo: ../include/net-snmp/library/lcd_time.h
 ./oid_stash.lo: ../include/net-snmp/library/snmp_secmod.h
 ./oid_stash.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./oid_stash.lo: ../include/net-snmp/library/snmptsm.h
 ./oid_stash.lo: ../include/net-snmp/library/snmpusm.h
+./oid_stash.lo: ../include/net-snmp/library/snmptsm.h
 ./opendir.lo: ../include/net-snmp/net-snmp-config.h
 ./opendir.lo: ../include/net-snmp/types.h
 ./opendir.lo: ../include/net-snmp/library/oid.h
@@ -1486,7 +1595,9 @@
 ./opendir.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./opendir.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./opendir.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./opendir.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./opendir.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./opendir.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./opendir.lo: ../include/net-snmp/library/ucd_compat.h
 ./opendir.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./opendir.lo: ../include/net-snmp/library/parse.h
@@ -1523,7 +1634,9 @@
 ./parse.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./parse.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./parse.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./parse.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./parse.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./parse.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./parse.lo: ../include/net-snmp/library/ucd_compat.h
 ./parse.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./parse.lo: ../include/net-snmp/library/parse.h
@@ -1582,7 +1695,9 @@
 ./read_config.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./read_config.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./read_config.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./read_config.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./read_config.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./read_config.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./read_config.lo: ../include/net-snmp/library/ucd_compat.h
 ./read_config.lo: ../include/net-snmp/library/mib.h
 ./read_config.lo: ../include/net-snmp/mib_api.h
@@ -1640,7 +1755,9 @@
 ./readdir.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./readdir.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./readdir.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./readdir.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./readdir.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./readdir.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./readdir.lo: ../include/net-snmp/library/ucd_compat.h
 ./readdir.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./readdir.lo: ../include/net-snmp/library/parse.h
@@ -1652,6 +1769,7 @@
 ./readdir.lo: ../include/net-snmp/library/system.h
 ./scapi.lo: ../include/net-snmp/net-snmp-config.h
 ./scapi.lo: ../include/net-snmp/net-snmp-features.h
+./scapi.lo: memcheck.h
 ./scapi.lo: ../include/net-snmp/types.h
 ./scapi.lo: ../include/net-snmp/library/oid.h
 ./scapi.lo: ../include/net-snmp/library/types.h
@@ -1677,7 +1795,9 @@
 ./scapi.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./scapi.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./scapi.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./scapi.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./scapi.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./scapi.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./scapi.lo: ../include/net-snmp/library/ucd_compat.h
 ./scapi.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./scapi.lo: ../include/net-snmp/library/parse.h
@@ -1734,7 +1854,9 @@
 ./sd-daemon.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./sd-daemon.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./sd-daemon.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./sd-daemon.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./sd-daemon.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./sd-daemon.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./sd-daemon.lo: ../include/net-snmp/library/ucd_compat.h
 ./sd-daemon.lo: ../include/net-snmp/library/mib.h
 ./sd-daemon.lo: ../include/net-snmp/mib_api.h
@@ -1743,6 +1865,7 @@
 ./sd-daemon.lo: ../include/net-snmp/library/snmp_impl.h
 ./sd-daemon.lo: ../include/net-snmp/library/snmp.h
 ./sd-daemon.lo: ../include/net-snmp/library/snmp-tc.h
+./sd-daemon.lo: ../include/net-snmp/library/tools.h
 ./sd-daemon.lo: ../include/net-snmp/library/sd-daemon.h
 ./snmp-tc.lo: ../include/net-snmp/net-snmp-config.h
 ./snmp-tc.lo: ../include/net-snmp/net-snmp-features.h
@@ -1772,7 +1895,9 @@
 ./snmp-tc.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp-tc.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp-tc.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp-tc.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp-tc.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp-tc.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp-tc.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp-tc.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./snmp-tc.lo: ../include/net-snmp/library/parse.h
@@ -1806,7 +1931,9 @@
 ./snmp.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./snmp.lo: ../include/net-snmp/library/parse.h
@@ -1842,7 +1969,9 @@
 ./snmp_alarm.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_alarm.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_alarm.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_alarm.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_alarm.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_alarm.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_alarm.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_alarm.lo: ../include/net-snmp/library/mib.h
 ./snmp_alarm.lo: ../include/net-snmp/mib_api.h
@@ -1902,7 +2031,9 @@
 ./snmp_api.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_api.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_api.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_api.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_api.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_api.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_api.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_api.lo: ../include/net-snmp/library/mib.h
 ./snmp_api.lo: ../include/net-snmp/mib_api.h
@@ -1941,8 +2072,7 @@
 ./snmp_api.lo: ../agent/mibgroup/agentx/protocol.h
 ./snmp_api.lo: ../include/net-snmp/library/transform_oids.h
 ./snmp_auth.lo: ../include/net-snmp/net-snmp-config.h
-./snmp_auth.lo: ../include/net-snmp/types.h
-./snmp_auth.lo: ../include/net-snmp/library/oid.h
+./snmp_auth.lo: ../include/net-snmp/types.h ../include/net-snmp/library/oid.h
 ./snmp_auth.lo: ../include/net-snmp/library/types.h
 ./snmp_auth.lo: ../include/net-snmp/definitions.h
 ./snmp_auth.lo: ../include/net-snmp/library/snmp_api.h
@@ -1967,7 +2097,9 @@
 ./snmp_auth.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_auth.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_auth.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_auth.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_auth.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_auth.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_auth.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_auth.lo: ../include/net-snmp/library/mib.h
 ./snmp_auth.lo: ../include/net-snmp/mib_api.h
@@ -2023,7 +2155,9 @@
 ./snmp_client.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_client.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_client.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_client.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_client.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_client.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_client.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_client.lo: ../include/net-snmp/library/mib.h
 ./snmp_client.lo: ../include/net-snmp/mib_api.h
@@ -2065,7 +2199,9 @@
 ./snmp_debug.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_debug.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_debug.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_debug.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_debug.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_debug.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_debug.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_debug.lo: ../include/net-snmp/library/mib.h
 ./snmp_debug.lo: ../include/net-snmp/mib_api.h
@@ -2125,7 +2261,9 @@
 ./snmp_enum.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_enum.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_enum.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_enum.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_enum.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_enum.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_enum.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_enum.lo: ../include/net-snmp/library/mib.h
 ./snmp_enum.lo: ../include/net-snmp/mib_api.h
@@ -2171,7 +2309,9 @@
 ./snmp_logging.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_logging.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_logging.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_logging.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_logging.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_logging.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_logging.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_logging.lo: ../include/net-snmp/library/mib.h
 ./snmp_logging.lo: ../include/net-snmp/mib_api.h
@@ -2201,7 +2341,8 @@
 ./snmp_logging.lo: ../include/net-snmp/library/container_iterator.h
 ./snmp_logging.lo: ../include/net-snmp/library/container.h
 ./snmp_logging.lo: ../include/net-snmp/library/snmp_assert.h
-./snmp_logging.lo: ../include/net-snmp/version.h snprintf.h
+./snmp_logging.lo: ../include/net-snmp/version.h
+./snmp_logging.lo: snmp_syslog.h snprintf.h
 ./snmp_openssl.lo: ../include/net-snmp/net-snmp-config.h
 ./snmp_openssl.lo: ../include/net-snmp/net-snmp-includes.h
 ./snmp_openssl.lo: ../include/net-snmp/definitions.h
@@ -2230,7 +2371,9 @@
 ./snmp_openssl.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_openssl.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_openssl.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_openssl.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_openssl.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_openssl.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_openssl.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_openssl.lo: ../include/net-snmp/library/mib.h
 ./snmp_openssl.lo: ../include/net-snmp/mib_api.h
@@ -2271,8 +2414,8 @@
 ./snmp_openssl.lo: ../include/net-snmp/library/lcd_time.h
 ./snmp_openssl.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmp_openssl.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmp_openssl.lo: ../include/net-snmp/library/snmptsm.h
 ./snmp_openssl.lo: ../include/net-snmp/library/snmpusm.h
+./snmp_openssl.lo: ../include/net-snmp/library/snmptsm.h
 ./snmp_parse_args.lo: ../include/net-snmp/net-snmp-config.h
 ./snmp_parse_args.lo: ../include/net-snmp/net-snmp-includes.h
 ./snmp_parse_args.lo: ../include/net-snmp/definitions.h
@@ -2301,7 +2444,9 @@
 ./snmp_parse_args.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_parse_args.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_parse_args.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_parse_args.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_parse_args.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_parse_args.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_parse_args.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_parse_args.lo: ../include/net-snmp/library/mib.h
 ./snmp_parse_args.lo: ../include/net-snmp/mib_api.h
@@ -2342,8 +2487,8 @@
 ./snmp_parse_args.lo: ../include/net-snmp/library/lcd_time.h
 ./snmp_parse_args.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmp_parse_args.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmp_parse_args.lo: ../include/net-snmp/library/snmptsm.h
 ./snmp_parse_args.lo: ../include/net-snmp/library/snmpusm.h
+./snmp_parse_args.lo: ../include/net-snmp/library/snmptsm.h
 ./snmp_secmod.lo: ../include/net-snmp/net-snmp-config.h
 ./snmp_secmod.lo: ../include/net-snmp/types.h
 ./snmp_secmod.lo: ../include/net-snmp/library/oid.h
@@ -2371,7 +2516,9 @@
 ./snmp_secmod.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_secmod.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_secmod.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_secmod.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_secmod.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_secmod.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_secmod.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_secmod.lo: ../include/net-snmp/library/mib.h
 ./snmp_secmod.lo: ../include/net-snmp/mib_api.h
@@ -2405,8 +2552,8 @@
 ./snmp_secmod.lo: ../include/net-snmp/version.h
 ./snmp_secmod.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmp_secmod.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmp_secmod.lo: ../include/net-snmp/library/snmptsm.h
-./snmp_secmod.lo: ../include/net-snmp/library/snmpusm.h snmpsm_init.h
+./snmp_secmod.lo: ../include/net-snmp/library/snmpusm.h
+./snmp_secmod.lo: ../include/net-snmp/library/snmptsm.h snmpsm_init.h
 ./snmp_secmod.lo: snmpsm_shutdown.h
 ./snmp_service.lo: ../include/net-snmp/net-snmp-config.h
 ./snmp_service.lo: ../include/net-snmp/net-snmp-includes.h
@@ -2436,7 +2583,9 @@
 ./snmp_service.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_service.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_service.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_service.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_service.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_service.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_service.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_service.lo: ../include/net-snmp/library/mib.h
 ./snmp_service.lo: ../include/net-snmp/mib_api.h
@@ -2477,8 +2626,8 @@
 ./snmp_service.lo: ../include/net-snmp/library/lcd_time.h
 ./snmp_service.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmp_service.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmp_service.lo: ../include/net-snmp/library/snmptsm.h
 ./snmp_service.lo: ../include/net-snmp/library/snmpusm.h
+./snmp_service.lo: ../include/net-snmp/library/snmptsm.h
 ./snmp_transport.lo: ../include/net-snmp/net-snmp-config.h
 ./snmp_transport.lo: ../include/net-snmp/net-snmp-features.h
 ./snmp_transport.lo: ../include/net-snmp/types.h
@@ -2507,7 +2656,9 @@
 ./snmp_transport.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmp_transport.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmp_transport.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmp_transport.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmp_transport.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmp_transport.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmp_transport.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmp_transport.lo: ../include/net-snmp/library/mib.h
 ./snmp_transport.lo: ../include/net-snmp/mib_api.h
@@ -2564,7 +2715,9 @@
 ./snmpksm.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpksm.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpksm.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpksm.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpksm.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpksm.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpksm.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpksm.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./snmpksm.lo: ../include/net-snmp/library/parse.h
@@ -2632,7 +2785,9 @@
 ./snmptsm.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmptsm.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmptsm.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmptsm.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmptsm.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmptsm.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmptsm.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmptsm.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./snmptsm.lo: ../include/net-snmp/library/parse.h
@@ -2670,12 +2825,11 @@
 ./snmptsm.lo: ../include/net-snmp/library/lcd_time.h
 ./snmptsm.lo: ../include/net-snmp/library/snmp_secmod.h
 ./snmptsm.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./snmptsm.lo: ../include/net-snmp/library/snmptsm.h
 ./snmptsm.lo: ../include/net-snmp/library/snmpusm.h
+./snmptsm.lo: ../include/net-snmp/library/snmptsm.h
 ./snmpusm.lo: ../include/net-snmp/net-snmp-config.h
 ./snmpusm.lo: ../include/net-snmp/net-snmp-features.h
-./snmpusm.lo: ../include/net-snmp/types.h
-./snmpusm.lo: ../include/net-snmp/library/oid.h
+./snmpusm.lo: ../include/net-snmp/types.h ../include/net-snmp/library/oid.h
 ./snmpusm.lo: ../include/net-snmp/library/types.h
 ./snmpusm.lo: ../include/net-snmp/definitions.h
 ./snmpusm.lo: ../include/net-snmp/library/snmp_api.h
@@ -2700,7 +2854,9 @@
 ./snmpusm.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpusm.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpusm.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpusm.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpusm.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpusm.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpusm.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpusm.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./snmpusm.lo: ../include/net-snmp/library/parse.h
@@ -2763,7 +2919,9 @@
 ./snmpv3.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./snmpv3.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./snmpv3.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./snmpv3.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./snmpv3.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./snmpv3.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./snmpv3.lo: ../include/net-snmp/library/ucd_compat.h
 ./snmpv3.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./snmpv3.lo: ../include/net-snmp/library/parse.h
@@ -2831,7 +2989,9 @@
 ./strlcat.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./strlcat.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./strlcat.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./strlcat.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./strlcat.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./strlcat.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./strlcat.lo: ../include/net-snmp/library/ucd_compat.h
 ./strlcat.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./strlcat.lo: ../include/net-snmp/library/parse.h
@@ -2868,7 +3028,9 @@
 ./strlcpy.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./strlcpy.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./strlcpy.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./strlcpy.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./strlcpy.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./strlcpy.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./strlcpy.lo: ../include/net-snmp/library/ucd_compat.h
 ./strlcpy.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./strlcpy.lo: ../include/net-snmp/library/parse.h
@@ -2905,7 +3067,9 @@
 ./strtok_r.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./strtok_r.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./strtok_r.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./strtok_r.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./strtok_r.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./strtok_r.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./strtok_r.lo: ../include/net-snmp/library/ucd_compat.h
 ./strtok_r.lo: ../include/net-snmp/library/mib.h
 ./strtok_r.lo: ../include/net-snmp/mib_api.h
@@ -2944,7 +3108,9 @@
 ./strtoull.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./strtoull.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./strtoull.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./strtoull.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./strtoull.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./strtoull.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./strtoull.lo: ../include/net-snmp/library/ucd_compat.h
 ./strtoull.lo: ../include/net-snmp/library/mib.h
 ./strtoull.lo: ../include/net-snmp/mib_api.h
@@ -2957,8 +3123,7 @@
 ./strtoull.lo: ../include/net-snmp/library/system.h
 ./system.lo: ../include/net-snmp/net-snmp-config.h
 ./system.lo: ../include/net-snmp/net-snmp-features.h
-./system.lo: ../include/net-snmp/types.h
-./system.lo: ../include/net-snmp/library/oid.h
+./system.lo: ../include/net-snmp/types.h ../include/net-snmp/library/oid.h
 ./system.lo: ../include/net-snmp/library/types.h
 ./system.lo: ../include/net-snmp/definitions.h
 ./system.lo: ../include/net-snmp/library/snmp_api.h
@@ -2982,7 +3147,9 @@
 ./system.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./system.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./system.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./system.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./system.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./system.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./system.lo: ../include/net-snmp/library/ucd_compat.h
 ./system.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./system.lo: ../include/net-snmp/library/parse.h
@@ -3041,7 +3208,9 @@
 ./text_utils.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./text_utils.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./text_utils.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./text_utils.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./text_utils.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./text_utils.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./text_utils.lo: ../include/net-snmp/library/ucd_compat.h
 ./text_utils.lo: ../include/net-snmp/library/mib.h
 ./text_utils.lo: ../include/net-snmp/mib_api.h
@@ -3081,8 +3250,8 @@
 ./text_utils.lo: ../include/net-snmp/library/lcd_time.h
 ./text_utils.lo: ../include/net-snmp/library/snmp_secmod.h
 ./text_utils.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./text_utils.lo: ../include/net-snmp/library/snmptsm.h
 ./text_utils.lo: ../include/net-snmp/library/snmpusm.h
+./text_utils.lo: ../include/net-snmp/library/snmptsm.h
 ./text_utils.lo: ../include/net-snmp/library/file_utils.h
 ./text_utils.lo: ../include/net-snmp/library/text_utils.h
 ./tools.lo: ../include/net-snmp/net-snmp-config.h
@@ -3112,7 +3281,9 @@
 ./tools.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./tools.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./tools.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./tools.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./tools.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./tools.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./tools.lo: ../include/net-snmp/library/ucd_compat.h
 ./tools.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./tools.lo: ../include/net-snmp/library/parse.h
@@ -3164,7 +3335,9 @@
 ./ucd_compat.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./ucd_compat.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./ucd_compat.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./ucd_compat.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./ucd_compat.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./ucd_compat.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./ucd_compat.lo: ../include/net-snmp/library/ucd_compat.h
 ./ucd_compat.lo: ../include/net-snmp/library/mib.h
 ./ucd_compat.lo: ../include/net-snmp/mib_api.h
@@ -3181,8 +3354,7 @@
 ./ucd_compat.lo: ../include/net-snmp/library/vacm.h
 ./ucd_compat.lo: ../include/ucd-snmp/default_store.h
 ./vacm.lo: ../include/net-snmp/net-snmp-config.h
-./vacm.lo: ../include/net-snmp/types.h
-./vacm.lo: ../include/net-snmp/library/oid.h
+./vacm.lo: ../include/net-snmp/types.h ../include/net-snmp/library/oid.h
 ./vacm.lo: ../include/net-snmp/library/types.h
 ./vacm.lo: ../include/net-snmp/definitions.h
 ./vacm.lo: ../include/net-snmp/library/snmp_api.h
@@ -3206,7 +3378,9 @@
 ./vacm.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./vacm.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./vacm.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./vacm.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./vacm.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./vacm.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./vacm.lo: ../include/net-snmp/library/ucd_compat.h
 ./vacm.lo: ../include/net-snmp/library/mib.h ../include/net-snmp/mib_api.h
 ./vacm.lo: ../include/net-snmp/library/parse.h
@@ -3247,22 +3421,22 @@
 ./openssl/openssl_sha1.lo: ./openssl/openssl_md32_common.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/net-snmp-config.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
-./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/types.h
+./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmp_transport.h
+./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/asn1.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/oid.h
+./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/types.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/types.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/definitions.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmp_api.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/varbind_api.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmp_client.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/pdu_api.h
-./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/asn1.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/output_api.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/netsnmp-attribute-format.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmp_debug.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmp_logging.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/session_api.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/callback.h
-./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmp_transport.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmp_service.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmpCallbackDomain.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmpUnixDomain.h
@@ -3273,6 +3447,7 @@
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpAAL5PVCDomain.lo: ../include/net-snmp/library/mib.h
@@ -3317,7 +3492,9 @@
 ./transports/snmpAliasDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpAliasDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpAliasDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpAliasDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpAliasDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpAliasDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpAliasDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpAliasDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpAliasDomain.lo: ../include/net-snmp/mib_api.h
@@ -3360,8 +3537,8 @@
 ./transports/snmpAliasDomain.lo: ../include/net-snmp/library/lcd_time.h
 ./transports/snmpAliasDomain.lo: ../include/net-snmp/library/snmp_secmod.h
 ./transports/snmpAliasDomain.lo: ../include/net-snmp/library/snmpv3-security-includes.h
-./transports/snmpAliasDomain.lo: ../include/net-snmp/library/snmptsm.h
 ./transports/snmpAliasDomain.lo: ../include/net-snmp/library/snmpusm.h
+./transports/snmpAliasDomain.lo: ../include/net-snmp/library/snmptsm.h
 ./transports/snmpCallbackDomain.lo: ../include/net-snmp/net-snmp-config.h
 ./transports/snmpCallbackDomain.lo: ../include/net-snmp/library/snmpCallbackDomain.h
 ./transports/snmpCallbackDomain.lo: ../include/net-snmp/types.h
@@ -3389,7 +3566,9 @@
 ./transports/snmpCallbackDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpCallbackDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpCallbackDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpCallbackDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpCallbackDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpCallbackDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpCallbackDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpCallbackDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpCallbackDomain.lo: ../include/net-snmp/mib_api.h
@@ -3422,6 +3601,47 @@
 ./transports/snmpCallbackDomain.lo: ../include/net-snmp/library/snmp_assert.h
 ./transports/snmpCallbackDomain.lo: ../include/net-snmp/version.h
 ./transports/snmpDTLSUDPDomain.lo: ../include/net-snmp/net-snmp-config.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/net-snmp-config.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/types.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/oid.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/types.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/definitions.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmp_api.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/varbind_api.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmp_client.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/pdu_api.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/asn1.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/output_api.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/netsnmp-attribute-format.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmp_debug.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmp_logging.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/session_api.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/callback.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmp_transport.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmp_service.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmpCallbackDomain.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmpUnixDomain.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmpUDPDomain.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmpUDPIPv4BaseDomain.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmpIPv4BaseDomain.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmpUDPBaseDomain.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/ucd_compat.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/mib.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/mib_api.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/parse.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/oid_stash.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/net-snmp-features.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmp_impl.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmp.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmp-tc.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/system.h
+./transports/snmpIPBaseDomain.lo: ../include/net-snmp/library/snmpIPBaseDomain.h
 ./transports/snmpIPXDomain.lo: ../include/net-snmp/net-snmp-config.h
 ./transports/snmpIPXDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
 ./transports/snmpIPXDomain.lo: ../include/net-snmp/library/snmp_transport.h
@@ -3450,6 +3670,8 @@
 ./transports/snmpIPXDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpIPXDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpIPXDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpIPXDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
+./transports/snmpIPXDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpIPXDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpIPXDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpIPXDomain.lo: ../include/net-snmp/mib_api.h
@@ -3494,7 +3716,9 @@
 ./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/mib_api.h
@@ -3504,6 +3728,7 @@
 ./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/snmp_impl.h
 ./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/snmp.h
 ./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/snmp-tc.h
+./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/snmpIPBaseDomain.h
 ./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/snmp_assert.h
 ./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/default_store.h
 ./transports/snmpIPv4BaseDomain.lo: ../include/net-snmp/library/system.h
@@ -3512,7 +3737,7 @@
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/net-snmp-config.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/net-snmp-features.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmp_assert.h
-./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmp_logging.h
+./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmpSSHDomain.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/types.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/oid.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/types.h
@@ -3525,6 +3750,7 @@
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/output_api.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/netsnmp-attribute-format.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmp_debug.h
+./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmp_logging.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/session_api.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/callback.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmp_transport.h
@@ -3538,7 +3764,9 @@
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/mib_api.h
@@ -3547,7 +3775,6 @@
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmp_impl.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmp.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmp-tc.h
-./transports/snmpSSHDomain.lo: ../include/net-snmp/library/snmpSSHDomain.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/tools.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/system.h
 ./transports/snmpSSHDomain.lo: ../include/net-snmp/library/default_store.h
@@ -3585,7 +3812,9 @@
 ./transports/snmpSTDDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpSTDDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpSTDDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpSTDDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpSTDDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpSTDDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpSTDDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpSTDDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpSTDDomain.lo: ../include/net-snmp/mib_api.h
@@ -3623,7 +3852,9 @@
 ./transports/snmpSocketBaseDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpSocketBaseDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpSocketBaseDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpSocketBaseDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpSocketBaseDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpSocketBaseDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpSocketBaseDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpSocketBaseDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpSocketBaseDomain.lo: ../include/net-snmp/mib_api.h
@@ -3665,7 +3896,9 @@
 ./transports/snmpTCPBaseDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpTCPBaseDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpTCPBaseDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpTCPBaseDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpTCPBaseDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpTCPBaseDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpTCPBaseDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpTCPBaseDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpTCPBaseDomain.lo: ../include/net-snmp/mib_api.h
@@ -3703,7 +3936,9 @@
 ./transports/snmpTCPDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpTCPDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpTCPDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpTCPDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpTCPDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpTCPDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpTCPDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpTCPDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpTCPDomain.lo: ../include/net-snmp/mib_api.h
@@ -3713,6 +3948,7 @@
 ./transports/snmpTCPDomain.lo: ../include/net-snmp/library/snmp_impl.h
 ./transports/snmpTCPDomain.lo: ../include/net-snmp/library/snmp.h
 ./transports/snmpTCPDomain.lo: ../include/net-snmp/library/snmp-tc.h
+./transports/snmpTCPDomain.lo: ../include/net-snmp/library/snmpIPBaseDomain.h
 ./transports/snmpTCPDomain.lo: ../include/net-snmp/library/snmpSocketBaseDomain.h
 ./transports/snmpTCPDomain.lo: ../include/net-snmp/library/snmpTCPBaseDomain.h
 ./transports/snmpTCPDomain.lo: ../include/net-snmp/library/tools.h
@@ -3746,7 +3982,9 @@
 ./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/mib_api.h
@@ -3755,6 +3993,7 @@
 ./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/library/snmp_impl.h
 ./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/library/snmp.h
 ./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/library/snmp-tc.h
+./transports/snmpTLSBaseDomain.lo: ./memcheck.h
 ./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/config_api.h
 ./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/library/read_config.h
 ./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/library/default_store.h
@@ -3772,6 +4011,7 @@
 ./transports/snmpTLSBaseDomain.lo: ../include/net-snmp/library/snmpTLSBaseDomain.h
 ./transports/snmpTLSTCPDomain.lo: ../include/net-snmp/net-snmp-config.h
 ./transports/snmpTLSTCPDomain.lo: ../include/net-snmp/net-snmp-features.h
+./transports/snmpTLSTCPDomain.lo: ./memcheck.h
 ./transports/snmpTLSTCPDomain.lo: ../include/net-snmp/types.h
 ./transports/snmpTLSTCPDomain.lo: ../include/net-snmp/library/oid.h
 ./transports/snmpTLSTCPDomain.lo: ../include/net-snmp/library/types.h
@@ -3798,7 +4038,9 @@
 ./transports/snmpTLSTCPDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpTLSTCPDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpTLSTCPDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpTLSTCPDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpTLSTCPDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpTLSTCPDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpTLSTCPDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpTLSTCPDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpTLSTCPDomain.lo: ../include/net-snmp/mib_api.h
@@ -3850,7 +4092,9 @@
 ./transports/snmpUDPBaseDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpUDPBaseDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpUDPBaseDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpUDPBaseDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpUDPBaseDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpUDPBaseDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpUDPBaseDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpUDPBaseDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpUDPBaseDomain.lo: ../include/net-snmp/mib_api.h
@@ -3892,7 +4136,9 @@
 ./transports/snmpUDPDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpUDPDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpUDPDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpUDPDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpUDPDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpUDPDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpUDPDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpUDPDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpUDPDomain.lo: ../include/net-snmp/mib_api.h
@@ -3902,6 +4148,7 @@
 ./transports/snmpUDPDomain.lo: ../include/net-snmp/library/snmp_impl.h
 ./transports/snmpUDPDomain.lo: ../include/net-snmp/library/snmp.h
 ./transports/snmpUDPDomain.lo: ../include/net-snmp/library/snmp-tc.h
+./transports/snmpUDPDomain.lo: ../include/net-snmp/library/snmpIPBaseDomain.h
 ./transports/snmpUDPDomain.lo: ../include/net-snmp/config_api.h
 ./transports/snmpUDPDomain.lo: ../include/net-snmp/library/read_config.h
 ./transports/snmpUDPDomain.lo: ../include/net-snmp/library/default_store.h
@@ -3939,7 +4186,9 @@
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/mib_api.h
@@ -3949,13 +4198,14 @@
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/snmp_impl.h
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/snmp.h
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/snmp-tc.h
+./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/snmpIPBaseDomain.h
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/tools.h
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/snmp_assert.h
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/default_store.h
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/snmpSocketBaseDomain.h
 ./transports/snmpUDPIPv4BaseDomain.lo: ../include/net-snmp/library/sd-daemon.h
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/net-snmp-config.h
-./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
+./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/snmpIPBaseDomain.h
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/types.h
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/oid.h
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/types.h
@@ -3980,7 +4230,11 @@
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/snmpIPv4BaseDomain.h
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/snmpUDPBaseDomain.h
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/snmpTCPDomain.h
+./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
+./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/mib_api.h
@@ -3990,7 +4244,6 @@
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/snmp_impl.h
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/snmp.h
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/snmp-tc.h
-./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
 ./transports/snmpUDPIPv6Domain.lo: ../include/net-snmp/library/system.h
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/net-snmp-config.h
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/types.h
@@ -4019,7 +4272,9 @@
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/mib_api.h
@@ -4029,6 +4284,7 @@
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/snmp_impl.h
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/snmp.h
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/snmp-tc.h
+./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/snmpIPBaseDomain.h
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/snmpUDPsharedDomain.h
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/tools.h
 ./transports/snmpUDPsharedDomain.lo: ../include/net-snmp/library/snmp_assert.h
@@ -4061,7 +4317,9 @@
 ./transports/snmpUnixDomain.lo: ../include/net-snmp/library/snmpTCPDomain.h
 ./transports/snmpUnixDomain.lo: ../include/net-snmp/library/snmpUDPIPv6Domain.h
 ./transports/snmpUnixDomain.lo: ../include/net-snmp/library/snmpIPv6BaseDomain.h
+./transports/snmpUnixDomain.lo: ../include/net-snmp/library/snmpTCPIPv6Domain.h
 ./transports/snmpUnixDomain.lo: ../include/net-snmp/library/snmpIPXDomain.h
+./transports/snmpUnixDomain.lo: ../include/net-snmp/library/snmpAAL5PVCDomain.h
 ./transports/snmpUnixDomain.lo: ../include/net-snmp/library/ucd_compat.h
 ./transports/snmpUnixDomain.lo: ../include/net-snmp/library/mib.h
 ./transports/snmpUnixDomain.lo: ../include/net-snmp/mib_api.h
diff -urpN net-snmp-5.8/snmplib/asn1.c net-snmp-5.9.1/snmplib/asn1.c
--- net-snmp-5.8/snmplib/asn1.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/asn1.c	2021-05-26 05:19:35.000000000 +0700
@@ -175,6 +175,9 @@ SOFTWARE.
 
 #include <sys/types.h>
 #include <stdio.h>
+#ifdef HAVE_STDINT_H
+#include <stdint.h>
+#endif
 #ifdef HAVE_STDLIB_H
 #include <stdlib.h>
 #endif
@@ -186,10 +189,6 @@ SOFTWARE.
 #include <in.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/output_api.h>
 #include <net-snmp/utilities.h>
 
@@ -302,16 +301,13 @@ _asn_length_err(const char *str, size_t
  * @param wrongsize  wrong  length
  * @param rightsize  expected length
  */
-static
-    void
+static void
 _asn_short_err(const char *str, size_t wrongsize, size_t rightsize)
 {
     char            ebuf[128];
 
-    snprintf(ebuf, sizeof(ebuf),
-            "%s length %lu too short: need %lu", str,
+    snprintf(ebuf, sizeof(ebuf), "%s length %lu too short: need %lu", str,
 	    (unsigned long)wrongsize, (unsigned long)rightsize);
-    ebuf[ sizeof(ebuf)-1 ] = 0;
     ERROR_MSG(ebuf);
 }
 
@@ -349,7 +345,7 @@ asn_parse_nlength(u_char *pkt, size_t pk
          * long length; first byte is length of length (after masking high bit)
          */
         len_len = (int) ((*pkt & ~0x80) + 1);
-        if ((int) pkt_len <= len_len )
+        if (pkt_len < len_len)
             return NULL;           /* still too short for length and data */
 
         /* now we know we have enough data to parse length */
@@ -576,7 +572,11 @@ asn_parse_int(u_char * data,
     static const char *errpre = "parse int";
     register u_char *bufp = data;
     u_long          asn_length;
-    register long   value = 0;
+    int             i;
+    union {
+        long          l;
+        unsigned char b[sizeof(long)];
+    } value;
 
     if (NULL == data || NULL == datalength || NULL == type || NULL == intp) {
         ERROR_MSG("parse int: NULL pointer");
@@ -612,19 +612,23 @@ asn_parse_int(u_char * data,
     }
 
     *datalength -= (int) asn_length + (bufp - data);
-    if (*bufp & 0x80)
-        value = -1;             /* integer is negative */
 
     DEBUGDUMPSETUP("recv", data, bufp - data + asn_length);
 
-    while (asn_length--)
-        value = (value << 8) | *bufp++;
+    memset(&value.b, *bufp & 0x80 ? 0xff : 0, sizeof(value.b));
+    if (NETSNMP_BIGENDIAN) {
+        for (i = sizeof(long) - asn_length; asn_length--; i++)
+            value.b[i] = *bufp++;
+    } else {
+        for (i = asn_length - 1; asn_length--; i--)
+            value.b[i] = *bufp++;
+    }
 
-    CHECK_OVERFLOW_S(value,1);
+    CHECK_OVERFLOW_S(value.l, 1);
 
-    DEBUGMSG(("dumpv_recv", "  Integer:\t%ld (0x%.2lX)\n", value, value));
+    DEBUGMSG(("dumpv_recv", "  Integer:\t%ld (0x%.2lX)\n", value.l, value.l));
 
-    *intp = value;
+    *intp = value.l;
     return bufp;
 }
 
@@ -1033,8 +1037,9 @@ asn_build_string(u_char * data,
         u_char         *buf = (u_char *) malloc(1 + strlength);
         size_t          l = (buf != NULL) ? (1 + strlength) : 0, ol = 0;
 
-        if (sprint_realloc_asciistring
-            (&buf, &l, &ol, 1, str, strlength)) {
+        if (sprint_realloc_asciistring(&buf, &l, &ol, 1,
+                                       str ? str : (const u_char *)"",
+                                       strlength)) {
             DEBUGMSG(("dumpv_send", "  String:\t%s\n", buf));
         } else {
             if (buf == NULL) {
@@ -1534,7 +1539,7 @@ asn_parse_objid(u_char * data,
      *  X is the value of the first subidentifier.
      *  Y is the value of the second subidentifier.
      */
-    subidentifier = (u_long) objid[1];
+    subidentifier = oidp - objid >= 2 ? objid[1] : 0;
     if (subidentifier == 0x2B) {
         objid[0] = 1;
         objid[1] = 3;
diff -urpN net-snmp-5.8/snmplib/asprintf.c net-snmp-5.9.1/snmplib/asprintf.c
--- net-snmp-5.8/snmplib/asprintf.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/asprintf.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,10 +1,18 @@
+#include <net-snmp/net-snmp-config.h>
 #include <stdarg.h>
 #include <stdio.h>
 #include <stdlib.h>
-#include <net-snmp/net-snmp-config.h>
+#include <string.h>
 
 #ifndef HAVE_ASPRINTF
 
+#ifdef va_copy
+#elif defined(__va_copy)
+#define va_copy __va_copy
+#else
+#define va_copy(dest, src) memcpy(&dest, &src, sizeof(va_list))
+#endif
+
 NETSNMP_IMPORT
 int vasprintf(char **strp, const char *fmt, va_list ap)
 {
@@ -12,11 +20,7 @@ int vasprintf(char **strp, const char *f
     char *str;
     int len;
 
-#ifdef va_copy
     va_copy(ap_copy, ap);
-#else
-    __va_copy(ap_copy, ap);
-#endif
     len = vsnprintf(NULL, 0, fmt, ap_copy);
     va_end(ap_copy);
 
diff -urpN net-snmp-5.8/snmplib/callback.c net-snmp-5.9.1/snmplib/callback.c
--- net-snmp-5.8/snmplib/callback.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/callback.c	2021-05-26 05:19:35.000000000 +0700
@@ -35,9 +35,6 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 
 #if HAVE_SYS_SOCKET_H
 #include <sys/socket.h>
@@ -53,10 +50,10 @@
 #include <net-snmp/library/callback.h>
 #include <net-snmp/library/snmp_api.h>
 
-netsnmp_feature_child_of(callbacks_all, libnetsnmp)
+netsnmp_feature_child_of(callbacks_all, libnetsnmp);
 
-netsnmp_feature_child_of(callback_count, callbacks_all)
-netsnmp_feature_child_of(callback_list, callbacks_all)
+netsnmp_feature_child_of(callback_count, callbacks_all);
+netsnmp_feature_child_of(callback_list, callbacks_all);
 
 /*
  * the inline callback methods use major/minor to index into arrays.
@@ -121,7 +118,7 @@ NETSNMP_STATIC_INLINE int
 _callback_lock(int major, int minor, const char* warn, int do_assert)
 {
     int lock_holded=0;
-    struct timeval lock_time = { 0, 1000 };
+    NETSNMP_SELECT_TIMEVAL lock_time = { 0, 1000 };
 
 #ifdef NETSNMP_PARANOID_LEVEL_HIGH
     if (major >= MAX_CALLBACK_IDS || minor >= MAX_CALLBACK_SUBIDS) {
diff -urpN net-snmp-5.8/snmplib/cert_util.c net-snmp-5.9.1/snmplib/cert_util.c
--- net-snmp-5.8/snmplib/cert_util.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/cert_util.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,28 +13,28 @@
 #include <net-snmp/net-snmp-features.h>
 
 #if defined(NETSNMP_USE_OPENSSL) && defined(HAVE_LIBSSL) && NETSNMP_TRANSPORT_TLSBASE_DOMAIN
-netsnmp_feature_child_of(cert_util_all, libnetsnmp)
-netsnmp_feature_child_of(cert_util, cert_util_all)
+netsnmp_feature_child_of(cert_util_all, libnetsnmp);
+netsnmp_feature_child_of(cert_util, cert_util_all);
 #ifdef NETSNMP_FEATURE_REQUIRE_CERT_UTIL
-netsnmp_feature_require(container_directory)
-netsnmp_feature_require(container_fifo)
-netsnmp_feature_require(container_dup)
-netsnmp_feature_require(container_free_all)
-netsnmp_feature_require(subcontainer_find)
-
-netsnmp_feature_child_of(cert_map_remove, netsnmp_unused)
-netsnmp_feature_child_of(cert_map_find, netsnmp_unused)
-netsnmp_feature_child_of(tlstmparams_external, cert_util_all)
-netsnmp_feature_child_of(tlstmparams_container, tlstmparams_external)
-netsnmp_feature_child_of(tlstmparams_remove, tlstmparams_external)
-netsnmp_feature_child_of(tlstmparams_find, tlstmparams_external)
-netsnmp_feature_child_of(tlstmAddr_remove, netsnmp_unused)
-netsnmp_feature_child_of(tlstmaddr_external, cert_util_all)
-netsnmp_feature_child_of(tlstmaddr_container, tlstmaddr_external)
-netsnmp_feature_child_of(tlstmAddr_get_serverId, tlstmaddr_external)
+netsnmp_feature_require(container_directory);
+netsnmp_feature_require(container_fifo);
+netsnmp_feature_require(container_dup);
+netsnmp_feature_require(container_free_all);
+netsnmp_feature_require(subcontainer_find);
+
+netsnmp_feature_child_of(cert_map_remove, netsnmp_unused);
+netsnmp_feature_child_of(cert_map_find, netsnmp_unused);
+netsnmp_feature_child_of(tlstmparams_external, cert_util_all);
+netsnmp_feature_child_of(tlstmparams_container, tlstmparams_external);
+netsnmp_feature_child_of(tlstmparams_remove, tlstmparams_external);
+netsnmp_feature_child_of(tlstmparams_find, tlstmparams_external);
+netsnmp_feature_child_of(tlstmAddr_remove, netsnmp_unused);
+netsnmp_feature_child_of(tlstmaddr_external, cert_util_all);
+netsnmp_feature_child_of(tlstmaddr_container, tlstmaddr_external);
+netsnmp_feature_child_of(tlstmAddr_get_serverId, tlstmaddr_external);
 
-netsnmp_feature_child_of(cert_fingerprints, cert_util_all)
-netsnmp_feature_child_of(tls_fingerprint_build, cert_util_all)
+netsnmp_feature_child_of(cert_fingerprints, cert_util_all);
+netsnmp_feature_child_of(tls_fingerprint_build, cert_util_all);
 
 #endif /* NETSNMP_FEATURE_REQUIRE_CERT_UTIL */
 
@@ -72,10 +72,6 @@ netsnmp_feature_child_of(tls_fingerprint
 # endif
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 #include <net-snmp/config_api.h>
@@ -148,7 +144,7 @@ void netsnmp_key_free(netsnmp_key *key);
 
 static int _certindex_add( const char *dirname, int i );
 
-static int _time_filter(netsnmp_file *f, struct stat *idx);
+static int _time_filter(const void *text, void *ctx);
 
 static void _init_tlstmCertToTSN(void);
 #define TRUSTCERT_CONFIG_TOKEN "trustCert"
@@ -483,7 +479,7 @@ _new_key(const char *dirname, const char
         return NULL;
     }
 
-#if !defined(_MSC_VER)
+#if !defined(_MSC_VER) && !defined(__MINGW32__)
     if ((fstat.st_mode & S_IROTH) || (fstat.st_mode & S_IWOTH)) {
         snmp_log(LOG_ERR,
                  "refusing to read world readable or writable key %s\n", fn);
@@ -704,9 +700,9 @@ _type_from_filename(const char *filename
 /*
  * filter functions; return 1 to include file, 0 to exclude
  */
-static int
-_cert_cert_filter(const char *filename)
+static int _cert_cert_filter(const void *text, void *ctx)
 {
+    const char *filename = text;
     int  len = strlen(filename);
     const char *pos;
 
@@ -1383,8 +1379,7 @@ _cert_read_index(const char *dirname, st
      */
     newer =
         netsnmp_directory_container_read_some(NULL, dirname,
-                                              (netsnmp_directory_filter*)
-                                              _time_filter,(void*)&idx_stat,
+                                              _time_filter, &idx_stat,
                                               NETSNMP_DIR_NSFILE |
                                               NETSNMP_DIR_NSFILE_STATS);
     if (newer) {
@@ -1410,7 +1405,7 @@ _cert_read_index(const char *dirname, st
     /*
      * check index format version
      */
-    fgets(tmpstr, sizeof(tmpstr), index);
+    NETSNMP_IGNORE_RESULT(fgets(tmpstr, sizeof(tmpstr), index));
     pos = strrchr(tmpstr, ' ');
     if (pos) {
         ++pos;
@@ -1443,8 +1438,8 @@ _cert_read_index(const char *dirname, st
             }
             type = atoi(type_str);
             hash = atoi(hash_str);
-            cert = (void*)_new_cert(dirname, filename, type, hash, fingerprint,
-                                    common_name, subject);
+            cert = _new_cert(dirname, filename, type, hash, fingerprint,
+                             common_name, subject);
             if (cert && 0 == CONTAINER_INSERT(found, cert))
                 ++count;
             else {
@@ -1546,8 +1541,7 @@ _add_certdir(const char *dirname)
      */
     cert_container =
         netsnmp_directory_container_read_some(NULL, dirname,
-                                              (netsnmp_directory_filter*)
-                                              &_cert_cert_filter, NULL,
+                                              _cert_cert_filter, NULL,
                                               NETSNMP_DIR_RELATIVE_PATH |
                                               NETSNMP_DIR_EMPTY_OK );
     if (NULL == cert_container) {
@@ -2396,8 +2390,11 @@ _key_find_fn(const char *filename)
 #endif
 
 static int
-_time_filter(netsnmp_file *f, struct stat *idx)
+_time_filter(const void *text, void *ctx)
 {
+    const netsnmp_file *f = text;
+    struct stat *idx = ctx;
+
     /** include if mtime or ctime newer than index mtime */
     if (f && idx && f->stats &&
         ((f->stats->st_mtime >= idx->st_mtime) ||
@@ -3220,15 +3217,19 @@ netsnmp_tlstmAddr_restore_common(char **
                                  char *id, size_t *id_len, char *fp,
                                  size_t *fp_len, u_char *ht)
 {
-    size_t fp_len_save = *fp_len;
+    size_t fp_len_save = *fp_len - 1;
 
     /*
      * Calling this function with name == NULL, fp == NULL or id == NULL would
      * trigger a memory leak.
      */
-    if (!name || !fp || !id)
+    if (!name || !fp || !id || *name_len == 0 || *id_len == 0 || *fp_len == 0)
         return -1;
 
+    (*name_len)--;
+    (*fp_len)--;
+    (*id_len)--;
+
     *line = read_config_read_octet_string(*line, (u_char **)&name, name_len);
     if (NULL == *line) {
         config_perror("incomplete line");
diff -urpN net-snmp-5.8/snmplib/check_varbind.c net-snmp-5.9.1/snmplib/check_varbind.c
--- net-snmp-5.8/snmplib/check_varbind.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/check_varbind.c	2021-05-26 05:19:35.000000000 +0700
@@ -5,23 +5,23 @@
 
 #include <net-snmp/library/check_varbind.h>
 
-netsnmp_feature_child_of(check_varbind_all, libnetsnmp)
+netsnmp_feature_child_of(check_varbind_all, libnetsnmp);
 
-netsnmp_feature_child_of(check_vb_range, check_varbind_all)
-netsnmp_feature_child_of(check_vb_size_range, check_varbind_all)
-netsnmp_feature_child_of(check_vb_uint, check_varbind_all)
-netsnmp_feature_child_of(check_vb_storagetype, check_varbind_all)
-netsnmp_feature_child_of(check_vb_oid, check_varbind_all)
-netsnmp_feature_child_of(check_vb_type_and_max_size, check_varbind_all)
-netsnmp_feature_child_of(check_vb_type_and_max_size, check_varbind_all)
-netsnmp_feature_child_of(check_vb_rowstatus_with_storagetype, check_varbind_all)
-netsnmp_feature_child_of(check_vb_truthvalue, check_varbind_all)
+netsnmp_feature_child_of(check_vb_range, check_varbind_all);
+netsnmp_feature_child_of(check_vb_size_range, check_varbind_all);
+netsnmp_feature_child_of(check_vb_uint, check_varbind_all);
+netsnmp_feature_child_of(check_vb_storagetype, check_varbind_all);
+netsnmp_feature_child_of(check_vb_oid, check_varbind_all);
+netsnmp_feature_child_of(check_vb_type_and_max_size, check_varbind_all);
+netsnmp_feature_child_of(check_vb_type_and_max_size, check_varbind_all);
+netsnmp_feature_child_of(check_vb_rowstatus_with_storagetype, check_varbind_all);
+netsnmp_feature_child_of(check_vb_truthvalue, check_varbind_all);
 
 #ifdef NETSNMP_FEATURE_REQUIRE_CHECK_VB_ROWSTATUS_WITH_STORAGETYPE
-netsnmp_feature_require(check_rowstatus_with_storagetype_transition)
+netsnmp_feature_require(check_rowstatus_with_storagetype_transition);
 #endif /* NETSNMP_FEATURE_REQUIRES_CHECK_VB_ROWSTATUS_WITH_STORAGETYPE */
 #ifdef NETSNMP_FEATURE_REQUIRE_CHECK_VB_STORAGETYPE
-netsnmp_feature_require(check_storage_transition)
+netsnmp_feature_require(check_storage_transition);
 #endif /* NETSNMP_FEATURE_REQUIRE_CHECK_VB_STORAGETYPE */
 
 
diff -urpN net-snmp-5.8/snmplib/closedir.c net-snmp-5.9.1/snmplib/closedir.c
--- net-snmp-5.8/snmplib/closedir.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/closedir.c	2021-05-26 05:19:35.000000000 +0700
@@ -7,6 +7,7 @@
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/types.h>
 #include <net-snmp/library/system.h>
+#include <stdlib.h>
 
 /*
  * free the memory allocated by opendir 
diff -urpN net-snmp-5.8/snmplib/container.c net-snmp-5.9.1/snmplib/container.c
--- net-snmp-5.8/snmplib/container.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/container.c	2021-05-26 05:19:35.000000000 +0700
@@ -21,23 +21,25 @@
 #include <net-snmp/library/container_list_ssll.h>
 #include <net-snmp/library/container_null.h>
 
-netsnmp_feature_child_of(container_all, libnetsnmp)
+#include <stdint.h>
 
-netsnmp_feature_child_of(container_factories, container_all)
-netsnmp_feature_child_of(container_types, container_all)
-netsnmp_feature_child_of(container_compare, container_all)
-netsnmp_feature_child_of(container_dup, container_all)
-netsnmp_feature_child_of(container_free_all, container_all)
-netsnmp_feature_child_of(subcontainer_find, container_all)
-
-netsnmp_feature_child_of(container_ncompare_cstring, container_compare)
-netsnmp_feature_child_of(container_compare_mem, container_compare)
-netsnmp_feature_child_of(container_compare_long, container_compare)
-netsnmp_feature_child_of(container_compare_ulong, container_compare)
-netsnmp_feature_child_of(container_compare_int32, container_compare)
-netsnmp_feature_child_of(container_compare_uint32, container_compare)
+netsnmp_feature_child_of(container_all, libnetsnmp);
 
-netsnmp_feature_child_of(container_find_factory, container_factories)
+netsnmp_feature_child_of(container_factories, container_all);
+netsnmp_feature_child_of(container_types, container_all);
+netsnmp_feature_child_of(container_compare, container_all);
+netsnmp_feature_child_of(container_dup, container_all);
+netsnmp_feature_child_of(container_free_all, container_all);
+netsnmp_feature_child_of(subcontainer_find, container_all);
+
+netsnmp_feature_child_of(container_ncompare_cstring, container_compare);
+netsnmp_feature_child_of(container_compare_mem, container_compare);
+netsnmp_feature_child_of(container_compare_long, container_compare);
+netsnmp_feature_child_of(container_compare_ulong, container_compare);
+netsnmp_feature_child_of(container_compare_int32, container_compare);
+netsnmp_feature_child_of(container_compare_uint32, container_compare);
+
+netsnmp_feature_child_of(container_find_factory, container_factories);
 
 /** @defgroup container container
  */
@@ -323,10 +325,6 @@ netsnmp_container_add_index(netsnmp_cont
     new_index->prev = curr;
 }
 
-/*------------------------------------------------------------------
- * These functions should EXACTLY match the inline version in
- * container.h. If you change one, change them both.
- */
 int CONTAINER_INSERT_HELPER(netsnmp_container* x, const void* k)
 {
     while(x && x->insert_filter && x->insert_filter(x,k) == 1)
@@ -346,10 +344,6 @@ int CONTAINER_INSERT_HELPER(netsnmp_cont
     return 0;
 }
 
-/*------------------------------------------------------------------
- * These functions should EXACTLY match the inline version in
- * container.h. If you change one, change them both.
- */
 int CONTAINER_INSERT(netsnmp_container* x, const void* k)
 {
     /** start at first container */
@@ -358,10 +352,6 @@ int CONTAINER_INSERT(netsnmp_container*
     return CONTAINER_INSERT_HELPER(x, k);
 }
 
-/*------------------------------------------------------------------
- * These functions should EXACTLY match the inline version in
- * container.h. If you change one, change them both.
- */
 int CONTAINER_INSERT_BEFORE(netsnmp_container *x, size_t pos, void *k)
 {
     int rc = 0;
@@ -380,10 +370,6 @@ int CONTAINER_INSERT_BEFORE(netsnmp_cont
     return rc;
 }
 
-/*------------------------------------------------------------------
- * These functions should EXACTLY match the inline version in
- * container.h. If you change one, change them both.
- */
 int CONTAINER_REMOVE(netsnmp_container *x, const void *k)
 {
     int rc2, rc = 0;
@@ -405,10 +391,6 @@ int CONTAINER_REMOVE(netsnmp_container *
     return rc;
 }
 
-/*------------------------------------------------------------------
- * These functions should EXACTLY match the inline version in
- * container.h. If you change one, change them both.
- */
 int CONTAINER_REMOVE_AT(netsnmp_container *x, size_t pos, void **k)
 {
     int rc = 0;
@@ -440,10 +422,6 @@ int CONTAINER_REMOVE_AT(netsnmp_containe
     return rc;
 }
 
-/*------------------------------------------------------------------
- * These functions should EXACTLY match the inline version in
- * container.h. If you change one, change them both.
- */
 int CONTAINER_GET_AT(netsnmp_container *x, size_t pos, void **k)
 {
     int rc = 0;
@@ -463,10 +441,6 @@ int CONTAINER_GET_AT(netsnmp_container *
     return rc;
 }
 
-/*------------------------------------------------------------------
- * These functions should EXACTLY match the function version in
- * container.c. If you change one, change them both.
- */
 #ifndef NETSNMP_FEATURE_REMOVE_CONTAINER_DUP
 netsnmp_container *CONTAINER_DUP(netsnmp_container *x, void *ctx, u_int flags)
 {
@@ -479,10 +453,6 @@ netsnmp_container *CONTAINER_DUP(netsnmp
 }
 #endif /* NETSNMP_FEATURE_REMOVE_CONTAINER_DUP */
 
-/*------------------------------------------------------------------
- * These functions should EXACTLY match the inline version in
- * container.h. If you change one, change them both.
- */
 int CONTAINER_FREE(netsnmp_container *x)
 {
     int  rc2, rc = 0;
@@ -511,10 +481,6 @@ int CONTAINER_FREE(netsnmp_container *x)
     return rc;
 }
 
-/*------------------------------------------------------------------
- * These functions should EXACTLY match the function version in
- * container.c. If you change one, change them both.
- */
 /*
  * clear all containers. When clearing the *first* container, and
  * *only* the first container, call the function f for each item.
@@ -546,10 +512,6 @@ void CONTAINER_FREE_ALL(netsnmp_containe
 #endif /* NETSNMP_FEATURE_REMOVE_CONTAINER_FREE_ALL */
 
 #ifndef NETSNMP_FEATURE_REMOVE_SUBCONTAINER_FIND
-/*------------------------------------------------------------------
- * These functions should EXACTLY match the function version in
- * container.c. If you change one, change them both.
- */
 /*
  * Find a sub-container with the given name
  */
diff -urpN net-snmp-5.8/snmplib/container_iterator.c net-snmp-5.9.1/snmplib/container_iterator.c
--- net-snmp-5.8/snmplib/container_iterator.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/container_iterator.c	2021-05-26 05:19:35.000000000 +0700
@@ -29,7 +29,7 @@
 
 #include <net-snmp/library/container_iterator.h>
 
-netsnmp_feature_child_of(container_iterator, container_types)
+netsnmp_feature_child_of(container_iterator, container_types);
 
 #ifndef NETSNMP_FEATURE_REMOVE_CONTAINER_ITERATOR
 /**
@@ -285,18 +285,21 @@ _iterator_get_next(iterator_info *ii, co
  * container
  *
  **********************************************************************/
-static void
-_iterator_free(iterator_info *ii)
+static int _iterator_free(netsnmp_container *c)
 {
+    iterator_info *ii = (iterator_info *)c;
+
     DEBUGMSGT(("container_iterator",">%s\n", "_iterator_free"));
     
     if(NULL == ii)
-        return;
+        return 0;
     
     if(ii->user_ctx)
         ii->free_user_ctx(ii->user_ctx,ii->user_ctx);
     
     free(ii);
+
+    return 0;
 }
 
 static void *
@@ -463,7 +466,7 @@ netsnmp_container_iterator_get(void *ite
     /*
      * init container structure with iterator functions
      */
-    ii->c.cfree = (netsnmp_container_rc*)_iterator_free;
+    ii->c.cfree = _iterator_free;
     ii->c.compare = compare;
     ii->c.get_size = (netsnmp_container_size*)_iterator_size;
     ii->c.init = NULL;
diff -urpN net-snmp-5.8/snmplib/container_list_ssll.c net-snmp-5.9.1/snmplib/container_list_ssll.c
--- net-snmp-5.8/snmplib/container_list_ssll.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/container_list_ssll.c	2021-05-26 05:19:35.000000000 +0700
@@ -29,16 +29,16 @@
 
 #include <net-snmp/library/container_list_ssll.h>
 
-netsnmp_feature_child_of(container_linked_list, container_types)
-netsnmp_feature_child_of(container_fifo, container_types)
-netsnmp_feature_child_of(container_lifo, container_types)
+netsnmp_feature_child_of(container_linked_list, container_types);
+netsnmp_feature_child_of(container_fifo, container_types);
+netsnmp_feature_child_of(container_lifo, container_types);
 
 /* this is a fancy way of cleaning up ifdefs */
 #ifdef NETSNMP_FEATURE_REQUIRE_CONTAINER_FIFO
-netsnmp_feature_require(container_linked_list)
+netsnmp_feature_require(container_linked_list);
 #endif /* NETSNMP_FEATURE_REQUIRE_CONTAINER_FIFO */
 #ifdef NETSNMP_FEATURE_REQUIRE_CONTAINER_LIFO
-netsnmp_feature_require(container_linked_list)
+netsnmp_feature_require(container_linked_list);
 #endif /* NETSNMP_FEATURE_REQUIRE_CONTAINER_LIFO */
 
 #ifndef NETSNMP_FEATURE_REMOVE_CONTAINER_LINKED_LIST
diff -urpN net-snmp-5.8/snmplib/container_null.c net-snmp-5.9.1/snmplib/container_null.c
--- net-snmp-5.8/snmplib/container_null.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/container_null.c	2021-05-26 05:19:35.000000000 +0700
@@ -34,7 +34,7 @@
 #include <net-snmp/library/tools.h>
 #include <net-snmp/library/snmp_assert.h>
 
-netsnmp_feature_child_of(container_null, container_types)
+netsnmp_feature_child_of(container_null, container_types);
 
 /** @defgroup null_container null_container
  *  Helps you implement specialized containers.
diff -urpN net-snmp-5.8/snmplib/data_list.c net-snmp-5.9.1/snmplib/data_list.c
--- net-snmp-5.8/snmplib/data_list.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/data_list.c	2021-05-26 05:19:35.000000000 +0700
@@ -14,10 +14,10 @@
 #include <net-snmp/net-snmp-features.h>
 #include <net-snmp/net-snmp-includes.h>
 
-netsnmp_feature_child_of(data_list_all, libnetsnmp)
+netsnmp_feature_child_of(data_list_all, libnetsnmp);
 
-netsnmp_feature_child_of(data_list_add_data, data_list_all)
-netsnmp_feature_child_of(data_list_get_list_node, data_list_all)
+netsnmp_feature_child_of(data_list_add_data, data_list_all);
+netsnmp_feature_child_of(data_list_get_list_node, data_list_all);
 
 /** @defgroup data_list generic linked-list data handling with a string as a key.
  * @ingroup library
diff -urpN net-snmp-5.8/snmplib/default_store.c net-snmp-5.9.1/snmplib/default_store.c
--- net-snmp-5.8/snmplib/default_store.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/default_store.c	2021-05-26 05:19:35.000000000 +0700
@@ -146,9 +146,6 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
@@ -158,9 +155,9 @@
 
 #include <net-snmp/library/snmp_api.h>
 
-netsnmp_feature_child_of(default_store_all, libnetsnmp)
+netsnmp_feature_child_of(default_store_all, libnetsnmp);
 
-netsnmp_feature_child_of(default_store_void, default_store_all)
+netsnmp_feature_child_of(default_store_void, default_store_all);
 
 #ifndef NETSNMP_FEATURE_REMOVE_DEFAULT_STORE_VOID
 #endif /* NETSNMP_FEATURE_REMOVE_DEFAULT_STORE_VOID */
diff -urpN net-snmp-5.8/snmplib/dir_utils.c net-snmp-5.9.1/snmplib/dir_utils.c
--- net-snmp-5.8/snmplib/dir_utils.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/dir_utils.c	2021-05-26 05:19:35.000000000 +0700
@@ -43,19 +43,15 @@
 
 #include <errno.h>
 
-#if HAVE_DMALLOC_H
-#  include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/library/container.h>
 #include <net-snmp/library/file_utils.h>
 #include <net-snmp/library/dir_utils.h>
 
-netsnmp_feature_child_of(container_directory, container_types)
+netsnmp_feature_child_of(container_directory, container_types);
 #ifdef NETSNMP_FEATURE_REQUIRE_CONTAINER_DIRECTORY
-netsnmp_feature_require(file_utils)
-netsnmp_feature_require(container_free_all)
+netsnmp_feature_require(file_utils);
+netsnmp_feature_require(container_free_all);
 #endif /* NETSNMP_FEATURE_REQUIRE_CONTAINER_DIRECTORY */
 
 #ifndef NETSNMP_FEATURE_REMOVE_CONTAINER_DIRECTORY
@@ -140,8 +136,7 @@ netsnmp_directory_container_read_some(ne
 
     /** iterate over dir */
     while ((file = readdir(dir))) {
-
-        if ((file->d_name == NULL) || (file->d_name[0] == 0))
+        if (file->d_name[0] == 0)
             continue;
 
         /** skip '.' and '..' */
diff -urpN net-snmp-5.8/snmplib/fd_event_manager.c net-snmp-5.9.1/snmplib/fd_event_manager.c
--- net-snmp-5.8/snmplib/fd_event_manager.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/fd_event_manager.c	2021-05-26 05:19:35.000000000 +0700
@@ -10,7 +10,7 @@
 #include <net-snmp/library/snmp_logging.h>
 #include <net-snmp/library/large_fd_set.h>
 
-netsnmp_feature_child_of(fd_event_manager, libnetsnmp)
+netsnmp_feature_child_of(fd_event_manager, libnetsnmp);
 
 #ifndef NETSNMP_FEATURE_REMOVE_FD_EVENT_MANAGER
 int     external_readfd[NUM_EXTERNAL_FDS],   external_readfdlen   = 0;
diff -urpN net-snmp-5.8/snmplib/file_utils.c net-snmp-5.9.1/snmplib/file_utils.c
--- net-snmp-5.8/snmplib/file_utils.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/file_utils.c	2021-05-26 05:19:35.000000000 +0700
@@ -33,17 +33,13 @@
 
 #include <errno.h>
 
-#if HAVE_DMALLOC_H
-#  include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/library/container.h>
 #include <net-snmp/library/file_utils.h>
 
-netsnmp_feature_child_of(file_utils_all, libnetsnmp)
-netsnmp_feature_child_of(file_utils, file_utils_all)
-netsnmp_feature_child_of(file_close, file_utils_all)
+netsnmp_feature_child_of(file_utils_all, libnetsnmp);
+netsnmp_feature_child_of(file_utils, file_utils_all);
+netsnmp_feature_child_of(file_close, file_utils_all);
 
 #ifndef NETSNMP_FEATURE_REMOVE_FILE_UTILS
 /*------------------------------------------------------------------
diff -urpN net-snmp-5.8/snmplib/getopt.c net-snmp-5.9.1/snmplib/getopt.c
--- net-snmp-5.8/snmplib/getopt.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/getopt.c	2021-05-26 05:19:35.000000000 +0700
@@ -27,14 +27,6 @@
  * SUCH DAMAGE.
  */
 
-#if defined(LIBC_SCCS) && !defined(lint)
-/*
- * static char sccsid[] = "from: @(#)getopt.c   8.2 (Berkeley) 4/2/94"; 
- */
-static char    *rcsid =
-    "$Id$";
-#endif                          /* LIBC_SCCS and not lint */
-
 #include <net-snmp/net-snmp-config.h>
 
 #include <stdio.h>
diff -urpN net-snmp-5.8/snmplib/inet_ntop.c net-snmp-5.9.1/snmplib/inet_ntop.c
--- net-snmp-5.8/snmplib/inet_ntop.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/inet_ntop.c	2021-05-26 05:19:35.000000000 +0700
@@ -19,6 +19,10 @@
 
 #include <net-snmp/net-snmp-config.h>
 
+#if HAVE_NETINET_IN_H
+#include <netinet/in.h>
+#endif
+
 #if HAVE_ARPA_NAMESER_H
 #include <arpa/nameser.h>
 #endif
diff -urpN net-snmp-5.8/snmplib/inet_pton.c net-snmp-5.9.1/snmplib/inet_pton.c
--- net-snmp-5.8/snmplib/inet_pton.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/inet_pton.c	2021-05-26 05:19:35.000000000 +0700
@@ -21,6 +21,10 @@
 
 #include <ctype.h>
 
+#if HAVE_NETINET_IN_H
+#include <netinet/in.h>
+#endif
+
 #if HAVE_ARPA_NAMESER_H
 #include <arpa/nameser.h>
 #endif
diff -urpN net-snmp-5.8/snmplib/int64.c net-snmp-5.9.1/snmplib/int64.c
--- net-snmp-5.8/snmplib/int64.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/int64.c	2021-05-26 05:19:35.000000000 +0700
@@ -11,6 +11,9 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <ctype.h>
+#ifdef HAVE_INTTYPES_H
+#include <inttypes.h>
+#endif
 #if HAVE_STRING_H
 #include <string.h>
 #else
@@ -201,7 +204,7 @@ u64UpdateCounter(struct counter64 *pu64o
     u64Incr(pu64out, &tmp);
 }
 
-netsnmp_feature_child_of(u64copy, netsnmp_unused)
+netsnmp_feature_child_of(u64copy, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_U64COPY
 /**
  * Copy a 64-bit number.
diff -urpN net-snmp-5.8/snmplib/keytools.c net-snmp-5.9.1/snmplib/keytools.c
--- net-snmp-5.8/snmplib/keytools.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/keytools.c	2021-05-26 05:19:35.000000000 +0700
@@ -38,9 +38,6 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 
 #include <math.h>
 
@@ -73,8 +70,8 @@
 #include <net-snmp/library/snmp_secmod.h>
 #include <net-snmp/library/snmpusm.h>
 
-netsnmp_feature_child_of(usm_support, libnetsnmp)
-netsnmp_feature_child_of(usm_keytools, usm_support)
+netsnmp_feature_child_of(usm_support, libnetsnmp);
+netsnmp_feature_child_of(usm_keytools, usm_support);
 
 #ifndef NETSNMP_FEATURE_REMOVE_USM_KEYTOOLS
 
@@ -186,11 +183,15 @@ generate_Ku(const oid * hashtype, u_int
     ctx = EVP_MD_CTX_create();
 #else
     ctx = malloc(sizeof(*ctx));
-    if (!EVP_MD_CTX_init(ctx))
-        return SNMPERR_GENERR;
+    if (!EVP_MD_CTX_init(ctx)) {
+        rval = SNMPERR_GENERR;
+        goto generate_Ku_quit;
+    }
 #endif
-    if (!EVP_DigestInit(ctx, hashfn))
-        return SNMPERR_GENERR;
+    if (!EVP_DigestInit(ctx, hashfn)) {
+        rval = SNMPERR_GENERR;
+        goto generate_Ku_quit;
+    }
 
 #elif NETSNMP_USE_INTERNAL_CRYPTO
 #ifndef NETSNMP_DISABLE_MD5
@@ -943,7 +944,7 @@ encode_keychange(const oid * hashtype, u
     /*
      * Sanity check.
      */
-    if (!hashtype || !oldkey || !newkey || !kcstring || !kcstring_len
+    if (!hashtype || !oldkey || !newkey || !kcstring
         || (oldkey_len != newkey_len ) || (newkey_len == 0)
         || (*kcstring_len < (2 * newkey_len))) {
         QUITFUN(SNMPERR_GENERR, encode_keychange_quit);
@@ -1223,10 +1224,10 @@ KeyChange ::=     TEXTUAL-CONVENTION
  * XXX:  if the newkey is not long enough, it should be freed and remalloced 
  */
 int
-decode_keychange(const oid * hashtype, u_int hashtype_len,
-                 u_char * oldkey, size_t oldkey_len,
-                 u_char * kcstring, size_t kcstring_len,
-                 u_char * newkey, size_t * newkey_len)
+decode_keychange(const oid *hashtype, u_int hashtype_len,
+                 const u_char *oldkey, size_t oldkey_len,
+                 const u_char *kcstring, size_t kcstring_len,
+                 u_char *newkey, size_t *newkey_len)
 #if defined(NETSNMP_USE_OPENSSL) || defined(NETSNMP_USE_INTERNAL_MD5) || defined(NETSNMP_USE_PKCS11) || defined(NETSNMP_USE_INTERNAL_CRYPTO)
 {
     int             rval = SNMPERR_SUCCESS, auth_type;
@@ -1234,7 +1235,8 @@ decode_keychange(const oid * hashtype, u
     int             ihash_len = 0;
     u_int           nbytes = 0;
 
-    u_char         *deltap, hash[SNMP_MAXBUF];
+    const u_char   *deltap;
+    u_char          hash[SNMP_MAXBUF];
     size_t          delta_len, tmpbuf_len;
     u_char         *tmpbuf = NULL;
 #ifdef NETSNMP_ENABLE_TESTING_CODE
diff -urpN net-snmp-5.8/snmplib/large_fd_set.c net-snmp-5.9.1/snmplib/large_fd_set.c
--- net-snmp-5.8/snmplib/large_fd_set.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/large_fd_set.c	2021-05-26 05:19:35.000000000 +0700
@@ -176,6 +176,12 @@ netsnmp_large_fd_set_select(int numfds,
                      netsnmp_large_fd_set *exceptfds,
                      struct timeval *timeout)
 {
+    NETSNMP_SELECT_TIMEVAL tmo;
+
+    if (timeout) {
+        tmo.tv_sec  = timeout->tv_sec;
+        tmo.tv_usec = timeout->tv_usec;
+    }
 #if defined(cygwin) || !defined(HAVE_WINSOCK_H)
     /* Bit-set representation: make sure all fds have at least size 'numfds'. */
     if (readfds && readfds->lfs_setsize < numfds)
@@ -190,7 +196,8 @@ netsnmp_large_fd_set_select(int numfds,
 
     return select(numfds, (readfds) ? readfds->lfs_setptr : NULL,
                   (writefds) ? writefds->lfs_setptr : NULL,
-                  (exceptfds) ? exceptfds->lfs_setptr : NULL, timeout);
+                  (exceptfds) ? exceptfds->lfs_setptr : NULL,
+                  timeout ? &tmo : NULL);
 }
 
 int
diff -urpN net-snmp-5.8/snmplib/lcd_time.c net-snmp-5.9.1/snmplib/lcd_time.c
--- net-snmp-5.8/snmplib/lcd_time.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/lcd_time.c	2021-05-26 05:19:35.000000000 +0700
@@ -35,9 +35,6 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
@@ -53,8 +50,8 @@
 
 #include <net-snmp/library/transform_oids.h>
 
-netsnmp_feature_child_of(usm_support, libnetsnmp)
-netsnmp_feature_child_of(usm_lcd_time, usm_support)
+netsnmp_feature_child_of(usm_support, libnetsnmp);
+netsnmp_feature_child_of(usm_lcd_time, usm_support);
 
 #ifndef NETSNMP_FEATURE_REMOVE_USM_LCD_TIME
 
diff -urpN net-snmp-5.8/snmplib/md5.c net-snmp-5.9.1/snmplib/md5.c
--- net-snmp-5.8/snmplib/md5.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/md5.c	2021-05-26 05:19:35.000000000 +0700
@@ -25,22 +25,6 @@
  */
 
 /*
- * Implementation notes:
- * ** This implementation assumes that ints are 32-bit quantities.
- * ** If the machine stores the least-significant byte of an int in the
- * ** least-addressed byte (eg., VAX and 8086), then LOWBYTEFIRST should be
- * ** set to TRUE.  Otherwise (eg., SUNS), LOWBYTEFIRST should be set to
- * ** FALSE.  Note that on machines with LOWBYTEFIRST FALSE the routine
- * ** MDupdate modifies has a side-effect on its input array (the order of bytes
- * ** in each word are reversed).  If this is undesired a call to MDreverse(X) can
- * ** reverse the bytes of X back into order after each call to MDupdate.
- */
-
-/*
- * code uses WORDS_BIGENDIAN defined by configure now  -- WH 9/27/95 
- */
-
-/*
  * Compile-time includes 
  */
 
@@ -49,6 +33,9 @@
 #ifndef NETSNMP_DISABLE_MD5
 
 #include <stdio.h>
+#ifdef HAVE_INTTYPES_H
+#include <inttypes.h>
+#endif
 #include <sys/types.h>
 #if HAVE_STRING_H
 #include <string.h>
@@ -90,6 +77,22 @@
 
 
 /*
+ * Read four bytes starting from address p and interpret these four bytes
+ * as a 32-bits little endian integer.
+ */
+NETSNMP_STATIC_INLINE uint32_t le32(const uint32_t *p)
+{
+    uint32_t res = *p;
+
+    if (NETSNMP_BIGENDIAN) {
+        uint32_t t = (res << 16) | (res >> 16);
+        res = ((t & 0xFF00FF00) >> 8) | ((t & 0x00FF00FF) << 8);
+    }
+
+    return res;
+}
+
+/*
  * Compile-time macro declarations for MD5.
  * ** Note: The ``rot'' operator uses the variable ``tmp''.
  * ** It assumes tmp is declared as unsigned int, so that the >>
@@ -100,10 +103,10 @@
 #define h(X,Y,Z)             (X^Y^Z)
 #define i_(X,Y,Z)            (Y ^ ((X) | (~Z)))
 #define rot(X,S)             (tmp=X,(tmp<<S) | (tmp>>(32-S)))
-#define ff(A,B,C,D,i,s,lp)   A = rot((A + f(B,C,D) + X[i] + lp),s) + B
-#define gg(A,B,C,D,i,s,lp)   A = rot((A + g(B,C,D) + X[i] + lp),s) + B
-#define hh(A,B,C,D,i,s,lp)   A = rot((A + h(B,C,D) + X[i] + lp),s) + B
-#define ii(A,B,C,D,i,s,lp)   A = rot((A + i_(B,C,D) + X[i] + lp),s) + B
+#define ff(A,B,C,D,i,s,lp)   A = rot((A + f(B,C,D) + le32(&X[i]) + lp),s) + B
+#define gg(A,B,C,D,i,s,lp)   A = rot((A + g(B,C,D) + le32(&X[i]) + lp),s) + B
+#define hh(A,B,C,D,i,s,lp)   A = rot((A + h(B,C,D) + le32(&X[i]) + lp),s) + B
+#define ii(A,B,C,D,i,s,lp)   A = rot((A + i_(B,C,D) + le32(&X[i]) + lp),s) + B
 
 #ifdef STDC_HEADERS
 #define Uns(num) num##U
@@ -111,9 +114,6 @@
 #define Uns(num) num
 #endif                          /* STDC_HEADERS */
 
-void            MDreverse(unsigned int *);
-static void     MDblock(MDptr, const unsigned int *);
-
 #ifdef NETSNMP_ENABLE_TESTING_CODE
 /*
  * MDprint(MDp)
@@ -153,37 +153,6 @@ MDbegin(MDptr MDp)
 }
 
 /*
- * MDreverse(X)
- * ** Reverse the byte-ordering of every int in X.
- * ** Assumes X is an array of 16 ints.
- * ** The macro revx reverses the byte-ordering of the next word of X.
- */
-#define revx { t = (*X << 16) | (*X >> 16); \
-	       *X++ = ((t & 0xFF00FF00) >> 8) | ((t & 0x00FF00FF) << 8); }
-
-void
-MDreverse(unsigned int *X)
-{
-    register unsigned int t;
-    revx;
-    revx;
-    revx;
-    revx;
-    revx;
-    revx;
-    revx;
-    revx;
-    revx;
-    revx;
-    revx;
-    revx;
-    revx;
-    revx;
-    revx;
-    revx;
-}
-
-/*
  * MDblock(MDp,X)
  * ** Update message digest buffer MDp->buffer using 16-word data block X.
  * ** Assumes all 16 words of X are full of data.
@@ -194,9 +163,7 @@ static void
 MDblock(MDptr MDp, const unsigned int *X)
 {
     register unsigned int tmp, A, B, C, D;      /* hpux sysv sun */
-#ifdef WORDS_BIGENDIAN
-    MDreverse(X);
-#endif
+
     A = MDp->buffer[0];
     B = MDp->buffer[1];
     C = MDp->buffer[2];
@@ -274,9 +241,6 @@ MDblock(MDptr MDp, const unsigned int *X
     MDp->buffer[1] += B;
     MDp->buffer[2] += C;
     MDp->buffer[3] += D;
-#ifdef WORDS_BIGENDIAN
-    MDreverse(X);
-#endif
 }
 
 /*
diff -urpN net-snmp-5.8/snmplib/memcheck.h net-snmp-5.9.1/snmplib/memcheck.h
--- net-snmp-5.8/snmplib/memcheck.h	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/snmplib/memcheck.h	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,11 @@
+#ifndef _MEMCHECK_H_
+#define _MEMCHECK_H_
+
+#ifdef HAVE_VALGRIND_MEMCHECK_H
+#include <valgrind/memcheck.h>
+#define MAKE_MEM_DEFINED(ptr, len) VALGRIND_MAKE_MEM_DEFINED(ptr, len)
+#else
+#define MAKE_MEM_DEFINED(ptr, len) do { } while (0)
+#endif
+
+#endif /* _MEMCHECK_H_ */
diff -urpN net-snmp-5.8/snmplib/mib.c net-snmp-5.9.1/snmplib/mib.c
--- net-snmp-5.8/snmplib/mib.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/mib.c	2021-05-26 05:19:35.000000000 +0700
@@ -66,6 +66,9 @@ SOFTWARE.
 # endif
 #endif
 
+#ifdef HAVE_INTTYPES_H
+#include <inttypes.h>
+#endif
 #if HAVE_NETINET_IN_H
 #include <netinet/in.h>
 #endif
@@ -94,9 +97,6 @@ SOFTWARE.
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
@@ -110,18 +110,18 @@ SOFTWARE.
 #include <net-snmp/library/int64.h>
 #include <net-snmp/library/snmp_client.h>
 
-netsnmp_feature_child_of(mib_api, libnetsnmp)
-netsnmp_feature_child_of(mib_strings_all, mib_api)
+netsnmp_feature_child_of(mib_api, libnetsnmp);
+netsnmp_feature_child_of(mib_strings_all, mib_api);
 
-netsnmp_feature_child_of(mib_snprint, mib_strings_all)
-netsnmp_feature_child_of(mib_snprint_description, mib_strings_all)
-netsnmp_feature_child_of(mib_snprint_variable, mib_strings_all)
-netsnmp_feature_child_of(mib_string_conversions, mib_strings_all)
-netsnmp_feature_child_of(print_mib, mib_strings_all)
-netsnmp_feature_child_of(snprint_objid, mib_strings_all)
-netsnmp_feature_child_of(snprint_value, mib_strings_all)
+netsnmp_feature_child_of(mib_snprint, mib_strings_all);
+netsnmp_feature_child_of(mib_snprint_description, mib_strings_all);
+netsnmp_feature_child_of(mib_snprint_variable, mib_strings_all);
+netsnmp_feature_child_of(mib_string_conversions, mib_strings_all);
+netsnmp_feature_child_of(print_mib, mib_strings_all);
+netsnmp_feature_child_of(snprint_objid, mib_strings_all);
+netsnmp_feature_child_of(snprint_value, mib_strings_all);
 
-netsnmp_feature_child_of(mib_to_asn_type, mib_api)
+netsnmp_feature_child_of(mib_to_asn_type, mib_api);
 
 /** @defgroup mib_utilities mib parsing and datatype manipulation routines.
  *  @ingroup library
@@ -1197,7 +1197,7 @@ sprint_realloc_timeticks(u_char ** buf,
 
     if (netsnmp_ds_get_boolean(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_NUMERIC_TIMETICKS)) {
         char            str[32];
-        sprintf(str, "%lu", *(u_long *) var->val.integer);
+        snprintf(str, sizeof(str), "%lu", *(u_long *) var->val.integer);
         if (!snmp_strcat
             (buf, buf_len, out_len, allow_realloc, (const u_char *) str)) {
             return 0;
@@ -1206,7 +1206,8 @@ sprint_realloc_timeticks(u_char ** buf,
     }
     if (!netsnmp_ds_get_boolean(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_QUICK_PRINT)) {
         char            str[32];
-        sprintf(str, "Timeticks: (%lu) ", *(u_long *) var->val.integer);
+        snprintf(str, sizeof(str), "Timeticks: (%lu) ",
+                 *(u_long *) var->val.integer);
         if (!snmp_strcat
             (buf, buf_len, out_len, allow_realloc, (const u_char *) str)) {
             return 0;
@@ -1387,7 +1388,7 @@ sprint_realloc_integer(u_char ** buf, si
             }
         } else {
             char            str[32];
-            sprintf(str, "%ld", *var->val.integer);
+            snprintf(str, sizeof(str), "%ld", *var->val.integer);
             if (!snmp_strcat
                 (buf, buf_len, out_len, allow_realloc,
                  (const u_char *) str)) {
@@ -1402,7 +1403,7 @@ sprint_realloc_integer(u_char ** buf, si
         }
     } else {
         char            str[32];
-        sprintf(str, "(%ld)", *var->val.integer);
+        snprintf(str, sizeof(str), "(%ld)", *var->val.integer);
         if (!snmp_strcat
             (buf, buf_len, out_len, allow_realloc,
              (const u_char *) enum_string)) {
@@ -1484,7 +1485,7 @@ sprint_realloc_uinteger(u_char ** buf, s
             }
         } else {
             char            str[32];
-            sprintf(str, "%lu", *var->val.integer);
+            snprintf(str, sizeof(str), "%lu", *var->val.integer);
             if (!snmp_strcat
                 (buf, buf_len, out_len, allow_realloc,
                  (const u_char *) str)) {
@@ -1499,7 +1500,7 @@ sprint_realloc_uinteger(u_char ** buf, s
         }
     } else {
         char            str[32];
-        sprintf(str, "(%lu)", *var->val.integer);
+        snprintf(str, sizeof(str), "(%lu)", *var->val.integer);
         if (!snmp_strcat
             (buf, buf_len, out_len, allow_realloc,
              (const u_char *) enum_string)) {
@@ -1908,7 +1909,7 @@ sprint_realloc_bitstring(u_char ** buf,
                         netsnmp_ds_get_boolean(NETSNMP_DS_LIBRARY_ID,
                                        NETSNMP_DS_LIB_PRINT_NUMERIC_ENUM)) {
                         char            str[32];
-                        sprintf(str, "%d ", (len * 8) + bit);
+                        snprintf(str, sizeof(str), "%d ", (len * 8) + bit);
                         if (!snmp_strcat
                             (buf, buf_len, out_len, allow_realloc,
                              (const u_char *) str)) {
@@ -1916,7 +1917,7 @@ sprint_realloc_bitstring(u_char ** buf,
                         }
                     } else {
                         char            str[32];
-                        sprintf(str, "(%d) ", (len * 8) + bit);
+                        snprintf(str, sizeof(str), "(%d) ", (len * 8) + bit);
                         if (!snmp_strcat
                             (buf, buf_len, out_len, allow_realloc,
                              (const u_char *) enum_string)) {
@@ -2222,15 +2223,17 @@ handle_mibs_conf(const char *token, char
 
     if (confmibs) {
         if ((*line == '+') || (*line == '-')) {
-            ctmp = (char *) malloc(strlen(confmibs) + strlen(line) + 2);
-            if (!ctmp) {
+            int res;
+
+            res = *line++ == '+' ?
+                /* Add specified dirs after existing ones */
+                asprintf(&ctmp, "%s%c%s", confmibs, ENV_SEPARATOR_CHAR, line) :
+                /* Add specified dirs before existing ones */
+                asprintf(&ctmp, "%s%c%s", line, ENV_SEPARATOR_CHAR, confmibs);
+            if (res < 0) {
                 DEBUGMSGTL(("read_config:initmib", "mibs conf malloc failed"));
                 return;
             }
-            if(*line++ == '+')
-                sprintf(ctmp, "%s%c%s", confmibs, ENV_SEPARATOR_CHAR, line);
-            else
-                sprintf(ctmp, "%s%c%s", line, ENV_SEPARATOR_CHAR, confmibdir);
         } else {
             ctmp = strdup(line);
             if (!ctmp) {
@@ -2488,7 +2491,7 @@ register_mib_handlers(void)
                                     "[mib-dirs|+mib-dirs|-mib-dirs]");
     register_prenetsnmp_mib_handler("snmp", "mibs",
                                     handle_mibs_conf, NULL,
-                                    "[mib-tokens|+mib-tokens]");
+                                    "[mib-tokens|+mib-tokens|-mib-tokens]");
     register_config_handler("snmp", "mibfile",
                             handle_mibfile_conf, NULL, "mibfile-to-read");
     /*
@@ -2717,7 +2720,6 @@ netsnmp_init_mib(void)
     env_var = strdup(netsnmp_get_mib_directory());
     if (!env_var)
         return;
-    netsnmp_mibindex_load();
 
     DEBUGMSGTL(("init_mib",
                 "Seen MIBDIRS: Looking in '%s' for mib dirs ...\n",
@@ -2737,7 +2739,7 @@ netsnmp_init_mib(void)
         else
             entry = strtok_r(env_var, ENV_SEPARATOR, &st);
         while (entry) {
-            add_mibfile(entry, NULL, NULL);
+            add_mibfile(entry, NULL);
             entry = strtok_r(NULL, ENV_SEPARATOR, &st);
         }
     }
@@ -2888,142 +2890,6 @@ init_mib(void)
 #endif
 
 
-/*
- * Handle MIB indexes centrally
- */
-static int _mibindex     = 0;   /* Last index in use */
-static int _mibindex_max = 0;   /* Size of index array */
-char     **_mibindexes   = NULL;
-
-int _mibindex_add( const char *dirname, int i );
-void
-netsnmp_mibindex_load( void )
-{
-    DIR *dir;
-    struct dirent *file;
-    FILE *fp;
-    char tmpbuf[ 300];
-    char tmpbuf2[300];
-    int  i;
-    char *cp;
-
-    /*
-     * Open the MIB index directory, or create it (empty)
-     */
-    snprintf( tmpbuf, sizeof(tmpbuf), "%s/mib_indexes",
-              get_persistent_directory());
-    tmpbuf[sizeof(tmpbuf)-1] = 0;
-    dir = opendir( tmpbuf );
-    if ( dir == NULL ) {
-        DEBUGMSGTL(("mibindex", "load: (new)\n"));
-        mkdirhier( tmpbuf, NETSNMP_AGENT_DIRECTORY_MODE, 0);
-        return;
-    }
-
-    /*
-     * Create a list of which directory each file refers to
-     */
-    while ((file = readdir( dir ))) {
-        if ( !isdigit((unsigned char)(file->d_name[0])))
-            continue;
-        i = atoi( file->d_name );
-
-        snprintf( tmpbuf, sizeof(tmpbuf), "%s/mib_indexes/%d",
-              get_persistent_directory(), i );
-        tmpbuf[sizeof(tmpbuf)-1] = 0;
-        fp = fopen( tmpbuf, "r" );
-        if (!fp)
-            continue;
-        cp = fgets( tmpbuf2, sizeof(tmpbuf2), fp );
-        fclose( fp );
-        if ( !cp ) {
-            DEBUGMSGTL(("mibindex", "Empty MIB index (%d)\n", i));
-            continue;
-        }
-        if ( strncmp( tmpbuf2, "DIR ", 4 ) != 0 ) {
-            DEBUGMSGTL(("mibindex", "Malformed MIB index (%d)\n", i));
-            continue;
-        }
-        tmpbuf2[strlen(tmpbuf2)-1] = 0;
-        DEBUGMSGTL(("mibindex", "load: (%d) %s\n", i, tmpbuf2));
-        (void)_mibindex_add( tmpbuf2+4, i );  /* Skip 'DIR ' */
-    }
-    closedir( dir );
-}
-
-char *
-netsnmp_mibindex_lookup( const char *dirname )
-{
-    int i;
-    static char tmpbuf[300];
-
-    for (i=0; i<_mibindex; i++) {
-        if ( _mibindexes[i] &&
-             strcmp( _mibindexes[i], dirname ) == 0) {
-             snprintf(tmpbuf, sizeof(tmpbuf), "%s/mib_indexes/%d",
-                      get_persistent_directory(), i);
-             tmpbuf[sizeof(tmpbuf)-1] = 0;
-             DEBUGMSGTL(("mibindex", "lookup: %s (%d) %s\n", dirname, i, tmpbuf ));
-             return tmpbuf;
-        }
-    }
-    DEBUGMSGTL(("mibindex", "lookup: (none)\n"));
-    return NULL;
-}
-
-int
-_mibindex_add( const char *dirname, int i )
-{
-    const int old_mibindex_max = _mibindex_max;
-
-    DEBUGMSGTL(("mibindex", "add: %s (%d)\n", dirname, i ));
-    if ( i == -1 )
-        i = _mibindex++;
-    if ( i >= _mibindex_max ) {
-        /*
-         * If the index array is full (or non-existent)
-         *   then expand (or create) it
-         */
-        _mibindex_max = i + 10;
-        _mibindexes = realloc(_mibindexes,
-                              _mibindex_max * sizeof(_mibindexes[0]));
-        netsnmp_assert(_mibindexes);
-        memset(_mibindexes + old_mibindex_max, 0,
-               (_mibindex_max - old_mibindex_max) * sizeof(_mibindexes[0]));
-    }
-
-    _mibindexes[ i ] = strdup( dirname );
-    if ( i >= _mibindex )
-        _mibindex = i+1;
-
-    DEBUGMSGTL(("mibindex", "add: %d/%d/%d\n", i, _mibindex, _mibindex_max ));
-    return i;
-}
-    
-FILE *
-netsnmp_mibindex_new( const char *dirname )
-{
-    FILE *fp;
-    char  tmpbuf[300];
-    char *cp;
-    int   i;
-
-    cp = netsnmp_mibindex_lookup( dirname );
-    if (!cp) {
-        i  = _mibindex_add( dirname, -1 );
-        snprintf( tmpbuf, sizeof(tmpbuf), "%s/mib_indexes/%d",
-                  get_persistent_directory(), i );
-        tmpbuf[sizeof(tmpbuf)-1] = 0;
-        cp = tmpbuf;
-    }
-    DEBUGMSGTL(("mibindex", "new: %s (%s)\n", dirname, cp ));
-    fp = fopen( cp, "w" );
-    if (fp)
-        fprintf( fp, "DIR %s\n", dirname );
-    return fp;
-}
-
-
 /**
  * Unloads all mibs.
  */
@@ -3038,15 +2904,6 @@ shutdown_mib(void)
     }
     tree_head = NULL;
     Mib = NULL;
-    if (_mibindexes) {
-        int i;
-        for (i = 0; i < _mibindex; ++i)
-            SNMP_FREE(_mibindexes[i]);
-        free(_mibindexes);
-        _mibindex = 0;
-        _mibindex_max = 0;
-        _mibindexes = NULL;
-    }
     if (Prefix != NULL && Prefix != &Standard_Prefix[0])
         SNMP_FREE(Prefix);
     if (Prefix)
@@ -3865,9 +3722,21 @@ build_oid_segment(netsnmp_variable_list
 }
 
 
+/**
+ * Concatenate a prefix and the OIDs of a variable list.
+ *
+ * @param[out]    in         Output buffer.
+ * @param[in]     in_len     Maximum number of OID components that fit in @in.
+ * @param[out]    out_len    Number of OID components of the result.
+ * @param[in]     prefix     OID to be copied to the start of the output buffer.
+ * @param[in]     prefix_len Number of OID components to copy from @prefix.
+ * @param[in/out] indexes    Variable list for which var->name should be set
+ *                           for each variable var in the list and whose OIDs
+ *                           should be appended to @in.
+ */
 int
 build_oid_noalloc(oid * in, size_t in_len, size_t * out_len,
-                  oid * prefix, size_t prefix_len,
+                  const oid * prefix, size_t prefix_len,
                   netsnmp_variable_list * indexes)
 {
     netsnmp_variable_list *var;
@@ -3914,7 +3783,7 @@ build_oid(oid ** out, size_t * out_len,
      *
      * then see if it fits in existing buffer, or realloc buffer.
      */
-    if (build_oid_noalloc(tmpout, sizeof(tmpout), out_len,
+    if (build_oid_noalloc(tmpout, sizeof(tmpout) / sizeof(tmpout[0]), out_len,
                           prefix, prefix_len, indexes) != SNMPERR_SUCCESS)
         return SNMPERR_GENERR;
 
@@ -4158,7 +4027,7 @@ dump_realloc_oid_to_inetaddress(const in
         return 1;
 
     for (i = 0; i < objidlen; i++)
-        if (objid[i] < 0 || objid[i] > 255)
+        if (objid[i] > 255)
             return 2;
 
     p = intbuf;
@@ -5078,7 +4947,7 @@ print_tree_node(u_char ** buf, size_t *
         }
 #if NETSNMP_ENABLE_TESTING_CODE
         if (!cp && (tp->ranges || tp->enums)) { /* ranges without type ? */
-            sprintf(str, "?0 with %s %s ?",
+            snprintf(str, sizeof(str), "?0 with %s %s ?",
                     tp->ranges ? "Range" : "", tp->enums ? "Enum" : "");
             cp = str;
         }
@@ -5098,21 +4967,23 @@ print_tree_node(u_char ** buf, size_t *
                 case TYPE_INTEGER:
                 case TYPE_INTEGER32:
                     if (rp->low == rp->high)
-                        sprintf(str, "%s%d", (first ? "" : " | "), rp->low );
+                        snprintf(str, sizeof(str), "%s%d", first ? "" : " | ",
+                                 rp->low );
                     else
-                        sprintf(str, "%s%d..%d", (first ? "" : " | "),
-                                rp->low, rp->high);
+                        snprintf(str, sizeof(str), "%s%d..%d",
+                                 first ? "" : " | ", rp->low, rp->high);
                     break;
                 case TYPE_UNSIGNED32:
                 case TYPE_OCTETSTR:
                 case TYPE_GAUGE:
                 case TYPE_UINTEGER:
                     if (rp->low == rp->high)
-                        sprintf(str, "%s%u", (first ? "" : " | "),
+                        snprintf(str, sizeof(str), "%s%u", first ? "" : " | ",
                                 (unsigned)rp->low );
                     else
-                        sprintf(str, "%s%u..%u", (first ? "" : " | "),
-                                (unsigned)rp->low, (unsigned)rp->high);
+                        snprintf(str, sizeof(str), "%s%u..%u",
+                                 first ? "" : " | ", (unsigned)rp->low,
+                                 (unsigned)rp->high);
                     break;
                 default:
                     /* No other range types allowed */
@@ -5194,7 +5065,7 @@ print_tree_node(u_char ** buf, size_t *
             cp = NULL;
             break;
         default:
-            sprintf(str, "access_%d", tp->access);
+            snprintf(str, sizeof(str), "access_%d", tp->access);
             cp = str;
         }
         if (cp)
@@ -5223,12 +5094,13 @@ print_tree_node(u_char ** buf, size_t *
             cp = NULL;
             break;
         default:
-            sprintf(str, "status_%d", tp->status);
+            snprintf(str, sizeof(str), "status_%d", tp->status);
             cp = str;
         }
 #if NETSNMP_ENABLE_TESTING_CODE
         if (!cp && (tp->indexes)) {     /* index without status ? */
-            sprintf(str, "?0 with %s ?", tp->indexes ? "Index" : "");
+            snprintf(str, sizeof(str), "?0 with %s ?",
+                     tp->indexes ? "Index" : "");
             cp = str;
         }
 #endif                          /* NETSNMP_ENABLE_TESTING_CODE */
@@ -6221,8 +6093,7 @@ snmp_parse_oid(const char *argv, oid * r
 #ifndef NETSNMP_DISABLE_MIB_LOADING
     size_t          savlen = *rootlen;
 #endif /* NETSNMP_DISABLE_MIB_LOADING */
-    static size_t   tmpbuf_len = 0;
-    static char    *tmpbuf = NULL;
+    char           *tmpbuf = NULL;
     const char     *suffix, *prefix;
 
     suffix = netsnmp_ds_get_string(NETSNMP_DS_LIBRARY_ID,
@@ -6234,53 +6105,48 @@ snmp_parse_oid(const char *argv, oid * r
             suffix = "";
         if (!prefix)
             prefix = "";
-        if ((strlen(suffix) + strlen(prefix) + strlen(argv) + 2) > tmpbuf_len) {
-            tmpbuf_len = strlen(suffix) + strlen(argv) + strlen(prefix) + 2;
-            tmpbuf = malloc(tmpbuf_len);
-        }
-        snprintf(tmpbuf, tmpbuf_len, "%s%s%s%s", prefix, argv,
-                 ((suffix[0] == '.' || suffix[0] == '\0') ? "" : "."),
-                 suffix);
+        if (asprintf(&tmpbuf, "%s%s%s%s", prefix, argv,
+                     suffix[0] == '.' || suffix[0] == '\0' ? "" : ".",
+                     suffix) < 0) {
+            DEBUGMSGTL(("snmp_parse_oid", "Out of memory\n"));
+            return NULL;
+        }
         argv = tmpbuf;
         DEBUGMSGTL(("snmp_parse_oid","Parsing: %s\n",argv));
     }
 
 #ifndef NETSNMP_DISABLE_MIB_LOADING
-    if (netsnmp_ds_get_boolean(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_RANDOM_ACCESS)
+    if (netsnmp_ds_get_boolean(NETSNMP_DS_LIBRARY_ID,
+                               NETSNMP_DS_LIB_RANDOM_ACCESS)
         || strchr(argv, ':')) {
-        if (get_node(argv, root, rootlen)) {
-            free(tmpbuf);
-            return root;
-        }
-    } else if (netsnmp_ds_get_boolean(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_REGEX_ACCESS)) {
+        if (get_node(argv, root, rootlen))
+            goto out;
+    } else if (netsnmp_ds_get_boolean(NETSNMP_DS_LIBRARY_ID,
+                                      NETSNMP_DS_LIB_REGEX_ACCESS)) {
 	clear_tree_flags(tree_head);
-        if (get_wild_node(argv, root, rootlen)) {
-            free(tmpbuf);
-            return root;
-        }
+        if (get_wild_node(argv, root, rootlen))
+            goto out;
     } else {
 #endif /* NETSNMP_DISABLE_MIB_LOADING */
-        if (read_objid(argv, root, rootlen)) {
-            free(tmpbuf);
-            return root;
-        }
+        if (read_objid(argv, root, rootlen))
+            goto out;
 #ifndef NETSNMP_DISABLE_MIB_LOADING
         *rootlen = savlen;
-        if (get_node(argv, root, rootlen)) {
-            free(tmpbuf);
-            return root;
-        }
+        if (get_node(argv, root, rootlen))
+            goto out;
         *rootlen = savlen;
         DEBUGMSGTL(("parse_oid", "wildly parsing\n"));
 	clear_tree_flags(tree_head);
-        if (get_wild_node(argv, root, rootlen)) {
-            free(tmpbuf);
-            return root;
-        }
+        if (get_wild_node(argv, root, rootlen))
+            goto out;
     }
 #endif /* NETSNMP_DISABLE_MIB_LOADING */
+
+    root = NULL;
+
+out:
     free(tmpbuf);
-    return NULL;
+    return root;
 }
 
 #ifndef NETSNMP_DISABLE_MIB_LOADING
diff -urpN net-snmp-5.8/snmplib/oid_stash.c net-snmp-5.9.1/snmplib/oid_stash.c
--- net-snmp-5.8/snmplib/oid_stash.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/oid_stash.c	2021-05-26 05:19:35.000000000 +0700
@@ -8,9 +8,9 @@
 #include <net-snmp/net-snmp-features.h>
 #include <net-snmp/net-snmp-includes.h>
 
-netsnmp_feature_child_of(oid_stash_all, libnetsnmp)
-netsnmp_feature_child_of(oid_stash, oid_stash_all)
-netsnmp_feature_child_of(oid_stash_no_free, oid_stash_all)
+netsnmp_feature_child_of(oid_stash_all, libnetsnmp);
+netsnmp_feature_child_of(oid_stash, oid_stash_all);
+netsnmp_feature_child_of(oid_stash_no_free, oid_stash_all);
 
 #ifndef NETSNMP_FEATURE_REMOVE_OID_STASH
 
@@ -75,7 +75,7 @@ netsnmp_oid_stash_create_node(void)
     return netsnmp_oid_stash_create_sized_node(OID_STASH_CHILDREN_SIZE);
 }
 
-netsnmp_feature_child_of(oid_stash_add_data, oid_stash_all)
+netsnmp_feature_child_of(oid_stash_add_data, oid_stash_all);
 #ifndef NETSNMP_FEATURE_REMOVE_OID_STASH_ADD_DATA
 /** adds data to the stash at a given oid.
 
@@ -197,7 +197,7 @@ netsnmp_oid_stash_get_node(netsnmp_oid_s
  * @param lookup the oid to look up a node for.
  * @param lookup_len the length of the lookup oid
  */
-netsnmp_feature_child_of(oid_stash_iterate, oid_stash_all)
+netsnmp_feature_child_of(oid_stash_iterate, oid_stash_all);
 #ifndef NETSNMP_FEATURE_REMOVE_OID_STASH_ITERATE
 netsnmp_oid_stash_node *
 netsnmp_oid_stash_getnext_node(netsnmp_oid_stash_node *root,
@@ -282,7 +282,7 @@ netsnmp_oid_stash_getnext_node(netsnmp_o
 }
 #endif /* NETSNMP_FEATURE_REMOVE_OID_STASH_ITERATE */
 
-netsnmp_feature_child_of(oid_stash_get_data, oid_stash_all)
+netsnmp_feature_child_of(oid_stash_get_data, oid_stash_all);
 #ifndef NETSNMP_FEATURE_REMOVE_OID_STASH_GET_DATA
 /** returns a data pointer associated with a given OID.
 
@@ -305,7 +305,7 @@ netsnmp_oid_stash_get_data(netsnmp_oid_s
 }
 #endif /* NETSNMP_FEATURE_REMOVE_OID_STASH_GET_DATA */
 
-netsnmp_feature_child_of(oid_stash_store_all, oid_stash_all)
+netsnmp_feature_child_of(oid_stash_store_all, oid_stash_all);
 #ifndef NETSNMP_FEATURE_REMOVE_OID_STASH_STORE_ALL
 /** a wrapper around netsnmp_oid_stash_store for use with a snmp_alarm.
  * when calling snmp_alarm, you can list this as a callback.  The
diff -urpN net-snmp-5.8/snmplib/opendir.c net-snmp-5.9.1/snmplib/opendir.c
--- net-snmp-5.8/snmplib/opendir.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/opendir.c	2021-05-26 05:19:35.000000000 +0700
@@ -8,6 +8,7 @@
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/types.h>
 #include <net-snmp/library/system.h>
+#include <stdlib.h>
 #ifdef HAVE_SYS_STAT_H
 #include <sys/stat.h>
 #endif
diff -urpN net-snmp-5.8/snmplib/parse.c net-snmp-5.9.1/snmplib/parse.c
--- net-snmp-5.8/snmplib/parse.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/parse.c	2021-05-26 05:19:35.000000000 +0700
@@ -93,9 +93,6 @@ SOFTWARE.
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 
 #include <errno.h>
 
@@ -109,8 +106,8 @@ SOFTWARE.
 #include <net-snmp/library/snmp_api.h>
 #include <net-snmp/library/tools.h>
 
-netsnmp_feature_child_of(find_module, mib_api)
-netsnmp_feature_child_of(get_tc_description, mib_api)
+netsnmp_feature_child_of(find_module, mib_api);
+netsnmp_feature_child_of(get_tc_description, mib_api);
 
 /*
  * A linked list of nodes.
@@ -150,7 +147,7 @@ struct subid_s {
     char           *label;
 };
 
-#define MAXTC   16384
+#define TC_INCR 100
 struct tc {                     /* textual conventions */
     int             type;
     int             modid;
@@ -159,7 +156,8 @@ struct tc {                     /* textu
     struct enum_list *enums;
     struct range_list *ranges;
     char           *description;
-} tclist[MAXTC];
+} *tclist;
+int tc_alloc;
 
 int             mibLine = 0;
 const char     *File = "(none)";
@@ -607,8 +605,6 @@ static int     read_module_replacements(
 static int     read_import_replacements(const char *,
                                          struct module_import *);
 
-static void     new_module(const char *, const char *);
-
 static struct node *merge_parse_objectid(struct node *, FILE *, char *);
 static struct index_list *getIndexes(FILE * fp, struct index_list **);
 static struct varbind_list *getVarbinds(FILE * fp, struct varbind_list **);
@@ -749,7 +745,8 @@ netsnmp_init_mib_internals(void)
 
     memset(nbuckets, 0, sizeof(nbuckets));
     memset(tbuckets, 0, sizeof(tbuckets));
-    memset(tclist, 0, MAXTC * sizeof(struct tc));
+    tc_alloc = TC_INCR;
+    tclist = calloc(tc_alloc, sizeof(struct tc));
     build_translation_table();
     init_tree_roots();          /* Set up initial roots */
     /*
@@ -783,7 +780,7 @@ init_node_hash(struct node *nodes)
 
 static int      erroneousMibs = 0;
 
-netsnmp_feature_child_of(parse_get_error_count, netsnmp_unused)
+netsnmp_feature_child_of(parse_get_error_count, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_PARSE_GET_ERROR_COUNT
 int
 get_mib_parse_error_count(void)
@@ -2134,7 +2131,7 @@ get_tc_index(const char *descriptor, int
         }
 
 
-    for (i = 0, tcp = tclist; i < MAXTC; i++, tcp++) {
+    for (i = 0, tcp = tclist; i < tc_alloc; i++, tcp++) {
         if (tcp->type == 0)
             break;
         if (!label_compare(descriptor, tcp->descriptor) &&
@@ -2153,9 +2150,9 @@ get_tc_index(const char *descriptor, int
 const char     *
 get_tc_descriptor(int tc_index)
 {
-    if (tc_index < 0 || tc_index >= MAXTC)
+    if (tc_index < 0 || tc_index >= tc_alloc)
         return NULL;
-    return (tclist[tc_index].descriptor);
+    return tclist[tc_index].descriptor;
 }
 
 #ifndef NETSNMP_FEATURE_REMOVE_GET_TC_DESCRIPTION
@@ -2163,9 +2160,9 @@ get_tc_descriptor(int tc_index)
 const char     *
 get_tc_description(int tc_index)
 {
-    if (tc_index < 0 || tc_index >= MAXTC)
+    if (tc_index < 0 || tc_index >= tc_alloc)
         return NULL;
-    return (tclist[tc_index].description);
+    return tclist[tc_index].description;
 }
 #endif /* NETSNMP_FEATURE_REMOVE_GET_TC_DESCRIPTION */
 
@@ -2438,14 +2435,15 @@ parse_asntype(FILE * fp, char *name, int
         /*
          * textual convention 
          */
-        for (i = 0; i < MAXTC; i++) {
+        for (i = 0; i < tc_alloc; i++) {
             if (tclist[i].type == 0)
                 break;
         }
 
-        if (i == MAXTC) {
-            print_error("Too many textual conventions", token, type);
-            goto err;
+        if (i == tc_alloc) {
+            tclist = realloc(tclist, (tc_alloc + TC_INCR)*sizeof(struct tc));
+            memset(tclist+tc_alloc, 0, TC_INCR*sizeof(struct tc));
+            tc_alloc += TC_INCR;
         }
         if (!(type & SYNTAX_MASK)) {
             print_error("Textual convention doesn't map to real type",
@@ -3638,14 +3636,16 @@ parse_imports(FILE * fp)
     register int    type;
     char            token[MAXTOKEN];
     char            modbuf[256];
-#define MAX_IMPORTS	256
-    struct module_import import_list[MAX_IMPORTS];
+#define MAX_IMPORTS	512
+    struct module_import *import_list;
     int             this_module;
     struct module  *mp;
 
     int             import_count = 0;   /* Total number of imported descriptors */
     int             i = 0, old_i;       /* index of first import from each module */
 
+    import_list = malloc(MAX_IMPORTS * sizeof(*import_list));
+
     type = get_token(fp, token, MAXTOKEN);
 
     /*
@@ -3658,7 +3658,7 @@ parse_imports(FILE * fp)
                 do {
                     type = get_token(fp, token, MAXTOKEN);
                 } while (type != SEMI && type != ENDOFFILE);
-                return;
+                goto out;
             }
             import_list[import_count++].label = strdup(token);
         } else if (type == FROM) {
@@ -3695,10 +3695,10 @@ parse_imports(FILE * fp)
      * Save the import information
      *   in the global module table
      */
-    for (mp = module_head; mp; mp = mp->next)
+    for (mp = module_head; mp; mp = mp->next) {
         if (mp->modid == current_module) {
             if (import_count == 0)
-                return;
+                goto out;
             if (mp->imports && (mp->imports != root_imports)) {
                 /*
                  * this can happen if all modules are in one source file. 
@@ -3708,14 +3708,14 @@ parse_imports(FILE * fp)
                                 "#### freeing Module %d '%s' %d\n",
                                 mp->modid, mp->imports[i].label,
                                 mp->imports[i].modid));
-                    free((char *) mp->imports[i].label);
+                    free(mp->imports[i].label);
                 }
-                free((char *) mp->imports);
+                free(mp->imports);
             }
             mp->imports = (struct module_import *)
                 calloc(import_count, sizeof(struct module_import));
             if (mp->imports == NULL)
-                return;
+                goto out;
             for (i = 0; i < import_count; ++i) {
                 mp->imports[i].label = import_list[i].label;
                 mp->imports[i].modid = import_list[i].modid;
@@ -3724,13 +3724,17 @@ parse_imports(FILE * fp)
                             mp->imports[i].label, mp->imports[i].modid));
             }
             mp->no_imports = import_count;
-            return;
+            goto out;
         }
+    }
 
     /*
      * Shouldn't get this far
      */
     print_module_not_found(module_name(current_module, modbuf));
+
+out:
+    free(import_list);
     return;
 }
 
@@ -3792,7 +3796,7 @@ module_name(int modid, char *cp)
  *      or those relating to a specified identifier (read_import_replacements)
  *      plus an interface to add new replacement requirements
  */
-netsnmp_feature_child_of(parse_add_module_replacement, netsnmp_unused)
+netsnmp_feature_child_of(parse_add_module_replacement, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_PARSE_ADD_MODULE_REPLACEMENT
 void
 add_module_replacement(const char *old_module,
@@ -4200,7 +4204,7 @@ unload_all_mibs(void)
      * tree nodes are cleared 
      */
 
-    for (i = 0, ptc = tclist; i < MAXTC; i++, ptc++) {
+    for (i = 0, ptc = tclist; i < tc_alloc; i++, ptc++) {
         if (ptc->type == 0)
             continue;
         free_enums(&ptc->enums);
@@ -4211,7 +4215,7 @@ unload_all_mibs(void)
         if (ptc->description)
             free(ptc->description);
     }
-    memset(tclist, 0, MAXTC * sizeof(struct tc));
+    memset(tclist, 0, tc_alloc * sizeof(struct tc));
 
     memset(buckets, 0, sizeof(buckets));
     memset(nbuckets, 0, sizeof(nbuckets));
@@ -4612,6 +4616,7 @@ parse(FILE * fp, struct node *root)
 static int
 is_labelchar(int ich)
 {
+    netsnmp_assert(ich == EOF || (0 <= ich && ich < 256));
     if ((isalnum(ich)) || (ich == '-'))
         return 1;
     if (ich == '_' && netsnmp_ds_get_boolean(NETSNMP_DS_LIBRARY_ID, 
@@ -4849,7 +4854,7 @@ get_token(FILE * fp, char *token, int ma
     }
 }
 
-netsnmp_feature_child_of(parse_get_token, netsnmp_unused)
+netsnmp_feature_child_of(parse_get_token, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_PARSE_GET_TOKEN
 int
 snmp_get_token(FILE * fp, char *token, int maxtlen)
@@ -4859,7 +4864,7 @@ snmp_get_token(FILE * fp, char *token, i
 #endif /* NETSNMP_FEATURE_REMOVE_PARSE_GET_TOKEN */
 
 int
-add_mibfile(const char* tmpstr, const char* d_name, FILE *ip )
+add_mibfile(const char* tmpstr, const char* d_name)
 {
     FILE           *fp;
     char            token[MAXTOKEN], token2[MAXTOKEN];
@@ -4884,8 +4889,6 @@ add_mibfile(const char* tmpstr, const ch
      */
     if (get_token(fp, token2, MAXTOKEN) == DEFINITIONS) {
         new_module(token, tmpstr);
-        if (ip)
-            fprintf(ip, "%s %s\n", token, d_name);
         fclose(fp);
         return 0;
     } else {
@@ -4894,6 +4897,80 @@ add_mibfile(const char* tmpstr, const ch
     }
 }
 
+static int elemcmp(const void *a, const void *b)
+{
+    const char *const *s1 = a, *const *s2 = b;
+
+    return strcmp(*s1, *s2);
+}
+
+/*
+ * Scan a directory and return all filenames found as an array of pointers to
+ * directory entries (@result).
+ */
+static int scan_directory(char ***result, const char *dirname)
+{
+    DIR            *dir, *dir2;
+    struct dirent  *file;
+    char          **filenames = NULL;
+    int             fname_len, i, filename_count = 0, array_size = 0;
+    char           *tmpstr;
+
+    *result = NULL;
+
+    dir = opendir(dirname);
+    if (!dir)
+        return -1;
+
+    while ((file = readdir(dir))) {
+        /*
+         * Only parse file names that don't begin with a '.'
+         * Also skip files ending in '~', or starting/ending
+         * with '#' which are typically editor backup files.
+         */
+        fname_len = strlen(file->d_name);
+        if (fname_len > 0 && file->d_name[0] != '.'
+            && file->d_name[0] != '#'
+            && file->d_name[fname_len-1] != '#'
+            && file->d_name[fname_len-1] != '~') {
+            if (asprintf(&tmpstr, "%s/%s", dirname, file->d_name) < 0)
+                continue;
+            dir2 = opendir(tmpstr);
+            if (dir2) {
+                /* file is a directory, don't read it */
+                closedir(dir2);
+            } else {
+                if (filename_count >= array_size) {
+                    char **new_filenames;
+
+                    array_size = (array_size + 16) * 2;
+                    new_filenames = realloc(filenames,
+                                        array_size * sizeof(filenames[0]));
+                    if (!new_filenames) {
+                        free(tmpstr);
+                        for (i = 0; i < filename_count; i++)
+                            free(filenames[i]);
+                        free(filenames);
+                        closedir(dir);
+                        return -1;
+                    }
+                    filenames = new_filenames;
+                }
+                filenames[filename_count++] = tmpstr;
+                tmpstr = NULL;
+            }
+            free(tmpstr);
+        }
+    }
+    closedir(dir);
+
+    if (filenames)
+        qsort(filenames, filename_count, sizeof(filenames[0]), elemcmp);
+    *result = filenames;
+
+    return filename_count;
+}
+
 /* For Win32 platforms, the directory does not maintain a last modification
  * date that we can compare with the modification date of the .index file.
  * Therefore there is no way to know whether any .index file is valid.
@@ -4903,92 +4980,23 @@ add_mibfile(const char* tmpstr, const ch
 int
 add_mibdir(const char *dirname)
 {
-    FILE           *ip;
-    DIR            *dir, *dir2;
     const char     *oldFile = File;
-    struct dirent  *file;
-    char            tmpstr[300];
+    char          **filenames;
     int             count = 0;
-    int             fname_len = 0;
-#if !(defined(WIN32) || defined(cygwin))
-    char           *token;
-    char space;
-    char newline;
-    struct stat     dir_stat, idx_stat;
-    char            tmpstr1[300];
-#endif
+    int             filename_count, i;
 
     DEBUGMSGTL(("parse-mibs", "Scanning directory %s\n", dirname));
-#if !(defined(WIN32) || defined(cygwin))
-    token = netsnmp_mibindex_lookup( dirname );
-    if (token && stat(token, &idx_stat) == 0 && stat(dirname, &dir_stat) == 0) {
-        if (dir_stat.st_mtime < idx_stat.st_mtime) {
-            DEBUGMSGTL(("parse-mibs", "The index is good\n"));
-            if ((ip = fopen(token, "r")) != NULL) {
-                fgets(tmpstr, sizeof(tmpstr), ip); /* Skip dir line */
-                while (fscanf(ip, "%127s%c%299[^\n]%c", token, &space, tmpstr,
-		    &newline) == 4) {
-
-		    /*
-		     * If an overflow of the token or tmpstr buffers has been
-		     * found log a message and break out of the while loop,
-		     * thus the rest of the file tokens will be ignored.
-		     */
-		    if (space != ' ' || newline != '\n') {
-			snmp_log(LOG_ERR,
-			    "add_mibdir: strings scanned in from %s/%s " \
-			    "are too large.  count = %d\n ", dirname,
-			    ".index", count);
-			    break;
-		    }
-		   
-		    snprintf(tmpstr1, sizeof(tmpstr1), "%s/%s", dirname, tmpstr);
-                    tmpstr1[ sizeof(tmpstr1)-1 ] = 0;
-                    new_module(token, tmpstr1);
-                    count++;
-                }
-                fclose(ip);
-                return count;
-            } else
-                DEBUGMSGTL(("parse-mibs", "Can't read index\n"));
-        } else
-            DEBUGMSGTL(("parse-mibs", "Index outdated\n"));
-    } else
-        DEBUGMSGTL(("parse-mibs", "No index\n"));
-#endif
 
-    if ((dir = opendir(dirname))) {
-        ip = netsnmp_mibindex_new( dirname );
-        while ((file = readdir(dir))) {
-            /*
-             * Only parse file names that don't begin with a '.' 
-             * Also skip files ending in '~', or starting/ending
-             * with '#' which are typically editor backup files.
-             */
-            if (file->d_name != NULL) {
-              fname_len = strlen( file->d_name );
-              if (fname_len > 0 && file->d_name[0] != '.' 
-                                && file->d_name[0] != '#'
-                                && file->d_name[fname_len-1] != '#'
-                                && file->d_name[fname_len-1] != '~') {
-                snprintf(tmpstr, sizeof(tmpstr), "%s/%s", dirname, file->d_name);
-                tmpstr[ sizeof(tmpstr)-1 ] = 0;
-                if ((dir2 = opendir(tmpstr))) {
-                    /*
-                     * file is a directory, don't read it 
-                     */
-                    closedir(dir2);
-                } else {
-                    if ( !add_mibfile( tmpstr, file->d_name, ip ))
-                        count++;
-                }
-              }
-            }
+    filename_count = scan_directory(&filenames, dirname);
+
+    if (filename_count >= 0) {
+        for (i = 0; i < filename_count; i++) {
+            if (add_mibfile(filenames[i], strrchr(filenames[i], '/')) == 0)
+                count++;
+	    free(filenames[i]);
         }
         File = oldFile;
-        closedir(dir);
-        if (ip)
-            fclose(ip);
+        free(filenames);
         return (count);
     }
     else
@@ -5349,7 +5357,7 @@ find_node(const char *name, struct tree
     return (find_tree_node(name, -1));
 }
 
-netsnmp_feature_child_of(parse_find_node2, netsnmp_unused)
+netsnmp_feature_child_of(parse_find_node2, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_PARSE_FIND_NODE2
 struct tree    *
 find_node2(const char *name, const char *module)
diff -urpN net-snmp-5.8/snmplib/read_config.c net-snmp-5.9.1/snmplib/read_config.c
--- net-snmp-5.8/snmplib/read_config.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/read_config.c	2021-05-26 05:19:35.000000000 +0700
@@ -134,10 +134,6 @@
 # endif
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 #include <net-snmp/config_api.h>
@@ -149,10 +145,10 @@
 #include <net-snmp/library/snmp_api.h>
 #include <net-snmp/library/callback.h>
 
-netsnmp_feature_child_of(read_config_all, libnetsnmp)
+netsnmp_feature_child_of(read_config_all, libnetsnmp);
 
-netsnmp_feature_child_of(unregister_app_config_handler, read_config_all)
-netsnmp_feature_child_of(read_config_register_app_prenetsnmp_mib_handler, netsnmp_unused)
+netsnmp_feature_child_of(unregister_app_config_handler, read_config_all);
+netsnmp_feature_child_of(read_config_register_app_prenetsnmp_mib_handler, netsnmp_unused);
 
 static int      config_errors;
 
@@ -1543,14 +1539,18 @@ read_config_store(const char *type, cons
         fflush(fout);
 #if defined(HAVE_FSYNC)
         fsync(fileno(fout));
-#elif defined(WIN32) && !defined(cygwin)
+#elif defined(HAVE__GET_OSFHANDLE)
         {
             int fd;
-            void *h;
+            HANDLE h;
 
-            fd = _fileno(fout);
+            fd = fileno(fout);
             netsnmp_assert(fd != -1);
-            h = _get_osfhandle(fd);
+            /*
+             * Use size_t instead of uintptr_t because not all supported
+             * Windows compilers support uintptr_t.
+             */
+            h = (HANDLE)(size_t)_get_osfhandle(fd);
             netsnmp_assert(h != INVALID_HANDLE_VALUE);
             FlushFileBuffers(h);
         }
diff -urpN net-snmp-5.8/snmplib/scapi.c net-snmp-5.9.1/snmplib/scapi.c
--- net-snmp-5.8/snmplib/scapi.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/scapi.c	2021-05-26 05:19:35.000000000 +0700
@@ -22,6 +22,9 @@
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-features.h>
 
+#ifdef HAVE_INTTYPES_H
+#include <inttypes.h>
+#endif
 #include <sys/types.h>
 #ifdef HAVE_STDLIB_H
 #include <stdlib.h>
@@ -48,16 +51,14 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
+#include "memcheck.h"
 
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 #include <net-snmp/utilities.h>
 
-netsnmp_feature_child_of(usm_support, libnetsnmp)
-netsnmp_feature_child_of(usm_scapi, usm_support)
+netsnmp_feature_child_of(usm_support, libnetsnmp);
+netsnmp_feature_child_of(usm_scapi, usm_support);
 
 #ifndef NETSNMP_FEATURE_REMOVE_USM_SCAPI
 
@@ -112,11 +113,12 @@ netsnmp_feature_child_of(usm_scapi, usm_
 
 #ifdef QUITFUN
 #undef QUITFUN
-#define QUITFUN(e, l)					\
+#define QUITFUN(e, l) do {                              \
 	if (e != SNMPERR_SUCCESS) {			\
 		rval = SNMPERR_SC_GENERAL_FAILURE;	\
 		goto l ;				\
-	}
+        }                                               \
+    } while (0)
 #endif
 
 #ifdef NETSNMP_USE_INTERNAL_CRYPTO
@@ -129,7 +131,7 @@ int MD5_hmac(const u_char * data, size_t
              const u_char * secret, size_t secretlen);
 #endif
 
-static netsnmp_auth_alg_info _auth_alg_info[] = {
+static const netsnmp_auth_alg_info _auth_alg_info[] = {
     { NETSNMP_USMAUTH_NOAUTH, "usmNoAuthProtocol", usmNoAuthProtocol,
       OID_LENGTH(usmNoAuthProtocol), 0, 0 },
     { NETSNMP_USMAUTH_HMACSHA1, "usmHMACSHA1AuthProtocol",
@@ -159,7 +161,7 @@ static netsnmp_auth_alg_info _auth_alg_i
     { -1, "unknown", NULL, 0, 0, 0 }
 };
 
-static netsnmp_priv_alg_info _priv_alg_info[] = {
+static const netsnmp_priv_alg_info _priv_alg_info[] = {
     { USM_CREATE_USER_PRIV_NONE, "usmNoPrivProtocol",
       usmNoPrivProtocol, OID_LENGTH(usmNoPrivProtocol), 0, 0, 0 },
 #ifndef NETSNMP_DISABLE_DES
@@ -207,7 +209,7 @@ static netsnmp_priv_alg_info _priv_alg_i
  *
  * returns a pointer to a netsnmp_priv_alg_info struct
  */
-netsnmp_priv_alg_info *
+const netsnmp_priv_alg_info *
 sc_get_priv_alg_byoid(const oid *privoid, u_int len)
 {
     int i = 0;
@@ -237,7 +239,7 @@ sc_get_priv_alg_byoid(const oid *privoid
  *
  * returns a pointer to a netsnmp_priv_alg_info struct
  */
-netsnmp_priv_alg_info *
+const netsnmp_priv_alg_info *
 sc_get_priv_alg_bytype(u_int type)
 {
     int i = 0;
@@ -258,7 +260,7 @@ sc_get_priv_alg_bytype(u_int type)
  *
  * returns a pointer to a netsnmp_auth_alg_info struct
  */
-netsnmp_auth_alg_info *
+const netsnmp_auth_alg_info *
 sc_find_auth_alg_byoid(const oid *authoid, u_int len)
 {
     int i = 0;
@@ -288,7 +290,7 @@ sc_find_auth_alg_byoid(const oid *authoi
  *
  * returns a pointer to a netsnmp_auth_alg_info struct
  */
-netsnmp_auth_alg_info *
+const netsnmp_auth_alg_info *
 sc_get_auth_alg_byindex(u_int index)
 {
     DEBUGTRACE;
@@ -305,7 +307,7 @@ sc_get_auth_alg_byindex(u_int index)
  *
  * returns a pointer to a netsnmp_auth_alg_info struct
  */
-netsnmp_auth_alg_info *
+const netsnmp_auth_alg_info *
 sc_find_auth_alg_bytype(u_int type)
 {
     int i = 0;
@@ -333,7 +335,7 @@ sc_find_auth_alg_bytype(u_int type)
 int
 sc_get_authtype(const oid * hashtype, u_int hashtype_len)
 {
-    netsnmp_auth_alg_info *aai;
+    const netsnmp_auth_alg_info *aai;
 
     DEBUGTRACE;
 
@@ -347,7 +349,7 @@ sc_get_authtype(const oid * hashtype, u_
 int
 sc_get_privtype(const oid * privtype, u_int privtype_len)
 {
-    netsnmp_priv_alg_info *pai;
+    const netsnmp_priv_alg_info *pai;
 
     DEBUGTRACE;
 
@@ -369,7 +371,7 @@ sc_get_privtype(const oid * privtype, u_
 int
 sc_get_auth_maclen(int hashtype)
 {
-    netsnmp_auth_alg_info *aai;
+    const netsnmp_auth_alg_info *aai;
 
     DEBUGTRACE;
 
@@ -390,7 +392,7 @@ sc_get_auth_maclen(int hashtype)
 int
 sc_get_proper_auth_length_bytype(int hashtype)
 {
-    netsnmp_auth_alg_info *aai;
+    const netsnmp_auth_alg_info *aai;
 
     DEBUGTRACE;
 
@@ -409,7 +411,7 @@ sc_get_proper_auth_length_bytype(int has
 oid *
 sc_get_auth_oid(int type, size_t *oid_len)
 {
-    netsnmp_auth_alg_info *ai;
+    const netsnmp_auth_alg_info *ai;
 
     DEBUGTRACE;
 
@@ -431,7 +433,7 @@ sc_get_auth_oid(int type, size_t *oid_le
 const char*
 sc_get_auth_name(int type)
 {
-    netsnmp_auth_alg_info *ai;
+    const netsnmp_auth_alg_info *ai;
 
     DEBUGTRACE;
 
@@ -450,7 +452,7 @@ sc_get_auth_name(int type)
 oid *
 sc_get_priv_oid(int type, size_t *oid_len)
 {
-    netsnmp_priv_alg_info *ai;
+    const netsnmp_priv_alg_info *ai;
 
     DEBUGTRACE;
 
@@ -483,12 +485,12 @@ sc_get_properlength(const oid * hashtype
         sc_get_authtype(hashtype, hashtype_len));
 }
 
-netsnmp_feature_child_of(scapi_get_proper_priv_length, netsnmp_unused)
+netsnmp_feature_child_of(scapi_get_proper_priv_length, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_SCAPI_GET_PROPER_PRIV_LENGTH
 int
 sc_get_proper_priv_length(const oid * privtype, u_int privtype_len)
 {
-    netsnmp_priv_alg_info *pai;
+    const netsnmp_priv_alg_info *pai;
 
     DEBUGTRACE;
 
@@ -505,7 +507,7 @@ sc_get_proper_priv_length(const oid * pr
  *
  * returns a pointer to a netsnmp_priv_alg_info struct
  */
-netsnmp_priv_alg_info *
+const netsnmp_priv_alg_info *
 sc_get_priv_alg_byindex(u_int index)
 {
     DEBUGTRACE;
@@ -520,7 +522,7 @@ sc_get_priv_alg_byindex(u_int index)
 int
 sc_get_proper_priv_length_bytype(int privtype)
 {
-    netsnmp_priv_alg_info *pai;
+    const netsnmp_priv_alg_info *pai;
 
     DEBUGTRACE;
 
@@ -592,6 +594,7 @@ sc_random(u_char * buf, size_t * buflen)
 
 #ifdef NETSNMP_USE_OPENSSL
     RAND_bytes(buf, *buflen);   /* will never fail */
+    MAKE_MEM_DEFINED(buf, *buflen);
 #elif NETSNMP_USE_PKCS11			/* NETSNMP_USE_PKCS11 */
     pkcs_random(buf, *buflen);
 #else                           /* NETSNMP_USE_INTERNAL_MD5 */
@@ -967,7 +970,8 @@ sc_hash_type(int auth_type, const u_char
 #endif
     if (!EVP_DigestInit(cptr, hashfn)) {
         /* requested hash function is not available */
-        return SNMPERR_SC_NOT_CONFIGURED;
+        rval = SNMPERR_SC_NOT_CONFIGURED;
+        goto sc_hash_type_quit;
     }
 
 /** pass the data */
@@ -976,6 +980,8 @@ sc_hash_type(int auth_type, const u_char
 /** do the final pass */
     EVP_DigestFinal(cptr, MAC, &tmp_len);
     *MAC_len = tmp_len;
+
+sc_hash_type_quit:
 #if defined(HAVE_EVP_MD_CTX_FREE)
     EVP_MD_CTX_free(cptr);
 #elif defined(HAVE_EVP_MD_CTX_DESTROY)
@@ -1169,7 +1175,7 @@ sc_encrypt(const oid * privtype, size_t
     int             rval = SNMPERR_SUCCESS;
     u_char          pad_block[128];      /* bigger than anything I need */
     u_char          my_iv[128];  /* ditto */
-    netsnmp_priv_alg_info *pai = NULL;
+    const netsnmp_priv_alg_info *pai = NULL;
 #ifndef NETSNMP_DISABLE_DES
     int             pad, plast, pad_size = 0;
 #ifdef OLD_DES
@@ -1251,7 +1257,6 @@ sc_encrypt(const oid * privtype, size_t
 
         QUITFUN(SNMPERR_GENERR, sc_encrypt_quit);
     }
-    pad_size = pai->pad_size;
 
     memset(my_iv, 0, sizeof(my_iv));
 
@@ -1261,6 +1266,8 @@ sc_encrypt(const oid * privtype, size_t
         /*
          * now calculate the padding needed 
          */
+
+        pad_size = pai->pad_size;
         pad = pad_size - (ptlen % pad_size);
         plast = (int) ptlen - (pad_size - pad);
         if (pad == pad_size)
@@ -1363,7 +1370,7 @@ sc_encrypt(const oid * privtype, size_t
 {
     int             rval = SNMPERR_SUCCESS, priv_type
     u_char	    pkcs_des_key[8];
-    netsnmp_priv_alg_info *pai;
+    const netsnmp_priv_alg_info *pai;
 
     DEBUGTRACE;
 
@@ -1462,7 +1469,7 @@ sc_decrypt(const oid * privtype, size_t
 #endif
     DES_cblock      key_struct;
 #endif
-    netsnmp_priv_alg_info *pai = NULL;
+    const netsnmp_priv_alg_info *pai = NULL;
 
     DEBUGTRACE;
 
@@ -1577,7 +1584,7 @@ sc_decrypt(const oid * privtype, size_t
 {
     int             rval = SNMPERR_SUCCESS;
     u_char	    pkcs_des_key[8];
-    netsnmp_priv_alg_info *pai;
+    const netsnmp_priv_alg_info *pai;
 
     DEBUGTRACE;
 
diff -urpN net-snmp-5.8/snmplib/sd-daemon.c net-snmp-5.9.1/snmplib/sd-daemon.c
--- net-snmp-5.8/snmplib/sd-daemon.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/sd-daemon.c	2021-05-26 05:19:35.000000000 +0700
@@ -16,6 +16,7 @@
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-features.h>
 #include <net-snmp/types.h>
+#include <net-snmp/library/tools.h>
 #include <net-snmp/library/snmp_debug.h>
 
 #ifndef NETSNMP_NO_SYSTEMD
@@ -107,8 +108,8 @@ int netsnmp_sd_listen_fds(int unset_envi
         errno = 0;
         l = strtoul(e, &p, 10);
 
-        if (errno != 0) {
-                r = -errno;
+        if (errno != 0 || l != (int)l) {
+                r = errno ? -errno : -EINVAL;
                 goto finish;
         }
 
@@ -318,7 +319,7 @@ int netsnmp_sd_notify(int unset_environm
                 sockaddr.un.sun_path[0] = 0;
 
         memset(&iovec, 0, sizeof(iovec));
-        iovec.iov_base = (char *)state;
+        iovec.iov_base = NETSNMP_REMOVE_CONST(char *, state);
         iovec.iov_len = strlen(state);
 
         memset(&msghdr, 0, sizeof(msghdr));
diff -urpN net-snmp-5.8/snmplib/snmp-tc.c net-snmp-5.9.1/snmplib/snmp-tc.c
--- net-snmp-5.8/snmplib/snmp-tc.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmp-tc.c	2021-05-26 05:19:35.000000000 +0700
@@ -33,12 +33,12 @@
 #include <net-snmp/library/snmp-tc.h>   /* for "internal" definitions */
 #include <net-snmp/library/snmp_api.h>
 
-netsnmp_feature_child_of(snmp_tc_all, libnetsnmp)
+netsnmp_feature_child_of(snmp_tc_all, libnetsnmp);
 
-netsnmp_feature_child_of(netsnmp_dateandtime_set_buf_from_vars, netsnmp_unused)
-netsnmp_feature_child_of(date_n_time, snmp_tc_all)
-netsnmp_feature_child_of(ctime_to_timet, snmp_tc_all)
-netsnmp_feature_child_of(check_rowstatus_with_storagetype_transition, snmp_tc_all)
+netsnmp_feature_child_of(netsnmp_dateandtime_set_buf_from_vars, netsnmp_unused);
+netsnmp_feature_child_of(date_n_time, snmp_tc_all);
+netsnmp_feature_child_of(ctime_to_timet, snmp_tc_all);
+netsnmp_feature_child_of(check_rowstatus_with_storagetype_transition, snmp_tc_all);
 
 #ifndef NETSNMP_FEATURE_REMOVE_NETSNMP_DATEANDTIME_SET_BUF_FROM_VARS
 /*
@@ -163,7 +163,7 @@ date_n_time(const time_t * when, size_t
     string[7] = 0;
     *length = 8;
 
-#if defined(HAVE_STRUCT_TM_TM_GMTOFF) || defined(HAVE_TIMEZONE_VARIABLE)
+#if defined(HAVE_STRUCT_TM_TM_GMTOFF) || HAVE_DECL_TIMEZONE
     /*
      * Timezone offset
      */
@@ -254,10 +254,16 @@ ctime_to_timet(const char *str)
      *  Cope with timezone and DST
      */
 
-#ifdef HAVE_STRUCT_TIME_TM_ISDST
+#ifdef HAVE_STRUCT_TM_TM_ISDST
+#if HAVE_DECL_DAYLIGHT
     tm.tm_isdst = !!daylight;
+#else
+    tm.tm_isdst = 0;
+#endif
+#if HAVE_DECL_TIMEZONE && defined(HAVE_SCALAR_TIMEZONE)
     tm.tm_sec -= timezone;
 #endif
+#endif
 
     return (mktime(&tm));
 }
@@ -429,7 +435,7 @@ check_rowstatus_with_storagetype_transit
 }
 #endif /* NETSNMP_FEATURE_REMOVE_CHECK_ROWSTATUS_WITH_STORAGETYPE_TRANSITION */
 
-netsnmp_feature_child_of(check_storage_transition, snmp_tc_all)
+netsnmp_feature_child_of(check_storage_transition, snmp_tc_all);
 #ifndef NETSNMP_FEATURE_REMOVE_CHECK_STORAGE_TRANSITION
 char
 check_storage_transition(int oldValue, int newValue)
diff -urpN net-snmp-5.8/snmplib/snmp.c net-snmp-5.9.1/snmplib/snmp.c
--- net-snmp-5.8/snmplib/snmp.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmp.c	2021-05-26 05:19:35.000000000 +0700
@@ -55,10 +55,6 @@ SOFTWARE.
 #define NULL 0
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #ifdef vms
 #include <in.h>
 #endif
diff -urpN net-snmp-5.8/snmplib/snmp_alarm.c net-snmp-5.9.1/snmplib/snmp_alarm.c
--- net-snmp-5.8/snmplib/snmp_alarm.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmp_alarm.c	2021-05-26 05:19:35.000000000 +0700
@@ -44,10 +44,6 @@
 # endif
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 #include <net-snmp/config_api.h>
diff -urpN net-snmp-5.8/snmplib/snmp_api.c net-snmp-5.9.1/snmplib/snmp_api.c
--- net-snmp-5.8/snmplib/snmp_api.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmp_api.c	2021-05-26 05:19:35.000000000 +0700
@@ -106,10 +106,6 @@ SOFTWARE.
 #include <locale.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #define SNMP_NEED_REQUEST_LIST
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
@@ -145,10 +141,10 @@ SOFTWARE.
 #include <net-snmp/library/cert_util.h>
 #endif
 
-netsnmp_feature_child_of(statistics, libnetsnmp)
-netsnmp_feature_child_of(snmp_api, libnetsnmp)
-netsnmp_feature_child_of(oid_is_subtree, snmp_api)
-netsnmp_feature_child_of(snmpv3_probe_contextEngineID_rfc5343, snmp_api)
+netsnmp_feature_child_of(statistics, libnetsnmp);
+netsnmp_feature_child_of(snmp_api, libnetsnmp);
+netsnmp_feature_child_of(oid_is_subtree, snmp_api);
+netsnmp_feature_child_of(snmpv3_probe_contextEngineID_rfc5343, snmp_api);
 
 static void     _init_snmp(void);
 
@@ -342,9 +338,6 @@ static int      snmp_detail_f = 0;
 /*
  * Prototypes.
  */
-static int      snmp_parse(void *, netsnmp_session *, netsnmp_pdu *,
-                           u_char *, size_t);
-
 static void     snmpv3_calc_msg_flags(int, int, u_char *);
 static int      snmpv3_verify_msg(netsnmp_request_list *, netsnmp_pdu *);
 static int      snmpv3_build(u_char ** pkt, size_t * pkt_len,
@@ -352,6 +345,7 @@ static int      snmpv3_build(u_char ** p
                              netsnmp_pdu *pdu);
 static int      snmp_parse_version(u_char *, size_t);
 static int      snmp_resend_request(struct session_list *slp,
+                                    netsnmp_request_list *orp,
                                     netsnmp_request_list *rp,
                                     int incr_retries);
 static void     register_default_handlers(void);
@@ -405,6 +399,8 @@ snmp_pdu_type(int type)
 #endif /* !NETSNMP_NO_WRITE_SUPPORT */
     case SNMP_MSG_RESPONSE:
         return "RESPONSE";
+    case SNMP_MSG_TRAP:
+        return "TRAP";
     case SNMP_MSG_INFORM:
         return "INFORM";
     case SNMP_MSG_TRAP2:
@@ -642,10 +638,30 @@ snmp_sess_perror(const char *prog_string
 long int netsnmp_random(void)
 {
 #if defined(HAVE_RANDOM)
+    /*
+     * The function random() is a more sophisticated random number generator
+     * which uses nonlinear feedback and an internal table that is 124 bytes
+     * (992 bits) long. The function returns random values that are 32 bits in
+     * length. All of the bits generated by random() are usable. The random()
+     * function is adequate for simulations and games, but should not be used
+     * for security related applications such as picking cryptographic keys or
+     * simulating one-time pads.
+     */
     return random();
 #elif defined(HAVE_LRAND48)
+    /*
+     * As with random(), lrand48() provides excellent random numbers for
+     * simulations and games, but should not be used for security-related
+     * applications such as picking cryptographic keys or simulating one-time
+     * pads; linear congruential algorithms are too easy to break.
+     */
     return lrand48();
 #elif defined(HAVE_RAND)
+    /*
+     * The original UNIX random number generator, rand(), is not a very good
+     * random number generator. It uses a 32-bit seed and maintains a 32-bit
+     * internal state.
+     */
     return rand();
 #else
 #error "Neither random(), nor lrand48() nor rand() are available"
@@ -768,7 +784,7 @@ snmp_sess_init(netsnmp_session * session
     session->retries = SNMP_DEFAULT_RETRIES;
     session->version = SNMP_DEFAULT_VERSION;
     session->securityModel = SNMP_DEFAULT_SECMODEL;
-    session->rcvMsgMaxSize = SNMP_MAX_MSG_SIZE;
+    session->rcvMsgMaxSize = netsnmp_max_send_msg_size();
     session->sndMsgMaxSize = netsnmp_max_send_msg_size();
     session->flags |= SNMP_FLAGS_DONT_PROBE;
 }
@@ -1028,7 +1044,7 @@ snmp_open(netsnmp_session *session)
 /*
  * extended open 
  */
-netsnmp_feature_child_of(snmp_open_ex, netsnmp_unused)
+netsnmp_feature_child_of(snmp_open_ex, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_SNMP_OPEN_EX
 netsnmp_session *
 snmp_open_ex(netsnmp_session *session,
@@ -1147,9 +1163,7 @@ _sess_copy(netsnmp_session * in_session)
         if ((cp = netsnmp_ds_get_string(NETSNMP_DS_LIBRARY_ID, 
 					NETSNMP_DS_LIB_COMMUNITY)) != NULL) {
             session->community_len = strlen(cp);
-            ucp = (u_char *) malloc(session->community_len);
-            if (ucp)
-                memmove(ucp, cp, session->community_len);
+            ucp = (u_char *) strdup(cp);
         } else {
 #ifdef NETSNMP_NO_ZEROLENGTH_COMMUNITY
             session->community_len = strlen(DEFAULT_COMMUNITY);
@@ -1329,7 +1343,9 @@ snmp_sess_copy(netsnmp_session * pss)
  * multiple future security models.  E.G. both SSH and DTLS.
  */
 int
-snmpv3_probe_contextEngineID_rfc5343(void *slp, netsnmp_session *session) {
+snmpv3_probe_contextEngineID_rfc5343(struct session_list *slp,
+                                     netsnmp_session *session)
+{
     netsnmp_pdu    *pdu = NULL, *response = NULL;
     static oid      snmpEngineIDoid[]   = { 1,3,6,1,6,3,10,2,1,1,0};
     static size_t   snmpEngineIDoid_len = 11;
@@ -1586,13 +1602,15 @@ netsnmp_sess_config_and_open_transport(n
     /** if transport has a max size, make sure session is the same (or less) */
     if (in_session->rcvMsgMaxSize > transport->msgMaxSize) {
         DEBUGMSGTL(("snmp_sess",
-                    "limiting session rcv size to transport max\n"));
+                    "limiting session rcv size (%" NETSNMP_PRIz "d) to transport max (%" NETSNMP_PRIz "d)\n",
+                    in_session->rcvMsgMaxSize, transport->msgMaxSize));
         in_session->rcvMsgMaxSize = transport->msgMaxSize;
     }
 
     if (in_session->sndMsgMaxSize > transport->msgMaxSize) {
         DEBUGMSGTL(("snmp_sess",
-                    "limiting session snd size to transport max\n"));
+                    "limiting session snd size (%" NETSNMP_PRIz "d) to transport max (%" NETSNMP_PRIz "d)\n",
+                    in_session->sndMsgMaxSize, transport->msgMaxSize));
         in_session->sndMsgMaxSize = transport->msgMaxSize;
     }
 
@@ -1836,12 +1854,14 @@ snmp_sess_add_ex(netsnmp_session * in_se
     /** don't let session max exceed transport max */
     if (slp->session->rcvMsgMaxSize > transport->msgMaxSize) {
         DEBUGMSGTL(("snmp_sess_add",
-                    "limiting session rcv size to transport max\n"));
+                    "limiting session rcv size (%" NETSNMP_PRIz "d) to transport max (%" NETSNMP_PRIz "d)\n",
+                    slp->session->rcvMsgMaxSize, transport->msgMaxSize));
         slp->session->rcvMsgMaxSize = transport->msgMaxSize;
     }
     if (slp->session->sndMsgMaxSize > transport->msgMaxSize) {
         DEBUGMSGTL(("snmp_sess_add",
-                    "limiting session snd size to transport max\n"));
+                    "limiting session snd size (%" NETSNMP_PRIz "d) to transport max (%" NETSNMP_PRIz "d)\n",
+                    slp->session->sndMsgMaxSize, transport->msgMaxSize));
         slp->session->sndMsgMaxSize = transport->msgMaxSize;
     }
 
@@ -2730,7 +2750,7 @@ snmpv3_packet_build(netsnmp_session * se
     /*
      * build a scopedPDU structure into spdu_buf
      */
-    spdu_buf_len = SNMP_MAX_MSG_SIZE;
+    spdu_buf_len = sizeof(spdu_buf);
     DEBUGDUMPSECTION("send", "ScopedPdu");
     cp = snmpv3_scopedPDU_header_build(pdu, spdu_buf, &spdu_buf_len,
                                        &spdu_hdr_e);
@@ -2742,6 +2762,11 @@ snmpv3_packet_build(netsnmp_session * se
      */
     DEBUGPRINTPDUTYPE("send", ((pdu_data) ? *pdu_data : 0x00));
     if (pdu_data) {
+        if (cp + pdu_data_len > spdu_buf + sizeof(spdu_buf)) {
+            snmp_log(LOG_ERR, "%s: PDU too big (%" NETSNMP_PRIz "d > %" NETSNMP_PRIz "d)\n",
+                     NETSNMP_FUNCTION, pdu_data_len, sizeof(spdu_buf));
+            return -1;
+        }
         memcpy(cp, pdu_data, pdu_data_len);
         cp += pdu_data_len;
     } else {
@@ -2755,7 +2780,7 @@ snmpv3_packet_build(netsnmp_session * se
      * re-encode the actual ASN.1 length of the scopedPdu
      */
     spdu_len = cp - spdu_hdr_e; /* length of scopedPdu minus ASN.1 headers */
-    spdu_buf_len = SNMP_MAX_MSG_SIZE;
+    spdu_buf_len = sizeof(spdu_buf);
     if (asn_build_sequence(spdu_buf, &spdu_buf_len,
                            (u_char) (ASN_SEQUENCE | ASN_CONSTRUCTOR),
                            spdu_len) == NULL)
@@ -2768,7 +2793,7 @@ snmpv3_packet_build(netsnmp_session * se
      * message - the entire message to transmitted on the wire is returned
      */
     cp = NULL;
-    *out_length = SNMP_MAX_MSG_SIZE;
+    *out_length = sizeof(spdu_buf);
     DEBUGDUMPSECTION("send", "SM msgSecurityParameters");
     sptr = find_sec_mod(pdu->securityModel);
     if (sptr && sptr->encode_forward) {
@@ -3184,11 +3209,22 @@ _snmp_build(u_char ** pkt, size_t * pkt_
     return 0;
 }
 
+/**
+ * Serialize a PDU into ASN format.
+ * @param pkt     [out] Serialized PDU.
+ * @param pkt_len [out] Size of pkt.
+ * @param offset  [out] Number of bytes written into *pkt.
+ * @param pss     [in]  Session pointer.
+ * @param pdu     [in]  PDU to serialize.
+ *
+ * @returns 0 upon success; -1 upon failure.
+ */
 int
 snmp_build(u_char ** pkt, size_t * pkt_len, size_t * offset,
            netsnmp_session * pss, netsnmp_pdu *pdu)
 {
     int             rc;
+
     rc = _snmp_build(pkt, pkt_len, offset, pss, pdu);
     if (rc) {
         if (!pss->s_snmp_errno) {
@@ -3812,7 +3848,8 @@ snmpv3_parse(netsnmp_pdu *pdu,
         /** don't increase max msg size if we've already got one */
         if (sess->sndMsgMaxSize < pdu->msgMaxSize) {
             DEBUGMSGTL(("snmpv3_parse:msgMaxSize",
-                        "msgMaxSize greater than session max; reducing\n"));
+                        "msgMaxSize %" NETSNMP_PRIz "d greater than session max %ld; reducing\n",
+                        sess->sndMsgMaxSize, pdu->msgMaxSize));
             pdu->msgMaxSize = sess->sndMsgMaxSize;
         }
     }
@@ -4011,7 +4048,12 @@ snmpv3_parse(netsnmp_pdu *pdu,
 static void
 free_securityStateRef(netsnmp_pdu* pdu)
 {
-    struct snmp_secmod_def *sptr = find_sec_mod(pdu->securityModel);
+    struct snmp_secmod_def *sptr;
+
+    if (!pdu->securityStateRef)
+        return;
+
+    sptr = find_sec_mod(pdu->securityModel);
     if (sptr) {
         if (sptr->pdu_free_state_ref) {
             (*sptr->pdu_free_state_ref) (pdu->securityStateRef);
@@ -4122,9 +4164,7 @@ snmpv3_make_report(netsnmp_pdu *pdu, int
      * FIX - yes they should but USM needs to follow new EoP to determine
      * which cached values to use 
      */
-    if (pdu->securityStateRef) {
-        free_securityStateRef(pdu);
-    }
+    free_securityStateRef(pdu);
 
     if (error == SNMPERR_USM_NOTINTIMEWINDOW) {
         pdu->securityLevel = SNMP_SEC_LEVEL_AUTHNOPRIV;
@@ -4366,12 +4406,7 @@ _snmp_parse(void *sessp,
                                              result, pdu);
                 }
             }
-            if (pdu->securityStateRef != NULL) {
-                if (secmod && secmod->pdu_free_state_ref) {
-                    secmod->pdu_free_state_ref(pdu->securityStateRef);
-                    pdu->securityStateRef = NULL;
-                }
-            }
+            free_securityStateRef(pdu);
         }
 
         /* Implement RFC5343 here for two reasons:
@@ -4517,14 +4552,24 @@ _snmp_parse(void *sessp,
     return result;
 }
 
-static int
-snmp_parse(void *sessp,
+/**
+ * Parse a PDU.
+ * @param slp    [in]  Session pointer (struct session_list).
+ * @param pss    [in]  Session pointer (netsnmp_session).
+ * @param pdu    [out] Parsed PDU.
+ * @param data   [in]  PDU to parse.
+ * @param length [in]  Length of data.
+ *
+ * @returns 0 upon success; -1 upon failure.
+ */
+int
+snmp_parse(struct session_list *slp,
            netsnmp_session * pss,
            netsnmp_pdu *pdu, u_char * data, size_t length)
 {
     int             rc;
 
-    rc = _snmp_parse(sessp, pss, pdu, data, length);
+    rc = _snmp_parse(slp, pss, pdu, data, length);
     if (rc) {
         if (!pss->s_snmp_errno) {
             pss->s_snmp_errno = SNMPERR_BAD_PARSE;
@@ -5059,6 +5104,8 @@ _build_initial_pdu_packet(struct session
             pdu->msgMaxSize = transport->msgMaxSize;
         if (pdu->msgMaxSize > session->sndMsgMaxSize)
             pdu->msgMaxSize = session->sndMsgMaxSize;
+        DEBUGMSGTL(("sess_async_send", "max PDU size: %ld\n",
+                    pdu->msgMaxSize));
     }
     netsnmp_assert(pdu->msgMaxSize > 0);
 
@@ -5128,6 +5175,9 @@ _build_initial_pdu_packet(struct session
         if (length <= pdu->msgMaxSize)
             break;
 
+        DEBUGMSGTL(("sess_async_send", "length %" NETSNMP_PRIz "d exceeds maximum %ld\n",
+                    length, pdu->msgMaxSize));
+
         /** packet too big. if this is not a bulk request, we're done (err). */
         if (!bulk) {
            session->s_snmp_errno = SNMPERR_TOO_LONG;
@@ -5217,6 +5267,20 @@ snmp_async_send(netsnmp_session * sessio
     return snmp_sess_async_send(sessp, pdu, callback, cb_data);
 }
 
+/**
+ * Send a PDU asynchronously.
+ *
+ * @param[in] slp      Session pointer.
+ * @param[in] pdu      PDU to send.
+ * @param[in] callback Callback function called after processing of the PDU
+ *                     finished. This function is called if the PDU has not
+ *                     been sent or after a response has been received. Must
+ *                     not free @pdu.
+ * @param[in] cb_data  Will be passed as fifth argument to @callback.
+ *
+ * @return If successful, returns the request id of @pdu and frees @pdu.
+ * If not successful, returns zero and expects the caller to free @pdu.
+ */
 static int
 _sess_async_send(void *sessp,
                  netsnmp_pdu *pdu, snmp_callback callback, void *cb_data)
@@ -5378,6 +5442,20 @@ _sess_async_send(void *sessp,
     return reqid;
 }
 
+/**
+ * Send a PDU asynchronously.
+ *
+ * @param[in] slp      Session pointer.
+ * @param[in] pdu      PDU to send.
+ * @param[in] callback Callback function called after processing of the PDU
+ *                     finished. This function is called if the PDU has not
+ *                     been sent or after a response has been received. Must
+ *                     not free @pdu.
+ * @param[in] cb_data  Will be passed as fifth argument to @callback.
+ *
+ * @return If successful, returns the request id of @pdu and frees @pdu.
+ * If not successful, returns zero and expects the caller to free @pdu.
+ */
 int
 snmp_sess_async_send(void *sessp,
                      netsnmp_pdu *pdu,
@@ -5456,40 +5534,21 @@ snmp_free_pdu(netsnmp_pdu *pdu)
     if (!pdu)
         return;
 
-    /*
-     * If the command field is empty, that probably indicates
-     *   that this PDU structure has already been freed.
-     *   Log a warning and return (rather than freeing things again)
-     *
-     * Note that this does not pick up dual-frees where the
-     *   memory is set to random junk, which is probably more serious.
-     *
-     * rks: while this is a good idea, there are two problems.
-     *         1) agentx sets command to 0 in some cases
-     *         2) according to Wes, a bad decode of a v3 message could
-     *            result in a 0 at this offset.
-     *      so I'm commenting it out until a better solution is found.
-     *      note that I'm leaving the memset, below....
-     *
-    if (pdu->command == 0) {
-        snmp_log(LOG_WARNING, "snmp_free_pdu probably called twice\n");
-        return;
-    }
-     */
+    free_securityStateRef(pdu);
+
     if ((sptr = find_sec_mod(pdu->securityModel)) != NULL &&
         sptr->pdu_free != NULL) {
         (*sptr->pdu_free) (pdu);
     }
     snmp_free_varbind(pdu->variables);
-    SNMP_FREE(pdu->enterprise);
-    SNMP_FREE(pdu->community);
-    SNMP_FREE(pdu->contextEngineID);
-    SNMP_FREE(pdu->securityEngineID);
-    SNMP_FREE(pdu->contextName);
-    SNMP_FREE(pdu->securityName);
-    SNMP_FREE(pdu->transport_data);
-    memset(pdu, 0, sizeof(netsnmp_pdu));
-    free((char *) pdu);
+    free(pdu->enterprise);
+    free(pdu->community);
+    free(pdu->contextEngineID);
+    free(pdu->securityEngineID);
+    free(pdu->contextName);
+    free(pdu->securityName);
+    free(pdu->transport_data);
+    free(pdu);
 }
 
 netsnmp_pdu    *
@@ -5562,9 +5621,9 @@ _sess_process_packet_parse_pdu(void *ses
               filtered = netsnmp_transport_filter_check(sourceaddr);
           }
           if ((filter == -1) && filtered)
-              dropstr = "matched blacklist";
+              dropstr = "matched blocklist";
           else if ((filter == 1) && !filtered)
-              dropstr = "didn't match whitelist";
+              dropstr = "didn't match acceptlist";
           if (dropstr) {
               DEBUGMSGTL(("sess_process_packet:filter",
                           "packet from %s %s\n",
@@ -5630,12 +5689,6 @@ _sess_process_packet_parse_pdu(void *ses
   }
 
   if (ret != SNMP_ERR_NOERROR) {
-    /*
-     * Call the security model to free any securityStateRef supplied w/ msg.  
-     */
-    if (pdu->securityStateRef != NULL) {
-      free_securityStateRef(pdu);
-    }
     snmp_free_pdu(pdu);
     return NULL;
   }
@@ -5643,6 +5696,20 @@ _sess_process_packet_parse_pdu(void *ses
   return pdu;
 }
 
+/* Remove request @rp from session @isp. @orp is the request before @rp. */
+static void
+remove_request(struct snmp_internal_session *isp,
+               netsnmp_request_list *orp, netsnmp_request_list *rp)
+{
+    if (orp)
+        orp->next_request = rp->next_request;
+    else
+        isp->requests = rp->next_request;
+    if (isp->requestsEnd == rp)
+        isp->requestsEnd = orp;
+    snmp_free_pdu(rp->pdu);
+}
+
 /*
  * This function processes a PDU and calls the relevant callbacks.
  */
@@ -5659,9 +5726,7 @@ _sess_process_packet_handle_pdu(void *se
     /*
      * Call USM to free any securityStateRef supplied with the message.  
      */
-    if (pdu->securityStateRef) {
-      free_securityStateRef(pdu);
-    }
+    free_securityStateRef(pdu);
 
     for (rp = isp->requests; rp; orp = rp, rp = rp->next_request) {
       snmp_callback   callback;
@@ -5717,7 +5782,7 @@ _sess_process_packet_handle_pdu(void *se
 	     * * inifinite resend                      
 	     */
 	    if (rp->retries <= sp->retries) {
-	      snmp_resend_request(slp, rp, TRUE);
+	      snmp_resend_request(slp, orp, rp, TRUE);
 	      break;
 	    } else {
 	      /* We're done with retries, so no longer waiting for a response */
@@ -5778,13 +5843,7 @@ _sess_process_packet_handle_pdu(void *se
 	/*
 	 * Successful, so delete request.  
 	 */
-	if (orp)
-	  orp->next_request = rp->next_request;
-        else
-	  isp->requests = rp->next_request;
-        if (isp->requestsEnd == rp)
-	  isp->requestsEnd = orp;
-	snmp_free_pdu(rp->pdu);
+	remove_request(isp, orp, rp);
 	free(rp);
 	/*
 	 * There shouldn't be any more requests with the same reqid.  
@@ -5809,12 +5868,6 @@ _sess_process_packet_handle_pdu(void *se
     }
   }
 
-  /*
-   * Call USM to free any securityStateRef supplied with the message.  
-   */
-  if (pdu->securityStateRef && pdu->command == SNMP_MSG_TRAP2)
-    free_securityStateRef(pdu);
-
   if (!handled) {
     if (sp->flags & SNMP_FLAGS_SHARED_SOCKET)
       return -2;
@@ -6663,8 +6716,8 @@ snmp_timeout(void)
 }
 
 static int
-snmp_resend_request(struct session_list *slp, netsnmp_request_list *rp,
-                    int incr_retries)
+snmp_resend_request(struct session_list *slp, netsnmp_request_list *orp,
+                    netsnmp_request_list *rp, int incr_retries)
 {
     struct snmp_internal_session *isp;
     netsnmp_session *sp;
@@ -6731,9 +6784,11 @@ snmp_resend_request(struct session_list
         sp->s_snmp_errno = SNMPERR_BAD_SENDTO;
         sp->s_errno = errno;
         snmp_set_detail(strerror(errno));
-        if (rp->callback)
+        if (rp->callback) {
             rp->callback(NETSNMP_CALLBACK_OP_SEND_FAILED, sp,
                          rp->pdu->reqid, rp->pdu, rp->cb_data);
+            remove_request(isp, orp, rp);
+	}
         return -1;
     } else {
         netsnmp_get_monotonic_clock(&now);
@@ -6813,17 +6868,11 @@ snmp_sess_timeout(void *sessp)
                     callback(NETSNMP_CALLBACK_OP_TIMED_OUT, sp,
                              rp->pdu->reqid, rp->pdu, magic);
                 }
-                if (orp)
-                    orp->next_request = rp->next_request;
-                else
-                    isp->requests = rp->next_request;
-                if (isp->requestsEnd == rp)
-                    isp->requestsEnd = orp;
-                snmp_free_pdu(rp->pdu);
+                remove_request(isp, orp, rp);
                 freeme = rp;
                 continue;       /* don't update orp below */
             } else {
-                if (snmp_resend_request(slp, rp, TRUE)) {
+                if (snmp_resend_request(slp, orp, rp, TRUE)) {
                     break;
                 }
             }
diff -urpN net-snmp-5.8/snmplib/snmp_auth.c net-snmp-5.9.1/snmplib/snmp_auth.c
--- net-snmp-5.8/snmplib/snmp_auth.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmp_auth.c	2021-05-26 05:19:35.000000000 +0700
@@ -65,9 +65,6 @@ SOFTWARE.
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 
 #ifdef vms
 #include <in.h>
diff -urpN net-snmp-5.8/snmplib/snmp_client.c net-snmp-5.9.1/snmplib/snmp_client.c
--- net-snmp-5.8/snmplib/snmp_client.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmp_client.c	2021-05-26 05:19:35.000000000 +0700
@@ -49,6 +49,9 @@ SOFTWARE.
 
 #include <stdio.h>
 #include <errno.h>
+#ifdef HAVE_INTTYPES_H
+#include <inttypes.h>
+#endif
 #if HAVE_STDLIB_H
 #include <stdlib.h>
 #endif
@@ -87,10 +90,6 @@ SOFTWARE.
 #include <syslog.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 
 #include <net-snmp/agent/ds_agent.h>
@@ -105,12 +104,12 @@ SOFTWARE.
 #include <net-snmp/library/large_fd_set.h>
 #include <net-snmp/pdu_api.h>
 
-netsnmp_feature_child_of(snmp_client_all, libnetsnmp)
+netsnmp_feature_child_of(snmp_client_all, libnetsnmp);
 
-netsnmp_feature_child_of(snmp_split_pdu, snmp_client_all)
-netsnmp_feature_child_of(snmp_reset_var_types, snmp_client_all)
-netsnmp_feature_child_of(query_set_default_session, snmp_client_all)
-netsnmp_feature_child_of(row_create, snmp_client_all)
+netsnmp_feature_child_of(snmp_split_pdu, snmp_client_all);
+netsnmp_feature_child_of(snmp_reset_var_types, snmp_client_all);
+netsnmp_feature_child_of(query_set_default_session, snmp_client_all);
+netsnmp_feature_child_of(row_create, snmp_client_all);
 
 #ifndef BSD4_3
 #define BSD4_2
@@ -402,27 +401,16 @@ _clone_pdu_header(netsnmp_pdu *pdu)
         return NULL;
     }
 
-    if (pdu->securityStateRef &&
-        pdu->command == SNMP_MSG_TRAP2) {
-
-        ret = usm_clone_usmStateReference((struct usmStateReference *) pdu->securityStateRef,
-                (struct usmStateReference **) &newpdu->securityStateRef );
-
-        if (ret)
-        {
+    sptr = find_sec_mod(newpdu->securityModel);
+    if (sptr && sptr->pdu_clone) {
+        /* call security model if it needs to know about this */
+        ret = sptr->pdu_clone(pdu, newpdu);
+        if (ret) {
             snmp_free_pdu(newpdu);
             return NULL;
         }
     }
 
-    if ((sptr = find_sec_mod(newpdu->securityModel)) != NULL &&
-        sptr->pdu_clone != NULL) {
-        /*
-         * call security model if it needs to know about this 
-         */
-        (*sptr->pdu_clone) (pdu, newpdu);
-    }
-
     return newpdu;
 }
 
@@ -566,7 +554,10 @@ netsnmp_pdu    *
 _clone_pdu(netsnmp_pdu *pdu, int drop_err)
 {
     netsnmp_pdu    *newpdu;
+
     newpdu = _clone_pdu_header(pdu);
+    if (!newpdu)
+        return newpdu;
     newpdu = _copy_pdu_vars(pdu, newpdu, drop_err, 0, 10000);   /* skip none, copy all */
 
     return newpdu;
@@ -612,7 +603,10 @@ netsnmp_pdu    *
 snmp_split_pdu(netsnmp_pdu *pdu, int skip_count, int copy_count)
 {
     netsnmp_pdu    *newpdu;
+
     newpdu = _clone_pdu_header(pdu);
+    if (!newpdu)
+        return newpdu;
     newpdu = _copy_pdu_vars(pdu, newpdu, 0,     /* don't drop any variables */
                             skip_count, copy_count);
 
@@ -757,7 +751,7 @@ count_varbinds(netsnmp_variable_list * v
     return count;
 }
 
-netsnmp_feature_child_of(count_varbinds_of_type, netsnmp_unused)
+netsnmp_feature_child_of(count_varbinds_of_type, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_COUNT_VARBINDS_OF_TYPE
 int
 count_varbinds_of_type(netsnmp_variable_list * var_ptr, u_char type)
@@ -772,7 +766,7 @@ count_varbinds_of_type(netsnmp_variable_
 }
 #endif /* NETSNMP_FEATURE_REMOVE_COUNT_VARBINDS_OF_TYPE */
 
-netsnmp_feature_child_of(find_varind_of_type, netsnmp_unused)
+netsnmp_feature_child_of(find_varind_of_type, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_FIND_VARIND_OF_TYPE
 netsnmp_variable_list *
 find_varbind_of_type(netsnmp_variable_list * var_ptr, u_char type)
@@ -903,8 +897,8 @@ snmp_set_var_value(netsnmp_variable_list
 #endif
         else if (vars->val_len == sizeof(char)) {
             if (ASN_INTEGER == vars->type) {
-                const char      *val_char 
-                    = (const char *) value;
+                const signed char   *val_char
+                    = (const signed char *) value;
                 *(vars->val.integer) = (long) *val_char;
             } else {
                     const u_char    *val_uchar
@@ -973,7 +967,7 @@ snmp_set_var_value(netsnmp_variable_list
     case ASN_OPAQUE_I64:
 #endif                          /* NETSNMP_WITH_OPAQUE_SPECIAL_TYPES */
     case ASN_COUNTER64:
-        if (largeval) {
+        if (largeval || vars->val_len != sizeof(struct counter64)) {
             snmp_log(LOG_ERR,"bad size for counter 64 (%d)\n",
                      (int)vars->val_len);
             return (1);
diff -urpN net-snmp-5.8/snmplib/snmp_debug.c net-snmp-5.9.1/snmplib/snmp_debug.c
--- net-snmp-5.8/snmplib/snmp_debug.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmp_debug.c	2021-05-26 05:19:35.000000000 +0700
@@ -35,9 +35,6 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 
 #ifdef HAVE_PRIORITYNAMES
 #include <sys/syslog.h>
@@ -84,15 +81,15 @@ debug_indent_get(void)
 const char*
 debug_indent(void)
 {
-#define SPACES "                                        " \
-               "                                        "
+    static const char SPACES[] = "                                        "
+        "                                        ";
+
     if ((sizeof(SPACES) - 1) < (unsigned int)debugindent) {
         snmp_log(LOG_ERR, "Too deep indentation for debug_indent. "
                  "Consider using \"%%*s\", debug_indent_get(), \"\" instead.");
         return SPACES;
     }
-    return SPACES + sizeof(SPACES) - 1 - debugindent;
-#undef SPACES
+    return &SPACES[sizeof(SPACES) - 1 - debugindent];
 }
 
 void
@@ -203,7 +200,7 @@ debug_register_tokens(const char *tokens
             } else if (debug_num_tokens < MAX_DEBUG_TOKENS) {
                 if ('-' == *cp) {
                     ++cp;
-                    status = SNMP_DEBUG_EXCLUDED;
+                    status = SNMP_DEBUG_DISABLED;
                 }
                 else
                     status = SNMP_DEBUG_ACTIVE;
diff -urpN net-snmp-5.8/snmplib/snmp_enum.c net-snmp-5.9.1/snmplib/snmp_enum.c
--- net-snmp-5.8/snmplib/snmp_enum.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmp_enum.c	2021-05-26 05:19:35.000000000 +0700
@@ -18,9 +18,6 @@
 #include <strings.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 #include <sys/types.h>
 
 #include <net-snmp/types.h>
@@ -31,12 +28,12 @@
 #include <net-snmp/library/system.h>      /* strcasecmp() */
 #include <net-snmp/library/snmp_assert.h>
 
-netsnmp_feature_child_of(snmp_enum_all, libnetsnmp)
+netsnmp_feature_child_of(snmp_enum_all, libnetsnmp);
 
-netsnmp_feature_child_of(se_find_free_value_in_slist, snmp_enum_all)
-netsnmp_feature_child_of(snmp_enum_store_list, snmp_enum_all)
-netsnmp_feature_child_of(snmp_enum_store_slist, snmp_enum_all)
-netsnmp_feature_child_of(snmp_enum_clear, snmp_enum_all)
+netsnmp_feature_child_of(se_find_free_value_in_slist, snmp_enum_all);
+netsnmp_feature_child_of(snmp_enum_store_list, snmp_enum_all);
+netsnmp_feature_child_of(snmp_enum_store_slist, snmp_enum_all);
+netsnmp_feature_child_of(snmp_enum_clear, snmp_enum_all);
 
 struct snmp_enum_list_str {
     char           *name;
diff -urpN net-snmp-5.8/snmplib/snmp_logging.c net-snmp-5.9.1/snmplib/snmp_logging.c
--- net-snmp-5.8/snmplib/snmp_logging.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmp_logging.c	2021-05-26 05:19:35.000000000 +0700
@@ -66,9 +66,6 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
@@ -78,6 +75,8 @@
 
 #include <net-snmp/library/callback.h>
 
+#include "snmp_syslog.h"
+
 #ifdef va_copy
 #define NEED_VA_END_AFTER_VA_COPY
 #else
@@ -92,21 +91,21 @@
 #include "snprintf.h"
 #endif
 
-netsnmp_feature_child_of(logging_all, libnetsnmp)
+netsnmp_feature_child_of(logging_all, libnetsnmp);
 
-netsnmp_feature_child_of(logging_outputs, logging_all)
-netsnmp_feature_child_of(logging_file, logging_outputs)
-netsnmp_feature_child_of(logging_stdio, logging_outputs)
-netsnmp_feature_child_of(logging_syslog, logging_outputs)
-netsnmp_feature_child_of(logging_external, logging_all)
+netsnmp_feature_child_of(logging_outputs, logging_all);
+netsnmp_feature_child_of(logging_file, logging_outputs);
+netsnmp_feature_child_of(logging_stdio, logging_outputs);
+netsnmp_feature_child_of(logging_syslog, logging_outputs);
+netsnmp_feature_child_of(logging_external, logging_all);
 
-netsnmp_feature_child_of(enable_stderrlog, logging_all)
+netsnmp_feature_child_of(enable_stderrlog, logging_all);
 
-netsnmp_feature_child_of(logging_enable_calllog, netsnmp_unused)
-netsnmp_feature_child_of(logging_enable_loghandler, netsnmp_unused)
+netsnmp_feature_child_of(logging_enable_calllog, netsnmp_unused);
+netsnmp_feature_child_of(logging_enable_loghandler, netsnmp_unused);
 
 /* default to the file/stdio/syslog set */
-netsnmp_feature_want(logging_outputs)
+netsnmp_feature_want(logging_outputs);
 
 /*
  * logh_head:  A list of all log handlers, in increasing order of priority
@@ -182,48 +181,6 @@ shutdown_snmp_logging(void)
       netsnmp_remove_loghandler( logh_head );
 }
 
-/*
- * These definitions handle 4.2 systems without additional syslog facilities.
- */
-#ifndef NETSNMP_FEATURE_REMOVE_LOGGING_SYSLOG
-#ifndef LOG_CONS
-#define LOG_CONS	0       /* Don't bother if not defined... */
-#endif
-#ifndef LOG_PID
-#define LOG_PID		0       /* Don't bother if not defined... */
-#endif
-#ifndef LOG_LOCAL0
-#define LOG_LOCAL0	0
-#endif
-#ifndef LOG_LOCAL1
-#define LOG_LOCAL1	0
-#endif
-#ifndef LOG_LOCAL2
-#define LOG_LOCAL2	0
-#endif
-#ifndef LOG_LOCAL3
-#define LOG_LOCAL3	0
-#endif
-#ifndef LOG_LOCAL4
-#define LOG_LOCAL4	0
-#endif
-#ifndef LOG_LOCAL5
-#define LOG_LOCAL5	0
-#endif
-#ifndef LOG_LOCAL6
-#define LOG_LOCAL6	0
-#endif
-#ifndef LOG_LOCAL7
-#define LOG_LOCAL7	0
-#endif
-#ifndef LOG_DAEMON
-#define LOG_DAEMON	0
-#endif
-#ifndef LOG_USER
-#define LOG_USER	0
-#endif
-#endif /* NETSNMP_FEATURE_REMOVE_LOGGING_SYSLOG */
-
 /* Set line buffering mode for a stream. */
 void
 netsnmp_set_line_buffering(FILE *stream)
@@ -804,8 +761,8 @@ snmp_enable_syslog_ident(const char *ide
 	     * Hmmm.....
 	     * Maybe disable this handler, and log the error ?
 	     */
-        fprintf(stderr, "Could not open event log for %s. "
-                "Last error: 0x%x\n", ident, GetLastError());
+        fprintf(stderr, "Could not open event log for %s. Last error: %u\n",
+                ident, (unsigned int)GetLastError());
         enable = 0;
     }
 #else
@@ -1039,11 +996,11 @@ netsnmp_register_loghandler( int type, i
 
     logh->type     = type;
     switch ( type ) {
+#ifndef NETSNMP_FEATURE_REMOVE_LOGGING_STDIO
     case NETSNMP_LOGHANDLER_STDOUT:
         logh->imagic  = 1;
         logh->handler = log_handler_stdouterr;
         break;
-#ifndef NETSNMP_FEATURE_REMOVE_LOGGING_STDIO
     case NETSNMP_LOGHANDLER_STDERR:
         logh->handler = log_handler_stdouterr;
         break;
@@ -1213,8 +1170,8 @@ log_handler_syslog(  netsnmp_log_handler
 	     * Hmmm.....
 	     * Maybe disable this handler, and log the error ?
 	     */
-        fprintf(stderr, "Could not report event.  Last error: 0x%x\n",
-			GetLastError());
+        fprintf(stderr, "Could not report event.  Last error: %u\n",
+                (unsigned int)GetLastError());
         return 0;
     }
     return 1;
@@ -1254,6 +1211,7 @@ log_handler_file(    netsnmp_log_handler
 {
     FILE           *fhandle;
     char            sbuf[40];
+    int             len = strlen( str );
 
     /*
      * We use imagic to save information about whether the next output
@@ -1282,7 +1240,11 @@ log_handler_file(    netsnmp_log_handler
     }
     fprintf(fhandle, "%s%s", sbuf, str);
     fflush(fhandle);
-    logh->imagic = str[strlen(str) - 1] == '\n';
+    if (len > 0) {
+        logh->imagic = str[len - 1] == '\n';
+    } else {
+        logh->imagic = 0;
+    }
     return 1;
 }
 #endif /* NETSNMP_FEATURE_REMOVE_LOGGING_FILE */
diff -urpN net-snmp-5.8/snmplib/snmp_openssl.c net-snmp-5.9.1/snmplib/snmp_openssl.c
--- net-snmp-5.8/snmplib/snmp_openssl.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmp_openssl.c	2021-05-26 05:19:35.000000000 +0700
@@ -83,12 +83,12 @@ DH_set0_pqg(DH *dh, BIGNUM *p, BIGNUM *q
 /** TLS/DTLS certificatte support */
 #if defined(NETSNMP_USE_OPENSSL) && defined(HAVE_LIBSSL) && !defined(NETSNMP_FEATURE_REMOVE_CERT_UTIL)
 
-netsnmp_feature_require(container_free_all)
+netsnmp_feature_require(container_free_all);
 
-netsnmp_feature_child_of(openssl_cert_get_subjectAltNames, netsnmp_unused)
-netsnmp_feature_child_of(openssl_ht2nid, netsnmp_unused)
-netsnmp_feature_child_of(openssl_err_log, netsnmp_unused)
-netsnmp_feature_child_of(cert_dump_names, netsnmp_unused)
+netsnmp_feature_child_of(openssl_cert_get_subjectAltNames, netsnmp_unused);
+netsnmp_feature_child_of(openssl_ht2nid, netsnmp_unused);
+netsnmp_feature_child_of(openssl_err_log, netsnmp_unused);
+netsnmp_feature_child_of(cert_dump_names, netsnmp_unused);
 
 #include <ctype.h>
 
@@ -284,31 +284,30 @@ _cert_get_extension(X509_EXTENSION  *oex
     }
     if (X509V3_EXT_print(bio, oext, 0, 0) != 1) {
         snmp_log(LOG_ERR, "could not print extension!\n");
-        BIO_vfree(bio);
-        return NULL;
+        goto out;
     }
 
     space = BIO_get_mem_data(bio, &data);
     if (buf && *buf) {
-        if (*len < space) 
-            buf_ptr = NULL;
-        else
-            buf_ptr = *buf;
+        if (*len < space + 1) {
+            snmp_log(LOG_ERR, "not enough buffer space to print extension\n");
+            goto out;
+        }
+        buf_ptr = *buf;
+    } else {
+        buf_ptr = calloc(1, space + 1);
     }
-    else
-        buf_ptr = calloc(1,space + 1);
     
     if (!buf_ptr) {
-        snmp_log(LOG_ERR,
-                 "not enough space or error in allocation for extenstion\n");
-        BIO_vfree(bio);
-        return NULL;
+        snmp_log(LOG_ERR, "error in allocation for extension\n");
+        goto out;
     }
     memcpy(buf_ptr, data, space);
     buf_ptr[space] = 0;
     if (len)
         *len = space;
 
+out:
     BIO_vfree(bio);
 
     return buf_ptr;
@@ -479,7 +478,7 @@ netsnmp_openssl_cert_dump_extensions(X50
 {
     X509_EXTENSION  *extension;
     const char      *extension_name;
-    char             buf[SNMP_MAXBUF_SMALL], *buf_ptr = buf, *str, *lf;
+    char             buf[SNMP_MAXBUF], *buf_ptr = buf, *str, *lf;
     int              i, num_extensions, buf_len, nid;
 
     if (NULL == ocert)
@@ -499,6 +498,11 @@ netsnmp_openssl_cert_dump_extensions(X50
         extension_name = OBJ_nid2sn(nid);
         buf_len = sizeof(buf);
         str = _cert_get_extension_str_at(ocert, i, &buf_ptr, &buf_len, 0);
+        if (!str) {
+            DEBUGMSGT(("9:cert:dump", "    %2d: %s\n", i,
+                        extension_name));
+            continue;
+        }
         lf = strchr(str, '\n'); /* look for multiline strings */
         if (NULL != lf)
             *lf = '\0'; /* only log first line of multiline here */
@@ -697,8 +701,7 @@ netsnmp_openssl_get_cert_chain(SSL *ssl)
         DEBUGMSGT(("ssl:cert:chain", "examining cert chain\n"));
         for(i = 0; i < sk_num((const void *)ochain); ++i) {
             ocert_tmp = (X509*)sk_value((const void *)ochain,i);
-            fingerprint = netsnmp_openssl_cert_get_fingerprint(ocert_tmp,
-                                                               NS_HASH_SHA1);
+            fingerprint = netsnmp_openssl_cert_get_fingerprint(ocert_tmp, -1);
             if (NULL == fingerprint)
                 break;
             cert_map = netsnmp_cert_map_alloc(NULL, ocert);
diff -urpN net-snmp-5.8/snmplib/snmp_parse_args.c net-snmp-5.9.1/snmplib/snmp_parse_args.c
--- net-snmp-5.8/snmplib/snmp_parse_args.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmp_parse_args.c	2021-05-26 05:19:35.000000000 +0700
@@ -201,7 +201,7 @@ netsnmp_parse_args(int argc,
                    void (*proc) (int, char *const *, int),
                    int flags)
 {
-    int             arg, sp = 0;
+    int             arg, ret, sp = 0;
     char           *cp;
     char           *Apsz = NULL;
     char           *Xpsz = NULL;
@@ -238,11 +238,13 @@ netsnmp_parse_args(int argc,
         switch (arg) {
         case '-':
             if (strcasecmp(optarg, "help") == 0) {
-                return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
+                ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+                goto out;
             }
             if (strcasecmp(optarg, "version") == 0) {
                 fprintf(stderr,"NET-SNMP version: %s\n",netsnmp_get_version());
-                return (NETSNMP_PARSE_ARGS_SUCCESS_EXIT);
+                ret = NETSNMP_PARSE_ARGS_SUCCESS_EXIT;
+                goto out;
             }
 
             handle_long_opt(optarg);
@@ -250,17 +252,19 @@ netsnmp_parse_args(int argc,
 
         case 'V':
             fprintf(stderr, "NET-SNMP version: %s\n", netsnmp_get_version());
-            return (NETSNMP_PARSE_ARGS_SUCCESS_EXIT);
+            ret = NETSNMP_PARSE_ARGS_SUCCESS_EXIT;
+            goto out;
 
         case 'h':
-            return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
-            break;
+            ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+            goto out;
 
         case 'H':
             init_snmp(NETSNMP_APPLICATION_CONFIG_TYPE);
             fprintf(stderr, "Configuration directives understood:\n");
             read_config_print_usage("  ");
-            return (NETSNMP_PARSE_ARGS_SUCCESS_EXIT);
+            ret = NETSNMP_PARSE_ARGS_SUCCESS_EXIT;
+            goto out;
 
         case 'Y':
             netsnmp_config_remember(optarg);
@@ -282,7 +286,8 @@ netsnmp_parse_args(int argc,
             if (cp != NULL) {
                 fprintf(stderr, "Unknown output option passed to -O: %c.\n", 
 			*cp);
-                return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
+                ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+                goto out;
             }
             break;
 
@@ -291,7 +296,8 @@ netsnmp_parse_args(int argc,
             if (cp != NULL) {
                 fprintf(stderr, "Unknown input option passed to -I: %c.\n",
 			*cp);
-                return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
+                ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+                goto out;
             }
             break;
 
@@ -301,7 +307,8 @@ netsnmp_parse_args(int argc,
             if (cp != NULL) {
                 fprintf(stderr,
                         "Unknown parsing option passed to -P: %c.\n", *cp);
-                return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
+                ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+                goto out;
             }
             break;
 #endif /* NETSNMP_DISABLE_MIB_LOADING */
@@ -309,7 +316,8 @@ netsnmp_parse_args(int argc,
         case 'D':
 #ifdef NETSNMP_NO_DEBUGGING
             fprintf(stderr, "Debug not configured in\n");
-            return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
+            ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+            goto out;
 #else
             debug_register_tokens(optarg);
             snmp_set_do_debugging(1);
@@ -344,15 +352,16 @@ netsnmp_parse_args(int argc,
                 fprintf(stderr,
                         "Invalid version specified after -v flag: %s\n",
                         optarg);
-                return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
+                ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+                goto out;
             }
             break;
 
         case 'p':
             fprintf(stderr, "Warning: -p option is no longer used - ");
             fprintf(stderr, "specify the remote host as HOST:PORT\n");
-            return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
-            break;
+            ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+            goto out;
 
         case 'T':
         {
@@ -365,7 +374,8 @@ netsnmp_parse_args(int argc,
             if (!tmpcp) {
                 fprintf(stderr, "-T expects a NAME=VALUE pair.\n");
                 free(tmpopt);
-                return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
+                ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+                goto out;
             }
             *tmpcp++ = '\0';
 
@@ -377,7 +387,8 @@ netsnmp_parse_args(int argc,
                 if (!session->transport_configuration) {
                     fprintf(stderr, "failed to initialize the transport configuration container\n");
                     free(tmpopt);
-                    return (NETSNMP_PARSE_ARGS_ERROR);
+                    ret = NETSNMP_PARSE_ARGS_ERROR;
+                    goto out;
                 }
 
                 session->transport_configuration->compare =
@@ -400,7 +411,8 @@ netsnmp_parse_args(int argc,
             session->timeout = (long)(atof(optarg) * 1000000L);
             if (session->timeout <= 0) {
                 fprintf(stderr, "Invalid timeout in seconds after -t flag.\n");
-                return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
+                ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+                goto out;
             }
             break;
 
@@ -408,7 +420,8 @@ netsnmp_parse_args(int argc,
             session->retries = atoi(optarg);
             if (session->retries < 0 || !isdigit((unsigned char)(optarg[0]))) {
                 fprintf(stderr, "Invalid number of retries after -r flag.\n");
-                return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
+                ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+                goto out;
             }
             break;
 
@@ -419,23 +432,26 @@ netsnmp_parse_args(int argc,
 		    memset(optarg, '\0', strlen(optarg));
 		} else {
 		    fprintf(stderr, "malloc failure processing -c flag.\n");
-		    return NETSNMP_PARSE_ARGS_ERROR;
+		    ret = NETSNMP_PARSE_ARGS_ERROR;
+                    goto out;
 		}
 	    } else {
-		Cpsz = optarg;
+		Cpsz = strdup(optarg);
 	    }
             break;
 
         case '3':
             if (snmpv3_parse_args(optarg, session, &Apsz, &Xpsz, argc, argv,
                                   flags) < 0){
-                return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
+                ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+                goto out;
             }
             break;
 
         case 'L':
             if (snmp_log_options(optarg, argc, argv) < 0) {
-                return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
+                ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+                goto out;
             }
             break;
 
@@ -455,14 +471,15 @@ netsnmp_parse_args(int argc,
 #endif             /* NETSNMP_SECMOD_USM */
             if (snmpv3_parse_arg(arg, optarg, session, &Apsz, &Xpsz, argc,
                                  argv, flags) < 0){
-                return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
+                ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+                goto out;
             }
             break;
 #endif                          /* SNMPV3_CMD_OPTIONS */
 
         case '?':
-            return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
-            break;
+            ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+            goto out;
 
         default:
             proc(argc, argv, arg);
@@ -567,9 +584,11 @@ netsnmp_parse_args(int argc,
             snmp_perror(argv[0]);
             fprintf(stderr,
                     "Error generating a key (Ku) from the supplied authentication pass phrase. \n");
-            return (NETSNMP_PARSE_ARGS_ERROR);
+            ret = NETSNMP_PARSE_ARGS_ERROR;
+            goto out;
         }
         free(Apsz);
+        Apsz = NULL;
     }
     if (Xpsz) {
         session->securityPrivKeyLen = USM_PRIV_KU_LEN;
@@ -596,9 +615,11 @@ netsnmp_parse_args(int argc,
             snmp_perror(argv[0]);
             fprintf(stderr,
                     "Error generating a key (Ku) from the supplied privacy pass phrase. \n");
-            return (NETSNMP_PARSE_ARGS_ERROR);
+            ret = NETSNMP_PARSE_ARGS_ERROR;
+            goto out;
         }
         free(Xpsz);
+        Xpsz = NULL;
     }
 #endif /* NETSNMP_SECMOD_USM */
 
@@ -607,7 +628,8 @@ netsnmp_parse_args(int argc,
      */
     if (optind == argc) {
         fprintf(stderr, "No hostname specified.\n");
-        return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
+        ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+        goto out;
     }
     session->peername = argv[optind++]; /* hostname */
 
@@ -641,17 +663,27 @@ netsnmp_parse_args(int argc,
                     session->community_len = 0;
                 } else {
                     fprintf(stderr, "No community name specified.\n");
-                    return (NETSNMP_PARSE_ARGS_ERROR_USAGE);
+                    ret = NETSNMP_PARSE_ARGS_ERROR_USAGE;
+                    goto out;
                 }
-	    }
+	    } else {
+                Cpsz = NULL;
+            }
 	} else {
             session->community = (unsigned char *)Cpsz;
             session->community_len = strlen(Cpsz);
+            Cpsz = NULL;
         }
     }
 #endif /* support for community based SNMP */
 
-    return optind;
+    ret = optind;
+
+out:
+    free(Apsz);
+    free(Xpsz);
+    free(Cpsz);
+    return ret;
 }
 
 int
diff -urpN net-snmp-5.8/snmplib/snmp_secmod.c net-snmp-5.9.1/snmplib/snmp_secmod.c
--- net-snmp-5.8/snmplib/snmp_secmod.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmp_secmod.c	2021-05-26 05:19:35.000000000 +0700
@@ -26,10 +26,6 @@
 #include <unistd.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 #include <net-snmp/config_api.h>
@@ -118,7 +114,7 @@ register_sec_mod(int secmod, const char
     return SNMPERR_SUCCESS;
 }
 
-netsnmp_feature_child_of(unregister_sec_mod, netsnmp_unused)
+netsnmp_feature_child_of(unregister_sec_mod, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_UNREGISTER_SEC_MOD
 int
 unregister_sec_mod(int secmod)
diff -urpN net-snmp-5.8/snmplib/snmp_syslog.h net-snmp-5.9.1/snmplib/snmp_syslog.h
--- net-snmp-5.8/snmplib/snmp_syslog.h	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmp_syslog.h	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,46 @@
+#ifndef _SNMP_SYSLOG_H_
+#define _SNMP_SYSLOG_H_
+
+/*
+ * These definitions handle 4.2 systems without additional syslog facilities.
+ */
+#ifndef NETSNMP_FEATURE_REMOVE_LOGGING_SYSLOG
+#ifndef LOG_CONS
+#define LOG_CONS	0       /* Don't bother if not defined... */
+#endif
+#ifndef LOG_PID
+#define LOG_PID		0       /* Don't bother if not defined... */
+#endif
+#ifndef LOG_LOCAL0
+#define LOG_LOCAL0	0
+#endif
+#ifndef LOG_LOCAL1
+#define LOG_LOCAL1	0
+#endif
+#ifndef LOG_LOCAL2
+#define LOG_LOCAL2	0
+#endif
+#ifndef LOG_LOCAL3
+#define LOG_LOCAL3	0
+#endif
+#ifndef LOG_LOCAL4
+#define LOG_LOCAL4	0
+#endif
+#ifndef LOG_LOCAL5
+#define LOG_LOCAL5	0
+#endif
+#ifndef LOG_LOCAL6
+#define LOG_LOCAL6	0
+#endif
+#ifndef LOG_LOCAL7
+#define LOG_LOCAL7	0
+#endif
+#ifndef LOG_DAEMON
+#define LOG_DAEMON	0
+#endif
+#ifndef LOG_USER
+#define LOG_USER	0
+#endif
+#endif /* NETSNMP_FEATURE_REMOVE_LOGGING_SYSLOG */
+
+#endif /* _SNMP_SYSLOG_H_ */
diff -urpN net-snmp-5.8/snmplib/snmp_transport.c net-snmp-5.9.1/snmplib/snmp_transport.c
--- net-snmp-5.8/snmplib/snmp_transport.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmp_transport.c	2021-05-26 05:19:35.000000000 +0700
@@ -27,9 +27,6 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 
 #include <net-snmp/output_api.h>
 #include <net-snmp/utilities.h>
@@ -80,12 +77,12 @@
 #include <net-snmp/library/snmp_service.h>
 #include <net-snmp/library/read_config.h>
 
-netsnmp_feature_child_of(transport_all, libnetsnmp)
+netsnmp_feature_child_of(transport_all, libnetsnmp);
 
-netsnmp_feature_child_of(tdomain_support, transport_all)
-netsnmp_feature_child_of(tdomain_transport_oid, transport_all)
-netsnmp_feature_child_of(sockaddr_size, transport_all)
-netsnmp_feature_child_of(transport_cache, transport_all)
+netsnmp_feature_child_of(tdomain_support, transport_all);
+netsnmp_feature_child_of(tdomain_transport_oid, transport_all);
+netsnmp_feature_child_of(sockaddr_size, transport_all);
+netsnmp_feature_child_of(transport_cache, transport_all);
 
 /*
  * Our list of supported transport domains.  
@@ -132,7 +129,7 @@ init_snmp_transport(void)
 #ifndef NETSNMP_FEATURE_REMOVE_FILTER_SOURCE
     register_app_config_handler("sourceFilterType",
                                 netsnmp_transport_parse_filterType,
-                                NULL, "none|whitelist|blacklist");
+                                NULL, "none|acceptlist|blocklist");
     register_app_config_handler("sourceFilterAddress",
                                 netsnmp_transport_parse_filter,
                                 netsnmp_transport_filter_cleanup,
@@ -341,11 +338,17 @@ void
 netsnmp_transport_parse_filterType(const char *word, char *cptr)
 {
     int type = 42;
-    if (strcmp(cptr,"whitelist") == 0)
+    if (strcmp(cptr,"acceptlist") == 0)
+        type = 1;
+    else if (strcmp(cptr,"whitelist") == 0) {
+	netsnmp_config_warn("Deprecated configuration term found -- Please use 'acceptlist' instead");
         type = 1;
-    else if (strcmp(cptr,"blacklist") == 0)
+    } else if (strcmp(cptr,"blocklist") == 0)
+        type = -1;
+    else if (strcmp(cptr,"blacklist") == 0) {
+	netsnmp_config_warn("Deprecated configuration term found -- Please use 'blocklist' instead");
         type = -1;
-    else if (strcmp(cptr,"none") == 0)
+    } else if (strcmp(cptr,"none") == 0)
         type = 0;
     else
         netsnmp_config_error("unknown source filter type: %s", cptr);
@@ -565,7 +568,7 @@ netsnmp_tdomain_register(netsnmp_tdomain
 
 
 
-netsnmp_feature_child_of(tdomain_unregister, netsnmp_unused)
+netsnmp_feature_child_of(tdomain_unregister, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_TDOMAIN_UNREGISTER
 int
 netsnmp_tdomain_unregister(netsnmp_tdomain *n)
@@ -876,6 +879,11 @@ netsnmp_tdomain_transport(const char *st
 }
 
 #ifndef NETSNMP_FEATURE_REMOVE_TDOMAIN_TRANSPORT_OID
+/*
+ * The format of @dom and @o follows the TDomain and TAddress textual
+ * conventions from RFC 2579. For the actual TAddress format definitions,
+ * see e.g. SnmpUDPAddress in RFC 1906.
+ */
 netsnmp_transport *
 netsnmp_tdomain_transport_oid(const oid * dom,
                               size_t dom_len,
@@ -974,7 +982,8 @@ netsnmp_transport_config_compare(netsnmp
 }
 
 netsnmp_transport_config *
-netsnmp_transport_create_config(char *key, char *value) {
+netsnmp_transport_create_config(const char *key, const char *value)
+{
     netsnmp_transport_config *entry =
         SNMP_MALLOC_TYPEDEF(netsnmp_transport_config);
     entry->key = strdup(key);
diff -urpN net-snmp-5.8/snmplib/snmpksm.c net-snmp-5.9.1/snmplib/snmpksm.c
--- net-snmp-5.8/snmplib/snmpksm.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmpksm.c	2021-05-26 05:19:35.000000000 +0700
@@ -34,10 +34,6 @@
 #include <errno.h>
 
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #ifdef NETSNMP_USE_KERBEROS_HEIMDAL
 #ifndef NETSNMP_USE_KERBEROS_MIT
 #define OLD_HEIMDAL
@@ -70,6 +66,8 @@
 #include <et/com_err.h>
 #elif HAVE_COM_ERR_H
 #include <com_err.h>
+#else
+static const char *error_message(int ret) { return "(?)"; }
 #endif
 
 #include <net-snmp/output_api.h>
@@ -483,7 +481,10 @@ ksm_rgenerate_out_msg(struct snmp_secmod
 #else                           /* NETSNMP_USE_KERBEROS_MIT */
     krb5_encrypt_block eblock;
 #endif                          /* NETSNMP_USE_KERBEROS_MIT */
-    size_t          blocksize, encrypted_length;
+#ifndef OLD_HEIMDAL
+    size_t          blocksize;
+#endif
+    size_t          encrypted_length;
     unsigned char  *encrypted_data = NULL;
     long            zero = 0, tmp;
     int             i;
@@ -1246,7 +1247,10 @@ ksm_process_in_msg(struct snmp_secmod_in
     size_t          length =
         parms->wholeMsgLen - (u_int) (parms->secParams - parms->wholeMsg);
     u_char         *current = parms->secParams, type;
-    size_t          cksumlength, blocksize;
+#ifndef OLD_HEIMDAL
+    size_t          blocksize;
+#endif
+    size_t          cksumlength;
     long            hint;
     char           *cname;
     struct ksm_secStateRef *ksm_state;
@@ -1766,7 +1770,7 @@ ksm_process_in_msg(struct snmp_secmod_in
 	retcode = krb5_decrypt(kcontext, heim_crypto, KSM_KEY_USAGE_ENCRYPTION,
 			       current, length, &output);
 	if (retcode == 0) {
-		*parms->scopedPdu = (char *) output.data;
+		*parms->scopedPdu = (u_char *) output.data;
 		*parms->scopedPduLen = output.length;
 		krb5_data_zero(&output);
 	}
diff -urpN net-snmp-5.8/snmplib/snmptsm.c net-snmp-5.9.1/snmplib/snmptsm.c
--- net-snmp-5.8/snmplib/snmptsm.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmptsm.c	2021-05-26 05:19:35.000000000 +0700
@@ -27,8 +27,8 @@
 #include <net-snmp/library/snmpDTLSSCTPDomain.h>
 #endif
 
-netsnmp_feature_require(snmpv3_probe_contextEngineID_rfc5343)
-netsnmp_feature_require(row_create)
+netsnmp_feature_require(snmpv3_probe_contextEngineID_rfc5343);
+netsnmp_feature_require(row_create);
 
 static int      tsm_session_init(netsnmp_session *);
 static void     tsm_free_state_ref(void *);
@@ -346,7 +346,7 @@ tsm_rgenerate_out_msg(struct snmp_secmod
        and tmStateReference are returned to the calling Message
        Processing Model with the statusInformation set to success. */
 
-    /* For the Net-SNMP implemantion that actually means we start
+    /* For the Net-SNMP implementation that actually means we start
        encoding the full packet sequence from here before returning it */
 
     /*
diff -urpN net-snmp-5.8/snmplib/snmpusm.c net-snmp-5.9.1/snmplib/snmpusm.c
--- net-snmp-5.8/snmplib/snmpusm.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmpusm.c	2021-05-26 05:19:35.000000000 +0700
@@ -56,9 +56,6 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
@@ -79,10 +76,27 @@
 #include <net-snmp/library/transform_oids.h>
 #include <net-snmp/library/snmp_enum.h>
 
-netsnmp_feature_child_of(usm_all, libnetsnmp)
-netsnmp_feature_child_of(usm_support, usm_all)
+netsnmp_feature_child_of(usm_all, libnetsnmp);
+netsnmp_feature_child_of(usm_support, usm_all);
+
+netsnmp_feature_require(usm_support);
 
-netsnmp_feature_require(usm_support)
+struct usmStateReference {
+    int             refcnt;
+    char           *usr_name;
+    size_t          usr_name_length;
+    u_char         *usr_engine_id;
+    size_t          usr_engine_id_length;
+    oid            *usr_auth_protocol;
+    size_t          usr_auth_protocol_length;
+    u_char         *usr_auth_key;
+    size_t          usr_auth_key_length;
+    oid            *usr_priv_protocol;
+    size_t          usr_priv_protocol_length;
+    u_char         *usr_priv_key;
+    size_t          usr_priv_key_length;
+    u_int           usr_sec_level;
+};
 
 oid    usmNoAuthProtocol[10] = { NETSNMP_USMAUTH_BASE_OID,
                                  NETSNMP_USMAUTH_NOAUTH };
@@ -139,7 +153,7 @@ typedef struct usm_alg_type_s {
     int         value;
 } usm_alg_type_t;
 
-static usm_alg_type_t usm_auth_type[] = {
+static const usm_alg_type_t usm_auth_type[] = {
     { "NOAUTH", NETSNMP_USMAUTH_NOAUTH },
     { "SHA", NETSNMP_USMAUTH_HMACSHA1 },
     { "SHA-1", NETSNMP_USMAUTH_HMACSHA1 },
@@ -162,7 +176,7 @@ static usm_alg_type_t usm_auth_type[] =
     { NULL, -1 }
 };
 
-static usm_alg_type_t usm_priv_type[] = {
+static const usm_alg_type_t usm_priv_type[] = {
     { "NOPRIV", USM_CREATE_USER_PRIV_NONE },
 #ifndef NETSNMP_DISABLE_DES
     { "DES", USM_CREATE_USER_PRIV_DES },
@@ -216,27 +230,6 @@ static struct usmUser *noNameUser = NULL
 static struct usmUser *userList = NULL;
 
 /*
- * Prototypes
- */
-int
-                usm_check_secLevel_vs_protocols(int level,
-                                                const oid * authProtocol,
-                                                u_int authProtocolLen,
-                                                const oid * privProtocol,
-                                                u_int privProtocolLen);
-int
-                usm_calc_offsets(size_t globalDataLen,
-                                 int secLevel, size_t secEngineIDLen,
-                                 size_t secNameLen, size_t scopedPduLen,
-                                 u_long engineboots, long engine_time,
-                                 size_t * theTotalLength,
-                                 size_t * authParamsOffset,
-                                 size_t * privParamsOffset,
-                                 size_t * dataOffset, size_t * datalen,
-                                 size_t * msgAuthParmLen,
-                                 size_t * msgPrivParmLen, size_t * otstlen,
-                                 size_t * seq_len, size_t * msgSecParmLen);
-/*
  * Set a given field of the secStateRef.
  *
  * Allocate <len> bytes for type <type> pointed to by ref-><field>.
@@ -244,30 +237,30 @@ int
  *
  * Return 0 on success, -1 otherwise.
  */
-#define MAKE_ENTRY( type, item, len, field, field_len )			\
-{									\
-	if (ref == NULL)						\
-		return -1;						\
-	if (ref->field != NULL)	{					\
-		SNMP_ZERO(ref->field, ref->field_len);			\
-		SNMP_FREE(ref->field);					\
-	}								\
-	ref->field_len = 0;						\
-        if (len == 0 || item == NULL) {					\
-		return 0;						\
-	}					 			\
-	if ((ref->field = (type*) malloc (len * sizeof(type))) == NULL)	\
-	{								\
-		return -1;						\
-	}								\
-									\
-	memcpy (ref->field, item, len * sizeof(type));			\
-	ref->field_len = len;						\
-									\
-	return 0;							\
-}
+#define MAKE_ENTRY(ref, type, item, len, field, field_len)      \
+do {                                                            \
+	if (ref == NULL)                                        \
+		return -1;                                      \
+	if (ref->field != NULL)	{                               \
+		SNMP_ZERO(ref->field, ref->field_len);          \
+		SNMP_FREE(ref->field);                          \
+	}                                                       \
+	ref->field_len = 0;                                     \
+        if (len == 0 || item == NULL)                           \
+		return 0;                                       \
+	ref->field = netsnmp_memdup(item, len * sizeof(type));  \
+        if (ref->field == NULL)                                 \
+		return -1;                                      \
+                                                                \
+	ref->field_len = len;                                   \
+	return 0;                                               \
+} while (0)
 
-int
+static int
+usm_clone_usmStateReference(struct usmStateReference *from,
+                            struct usmStateReference **to);
+
+static int
 free_enginetime_on_shutdown(int majorid, int minorid, void *serverarg,
 			    void *clientarg)
 {
@@ -282,42 +275,66 @@ free_enginetime_on_shutdown(int majorid,
     return 0;
 }
 
-struct usmStateReference *
+static struct usmStateReference *
 usm_malloc_usmStateReference(void)
 {
-    struct usmStateReference *retval = (struct usmStateReference *)
-        calloc(1, sizeof(struct usmStateReference));
+    struct usmStateReference *retval;
+
+    retval = calloc(1, sizeof(struct usmStateReference));
+    if (retval)
+        retval->refcnt = 1;
 
     return retval;
 }                               /* end usm_malloc_usmStateReference() */
 
+static int
+usm_clone(netsnmp_pdu *pdu, netsnmp_pdu *new_pdu)
+{
+    struct usmStateReference *ref = pdu->securityStateRef;
+    struct usmStateReference **new_ref =
+        (struct usmStateReference **)&new_pdu->securityStateRef;
+    int ret = 0;
+
+    if (!ref)
+        return ret;
+
+    if (pdu->command == SNMP_MSG_TRAP2) {
+        netsnmp_assert(pdu->securityModel == SNMP_DEFAULT_SECMODEL);
+        ret = usm_clone_usmStateReference(ref, new_ref);
+    } else {
+        netsnmp_assert(ref == *new_ref);
+        ref->refcnt++;
+    }
 
-void
+    return ret;
+}
+
+static void
 usm_free_usmStateReference(void *old)
 {
-    struct usmStateReference *old_ref = (struct usmStateReference *) old;
-
-    if (old_ref) {
+    struct usmStateReference *ref = old;
 
-        SNMP_FREE(old_ref->usr_name);
-        SNMP_FREE(old_ref->usr_engine_id);
-        SNMP_FREE(old_ref->usr_auth_protocol);
-        SNMP_FREE(old_ref->usr_priv_protocol);
+    if (!ref)
+        return;
 
-        if (old_ref->usr_auth_key) {
-            SNMP_ZERO(old_ref->usr_auth_key, old_ref->usr_auth_key_length);
-            SNMP_FREE(old_ref->usr_auth_key);
-        }
-        if (old_ref->usr_priv_key) {
-            SNMP_ZERO(old_ref->usr_priv_key, old_ref->usr_priv_key_length);
-            SNMP_FREE(old_ref->usr_priv_key);
-        }
+    if (--ref->refcnt > 0)
+        return;
 
-        SNMP_ZERO(old_ref, sizeof(*old_ref));
-        SNMP_FREE(old_ref);
+    SNMP_FREE(ref->usr_name);
+    SNMP_FREE(ref->usr_engine_id);
+    SNMP_FREE(ref->usr_auth_protocol);
+    SNMP_FREE(ref->usr_priv_protocol);
 
+    if (ref->usr_auth_key_length && ref->usr_auth_key) {
+        SNMP_ZERO(ref->usr_auth_key, ref->usr_auth_key_length);
+        SNMP_FREE(ref->usr_auth_key);
+    }
+    if (ref->usr_priv_key_length && ref->usr_priv_key) {
+        SNMP_ZERO(ref->usr_priv_key, ref->usr_priv_key_length);
+        SNMP_FREE(ref->usr_priv_key);
     }
 
+    SNMP_FREE(ref);
 }                               /* end usm_free_usmStateReference() */
 
 struct usmUser *
@@ -326,57 +343,57 @@ usm_get_userList(void)
     return userList;
 }
 
-int
+static int
 usm_set_usmStateReference_name(struct usmStateReference *ref,
                                char *name, size_t name_len)
 {
-    MAKE_ENTRY(char, name, name_len, usr_name, usr_name_length);
+    MAKE_ENTRY(ref, char, name, name_len, usr_name, usr_name_length);
 }
 
-int
+static int
 usm_set_usmStateReference_engine_id(struct usmStateReference *ref,
                                     u_char * engine_id,
                                     size_t engine_id_len)
 {
-    MAKE_ENTRY(u_char, engine_id, engine_id_len,
+    MAKE_ENTRY(ref, u_char, engine_id, engine_id_len,
                usr_engine_id, usr_engine_id_length);
 }
 
-int
+static int
 usm_set_usmStateReference_auth_protocol(struct usmStateReference *ref,
                                         oid * auth_protocol,
                                         size_t auth_protocol_len)
 {
-    MAKE_ENTRY(oid, auth_protocol, auth_protocol_len,
+    MAKE_ENTRY(ref, oid, auth_protocol, auth_protocol_len,
                usr_auth_protocol, usr_auth_protocol_length);
 }
 
-int
+static int
 usm_set_usmStateReference_auth_key(struct usmStateReference *ref,
                                    u_char * auth_key, size_t auth_key_len)
 {
-    MAKE_ENTRY(u_char, auth_key, auth_key_len,
+    MAKE_ENTRY(ref, u_char, auth_key, auth_key_len,
                usr_auth_key, usr_auth_key_length);
 }
 
-int
+static int
 usm_set_usmStateReference_priv_protocol(struct usmStateReference *ref,
                                         oid * priv_protocol,
                                         size_t priv_protocol_len)
 {
-    MAKE_ENTRY(oid, priv_protocol, priv_protocol_len,
+    MAKE_ENTRY(ref, oid, priv_protocol, priv_protocol_len,
                usr_priv_protocol, usr_priv_protocol_length);
 }
 
-int
+static int
 usm_set_usmStateReference_priv_key(struct usmStateReference *ref,
                                    u_char * priv_key, size_t priv_key_len)
 {
-    MAKE_ENTRY(u_char, priv_key, priv_key_len,
+    MAKE_ENTRY(ref, u_char, priv_key, priv_key_len,
                usr_priv_key, usr_priv_key_length);
 }
 
-int
+static int
 usm_set_usmStateReference_sec_level(struct usmStateReference *ref,
                                     int sec_level)
 {
@@ -386,8 +403,9 @@ usm_set_usmStateReference_sec_level(stru
     return 0;
 }
 
-int
-usm_clone_usmStateReference(struct usmStateReference *from, struct usmStateReference **to)
+static int
+usm_clone_usmStateReference(struct usmStateReference *from,
+                            struct usmStateReference **to)
 {
     struct usmStateReference *cloned_usmStateRef;
 
@@ -450,6 +468,322 @@ emergency_print(u_char * field, u_int le
 }                               /* end emergency_print() */
 #endif                          /* NETSNMP_ENABLE_TESTING_CODE */
 
+static struct usmUser *
+usm_get_user_from_list(const u_char *engineID, size_t engineIDLen,
+                       const char *name, struct usmUser *puserList,
+                       int use_default)
+{
+    struct usmUser *ptr;
+
+    if (name == NULL)
+        name = "";
+    for (ptr = puserList; ptr != NULL; ptr = ptr->next) {
+        if (ptr->name && !strcmp(ptr->name, name)) {
+          DEBUGMSGTL(("usm", "match on user %s\n", ptr->name));
+          if (ptr->engineIDLen == engineIDLen &&
+            ((ptr->engineID == NULL && engineID == NULL) ||
+             (ptr->engineID != NULL && engineID != NULL &&
+              memcmp(ptr->engineID, engineID, engineIDLen) == 0)))
+            return ptr;
+          DEBUGMSGTL(("usm", "no match on engineID ("));
+          if (engineID) {
+              DEBUGMSGHEX(("usm", engineID, engineIDLen));
+          } else {
+              DEBUGMSGTL(("usm", "Empty EngineID"));
+          }
+          DEBUGMSG(("usm", ")\n"));
+        }
+    }
+
+    /*
+     * return "" user used to facilitate engineID discovery
+     */
+    if (use_default && !strcmp(name, ""))
+        return noNameUser;
+    return NULL;
+}
+
+/*
+ * usm_get_user(): Returns a user from userList based on the engineID,
+ * engineIDLen and name of the requested user.
+ */
+struct usmUser *
+usm_get_user(const u_char *engineID, size_t engineIDLen, const char *name)
+{
+    DEBUGMSGTL(("usm", "getting user %s\n", name));
+    return usm_get_user_from_list(engineID, engineIDLen, name, userList,
+                                  1);
+}
+
+static struct usmUser *
+usm_add_user_to_list(struct usmUser *user, struct usmUser *puserList)
+{
+    struct usmUser *nptr, *pptr, *optr;
+
+    /*
+     * loop through puserList till we find the proper, sorted place to
+     * insert the new user
+     */
+    /* XXX - how to handle a NULL user->name ?? */
+    /* XXX - similarly for a NULL nptr->name ?? */
+    for (nptr = puserList, pptr = NULL; nptr != NULL;
+         pptr = nptr, nptr = nptr->next) {
+        if (nptr->engineIDLen > user->engineIDLen)
+            break;
+
+        if (user->engineID == NULL && nptr->engineID != NULL)
+            break;
+
+        if (nptr->engineIDLen == user->engineIDLen &&
+            (nptr->engineID != NULL && user->engineID != NULL &&
+             memcmp(nptr->engineID, user->engineID,
+                    user->engineIDLen) > 0))
+            break;
+
+        if (!(nptr->engineID == NULL && user->engineID != NULL)) {
+            if (nptr->engineIDLen == user->engineIDLen &&
+                ((nptr->engineID == NULL && user->engineID == NULL) ||
+                 memcmp(nptr->engineID, user->engineID,
+                        user->engineIDLen) == 0)
+                && strlen(nptr->name) > strlen(user->name))
+                break;
+
+            if (nptr->engineIDLen == user->engineIDLen &&
+                ((nptr->engineID == NULL && user->engineID == NULL) ||
+                 memcmp(nptr->engineID, user->engineID,
+                        user->engineIDLen) == 0)
+                && strlen(nptr->name) == strlen(user->name)
+                && strcmp(nptr->name, user->name) > 0)
+                break;
+
+            if (nptr->engineIDLen == user->engineIDLen &&
+                ((nptr->engineID == NULL && user->engineID == NULL) ||
+                 memcmp(nptr->engineID, user->engineID,
+                        user->engineIDLen) == 0)
+                && strlen(nptr->name) == strlen(user->name)
+                && strcmp(nptr->name, user->name) == 0) {
+                /*
+                 * the user is an exact match of a previous entry.
+                 * Credentials may be different, though, so remove
+                 * the old entry (and add the new one)!
+                 */
+                if (pptr) { /* change prev's next pointer */
+                  pptr->next = nptr->next;
+                }
+                if (nptr->next) { /* change next's prev pointer */
+                  nptr->next->prev = pptr;
+                }
+                optr = nptr;
+                nptr = optr->next; /* add new user at this position */
+                /* free the old user */
+                optr->next=NULL;
+                optr->prev=NULL;
+                usm_free_user(optr);
+                break; /* new user will be added below */
+            }
+        }
+    }
+
+    /*
+     * nptr should now point to the user that we need to add ourselves
+     * in front of, and pptr should be our new 'prev'.
+     */
+
+    /*
+     * change our pointers
+     */
+    user->prev = pptr;
+    user->next = nptr;
+
+    /*
+     * change the next's prev pointer
+     */
+    if (user->next)
+        user->next->prev = user;
+
+    /*
+     * change the prev's next pointer
+     */
+    if (user->prev)
+        user->prev->next = user;
+
+    /*
+     * rewind to the head of the list and return it (since the new head
+     * could be us, we need to notify the above routine who the head now is.
+     */
+    for (pptr = user; pptr->prev != NULL; pptr = pptr->prev);
+    return pptr;
+}
+
+/*
+ * usm_add_user(): Add's a user to the userList, sorted by the
+ * engineIDLength then the engineID then the name length then the name
+ * to facilitate getNext calls on a usmUser table which is indexed by
+ * these values.
+ *
+ * returns the head of the list (which could change due to this add).
+ */
+
+struct usmUser *
+usm_add_user(struct usmUser *user)
+{
+    struct usmUser *uptr;
+    uptr = usm_add_user_to_list(user, userList);
+    if (uptr != NULL)
+        userList = uptr;
+    return uptr;
+}
+
+/*
+ * usm_remove_usmUser_from_list remove user from (optional) list
+ *
+ * if list is not specified, defaults to global userList.
+ *
+ * returns SNMPERR_SUCCESS or SNMPERR_USM_UNKNOWNSECURITYNAME
+ */
+static int
+usm_remove_usmUser_from_list(struct usmUser *user, struct usmUser **ppuserList)
+{
+    struct usmUser *nptr, *pptr;
+
+    /*
+     * NULL pointers aren't allowed
+     */
+    if (ppuserList == NULL)
+        ppuserList = &userList;
+
+    if (*ppuserList == NULL)
+        return SNMPERR_USM_UNKNOWNSECURITYNAME;
+
+    /*
+     * find the user in the list
+     */
+    for (nptr = *ppuserList, pptr = NULL; nptr != NULL;
+         pptr = nptr, nptr = nptr->next) {
+        if (nptr == user)
+            break;
+    }
+
+    if (nptr) {
+        /*
+         * remove the user from the linked list
+         */
+        if (pptr) {
+            pptr->next = nptr->next;
+        }
+        if (nptr->next) {
+            nptr->next->prev = pptr;
+        }
+    } else {
+        /*
+         * user didn't exist
+         */
+        return SNMPERR_USM_UNKNOWNSECURITYNAME;
+    }
+    if (nptr == *ppuserList)    /* we're the head of the list, need to change
+                                 * * the head to the next user */
+        *ppuserList = nptr->next;
+    return SNMPERR_SUCCESS;
+}                               /* end usm_remove_usmUser_from_list() */
+
+/*
+ * usm_remove_user_from_list
+ *
+ * removes user from list.
+ *
+ * returns new list head on success, or NULL on error.
+ *
+ * NOTE: if there was only one user in the list, list head will be NULL.
+ *       So NULL can also mean success. Use the newer usm_remove_usmUser() for
+ *       more specific return codes. This function is kept for backwards
+ *       compatability with this ambiguous behaviour.
+ */
+static struct usmUser *
+usm_remove_user_from_list(struct usmUser *user,
+                          struct usmUser **ppuserList)
+{
+    int rc = usm_remove_usmUser_from_list(user, ppuserList);
+    if (rc != SNMPERR_SUCCESS || NULL == ppuserList)
+        return NULL;
+
+    return *ppuserList;
+}                               /* end usm_remove_user_from_list() */
+
+/*
+ * usm_remove_user(): finds and removes a user from a list
+ */
+struct usmUser *
+usm_remove_user(struct usmUser *user)
+{
+    return usm_remove_user_from_list(user, &userList);
+}
+
+/*
+ * usm_free_user():  calls free() on all needed parts of struct usmUser and
+ * the user himself.
+ *
+ * Note: This should *not* be called on an object in a list (IE,
+ * remove it from the list first, and set next and prev to NULL), but
+ * will try to reconnect the list pieces again if it is called this
+ * way.  If called on the head of the list, the entire list will be
+ * lost.
+ */
+struct usmUser *
+usm_free_user(struct usmUser *user)
+{
+    if (user == NULL)
+        return NULL;
+
+    SNMP_FREE(user->engineID);
+    SNMP_FREE(user->name);
+    SNMP_FREE(user->secName);
+    SNMP_FREE(user->cloneFrom);
+    SNMP_FREE(user->userPublicString);
+    SNMP_FREE(user->authProtocol);
+    SNMP_FREE(user->privProtocol);
+
+    if (user->authKey != NULL) {
+        SNMP_ZERO(user->authKey, user->authKeyLen);
+        SNMP_FREE(user->authKey);
+    }
+
+    if (user->privKey != NULL) {
+        SNMP_ZERO(user->privKey, user->privKeyLen);
+        SNMP_FREE(user->privKey);
+    }
+
+    if (user->authKeyKu != NULL) {
+        SNMP_ZERO(user->authKeyKu, user->authKeyKuLen);
+        SNMP_FREE(user->authKeyKu);
+    }
+
+    if (user->privKeyKu != NULL) {
+        SNMP_ZERO(user->privKeyKu, user->privKeyKuLen);
+        SNMP_FREE(user->privKeyKu);
+    }
+
+
+    /*
+     * FIX  Why not put this check *first?*
+     */
+    if (user->prev != NULL) {   /* ack, this shouldn't happen */
+        user->prev->next = user->next;
+    }
+    if (user->next != NULL) {
+        user->next->prev = user->prev;
+        if (user->prev != NULL) /* ack this is really bad, because it means
+                                 * * we'll loose the head of some structure tree */
+            DEBUGMSGTL(("usm",
+                        "Severe: Asked to free the head of a usmUser tree somewhere."));
+    }
+
+
+    SNMP_ZERO(user, sizeof(*user));
+    SNMP_FREE(user);
+
+    return NULL;                /* for convenience to returns from calling functions */
+
+}                               /* end usm_free_user() */
 
 /*******************************************************************-o-******
  * asn_predict_int_length
@@ -470,7 +804,7 @@ emergency_print(u_char * field, u_int le
  *
  *	Do this the same way as asn_build_int()...
  */
-int
+static int
 asn_predict_int_length(int type, long number, size_t len)
 {
     register u_long mask;
@@ -494,9 +828,6 @@ asn_predict_int_length(int type, long nu
 
 }                               /* end asn_predict_length() */
 
-
-
-
 /*******************************************************************-o-******
  * asn_predict_length
  *
@@ -518,7 +849,7 @@ asn_predict_int_length(int type, long nu
  *
  * XXX	How is <n> chosen, exactly??
  */
-int
+static int
 asn_predict_length(int type, u_char * ptr, size_t u_char_len)
 {
 
@@ -540,9 +871,6 @@ asn_predict_length(int type, u_char * pt
 
 }                               /* end asn_predict_length() */
 
-
-
-
 /*******************************************************************-o-******
  * usm_calc_offsets
  *
@@ -598,7 +926,7 @@ asn_predict_length(int type, u_char * pt
  *	[11] = theTotalLength - the length of the header itself
  *	[12] = theTotalLength
  */
-int
+static int
 usm_calc_offsets(size_t globalDataLen,  /* SNMPv3Message + HeaderData */
                  int secLevel, size_t secEngineIDLen, size_t secNameLen, size_t scopedPduLen,   /* An BER encoded sequence. */
                  u_long engineboots,    /* XXX (asn1.c works in long, not int.) */
@@ -720,10 +1048,6 @@ usm_calc_offsets(size_t globalDataLen,
 
 }                               /* end usm_calc_offsets() */
 
-
-
-
-
 #ifndef NETSNMP_DISABLE_DES
 /*******************************************************************-o-******
  * usm_set_salt
@@ -750,7 +1074,7 @@ usm_calc_offsets(size_t globalDataLen,
  *		portion of the private key (last 8 bytes).
  *	The IV result is returned individually for further use.
  */
-int
+static int
 usm_set_salt(u_char * iv,
              size_t * iv_length,
              u_char * priv_salt, size_t priv_salt_length, u_char * msgSalt)
@@ -822,7 +1146,7 @@ usm_set_salt(u_char * iv,
  *	The resulting salt is copied into the salt buffer.
  *	The IV result is returned individually for further use.
  */
-int
+static int
 usm_set_aes_iv(u_char * iv,
                size_t * iv_length,
                u_int net_boots,
@@ -856,26 +1180,65 @@ usm_set_aes_iv(u_char * iv,
 
     memcpy(salt, iv+8, 8); /* only copy the needed portion */
     return 0;
-}                               /* end usm_set_salt() */
+}                               /* end usm_set_aes_iv() */
 #endif /* HAVE_AES */
 
-int
-usm_secmod_generate_out_msg(struct snmp_secmod_outgoing_params *parms)
+/*******************************************************************-o-******
+ * usm_check_secLevel_vs_protocols
+ *
+ * Parameters:
+ *	 level
+ *	*authProtocol
+ *	 authProtocolLen
+ *	*privProtocol
+ *	 privProtocolLen
+ *
+ * Returns:
+ *	0	On success,
+ *	1	Otherwise.
+ *
+ * Same as above but with explicitly named transform types instead of taking
+ * from the usmUser structure.
+ */
+static int
+usm_check_secLevel_vs_protocols(int level,
+                                const oid * authProtocol,
+                                u_int authProtocolLen,
+                                const oid * privProtocol,
+                                u_int privProtocolLen)
 {
-    if (!parms)
-        return SNMPERR_GENERR;
 
-    return usm_generate_out_msg(parms->msgProcModel,
-                                parms->globalData, parms->globalDataLen,
-                                parms->maxMsgSize, parms->secModel,
-                                parms->secEngineID, parms->secEngineIDLen,
-                                parms->secName, parms->secNameLen,
-                                parms->secLevel,
-                                parms->scopedPdu, parms->scopedPduLen,
-                                parms->secStateRef,
-                                parms->secParams, parms->secParamsLen,
-                                parms->wholeMsg, parms->wholeMsgLen);
-}
+    if (level == SNMP_SEC_LEVEL_AUTHPRIV
+        &&
+        (netsnmp_oid_equals
+         (privProtocol, privProtocolLen, usmNoPrivProtocol,
+          sizeof(usmNoPrivProtocol) / sizeof(oid)) == 0)) {
+        DEBUGMSGTL(("usm", "Level: %d\n", level));
+        DEBUGMSGTL(("usm", "Auth Protocol: "));
+        DEBUGMSGOID(("usm", authProtocol, authProtocolLen));
+        DEBUGMSG(("usm", ", Priv Protocol: "));
+        DEBUGMSGOID(("usm", privProtocol, privProtocolLen));
+        DEBUGMSG(("usm", "\n"));
+        return 1;
+    }
+    if ((level == SNMP_SEC_LEVEL_AUTHPRIV
+         || level == SNMP_SEC_LEVEL_AUTHNOPRIV)
+        &&
+        (netsnmp_oid_equals
+         (authProtocol, authProtocolLen, usmNoAuthProtocol,
+          sizeof(usmNoAuthProtocol) / sizeof(oid)) == 0)) {
+        DEBUGMSGTL(("usm", "Level: %d\n", level));
+        DEBUGMSGTL(("usm", "Auth Protocol: "));
+        DEBUGMSGOID(("usm", authProtocol, authProtocolLen));
+        DEBUGMSG(("usm", ", Priv Protocol: "));
+        DEBUGMSGOID(("usm", privProtocol, privProtocolLen));
+        DEBUGMSG(("usm", "\n"));
+        return 1;
+    }
+
+    return 0;
+
+}                               /* end usm_check_secLevel_vs_protocols() */
 
 /*******************************************************************-o-******
  * usm_generate_out_msg
@@ -897,7 +1260,7 @@ usm_secmod_generate_out_msg(struct snmp_
  *
  * XXX	Beware of misnomers!
  */
-int
+static int
 usm_generate_out_msg(int msgProcModel,  /* (UNUSED) */
                      u_char * globalData,       /* IN */
                      /*
@@ -916,12 +1279,12 @@ usm_generate_out_msg(int msgProcModel,
                      size_t globalDataLen,      /* IN - Length of msg header data.      */
                      int maxMsgSize,    /* (UNUSED) */
                      int secModel,      /* (UNUSED) */
-                     u_char * secEngineID,      /* IN - Pointer snmpEngineID.           */
-                     size_t secEngineIDLen,     /* IN - SnmpEngineID length.            */
-                     char *secName,     /* IN - Pointer to securityName.        */
-                     size_t secNameLen, /* IN - SecurityName length.            */
-                     int secLevel,      /* IN - AuthNoPriv, authPriv etc.       */
-                     u_char * scopedPdu,        /* IN */
+                     const u_char *secEngineID, /* IN - Pointer snmpEngineID. */
+                     size_t secEngineIDLen,     /* IN - SnmpEngineID length.  */
+                     const char *secName,     /* IN - Pointer to securityName.*/
+                     size_t secNameLen, /* IN - SecurityName length.          */
+                     int secLevel,      /* IN - AuthNoPriv, authPriv etc.     */
+                     const u_char *scopedPdu, /* IN */
                      /*
                       * Pointer to scopedPdu will be encrypted by USM if needed
                       * * and written to packet buffer immediately following
@@ -929,7 +1292,7 @@ usm_generate_out_msg(int msgProcModel,
                       * * USM if needed.
                       */
                      size_t scopedPduLen,       /* IN - scopedPdu length. */
-                     void *secStateRef, /* IN */
+                     const void *secStateRef, /* IN */
                      /*
                       * secStateRef, pointer to cached info provided only for
                       * * Response, otherwise NULL.
@@ -980,9 +1343,9 @@ usm_generate_out_msg(int msgProcModel,
      * actual prarmeter list or the user list.
      */
 
-    char           *theName = NULL;
+    const char     *theName = NULL;
     u_int           theNameLength = 0;
-    u_char         *theEngineID = NULL;
+    const u_char   *theEngineID = NULL;
     u_int           theEngineIDLength = 0;
     u_char         *theAuthKey = NULL;
     u_int           theAuthKeyLength = 0;
@@ -1002,8 +1365,7 @@ usm_generate_out_msg(int msgProcModel,
         /*
          * To hush the compiler for now.  XXX 
          */
-        struct usmStateReference *ref
-            = (struct usmStateReference *) secStateRef;
+        const struct usmStateReference *ref = secStateRef;
 
         theName = ref->usr_name;
         theNameLength = ref->usr_name_length;
@@ -1039,7 +1401,6 @@ usm_generate_out_msg(int msgProcModel,
         if ((user = usm_get_user(secEngineID, secEngineIDLen, secName))
             == NULL && secLevel != SNMP_SEC_LEVEL_NOAUTH) {
             DEBUGMSGTL(("usm", "Unknown User(%s)\n", secName));
-            usm_free_usmStateReference(secStateRef);
             return SNMPERR_USM_UNKNOWNSECURITYNAME;
         }
 
@@ -1091,7 +1452,6 @@ usm_generate_out_msg(int msgProcModel,
                                         thePrivProtocolLength) == 1) {
         DEBUGMSGTL(("usm", "Unsupported Security Level (%d)\n",
                     theSecLevel));
-        usm_free_usmStateReference(secStateRef);
         return SNMPERR_USM_UNSUPPORTEDSECURITYLEVEL;
     }
 
@@ -1121,7 +1481,6 @@ usm_generate_out_msg(int msgProcModel,
                          &msgAuthParmLen, &msgPrivParmLen, &otstlen,
                          &seq_len, &msgSecParmLen) == -1) {
         DEBUGMSGTL(("usm", "Failed calculating offsets.\n"));
-        usm_free_usmStateReference(secStateRef);
         return SNMPERR_USM_GENERICERROR;
     }
 
@@ -1143,7 +1502,6 @@ usm_generate_out_msg(int msgProcModel,
     ptr = *wholeMsg = globalData;
     if (theTotalLength > *wholeMsgLen) {
         DEBUGMSGTL(("usm", "Message won't fit in buffer.\n"));
-        usm_free_usmStateReference(secStateRef);
         return SNMPERR_USM_GENERICERROR;
     }
 
@@ -1169,7 +1527,6 @@ usm_generate_out_msg(int msgProcModel,
                                htonl(boots_uint), htonl(time_uint),
                                &ptr[privParamsOffset]) == -1) {
                 DEBUGMSGTL(("usm", "Can't set AES iv.\n"));
-                usm_free_usmStateReference(secStateRef);
                 return SNMPERR_USM_GENERICERROR;
             }
         }
@@ -1185,7 +1542,6 @@ usm_generate_out_msg(int msgProcModel,
                               &ptr[privParamsOffset])
                  == -1)) {
                 DEBUGMSGTL(("usm", "Can't set DES-CBC salt.\n"));
-                usm_free_usmStateReference(secStateRef);
                 return SNMPERR_USM_GENERICERROR;
             }
         }
@@ -1198,7 +1554,6 @@ usm_generate_out_msg(int msgProcModel,
                        &ptr[dataOffset], &encrypted_length)
             != SNMP_ERR_NOERROR) {
             DEBUGMSGTL(("usm", "encryption error.\n"));
-            usm_free_usmStateReference(secStateRef);
             return SNMPERR_USM_ENCRYPTIONERROR;
         }
 #ifdef NETSNMP_ENABLE_TESTING_CODE
@@ -1226,7 +1581,6 @@ usm_generate_out_msg(int msgProcModel,
         if ((encrypted_length != (theTotalLength - dataOffset))
             || (salt_length != msgPrivParmLen)) {
             DEBUGMSGTL(("usm", "encryption length error.\n"));
-            usm_free_usmStateReference(secStateRef);
             return SNMPERR_USM_ENCRYPTIONERROR;
         }
 
@@ -1285,7 +1639,7 @@ usm_generate_out_msg(int msgProcModel,
     DEBUGDUMPHEADER("send", "msgUserName");
     asn_build_string(&ptr[offSet], &remaining,
                      (u_char) (ASN_UNIVERSAL | ASN_PRIMITIVE |
-                               ASN_OCTET_STR), (u_char *) theName,
+                               ASN_OCTET_STR), (const u_char *) theName,
                      theNameLength);
     DEBUGINDENTLESS();
 
@@ -1362,7 +1716,6 @@ usm_generate_out_msg(int msgProcModel,
 
         if (temp_sig == NULL) {
             DEBUGMSGTL(("usm", "Out of memory.\n"));
-            usm_free_usmStateReference(secStateRef);
             return SNMPERR_USM_GENERICERROR;
         }
 
@@ -1376,7 +1729,6 @@ usm_generate_out_msg(int msgProcModel,
             SNMP_ZERO(temp_sig, temp_sig_len);
             SNMP_FREE(temp_sig);
             DEBUGMSGTL(("usm", "Signing failed.\n"));
-            usm_free_usmStateReference(secStateRef);
             return SNMPERR_USM_AUTHENTICATIONFAILURE;
         }
 
@@ -1384,7 +1736,6 @@ usm_generate_out_msg(int msgProcModel,
             SNMP_ZERO(temp_sig, temp_sig_len);
             SNMP_FREE(temp_sig);
             DEBUGMSGTL(("usm", "Signing lengths failed.\n"));
-            usm_free_usmStateReference(secStateRef);
             return SNMPERR_USM_AUTHENTICATIONFAILURE;
         }
 
@@ -1398,7 +1749,6 @@ usm_generate_out_msg(int msgProcModel,
     /*
      * endif -- create keyed hash 
      */
-    usm_free_usmStateReference(secStateRef);
 
     DEBUGMSGTL(("usm", "USM processing completed.\n"));
 
@@ -1406,26 +1756,26 @@ usm_generate_out_msg(int msgProcModel,
 
 }                               /* end usm_generate_out_msg() */
 
-#ifdef NETSNMP_USE_REVERSE_ASNENCODING
-int
-usm_secmod_rgenerate_out_msg(struct snmp_secmod_outgoing_params *parms)
+static int
+usm_secmod_generate_out_msg(struct snmp_secmod_outgoing_params *parms)
 {
     if (!parms)
         return SNMPERR_GENERR;
 
-    return usm_rgenerate_out_msg(parms->msgProcModel,
-                                 parms->globalData, parms->globalDataLen,
-                                 parms->maxMsgSize, parms->secModel,
-                                 parms->secEngineID, parms->secEngineIDLen,
-                                 parms->secName, parms->secNameLen,
-                                 parms->secLevel,
-                                 parms->scopedPdu, parms->scopedPduLen,
-                                 parms->secStateRef,
-                                 parms->wholeMsg, parms->wholeMsgLen,
-                                 parms->wholeMsgOffset);
+    return usm_generate_out_msg(parms->msgProcModel,
+                                parms->globalData, parms->globalDataLen,
+                                parms->maxMsgSize, parms->secModel,
+                                parms->secEngineID, parms->secEngineIDLen,
+                                parms->secName, parms->secNameLen,
+                                parms->secLevel,
+                                parms->scopedPdu, parms->scopedPduLen,
+                                parms->secStateRef,
+                                parms->secParams, parms->secParamsLen,
+                                parms->wholeMsg, parms->wholeMsgLen);
 }
 
-int
+#ifdef NETSNMP_USE_REVERSE_ASNENCODING
+static int
 usm_rgenerate_out_msg(int msgProcModel, /* (UNUSED) */
                       u_char * globalData,      /* IN */
                       /*
@@ -1435,12 +1785,12 @@ usm_rgenerate_out_msg(int msgProcModel,
                       size_t globalDataLen,     /* IN - Length of msg header data.      */
                       int maxMsgSize,   /* (UNUSED) */
                       int secModel,     /* (UNUSED) */
-                      u_char * secEngineID,     /* IN - Pointer snmpEngineID.           */
-                      size_t secEngineIDLen,    /* IN - SnmpEngineID length.            */
-                      char *secName,    /* IN - Pointer to securityName.        */
-                      size_t secNameLen,        /* IN - SecurityName length.            */
-                      int secLevel,     /* IN - AuthNoPriv, authPriv etc.       */
-                      u_char * scopedPdu,       /* IN */
+                      const u_char *secEngineID, /* IN - Pointer snmpEngineID.*/
+                      size_t secEngineIDLen,     /* IN - SnmpEngineID length. */
+                      const char *secName,    /* IN - Pointer to securityName.*/
+                      size_t secNameLen,        /* IN - SecurityName length.  */
+                      int secLevel,         /* IN - AuthNoPriv, authPriv etc. */
+                      const u_char *scopedPdu,       /* IN */
                       /*
                        * Pointer to scopedPdu will be encrypted by USM if needed
                        * * and written to packet buffer immediately following
@@ -1448,7 +1798,7 @@ usm_rgenerate_out_msg(int msgProcModel,
                        * * USM if needed.
                        */
                       size_t scopedPduLen,      /* IN - scopedPdu length. */
-                      void *secStateRef,        /* IN */
+                      const void *secStateRef,  /* IN */
                       /*
                        * secStateRef, pointer to cached info provided only for
                        * * Response, otherwise NULL.
@@ -1463,7 +1813,7 @@ usm_rgenerate_out_msg(int msgProcModel,
                        * Length of the entire packet buffer, **not** the length of the
                        * packet.  
                        */
-                      size_t * offset   /*  IN/OUT  */
+                      size_t * offset           /*  IN/OUT  */
                       /*
                        * Offset from the end of the packet buffer to the start of the packet,
                        * also known as the packet length.  
@@ -1484,9 +1834,9 @@ usm_rgenerate_out_msg(int msgProcModel,
      * actual parameter list or the user list.
      */
 
-    char           *theName = NULL;
+    const char     *theName = NULL;
     u_int           theNameLength = 0;
-    u_char         *theEngineID = NULL;
+    const u_char   *theEngineID = NULL;
     u_int           theEngineIDLength = 0;
     u_char         *theAuthKey = NULL;
     u_int           theAuthKeyLength = 0;
@@ -1511,8 +1861,7 @@ usm_rgenerate_out_msg(int msgProcModel,
         /*
          * To hush the compiler for now.  XXX 
          */
-        struct usmStateReference *ref
-            = (struct usmStateReference *) secStateRef;
+        const struct usmStateReference *ref = secStateRef;
 
         theName = ref->usr_name;
         theNameLength = ref->usr_name_length;
@@ -1548,7 +1897,6 @@ usm_rgenerate_out_msg(int msgProcModel,
         if ((user = usm_get_user(secEngineID, secEngineIDLen, secName))
             == NULL && secLevel != SNMP_SEC_LEVEL_NOAUTH) {
             DEBUGMSGTL(("usm", "Unknown User\n"));
-            usm_free_usmStateReference(secStateRef);
             return SNMPERR_USM_UNKNOWNSECURITYNAME;
         }
 
@@ -1601,7 +1949,6 @@ usm_rgenerate_out_msg(int msgProcModel,
         DEBUGMSGTL(("usm", "Unsupported Security Level or type (%d)\n",
                     theSecLevel));
 
-        usm_free_usmStateReference(secStateRef);
         return SNMPERR_USM_UNSUPPORTEDSECURITYLEVEL;
     }
 
@@ -1636,7 +1983,6 @@ usm_rgenerate_out_msg(int msgProcModel,
             DEBUGMSGTL(("usm",
                         "couldn't malloc %d bytes for encrypted PDU\n",
                         (int)ciphertextlen));
-            usm_free_usmStateReference(secStateRef);
             return SNMPERR_MALLOC;
         }
 
@@ -1652,7 +1998,6 @@ usm_rgenerate_out_msg(int msgProcModel,
                                htonl(boots_uint), htonl(time_uint),
                                iv) == -1) {
                 DEBUGMSGTL(("usm", "Can't set AES iv.\n"));
-                usm_free_usmStateReference(secStateRef);
                 SNMP_FREE(ciphertext);
                 return SNMPERR_USM_GENERICERROR;
             }
@@ -1667,7 +2012,6 @@ usm_rgenerate_out_msg(int msgProcModel,
                                              thePrivKeyLength - 8,
                                              iv) == -1)) {
                 DEBUGMSGTL(("usm", "Can't set DES-CBC salt.\n"));
-                usm_free_usmStateReference(secStateRef);
                 SNMP_FREE(ciphertext);
                 return SNMPERR_USM_GENERICERROR;
             }
@@ -1686,7 +2030,6 @@ usm_rgenerate_out_msg(int msgProcModel,
                        scopedPdu, scopedPduLen,
                        ciphertext, &ciphertextlen) != SNMP_ERR_NOERROR) {
             DEBUGMSGTL(("usm", "encryption error.\n"));
-            usm_free_usmStateReference(secStateRef);
             SNMP_FREE(ciphertext);
             return SNMPERR_USM_ENCRYPTIONERROR;
         }
@@ -1703,7 +2046,6 @@ usm_rgenerate_out_msg(int msgProcModel,
                                        ciphertext, ciphertextlen);
         if (rc == 0) {
             DEBUGMSGTL(("usm", "Encryption failed.\n"));
-            usm_free_usmStateReference(secStateRef);
             SNMP_FREE(ciphertext);
             return SNMPERR_USM_ENCRYPTIONERROR;
         }
@@ -1743,7 +2085,6 @@ usm_rgenerate_out_msg(int msgProcModel,
     DEBUGINDENTLESS();
     if (rc == 0) {
         DEBUGMSGTL(("usm", "building privParams failed.\n"));
-        usm_free_usmStateReference(secStateRef);
         return SNMPERR_TOO_LONG;
     }
 
@@ -1766,7 +2107,6 @@ usm_rgenerate_out_msg(int msgProcModel,
     DEBUGINDENTLESS();
     if (rc == 0) {
         DEBUGMSGTL(("usm", "building authParams failed.\n"));
-        usm_free_usmStateReference(secStateRef);
         return SNMPERR_TOO_LONG;
     }
 
@@ -1785,11 +2125,10 @@ usm_rgenerate_out_msg(int msgProcModel,
     rc = asn_realloc_rbuild_string(wholeMsg, wholeMsgLen, offset, 1,
                                    (u_char) (ASN_UNIVERSAL | ASN_PRIMITIVE
                                              | ASN_OCTET_STR),
-                                   (u_char *) theName, theNameLength);
+                                   (const u_char *) theName, theNameLength);
     DEBUGINDENTLESS();
     if (rc == 0) {
         DEBUGMSGTL(("usm", "building authParams failed.\n"));
-        usm_free_usmStateReference(secStateRef);
         return SNMPERR_TOO_LONG;
     }
 
@@ -1805,7 +2144,6 @@ usm_rgenerate_out_msg(int msgProcModel,
     if (rc == 0) {
         DEBUGMSGTL(("usm",
                     "building msgAuthoritativeEngineTime failed.\n"));
-        usm_free_usmStateReference(secStateRef);
         return SNMPERR_TOO_LONG;
     }
 
@@ -1821,7 +2159,6 @@ usm_rgenerate_out_msg(int msgProcModel,
     if (rc == 0) {
         DEBUGMSGTL(("usm",
                     "building msgAuthoritativeEngineBoots failed.\n"));
-        usm_free_usmStateReference(secStateRef);
         return SNMPERR_TOO_LONG;
     }
 
@@ -1833,7 +2170,6 @@ usm_rgenerate_out_msg(int msgProcModel,
     DEBUGINDENTLESS();
     if (rc == 0) {
         DEBUGMSGTL(("usm", "building msgAuthoritativeEngineID failed.\n"));
-        usm_free_usmStateReference(secStateRef);
         return SNMPERR_TOO_LONG;
     }
 
@@ -1846,7 +2182,6 @@ usm_rgenerate_out_msg(int msgProcModel,
                                      *offset - sp_offset);
     if (rc == 0) {
         DEBUGMSGTL(("usm", "building usm security parameters failed.\n"));
-        usm_free_usmStateReference(secStateRef);
         return SNMPERR_TOO_LONG;
     }
 
@@ -1860,7 +2195,6 @@ usm_rgenerate_out_msg(int msgProcModel,
 
     if (rc == 0) {
         DEBUGMSGTL(("usm", "building msgSecurityParameters failed.\n"));
-        usm_free_usmStateReference(secStateRef);
         return SNMPERR_TOO_LONG;
     }
 
@@ -1870,7 +2204,6 @@ usm_rgenerate_out_msg(int msgProcModel,
     while ((*wholeMsgLen - *offset) < globalDataLen) {
         if (!asn_realloc(wholeMsg, wholeMsgLen)) {
             DEBUGMSGTL(("usm", "building global data failed.\n"));
-            usm_free_usmStateReference(secStateRef);
             return SNMPERR_TOO_LONG;
         }
     }
@@ -1886,7 +2219,6 @@ usm_rgenerate_out_msg(int msgProcModel,
                                                ASN_CONSTRUCTOR), *offset);
     if (rc == 0) {
         DEBUGMSGTL(("usm", "building master packet sequence failed.\n"));
-        usm_free_usmStateReference(secStateRef);
         return SNMPERR_TOO_LONG;
     }
 
@@ -1904,7 +2236,6 @@ usm_rgenerate_out_msg(int msgProcModel,
 
         if (temp_sig == NULL) {
             DEBUGMSGTL(("usm", "Out of memory.\n"));
-            usm_free_usmStateReference(secStateRef);
             return SNMPERR_USM_GENERICERROR;
         }
 
@@ -1915,14 +2246,12 @@ usm_rgenerate_out_msg(int msgProcModel,
             != SNMP_ERR_NOERROR) {
             SNMP_FREE(temp_sig);
             DEBUGMSGTL(("usm", "Signing failed.\n"));
-            usm_free_usmStateReference(secStateRef);
             return SNMPERR_USM_AUTHENTICATIONFAILURE;
         }
 
         if (temp_sig_len != msgAuthParmLen) {
             SNMP_FREE(temp_sig);
             DEBUGMSGTL(("usm", "Signing lengths failed.\n"));
-            usm_free_usmStateReference(secStateRef);
             return SNMPERR_USM_AUTHENTICATIONFAILURE;
         }
 
@@ -1933,14 +2262,28 @@ usm_rgenerate_out_msg(int msgProcModel,
     /*
      * endif -- create keyed hash 
      */
-    usm_free_usmStateReference(secStateRef);
     DEBUGMSGTL(("usm", "USM processing completed.\n"));
     return SNMPERR_SUCCESS;
 }                               /* end usm_rgenerate_out_msg() */
 
-#endif                          /* */
-
+static int
+usm_secmod_rgenerate_out_msg(struct snmp_secmod_outgoing_params *parms)
+{
+    if (!parms)
+        return SNMPERR_GENERR;
 
+    return usm_rgenerate_out_msg(parms->msgProcModel,
+                                 parms->globalData, parms->globalDataLen,
+                                 parms->maxMsgSize, parms->secModel,
+                                 parms->secEngineID, parms->secEngineIDLen,
+                                 parms->secName, parms->secNameLen,
+                                 parms->secLevel,
+                                 parms->scopedPdu, parms->scopedPduLen,
+                                 parms->secStateRef,
+                                 parms->wholeMsg, parms->wholeMsgLen,
+                                 parms->wholeMsgOffset);
+}
+#endif                          /* */
 
 /*******************************************************************-o-******
  * usm_parse_security_parameters
@@ -1957,7 +2300,7 @@ usm_rgenerate_out_msg(int msgProcModel,
  *	Extracts values from the security header and data portions of the
  *	incoming buffer.
  */
-int
+static int
 usm_parse_security_parameters(u_char * secParams,
                               size_t remaining,
                               u_char * secEngineID,
@@ -2211,7 +2554,7 @@ usm_parse_security_parameters(u_char * s
  *
  * Performs the incoming timeliness checking and setting.
  */
-int
+static int
 usm_check_and_update_timeliness(u_char * secEngineID,
                                 size_t secEngineIDLen,
                                 u_int boots_uint,
@@ -2353,31 +2696,61 @@ usm_check_and_update_timeliness(u_char *
 
 }                               /* end usm_check_and_update_timeliness() */
 
+/*******************************************************************-o-******
+ * usm_check_secLevel
+ *
+ * Parameters:
+ *	 level
+ *	*user
+ *      
+ * Returns:
+ *	0	On success,
+ *	-1	Otherwise.
+ *
+ * Checks that a given security level is valid for a given user.
+ */
+static int
+usm_check_secLevel(int level, struct usmUser *user)
+{
 
+    if (user->userStatus != RS_ACTIVE)
+        return -1;
 
-int
-usm_secmod_process_in_msg(struct snmp_secmod_incoming_params *parms)
-{
-    if (!parms)
-        return SNMPERR_GENERR;
+    DEBUGMSGTL(("comparex", "Comparing: %" NETSNMP_PRIo "u %" NETSNMP_PRIo "u ",
+                usmNoPrivProtocol[0], usmNoPrivProtocol[1]));
+    DEBUGMSGOID(("comparex", usmNoPrivProtocol,
+                 sizeof(usmNoPrivProtocol) / sizeof(oid)));
+    DEBUGMSG(("comparex", "\n"));
+    if (level == SNMP_SEC_LEVEL_AUTHPRIV
+        && (netsnmp_oid_equals(user->privProtocol, user->privProtocolLen,
+                             usmNoPrivProtocol,
+                             sizeof(usmNoPrivProtocol) / sizeof(oid)) ==
+            0)) {
+        DEBUGMSGTL(("usm", "Level: %d\n", level));
+        DEBUGMSGTL(("usm", "User (%s) Auth Protocol: ", user->name));
+        DEBUGMSGOID(("usm", user->authProtocol, user->authProtocolLen));
+        DEBUGMSG(("usm", ", User Priv Protocol: "));
+        DEBUGMSGOID(("usm", user->privProtocol, user->privProtocolLen));
+        DEBUGMSG(("usm", "\n"));
+        return 1;
+    }
+    if ((level == SNMP_SEC_LEVEL_AUTHPRIV
+         || level == SNMP_SEC_LEVEL_AUTHNOPRIV)
+        &&
+        (netsnmp_oid_equals
+         (user->authProtocol, user->authProtocolLen, usmNoAuthProtocol,
+          sizeof(usmNoAuthProtocol) / sizeof(oid)) == 0)) {
+        DEBUGMSGTL(("usm", "Level: %d\n", level));
+        DEBUGMSGTL(("usm", "User (%s) Auth Protocol: ", user->name));
+        DEBUGMSGOID(("usm", user->authProtocol, user->authProtocolLen));
+        DEBUGMSG(("usm", ", User Priv Protocol: "));
+        DEBUGMSGOID(("usm", user->privProtocol, user->privProtocolLen));
+        DEBUGMSG(("usm", "\n"));
+        return 1;
+    }
 
-    return usm_process_in_msg(parms->msgProcModel,
-                              parms->maxMsgSize,
-                              parms->secParams,
-                              parms->secModel,
-                              parms->secLevel,
-                              parms->wholeMsg,
-                              parms->wholeMsgLen,
-                              parms->secEngineID,
-                              parms->secEngineIDLen,
-                              parms->secName,
-                              parms->secNameLen,
-                              parms->scopedPdu,
-                              parms->scopedPduLen,
-                              parms->maxSizeResponse,
-                              parms->secStateRef,
-                              parms->sess, parms->msg_flags);
-}
+    return 0;
+}                               /* end usm_check_secLevel() */
 
 /*******************************************************************-o-******
  * usm_process_in_msg
@@ -2398,11 +2771,8 @@ usm_secmod_process_in_msg(struct snmp_se
  *
  *
  * ASSUMES size of decrypt_buf will always be >= size of encrypted sPDU.
- *
- * FIX  Memory leaks if secStateRef is allocated and a return occurs
- *	without cleaning up.  May contain secrets...
  */
-int
+static int
 usm_process_in_msg(int msgProcModel,    /* (UNUSED) */
                    size_t maxMsgSize,   /* IN     - Used to calc maxSizeResponse.  */
                    u_char * secParams,  /* IN     - BER encoded securityParameters. */
@@ -2454,17 +2824,15 @@ usm_process_in_msg(int msgProcModel,
 
     DEBUGMSGTL(("usm", "USM processing begun...\n"));
 
+    netsnmp_assert(secStateRef);
 
-    if (secStateRef) {
-        usm_free_usmStateReference(*secStateRef);
-        *secStateRef = usm_malloc_usmStateReference();
-        if (*secStateRef == NULL) {
-            DEBUGMSGTL(("usm", "Out of memory.\n"));
-            return SNMPERR_USM_GENERICERROR;
-        }
+    usm_free_usmStateReference(*secStateRef);
+    *secStateRef = usm_malloc_usmStateReference();
+    if (*secStateRef == NULL) {
+        DEBUGMSGTL(("usm", "Out of memory.\n"));
+        return SNMPERR_USM_GENERICERROR;
     }
 
-
     /*
      * Make sure the *secParms is an OCTET STRING.
      * Extract the user name, engine ID, and security level.
@@ -2482,10 +2850,12 @@ usm_process_in_msg(int msgProcModel,
              * This indicates a decryptionError.  
              */
             snmp_increment_statistic(STAT_USMSTATSDECRYPTIONERRORS);
-            return SNMPERR_USM_DECRYPTIONERROR;
+            error = SNMPERR_USM_DECRYPTIONERROR;
+        } else {
+            snmp_increment_statistic(STAT_SNMPINASNPARSEERRS);
+            error = SNMPERR_USM_PARSEERROR;
         }
-        snmp_increment_statistic(STAT_SNMPINASNPARSEERRS);
-        return SNMPERR_USM_PARSEERROR;
+        goto err;
     }
 
     /*
@@ -2496,7 +2866,8 @@ usm_process_in_msg(int msgProcModel,
      */
     if ((secLevel == SNMP_SEC_LEVEL_AUTHPRIV) && (salt_length != 8)) {
         snmp_increment_statistic(STAT_USMSTATSDECRYPTIONERRORS);
-        return SNMPERR_USM_DECRYPTIONERROR;
+        error = SNMPERR_USM_DECRYPTIONERROR;
+        goto err;
     }
 
     if (secLevel != SNMP_SEC_LEVEL_AUTHPRIV) {
@@ -2508,31 +2879,31 @@ usm_process_in_msg(int msgProcModel,
         end_of_overhead = data_ptr;
     }
 
-    if (secStateRef) {
-        /*
-         * Cache the name, engine ID, and security level,
-         * * per step 2 (section 3.2)
-         */
-        if (usm_set_usmStateReference_name
-            (*secStateRef, secName, *secNameLen) == -1) {
-            DEBUGMSGTL(("usm", "%s\n", "Couldn't cache name."));
-            return SNMPERR_USM_GENERICERROR;
-        }
-
-        if (usm_set_usmStateReference_engine_id
-            (*secStateRef, secEngineID, *secEngineIDLen) == -1) {
-            DEBUGMSGTL(("usm", "%s\n", "Couldn't cache engine id."));
-            return SNMPERR_USM_GENERICERROR;
-        }
-
-        if (usm_set_usmStateReference_sec_level(*secStateRef, secLevel) ==
-            -1) {
-            DEBUGMSGTL(("usm", "%s\n", "Couldn't cache security level."));
-            return SNMPERR_USM_GENERICERROR;
-        }
+    /*
+     * Cache the name, engine ID, and security level,
+     * * per step 2 (section 3.2)
+     */
+    if (usm_set_usmStateReference_name
+        (*secStateRef, secName, *secNameLen) == -1) {
+        DEBUGMSGTL(("usm", "%s\n", "Couldn't cache name."));
+        error = SNMPERR_USM_GENERICERROR;
+        goto err;
+    }
+
+    if (usm_set_usmStateReference_engine_id
+        (*secStateRef, secEngineID, *secEngineIDLen) == -1) {
+        DEBUGMSGTL(("usm", "%s\n", "Couldn't cache engine id."));
+        error = SNMPERR_USM_GENERICERROR;
+        goto err;
+    }
+
+    if (usm_set_usmStateReference_sec_level(*secStateRef, secLevel) ==
+        -1) {
+        DEBUGMSGTL(("usm", "%s\n", "Couldn't cache security level."));
+        error = SNMPERR_USM_GENERICERROR;
+        goto err;
     }
 
-
     /*
      * Locate the engine ID record.
      * If it is unknown, then either create one or note this as an error.
@@ -2544,13 +2915,15 @@ usm_process_in_msg(int msgProcModel,
         if (ISENGINEKNOWN(secEngineID, *secEngineIDLen) == FALSE) {
             DEBUGMSGTL(("usm", "Unknown Engine ID.\n"));
             snmp_increment_statistic(STAT_USMSTATSUNKNOWNENGINEIDS);
-            return SNMPERR_USM_UNKNOWNENGINEID;
+            error = SNMPERR_USM_UNKNOWNENGINEID;
+            goto err;
         }
     } else {
         if (ENSURE_ENGINE_RECORD(secEngineID, *secEngineIDLen)
             != SNMPERR_SUCCESS) {
             DEBUGMSGTL(("usm", "%s\n", "Couldn't ensure engine record."));
-            return SNMPERR_USM_GENERICERROR;
+            error = SNMPERR_USM_GENERICERROR;
+            goto err;
         }
 
     }
@@ -2568,13 +2941,15 @@ usm_process_in_msg(int msgProcModel,
         == NULL) {
         DEBUGMSGTL(("usm", "Unknown User(%s)\n", secName));
         snmp_increment_statistic(STAT_USMSTATSUNKNOWNUSERNAMES);
-        return SNMPERR_USM_UNKNOWNSECURITYNAME;
+        error = SNMPERR_USM_UNKNOWNSECURITYNAME;
+        goto err;
     }
 
     /* ensure the user is active */
     if (user->userStatus != RS_ACTIVE) {
         DEBUGMSGTL(("usm", "Attempt to use an inactive user.\n"));
-        return SNMPERR_USM_UNKNOWNSECURITYNAME;
+        error = SNMPERR_USM_UNKNOWNSECURITYNAME;
+        goto err;
     }
 
     /*
@@ -2586,10 +2961,12 @@ usm_process_in_msg(int msgProcModel,
         DEBUGMSGTL(("usm", "Unsupported Security Level (%d).\n",
                     secLevel));
         snmp_increment_statistic(STAT_USMSTATSUNSUPPORTEDSECLEVELS);
-        return SNMPERR_USM_UNSUPPORTEDSECURITYLEVEL;
+        error = SNMPERR_USM_UNSUPPORTEDSECURITYLEVEL;
+        goto err;
     } else if (rc != 0) {
         DEBUGMSGTL(("usm", "Unknown issue.\n"));
-        return SNMPERR_USM_GENERICERROR;
+        error = SNMPERR_USM_GENERICERROR;
+        goto err;
     }
 
     /*
@@ -2606,7 +2983,8 @@ usm_process_in_msg(int msgProcModel,
             snmp_increment_statistic(STAT_USMSTATSWRONGDIGESTS);
 	    snmp_log(LOG_WARNING, "Authentication failed for %s\n",
 				user->name);
-            return SNMPERR_USM_AUTHENTICATIONFAILURE;
+            error = SNMPERR_USM_AUTHENTICATIONFAILURE;
+            goto err;
         }
 
         DEBUGMSGTL(("usm", "Verification succeeded.\n"));
@@ -2619,41 +2997,41 @@ usm_process_in_msg(int msgProcModel,
      *
      * Cache the keys and protocol oids, per step 11 (s3.2).
      */
-    if (secStateRef) {
-        if (usm_set_usmStateReference_auth_protocol(*secStateRef,
-                                                    user->authProtocol,
-                                                    user->
-                                                    authProtocolLen) ==
-            -1) {
-            DEBUGMSGTL(("usm", "%s\n",
-                        "Couldn't cache authentication protocol."));
-            return SNMPERR_USM_GENERICERROR;
-        }
-
-        if (usm_set_usmStateReference_auth_key(*secStateRef,
-                                               user->authKey,
-                                               user->authKeyLen) == -1) {
-            DEBUGMSGTL(("usm", "%s\n",
-                        "Couldn't cache authentication key."));
-            return SNMPERR_USM_GENERICERROR;
-        }
-
-        if (usm_set_usmStateReference_priv_protocol(*secStateRef,
-                                                    user->privProtocol,
-                                                    user->
-                                                    privProtocolLen) ==
-            -1) {
-            DEBUGMSGTL(("usm", "%s\n",
-                        "Couldn't cache privacy protocol."));
-            return SNMPERR_USM_GENERICERROR;
-        }
-
-        if (usm_set_usmStateReference_priv_key(*secStateRef,
-                                               user->privKey,
-                                               user->privKeyLen) == -1) {
-            DEBUGMSGTL(("usm", "%s\n", "Couldn't cache privacy key."));
-            return SNMPERR_USM_GENERICERROR;
-        }
+    if (usm_set_usmStateReference_auth_protocol(*secStateRef,
+                                                user->authProtocol,
+                                                user->
+                                                authProtocolLen) == -1) {
+        DEBUGMSGTL(("usm", "%s\n",
+                    "Couldn't cache authentication protocol."));
+        error = SNMPERR_USM_GENERICERROR;
+        goto err;
+    }
+
+    if (usm_set_usmStateReference_auth_key(*secStateRef,
+                                           user->authKey,
+                                           user->authKeyLen) == -1) {
+        DEBUGMSGTL(("usm", "%s\n",
+                    "Couldn't cache authentication key."));
+        error = SNMPERR_USM_GENERICERROR;
+        goto err;
+    }
+
+    if (usm_set_usmStateReference_priv_protocol(*secStateRef,
+                                                user->privProtocol,
+                                                user->
+                                                privProtocolLen) == -1) {
+        DEBUGMSGTL(("usm", "%s\n",
+                    "Couldn't cache privacy protocol."));
+        error = SNMPERR_USM_GENERICERROR;
+        goto err;
+    }
+
+    if (usm_set_usmStateReference_priv_key(*secStateRef,
+                                           user->privKey,
+                                           user->privKeyLen) == -1) {
+        DEBUGMSGTL(("usm", "%s\n", "Couldn't cache privacy key."));
+        error = SNMPERR_USM_GENERICERROR;
+        goto err;
     }
 
 
@@ -2665,7 +3043,7 @@ usm_process_in_msg(int msgProcModel,
         if (usm_check_and_update_timeliness(secEngineID, *secEngineIDLen,
                                             boots_uint, time_uint,
                                             &error) == -1) {
-            return error;
+            goto err;
         }
     }
 #ifdef							LCD_TIME_SYNC_OPT
@@ -2699,7 +3077,8 @@ usm_process_in_msg(int msgProcModel,
             snmp_increment_statistic(STAT_SNMPINASNPARSEERRS);
             usm_free_usmStateReference(*secStateRef);
             *secStateRef = NULL;
-            return SNMPERR_USM_PARSEERROR;
+            error = SNMPERR_USM_PARSEERROR;
+            goto err;
         }
 
 #ifndef NETSNMP_DISABLE_DES
@@ -2720,7 +3099,8 @@ usm_process_in_msg(int msgProcModel,
                 snmp_increment_statistic(STAT_USMSTATSDECRYPTIONERRORS);
                 usm_free_usmStateReference(*secStateRef);
                 *secStateRef = NULL;
-                return SNMPERR_USM_DECRYPTIONERROR;
+                error = SNMPERR_USM_DECRYPTIONERROR;
+                goto err;
             }
 
             end_of_overhead = value_ptr;
@@ -2730,7 +3110,8 @@ usm_process_in_msg(int msgProcModel,
                 snmp_increment_statistic(STAT_USMSTATSDECRYPTIONERRORS);
                 usm_free_usmStateReference(*secStateRef);
                 *secStateRef = NULL;
-                return SNMPERR_USM_DECRYPTIONERROR;
+                error = SNMPERR_USM_DECRYPTIONERROR;
+                goto err;
             }
 
             /*
@@ -2768,7 +3149,8 @@ usm_process_in_msg(int msgProcModel,
             != SNMP_ERR_NOERROR) {
             DEBUGMSGTL(("usm", "%s\n", "Failed decryption."));
             snmp_increment_statistic(STAT_USMSTATSDECRYPTIONERRORS);
-            return SNMPERR_USM_DECRYPTIONERROR;
+            error = SNMPERR_USM_DECRYPTIONERROR;
+            goto err;
         }
 #ifdef NETSNMP_ENABLE_TESTING_CODE
         if (debug_is_token_registered("usm/dump") == SNMPERR_SUCCESS) {
@@ -2800,10 +3182,39 @@ usm_process_in_msg(int msgProcModel,
 
     return SNMPERR_SUCCESS;
 
+err:
+    usm_free_usmStateReference(*secStateRef);
+    *secStateRef = NULL;
+    netsnmp_assert(error != SNMPERR_SUCCESS);
+    return error;
 }                               /* end usm_process_in_msg() */
 
-void
-usm_handle_report(void *sessp,
+static int
+usm_secmod_process_in_msg(struct snmp_secmod_incoming_params *parms)
+{
+    if (!parms)
+        return SNMPERR_GENERR;
+
+    return usm_process_in_msg(parms->msgProcModel,
+                              parms->maxMsgSize,
+                              parms->secParams,
+                              parms->secModel,
+                              parms->secLevel,
+                              parms->wholeMsg,
+                              parms->wholeMsgLen,
+                              parms->secEngineID,
+                              parms->secEngineIDLen,
+                              parms->secName,
+                              parms->secNameLen,
+                              parms->scopedPdu,
+                              parms->scopedPduLen,
+                              parms->maxSizeResponse,
+                              parms->secStateRef,
+                              parms->sess, parms->msg_flags);
+}
+
+static void
+usm_handle_report(struct session_list *slp,
                   netsnmp_transport *transport, netsnmp_session *session,
                   int result, netsnmp_pdu *pdu)
 {
@@ -2844,7 +3255,7 @@ usm_handle_report(void *sessp,
             pdu2 = snmp_clone_pdu(pdu);
             pdu->flags = pdu2->flags = flags;
             snmpv3_make_report(pdu2, result);
-            if (0 == snmp_sess_send(sessp, pdu2)) {
+            if (0 == snmp_sess_send(slp, pdu2)) {
                 snmp_free_pdu(pdu2);
                 /*
                  * TODO: indicate error 
@@ -2859,7 +3270,7 @@ usm_handle_report(void *sessp,
 int
 usm_extend_user_kul(struct usmUser *user, u_int privKeyBufSize)
 {
-    netsnmp_priv_alg_info *pai;
+    const netsnmp_priv_alg_info *pai;
 
     DEBUGMSGTL(("usm", "extending key\n"));
 
@@ -2881,7 +3292,7 @@ usm_extend_user_kul(struct usmUser *user
 }
 
 /* sets up initial default session parameters */
-int
+static int
 usm_session_init(netsnmp_session *in_session, netsnmp_session *session)
 {
     char *cp;
@@ -2977,6 +3388,44 @@ usm_session_init(netsnmp_session *in_ses
     return SNMPERR_SUCCESS;
 }
 
+static int usm_build_user(struct usmUser **result,
+                          const netsnmp_session *session)
+{
+    struct usmUser *user;
+
+    DEBUGMSGTL(("usm", "Building user %s...\n", session->securityName));
+    /*
+     * user doesn't exist so we create and add it
+     */
+    user = calloc(1, sizeof(struct usmUser));
+    if (user == NULL)
+        goto err;
+
+    /*
+     * copy in the securityName
+     */
+    if (session->securityName) {
+        user->name = strdup(session->securityName);
+        user->secName = strdup(session->securityName);
+        if (user->name == NULL || user->secName == NULL)
+            goto err;
+    }
+
+    /*
+     * copy in the engineID
+     */
+    user->engineID = netsnmp_memdup(session->securityEngineID,
+                                    session->securityEngineIDLen);
+    if (session->securityEngineID && !user->engineID)
+        goto err;
+    user->engineIDLen = session->securityEngineIDLen;
+    *result = user;
+    return SNMPERR_SUCCESS;
+
+err:
+    usm_free_user(user);
+    return SNMPERR_GENERR;
+}
 
 /*
  * usm_create_user_from_session(netsnmp_session *session):
@@ -3021,42 +3470,11 @@ usm_create_user_from_session(netsnmp_ses
                                   session->securityEngineIDLen,
                                   session->securityName,
                                   usm_get_userList(), 0);
-    if (NULL != user) 
+    if (NULL != user) {
         DEBUGMSGTL(("usm", "user exists x=%p\n", user));
-    else
-    if (user == NULL) {
-        DEBUGMSGTL(("usm", "Building user %s...\n",
-                    session->securityName));
-        /*
-         * user doesn't exist so we create and add it 
-         */
-        user = (struct usmUser *) calloc(1, sizeof(struct usmUser));
-        if (user == NULL)
-            return SNMPERR_GENERR;
-
-        /*
-         * copy in the securityName 
-         */
-        if (session->securityName) {
-            user->name = strdup(session->securityName);
-            user->secName = strdup(session->securityName);
-            if (user->name == NULL || user->secName == NULL) {
-                usm_free_user(user);
-                return SNMPERR_GENERR;
-            }
-        }
-
-        /*
-         * copy in the engineID 
-         */
-        user->engineID = netsnmp_memdup(session->securityEngineID,
-                                        session->securityEngineIDLen);
-        if (session->securityEngineID && !user->engineID) {
-            usm_free_user(user);
+    } else {
+        if (usm_build_user(&user, session) != SNMPERR_SUCCESS)
             return SNMPERR_GENERR;
-        }
-        user->engineIDLen = session->securityEngineIDLen;
-
         user_just_created = 1;
     }
 
@@ -3105,8 +3523,7 @@ usm_create_user_from_session(netsnmp_ses
                 return SNMPERR_GENERR;
             }
             user->authKeyLen = session->securityAuthLocalKeyLen;
-        } else if (session->securityAuthKey != NULL
-                   && session->securityAuthKeyLen != 0) {
+        } else if (session->securityAuthKeyLen != 0) {
             SNMP_FREE(user->authKey);
             user->authKey = (u_char *) calloc(1, USM_LENGTH_KU_HASHBLOCK);
             user->authKeyLen = USM_LENGTH_KU_HASHBLOCK;
@@ -3154,8 +3571,7 @@ usm_create_user_from_session(netsnmp_ses
                 return SNMPERR_GENERR;
             }
             keyBufSize = user->privKeyLen = session->securityPrivLocalKeyLen;
-        } else if (session->securityPrivKey != NULL
-                   && session->securityPrivKeyLen != 0) {
+        } else if (session->securityPrivKeyLen != 0) {
             SNMP_FREE(user->privKey);
             user->privKey = (u_char *) calloc(1, keyBufSize);
             user->privKeyLen = keyBufSize;
@@ -3203,8 +3619,9 @@ usm_create_user_from_session(netsnmp_ses
 }
 
 /* A wrapper around the hook */
-int
-usm_create_user_from_session_hook(void *slp, netsnmp_session *session)
+static int
+usm_create_user_from_session_hook(struct session_list *slp,
+                                  netsnmp_session *session)
 {
     DEBUGMSGTL(("usm", "potentially bootstrapping the USM table from session data\n"));
     return usm_create_user_from_session(session);
@@ -3253,10 +3670,11 @@ usm_build_probe_pdu(netsnmp_pdu **pdu)
     return 0;
 }
 
-int usm_discover_engineid(void *slpv, netsnmp_session *session) {
+static int usm_discover_engineid(struct session_list *slp,
+                                 netsnmp_session *session)
+{
     netsnmp_pdu    *pdu = NULL, *response = NULL;
     int status, i;
-    struct session_list *slp = (struct session_list *) slpv;
 
     if (usm_build_probe_pdu(&pdu) != 0) {
         DEBUGMSGTL(("snmp_api", "unable to create probe PDU\n"));
@@ -3322,93 +3740,8 @@ int usm_discover_engineid(void *slpv, ne
     return SNMPERR_SUCCESS;
 }
 
-void
-init_usm(void)
-{
-    struct snmp_secmod_def *def;
-    char *type;
-
-    DEBUGMSGTL(("init_usm", "unit_usm: %" NETSNMP_PRIo "u %" NETSNMP_PRIo "u\n",
-                usmNoPrivProtocol[0], usmNoPrivProtocol[1]));
-
-    sc_init();                  /* initalize scapi code */
-
-    /*
-     * register ourselves as a security service 
-     */
-    def = SNMP_MALLOC_STRUCT(snmp_secmod_def);
-    if (def == NULL)
-        return;
-    /*
-     * XXX: def->init_sess_secmod move stuff from snmp_api.c 
-     */
-    def->encode_reverse = usm_secmod_rgenerate_out_msg;
-    def->encode_forward = usm_secmod_generate_out_msg;
-    def->decode = usm_secmod_process_in_msg;
-    def->pdu_free_state_ref = usm_free_usmStateReference;
-    def->session_setup = usm_session_init;
-    def->handle_report = usm_handle_report;
-    def->probe_engineid = usm_discover_engineid;
-    def->post_probe_engineid = usm_create_user_from_session_hook;
-    if (register_sec_mod(USM_SEC_MODEL_NUMBER, "usm", def) != SNMPERR_SUCCESS) {
-        SNMP_FREE(def);
-        snmp_log(LOG_ERR, "could not register usm sec mod\n");
-        return;
-    }
-
-    snmp_register_callback(SNMP_CALLBACK_LIBRARY,
-                           SNMP_CALLBACK_POST_PREMIB_READ_CONFIG,
-                           init_usm_post_config, NULL);
-
-    snmp_register_callback(SNMP_CALLBACK_LIBRARY,
-                           SNMP_CALLBACK_SHUTDOWN,
-                           deinit_usm_post_config, NULL);
-
-    snmp_register_callback(SNMP_CALLBACK_LIBRARY,
-                           SNMP_CALLBACK_SHUTDOWN,
-                           free_engineID, NULL);
-
-    register_config_handler("snmp", "defAuthType", snmpv3_authtype_conf,
-                            NULL, "MD5|SHA|SHA-512|SHA-384|SHA-256|SHA-224");
-    register_config_handler("snmp", "defPrivType", snmpv3_privtype_conf,
-                            NULL,
-                            "DES"
-#ifdef HAVE_AES
-                            "|AES|AES-128"
-#ifdef NETSNMP_DRAFT_BLUMENTHAL_AES_04
-                            "|AES-192|AES-256"
-#endif /* NETSNMP_DRAFT_BLUMENTHAL_AES_04 */
-#else
-                            " (AES support not available)"
-#endif
-                           );
-
-    /*
-     * Free stuff at shutdown time
-     */
-    snmp_register_callback(SNMP_CALLBACK_LIBRARY,
-                           SNMP_CALLBACK_SHUTDOWN,
-                           free_enginetime_on_shutdown, NULL);
-
-
-    type = netsnmp_ds_get_string(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_APPTYPE);
-
-    register_config_handler(type, "userSetAuthPass", usm_set_password,
-                            NULL, NULL);
-    register_config_handler(type, "userSetPrivPass", usm_set_password,
-                            NULL, NULL);
-    register_config_handler(type, "userSetAuthKey", usm_set_password, NULL,
-                            NULL);
-    register_config_handler(type, "userSetPrivKey", usm_set_password, NULL,
-                            NULL);
-    register_config_handler(type, "userSetAuthLocalKey", usm_set_password,
-                            NULL, NULL);
-    register_config_handler(type, "userSetPrivLocalKey", usm_set_password,
-                            NULL, NULL);
-}
-
-int
-usm_lookup_alg_type(const char *str, usm_alg_type_t *types)
+static int
+usm_lookup_alg_type(const char *str, const usm_alg_type_t *types)
 {
     int i, l;
     l = strlen(str);
@@ -3420,8 +3753,8 @@ usm_lookup_alg_type(const char *str, usm
     return -1;
 }
 
-const char *
-usm_lookup_alg_str(int value, usm_alg_type_t *types)
+static const char *
+usm_lookup_alg_str(int value, const usm_alg_type_t *types)
 {
     int i;
     for (i = 0; types[i].label; ++i)
@@ -3430,6 +3763,7 @@ usm_lookup_alg_str(int value, usm_alg_ty
 
     return NULL;
 }
+
 int
 usm_lookup_auth_type(const char *str)
 {
@@ -3454,91 +3788,7 @@ usm_lookup_priv_str(int value)
     return usm_lookup_alg_str(value, usm_priv_type );
 }
 
-void
-init_usm_conf(const char *app)
-{
-    register_config_handler(app, "usmUser",
-                                  usm_parse_config_usmUser, NULL, NULL);
-    register_config_handler(app, "createUser",
-                                  usm_parse_create_usmUser, NULL,
-                                  "username [-e ENGINEID] (MD5|SHA|SHA-512|SHA-384|SHA-256|SHA-224|default) authpassphrase [(DES|AES|default) [privpassphrase]]");
-
-    /*
-     * we need to be called back later 
-     */
-    snmp_register_callback(SNMP_CALLBACK_LIBRARY, SNMP_CALLBACK_STORE_DATA,
-                           usm_store_users, NULL);
-}
-
-/*
- * initializations for the USM.
- *
- * Should be called after the (engineid) configuration files have been read.
- *
- * Set "arbitrary" portion of salt to a random number.
- */
-int
-init_usm_post_config(int majorid, int minorid, void *serverarg,
-                     void *clientarg)
-{
-    size_t          salt_integer_len = sizeof(salt_integer);
-
-    if (sc_random((u_char *) & salt_integer, &salt_integer_len) !=
-        SNMPERR_SUCCESS) {
-        DEBUGMSGTL(("usm", "sc_random() failed: using time() as salt.\n"));
-        salt_integer = (u_int) time(NULL);
-    }
-
-#ifdef HAVE_AES
-    salt_integer_len = sizeof (salt_integer64_1);
-    if (sc_random((u_char *) & salt_integer64_1, &salt_integer_len) !=
-        SNMPERR_SUCCESS) {
-        DEBUGMSGTL(("usm", "sc_random() failed: using time() as aes1 salt.\n"));
-        salt_integer64_1 = (u_int) time(NULL);
-    }
-    salt_integer_len = sizeof (salt_integer64_1);
-    if (sc_random((u_char *) & salt_integer64_2, &salt_integer_len) !=
-        SNMPERR_SUCCESS) {
-        DEBUGMSGTL(("usm", "sc_random() failed: using time() as aes2 salt.\n"));
-        salt_integer64_2 = (u_int) time(NULL);
-    }
-#endif
-    
-#ifndef NETSNMP_DISABLE_MD5
-    noNameUser = usm_create_initial_user("", usmHMACMD5AuthProtocol,
-                                         OID_LENGTH(usmHMACMD5AuthProtocol),
-                                         SNMP_DEFAULT_PRIV_PROTO,
-                                         SNMP_DEFAULT_PRIV_PROTOLEN);
-#else
-    noNameUser = usm_create_initial_user("", usmHMACSHA1AuthProtocol,
-                                         OID_LENGTH(usmHMACSHA1AuthProtocol),
-                                         SNMP_DEFAULT_PRIV_PROTO,
-                                         SNMP_DEFAULT_PRIV_PROTOLEN);
-#endif
-
-    if ( noNameUser ) {
-        SNMP_FREE(noNameUser->engineID);
-        noNameUser->engineIDLen = 0;
-    }
-
-    return SNMPERR_SUCCESS;
-}                               /* end init_usm_post_config() */
-
-int
-deinit_usm_post_config(int majorid, int minorid, void *serverarg,
-		       void *clientarg)
-{
-    if (usm_free_user(noNameUser) != NULL) {
-	DEBUGMSGTL(("deinit_usm_post_config", "could not free initial user\n"));
-	return SNMPERR_GENERR;
-    }
-    noNameUser = NULL;
-
-    DEBUGMSGTL(("deinit_usm_post_config", "initial user removed\n"));
-    return SNMPERR_SUCCESS;
-}                               /* end deinit_usm_post_config() */
-
-void
+static void
 clear_user_list(void)
 {
     struct usmUser *tmp = userList, *next = NULL;
@@ -3552,463 +3802,6 @@ clear_user_list(void)
 
 }
 
-void
-shutdown_usm(void)
-{
-    free_etimelist();
-    clear_user_list();
-}
-
-/*******************************************************************-o-******
- * usm_check_secLevel
- *
- * Parameters:
- *	 level
- *	*user
- *      
- * Returns:
- *	0	On success,
- *	-1	Otherwise.
- *
- * Checks that a given security level is valid for a given user.
- */
-int
-usm_check_secLevel(int level, struct usmUser *user)
-{
-
-    if (user->userStatus != RS_ACTIVE)
-        return -1;
-
-    DEBUGMSGTL(("comparex", "Comparing: %" NETSNMP_PRIo "u %" NETSNMP_PRIo "u ",
-                usmNoPrivProtocol[0], usmNoPrivProtocol[1]));
-    DEBUGMSGOID(("comparex", usmNoPrivProtocol,
-                 sizeof(usmNoPrivProtocol) / sizeof(oid)));
-    DEBUGMSG(("comparex", "\n"));
-    if (level == SNMP_SEC_LEVEL_AUTHPRIV
-        && (netsnmp_oid_equals(user->privProtocol, user->privProtocolLen,
-                             usmNoPrivProtocol,
-                             sizeof(usmNoPrivProtocol) / sizeof(oid)) ==
-            0)) {
-        DEBUGMSGTL(("usm", "Level: %d\n", level));
-        DEBUGMSGTL(("usm", "User (%s) Auth Protocol: ", user->name));
-        DEBUGMSGOID(("usm", user->authProtocol, user->authProtocolLen));
-        DEBUGMSG(("usm", ", User Priv Protocol: "));
-        DEBUGMSGOID(("usm", user->privProtocol, user->privProtocolLen));
-        DEBUGMSG(("usm", "\n"));
-        return 1;
-    }
-    if ((level == SNMP_SEC_LEVEL_AUTHPRIV
-         || level == SNMP_SEC_LEVEL_AUTHNOPRIV)
-        &&
-        (netsnmp_oid_equals
-         (user->authProtocol, user->authProtocolLen, usmNoAuthProtocol,
-          sizeof(usmNoAuthProtocol) / sizeof(oid)) == 0)) {
-        DEBUGMSGTL(("usm", "Level: %d\n", level));
-        DEBUGMSGTL(("usm", "User (%s) Auth Protocol: ", user->name));
-        DEBUGMSGOID(("usm", user->authProtocol, user->authProtocolLen));
-        DEBUGMSG(("usm", ", User Priv Protocol: "));
-        DEBUGMSGOID(("usm", user->privProtocol, user->privProtocolLen));
-        DEBUGMSG(("usm", "\n"));
-        return 1;
-    }
-
-    return 0;
-
-}                               /* end usm_check_secLevel() */
-
-
-
-
-/*******************************************************************-o-******
- * usm_check_secLevel_vs_protocols
- *
- * Parameters:
- *	 level
- *	*authProtocol
- *	 authProtocolLen
- *	*privProtocol
- *	 privProtocolLen
- *      
- * Returns:
- *	0	On success,
- *	1	Otherwise.
- *
- * Same as above but with explicitly named transform types instead of taking
- * from the usmUser structure.
- */
-int
-usm_check_secLevel_vs_protocols(int level,
-                                const oid * authProtocol,
-                                u_int authProtocolLen,
-                                const oid * privProtocol,
-                                u_int privProtocolLen)
-{
-
-    if (level == SNMP_SEC_LEVEL_AUTHPRIV
-        &&
-        (netsnmp_oid_equals
-         (privProtocol, privProtocolLen, usmNoPrivProtocol,
-          sizeof(usmNoPrivProtocol) / sizeof(oid)) == 0)) {
-        DEBUGMSGTL(("usm", "Level: %d\n", level));
-        DEBUGMSGTL(("usm", "Auth Protocol: "));
-        DEBUGMSGOID(("usm", authProtocol, authProtocolLen));
-        DEBUGMSG(("usm", ", Priv Protocol: "));
-        DEBUGMSGOID(("usm", privProtocol, privProtocolLen));
-        DEBUGMSG(("usm", "\n"));
-        return 1;
-    }
-    if ((level == SNMP_SEC_LEVEL_AUTHPRIV
-         || level == SNMP_SEC_LEVEL_AUTHNOPRIV)
-        &&
-        (netsnmp_oid_equals
-         (authProtocol, authProtocolLen, usmNoAuthProtocol,
-          sizeof(usmNoAuthProtocol) / sizeof(oid)) == 0)) {
-        DEBUGMSGTL(("usm", "Level: %d\n", level));
-        DEBUGMSGTL(("usm", "Auth Protocol: "));
-        DEBUGMSGOID(("usm", authProtocol, authProtocolLen));
-        DEBUGMSG(("usm", ", Priv Protocol: "));
-        DEBUGMSGOID(("usm", privProtocol, privProtocolLen));
-        DEBUGMSG(("usm", "\n"));
-        return 1;
-    }
-
-    return 0;
-
-}                               /* end usm_check_secLevel_vs_protocols() */
-
-
-
-
-/*
- * usm_get_user(): Returns a user from userList based on the engineID,
- * engineIDLen and name of the requested user. 
- */
-
-struct usmUser *
-usm_get_user(u_char * engineID, size_t engineIDLen, char *name)
-{
-    DEBUGMSGTL(("usm", "getting user %s\n", name));
-    return usm_get_user_from_list(engineID, engineIDLen, name, userList,
-                                  1);
-}
-
-struct usmUser *
-usm_get_user_from_list(u_char * engineID, size_t engineIDLen,
-                       char *name, struct usmUser *puserList,
-                       int use_default)
-{
-    struct usmUser *ptr;
-    char            noName[] = "";
-    if (name == NULL)
-        name = noName;
-    for (ptr = puserList; ptr != NULL; ptr = ptr->next) {
-        if (ptr->name && !strcmp(ptr->name, name)) {
-          DEBUGMSGTL(("usm", "match on user %s\n", ptr->name));
-          if (ptr->engineIDLen == engineIDLen &&
-            ((ptr->engineID == NULL && engineID == NULL) ||
-             (ptr->engineID != NULL && engineID != NULL &&
-              memcmp(ptr->engineID, engineID, engineIDLen) == 0)))
-            return ptr;
-          DEBUGMSGTL(("usm", "no match on engineID ("));
-          if (engineID) {
-              DEBUGMSGHEX(("usm", engineID, engineIDLen));
-          } else {
-              DEBUGMSGTL(("usm", "Empty EngineID"));
-          }
-          DEBUGMSG(("usm", ")\n"));
-        }
-    }
-
-    /*
-     * return "" user used to facilitate engineID discovery 
-     */
-    if (use_default && !strcmp(name, ""))
-        return noNameUser;
-    return NULL;
-}
-
-/*
- * usm_add_user(): Add's a user to the userList, sorted by the
- * engineIDLength then the engineID then the name length then the name
- * to facilitate getNext calls on a usmUser table which is indexed by
- * these values.
- * 
- * returns the head of the list (which could change due to this add).
- */
-
-struct usmUser *
-usm_add_user(struct usmUser *user)
-{
-    struct usmUser *uptr;
-    uptr = usm_add_user_to_list(user, userList);
-    if (uptr != NULL)
-        userList = uptr;
-    return uptr;
-}
-
-struct usmUser *
-usm_add_user_to_list(struct usmUser *user, struct usmUser *puserList)
-{
-    struct usmUser *nptr, *pptr, *optr;
-
-    /*
-     * loop through puserList till we find the proper, sorted place to
-     * insert the new user 
-     */
-    /* XXX - how to handle a NULL user->name ?? */
-    /* XXX - similarly for a NULL nptr->name ?? */
-    for (nptr = puserList, pptr = NULL; nptr != NULL;
-         pptr = nptr, nptr = nptr->next) {
-        if (nptr->engineIDLen > user->engineIDLen)
-            break;
-
-        if (user->engineID == NULL && nptr->engineID != NULL)
-            break;
-
-        if (nptr->engineIDLen == user->engineIDLen &&
-            (nptr->engineID != NULL && user->engineID != NULL &&
-             memcmp(nptr->engineID, user->engineID,
-                    user->engineIDLen) > 0))
-            break;
-
-        if (!(nptr->engineID == NULL && user->engineID != NULL)) {
-            if (nptr->engineIDLen == user->engineIDLen &&
-                ((nptr->engineID == NULL && user->engineID == NULL) ||
-                 memcmp(nptr->engineID, user->engineID,
-                        user->engineIDLen) == 0)
-                && strlen(nptr->name) > strlen(user->name))
-                break;
-
-            if (nptr->engineIDLen == user->engineIDLen &&
-                ((nptr->engineID == NULL && user->engineID == NULL) ||
-                 memcmp(nptr->engineID, user->engineID,
-                        user->engineIDLen) == 0)
-                && strlen(nptr->name) == strlen(user->name)
-                && strcmp(nptr->name, user->name) > 0)
-                break;
-
-            if (nptr->engineIDLen == user->engineIDLen &&
-                ((nptr->engineID == NULL && user->engineID == NULL) ||
-                 memcmp(nptr->engineID, user->engineID,
-                        user->engineIDLen) == 0)
-                && strlen(nptr->name) == strlen(user->name)
-                && strcmp(nptr->name, user->name) == 0) {
-                /*
-                 * the user is an exact match of a previous entry.
-                 * Credentials may be different, though, so remove
-                 * the old entry (and add the new one)!
-                 */
-                if (pptr) { /* change prev's next pointer */
-                  pptr->next = nptr->next;
-                }
-                if (nptr->next) { /* change next's prev pointer */
-                  nptr->next->prev = pptr;
-                } 
-                optr = nptr;
-                nptr = optr->next; /* add new user at this position */
-                /* free the old user */
-                optr->next=NULL;
-                optr->prev=NULL;
-                usm_free_user(optr); 
-                break; /* new user will be added below */
-            }
-        }
-    }
-
-    /*
-     * nptr should now point to the user that we need to add ourselves
-     * in front of, and pptr should be our new 'prev'. 
-     */
-
-    /*
-     * change our pointers 
-     */
-    user->prev = pptr;
-    user->next = nptr;
-
-    /*
-     * change the next's prev pointer 
-     */
-    if (user->next)
-        user->next->prev = user;
-
-    /*
-     * change the prev's next pointer 
-     */
-    if (user->prev)
-        user->prev->next = user;
-
-    /*
-     * rewind to the head of the list and return it (since the new head
-     * could be us, we need to notify the above routine who the head now is. 
-     */
-    for (pptr = user; pptr->prev != NULL; pptr = pptr->prev);
-    return pptr;
-}
-
-/*
- * usm_remove_user(): finds and removes a user from a list 
- */
-struct usmUser *
-usm_remove_user(struct usmUser *user)
-{
-    return usm_remove_user_from_list(user, &userList);
-}
-
-/*
- * usm_remove_usmUser remove user from (optional) list
- *
- * if list is not specified, defaults to global userList.
- *
- * returns SNMPERR_SUCCESS or SNMPERR_USM_UNKNOWNSECURITYNAME
- */
-int
-usm_remove_usmUser_from_list(struct usmUser *user, struct usmUser **ppuserList)
-{
-    struct usmUser *nptr, *pptr;
-
-    /*
-     * NULL pointers aren't allowed 
-     */
-    if (ppuserList == NULL)
-        ppuserList = &userList;
-
-    if (*ppuserList == NULL)
-        return SNMPERR_USM_UNKNOWNSECURITYNAME;
-
-    /*
-     * find the user in the list 
-     */
-    for (nptr = *ppuserList, pptr = NULL; nptr != NULL;
-         pptr = nptr, nptr = nptr->next) {
-        if (nptr == user)
-            break;
-    }
-
-    if (nptr) {
-        /*
-         * remove the user from the linked list 
-         */
-        if (pptr) {
-            pptr->next = nptr->next;
-        }
-        if (nptr->next) {
-            nptr->next->prev = pptr;
-        }
-    } else {
-        /*
-         * user didn't exist 
-         */
-        return SNMPERR_USM_UNKNOWNSECURITYNAME;
-    }
-    if (nptr == *ppuserList)    /* we're the head of the list, need to change
-                                 * * the head to the next user */
-        *ppuserList = nptr->next;
-    return SNMPERR_SUCCESS;
-}                               /* end usm_remove_user_from_list() */
-
-int
-usm_remove_usmUser(struct usmUser *user)
-{
-    return usm_remove_usmUser_from_list(user, &userList);
-}
-
-/*
- * usm_remove_user_from_list
- *
- * removes user from list.
- *
- * returns new list head on success, or NULL on error.
- *
- * NOTE: if there was only one user in the list, list head will be NULL.
- *       So NULL can also mean success. Use the newer usm_remove_usmUser() for
- *       more specific return codes. This function is kept for backwards
- *       compatability with this ambiguous behaviour.
- */
-struct usmUser *
-usm_remove_user_from_list(struct usmUser *user,
-                          struct usmUser **ppuserList)
-{
-    int rc = usm_remove_usmUser_from_list(user, ppuserList);
-    if (rc != SNMPERR_SUCCESS || NULL == ppuserList)
-        return NULL;
-
-    return *ppuserList;
-}                               /* end usm_remove_user_from_list() */
-
-
-
-
-/*
- * usm_free_user():  calls free() on all needed parts of struct usmUser and
- * the user himself.
- * 
- * Note: This should *not* be called on an object in a list (IE,
- * remove it from the list first, and set next and prev to NULL), but
- * will try to reconnect the list pieces again if it is called this
- * way.  If called on the head of the list, the entire list will be
- * lost. 
- */
-struct usmUser *
-usm_free_user(struct usmUser *user)
-{
-    if (user == NULL)
-        return NULL;
-
-    SNMP_FREE(user->engineID);
-    SNMP_FREE(user->name);
-    SNMP_FREE(user->secName);
-    SNMP_FREE(user->cloneFrom);
-    SNMP_FREE(user->userPublicString);
-    SNMP_FREE(user->authProtocol);
-    SNMP_FREE(user->privProtocol);
-
-    if (user->authKey != NULL) {
-        SNMP_ZERO(user->authKey, user->authKeyLen);
-        SNMP_FREE(user->authKey);
-    }
-
-    if (user->privKey != NULL) {
-        SNMP_ZERO(user->privKey, user->privKeyLen);
-        SNMP_FREE(user->privKey);
-    }
-
-    if (user->authKeyKu != NULL) {
-        SNMP_ZERO(user->authKeyKu, user->authKeyKuLen);
-        SNMP_FREE(user->authKeyKu);
-    }
-
-    if (user->privKeyKu != NULL) {
-        SNMP_ZERO(user->privKeyKu, user->privKeyKuLen);
-        SNMP_FREE(user->privKeyKu);
-    }
-
-
-    /*
-     * FIX  Why not put this check *first?*
-     */
-    if (user->prev != NULL) {   /* ack, this shouldn't happen */
-        user->prev->next = user->next;
-    }
-    if (user->next != NULL) {
-        user->next->prev = user->prev;
-        if (user->prev != NULL) /* ack this is really bad, because it means
-                                 * * we'll loose the head of some structure tree */
-            DEBUGMSGTL(("usm",
-                        "Severe: Asked to free the head of a usmUser tree somewhere."));
-    }
-
-
-    SNMP_ZERO(user, sizeof(*user));
-    SNMP_FREE(user);
-
-    return NULL;                /* for convenience to returns from calling functions */
-
-}                               /* end usm_free_user() */
-
-
-
-
 #ifndef NETSNMP_NO_WRITE_SUPPORT
 /*
  * take a given user and clone the security info into another 
@@ -4147,15 +3940,12 @@ usm_create_user(void)
 
 }                               /* end usm_clone_user() */
 
-
-
-
 /*
  * usm_create_initial_user(void):
  * creates an initial user, filled with the defaults defined in the
  * USM document.
  */
-struct usmUser *
+static struct usmUser *
 usm_create_initial_user(const char *name,
                         const oid * authProtocol, size_t authProtocolLen,
                         const oid * privProtocol, size_t privProtocolLen)
@@ -4203,57 +3993,9 @@ usm_create_initial_user(const char *name
 }
 
 /*
- * this is a callback that can store all known users based on a
- * previously registered application ID 
- */
-int
-usm_store_users(int majorID, int minorID, void *serverarg, void *clientarg)
-{
-    /*
-     * figure out our application name 
-     */
-    char           *appname = (char *) clientarg;
-    if (appname == NULL) {
-        appname = netsnmp_ds_get_string(NETSNMP_DS_LIBRARY_ID, 
-					NETSNMP_DS_LIB_APPTYPE);
-    }
-
-    /*
-     * save the user base 
-     */
-    usm_save_users("usmUser", appname);
-
-    /*
-     * never fails 
-     */
-    return SNMPERR_SUCCESS;
-}
-
-
-/*
- * usm_save_users(): saves a list of users to the persistent cache 
- */
-void
-usm_save_users(const char *token, const char *type)
-{
-    usm_save_users_from_list(userList, token, type);
-}
-
-void
-usm_save_users_from_list(struct usmUser *puserList, const char *token,
-                         const char *type)
-{
-    struct usmUser *uptr;
-    for (uptr = puserList; uptr != NULL; uptr = uptr->next) {
-        if (uptr->userStorageType == ST_NONVOLATILE)
-            usm_save_user(uptr, token, type);
-    }
-}
-
-/*
  * usm_save_user(): saves a user to the persistent cache 
  */
-void
+static void
 usm_save_user(struct usmUser *user, const char *token, const char *type)
 {
     char            line[4096];
@@ -4299,11 +4041,58 @@ usm_save_user(struct usmUser *user, cons
     read_config_store(type, line);
 }
 
+static void
+usm_save_users_from_list(struct usmUser *puserList, const char *token,
+                         const char *type)
+{
+    struct usmUser *uptr;
+    for (uptr = puserList; uptr != NULL; uptr = uptr->next) {
+        if (uptr->userStorageType == ST_NONVOLATILE)
+            usm_save_user(uptr, token, type);
+    }
+}
+
+/*
+ * usm_save_users(): saves a list of users to the persistent cache 
+ */
+static void
+usm_save_users(const char *token, const char *type)
+{
+    usm_save_users_from_list(userList, token, type);
+}
+
+/*
+ * this is a callback that can store all known users based on a
+ * previously registered application ID 
+ */
+static int
+usm_store_users(int majorID, int minorID, void *serverarg, void *clientarg)
+{
+    /*
+     * figure out our application name 
+     */
+    char           *appname = (char *) clientarg;
+    if (appname == NULL) {
+        appname = netsnmp_ds_get_string(NETSNMP_DS_LIBRARY_ID, 
+					NETSNMP_DS_LIB_APPTYPE);
+    }
+
+    /*
+     * save the user base 
+     */
+    usm_save_users("usmUser", appname);
+
+    /*
+     * never fails 
+     */
+    return SNMPERR_SUCCESS;
+}
+
 /*
  * usm_parse_user(): reads in a line containing a saved user profile
  * and returns a pointer to a newly created struct usmUser. 
  */
-struct usmUser *
+static struct usmUser *
 usm_read_user(const char *line)
 {
     struct usmUser *user;
@@ -4380,9 +4169,6 @@ usm_parse_config_usmUser(const char *tok
         usm_add_user(uptr);
 }
 
-
-
-
 /*******************************************************************-o-******
  * usm_set_password
  *
@@ -4403,7 +4189,7 @@ usm_parse_config_usmUser(const char *tok
  *
  * ASSUMES  Passwords are null-terminated printable strings.
  */
-void
+static void
 usm_set_password(const char *token, char *line)
 {
     char           *cp;
@@ -4592,7 +4378,7 @@ usm_set_user_password(struct usmUser *us
  *    This error string points to a static message, and should not be
  *    freed.
  */
-struct usmUser *
+static struct usmUser *
 usm_create_usmUser_from_string(char *line, const char **errorMsg)
 {
     char           *cp;
@@ -4606,7 +4392,7 @@ usm_create_usmUser_from_string(char *lin
     int             ret2, properLen, properPrivKeyLen;
     const oid      *def_auth_prot, *def_priv_prot;
     size_t          def_auth_prot_len, def_priv_prot_len;
-    netsnmp_priv_alg_info *pai;
+    const netsnmp_priv_alg_info *pai;
 
     def_auth_prot = get_default_authtype(&def_auth_prot_len);
     def_priv_prot = get_default_privtype(&def_priv_prot_len);
@@ -5005,77 +4791,7 @@ usm_parse_create_usmUser(const char *tok
         config_perror(error);
 }
 
-struct usmUser *
-usm_create_usmUser(const char *userName, const char *engineID, u_int flags,
-                   int authType, const char *authPass,
-                   int privType, const char *privPass, const char **errorMsg)
-{
-    const char *errorMsgLoc, *str;
-    char        line[SPRINT_MAX_LEN];
-    int         len;
-
-    if (NULL == errorMsg)
-        errorMsg = &errorMsgLoc;
-    *errorMsg = NULL;
-
-    /** [-M] [-e ENGINEID] username 
-     *  (MD5|SHA|SHA512|SHA384|SHA256|SHA224|default) authpassphrase
-     *  [DES|AES|default] [privpassphrase]
-     */
-
-    line[0] = 0;
-    if (flags & USMUSER_FLAG_KEEP_MASTER_KEY)
-        strlcat(line, "-M ", sizeof(line));
-
-    if (engineID) {
-        strlcat(line, "-e ", sizeof(line));
-        strlcat(line, engineID, sizeof(line));
-        strlcat(line, " ", sizeof(line));
-    }
-    len = strlcat(line, userName, sizeof(line));
-    if (0 == authType)
-        goto create;
-
-    str = usm_lookup_auth_str(authType);
-    if (NULL == str) {
-        *errorMsg = "unknown authType";
-        return NULL;
-    }
-    if (NULL == authPass) {
-        *errorMsg = "missing authpassphrase";
-        return NULL;
-    }
-    strlcat(line, " ", sizeof(line));
-    strlcat(line, str, sizeof(line));
-    strlcat(line, " ", sizeof(line));
-    len = strlcat(line, authPass, sizeof(line));
-    if (0 == privType)
-        goto create;
-
-    str = usm_lookup_priv_str(privType);
-    if (NULL == str) {
-        *errorMsg = "Unknown privacy protocol";
-        return NULL;
-    }
-    if (NULL == privPass) {
-        *errorMsg = "missing privpassphrase";
-        return NULL;
-    }
-    strlcat(line, " ", sizeof(line));
-    strlcat(line, str, sizeof(line));
-    strlcat(line, " ", sizeof(line));
-    len = strlcat(line, privPass, sizeof(line));
-
-  create:
-    if (len >= sizeof(line)) {
-        *errorMsg = "line exceeded buffer space";
-        return NULL;
-    };
-
-    return usm_create_usmUser_from_string(line, errorMsg);
-}
-
-void
+static void
 snmpv3_authtype_conf(const char *word, char *cptr)
 {
     int auth_type = usm_lookup_auth_type(cptr);
@@ -5097,7 +4813,7 @@ get_default_authtype(size_t * len)
     return defaultAuthType;
 }
 
-void
+static void
 snmpv3_privtype_conf(const char *word, char *cptr)
 {
     int priv_type = usm_lookup_priv_type(cptr);
@@ -5119,3 +4835,179 @@ get_default_privtype(size_t * len)
     return defaultPrivType;
 }
 
+void
+init_usm_conf(const char *app)
+{
+    register_config_handler(app, "usmUser",
+                                  usm_parse_config_usmUser, NULL, NULL);
+    register_config_handler(app, "createUser",
+                                  usm_parse_create_usmUser, NULL,
+                                  "username [-e ENGINEID] (MD5|SHA|SHA-512|SHA-384|SHA-256|SHA-224|default) authpassphrase [(DES|AES|default) [privpassphrase]]");
+
+    /*
+     * we need to be called back later
+     */
+    snmp_register_callback(SNMP_CALLBACK_LIBRARY, SNMP_CALLBACK_STORE_DATA,
+                           usm_store_users, NULL);
+}
+
+/*
+ * initializations for the USM.
+ *
+ * Should be called after the (engineid) configuration files have been read.
+ *
+ * Set "arbitrary" portion of salt to a random number.
+ */
+static int
+init_usm_post_config(int majorid, int minorid, void *serverarg,
+                     void *clientarg)
+{
+    size_t          salt_integer_len = sizeof(salt_integer);
+
+    if (sc_random((u_char *) & salt_integer, &salt_integer_len) !=
+        SNMPERR_SUCCESS) {
+        DEBUGMSGTL(("usm", "sc_random() failed: using time() as salt.\n"));
+        salt_integer = (u_int) time(NULL);
+    }
+
+#ifdef HAVE_AES
+    salt_integer_len = sizeof (salt_integer64_1);
+    if (sc_random((u_char *) & salt_integer64_1, &salt_integer_len) !=
+        SNMPERR_SUCCESS) {
+        DEBUGMSGTL(("usm", "sc_random() failed: using time() as aes1 salt.\n"));
+        salt_integer64_1 = (u_int) time(NULL);
+    }
+    salt_integer_len = sizeof (salt_integer64_1);
+    if (sc_random((u_char *) & salt_integer64_2, &salt_integer_len) !=
+        SNMPERR_SUCCESS) {
+        DEBUGMSGTL(("usm", "sc_random() failed: using time() as aes2 salt.\n"));
+        salt_integer64_2 = (u_int) time(NULL);
+    }
+#endif
+
+#ifndef NETSNMP_DISABLE_MD5
+    noNameUser = usm_create_initial_user("", usmHMACMD5AuthProtocol,
+                                         OID_LENGTH(usmHMACMD5AuthProtocol),
+                                         SNMP_DEFAULT_PRIV_PROTO,
+                                         SNMP_DEFAULT_PRIV_PROTOLEN);
+#else
+    noNameUser = usm_create_initial_user("", usmHMACSHA1AuthProtocol,
+                                         OID_LENGTH(usmHMACSHA1AuthProtocol),
+                                         SNMP_DEFAULT_PRIV_PROTO,
+                                         SNMP_DEFAULT_PRIV_PROTOLEN);
+#endif
+
+    if ( noNameUser ) {
+        SNMP_FREE(noNameUser->engineID);
+        noNameUser->engineIDLen = 0;
+    }
+
+    return SNMPERR_SUCCESS;
+}                               /* end init_usm_post_config() */
+
+static int
+deinit_usm_post_config(int majorid, int minorid, void *serverarg,
+		       void *clientarg)
+{
+    if (usm_free_user(noNameUser) != NULL) {
+	DEBUGMSGTL(("deinit_usm_post_config", "could not free initial user\n"));
+	return SNMPERR_GENERR;
+    }
+    noNameUser = NULL;
+
+    DEBUGMSGTL(("deinit_usm_post_config", "initial user removed\n"));
+    return SNMPERR_SUCCESS;
+}                               /* end deinit_usm_post_config() */
+
+void
+init_usm(void)
+{
+    struct snmp_secmod_def *def;
+    char *type;
+
+    DEBUGMSGTL(("init_usm", "unit_usm: %" NETSNMP_PRIo "u %" NETSNMP_PRIo "u\n",
+                usmNoPrivProtocol[0], usmNoPrivProtocol[1]));
+
+    sc_init();                  /* initalize scapi code */
+
+    /*
+     * register ourselves as a security service
+     */
+    def = SNMP_MALLOC_STRUCT(snmp_secmod_def);
+    if (def == NULL)
+        return;
+    /*
+     * XXX: def->init_sess_secmod move stuff from snmp_api.c
+     */
+    def->encode_reverse = usm_secmod_rgenerate_out_msg;
+    def->encode_forward = usm_secmod_generate_out_msg;
+    def->decode = usm_secmod_process_in_msg;
+    def->pdu_clone = usm_clone;
+    def->pdu_free_state_ref = usm_free_usmStateReference;
+    def->session_setup = usm_session_init;
+    def->handle_report = usm_handle_report;
+    def->probe_engineid = usm_discover_engineid;
+    def->post_probe_engineid = usm_create_user_from_session_hook;
+    if (register_sec_mod(USM_SEC_MODEL_NUMBER, "usm", def) != SNMPERR_SUCCESS) {
+        SNMP_FREE(def);
+        snmp_log(LOG_ERR, "could not register usm sec mod\n");
+        return;
+    }
+
+    snmp_register_callback(SNMP_CALLBACK_LIBRARY,
+                           SNMP_CALLBACK_POST_PREMIB_READ_CONFIG,
+                           init_usm_post_config, NULL);
+
+    snmp_register_callback(SNMP_CALLBACK_LIBRARY,
+                           SNMP_CALLBACK_SHUTDOWN,
+                           deinit_usm_post_config, NULL);
+
+    snmp_register_callback(SNMP_CALLBACK_LIBRARY,
+                           SNMP_CALLBACK_SHUTDOWN,
+                           free_engineID, NULL);
+
+    register_config_handler("snmp", "defAuthType", snmpv3_authtype_conf,
+                            NULL, "MD5|SHA|SHA-512|SHA-384|SHA-256|SHA-224");
+    register_config_handler("snmp", "defPrivType", snmpv3_privtype_conf,
+                            NULL,
+                            "DES"
+#ifdef HAVE_AES
+                            "|AES|AES-128"
+#ifdef NETSNMP_DRAFT_BLUMENTHAL_AES_04
+                            "|AES-192|AES-256"
+#endif /* NETSNMP_DRAFT_BLUMENTHAL_AES_04 */
+#else
+                            " (AES support not available)"
+#endif
+                           );
+
+    /*
+     * Free stuff at shutdown time
+     */
+    snmp_register_callback(SNMP_CALLBACK_LIBRARY,
+                           SNMP_CALLBACK_SHUTDOWN,
+                           free_enginetime_on_shutdown, NULL);
+
+
+    type = netsnmp_ds_get_string(NETSNMP_DS_LIBRARY_ID, NETSNMP_DS_LIB_APPTYPE);
+
+    register_config_handler(type, "userSetAuthPass", usm_set_password,
+                            NULL, NULL);
+    register_config_handler(type, "userSetPrivPass", usm_set_password,
+                            NULL, NULL);
+    register_config_handler(type, "userSetAuthKey", usm_set_password, NULL,
+                            NULL);
+    register_config_handler(type, "userSetPrivKey", usm_set_password, NULL,
+                            NULL);
+    register_config_handler(type, "userSetAuthLocalKey", usm_set_password,
+                            NULL, NULL);
+    register_config_handler(type, "userSetPrivLocalKey", usm_set_password,
+                            NULL, NULL);
+}
+
+void
+shutdown_usm(void)
+{
+    free_etimelist();
+    clear_user_list();
+}
diff -urpN net-snmp-5.8/snmplib/snmpv3.c net-snmp-5.9.1/snmplib/snmpv3.c
--- net-snmp-5.8/snmplib/snmpv3.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/snmpv3.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,6 +13,9 @@
 
 #include <net-snmp/net-snmp-config.h>
 #include <errno.h>
+#ifdef HAVE_INTTYPES_H
+#include <inttypes.h>
+#endif
 #ifdef HAVE_LIMITS_H
 #include <limits.h>
 #endif
@@ -64,10 +67,6 @@
 #	include <net/if.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 #include <net-snmp/config_api.h>
@@ -924,7 +923,7 @@ exactEngineID_conf(const char *word, cha
 /*
  * merely call 
  */
-netsnmp_feature_child_of(get_enginetime_alarm, netsnmp_unused)
+netsnmp_feature_child_of(get_enginetime_alarm, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_GET_ENGINETIME_ALARM
 void
 get_enginetime_alarm(unsigned int regnum, void *clientargs)
diff -urpN net-snmp-5.8/snmplib/strtol.c net-snmp-5.9.1/snmplib/strtol.c
--- net-snmp-5.8/snmplib/strtol.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/strtol.c	2021-05-26 05:19:35.000000000 +0700
@@ -29,10 +29,6 @@
 
 #include <net-snmp/net-snmp-config.h>
 
-#if defined(LIBC_SCCS) && !defined(lint)
-static char     sccsid[] = "@(#)strtol.c    5.4 (Berkeley) 2/23/91";
-#endif                          /* LIBC_SCCS and not lint */
-
 #if HAVE_LIMITS_H
 #include <limits.h>
 #endif
diff -urpN net-snmp-5.8/snmplib/strtoul.c net-snmp-5.9.1/snmplib/strtoul.c
--- net-snmp-5.8/snmplib/strtoul.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/strtoul.c	2021-05-26 05:19:35.000000000 +0700
@@ -29,10 +29,6 @@
 
 #include <net-snmp/net-snmp-config.h>
 
-#if defined(LIBC_SCCS) && !defined(lint)
-static char     sccsid[] = "@(#)strtoul.c   8.1 (Berkeley) 6/4/93";
-#endif                          /* LIBC_SCCS and not lint */
-
 #if HAVE_LIMITS_H
 #include <limits.h>
 #endif
diff -urpN net-snmp-5.8/snmplib/system.c net-snmp-5.9.1/snmplib/system.c
--- net-snmp-5.8/snmplib/system.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/system.c	2021-05-26 05:19:35.000000000 +0700
@@ -52,6 +52,9 @@ SOFTWARE.
 #include <ctype.h>
 #include <errno.h>
 
+#ifdef HAVE_INTTYPES_H
+#include <inttypes.h>
+#endif
 #if HAVE_IO_H
 #include <io.h>
 #endif
@@ -126,8 +129,9 @@ SOFTWARE.
 #include <strings.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
+#ifdef WIN32
+#include <wchar.h>   /* wcsncmp() */
+#include <winperf.h> /* PERF_DATA_BLOCK */
 #endif
 
 #ifdef HAVE_SYS_STAT_H
@@ -153,10 +157,14 @@ SOFTWARE.
 #include <sys/systeminfo.h>
 #endif
 
-#if defined(darwin9)
+#if HAVE_CRT_EXTERNS_H
 #include <crt_externs.h>        /* for _NSGetArgv() */
 #endif
 
+#ifdef HAVE_MACH_O_DYLD_H
+#include <mach-o/dyld.h>
+#endif
+
 #if HAVE_PWD_H
 #include <pwd.h>
 #endif
@@ -194,10 +202,10 @@ SOFTWARE.
 /* NetSNMP and DNSSEC-Tools both define FREE. We'll not use either here. */
 #undef FREE
 
-netsnmp_feature_child_of(system_all, libnetsnmp)
+netsnmp_feature_child_of(system_all, libnetsnmp);
 
-netsnmp_feature_child_of(user_information, system_all)
-netsnmp_feature_child_of(calculate_sectime_diff, system_all)
+netsnmp_feature_child_of(user_information, system_all);
+netsnmp_feature_child_of(calculate_sectime_diff, system_all);
 
 #ifndef IFF_LOOPBACK
 #	define IFF_LOOPBACK 0
@@ -220,7 +228,7 @@ _daemon_prep(int stderr_log)
     int fd;
 
     /* Avoid keeping any directory in use. */
-    chdir("/");
+    NETSNMP_IGNORE_RESULT(chdir("/"));
 
     if (stderr_log)
         return;
@@ -275,7 +283,7 @@ netsnmp_daemonize(int quit_immediately,
     int i = 0;
     DEBUGMSGT(("daemonize","deamonizing...\n"));
 #if HAVE_FORK
-#if defined(darwin9)
+#if HAVE__NSGETEXECUTABLEPATH
      char            path [PATH_MAX] = "";
      uint32_t        size = sizeof (path);
 
@@ -341,7 +349,7 @@ netsnmp_daemonize(int quit_immediately,
             
             DEBUGMSGT(("daemonize","child continuing\n"));
 
-#if ! defined(darwin9)
+#if !defined(HAVE__NSGETARGV)
             _daemon_prep(stderr_log);
 #else
              /*
@@ -697,11 +705,12 @@ get_uptime(void)
     u_long          lbolt = 0;
 
     if (ksc) {
-        ks = kstat_lookup(ksc, "unix", -1, "system_misc");
+        ks = kstat_lookup(ksc, NETSNMP_REMOVE_CONST(char *, "unix"), -1,
+                          NETSNMP_REMOVE_CONST(char *, "system_misc"));
         if (ks) {
             kid = kstat_read(ksc, ks, NULL);
             if (kid != -1) {
-                named = kstat_data_lookup(ks, "lbolt");
+                named = kstat_data_lookup(ks, NETSNMP_REMOVE_CONST(char *, "lbolt"));
                 if (named) {
 #ifdef KSTAT_DATA_UINT32
                     lbolt = named->value.ui32;
@@ -762,28 +771,6 @@ netsnmp_validator_context(void)
 int
 netsnmp_gethostbyname_v4(const char* name, in_addr_t *addr_out)
 {
-    static int use_dns_workaround = -1;
-
-    if (use_dns_workaround < 0)
-        use_dns_workaround = getenv("NETSNMP_DNS_WORKAROUND") != 0;
-    if (use_dns_workaround) {
-        /*
-         * A hack that avoids that T070com2sec_simple fails due to the DNS
-         * client filtering out 127.0.0.x addresses and/or redirecting DNS
-         * resolution failures to a web page.
-         */
-        if (strcmp(name, "onea.net-snmp.org") == 0) {
-            *addr_out = htonl(INADDR_LOOPBACK);
-            return 0;
-        } else if (strcmp(name, "twoa.net-snmp.org") == 0) {
-            *addr_out = htonl(INADDR_LOOPBACK + 1);
-            return 0;
-        } else if (strcmp(name, "no.such.address.") == 0) {
-            return -1;
-        }
-    }
-
-    {
 #if HAVE_GETADDRINFO
     struct addrinfo *addrs = NULL;
     struct addrinfo hint;
@@ -848,7 +835,6 @@ netsnmp_gethostbyname_v4(const char* nam
 #else /* HAVE_GETIPNODEBYNAME */
     return -1;
 #endif
-    }
 }
 
 int
@@ -1052,7 +1038,7 @@ netsnmp_gethostbyaddr(const void *addr,
 
 /*******************************************************************/
 
-#ifndef HAVE_STRNCASECMP
+#if !defined(HAVE_STRNCASECMP) && !defined(strncasecmp)
 
 /*
  * test for NULL pointers before and NULL characters after
@@ -1101,7 +1087,7 @@ strcasecmp(const char *s1, const char *s
     return strncasecmp(s1, s2, 1000000);
 }
 
-#endif                          /* HAVE_STRNCASECMP */
+#endif                /* !defined(HAVE_STRNCASECMP) && !defined(strncasecmp) */
 
 
 #ifndef HAVE_STRDUP
@@ -1142,7 +1128,7 @@ setenv(const char *name, const char *val
 }
 #endif                          /* HAVE_SETENV */
 
-netsnmp_feature_child_of(calculate_time_diff, netsnmp_unused)
+netsnmp_feature_child_of(calculate_time_diff, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_CALCULATE_TIME_DIFF
 /**
  * Compute (*now - *then) in centiseconds.
@@ -1423,7 +1409,7 @@ netsnmp_os_kernel_width(void)
 #endif
 }
 
-netsnmp_feature_child_of(str_to_uid, user_information)
+netsnmp_feature_child_of(str_to_uid, user_information);
 #ifndef NETSNMP_FEATURE_REMOVE_STR_TO_UID
 /**
  * Convert a user name or number into numeric form.
@@ -1456,7 +1442,7 @@ int netsnmp_str_to_uid(const char *usero
 }
 #endif /* NETSNMP_FEATURE_REMOVE_STR_TO_UID */
 
-netsnmp_feature_child_of(str_to_gid, user_information)
+netsnmp_feature_child_of(str_to_gid, user_information);
 #ifndef NETSNMP_FEATURE_REMOVE_STR_TO_GID
 /**
  * Convert a group name or number into numeric form.
diff -urpN net-snmp-5.8/snmplib/text_utils.c net-snmp-5.9.1/snmplib/text_utils.c
--- net-snmp-5.8/snmplib/text_utils.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/text_utils.c	2021-05-26 05:19:35.000000000 +0700
@@ -33,21 +33,17 @@
 
 #include <errno.h>
 
-#if HAVE_DMALLOC_H
-#  include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/library/snmp_debug.h>
 #include <net-snmp/library/container.h>
 #include <net-snmp/library/file_utils.h>
 #include <net-snmp/library/text_utils.h>
 
-netsnmp_feature_child_of(text_utils, libnetsnmp)
+netsnmp_feature_child_of(text_utils, libnetsnmp);
 
-netsnmp_feature_provide(text_utils)
+netsnmp_feature_provide(text_utils);
 #ifdef NETSNMP_FEATURE_REQUIRE_TEXT_UTILS
-netsnmp_feature_require(file_utils)
+netsnmp_feature_require(file_utils);
 #endif /* NETSNMP_FEATURE_REQUIRE_TEXT_UTILS */
 
 #ifndef NETSNMP_FEATURE_REMOVE_TEXT_UTILS
@@ -157,7 +153,7 @@ netsnmp_file_text_parse(netsnmp_file *f,
     return c;
 }
 
-netsnmp_feature_child_of(text_token_container_from_file, netsnmp_unused)
+netsnmp_feature_child_of(text_token_container_from_file, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE_TEXT_TOKEN_CONTAINER_FROM_FILE
 netsnmp_container *
 netsnmp_text_token_container_from_file(const char *file, u_int flags,
diff -urpN net-snmp-5.8/snmplib/tools.c net-snmp-5.9.1/snmplib/tools.c
--- net-snmp-5.8/snmplib/tools.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/tools.c	2021-05-26 05:19:35.000000000 +0700
@@ -22,6 +22,9 @@
 #include <net-snmp/net-snmp-features.h>
 
 #include <ctype.h>
+#ifdef HAVE_INTTYPES_H
+#include <inttypes.h>
+#endif
 #include <stdio.h>
 #include <sys/types.h>
 #if TIME_WITH_SYS_TIME
@@ -64,9 +67,6 @@
 #if HAVE_UNISTD_H
 #include <unistd.h>
 #endif
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
@@ -77,23 +77,23 @@
 #include <net-snmp/library/mib.h>
 #include <net-snmp/library/scapi.h>
 
-netsnmp_feature_child_of(tools_all, libnetsnmp)
+netsnmp_feature_child_of(tools_all, libnetsnmp);
 
-netsnmp_feature_child_of(memory_wrappers, tools_all)
-netsnmp_feature_child_of(valgrind, tools_all)
-netsnmp_feature_child_of(string_time_to_secs, tools_all)
-netsnmp_feature_child_of(netsnmp_check_definedness, valgrind)
-
-netsnmp_feature_child_of(uatime_ready, netsnmp_unused)
-netsnmp_feature_child_of(timeval_tticks, netsnmp_unused)
-
-netsnmp_feature_child_of(memory_strdup, memory_wrappers)
-netsnmp_feature_child_of(memory_calloc, memory_wrappers)
-netsnmp_feature_child_of(memory_malloc, memory_wrappers)
-netsnmp_feature_child_of(memory_realloc, memory_wrappers)
-netsnmp_feature_child_of(memory_free, memory_wrappers)
+netsnmp_feature_child_of(memory_wrappers, tools_all);
+netsnmp_feature_child_of(valgrind, tools_all);
+netsnmp_feature_child_of(string_time_to_secs, tools_all);
+netsnmp_feature_child_of(netsnmp_check_definedness, valgrind);
+
+netsnmp_feature_child_of(uatime_ready, netsnmp_unused);
+netsnmp_feature_child_of(timeval_tticks, netsnmp_unused);
+
+netsnmp_feature_child_of(memory_strdup, memory_wrappers);
+netsnmp_feature_child_of(memory_calloc, memory_wrappers);
+netsnmp_feature_child_of(memory_malloc, memory_wrappers);
+netsnmp_feature_child_of(memory_realloc, memory_wrappers);
+netsnmp_feature_child_of(memory_free, memory_wrappers);
 
-#ifndef NETSNMP_FEATURE_REMOVE_MEMORY_WRAPPERS
+#ifndef NETSNMP_FEATURE_REMOVE_MEMORY_STRDUP
 /**
  * This function is a wrapper for the strdup function.
  *
@@ -300,7 +300,7 @@ void *netsnmp_memdup(const void *from, s
  *
  * @param[in] from Pointer to copy memory from.
  * @param[in] from_size Size of the data to be copied.
- * @param[out] new_size Pointer to size var for new block (OPTIONAL)
+ * @param[out] to_size Pointer to size var for new block (OPTIONAL)
  *
  * @return Pointer to the duplicated memory block, or NULL if memory allocation
  * failed.
@@ -1319,29 +1319,29 @@ int netsnmp_setenv(const char *envname,
 int
 netsnmp_addrstr_hton(char *ptr, size_t len)
 {
-#ifndef WORDS_BIGENDIAN
     char tmp[8];
     
-    if (8 == len) {
-        tmp[0] = ptr[6];
-        tmp[1] = ptr[7];
-        tmp[2] = ptr[4];
-        tmp[3] = ptr[5];
-        tmp[4] = ptr[2];
-        tmp[5] = ptr[3];
-        tmp[6] = ptr[0];
-        tmp[7] = ptr[1];
-        memcpy (ptr, &tmp, 8);
-    }
-    else if (32 == len) {
-        netsnmp_addrstr_hton(ptr   , 8);
-        netsnmp_addrstr_hton(ptr+8 , 8);
-        netsnmp_addrstr_hton(ptr+16, 8);
-        netsnmp_addrstr_hton(ptr+24, 8);
+    if (!NETSNMP_BIGENDIAN) {
+        if (8 == len) {
+            tmp[0] = ptr[6];
+            tmp[1] = ptr[7];
+            tmp[2] = ptr[4];
+            tmp[3] = ptr[5];
+            tmp[4] = ptr[2];
+            tmp[5] = ptr[3];
+            tmp[6] = ptr[0];
+            tmp[7] = ptr[1];
+            memcpy(ptr, &tmp, 8);
+        }
+        else if (32 == len) {
+            netsnmp_addrstr_hton(ptr,      8);
+            netsnmp_addrstr_hton(ptr + 8,  8);
+            netsnmp_addrstr_hton(ptr + 16, 8);
+            netsnmp_addrstr_hton(ptr + 24, 8);
+        }
+        else
+            return -1;
     }
-    else
-        return -1;
-#endif
 
     return 0;
 }
diff -urpN net-snmp-5.8/snmplib/transports/snmpAAL5PVCDomain.c net-snmp-5.9.1/snmplib/transports/snmpAAL5PVCDomain.c
--- net-snmp-5.8/snmplib/transports/snmpAAL5PVCDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpAAL5PVCDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -23,10 +23,6 @@
 #endif
 #include <atm.h>
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 #include <net-snmp/config_api.h>
@@ -378,7 +374,6 @@ netsnmp_aal5pvc_ctor(void)
     aal5pvcDomain.prefix[0] = "aal5pvc";
     aal5pvcDomain.prefix[1] = "pvc";
 
-    aal5pvcDomain.f_create_from_tstring     = NULL;
     aal5pvcDomain.f_create_from_tstring_new = netsnmp_aal5pvc_create_tstring;
     aal5pvcDomain.f_create_from_ostring     = netsnmp_aal5pvc_create_ostring;
 
diff -urpN net-snmp-5.8/snmplib/transports/snmpAliasDomain.c net-snmp-5.9.1/snmplib/transports/snmpAliasDomain.c
--- net-snmp-5.8/snmplib/transports/snmpAliasDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpAliasDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -19,10 +19,6 @@
 #include <unistd.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
@@ -105,7 +101,6 @@ netsnmp_alias_ctor(void)
     aliasDomain.prefix = (const char **)calloc(2, sizeof(char *));
     aliasDomain.prefix[0] = "alias";
 
-    aliasDomain.f_create_from_tstring     = NULL;
     aliasDomain.f_create_from_tstring_new = netsnmp_alias_create_tstring;
     aliasDomain.f_create_from_ostring     = netsnmp_alias_create_ostring;
 
diff -urpN net-snmp-5.8/snmplib/transports/snmpCallbackDomain.c net-snmp-5.9.1/snmplib/transports/snmpCallbackDomain.c
--- net-snmp-5.8/snmplib/transports/snmpCallbackDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpCallbackDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -34,10 +34,6 @@
 #include <fcntl.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 #include <net-snmp/config_api.h>
diff -urpN net-snmp-5.8/snmplib/transports/snmpDTLSUDPDomain.c net-snmp-5.9.1/snmplib/transports/snmpDTLSUDPDomain.c
--- net-snmp-5.8/snmplib/transports/snmpDTLSUDPDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpDTLSUDPDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -20,9 +20,10 @@
 
 #include <net-snmp/net-snmp-features.h>
 
-netsnmp_feature_require(cert_util)
-netsnmp_feature_require(sockaddr_size)
+netsnmp_feature_require(cert_util);
+netsnmp_feature_require(sockaddr_size);
 
+#include <net-snmp/library/snmpIPBaseDomain.h>
 #include <net-snmp/library/snmpDTLSUDPDomain.h>
 #include <net-snmp/library/snmpUDPIPv6Domain.h>
 #include <net-snmp/library/snmp_assert.h>
@@ -59,9 +60,7 @@ netsnmp_feature_require(sockaddr_size)
 #include <sys/uio.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
+#include "../memcheck.h"
 
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
@@ -508,6 +507,7 @@ _netsnmp_send_queued_dtls_pkts(netsnmp_t
         DEBUGMSGTL(("dtlsudp", "have %d bytes to send\n", outsize));
 
         outsize = BIO_read(cachep->write_bio, outbuf, outsize);
+        MAKE_MEM_DEFINED(outbuf, outsize);
         sa = NETSNMP_REMOVE_CONST(struct sockaddr *,
                                   _find_remote_sockaddr(t, NULL, 0, &socksize));
         if (NULL == sa)
@@ -667,7 +667,7 @@ netsnmp_dtlsudp_recv(netsnmp_transport *
         if (rc > 0) {
             if (olen > sizeof(*addr_pair))
                 snmp_log(LOG_ERR, "%s: from address length %d > %d\n",
-                         __func__, olen, (int)sizeof(*addr_pair));
+                         NETSNMP_FUNCTION, olen, (int)sizeof(*addr_pair));
             memcpy(addr_pair, opaque, SNMP_MIN(sizeof(*addr_pair), olen));
         }
         SNMP_FREE(opaque);
@@ -780,6 +780,9 @@ netsnmp_dtlsudp_recv(netsnmp_transport *
        net-snmp select loop because it's already been pulled
        out; need to deal with this) */
     rc = SSL_read(tlsdata->ssl, buf, size);
+    MAKE_MEM_DEFINED(&rc, sizeof(rc));
+    if (rc > 0)
+        MAKE_MEM_DEFINED(buf, rc);
 
     /*
      * moved netsnmp_openssl_null_checks to netsnmp_tlsbase_wrapup_recv.
@@ -812,6 +815,9 @@ netsnmp_dtlsudp_recv(netsnmp_transport *
         /* retry reading */
         DEBUGMSGTL(("9:dtlsudp", "recalling ssl_read\n")); 
         rc = SSL_read(tlsdata->ssl, buf, size);
+        MAKE_MEM_DEFINED(&rc, sizeof(rc));
+        if (rc > 0)
+            MAKE_MEM_DEFINED(buf, rc);
     }
 
     if (rc == -1) {
@@ -820,7 +826,7 @@ netsnmp_dtlsudp_recv(netsnmp_transport *
         DEBUGMSGTL(("9:dtlsudp", "no decoded data from dtls\n"));
 
         if (SSL_get_error(tlsdata->ssl, rc) == SSL_ERROR_WANT_READ) {
-            DEBUGMSGTL(("9dtlsudp","here: want read!\n"));
+            DEBUGMSGTL(("9:dtlsudp", "ssl error want read\n"));
 
             /* see if we have buffered write date to send out first */
             if (cachep->write_cache) {
@@ -1260,6 +1266,7 @@ netsnmp_dtlsudp_send(netsnmp_transport *
     if (!outbuf)
         return -1;
     rc = BIO_read(cachep->write_bio, outbuf, rc);
+    MAKE_MEM_DEFINED(outbuf, rc);
     socksize = netsnmp_sockaddr_size(&cachep->sas.sa);
     sa = &cachep->sas.sa;
     rc = t->base_transport->f_send(t, outbuf, rc, &sa, &socksize);
@@ -1316,7 +1323,7 @@ netsnmp_dtlsudp_close(netsnmp_transport
         void *opaque = NULL;
         int opaque_len = 0;
         fd_set readfs;
-        struct timeval tv;
+        NETSNMP_SELECT_TIMEVAL tv;
  
         DEBUGMSGTL(("dtlsudp:close",
 		    "%" NETSNMP_PRIz "d bytes remain in write_cache\n",
@@ -1394,7 +1401,7 @@ netsnmp_dtlsudp_fmtaddr(netsnmp_transpor
                                                netsnmp_transport *t,
                                                const void *data, int len))
 {
-    if (t && !data) {
+    if (!data) {
         data = t->data;
         len = t->data_length;
     }
@@ -1405,8 +1412,20 @@ netsnmp_dtlsudp_fmtaddr(netsnmp_transpor
     case sizeof(netsnmp_tmStateReference): {
         const netsnmp_tmStateReference *r = data;
         const netsnmp_indexed_addr_pair *p = &r->addresses;
+        netsnmp_transport *bt = t->base_transport;
+
+        if (r->have_addresses) {
+            return fmt_base_addr("DTLSUDP", t, p, sizeof(*p));
+        } else if (bt && t->data_length == sizeof(_netsnmpTLSBaseData)) {
+            _netsnmpTLSBaseData *tlsdata = t->data;
+            netsnmp_indexed_addr_pair *tls_addr = tlsdata->addr;
 
-        return fmt_base_addr("DTLSUDP", t, p, sizeof(*p));
+            return bt->f_fmtaddr(bt, tls_addr, sizeof(*tls_addr));
+        } else if (bt) {
+            return bt->f_fmtaddr(bt, t->data, t->data_length);
+        } else {
+            return strdup("DTLSUDP: unknown");
+        }
     }
     case sizeof(_netsnmpTLSBaseData): {
         const _netsnmpTLSBaseData *b = data;
@@ -1494,17 +1513,22 @@ _transport_common(netsnmp_transport *t,
 }
 
 netsnmp_transport *
-netsnmp_dtlsudp_transport(const struct sockaddr_in *addr, int local)
+netsnmp_dtlsudp_transport(const struct netsnmp_ep *ep, int local)
 {
-    netsnmp_transport *t = NULL;
+    const struct sockaddr_in *addr = &ep->a.sin;
+    netsnmp_transport *t, *t2;
 
     DEBUGTRACETOK("dtlsudp");
 
-    t = netsnmp_udp_transport(addr, local);
+    t = netsnmp_udp_transport(ep, local);
     if (NULL == t)
         return NULL;
 
-    _transport_common(t, local);
+    t2 = _transport_common(t, local);
+    if (!t2) {
+        netsnmp_transport_free(t);
+        return NULL;
+    }
 
     if (!local) {
         /* dtls needs to bind the socket for SSL_write to work */
@@ -1512,7 +1536,7 @@ netsnmp_dtlsudp_transport(const struct s
             snmp_log(LOG_ERR, "dtls: failed to connect\n");
     }
 
-    return t;
+    return t2;
 }
 
 
@@ -1532,17 +1556,22 @@ netsnmp_dtlsudp6_fmtaddr(netsnmp_transpo
  */
 
 netsnmp_transport *
-netsnmp_dtlsudp6_transport(const struct sockaddr_in6 *addr, int local)
+netsnmp_dtlsudp6_transport(const struct netsnmp_ep *ep, int local)
 {
-    netsnmp_transport *t = NULL;
+    const struct sockaddr_in6 *addr = &ep->a.sin6;
+    netsnmp_transport *t, *t2;
 
     DEBUGTRACETOK("dtlsudp");
 
-    t = netsnmp_udp6_transport(addr, local);
+    t = netsnmp_udp6_transport(ep, local);
     if (NULL == t)
         return NULL;
 
-    _transport_common(t, local);
+    t2 = _transport_common(t, local);
+    if (!t2) {
+        netsnmp_transport_free(t);
+        return NULL;
+    }
 
     if (!local) {
         /* dtls needs to bind the socket for SSL_write to work */
@@ -1553,10 +1582,10 @@ netsnmp_dtlsudp6_transport(const struct
     /* XXX: Potentially set sock opts here (SO_SNDBUF/SO_RCV_BUF) */      
     /* XXX: and buf size */        
 
-    t->f_fmtaddr       = netsnmp_dtlsudp6_fmtaddr;
-    t->f_get_taddr     = netsnmp_ipv6_get_taddr;
+    t2->f_fmtaddr   = netsnmp_dtlsudp6_fmtaddr;
+    t2->f_get_taddr = netsnmp_ipv6_get_taddr;
 
-    return t;
+    return t2;
 }
 #endif
 
@@ -1565,19 +1594,16 @@ netsnmp_transport *
 netsnmp_dtlsudp_create_tstring(const char *str, int isserver,
                                const char *default_target)
 {
-#ifdef NETSNMP_TRANSPORT_UDPIPV6_DOMAIN
-    struct sockaddr_in6 addr6;
-#endif
-    struct sockaddr_in addr;
+    struct netsnmp_ep ep;
     netsnmp_transport *t;
     _netsnmpTLSBaseData *tlsdata;
     char buf[SPRINT_MAX_LEN], *cp;
 
-    if (netsnmp_sockaddr_in2(&addr, str, default_target))
-        t = netsnmp_dtlsudp_transport(&addr, isserver);
+    if (netsnmp_sockaddr_in3(&ep, str, default_target))
+        t = netsnmp_dtlsudp_transport(&ep, isserver);
 #ifdef NETSNMP_TRANSPORT_UDPIPV6_DOMAIN
-    else if (netsnmp_sockaddr_in6_2(&addr6, str, default_target))
-        t = netsnmp_dtlsudp6_transport(&addr6, isserver);
+    else if (netsnmp_sockaddr_in6_3(&ep, str, default_target))
+        t = netsnmp_dtlsudp6_transport(&ep, isserver);
 #endif
     else
         return NULL;
@@ -1603,14 +1629,14 @@ netsnmp_dtlsudp_create_tstring(const cha
 netsnmp_transport *
 netsnmp_dtlsudp_create_ostring(const void *o, size_t o_len, int local)
 {
-    struct sockaddr_in sin;
-    struct sockaddr_in6 sin6;
+    struct netsnmp_ep ep;
 
-    if (netsnmp_ipv4_ostring_to_sockaddr(&sin, o, o_len))
-        return netsnmp_dtlsudp_transport(&sin, local);
+    memset(&ep, 0, sizeof(ep));
+    if (netsnmp_ipv4_ostring_to_sockaddr(&ep.a.sin, o, o_len))
+        return netsnmp_dtlsudp_transport(&ep, local);
 #ifdef NETSNMP_TRANSPORT_UDPIPV6_DOMAIN
-    else if (netsnmp_ipv6_ostring_to_sockaddr(&sin6, o, o_len))
-        return netsnmp_dtlsudp6_transport(&sin6, local);
+    else if (netsnmp_ipv6_ostring_to_sockaddr(&ep.a.sin6, o, o_len))
+        return netsnmp_dtlsudp6_transport(&ep, local);
 #endif
     else
         return NULL;
@@ -1647,7 +1673,6 @@ netsnmp_dtlsudp_ctor(void)
     for (i = 0; i < num_prefixes; ++ i)
         dtlsudpDomain.prefix[i] = prefixes[i];
 
-    dtlsudpDomain.f_create_from_tstring     = NULL;
     dtlsudpDomain.f_create_from_tstring_new = netsnmp_dtlsudp_create_tstring;
     dtlsudpDomain.f_create_from_ostring     = netsnmp_dtlsudp_create_ostring;
 
@@ -1681,6 +1706,7 @@ int netsnmp_dtls_gen_cookie(SSL *ssl, un
             snmp_log(LOG_ERR, "dtls: error setting random cookie secret\n");
             return 0;
         }
+        MAKE_MEM_DEFINED(cookie_secret, NETSNMP_COOKIE_SECRET_LENGTH);
         cookie_initialized = 1;
     }
 
@@ -1739,13 +1765,14 @@ int netsnmp_dtls_gen_cookie(SSL *ssl, un
 #endif
     default:
         snmp_log(LOG_ERR, "dtls: unknown address family generating a cookie\n");
+        free(buffer);
         return 0;
     }
 
     /* Calculate HMAC of buffer using the secret */
     HMAC(EVP_sha1(), cookie_secret, NETSNMP_COOKIE_SECRET_LENGTH,
          buffer, length, result, &resultlength);
-    OPENSSL_free(buffer);
+    free(buffer);
 
     memcpy(cookie, result, resultlength);
     *cookie_len = resultlength;
@@ -1826,13 +1853,14 @@ int netsnmp_dtls_verify_cookie(SSL *ssl,
         snmp_log(LOG_ERR,
                  "dtls: unknown address family %d generating a cookie\n",
                  peer->sa.sa_family);
+        free(buffer);
         return 0;
     }
 
     /* Calculate HMAC of buffer using the secret */
     HMAC(EVP_sha1(), cookie_secret, NETSNMP_COOKIE_SECRET_LENGTH,
          buffer, length, result, &resultlength);
-    OPENSSL_free(buffer);
+    free(buffer);
 
     if (cookie_len != resultlength || memcmp(result, cookie, resultlength) != 0)
         rc = 0;
diff -urpN net-snmp-5.8/snmplib/transports/snmpIPBaseDomain.c net-snmp-5.9.1/snmplib/transports/snmpIPBaseDomain.c
--- net-snmp-5.8/snmplib/transports/snmpIPBaseDomain.c	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpIPBaseDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,121 @@
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/types.h>
+#include <net-snmp/library/system.h>
+#include <net-snmp/library/snmpIPBaseDomain.h>
+#include <ctype.h>
+#include <errno.h>
+#include <stdlib.h>
+#include <string.h>
+
+static int netsnmp_isnumber(const char *cp)
+{
+    if (!*cp)
+        return 0;
+
+    while (isdigit((unsigned char)*cp))
+        cp++;
+    return *cp == '\0';
+}
+
+/**
+ * Parse a Net-SNMP endpoint name.
+ * @ep_str: Parsed endpoint name.
+ * @endpoint: Endpoint specification in the format
+ *   <address>[@<iface>]:[<port>], <address>[@<iface>] or <port>.
+ *
+ * Only overwrite those fields of *@ep_str that have been set in
+ * @endpoint. Returns 1 upon success and 0 upon failure.
+ */
+int netsnmp_parse_ep_str(struct netsnmp_ep_str *ep_str, const char *endpoint)
+{
+    char *dup, *cp, *addrstr = NULL, *iface = NULL, *portstr = NULL;
+    unsigned port;
+
+    if (!endpoint)
+        return 0;
+
+    dup = strdup(endpoint);
+    if (!dup)
+        return 0;
+
+    cp = dup;
+    if (netsnmp_isnumber(cp)) {
+        portstr = cp;
+    } else {
+        if (*cp == '[') {
+            addrstr = cp + 1;
+            cp = strchr(cp, ']');
+            if (cp) {
+                cp[0] = '\0';
+                cp++;
+            } else {
+                goto invalid;
+            }
+        } else if (*cp != '@' && (*cp != ':' || cp[1] == ':')) {
+            addrstr = cp;
+            cp = strchr(addrstr, '@');
+            if (!cp) {
+                cp = strrchr(addrstr, ':');
+                if (cp && strchr(dup, ':') < cp)
+                    cp = NULL;
+            }
+        }
+        if (cp && *cp == '@') {
+            *cp = '\0';
+            iface = cp + 1;
+            cp = strchr(cp + 1, ':');
+        }
+        if (cp && *cp == ':') {
+            *cp++ = '\0';
+            portstr = cp;
+            if (!netsnmp_isnumber(cp))
+                goto invalid;
+        } else if (cp && *cp) {
+            goto invalid;
+        }
+    }
+
+    if (addrstr)
+        strlcpy(ep_str->addr, addrstr, sizeof(ep_str->addr));
+    if (iface)
+        strlcpy(ep_str->iface, iface, sizeof(ep_str->iface));
+    if (portstr) {
+        port = atoi(portstr);
+        if (port <= 0xffff)
+            strlcpy(ep_str->port, portstr, sizeof(ep_str->port));
+        else
+            goto invalid;
+    }
+
+    free(dup);
+    return 1;
+
+invalid:
+    free(dup);
+    return 0;
+}
+
+int netsnmp_bindtodevice(int fd, const char *iface)
+{
+    /* If no interface name has been specified, report success. */
+    if (!iface || iface[0] == '\0')
+        return 0;
+
+#ifdef HAVE_SO_BINDTODEVICE
+    /*
+     * +1 to work around the Linux kernel bug that the passed in name is not
+     * '\0'-terminated.
+     */
+    int ifacelen = strlen(iface) + 1;
+    int ret;
+
+    ret = setsockopt(fd, SOL_SOCKET, SO_BINDTODEVICE, iface, ifacelen);
+    if (ret < 0)
+        snmp_log(LOG_ERR, "Binding socket to interface %s failed: %s\n", iface,
+                 strerror(errno));
+    return ret;
+#else
+    errno = EINVAL;
+    return -1;
+#endif
+}
diff -urpN net-snmp-5.8/snmplib/transports/snmpIPXDomain.c net-snmp-5.9.1/snmplib/transports/snmpIPXDomain.c
--- net-snmp-5.8/snmplib/transports/snmpIPXDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpIPXDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -25,10 +25,6 @@
 #include <netinet/in.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 #include <net-snmp/config_api.h>
@@ -483,7 +479,6 @@ netsnmp_ipx_ctor(void)
     ipxDomain.prefix = (const char**)calloc(2, sizeof(char *));
     ipxDomain.prefix[0] = "ipx";
 
-    ipxDomain.f_create_from_tstring     = NULL;
     ipxDomain.f_create_from_tstring_new = netsnmp_ipx_create_tstring;
     ipxDomain.f_create_from_ostring     = netsnmp_ipx_create_ostring;
 
diff -urpN net-snmp-5.8/snmplib/transports/snmpIPv4BaseDomain.c net-snmp-5.9.1/snmplib/transports/snmpIPv4BaseDomain.c
--- net-snmp-5.8/snmplib/transports/snmpIPv4BaseDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpIPv4BaseDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -4,6 +4,7 @@
 #include <net-snmp/net-snmp-config.h>
 
 #include <net-snmp/types.h>
+#include <net-snmp/library/snmpIPBaseDomain.h>
 #include <net-snmp/library/snmpIPv4BaseDomain.h>
 #include <net-snmp/library/snmp_assert.h>
 
@@ -56,122 +57,69 @@ int
 netsnmp_sockaddr_in2(struct sockaddr_in *addr,
                      const char *inpeername, const char *default_target)
 {
+    struct netsnmp_ep ep;
     int ret;
 
-    if (addr == NULL) {
+    ret = netsnmp_sockaddr_in3(&ep, inpeername, default_target);
+    if (ret == 0)
+        return 0;
+    *addr = ep.a.sin;
+    return ret;
+}
+
+int
+netsnmp_sockaddr_in3(struct netsnmp_ep *ep,
+                     const char *inpeername, const char *default_target)
+{
+    struct sockaddr_in *addr = &ep->a.sin;
+    struct netsnmp_ep_str ep_str;
+    int port, ret;
+
+    if (!ep)
         return 0;
-    }
 
     DEBUGMSGTL(("netsnmp_sockaddr_in",
                 "addr %p, inpeername \"%s\", default_target \"%s\"\n",
-                addr, inpeername ? inpeername : "[NIL]",
+                ep, inpeername ? inpeername : "[NIL]",
                 default_target ? default_target : "[NIL]"));
 
-    memset(addr, 0, sizeof(struct sockaddr_in));
+    memset(ep, 0, sizeof(*ep));
     addr->sin_addr.s_addr = htonl(INADDR_ANY);
     addr->sin_family = AF_INET;
     addr->sin_port = htons((u_short)SNMP_PORT);
 
-    {
-	int port = netsnmp_ds_get_int(NETSNMP_DS_LIBRARY_ID,
-				      NETSNMP_DS_LIB_DEFAULT_PORT);
-
-	if (port != 0) {
-	    addr->sin_port = htons((u_short)port);
-	} else if (default_target != NULL)
-	    netsnmp_sockaddr_in2(addr, default_target, NULL);
-    }
-
-    if (inpeername != NULL && *inpeername != '\0') {
-	const char     *host, *port;
-	char           *peername = NULL;
-        char           *cp;
-        /*
-         * Duplicate the peername because we might want to mank around with
-         * it.
-         */
-
-        peername = strdup(inpeername);
-        if (peername == NULL) {
-            return 0;
-        }
-
-        /*
-         * Try and extract an appended port number.
-         */
-        cp = strchr(peername, ':');
-        if (cp != NULL) {
-            *cp = '\0';
-            port = cp + 1;
-            host = peername;
-        } else {
-            host = NULL;
-            port = peername;
-        }
-
-        /*
-         * Try to convert the user port specifier
-         */
-        if (port && *port == '\0')
-            port = NULL;
-
-        if (port != NULL) {
-            long int l;
-            char* ep;
-
-            DEBUGMSGTL(("netsnmp_sockaddr_in", "check user service %s\n",
-                        port));
-
-            l = strtol(port, &ep, 10);
-            if (ep != port && *ep == '\0' && 0 <= l && l <= 0x0ffff)
-                addr->sin_port = htons((u_short)l);
-            else {
-                if (host == NULL) {
-                    DEBUGMSGTL(("netsnmp_sockaddr_in",
-                                "servname not numeric, "
-				"check if it really is a destination)\n"));
-                    host = port;
-                    port = NULL;
-                } else {
-                    DEBUGMSGTL(("netsnmp_sockaddr_in",
-                                "servname not numeric\n"));
-                    free(peername);
-                    return 0;
-                }
-            }
-        }
+    memset(&ep_str, 0, sizeof(ep_str));
+    port = netsnmp_ds_get_int(NETSNMP_DS_LIBRARY_ID,
+                              NETSNMP_DS_LIB_DEFAULT_PORT);
+    if (port != 0)
+        snprintf(ep_str.port, sizeof(ep_str.port), "%d", port);
+    else if (default_target &&
+             !netsnmp_parse_ep_str(&ep_str, default_target))
+            snmp_log(LOG_ERR, "Invalid default target %s\n",
+                     default_target);
+    if (inpeername && *inpeername != '\0' &&
+        !netsnmp_parse_ep_str(&ep_str, inpeername))
+        return 0;
 
+    if (ep_str.port[0])
+        addr->sin_port = htons(atoi(ep_str.port));
+    if (ep_str.iface[0])
+        strlcpy(ep->iface, ep_str.iface, sizeof(ep->iface));
+    if (strcmp(ep_str.addr, "255.255.255.255") == 0) {
         /*
-         * Try to convert the user host specifier
+         * The explicit broadcast address hack
          */
-        if (host && *host == '\0')
-            host = NULL;
-
-        if (host != NULL) {
+        DEBUGMSGTL(("netsnmp_sockaddr_in", "Explicit UDP broadcast\n"));
+        addr->sin_addr.s_addr = INADDR_NONE;
+    } else if (strcmp(ep_str.addr, "") != 0) {
+        ret = netsnmp_gethostbyname_v4(ep_str.addr, &addr->sin_addr.s_addr);
+        if (ret < 0) {
             DEBUGMSGTL(("netsnmp_sockaddr_in",
-                        "check destination %s\n", host));
-
-
-            if (strcmp(peername, "255.255.255.255") == 0 ) {
-                /*
-                 * The explicit broadcast address hack
-                 */
-                DEBUGMSGTL(("netsnmp_sockaddr_in", "Explicit UDP broadcast\n"));
-                addr->sin_addr.s_addr = INADDR_NONE;
-            } else {
-                ret =
-                    netsnmp_gethostbyname_v4(peername, &addr->sin_addr.s_addr);
-                if (ret < 0) {
-                    DEBUGMSGTL(("netsnmp_sockaddr_in",
-                                "couldn't resolve hostname\n"));
-                    free(peername);
-                    return 0;
-                }
-                DEBUGMSGTL(("netsnmp_sockaddr_in",
-                            "hostname (resolved okay)\n"));
-            }
+                        "couldn't resolve hostname \"%s\"\n", ep_str.addr));
+            return 0;
         }
-	free(peername);
+        DEBUGMSGTL(("netsnmp_sockaddr_in",
+                    "hostname (resolved okay)\n"));
     }
 
     /*
diff -urpN net-snmp-5.8/snmplib/transports/snmpIPv6BaseDomain.c net-snmp-5.9.1/snmplib/transports/snmpIPv6BaseDomain.c
--- net-snmp-5.8/snmplib/transports/snmpIPv6BaseDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpIPv6BaseDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -15,6 +15,7 @@
 #ifdef NETSNMP_ENABLE_IPV6
 
 #include <net-snmp/types.h>
+#include <net-snmp/library/snmpIPBaseDomain.h>
 #include <net-snmp/library/snmpIPv6BaseDomain.h>
 #include <net-snmp/library/system.h>
 #include <net-snmp/library/snmp_assert.h>
@@ -47,10 +48,6 @@
 #include <net/if.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/library/snmp_debug.h>
 #include <net-snmp/library/default_store.h>
@@ -66,7 +63,7 @@
 
 
 #if defined(HAVE_WINSOCK_H) && !defined(mingw32)
-static const struct in6_addr in6addr_any = IN6ADDR_ANY_INIT;
+static const struct in6_addr in6addr_any; /*IN6ADDR_ANY_INIT*/
 #endif
 
 
@@ -77,7 +74,13 @@ netsnmp_if_nametoindex(const char *ifnam
 #if defined(WIN32)
     return atoi(ifname);
 #elif defined(HAVE_IF_NAMETOINDEX)
-    return if_nametoindex(ifname);
+    int res;
+
+    res = if_nametoindex(ifname);
+    if (res == 0)
+        res = atoi(ifname);
+
+    return res;
 #else
     return 0;
 #endif
@@ -182,305 +185,142 @@ int netsnmp_ipv6_ostring_to_sockaddr(str
     return 1;
 }
 
-int
-netsnmp_sockaddr_in6_2(struct sockaddr_in6 *addr,
-                       const char *inpeername, const char *default_target)
+static int netsnmp_resolve_v6_hostname(struct in6_addr *addr,
+                                       const char *hostname)
 {
-    char           *cp = NULL, *peername = NULL;
-    char            debug_addr[INET6_ADDRSTRLEN];
 #if HAVE_GETADDRINFO
-    struct addrinfo *addrs = NULL;
+    struct addrinfo hint = { 0 };
+    struct addrinfo *addrs;
     int             err;
+
+    hint.ai_family = PF_INET6;
+    hint.ai_socktype = SOCK_DGRAM;
+    err = netsnmp_getaddrinfo(hostname, NULL, &hint, &addrs);
+    if (err)
+        return 0;
+
+    if (addrs) {
+        DEBUGMSGTL(("netsnmp_sockaddr_in6", "hostname (resolved okay)\n"));
+        *addr = ((struct sockaddr_in6 *)addrs->ai_addr)->sin6_addr;
+        freeaddrinfo(addrs);
+    } else {
+        DEBUGMSGTL(("netsnmp_sockaddr_in6", "Failed to resolve IPv6 hostname\n"));
+    }
+    return 1;
 #elif HAVE_GETIPNODEBYNAME
-    struct hostent *hp = NULL;
+    struct hostent *hp;
     int             err;
-#elif HAVE_GETHOSTBYNAME
-    struct hostent *hp = NULL;
-#endif
-    int             portno;
 
-    if (addr == NULL) {
+    hp = getipnodebyname(hostname, AF_INET6, 0, &err);
+    if (hp == NULL) {
+        DEBUGMSGTL(("netsnmp_sockaddr_in6",
+                    "hostname (couldn't resolve = %d)\n", err));
         return 0;
     }
+    DEBUGMSGTL(("netsnmp_sockaddr_in6", "hostname (resolved okay)\n"));
+    memcpy(addr, hp->h_addr, hp->h_length);
+    return 1;
+#elif HAVE_GETHOSTBYNAME
+    struct hostent *hp;
 
-    DEBUGMSGTL(("netsnmp_sockaddr_in6_2",
-		"addr %p, peername \"%s\", default_target \"%s\"\n",
-                addr, inpeername ? inpeername : "[NIL]",
-		default_target ? default_target : "[NIL]"));
+    hp = netsnmp_gethostbyname(hostname);
+    if (hp == NULL) {
+        DEBUGMSGTL(("netsnmp_sockaddr_in6",
+                    "hostname (couldn't resolve)\n"));
+        return 0;
+    }
+    if (hp->h_addrtype != AF_INET6) {
+        DEBUGMSGTL(("netsnmp_sockaddr_in6", "hostname (not AF_INET6!)\n"));
+        return 0;
+    }
+    DEBUGMSGTL(("netsnmp_sockaddr_in6", "hostname (resolved okay)\n"));
+    memcpy(addr, hp->h_addr, hp->h_length);
+    return 1;
+#else                           /*HAVE_GETHOSTBYNAME */
+    /*
+     * There is no name resolving function available.
+     */
+    snmp_log(LOG_ERR,
+             "no getaddrinfo()/getipnodebyname()/gethostbyname()\n");
+    return 0;
+#endif                          /*HAVE_GETHOSTBYNAME */
+}
 
-    memset(addr, 0, sizeof(struct sockaddr_in6));
-    addr->sin6_family = AF_INET6;
-    addr->sin6_addr = in6addr_any;
-    addr->sin6_port = htons((u_short)SNMP_PORT);
+int
+netsnmp_sockaddr_in6_2(struct sockaddr_in6 *addr,
+                       const char *inpeername, const char *default_target)
+{
+    struct netsnmp_ep ep;
+    int ret;
 
-    {
-        int port = netsnmp_ds_get_int(NETSNMP_DS_LIBRARY_ID,
-                                      NETSNMP_DS_LIB_DEFAULT_PORT);
-        if (port != 0)
-            addr->sin6_port = htons((u_short)port);
-        else if (default_target != NULL)
-            netsnmp_sockaddr_in6_2(addr, default_target, NULL);
-    }
+    ret = netsnmp_sockaddr_in6_3(&ep, inpeername, default_target);
+    if (ret == 0)
+        return 0;
+    *addr = ep.a.sin6;
+    return ret;
+}
 
-    if (inpeername != NULL) {
-        /*
-         * Duplicate the peername because we might want to mank around with
-         * it.  
-         */
+int
+netsnmp_sockaddr_in6_3(struct netsnmp_ep *ep,
+                       const char *inpeername, const char *default_target)
+{
+    struct sockaddr_in6 *addr = &ep->a.sin6;
+    struct netsnmp_ep_str ep_str;
+    char            debug_addr[INET6_ADDRSTRLEN];
+    int             port;
 
-        peername = strdup(inpeername);
-        if (peername == NULL) {
-            return 0;
-        }
+    if (!ep)
+        return 0;
 
-        cp = peername;
-        if (*cp == ':') cp++;
-        portno = atoi(cp);
-        while (*cp && isdigit((unsigned char) *cp)) cp++;
-        if (!*cp &&  portno != 0) {
-            /*
-             * Okay, it looks like JUST a port number.  
-             */
-            DEBUGMSGTL(("netsnmp_sockaddr_in6_2", "totally numeric: %d\n",
-                        portno));
-            addr->sin6_port = htons((u_short)portno);
-            goto resolved;
-        }
+    DEBUGMSGTL(("netsnmp_sockaddr_in6",
+		"ep %p, peername \"%s\", default_target \"%s\"\n",
+                ep, inpeername ? inpeername : "[NIL]",
+		default_target ? default_target : "[NIL]"));
 
-        /*
-         * See if it is an IPv6 address covered with square brackets. Also check
-         * for an appended :port.  
-         */
-        if (*peername == '[') {
-            cp = strchr(peername, ']');
-            if (cp != NULL) {
-	      /*
-	       * See if it is an IPv6 link-local address with interface
-	       * name as <zone_id>, like fe80::1234%eth0.
-	       * Please refer to the internet draft, IPv6 Scoped Address Architecture
-	       * http://www.ietf.org/internet-drafts/draft-ietf-ipngwg-scoping-arch-04.txt
-	       *
-	       */
-	        char *scope_id;
-#if HAVE_STRUCT_SOCKADDR_IN6_SIN6_SCOPE_ID
-	        unsigned int if_index = 0;
-#endif
-                *cp = '\0';
-		scope_id = strchr(peername + 1, '%');
-		if (scope_id != NULL) {
-		    *scope_id = '\0';
-#if HAVE_STRUCT_SOCKADDR_IN6_SIN6_SCOPE_ID
-		    if_index = netsnmp_if_nametoindex(scope_id + 1);
-#endif
-		}
-                if (*(cp + 1) == ':') {
-                    portno = atoi(cp+2);
-                    if (portno != 0 &&
-                        inet_pton(AF_INET6, peername + 1,
-                                  (void *) &(addr->sin6_addr))) {
-                        DEBUGMSGTL(("netsnmp_sockaddr_in6_2",
-                                    "IPv6 address with port suffix :%d\n",
-                                    portno));
-                        if (portno > 0 && portno <= 0xffff) {
-                            addr->sin6_port = htons((u_short)portno);
-                        } else {
-                            DEBUGMSGTL(("netsnmp_sockaddr_in6_2", "invalid port number: %d", portno));
-                            free(peername);
-                            return 0;
-                        }
+    memset(ep, 0, sizeof(*ep));
+    addr->sin6_family = AF_INET6;
+    addr->sin6_addr = in6addr_any;
+    addr->sin6_port = htons(SNMP_PORT);
 
-#if defined(HAVE_STRUCT_SOCKADDR_IN6_SIN6_SCOPE_ID)
-                        addr->sin6_scope_id = if_index;
-#endif
-                        goto resolved;
-                    }
-                } else {
-                    if (inet_pton
-                        (AF_INET6, peername + 1,
-                         (void *) &(addr->sin6_addr))) {
-                        DEBUGMSGTL(("netsnmp_sockaddr_in6_2",
-                                    "IPv6 address with square brackets\n"));
-                        portno = ntohs(addr->sin6_port);
-                        if (portno == 0)
-                            portno = netsnmp_ds_get_int(NETSNMP_DS_LIBRARY_ID, 
-                                                    NETSNMP_DS_LIB_DEFAULT_PORT);
-                        if (portno <= 0)
-                            portno = SNMP_PORT;
-                        addr->sin6_port = htons((u_short)portno);
-#if defined(HAVE_STRUCT_SOCKADDR_IN6_SIN6_SCOPE_ID)
-                        addr->sin6_scope_id = if_index;
-#endif
-                        goto resolved;
-                    }
-                }
-		if (scope_id != NULL) {
-		  *scope_id = '%';
-		}
-		*cp = ']';
-            }
-        }
+    memset(&ep_str, 0, sizeof(ep_str));
+    port = netsnmp_ds_get_int(NETSNMP_DS_LIBRARY_ID,
+                              NETSNMP_DS_LIB_DEFAULT_PORT);
+    if (port != 0)
+        snprintf(ep_str.port, sizeof(ep_str.port), "%d", port);
+    else if (default_target &&
+             !netsnmp_parse_ep_str(&ep_str, default_target))
+            snmp_log(LOG_ERR, "Invalid default target %s\n",
+                     default_target);
 
-        cp = strrchr(peername, ':');
-        if (cp != NULL) {
-	    char *scope_id;
-#if HAVE_STRUCT_SOCKADDR_IN6_SIN6_SCOPE_ID
-	    unsigned int if_index = 0;
-#endif
-	    *cp = '\0';
-	    scope_id = strchr(peername + 1, '%');
-	    if (scope_id != NULL) {
-	        *scope_id = '\0';
-#if HAVE_STRUCT_SOCKADDR_IN6_SIN6_SCOPE_ID
-	        if_index = netsnmp_if_nametoindex(scope_id + 1);
-#endif
-	    }
-            portno = atoi(cp + 1);
-            if (portno != 0 &&
-                inet_pton(AF_INET6, peername,
-                          (void *) &(addr->sin6_addr))) {
-                DEBUGMSGTL(("netsnmp_sockaddr_in6_2",
-                            "IPv6 address with port suffix :%d\n",
-                            atoi(cp + 1)));
-                if (portno > 0 && portno <= 0xffff) {
-                    addr->sin6_port = htons((u_short)portno);
-                } else {
-                    DEBUGMSGTL(("netsnmp_sockaddr_in6_2", "invalid port number: %d", portno));
-                    free(peername);
-                    return 0;
-                }
+    if (!inpeername || !netsnmp_parse_ep_str(&ep_str, inpeername))
+        return 0;
 
+    if (ep_str.port[0])
+        addr->sin6_port = htons(atoi(ep_str.port));
+    if (ep_str.iface[0])
+        strlcpy(ep->iface, ep_str.iface, sizeof(ep->iface));
+    if (ep_str.addr[0]) {
+        char *scope_id;
+
+        scope_id = strchr(ep_str.addr, '%');
+        if (scope_id) {
+            *scope_id = '\0';
 #if defined(HAVE_STRUCT_SOCKADDR_IN6_SIN6_SCOPE_ID)
-                addr->sin6_scope_id = if_index;
+            addr->sin6_scope_id = netsnmp_if_nametoindex(scope_id + 1);
 #endif
-                goto resolved;
-            }
-	    if (scope_id != NULL) {
-	      *scope_id = '%';
-	    }
-            *cp = ':';
-        }
-
-        /*
-         * See if it is JUST an IPv6 address.  
-         */
-        if (inet_pton(AF_INET6, peername, (void *) &(addr->sin6_addr))) {
-            DEBUGMSGTL(("netsnmp_sockaddr_in6_2", "just IPv6 address\n"));
-            goto resolved;
         }
-
-        /*
-         * Well, it must be a hostname then, possibly with an appended :port.
-         * Sort that out first.  
-         */
-
-        cp = strrchr(peername, ':');
-        if (cp != NULL) {
-            *cp = '\0';
-            portno = atoi(cp + 1);
-            if (portno != 0) {
-                DEBUGMSGTL(("netsnmp_sockaddr_in6_2",
-                            "hostname(?) with port suffix :%d\n",
-                            portno));
-                if (portno > 0 && portno <= 0xffff) {
-                    addr->sin6_port = htons((u_short)portno);
-                } else {
-                    DEBUGMSGTL(("netsnmp_sockaddr_in6_2", "invalid port number: %d", portno));
-                    free(peername);
-                    return 0;
-                }
-
-            } else {
-                /*
-                 * No idea, looks bogus but we might as well pass the full thing to
-                 * the name resolver below.  
-                 */
-                *cp = ':';
-                DEBUGMSGTL(("netsnmp_sockaddr_in6_2",
-                            "hostname(?) with embedded ':'?\n"));
-            }
-            /*
-             * Fall through.  
-             */
-        }
-
-        if (peername[0] == '\0') {
-          DEBUGMSGTL(("netsnmp_sockaddr_in6_2", "empty hostname\n"));
-          free(peername);
-          return 0;
-        }
-
-#if HAVE_GETADDRINFO
-        {
-            struct addrinfo hint = { 0 };
-            hint.ai_flags = 0;
-            hint.ai_family = PF_INET6;
-            hint.ai_socktype = SOCK_DGRAM;
-            hint.ai_protocol = 0;
-
-            err = netsnmp_getaddrinfo(peername, NULL, &hint, &addrs);
-        }
-        if (err != 0) {
-            free(peername);
+        if (!inet_pton(AF_INET6, ep_str.addr, &addr->sin6_addr) &&
+            !netsnmp_resolve_v6_hostname(&addr->sin6_addr, ep_str.addr)) {
+            DEBUGMSGTL(("netsnmp_sockaddr_in6", "failed to parse %s\n",
+                        ep_str.addr));
             return 0;
         }
-        if (addrs != NULL) {
-            DEBUGMSGTL(("netsnmp_sockaddr_in6_2", "hostname (resolved okay)\n"));
-            memcpy(&addr->sin6_addr,
-                   &((struct sockaddr_in6 *) addrs->ai_addr)->sin6_addr,
-                   sizeof(struct in6_addr));
-            freeaddrinfo(addrs);
-        }
-        else {
-            DEBUGMSGTL(("netsnmp_sockaddr_in6_2", "Failed to resolve IPv6 hostname\n"));
-        }
-#elif HAVE_GETIPNODEBYNAME
-        hp = getipnodebyname(peername, AF_INET6, 0, &err);
-        if (hp == NULL) {
-            DEBUGMSGTL(("netsnmp_sockaddr_in6_2",
-                        "hostname (couldn't resolve = %d)\n", err));
-            free(peername);
-            return 0;
-        }
-        DEBUGMSGTL(("netsnmp_sockaddr_in6_2", "hostname (resolved okay)\n"));
-        memcpy(&(addr->sin6_addr), hp->h_addr, hp->h_length);
-#elif HAVE_GETHOSTBYNAME
-        hp = netsnmp_gethostbyname(peername);
-        if (hp == NULL) {
-            DEBUGMSGTL(("netsnmp_sockaddr_in6_2",
-                        "hostname (couldn't resolve)\n"));
-            free(peername);
-            return 0;
-        } else {
-            if (hp->h_addrtype != AF_INET6) {
-                DEBUGMSGTL(("netsnmp_sockaddr_in6_2",
-                            "hostname (not AF_INET6!)\n"));
-                free(peername);
-                return 0;
-            } else {
-                DEBUGMSGTL(("netsnmp_sockaddr_in6_2",
-                            "hostname (resolved okay)\n"));
-                memcpy(&(addr->sin6_addr), hp->h_addr, hp->h_length);
-            }
-        }
-#else                           /*HAVE_GETHOSTBYNAME */
-        /*
-         * There is no name resolving function available.  
-         */
-        snmp_log(LOG_ERR,
-                 "no getaddrinfo()/getipnodebyname()/gethostbyname()\n");
-        free(peername);
-        return 0;
-#endif                          /*HAVE_GETHOSTBYNAME */
-    } else {
-        DEBUGMSGTL(("netsnmp_sockaddr_in6_2", "NULL peername"));
-        return 0;
     }
 
-  resolved:
-    DEBUGMSGTL(("netsnmp_sockaddr_in6_2", "return { AF_INET6, [%s]:%hu }\n",
+    DEBUGMSGTL(("netsnmp_sockaddr_in6", "return { AF_INET6, [%s%%%d]:%hu }\n",
                 inet_ntop(AF_INET6, &addr->sin6_addr, debug_addr,
-                          sizeof(debug_addr)), ntohs(addr->sin6_port)));
-    free(peername);
+                          sizeof(debug_addr)), (int)addr->sin6_scope_id,
+                ntohs(addr->sin6_port)));
     return 1;
 }
 
diff -urpN net-snmp-5.8/snmplib/transports/snmpSSHDomain.c net-snmp-5.9.1/snmplib/transports/snmpSSHDomain.c
--- net-snmp-5.8/snmplib/transports/snmpSSHDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpSSHDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -41,9 +41,6 @@
 #include <fcntl.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 #include <pwd.h>
 
 #ifndef MAXPATHLEN
@@ -62,7 +59,7 @@
 #include <net-snmp/library/snmpSocketBaseDomain.h>
 #include <net-snmp/library/read_config.h>
 
-netsnmp_feature_require(user_information)
+netsnmp_feature_require(user_information);
 
 #define MAX_NAME_LENGTH 127
 
@@ -983,7 +980,6 @@ netsnmp_ssh_ctor(void)
     sshDomain.prefix = (const char **)calloc(2, sizeof(char *));
     sshDomain.prefix[0] = "ssh";
 
-    sshDomain.f_create_from_tstring     = NULL;
     sshDomain.f_create_from_tstring_new = netsnmp_ssh_create_tstring;
     sshDomain.f_create_from_ostring     = netsnmp_ssh_create_ostring;
 
diff -urpN net-snmp-5.8/snmplib/transports/snmpSTDDomain.c net-snmp-5.9.1/snmplib/transports/snmpSTDDomain.c
--- net-snmp-5.8/snmplib/transports/snmpSTDDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpSTDDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -19,10 +19,6 @@
 #include <unistd.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 
@@ -241,7 +237,7 @@ netsnmp_std_transport(const char *instri
             close(outfd[1]);
 
             /* call exec */
-            system(instring);
+            NETSNMP_IGNORE_RESULT(system(instring));
             /* XXX: TODO: use exec form instead; needs args */
             /* execv(instring, NULL); */
             exit(0);
@@ -275,7 +271,6 @@ netsnmp_std_ctor(void)
     stdDomain.prefix = (const char **)calloc(2, sizeof(char *));
     stdDomain.prefix[0] = "std";
 
-    stdDomain.f_create_from_tstring     = NULL;
     stdDomain.f_create_from_tstring_new = netsnmp_std_create_tstring;
     stdDomain.f_create_from_ostring     = netsnmp_std_create_ostring;
 
diff -urpN net-snmp-5.8/snmplib/transports/snmpSocketBaseDomain.c net-snmp-5.9.1/snmplib/transports/snmpSocketBaseDomain.c
--- net-snmp-5.8/snmplib/transports/snmpSocketBaseDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpSocketBaseDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -345,7 +345,7 @@ int
 netsnmp_set_non_blocking_mode(int sock, int non_blocking_mode)
 {
 #ifdef WIN32
-    u_long          arg;
+    NETSNMP_IOCTLSOCKET_ARG arg;
 
     arg = non_blocking_mode;
     return ioctlsocket(sock, FIONBIO, &arg);
diff -urpN net-snmp-5.8/snmplib/transports/snmpTCPBaseDomain.c net-snmp-5.9.1/snmplib/transports/snmpTCPBaseDomain.c
--- net-snmp-5.8/snmplib/transports/snmpTCPBaseDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpTCPBaseDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -31,10 +31,6 @@
 #include <fcntl.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 
diff -urpN net-snmp-5.8/snmplib/transports/snmpTCPDomain.c net-snmp-5.9.1/snmplib/transports/snmpTCPDomain.c
--- net-snmp-5.8/snmplib/transports/snmpTCPDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpTCPDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,6 +1,7 @@
 #include <net-snmp/net-snmp-config.h>
 
 #include <net-snmp/types.h>
+#include <net-snmp/library/snmpIPBaseDomain.h>
 #include <net-snmp/library/snmpTCPDomain.h>
 
 #include <stdio.h>
@@ -31,10 +32,6 @@
 #include <fcntl.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 
@@ -149,8 +146,9 @@ netsnmp_tcp_accept(netsnmp_transport *t)
  */
 
 netsnmp_transport *
-netsnmp_tcp_transport(const struct sockaddr_in *addr, int local)
+netsnmp_tcp_transport(const struct netsnmp_ep *ep, int local)
 {
+    const struct sockaddr_in *addr = &ep->a.sin;
     netsnmp_transport *t = NULL;
     netsnmp_udp_addr_pair *addr_pair = NULL;
     int rc = 0;
@@ -170,11 +168,10 @@ netsnmp_tcp_transport(const struct socka
         return NULL;
     }
 
+    t->sock = -1;
     addr_pair = (netsnmp_udp_addr_pair *)malloc(sizeof(netsnmp_udp_addr_pair));
-    if (addr_pair == NULL) {
-        netsnmp_transport_free(t);
-        return NULL;
-    }
+    if (addr_pair == NULL)
+        goto err;
     memset(addr_pair, 0, sizeof *addr_pair);
     t->data = addr_pair;
     t->data_length = sizeof(netsnmp_udp_addr_pair);
@@ -197,10 +194,8 @@ netsnmp_tcp_transport(const struct socka
 #endif
     if (!socket_initialized)
         t->sock = (int) socket(PF_INET, SOCK_STREAM, 0);
-    if (t->sock < 0) {
-        netsnmp_transport_free(t);
-        return NULL;
-    }
+    if (t->sock < 0)
+        goto err;
 
     t->flags = NETSNMP_TRANSPORT_FLAG_STREAM;
 
@@ -217,11 +212,8 @@ netsnmp_tcp_transport(const struct socka
         t->flags |= NETSNMP_TRANSPORT_FLAG_LISTEN;
         t->local_length = sizeof(*addr);
         t->local = netsnmp_memdup(addr, sizeof(*addr));
-        if (!t->local) {
-            netsnmp_socketbase_close(t);
-            netsnmp_transport_free(t);
-            return NULL;
-        }
+        if (!t->local)
+            goto err;
 
         /*
          * We should set SO_REUSEADDR too.  
@@ -231,12 +223,16 @@ netsnmp_tcp_transport(const struct socka
 		   sizeof(opt));
 
         if (!socket_initialized) {
-            rc = bind(t->sock, (const struct sockaddr *)addr, sizeof(*addr));
+            rc = netsnmp_bindtodevice(t->sock, ep->iface);
             if (rc != 0) {
-                netsnmp_socketbase_close(t);
-                netsnmp_transport_free(t);
-                return NULL;
+                DEBUGMSGTL(("netsnmp_tcpbase",
+                            "failed to bind to iface %s: %s\n",
+                            ep->iface, strerror(errno)));
+                goto err;
             }
+            rc = bind(t->sock, (const struct sockaddr *)addr, sizeof(*addr));
+            if (rc != 0)
+                goto err;
         }
 
         /*
@@ -254,11 +250,8 @@ netsnmp_tcp_transport(const struct socka
          */
         if (!socket_initialized) {
             rc = listen(t->sock, NETSNMP_STREAM_QUEUE_LEN);
-            if (rc != 0) {
-                netsnmp_socketbase_close(t);
-                netsnmp_transport_free(t);
-                return NULL;
-            }
+            if (rc != 0)
+                goto err;
         }
         
         /*
@@ -270,11 +263,8 @@ netsnmp_tcp_transport(const struct socka
     } else {
         t->remote_length = sizeof(*addr);
         t->remote = netsnmp_memdup(addr, sizeof(*addr));
-        if (!t->remote) {
-            netsnmp_socketbase_close(t);
-            netsnmp_transport_free(t);
-            return NULL;
-        }
+        if (!t->remote)
+            goto err;
 
         /*
          * This is a client-type session, so attempt to connect to the far
@@ -284,11 +274,8 @@ netsnmp_tcp_transport(const struct socka
          */
 
         rc = connect(t->sock, (const struct sockaddr *)addr, sizeof(*addr));
-        if (rc < 0) {
-            netsnmp_socketbase_close(t);
-            netsnmp_transport_free(t);
-            return NULL;
-        }
+        if (rc < 0)
+            goto err;
 
         /*
          * Allow user to override the send and receive buffers. Default is
@@ -313,6 +300,11 @@ netsnmp_tcp_transport(const struct socka
     t->f_get_taddr = netsnmp_ipv4_get_taddr;
 
     return t;
+
+err:
+    netsnmp_socketbase_close(t);
+    netsnmp_transport_free(t);
+    return NULL;
 }
 
 
@@ -321,10 +313,10 @@ netsnmp_transport *
 netsnmp_tcp_create_tstring(const char *str, int local,
 			   const char *default_target)
 {
-    struct sockaddr_in addr;
+    struct netsnmp_ep ep;
 
-    if (netsnmp_sockaddr_in2(&addr, str, default_target)) {
-        return netsnmp_tcp_transport(&addr, local);
+    if (netsnmp_sockaddr_in3(&ep, str, default_target)) {
+        return netsnmp_tcp_transport(&ep, local);
     } else {
         return NULL;
     }
@@ -335,10 +327,11 @@ netsnmp_tcp_create_tstring(const char *s
 netsnmp_transport *
 netsnmp_tcp_create_ostring(const void *o, size_t o_len, int local)
 {
-    struct sockaddr_in sin;
+    struct netsnmp_ep ep;
 
-    if (netsnmp_ipv4_ostring_to_sockaddr(&sin, o, o_len))
-        return netsnmp_tcp_transport(&sin, local);
+    memset(&ep, 0, sizeof(ep));
+    if (netsnmp_ipv4_ostring_to_sockaddr(&ep.a.sin, o, o_len))
+        return netsnmp_tcp_transport(&ep, local);
     return NULL;
 }
 
@@ -352,7 +345,6 @@ netsnmp_tcp_ctor(void)
     tcpDomain.prefix = (const char **)calloc(2, sizeof(char *));
     tcpDomain.prefix[0] = "tcp";
 
-    tcpDomain.f_create_from_tstring     = NULL;
     tcpDomain.f_create_from_tstring_new = netsnmp_tcp_create_tstring;
     tcpDomain.f_create_from_ostring     = netsnmp_tcp_create_ostring;
 
diff -urpN net-snmp-5.8/snmplib/transports/snmpTCPIPv6Domain.c net-snmp-5.9.1/snmplib/transports/snmpTCPIPv6Domain.c
--- net-snmp-5.8/snmplib/transports/snmpTCPIPv6Domain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpTCPIPv6Domain.c	2021-05-26 05:19:35.000000000 +0700
@@ -3,6 +3,7 @@
 #ifdef NETSNMP_TRANSPORT_TCPIPV6_DOMAIN
 
 #include <net-snmp/types.h>
+#include <net-snmp/library/snmpIPBaseDomain.h>
 #include <net-snmp/library/snmpTCPIPv6Domain.h>
 
 #include <stdio.h>
@@ -36,10 +37,6 @@
 #include <fcntl.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 #include <net-snmp/config_api.h>
@@ -140,8 +137,9 @@ netsnmp_tcp6_accept(netsnmp_transport *t
  */
 
 netsnmp_transport *
-netsnmp_tcp6_transport(const struct sockaddr_in6 *addr, int local)
+netsnmp_tcp6_transport(const struct netsnmp_ep *ep, int local)
 {
+    const struct sockaddr_in6 *addr = &ep->a.sin6;
     netsnmp_transport *t = NULL;
     int             rc = 0;
     int             socket_initialized = 0;
@@ -168,11 +166,10 @@ netsnmp_tcp6_transport(const struct sock
         free(str);
     }
 
+    t->sock = -1;
     t->data = malloc(sizeof(netsnmp_indexed_addr_pair));
-    if (t->data == NULL) {
-        netsnmp_transport_free(t);
-        return NULL;
-    }
+    if (t->data == NULL)
+        goto err;
     t->data_length = sizeof(netsnmp_indexed_addr_pair);
     memcpy(t->data, addr, sizeof(struct sockaddr_in6));
 
@@ -192,10 +189,8 @@ netsnmp_tcp6_transport(const struct sock
 #endif
     if (!socket_initialized)
         t->sock = (int) socket(PF_INET6, SOCK_STREAM, 0);
-    if (t->sock < 0) {
-        netsnmp_transport_free(t);
-        return NULL;
-    }
+    if (t->sock < 0)
+        goto err;
 
     t->flags = NETSNMP_TRANSPORT_FLAG_STREAM;
 
@@ -222,11 +217,8 @@ netsnmp_tcp6_transport(const struct sock
         t->flags |= NETSNMP_TRANSPORT_FLAG_LISTEN;
         t->local_length = sizeof(*addr);
         t->local = netsnmp_memdup(addr, sizeof(*addr));
-        if (!t->local) {
-            netsnmp_socketbase_close(t);
-            netsnmp_transport_free(t);
-            return NULL;
-        }
+        if (!t->local)
+            goto err;
 
         /*
          * We should set SO_REUSEADDR too.  
@@ -235,12 +227,15 @@ netsnmp_tcp6_transport(const struct sock
         setsockopt(t->sock, SOL_SOCKET, SO_REUSEADDR, (void *)&opt, sizeof(opt));
 
         if (!socket_initialized) {
-            rc = bind(t->sock, (const struct sockaddr *)addr, sizeof(*addr));
+            rc = netsnmp_bindtodevice(t->sock, ep->iface);
             if (rc != 0) {
-                netsnmp_socketbase_close(t);
-                netsnmp_transport_free(t);
-                return NULL;
+                DEBUGMSGTL(("netsnmp_tcp6", "failed to bind to iface %s: %s\n",
+                            ep->iface, strerror(errno)));
+                goto err;
             }
+            rc = bind(t->sock, (const struct sockaddr *)addr, sizeof(*addr));
+            if (rc != 0)
+                goto err;
         }
 
         /*
@@ -259,11 +254,8 @@ netsnmp_tcp6_transport(const struct sock
 
         if (!socket_initialized) {
             rc = listen(t->sock, NETSNMP_STREAM_QUEUE_LEN);
-            if (rc != 0) {
-                netsnmp_socketbase_close(t);
-                netsnmp_transport_free(t);
-                return NULL;
-            }
+            if (rc != 0)
+                goto err;
         }
         
         /*
@@ -275,11 +267,8 @@ netsnmp_tcp6_transport(const struct sock
     } else {
         t->remote_length = sizeof(*addr);
         t->remote = netsnmp_memdup(addr, sizeof(*addr));
-        if (!t->remote) {
-            netsnmp_socketbase_close(t);
-            netsnmp_transport_free(t);
-            return NULL;
-        }
+        if (!t->remote)
+            goto err;
 
         /*
          * This is a client-type session, so attempt to connect to the far
@@ -290,11 +279,8 @@ netsnmp_tcp6_transport(const struct sock
 
         rc = connect(t->sock, (const struct sockaddr *)addr, sizeof(*addr));
         DEBUGMSGTL(("netsnmp_tcp6", "connect returns %d\n", rc));
-        if (rc < 0) {
-            netsnmp_socketbase_close(t);
-            netsnmp_transport_free(t);
-            return NULL;
-        }
+        if (rc < 0)
+            goto err;
 
         /*
          * Allow user to override the send and receive buffers. Default is
@@ -319,16 +305,21 @@ netsnmp_tcp6_transport(const struct sock
     t->f_get_taddr = netsnmp_ipv6_get_taddr;
 
     return t;
+
+err:
+    netsnmp_socketbase_close(t);
+    netsnmp_transport_free(t);
+    return NULL;
 }
 
 netsnmp_transport *
 netsnmp_tcp6_create_tstring(const char *str, int local,
 			    const char *default_target)
 {
-    struct sockaddr_in6 addr;
+    struct netsnmp_ep ep;
 
-    if (netsnmp_sockaddr_in6_2(&addr, str, default_target)) {
-        return netsnmp_tcp6_transport(&addr, local);
+    if (netsnmp_sockaddr_in6_3(&ep, str, default_target)) {
+        return netsnmp_tcp6_transport(&ep, local);
     } else {
         return NULL;
     }
@@ -347,10 +338,11 @@ netsnmp_tcp6_create_tstring(const char *
 netsnmp_transport *
 netsnmp_tcp6_create_ostring(const void *o, size_t o_len, int local)
 {
-    struct sockaddr_in6 sin6;
+    struct netsnmp_ep ep;
 
-    if (netsnmp_ipv6_ostring_to_sockaddr(&sin6, o, o_len))
-        return netsnmp_tcp6_transport(&sin6, local);
+    memset(&ep, 0, sizeof(ep));
+    if (netsnmp_ipv6_ostring_to_sockaddr(&ep.a.sin6, o, o_len))
+        return netsnmp_tcp6_transport(&ep, local);
     return NULL;
 }
 
@@ -360,7 +352,6 @@ netsnmp_tcpipv6_ctor(void)
 {
     tcp6Domain.name = netsnmp_TCPIPv6Domain;
     tcp6Domain.name_length = sizeof(netsnmp_TCPIPv6Domain) / sizeof(oid);
-    tcp6Domain.f_create_from_tstring     = NULL;
     tcp6Domain.f_create_from_tstring_new = netsnmp_tcp6_create_tstring;
     tcp6Domain.f_create_from_ostring     = netsnmp_tcp6_create_ostring;
     tcp6Domain.prefix = (const char**)calloc(4, sizeof(char *));
diff -urpN net-snmp-5.8/snmplib/transports/snmpTLSBaseDomain.c net-snmp-5.9.1/snmplib/transports/snmpTLSBaseDomain.c
--- net-snmp-5.8/snmplib/transports/snmpTLSBaseDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpTLSBaseDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -2,11 +2,8 @@
 #include <net-snmp/net-snmp-features.h>
 #include <net-snmp/types.h>
 
-netsnmp_feature_require(cert_util)
+netsnmp_feature_require(cert_util);
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
 #if HAVE_STRING_H
 #include <string.h>
 #else
@@ -26,6 +23,7 @@ netsnmp_feature_require(cert_util)
 #endif
 #include <errno.h>
 #include <ctype.h>
+#include "../memcheck.h"
 
 /* OpenSSL Includes */
 #include <openssl/bio.h>
@@ -56,6 +54,17 @@ netsnmp_feature_require(cert_util)
 
 int openssl_local_index;
 
+#ifndef HAVE_ERR_GET_ERROR_ALL
+/* A backport of the OpenSSL 1.1.1e ERR_get_error_all() function. */
+static unsigned long ERR_get_error_all(const char **file, int *line,
+                                       const char **func,
+                                       const char **data, int *flags)
+{
+    *func = NULL;
+    return ERR_get_error_line_data(file, line, data, flags);
+}
+#endif
+
 /* this is called during negotiation */
 int verify_callback(int ok, X509_STORE_CTX *ctx) {
     int err, depth;
@@ -441,7 +450,7 @@ _trust_this_cert(SSL_CTX *the_ctx, char
         LOGANDDIE("failed to find requested certificate to trust");
         
     /* Add the certificate to the context */
-    if (netsnmp_cert_trust_ca(the_ctx, trustcert) != SNMPERR_SUCCESS)
+    if (netsnmp_cert_trust(the_ctx, trustcert) != SNMPERR_SUCCESS)
         LOGANDDIE("failed to load trust certificate");
 
     return 1;
@@ -481,7 +490,7 @@ _sslctx_common_setup(SSL_CTX *the_ctx, _
                                     NETSNMP_DS_LIB_X509_CRL_FILE);
     if (NULL != crlFile) {
         cert_store = SSL_CTX_get_cert_store(the_ctx);
-        DEBUGMSGTL(("sslctx_client", "loading CRL: %s\n", crlFile));
+        DEBUGMSGTL(("sslctx_common", "loading CRL: %s\n", crlFile));
         if (!cert_store)
             LOGANDDIE("failed to find certificate store");
         if (!(lookup = X509_STORE_add_lookup(cert_store, X509_LOOKUP_file())))
@@ -517,6 +526,7 @@ sslctx_client_setup(const SSL_METHOD *me
         snmp_log(LOG_ERR, "ack: %p\n", the_ctx);
         LOGANDDIE("can't create a new context");
     }
+    MAKE_MEM_DEFINED(the_ctx, 256/*sizeof(*the_ctx)*/);
     SSL_CTX_set_read_ahead (the_ctx, 1); /* Required for DTLS */
         
     SSL_CTX_set_verify(the_ctx,
@@ -546,13 +556,19 @@ sslctx_client_setup(const SSL_METHOD *me
                 id_cert->key->info.filename));
 
     if (SSL_CTX_use_certificate(the_ctx, id_cert->ocert) <= 0)
-        LOGANDDIE("failed to set the certificate to use");
+        LOGANDDIE("failed to set the client certificate to use");
 
     if (SSL_CTX_use_PrivateKey(the_ctx, id_cert->key->okey) <= 0)
-        LOGANDDIE("failed to set the private key to use");
+        LOGANDDIE("failed to set the client private key to use");
 
     if (!SSL_CTX_check_private_key(the_ctx))
-        LOGANDDIE("public and private keys incompatible");
+        LOGANDDIE("client public and private keys incompatible");
+
+    while (id_cert->issuer_cert) {
+        id_cert = id_cert->issuer_cert;
+        if (!SSL_CTX_add_extra_chain_cert(the_ctx, id_cert->ocert))
+            LOGANDDIE("failed to add intermediate client certificate");
+    }
 
     if (tlsbase->their_identity)
         peer_cert = netsnmp_cert_find(NS_CERT_REMOTE_PEER,
@@ -566,11 +582,11 @@ sslctx_client_setup(const SSL_METHOD *me
                     peer_cert ? peer_cert->info.filename : "none"));
 
         /* Trust the expected certificate */
-        if (netsnmp_cert_trust_ca(the_ctx, peer_cert) != SNMPERR_SUCCESS)
+        if (netsnmp_cert_trust(the_ctx, peer_cert) != SNMPERR_SUCCESS)
             LOGANDDIE ("failed to set verify paths");
     }
 
-    /* trust a certificate (possibly a CA) aspecifically passed in */
+    /* trust a certificate (possibly a CA) specifically passed in */
     if (tlsbase->trust_cert) {
         if (!_trust_this_cert(the_ctx, tlsbase->trust_cert))
             return 0;
@@ -589,15 +605,16 @@ sslctx_server_setup(const SSL_METHOD *me
     /* setting up for ssl */
     SSL_CTX *the_ctx = SSL_CTX_new(NETSNMP_REMOVE_CONST(SSL_METHOD *, method));
     if (!the_ctx) {
-        LOGANDDIE("can't create a new context");
+        LOGANDDIE("can't create a new server context");
     }
+    MAKE_MEM_DEFINED(the_ctx, 256/*sizeof(*the_ctx)*/);
 
     id_cert = netsnmp_cert_find(NS_CERT_IDENTITY, NS_CERTKEY_DEFAULT, NULL);
     if (!id_cert)
         LOGANDDIE ("error finding server identity keys");
 
     if (!id_cert->key || !id_cert->key->okey)
-        LOGANDDIE("failed to load private key");
+        LOGANDDIE("failed to load server private key");
 
     DEBUGMSGTL(("sslctx_server", "using public key: %s\n",
                 id_cert->info.filename));
@@ -605,13 +622,19 @@ sslctx_server_setup(const SSL_METHOD *me
                 id_cert->key->info.filename));
 
     if (SSL_CTX_use_certificate(the_ctx, id_cert->ocert) <= 0)
-        LOGANDDIE("failed to set the certificate to use");
+        LOGANDDIE("failed to set the server certificate to use");
 
     if (SSL_CTX_use_PrivateKey(the_ctx, id_cert->key->okey) <= 0)
-        LOGANDDIE("failed to set the private key to use");
+        LOGANDDIE("failed to set the server private key to use");
 
     if (!SSL_CTX_check_private_key(the_ctx))
-        LOGANDDIE("public and private keys incompatible");
+        LOGANDDIE("server public and private keys incompatible");
+
+    while (id_cert->issuer_cert) {
+        id_cert = id_cert->issuer_cert;
+        if (!SSL_CTX_add_extra_chain_cert(the_ctx, id_cert->ocert))
+            LOGANDDIE("failed to add intermediate server certificate");
+    }
 
     SSL_CTX_set_read_ahead(the_ctx, 1); /* XXX: DTLS only? */
 
@@ -941,7 +964,7 @@ int netsnmp_tlsbase_wrapup_recv(netsnmp_
     return SNMPERR_SUCCESS;
 }
 
-netsnmp_feature_child_of(_x509_get_error, netsnmp_unused)
+netsnmp_feature_child_of(_x509_get_error, netsnmp_unused);
 #ifndef NETSNMP_FEATURE_REMOVE__X509_GET_ERROR
 const char * _x509_get_error(int x509failvalue, const char *location) {
     static const char *reason = NULL;
@@ -1101,7 +1124,7 @@ const char * _x509_get_error(int x509fai
 #endif /* NETSNMP_FEATURE_REMOVE__X509_GET_ERROR */
 
 void _openssl_log_error(int rc, SSL *con, const char *location) {
-    const char     *reason, *file, *data;
+    const char     *reason, *file, *func, *data;
     unsigned long   numerical_reason;
     int             flags, line;
 
@@ -1167,9 +1190,9 @@ void _openssl_log_error(int rc, SSL *con
 
     /* other errors */
     while ((numerical_reason =
-            ERR_get_error_line_data(&file, &line, &data, &flags)) != 0) {
-        snmp_log(LOG_ERR, " error: #%lu (file %s, line %d)\n",
-                 numerical_reason, file, line);
+            ERR_get_error_all(&file, &line, &func, &data, &flags)) != 0) {
+        snmp_log(LOG_ERR, "%s (file %s, func %s, line %d)\n",
+                 ERR_error_string(numerical_reason, NULL), file, func, line);
 
         /* if we have a text translation: */
         if (data && (flags & ERR_TXT_STRING)) {
diff -urpN net-snmp-5.8/snmplib/transports/snmpTLSTCPDomain.c net-snmp-5.9.1/snmplib/transports/snmpTLSTCPDomain.c
--- net-snmp-5.8/snmplib/transports/snmpTLSTCPDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpTLSTCPDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -11,7 +11,7 @@
 
 #include <net-snmp/net-snmp-features.h>
 
-netsnmp_feature_require(cert_util)
+netsnmp_feature_require(cert_util);
 
 #include <stdio.h>
 #include <sys/types.h>
@@ -49,9 +49,7 @@ netsnmp_feature_require(cert_util)
 #include <arpa/inet.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
+#include "../memcheck.h"
 
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
@@ -280,6 +278,9 @@ netsnmp_tlstcp_recv(netsnmp_transport *t
     /* read the packet from openssl */
     do {
         rc = SSL_read(tlsdata->ssl, buf, size);
+        MAKE_MEM_DEFINED(&rc, sizeof(rc));
+        if (rc > 0)
+            MAKE_MEM_DEFINED(buf, rc);
         if (rc == 0) {
             /* XXX closed connection */
             DEBUGMSGTL(("tlstcp", "remote side closed connection\n"));
@@ -626,7 +627,7 @@ netsnmp_tlstcp_accept(netsnmp_transport
     if ((rc = netsnmp_tlsbase_verify_client_cert(ssl, tlsdata))
         != SNMPERR_SUCCESS) {
         /* XXX: free needed memory */
-        snmp_log(LOG_ERR, "TLSTCP: Falied checking client certificate\n");
+        snmp_log(LOG_ERR, "TLSTCP: Failed checking client certificate\n");
         snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONINVALIDCLIENTCERTIFICATES);
         SSL_shutdown(tlsdata->ssl);
         SSL_free(tlsdata->ssl);
@@ -660,269 +661,294 @@ netsnmp_tlstcp_accept(netsnmp_transport
     return BIO_get_fd(tlsdata->accepted_bio, NULL);
 }
 
-
-netsnmp_transport *
-netsnmp_tlstcp_open(netsnmp_transport *t)
+static netsnmp_transport *
+netsnmp_tlstcp_open_client(netsnmp_transport *t)
 {
-    _netsnmpTLSBaseData *tlsdata;
+    _netsnmpTLSBaseData *tlsdata = t->data;
     BIO *bio;
     SSL_CTX *ctx;
     SSL *ssl;
     int rc = 0;
     _netsnmp_verify_info *verify_info;
 
-    netsnmp_assert_or_return(t != NULL, NULL);
-    netsnmp_assert_or_return(t->data != NULL, NULL);
-    netsnmp_assert_or_return(sizeof(_netsnmpTLSBaseData) == t->data_length,
-                             NULL);
+    /* RFC5953 Section 5.3.1:  Establishing a Session as a Client
+     *    1)  The snmpTlstmSessionOpens counter is incremented.
+     */
+    snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONOPENS);
 
-    tlsdata = t->data;
-    
-    if (tlsdata->flags & NETSNMP_TLSBASE_IS_CLIENT) {
-        /* Is the client */
+    /* RFC5953 Section 5.3.1:  Establishing a Session as a Client
+       2)  The client selects the appropriate certificate and cipher_suites
+       for the key agreement based on the tmSecurityName and the
+       tmRequestedSecurityLevel for the session.  For sessions being
+       established as a result of a SNMP-TARGET-MIB based operation, the
+       certificate will potentially have been identified via the
+       snmpTlstmParamsTable mapping and the cipher_suites will have to
+       be taken from system-wide or implementation-specific
+       configuration.  If no row in the snmpTlstmParamsTable exists then
+       implementations MAY choose to establish the connection using a
+       default client certificate available to the application.
+       Otherwise, the certificate and appropriate cipher_suites will
+       need to be passed to the openSession() ASI as supplemental
+       information or configured through an implementation-dependent
+       mechanism.  It is also implementation-dependent and possibly
+       policy-dependent how tmRequestedSecurityLevel will be used to
+       influence the security capabilities provided by the (D)TLS
+       connection.  However this is done, the security capabilities
+       provided by (D)TLS MUST be at least as high as the level of
+       security indicated by the tmRequestedSecurityLevel parameter.
+       The actual security level of the session is reported in the
+       tmStateReference cache as tmSecurityLevel.  For (D)TLS to provide
+       strong authentication, each principal acting as a command
+       generator SHOULD have its own certificate.
+    */
+    /*
+      Implementation notes: we do most of this in the
+      sslctx_client_setup The transport should have been
+      f_config()ed with the proper fingerprints to use (which is
+      stored in tlsdata), or we'll use the default identity
+      fingerprint if that can be found.
+    */
 
-        /* RFC5953 Section 5.3.1:  Establishing a Session as a Client
-         *    1)  The snmpTlstmSessionOpens counter is incremented.
-         */
-        snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONOPENS);
-
-        /* RFC5953 Section 5.3.1:  Establishing a Session as a Client
-          2)  The client selects the appropriate certificate and cipher_suites
-              for the key agreement based on the tmSecurityName and the
-              tmRequestedSecurityLevel for the session.  For sessions being
-              established as a result of a SNMP-TARGET-MIB based operation, the
-              certificate will potentially have been identified via the
-              snmpTlstmParamsTable mapping and the cipher_suites will have to
-              be taken from system-wide or implementation-specific
-              configuration.  If no row in the snmpTlstmParamsTable exists then
-              implementations MAY choose to establish the connection using a
-              default client certificate available to the application.
-              Otherwise, the certificate and appropriate cipher_suites will
-              need to be passed to the openSession() ASI as supplemental
-              information or configured through an implementation-dependent
-              mechanism.  It is also implementation-dependent and possibly
-              policy-dependent how tmRequestedSecurityLevel will be used to
-              influence the security capabilities provided by the (D)TLS
-              connection.  However this is done, the security capabilities
-              provided by (D)TLS MUST be at least as high as the level of
-              security indicated by the tmRequestedSecurityLevel parameter.
-              The actual security level of the session is reported in the
-              tmStateReference cache as tmSecurityLevel.  For (D)TLS to provide
-              strong authentication, each principal acting as a command
-              generator SHOULD have its own certificate.
-        */
-        /*
-          Implementation notes: we do most of this in the
-          sslctx_client_setup The transport should have been
-          f_config()ed with the proper fingerprints to use (which is
-          stored in tlsdata), or we'll use the default identity
-          fingerprint if that can be found.
-        */
-
-        /* XXX: check securityLevel and ensure no NULL fingerprints are used */
-
-        /* set up the needed SSL context */
-        tlsdata->ssl_context = ctx = sslctx_client_setup(TLS_method(), tlsdata);
-        if (!ctx) {
-            snmp_log(LOG_ERR, "failed to create TLS context\n");
-            return NULL;
-        }
+    /* XXX: check securityLevel and ensure no NULL fingerprints are used */
 
-        /* RFC5953 Section 5.3.1:  Establishing a Session as a Client
-           3)  Using the destTransportDomain and destTransportAddress values,
-               the client will initiate the (D)TLS handshake protocol to
-               establish session keys for message integrity and encryption.
-        */
-        /* Implementation note:
-           The transport domain and address are pre-processed by this point
-        */
-
-        /* Create a BIO connection for it */
-        DEBUGMSGTL(("tlstcp", "connecting to tlstcp %s\n",
-		    tlsdata->addr_string));
-        t->remote = (void *) strdup(tlsdata->addr_string);
-        t->remote_length = strlen(tlsdata->addr_string) + 1;
-
-        bio = BIO_new_connect(tlsdata->addr_string);
-
-        /* RFC5953 Section 5.3.1:  Establishing a Session as a Client
-           3) continued:
-              If the attempt to establish a session is unsuccessful, then
-              snmpTlstmSessionOpenErrors is incremented, an error indication is
-              returned, and processing stops.
-        */
-
-        if (NULL == bio) {
-            snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONOPENERRORS);
-            snmp_log(LOG_ERR, "tlstcp: failed to create bio\n");
-            _openssl_log_error(rc, NULL, "BIO creation");
-            return NULL;
-        }
-            
+    /* set up the needed SSL context */
+    tlsdata->ssl_context = ctx = sslctx_client_setup(TLS_method(), tlsdata);
+    if (!ctx) {
+        snmp_log(LOG_ERR, "failed to create TLS context\n");
+        return NULL;
+    }
 
-        /* Tell the BIO to actually do the connection */
-        if ((rc = BIO_do_connect(bio)) <= 0) {
-            snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONOPENERRORS);
-            snmp_log(LOG_ERR, "tlstcp: failed to connect to %s\n",
-		     tlsdata->addr_string);
-            _openssl_log_error(rc, NULL, "BIO_do_connect");
-            BIO_free(bio);
-            return NULL;
-        }
+#ifdef SSL_CTX_set_max_proto_version
+    SSL_CTX_set_max_proto_version(tlsdata->ssl_context, TLS1_VERSION);
+#endif
 
-        /* Create the SSL layer on top of the socket bio */
-        ssl = tlsdata->ssl = SSL_new(ctx);
-        if (NULL == ssl) {
-            snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONOPENERRORS);
-            snmp_log(LOG_ERR, "tlstcp: failed to create a SSL connection\n");
-            BIO_free(bio);
-            return NULL;
-        }
-        
-        /* Bind the SSL layer to the BIO */ 
-        SSL_set_bio(ssl, bio, bio);
-        SSL_set_mode(ssl, SSL_MODE_AUTO_RETRY);
-
-        verify_info = SNMP_MALLOC_TYPEDEF(_netsnmp_verify_info);
-        if (NULL == verify_info) {
-            snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONOPENERRORS);
-            snmp_log(LOG_ERR, "tlstcp: failed to create a SSL connection\n");
-            SSL_shutdown(ssl);
-            BIO_free(bio);
-            return NULL;
-        }
+    /* RFC5953 Section 5.3.1:  Establishing a Session as a Client
+       3)  Using the destTransportDomain and destTransportAddress values,
+       the client will initiate the (D)TLS handshake protocol to
+       establish session keys for message integrity and encryption.
+    */
+    /* Implementation note:
+       The transport domain and address are pre-processed by this point
+    */
 
-        SSL_set_ex_data(ssl, tls_get_verify_info_index(), verify_info);
+    /* Create a BIO connection for it */
+    DEBUGMSGTL(("tlstcp", "connecting to tlstcp %s\n",
+                tlsdata->addr_string));
+    t->remote = strdup(tlsdata->addr_string);
+    t->remote_length = strlen(tlsdata->addr_string) + 1;
+
+    bio = BIO_new_connect(tlsdata->addr_string);
+
+    /* RFC5953 Section 5.3.1:  Establishing a Session as a Client
+       3) continued:
+       If the attempt to establish a session is unsuccessful, then
+       snmpTlstmSessionOpenErrors is incremented, an error indication is
+       returned, and processing stops.
+    */
 
-        /* Then have SSL do it's connection over the BIO */
-        if ((rc = SSL_connect(ssl)) <= 0) {
-            snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONOPENERRORS);
-            snmp_log(LOG_ERR, "tlstcp: failed to ssl_connect\n");
-            BIO_free(bio);
-            return NULL;
-        }
+    if (NULL == bio) {
+        snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONOPENERRORS);
+        snmp_log(LOG_ERR, "tlstcp: failed to create bio\n");
+        _openssl_log_error(rc, NULL, "BIO creation");
+        return NULL;
+    }
 
-        /* RFC5953 Section 5.3.1: Establishing a Session as a Client
-           3) continued:
-              If the session failed to open because the presented
-              server certificate was unknown or invalid then the
-              snmpTlstmSessionUnknownServerCertificate or
-              snmpTlstmSessionInvalidServerCertificates MUST be
-              incremented and a snmpTlstmServerCertificateUnknown or
-              snmpTlstmServerInvalidCertificate notification SHOULD be
-              sent as appropriate.  Reasons for server certificate
-              invalidation includes, but is not limited to,
-              cryptographic validation failures and an unexpected
-              presented certificate identity.
-        */
-
-        /* RFC5953 Section 5.3.1: Establishing a Session as a Client
-           4)  The (D)TLS client MUST then verify that the (D)TLS server's
-               presented certificate is the expected certificate.  The (D)TLS
-               client MUST NOT transmit SNMP messages until the server
-               certificate has been authenticated, the client certificate has
-               been transmitted and the TLS connection has been fully
-               established.
-
-               If the connection is being established from configuration based
-               on SNMP-TARGET-MIB configuration, then the snmpTlstmAddrTable
-               DESCRIPTION clause describes how the verification is done (using
-               either a certificate fingerprint, or an identity authenticated
-               via certification path validation).
-
-               If the connection is being established for reasons other than
-               configuration found in the SNMP-TARGET-MIB then configuration and
-               procedures outside the scope of this document should be followed.
-               Configuration mechanisms SHOULD be similar in nature to those
-               defined in the snmpTlstmAddrTable to ensure consistency across
-               management configuration systems.  For example, a command-line
-               tool for generating SNMP GETs might support specifying either the
-               server's certificate fingerprint or the expected host name as a
-               command line argument.
-        */
-
-        /* Implementation notes:
-           - All remote certificate fingerprints are expected to be
-             stored in the transport's config information.  This is
-             true both for CLI clients and TARGET-MIB sessions.
-           - netsnmp_tlsbase_verify_server_cert implements these checks
-        */
-        if (netsnmp_tlsbase_verify_server_cert(ssl, tlsdata) != SNMPERR_SUCCESS) {
-            /* XXX: unknown vs invalid; two counters */
-            snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONUNKNOWNSERVERCERTIFICATE);
-            snmp_log(LOG_ERR, "tlstcp: failed to verify ssl certificate\n");
-            SSL_shutdown(ssl);
-            BIO_free(bio);
-            return NULL;
-        }
+    /* Tell the BIO to actually do the connection */
+    rc = BIO_do_connect(bio);
+    if (rc <= 0) {
+        snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONOPENERRORS);
+        snmp_log(LOG_ERR, "tlstcp: failed to connect to %s\n",
+                 tlsdata->addr_string);
+        _openssl_log_error(rc, NULL, "BIO_do_connect");
+        BIO_free(bio);
+        return NULL;
+    }
 
-        /* RFC5953 Section 5.3.1: Establishing a Session as a Client
-           5)  (D)TLS provides assurance that the authenticated identity has
-               been signed by a trusted configured certification authority.  If
-               verification of the server's certificate fails in any way (for
-               example because of failures in cryptographic verification or the
-               presented identity did not match the expected named entity) then
-               the session establishment MUST fail, the
-               snmpTlstmSessionInvalidServerCertificates object is incremented.
-               If the session can not be opened for any reason at all, including
-               cryptographic verification failures, then the
-               snmpTlstmSessionOpenErrors counter is incremented and processing
-               stops.
-
-        */
-        /* XXX: add snmpTlstmSessionInvalidServerCertificates on
-           crypto failure */
-
-        /* RFC5953 Section 5.3.1: Establishing a Session as a Client
-           6)  The TLSTM-specific session identifier (tlstmSessionID) is set in
-           the tmSessionID of the tmStateReference passed to the TLS
-           Transport Model to indicate that the session has been established
-           successfully and to point to a specific (D)TLS connection for
-           future use.  The tlstmSessionID is also stored in the LCD for
-           later lookup during processing of incoming messages
-           (Section 5.1.2).
-        */
-        /* Implementation notes:
-           - the tlsdata pointer is used as our session identifier, as
-             noted in the netsnmp_tlstcp_recv() function comments.
-        */
+    /* Create the SSL layer on top of the socket bio */
+    ssl = tlsdata->ssl = SSL_new(ctx);
+    if (NULL == ssl) {
+        snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONOPENERRORS);
+        snmp_log(LOG_ERR, "tlstcp: failed to create a SSL connection\n");
+        BIO_free(bio);
+        return NULL;
+    }
 
-        t->sock = BIO_get_fd(bio, NULL);
+    /* Bind the SSL layer to the BIO */
+    SSL_set_bio(ssl, bio, bio);
+    SSL_set_mode(ssl, SSL_MODE_AUTO_RETRY);
+
+    verify_info = SNMP_MALLOC_TYPEDEF(_netsnmp_verify_info);
+    if (NULL == verify_info) {
+        snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONOPENERRORS);
+        snmp_log(LOG_ERR, "tlstcp: failed to create a SSL connection\n");
+        SSL_shutdown(ssl);
+        BIO_free(bio);
+        return NULL;
+    }
+
+    SSL_set_ex_data(ssl, tls_get_verify_info_index(), verify_info);
+
+    /* Then have SSL do it's connection over the BIO */
+    rc = SSL_connect(ssl);
+    if (rc <= 0) {
+        snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONOPENERRORS);
+        snmp_log(LOG_ERR, "tlstcp: failed to ssl_connect\n");
+        BIO_free(bio);
+        return NULL;
+    }
+
+    /* RFC5953 Section 5.3.1: Establishing a Session as a Client
+       3) continued:
+       If the session failed to open because the presented
+       server certificate was unknown or invalid then the
+       snmpTlstmSessionUnknownServerCertificate or
+       snmpTlstmSessionInvalidServerCertificates MUST be
+       incremented and a snmpTlstmServerCertificateUnknown or
+       snmpTlstmServerInvalidCertificate notification SHOULD be
+       sent as appropriate.  Reasons for server certificate
+       invalidation includes, but is not limited to,
+       cryptographic validation failures and an unexpected
+       presented certificate identity.
+    */
+
+    /* RFC5953 Section 5.3.1: Establishing a Session as a Client
+       4)  The (D)TLS client MUST then verify that the (D)TLS server's
+       presented certificate is the expected certificate.  The (D)TLS
+       client MUST NOT transmit SNMP messages until the server
+       certificate has been authenticated, the client certificate has
+       been transmitted and the TLS connection has been fully
+       established.
+
+       If the connection is being established from configuration based
+       on SNMP-TARGET-MIB configuration, then the snmpTlstmAddrTable
+       DESCRIPTION clause describes how the verification is done (using
+       either a certificate fingerprint, or an identity authenticated
+       via certification path validation).
+
+       If the connection is being established for reasons other than
+       configuration found in the SNMP-TARGET-MIB then configuration and
+       procedures outside the scope of this document should be followed.
+       Configuration mechanisms SHOULD be similar in nature to those
+       defined in the snmpTlstmAddrTable to ensure consistency across
+       management configuration systems.  For example, a command-line
+       tool for generating SNMP GETs might support specifying either the
+       server's certificate fingerprint or the expected host name as a
+       command line argument.
+    */
+
+    /* Implementation notes:
+       - All remote certificate fingerprints are expected to be
+       stored in the transport's config information.  This is
+       true both for CLI clients and TARGET-MIB sessions.
+       - netsnmp_tlsbase_verify_server_cert implements these checks
+    */
+    if (netsnmp_tlsbase_verify_server_cert(ssl, tlsdata) != SNMPERR_SUCCESS) {
+        /* XXX: unknown vs invalid; two counters */
+        snmp_increment_statistic(STAT_TLSTM_SNMPTLSTMSESSIONUNKNOWNSERVERCERTIFICATE);
+        snmp_log(LOG_ERR, "tlstcp: failed to verify ssl certificate\n");
+        SSL_shutdown(ssl);
+        BIO_free(bio);
+        return NULL;
+    }
+
+    /* RFC5953 Section 5.3.1: Establishing a Session as a Client
+       5)  (D)TLS provides assurance that the authenticated identity has
+       been signed by a trusted configured certification authority.  If
+       verification of the server's certificate fails in any way (for
+       example because of failures in cryptographic verification or the
+       presented identity did not match the expected named entity) then
+       the session establishment MUST fail, the
+       snmpTlstmSessionInvalidServerCertificates object is incremented.
+       If the session can not be opened for any reason at all, including
+       cryptographic verification failures, then the
+       snmpTlstmSessionOpenErrors counter is incremented and processing
+       stops.
+
+    */
+    /* XXX: add snmpTlstmSessionInvalidServerCertificates on
+       crypto failure */
+
+    /* RFC5953 Section 5.3.1: Establishing a Session as a Client
+       6)  The TLSTM-specific session identifier (tlstmSessionID) is set in
+       the tmSessionID of the tmStateReference passed to the TLS
+       Transport Model to indicate that the session has been established
+       successfully and to point to a specific (D)TLS connection for
+       future use.  The tlstmSessionID is also stored in the LCD for
+       later lookup during processing of incoming messages
+       (Section 5.1.2).
+    */
+    /* Implementation notes:
+       - the tlsdata pointer is used as our session identifier, as
+       noted in the netsnmp_tlstcp_recv() function comments.
+    */
+
+    t->sock = BIO_get_fd(bio, NULL);
+
+    return t;
+}
+
+static netsnmp_transport *
+netsnmp_tlstcp_open_server(netsnmp_transport *t)
+{
+    _netsnmpTLSBaseData *tlsdata;
+    int rc;
+
+    tlsdata = t->data;
 
-    } else {
 #ifndef NETSNMP_NO_LISTEN_SUPPORT
-        /* Is the server */
-        
-        /* Create the socket bio */
-        DEBUGMSGTL(("tlstcp", "listening on tlstcp port %s\n",
-		    tlsdata->addr_string));
-        tlsdata->accept_bio = BIO_new_accept(tlsdata->addr_string);
-        t->local = (void *) strdup(tlsdata->addr_string);
-        t->local_length = strlen(tlsdata->addr_string)+1;
-        if (NULL == tlsdata->accept_bio) {
-            snmp_log(LOG_ERR, "TLSTCP: Falied to create a accept BIO\n");
-            return NULL;
-        }
+    /* Create the socket bio */
+    DEBUGMSGTL(("tlstcp", "listening on tlstcp port %s\n",
+                tlsdata->addr_string));
+    tlsdata->accept_bio = BIO_new_accept(tlsdata->addr_string);
+    t->local = strdup(tlsdata->addr_string);
+    t->local_length = strlen(tlsdata->addr_string) + 1;
+    if (NULL == tlsdata->accept_bio) {
+        snmp_log(LOG_ERR, "TLSTCP: Failed to create a accept BIO\n");
+        return NULL;
+    }
 
-        /* openssl requires an initial accept to bind() the socket */
-        if (BIO_do_accept(tlsdata->accept_bio) <= 0) {
-	    _openssl_log_error(rc, tlsdata->ssl, "BIO_do__accept");
-            snmp_log(LOG_ERR, "TLSTCP: Falied to do first accept on the TLS accept BIO\n");
-            return NULL;
-        }
+    /* openssl requires an initial accept to bind() the socket */
+    rc = BIO_do_accept(tlsdata->accept_bio);
+    if (rc <= 0) {
+        _openssl_log_error(rc, tlsdata->ssl, "BIO_do_accept");
+        snmp_log(LOG_ERR, "TLSTCP: Failed to do first accept on the TLS accept BIO\n");
+        return NULL;
+    }
 
-        /* create the OpenSSL TLS context */
-        tlsdata->ssl_context = sslctx_server_setup(TLS_method());
+    /* create the OpenSSL TLS context */
+    tlsdata->ssl_context = sslctx_server_setup(TLS_method());
+#ifdef SSL_CTX_set_max_proto_version
+    if (tlsdata->ssl_context)
+        SSL_CTX_set_max_proto_version(tlsdata->ssl_context, TLS1_VERSION);
+#endif
 
-        t->sock = BIO_get_fd(tlsdata->accept_bio, NULL);
-        t->flags |= NETSNMP_TRANSPORT_FLAG_LISTEN;
+    t->sock = BIO_get_fd(tlsdata->accept_bio, NULL);
+    t->flags |= NETSNMP_TRANSPORT_FLAG_LISTEN;
 #else /* NETSNMP_NO_LISTEN_SUPPORT */
-        return NULL;
+    return NULL;
 #endif /* NETSNMP_NO_LISTEN_SUPPORT */
-    }
+
     return t;
 }
 
+netsnmp_transport *
+netsnmp_tlstcp_open(netsnmp_transport *t)
+{
+    _netsnmpTLSBaseData *tlsdata;
+
+    netsnmp_assert_or_return(t != NULL, NULL);
+    netsnmp_assert_or_return(t->data != NULL, NULL);
+    netsnmp_assert_or_return(sizeof(_netsnmpTLSBaseData) == t->data_length,
+                             NULL);
+
+    tlsdata = t->data;
+
+    if (tlsdata->flags & NETSNMP_TLSBASE_IS_CLIENT)
+        return netsnmp_tlstcp_open_client(t);
+    else
+        return netsnmp_tlstcp_open_server(t);
+}
+
 /*
  * Create a TLS-based transport for SNMP.  Local is TRUE if addr is the local
  * address to bind to (i.e. this is a server-type session); otherwise addr is 
@@ -1062,7 +1088,6 @@ netsnmp_tlstcp_ctor(void)
     tlstcpDomain.prefix[0] = "tlstcp";
     tlstcpDomain.prefix[1] = "tls";
 
-    tlstcpDomain.f_create_from_tstring     = NULL;
     tlstcpDomain.f_create_from_tstring_new = netsnmp_tlstcp_create_tstring;
     tlstcpDomain.f_create_from_ostring     = netsnmp_tlstcp_create_ostring;
 
diff -urpN net-snmp-5.8/snmplib/transports/snmpUDPBaseDomain.c net-snmp-5.9.1/snmplib/transports/snmpUDPBaseDomain.c
--- net-snmp-5.8/snmplib/transports/snmpUDPBaseDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpUDPBaseDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -30,6 +30,9 @@
 #if HAVE_NETINET_IN_H
 #include <netinet/in.h>
 #endif
+#if HAVE_NET_IF_H
+#include <net/if.h>
+#endif
 #if HAVE_ARPA_INET_H
 #include <arpa/inet.h>
 #endif
@@ -57,10 +60,6 @@
 #define MSG_DONTWAIT 0
 #endif
 
-#ifndef  MSG_NOSIGNAL
-#define MSG_NOSIGNAL 0
-#endif
-
 void
 _netsnmp_udp_sockopt_set(int fd, int local)
 {
@@ -235,15 +234,17 @@ netsnmp_udpbase_recvfrom(int s, void *bu
     return r;
 }
 
-int netsnmp_udpbase_sendto(int fd, const struct in_addr *srcip, int if_index,
-                           const struct sockaddr *remote, const void *data,
-                           int len)
-{
 #if !defined(WIN32)
+int netsnmp_udpbase_sendto_unix(int fd, const struct in_addr *srcip,
+                                int if_index, const struct sockaddr *remote,
+                                const void *data, int len)
+{
     struct iovec iov;
     struct msghdr m = { NULL };
     char          cmsg[CMSG_SPACE(cmsg_data_size)];
     int           rc;
+    char          iface[IFNAMSIZ];
+    socklen_t     ifacelen = IFNAMSIZ;
 
     iov.iov_base = NETSNMP_REMOVE_CONST(void *, data);
     iov.iov_len  = len;
@@ -256,8 +257,8 @@ int netsnmp_udpbase_sendto(int fd, const
 
     if (srcip && srcip->s_addr != INADDR_ANY) {
         struct cmsghdr *cm;
-
-        DEBUGMSGTL(("udpbase:sendto", "sending from %s\n", inet_ntoa(*srcip)));
+        struct in_pktinfo ipi;
+        int use_sendto = FALSE;
 
         memset(cmsg, 0, sizeof(cmsg));
 
@@ -271,28 +272,49 @@ int netsnmp_udpbase_sendto(int fd, const
         cm->cmsg_level = SOL_IP;
         cm->cmsg_type = IP_PKTINFO;
 
-        {
-            struct in_pktinfo ipi;
+        memset(&ipi, 0, sizeof(ipi));
+#ifdef HAVE_SO_BINDTODEVICE
+        /*
+         * For asymmetric multihomed users, we only set ifindex to 0 to
+         * let kernel handle return if there was no iface bound to the
+         * socket.
+         */
+        if (getsockopt(fd, SOL_SOCKET, SO_BINDTODEVICE, iface,
+                       &ifacelen) != 0)  {
+            DEBUGMSGTL(("udpbase:sendto",
+                        "getsockopt SO_BINDTODEVICE failed: %s\n",
+                        strerror(errno)));
+        } else if (ifacelen == 0) {
+            DEBUGMSGTL(("udpbase:sendto",
+                        "sendto: SO_BINDTODEVICE not set\n"));
+        } else {
+            DEBUGMSGTL(("udpbase:sendto",
+                        "sendto: SO_BINDTODEVICE dev=%s using ifindex=%d\n",
+                        iface, if_index));
+            use_sendto = TRUE;
+        }
+#endif /* HAVE_SO_BINDTODEVICE */
 
-            memset(&ipi, 0, sizeof(ipi));
-            /*
-             * Except in the case of responding
-             * to a broadcast, setting the ifindex
-             * when responding results in incorrect
-             * behavior of changing the source address
-             * that the manager sees the response
-             * come from.
-             */
-            ipi.ipi_ifindex = 0;
-#if defined(cygwin)
-            ipi.ipi_addr.s_addr = srcip->s_addr;
+#ifdef HAVE_STRUCT_IN_PKTINFO_IPI_SPEC_DST
+        DEBUGMSGTL(("udpbase:sendto", "sending from %s\n",
+                    inet_ntoa(*srcip)));
+        ipi.ipi_spec_dst.s_addr = srcip->s_addr;
 #else
-            ipi.ipi_spec_dst.s_addr = srcip->s_addr;
+        DEBUGMSGTL(("udpbase:sendto", "ignoring from address %s\n",
+                    inet_ntoa(*srcip)));
 #endif
-            memcpy(CMSG_DATA(cm), &ipi, sizeof(ipi));
-        }
+        memcpy(CMSG_DATA(cm), &ipi, sizeof(ipi));
 
-        rc = sendmsg(fd, &m, MSG_NOSIGNAL|MSG_DONTWAIT);
+        /*
+         * For Linux and VRF, use sendto() instead of sendmsg(). Do not pass a
+         * cmsg with IP_PKTINFO set because that would override the bind to
+         * VRF which is set by 'vrf exec' command. That would break VRF.
+         */
+        if (use_sendto)
+            rc = sendto(fd, data, len, MSG_DONTWAIT, remote,
+                        sizeof(struct sockaddr));
+        else
+            rc = sendmsg(fd, &m, MSG_DONTWAIT);
         if (rc >= 0 || errno != EINVAL)
             return rc;
 
@@ -309,9 +331,7 @@ int netsnmp_udpbase_sendto(int fd, const
 
             memset(&ipi, 0, sizeof(ipi));
             ipi.ipi_ifindex = if_index;
-#if defined(cygwin)
-            ipi.ipi_addr.s_addr = INADDR_ANY;
-#else
+#ifdef HAVE_STRUCT_IN_PKTINFO_IPI_SPEC_DST
             ipi.ipi_spec_dst.s_addr = INADDR_ANY;
 #endif
             memcpy(CMSG_DATA(cm), &ipi, sizeof(ipi));
@@ -321,7 +341,7 @@ int netsnmp_udpbase_sendto(int fd, const
         cm->cmsg_type = IP_SENDSRCADDR;
         memcpy((struct in_addr *)CMSG_DATA(cm), srcip, sizeof(struct in_addr));
 #endif
-        rc = sendmsg(fd, &m, MSG_NOSIGNAL|MSG_DONTWAIT);
+        rc = sendmsg(fd, &m, MSG_DONTWAIT);
         if (rc >= 0 || errno != EINVAL)
             return rc;
 
@@ -330,8 +350,13 @@ int netsnmp_udpbase_sendto(int fd, const
         m.msg_controllen = 0;
     }
 
-    return sendmsg(fd, &m, MSG_NOSIGNAL|MSG_DONTWAIT);
+    return sendmsg(fd, &m, MSG_DONTWAIT);
+}
 #else /* !defined(WIN32) */
+int netsnmp_udpbase_sendto_win32(int fd, const struct in_addr *srcip,
+                                 int if_index, const struct sockaddr *remote,
+                                 const void *data, int len)
+{
     WSABUF        wsabuf;
     WSAMSG        m;
     char          cmsg[WSA_CMSG_SPACE(sizeof(struct in_pktinfo))];
@@ -378,6 +403,17 @@ int netsnmp_udpbase_sendto(int fd, const
     }
     rc = sendto(fd, data, len, 0, remote, sizeof(struct sockaddr));
     return rc;
+}
+#endif /* !defined(WIN32) */
+
+int netsnmp_udpbase_sendto(int fd, const struct in_addr *srcip, int if_index,
+                           const struct sockaddr *remote, const void *data,
+                           int len)
+{
+#if !defined(WIN32)
+    return netsnmp_udpbase_sendto_unix(fd, srcip, if_index, remote, data, len);
+#else /* !defined(WIN32) */
+    return netsnmp_udpbase_sendto_win32(fd, srcip, if_index, remote, data, len);
 #endif /* !defined(WIN32) */
 }
 #endif /* HAVE_IP_PKTINFO || HAVE_IP_RECVDSTADDR */
@@ -504,6 +540,8 @@ netsnmp_udp_base_ctor(void)
     DWORD nbytes;
     int result;
 
+    netsnmp_static_assert(sizeof(in_addr_t) ==
+                          sizeof((struct sockaddr_in *)NULL)->sin_addr);
     netsnmp_assert(s != SOCKET_ERROR);
     /* WSARecvMsg(): Windows XP / Windows Server 2003 and later */
     result = WSAIoctl(s, SIO_GET_EXTENSION_FUNCTION_POINTER,
diff -urpN net-snmp-5.8/snmplib/transports/snmpUDPDomain.c net-snmp-5.9.1/snmplib/transports/snmpUDPDomain.c
--- net-snmp-5.8/snmplib/transports/snmpUDPDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpUDPDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -17,6 +17,7 @@
 #include <net-snmp/net-snmp-config.h>
 
 #include <net-snmp/types.h>
+#include <net-snmp/library/snmpIPBaseDomain.h>
 #include <net-snmp/library/snmpUDPDomain.h>
 #include <net-snmp/library/snmpUDPIPv4BaseDomain.h>
 
@@ -53,10 +54,6 @@
 #include <sys/uio.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 #include <net-snmp/config_api.h>
@@ -157,11 +154,11 @@ netsnmp_udp_transport_base(netsnmp_trans
  * the remote address to send things to.
  */
 netsnmp_transport *
-netsnmp_udp_transport(const struct sockaddr_in *addr, int local)
+netsnmp_udp_transport(const struct netsnmp_ep *ep, int local)
 {
     netsnmp_transport *t = NULL;
 
-    t = netsnmp_udpipv4base_transport(addr, local);
+    t = netsnmp_udpipv4base_transport(ep, local);
     if (NULL != t) {
         netsnmp_udp_transport_base(t);
     }
@@ -175,13 +172,13 @@ netsnmp_udp_transport(const struct socka
  * to send from.
  */
 netsnmp_transport *
-netsnmp_udp_transport_with_source(const struct sockaddr_in *addr, int local,
-                                  const struct sockaddr_in *src_addr)
+netsnmp_udp_transport_with_source(const struct netsnmp_ep *ep, int local,
+                                  const struct netsnmp_ep *src_addr)
 
 {
     netsnmp_transport *t = NULL;
 
-    t = netsnmp_udpipv4base_transport_with_source(addr, local, src_addr);
+    t = netsnmp_udpipv4base_transport_with_source(ep, local, src_addr);
     if (NULL != t) {
         netsnmp_udp_transport_base(t);
     }
@@ -369,6 +366,7 @@ netsnmp_udp_parse_security(const char *t
         mask.s_addr = 0;
         negate = 0;
     } else {
+        char *strmask;
         if (*source == '!') {
             negate = 1;
             sourcep = source + 1;
@@ -378,7 +376,7 @@ netsnmp_udp_parse_security(const char *t
         }
 
         /* Split the source/netmask parts */
-        char *strmask = strchr(sourcep, '/');
+        strmask = strchr(sourcep, '/');
         if (strmask != NULL)
             /* Mask given. */
             *strmask++ = '\0';
@@ -388,7 +386,7 @@ netsnmp_udp_parse_security(const char *t
             /* Nope, wasn't a dotted quad.  Must be a hostname. */
             int ret = netsnmp_gethostbyname_v4(sourcep, &network.s_addr);
             if (ret < 0) {
-                config_perror("cannot resolve source hostname");
+                config_perror("cannot resolve IPv4 source hostname");
                 return;
             }
         }
@@ -606,9 +604,9 @@ netsnmp_transport *
 netsnmp_udp_create_tstring(const char *str, int local,
 			   const char *default_target)
 {
-    struct sockaddr_in addr;
+    struct netsnmp_ep addr;
 
-    if (netsnmp_sockaddr_in2(&addr, str, default_target)) {
+    if (netsnmp_sockaddr_in3(&addr, str, default_target)) {
         return netsnmp_udp_transport(&addr, local);
     } else {
         return NULL;
@@ -629,10 +627,11 @@ netsnmp_udp_create_tspec(netsnmp_tdomain
 netsnmp_transport *
 netsnmp_udp_create_ostring(const void *o, size_t o_len, int local)
 {
-    struct sockaddr_in sin;
+    struct netsnmp_ep ep;
 
-    if (netsnmp_ipv4_ostring_to_sockaddr(&sin, o, o_len))
-        return netsnmp_udp_transport(&sin, local);
+    memset(&ep, 0, sizeof(ep));
+    if (netsnmp_ipv4_ostring_to_sockaddr(&ep.a.sin, o, o_len))
+        return netsnmp_udp_transport(&ep, local);
     return NULL;
 }
 
@@ -645,7 +644,6 @@ netsnmp_udp_ctor(void)
     udpDomain.prefix = (const char**)calloc(2, sizeof(char *));
     udpDomain.prefix[0] = "udp";
 
-    udpDomain.f_create_from_tstring     = NULL;
     udpDomain.f_create_from_tstring_new = netsnmp_udp_create_tstring;
     udpDomain.f_create_from_tspec       = netsnmp_udp_create_tspec;
     udpDomain.f_create_from_ostring     = netsnmp_udp_create_ostring;
diff -urpN net-snmp-5.8/snmplib/transports/snmpUDPIPv4BaseDomain.c net-snmp-5.9.1/snmplib/transports/snmpUDPIPv4BaseDomain.c
--- net-snmp-5.8/snmplib/transports/snmpUDPIPv4BaseDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpUDPIPv4BaseDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -13,6 +13,7 @@
 #include <net-snmp/net-snmp-config.h>
 
 #include <net-snmp/types.h>
+#include <net-snmp/library/snmpIPBaseDomain.h>
 #include <net-snmp/library/snmpUDPIPv4BaseDomain.h>
 
 #include <stddef.h>
@@ -72,9 +73,10 @@ int netsnmp_udpipv4_sendto(int fd, const
 #endif /* HAVE_IP_PKTINFO || HAVE_IP_RECVDSTADDR */
 
 netsnmp_transport *
-netsnmp_udpipv4base_transport_init(const struct sockaddr_in *addr, int local)
+netsnmp_udpipv4base_transport_init(const struct netsnmp_ep *ep, int local)
 {
     netsnmp_transport *t;
+    const struct sockaddr_in *addr = &ep->a.sin;
     u_char *addr_ptr;
 
     if (addr == NULL || addr->sin_family != AF_INET) {
@@ -152,8 +154,10 @@ netsnmp_udpipv4base_transport_socket(int
 
 int
 netsnmp_udpipv4base_transport_bind(netsnmp_transport *t,
-                                   const struct sockaddr_in *addr, int flags)
+                                   const struct netsnmp_ep *ep,
+                                   int flags)
 {
+    const struct sockaddr_in *addr = &ep->a.sin;
 #if defined(HAVE_IP_PKTINFO) || defined(HAVE_IP_RECVDSTADDR)
     int                sockopt = 1;
 #endif
@@ -204,16 +208,30 @@ netsnmp_udpipv4base_transport_bind(netsn
                     t->sock, str));
         free(str);
     }
+    if (flags & NETSNMP_TSPEC_PREBOUND) {
+        DEBUGMSGTL(("netsnmp_udpbase", "socket %d is prebound, nothing to do\n",
+                    t->sock));
+        return 0;
+    }
+    rc = netsnmp_bindtodevice(t->sock, ep->iface);
+    if (rc != 0) {
+        DEBUGMSGTL(("netsnmp_udpbase", "failed to bind to iface %s: %s\n",
+                    ep->iface, strerror(errno)));
+        goto err;
+    }
     rc = bind(t->sock, (const struct sockaddr *)addr, sizeof(*addr));
     if ( rc != 0 ) {
         DEBUGMSGTL(("netsnmp_udpbase",
                     "failed to bind for clientaddr: %d %s\n",
                     errno, strerror(errno)));
-        netsnmp_socketbase_close(t);
-        return 1;
+        goto err;
     }
 
     return 0;
+
+err:
+    netsnmp_socketbase_close(t);
+    return 1;
 }
 
 void
@@ -247,20 +265,20 @@ netsnmp_udpipv4base_transport_get_bound_
 }
 
 netsnmp_transport *
-netsnmp_udpipv4base_transport_with_source(const struct sockaddr_in *addr,
+netsnmp_udpipv4base_transport_with_source(const struct netsnmp_ep *ep,
                                           int local,
-                                          const struct sockaddr_in *src_addr)
+                                          const struct netsnmp_ep *src_addr)
 {
     netsnmp_transport         *t = NULL;
-    const struct sockaddr_in  *bind_addr;
+    const struct netsnmp_ep   *bind_addr;
     int                        rc, flags = 0;
 
-    t = netsnmp_udpipv4base_transport_init(addr, local);
+    t = netsnmp_udpipv4base_transport_init(ep, local);
     if (NULL == t)
          return NULL;
 
     if (local) {
-        bind_addr = addr;
+        bind_addr = ep;
         flags |= NETSNMP_TSPEC_LOCAL;
 
 #ifndef NETSNMP_NO_SYSTEMD
@@ -268,7 +286,9 @@ netsnmp_udpipv4base_transport_with_sourc
          * Maybe the socket was already provided by systemd...
          */
         t->sock = netsnmp_sd_find_inet_socket(PF_INET, SOCK_DGRAM, -1,
-                                              ntohs(addr->sin_port));
+                                              ntohs(ep->a.sin.sin_port));
+        if (t->sock >= 0)
+            flags |= NETSNMP_TSPEC_PREBOUND;
 #endif
     }
     else
@@ -288,6 +308,17 @@ netsnmp_udpipv4base_transport_with_sourc
     if (NULL == bind_addr)
         return t;
 
+    /* for Linux VRF Traps we try to bind the iface if clientaddr is not set */
+    if (ep && ep->iface[0]) {
+        rc = netsnmp_bindtodevice(t->sock, ep->iface);
+        if (rc)
+            DEBUGMSGTL(("netsnmp_udpbase", "VRF: Could not bind socket %d to %s\n",
+                        t->sock, ep->iface));
+        else
+            DEBUGMSGTL(("netsnmp_udpbase", "VRF: Bound socket %d to %s\n",
+                        t->sock, ep->iface));
+    }
+
     rc = netsnmp_udpipv4base_transport_bind(t, bind_addr, flags);
     if (rc) {
         netsnmp_transport_free(t);
@@ -302,7 +333,7 @@ netsnmp_udpipv4base_transport_with_sourc
 netsnmp_transport *
 netsnmp_udpipv4base_tspec_transport(netsnmp_tdomain_spec *tspec)
 {
-    struct sockaddr_in addr;
+    struct netsnmp_ep addr;
     int local;
 
     if (NULL == tspec)
@@ -311,20 +342,17 @@ netsnmp_udpipv4base_tspec_transport(nets
     local = tspec->flags & NETSNMP_TSPEC_LOCAL;
 
     /** get address from target */
-    if (!netsnmp_sockaddr_in2(&addr, tspec->target, tspec->default_target))
+    if (!netsnmp_sockaddr_in3(&addr, tspec->target, tspec->default_target))
         return NULL;
 
     if (NULL != tspec->source) {
-        struct sockaddr_in src_addr, *srcp = &src_addr;
+        struct netsnmp_ep src_addr;
+
         /** get sockaddr from source */
-        if (!netsnmp_sockaddr_in2(&src_addr, tspec->source, NULL))
+        if (!netsnmp_sockaddr_in3(&src_addr, tspec->source, ":0"))
             return NULL;
-        return netsnmp_udpipv4base_transport_with_source(&addr, local, srcp);
-     } else {
-        /** if no source and we do not want any default client address */
-        if (tspec->flags & NETSNMP_TSPEC_NO_DFTL_CLIENT_ADDR)
-            return netsnmp_udpipv4base_transport_with_source(&addr, local,
-                                                             NULL);
+        return netsnmp_udpipv4base_transport_with_source(&addr, local,
+                                                         &src_addr);
     }
 
     /** no source and default client address ok */
@@ -332,48 +360,33 @@ netsnmp_udpipv4base_tspec_transport(nets
 }
 
 netsnmp_transport *
-netsnmp_udpipv4base_transport(const struct sockaddr_in *addr, int local)
+netsnmp_udpipv4base_transport(const struct netsnmp_ep *ep, int local)
 {
-    if (!local) {
-        /*
-         * This is a client session.  If we've been given a
-         * client address to send from, then bind to that.
-         * Otherwise the send will use "something sensible".
-         */
-        const char *client_socket;
-        client_socket = netsnmp_ds_get_string(NETSNMP_DS_LIBRARY_ID,
-                                              NETSNMP_DS_LIB_CLIENT_ADDR);
-        if (client_socket) {
-            struct sockaddr_in client_addr;
-            char *client_address = NETSNMP_REMOVE_CONST(char *,client_socket);
-            int have_port, rc;
-            int uses_port =
-                netsnmp_ds_get_boolean(NETSNMP_DS_LIBRARY_ID,
-                                       NETSNMP_DS_LIB_CLIENT_ADDR_USES_PORT);
-            have_port = (strchr(client_socket, ':') != NULL);
-            if ((uses_port == 1) && !have_port) {
-                /*
-                 * if NETSNMP_DS_LIB_CLIENT_ADDR expects a port but there
-                 *  is none specified then provide ephemeral one/
-                 */
-                client_address = malloc(strlen(client_socket) + 3);
-                if (client_address == NULL) {
-                    return NULL;
-                }
-                strcpy(client_address, client_socket);
-                strcat(client_address, ":0");
-                have_port = 1;
-            }
-            rc = netsnmp_sockaddr_in2(&client_addr, client_socket, NULL);
-            if (client_address != client_socket)
-                free(client_address);
-            if(rc) {
-                if (!uses_port || !have_port) /* if port isn't from string, */
-                    client_addr.sin_port = 0; /* ... clear it */
-                return netsnmp_udpipv4base_transport_with_source(addr, local,
-                                                                 &client_addr);
-            }
-        }
+    struct netsnmp_ep client_ep;
+    const char *client_addr;
+    int uses_port;
+
+    memset(&client_ep, 0, sizeof(client_ep));
+    client_ep.a.sin.sin_family = AF_INET;
+
+    if (local)
+        goto out;
+
+    client_addr = netsnmp_ds_get_string(NETSNMP_DS_LIBRARY_ID,
+                                        NETSNMP_DS_LIB_CLIENT_ADDR);
+    if (!client_addr)
+        goto out;
+
+    if (netsnmp_sockaddr_in3(&client_ep, client_addr, ":0") < 0) {
+        snmp_log(LOG_ERR, "Parsing clientaddr %s failed\n", client_addr);
+        goto out;
     }
-    return netsnmp_udpipv4base_transport_with_source(addr, local, NULL);
+
+    uses_port = netsnmp_ds_get_boolean(NETSNMP_DS_LIBRARY_ID,
+                                       NETSNMP_DS_LIB_CLIENT_ADDR_USES_PORT);
+    if (!uses_port)
+        client_ep.a.sin.sin_port = 0;
+
+out:
+    return netsnmp_udpipv4base_transport_with_source(ep, local, &client_ep);
 }
diff -urpN net-snmp-5.8/snmplib/transports/snmpUDPIPv6Domain.c net-snmp-5.9.1/snmplib/transports/snmpUDPIPv6Domain.c
--- net-snmp-5.8/snmplib/transports/snmpUDPIPv6Domain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpUDPIPv6Domain.c	2021-05-26 05:19:35.000000000 +0700
@@ -6,6 +6,7 @@
  */
 #include <net-snmp/net-snmp-config.h>
 
+#include <net-snmp/library/snmpIPBaseDomain.h>
 #include <net-snmp/library/snmpUDPIPv6Domain.h>
 #include <net-snmp/library/system.h>
 
@@ -33,11 +34,6 @@
 #if HAVE_SYS_SOCKET_H
 #include <sys/socket.h>
 #endif
-
-#if defined(HAVE_WINSOCK_H) && !defined(mingw32)
-static const struct in6_addr in6addr_any = IN6ADDR_ANY_INIT;
-#endif
-
 #if HAVE_NETINET_IN_H
 #include <netinet/in.h>
 #endif
@@ -51,20 +47,12 @@ static const struct in6_addr in6addr_any
 #include <net/if.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #if HAVE_STRUCT_SOCKADDR_STORAGE_SS_FAMILY
 #define SS_FAMILY ss_family
 #elif HAVE_STRUCT_SOCKADDR_STORAGE___SS_FAMILY
 #define SS_FAMILY __ss_family
 #endif
 
-#if defined(darwin)
-#include <stdint.h> /* for uint8_t */
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 #include <net-snmp/config_api.h>
@@ -191,8 +179,9 @@ netsnmp_udp6_send(netsnmp_transport *t,
  */
 
 netsnmp_transport *
-netsnmp_udp6_transport_init(const struct sockaddr_in6 *addr, int flags)
+netsnmp_udp6_transport_init(const struct netsnmp_ep *ep, int flags)
 {
+    const struct sockaddr_in6 *addr = &ep->a.sin6;
     netsnmp_transport *t = NULL;
     int             local = flags & NETSNMP_TSPEC_LOCAL;
     u_char         *addr_ptr;
@@ -274,9 +263,10 @@ netsnmp_udp6_transport_init(const struct
 
 int
 netsnmp_udp6_transport_bind(netsnmp_transport *t,
-                            const struct sockaddr_in6 *addr,
+                            const struct netsnmp_ep *ep,
                             int flags)
 {
+    const struct sockaddr_in6 *addr = &ep->a.sin6;
     int             local = flags & NETSNMP_TSPEC_LOCAL;
     int             rc = 0;
 
@@ -305,19 +295,33 @@ netsnmp_udp6_transport_bind(netsnmp_tran
     DEBUGIF("netsnmp_udp6") {
         char *str;
         str = netsnmp_udp6_fmtaddr(NULL, addr, sizeof(*addr));
-        DEBUGMSGTL(("netsnmp_udpbase", "binding socket: %d to %s\n",
+        DEBUGMSGTL(("netsnmp_udp6", "binding socket: %d to %s\n",
                     t->sock, str));
         free(str);
     }
+    if (flags & NETSNMP_TSPEC_PREBOUND) {
+        DEBUGMSGTL(("netsnmp_udp6", "socket %d is prebound, nothing to do\n",
+                    t->sock));
+        return 0;
+    }
+    rc = netsnmp_bindtodevice(t->sock, ep->iface);
+    if (rc != 0) {
+        DEBUGMSGTL(("netsnmp_udp6", "failed to bind to iface %s: %s\n",
+                    ep->iface, strerror(errno)));
+        goto err;
+    }
     rc = bind(t->sock, (const struct sockaddr *)addr, sizeof(*addr));
     if (rc != 0) {
         DEBUGMSGTL(("netsnmp_udp6", "failed to bind for clientaddr: %d %s\n",
                     errno, strerror(errno)));
-        netsnmp_socketbase_close(t);
-        return -1;
+        goto err;
     }
 
     return 0;
+
+err:
+    netsnmp_socketbase_close(t);
+    return -1;
 }
 
 int
@@ -368,7 +372,7 @@ netsnmp_udp6_transport_get_bound_addr(ne
 netsnmp_transport *
 netsnmp_udpipv6base_tspec_transport(netsnmp_tdomain_spec *tspec)
 {
-    struct sockaddr_in6 addr;
+    struct netsnmp_ep ep;
     int local;
 
     if (NULL == tspec)
@@ -377,40 +381,36 @@ netsnmp_udpipv6base_tspec_transport(nets
     local = tspec->flags & NETSNMP_TSPEC_LOCAL;
 
     /** get address from target */
-    if (!netsnmp_sockaddr_in6_2(&addr, tspec->target, tspec->default_target))
+    if (!netsnmp_sockaddr_in6_3(&ep, tspec->target, tspec->default_target))
         return NULL;
 
     if (NULL != tspec->source) {
-        struct sockaddr_in6 src_addr, *srcp = &src_addr;
+        struct netsnmp_ep src_addr;
+
         /** get sockaddr from source */
-        if (!netsnmp_sockaddr_in6_2(&src_addr, tspec->source, NULL))
+        if (!netsnmp_sockaddr_in6_3(&src_addr, tspec->source, ":0"))
             return NULL;
-        return netsnmp_udp6_transport_with_source(&addr, local, srcp);
-     } else {
-        /** if no source and we do not want any default client address */
-        if (tspec->flags & NETSNMP_TSPEC_NO_DFTL_CLIENT_ADDR)
-            return netsnmp_udp6_transport_with_source(&addr, local,
-                                                             NULL);
+        return netsnmp_udp6_transport_with_source(&ep, local, &src_addr);
     }
 
     /** no source and default client address ok */
-    return netsnmp_udp6_transport(&addr, local);
+    return netsnmp_udp6_transport(&ep, local);
 }
 
 netsnmp_transport *
-netsnmp_udp6_transport_with_source(const struct sockaddr_in6 *addr, int local,
-                                   const struct sockaddr_in6 *src_addr)
+netsnmp_udp6_transport_with_source(const struct netsnmp_ep *ep,
+              int local, const struct netsnmp_ep *src_addr)
 {
     netsnmp_transport         *t = NULL;
-    const struct sockaddr_in6 *bind_addr;
+    const struct netsnmp_ep   *bind_addr;
     int                        rc, flags = 0;
 
-    t = netsnmp_udp6_transport_init(addr, local);
+    t = netsnmp_udp6_transport_init(ep, local);
     if (NULL == t)
         return NULL;
 
     if (local) {
-        bind_addr = addr;
+        bind_addr = ep;
         flags |= NETSNMP_TSPEC_LOCAL;
 
 #ifndef NETSNMP_NO_SYSTEMD
@@ -418,7 +418,9 @@ netsnmp_udp6_transport_with_source(const
          * Maybe the socket was already provided by systemd...
          */
         t->sock = netsnmp_sd_find_inet_socket(PF_INET6, SOCK_DGRAM, -1,
-                                              ntohs(addr->sin6_port));
+                                              ntohs(ep->a.sin6.sin6_port));
+        if (t->sock >= 0)
+            flags |= NETSNMP_TSPEC_PREBOUND;
 #endif
     }
     else
@@ -456,21 +458,27 @@ netsnmp_udp6_transport_with_source(const
  */
 
 netsnmp_transport *
-netsnmp_udp6_transport(const struct sockaddr_in6 *addr, int local)
+netsnmp_udp6_transport(const struct netsnmp_ep *ep, int local)
 {
-    if (!local) {
-        const char *client_socket;
-        client_socket = netsnmp_ds_get_string(NETSNMP_DS_LIBRARY_ID,
-                                              NETSNMP_DS_LIB_CLIENT_ADDR);
-        if (client_socket) {
-            struct sockaddr_in6 client_addr;
-            if(!netsnmp_sockaddr_in6_2(&client_addr, client_socket, NULL)) {
-                return netsnmp_udp6_transport_with_source(addr, local,
-                                                          &client_addr);
-            }
-        }
-    }
-    return netsnmp_udp6_transport_with_source(addr, local, NULL);
+    struct netsnmp_ep client_ep;
+    const char *client_addr;
+
+    memset(&client_ep, 0, sizeof(client_ep));
+    client_ep.a.sin6.sin6_family = AF_INET6;
+
+    if (local)
+        goto out;
+
+    client_addr = netsnmp_ds_get_string(NETSNMP_DS_LIBRARY_ID,
+                                        NETSNMP_DS_LIB_CLIENT_ADDR);
+    if (!client_addr)
+        goto out;
+
+    if (netsnmp_sockaddr_in6_3(&client_ep, client_addr, ":0") < 0)
+        snmp_log(LOG_ERR, "Parsing clientaddr %s failed\n", client_addr);
+
+out:
+    return netsnmp_udp6_transport_with_source(ep, local, &client_ep);
 }
 
 
@@ -677,6 +685,7 @@ netsnmp_udp6_parse_security(const char *
             negate = 0;
             sourcep = NULL;    /* gcc gets confused about sourcep being used */
         } else {
+            char *strmask;
             if (*source == '!') {
                negate = 1;
                sourcep = source + 1;
@@ -686,7 +695,7 @@ netsnmp_udp6_parse_security(const char *
             }
 
             /* Split the source/netmask parts */
-            char *strmask = strchr(sourcep, '/');
+            strmask = strchr(sourcep, '/');
             if (strmask != NULL)
                 /* Mask given. */
                 *strmask++ = '\0';
@@ -694,7 +703,7 @@ netsnmp_udp6_parse_security(const char *
             /* Try to interpret the mask */
             if (strmask == NULL || *strmask == '\0') {
                 /* No mask was given. Assume /128 */
-                memset(mask.s6_addr, '\xff', sizeof(mask.s6_addr));
+                memset(mask.s6_addr, 0xff, sizeof(mask.s6_addr));
             } else {
                 /* Try to interpret mask as a "number of 1 bits". */
                 char* cp;
@@ -703,9 +712,10 @@ netsnmp_udp6_parse_security(const char *
                     if (0 <= masklength && masklength <= 128) {
                         const int j = masklength / 8;
                         const int jj = masklength % 8;
-                        memset(mask.s6_addr, '\xff', j);
+
+                        memset(mask.s6_addr, 0xff, j);
                         if (j < 16) {
-                            mask.s6_addr[j] = ((uint8_t)~0U << (8 - jj));
+                            mask.s6_addr[j] = (0xffu << (8 - jj));
                             memset(mask.s6_addr + j + 1, '\0', 15 - j);
                         }
                     } else {
@@ -732,7 +742,15 @@ netsnmp_udp6_parse_security(const char *
                 memset(&pton_addr.sin6_addr.s6_addr, '\0',
                        sizeof(struct in6_addr));
             } else if (inet_pton(AF_INET6, sourcep, &pton_addr.sin6_addr) != 1) {
-                /* Nope, wasn't a numeric address. Must be a hostname. */
+                /* Nope, wasn't a numeric IPv6 address. Must be IPv4 or a hostname. */
+
+                /* Try interpreting as dotted quad - IPv4 */
+                struct in_addr network;
+                if (inet_pton(AF_INET, sourcep, &network) > 0){
+                    /* Yes, it's IPv4 - so it's already parsed and we can return. */
+                    DEBUGMSGTL(("com2sec6", "IPv4 detected for IPv6 parser. Skipping.\n"));
+                    return;
+                }
 #if HAVE_GETADDRINFO
                 int             gai_error;
 
@@ -922,10 +940,10 @@ netsnmp_transport *
 netsnmp_udp6_create_tstring(const char *str, int local,
 			    const char *default_target)
 {
-    struct sockaddr_in6 addr;
+    struct netsnmp_ep ep;
 
-    if (netsnmp_sockaddr_in6_2(&addr, str, default_target)) {
-        return netsnmp_udp6_transport(&addr, local);
+    if (netsnmp_sockaddr_in6_3(&ep, str, default_target)) {
+        return netsnmp_udp6_transport(&ep, local);
     } else {
         return NULL;
     }
@@ -952,10 +970,11 @@ netsnmp_udp6_create_tspec(netsnmp_tdomai
 netsnmp_transport *
 netsnmp_udp6_create_ostring(const void *o, size_t o_len, int local)
 {
-    struct sockaddr_in6 sin6;
+    struct netsnmp_ep ep;
 
-    if (netsnmp_ipv6_ostring_to_sockaddr(&sin6, o, o_len))
-        return netsnmp_udp6_transport(&sin6, local);
+    memset(&ep, 0, sizeof(ep));
+    if (netsnmp_ipv6_ostring_to_sockaddr(&ep.a.sin6, o, o_len))
+        return netsnmp_udp6_transport(&ep, local);
     return NULL;
 }
 
@@ -965,7 +984,6 @@ netsnmp_udpipv6_ctor(void)
 {
     udp6Domain.name = netsnmp_UDPIPv6Domain;
     udp6Domain.name_length = sizeof(netsnmp_UDPIPv6Domain) / sizeof(oid);
-    udp6Domain.f_create_from_tstring     = NULL;
     udp6Domain.f_create_from_tstring_new = netsnmp_udp6_create_tstring;
     udp6Domain.f_create_from_tspec       = netsnmp_udp6_create_tspec;
     udp6Domain.f_create_from_ostring     = netsnmp_udp6_create_ostring;
diff -urpN net-snmp-5.8/snmplib/transports/snmpUDPsharedDomain.c net-snmp-5.9.1/snmplib/transports/snmpUDPsharedDomain.c
--- net-snmp-5.8/snmplib/transports/snmpUDPsharedDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpUDPsharedDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -9,6 +9,7 @@
 #include <net-snmp/net-snmp-config.h>
 
 #include <net-snmp/types.h>
+#include <net-snmp/library/snmpIPBaseDomain.h>
 #include <net-snmp/library/snmpUDPsharedDomain.h>
 
 #include <stddef.h>
@@ -46,7 +47,7 @@
 #include <net-snmp/library/snmpUDPDomain.h>
 #include <net-snmp/library/snmpUDPIPv4BaseDomain.h>
 
-netsnmp_feature_require(transport_cache)
+netsnmp_feature_require(transport_cache);
 
 oid    netsnmpUDPsharedDomain[] = { 1,3,6,1,2,1,100,1,999 }; /** made up */
 size_t netsnmpUDPsharedDomain_len = OID_LENGTH(netsnmpUDPsharedDomain);
@@ -189,11 +190,11 @@ _transport_common(netsnmp_transport *t)
 }
 
 netsnmp_transport *
-netsnmp_udpshared_transport(const struct sockaddr_in *addr, int local)
+netsnmp_udpshared_transport(const struct netsnmp_ep *ep, int local)
 {
     netsnmp_transport *t = NULL;
 
-    t = netsnmp_udp_transport(addr, local);
+    t = netsnmp_udp_transport(ep, local);
     if (NULL == t)
         return NULL;
 
@@ -203,9 +204,9 @@ netsnmp_udpshared_transport(const struct
 }
 
 netsnmp_transport *
-netsnmp_udpshared_transport_with_source(const struct sockaddr_in *addr,
+netsnmp_udpshared_transport_with_source(const struct netsnmp_ep *ep,
                                         int flags,
-                                        const struct sockaddr_in *src_addr)
+                                        const struct netsnmp_ep *src_addr)
 {
     netsnmp_transport *t = NULL, *b = NULL;
     int                local = flags & NETSNMP_TSPEC_LOCAL;
@@ -213,11 +214,12 @@ netsnmp_udpshared_transport_with_source(
     DEBUGMSGTL(("udpshared:create", "from addr with source\n"));
 
     /** init common parts of parent transport */
-    t = netsnmp_udpipv4base_transport_init(addr, local);
+    t = netsnmp_udpipv4base_transport_init(ep, local);
     if (NULL == t)
         return NULL;
 
-    _transport_common(t);
+    if (!_transport_common(t))
+        return NULL;
 
     if (!local && src_addr) {
         /** check for existing base transport */
@@ -237,7 +239,7 @@ netsnmp_udpshared_transport_with_source(
 
     /** if no base transport found, create one */
     if (NULL == b) {
-        b = netsnmp_udp_transport_with_source(addr, local, src_addr);
+        b = netsnmp_udp_transport_with_source(ep, local, src_addr);
         if (NULL == b) {
             netsnmp_transport_free(t);
             return NULL;
@@ -271,11 +273,11 @@ netsnmp_udpshared_transport_with_source(
  * the remote address to send things to.
  */
 netsnmp_transport *
-netsnmp_udpshared6_transport(const struct sockaddr_in6 *addr, int local)
+netsnmp_udpshared6_transport(const struct netsnmp_ep *ep, int local)
 {
     netsnmp_transport *t = NULL;
 
-    t = netsnmp_udp6_transport(addr, local);
+    t = netsnmp_udp6_transport(ep, local);
     if (NULL != t)
         t = _transport_common(t);
 
@@ -283,9 +285,9 @@ netsnmp_udpshared6_transport(const struc
 }
 
 netsnmp_transport *
-netsnmp_udpshared6_transport_with_source(const struct sockaddr_in6 *addr6,
+netsnmp_udpshared6_transport_with_source(const struct netsnmp_ep *ep,
                                          int flags,
-                                         const struct sockaddr_in6 *src_addr6)
+                                         const struct netsnmp_ep *src_addr6)
 {
     netsnmp_transport *t = NULL, *b = NULL;
     int                local = flags & NETSNMP_TSPEC_LOCAL;
@@ -293,11 +295,12 @@ netsnmp_udpshared6_transport_with_source
     DEBUGMSGTL(("udpshared:create", "from addr6 with source\n"));
 
     /** init common parts of parent transport */
-    t = netsnmp_udp6_transport_init(addr6, local);
+    t = netsnmp_udp6_transport_init(ep, local);
     if (NULL == t)
         return NULL;
 
-    _transport_common(t);
+    if (!_transport_common(t))
+        return NULL;
 
     if (!local && src_addr6) {
         /** check for existing base transport */
@@ -317,7 +320,7 @@ netsnmp_udpshared6_transport_with_source
 
     /** if no base transport found, create one */
     if (NULL == b) {
-        b = netsnmp_udp6_transport_with_source(addr6, local, src_addr6);
+        b = netsnmp_udp6_transport_with_source(ep, local, src_addr6);
         if (NULL == b) {
             netsnmp_transport_free(t);
             return NULL;
@@ -346,16 +349,16 @@ netsnmp_udpshared6_transport_with_source
 netsnmp_transport *
 netsnmp_udpshared_create_ostring(const void *o, size_t o_len, int local)
 {
-    struct sockaddr_in sin;
-    struct sockaddr_in6 sin6;
+    struct netsnmp_ep ep;
 
     DEBUGMSGTL(("udpshared:create", "from ostring\n"));
 
-    if (netsnmp_ipv4_ostring_to_sockaddr(&sin, o, o_len))
-        return netsnmp_udpshared_transport(&sin, local);
+    memset(&ep, 0, sizeof(ep));
+    if (netsnmp_ipv4_ostring_to_sockaddr(&ep.a.sin, o, o_len))
+        return netsnmp_udpshared_transport(&ep, local);
 #ifdef NETSNMP_TRANSPORT_UDPIPV6_DOMAIN
-    else if (netsnmp_ipv6_ostring_to_sockaddr(&sin6, o, o_len))
-        return netsnmp_udpshared6_transport(&sin6, local);
+    else if (netsnmp_ipv6_ostring_to_sockaddr(&ep.a.sin6, o, o_len))
+        return netsnmp_udpshared6_transport(&ep, local);
 #endif
     return NULL;
 }
@@ -364,19 +367,16 @@ netsnmp_transport *
 netsnmp_udpshared_create_tstring(const char *str, int isserver,
                                  const char *default_target)
 {
-#ifdef NETSNMP_TRANSPORT_UDPIPV6_DOMAIN
-    struct sockaddr_in6 addr6;
-#endif
-    struct sockaddr_in addr;
+    struct netsnmp_ep ep;
     netsnmp_transport *t;
 
     DEBUGMSGTL(("udpshared:create", "from tstring %s\n", str));
 
-    if (netsnmp_sockaddr_in2(&addr, str, default_target))
-        t = netsnmp_udpshared_transport(&addr, isserver);
+    if (netsnmp_sockaddr_in3(&ep, str, default_target))
+        t = netsnmp_udpshared_transport(&ep, isserver);
 #ifdef NETSNMP_TRANSPORT_UDPIPV6_DOMAIN
-    else if (netsnmp_sockaddr_in6_2(&addr6, str, default_target))
-        t = netsnmp_udpshared6_transport(&addr6, isserver);
+    else if (netsnmp_sockaddr_in6_3(&ep, str, default_target))
+        t = netsnmp_udpshared6_transport(&ep, isserver);
 #endif
     else
         return NULL;
@@ -385,68 +385,58 @@ netsnmp_udpshared_create_tstring(const c
 }
 
 static netsnmp_transport *
-_tspec_v4(struct sockaddr_in *addr, netsnmp_tdomain_spec *tspec)
+_tspec_v4(const struct netsnmp_ep *ep, netsnmp_tdomain_spec *tspec)
 {
     int local = tspec->flags & NETSNMP_TSPEC_LOCAL;
 
     if (NULL != tspec->source) {
-        struct sockaddr_in src_addr, *srcp = &src_addr;
+        struct netsnmp_ep src_addr;
+
         /** get sockaddr from source */
-        if (!netsnmp_sockaddr_in2(&src_addr, tspec->source, NULL))
+        if (!netsnmp_sockaddr_in3(&src_addr, tspec->source, NULL))
             return NULL;
-        return netsnmp_udpshared_transport_with_source(addr, local, srcp);
-    } else {
-        /** if no source and we do not want any default client address */
-        if (tspec->flags & NETSNMP_TSPEC_NO_DFTL_CLIENT_ADDR)
-            return netsnmp_udpshared_transport_with_source(addr, local, NULL);
+        return netsnmp_udpshared_transport_with_source(ep, local, &src_addr);
     }
 
     /** no source and default client address ok */
-    return netsnmp_udpshared_transport(addr, local);
+    return netsnmp_udpshared_transport(ep, local);
 }
 
 #ifdef NETSNMP_TRANSPORT_UDPIPV6_DOMAIN
 static netsnmp_transport *
-_tspec_v6(struct sockaddr_in6 *addr, netsnmp_tdomain_spec *tspec)
+_tspec_v6(const struct netsnmp_ep *ep, netsnmp_tdomain_spec *tspec)
 {
     int local = tspec->flags & NETSNMP_TSPEC_LOCAL;
 
     if (NULL != tspec->source) {
-        struct sockaddr_in6 src_addr, *srcp = &src_addr;
+        struct netsnmp_ep src_addr;
+
         /** get sockaddr from source */
-        if (!netsnmp_sockaddr_in6_2(&src_addr, tspec->source, NULL))
+        if (!netsnmp_sockaddr_in6_3(&src_addr, tspec->source, NULL))
             return NULL;
-        return netsnmp_udpshared6_transport_with_source(addr, local, srcp);
-    } else {
-        /** if no source and we do not want any default client address */
-        if (tspec->flags & NETSNMP_TSPEC_NO_DFTL_CLIENT_ADDR)
-            return netsnmp_udpshared6_transport_with_source(addr, local, NULL);
+        return netsnmp_udpshared6_transport_with_source(ep, local, &src_addr);
     }
 
     /** no source and default client address ok */
-    return netsnmp_udpshared6_transport(addr, local);
+    return netsnmp_udpshared6_transport(ep, local);
 }
 #endif /* NETSNMP_TRANSPORT_UDPIPV6_DOMAIN */
 
 netsnmp_transport *
 netsnmp_udpshared_create_tspec(netsnmp_tdomain_spec *tspec)
 {
-#ifdef NETSNMP_TRANSPORT_UDPIPV6_DOMAIN
-    struct sockaddr_in6 addr6;
-#endif
-    struct sockaddr_in addr;
+    struct netsnmp_ep ep;
 
     DEBUGMSGTL(("udpshared:create", "from tspec\n"));
 
     if (NULL == tspec)
         return NULL;
 
-    if (netsnmp_sockaddr_in2(&addr, tspec->target, tspec->default_target))
-        return _tspec_v4(&addr, tspec);
+    if (netsnmp_sockaddr_in3(&ep, tspec->target, tspec->default_target))
+        return _tspec_v4(&ep, tspec);
 #ifdef NETSNMP_TRANSPORT_UDPIPV6_DOMAIN
-    else if (netsnmp_sockaddr_in6_2(&addr6, tspec->target,
-                                    tspec->default_target))
-        return _tspec_v6(&addr6, tspec);
+    else if (netsnmp_sockaddr_in6_3(&ep, tspec->target, tspec->default_target))
+        return _tspec_v6(&ep, tspec);
 #endif
 
     return NULL;
@@ -468,7 +458,6 @@ netsnmp_udpshared_ctor(void)
     domain.prefix = (const char**)calloc(2, sizeof(char *));
     domain.prefix[0] = "udpshared";
 
-    domain.f_create_from_tstring     = NULL;
     domain.f_create_from_tstring_new = netsnmp_udpshared_create_tstring;
     domain.f_create_from_tspec       = netsnmp_udpshared_create_tspec;
     domain.f_create_from_ostring     = netsnmp_udpshared_create_ostring;
diff -urpN net-snmp-5.8/snmplib/transports/snmpUnixDomain.c net-snmp-5.9.1/snmplib/transports/snmpUnixDomain.c
--- net-snmp-5.8/snmplib/transports/snmpUnixDomain.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/transports/snmpUnixDomain.c	2021-05-26 05:19:35.000000000 +0700
@@ -24,10 +24,6 @@
 #include <sys/socket.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <net-snmp/types.h>
 #include <net-snmp/output_api.h>
 #include <net-snmp/config_api.h>
@@ -41,8 +37,8 @@
 #include <net-snmp/library/sd-daemon.h>
 #endif
 
-netsnmp_feature_child_of(transport_unix_socket_all, transport_all)
-netsnmp_feature_child_of(unix_socket_paths, transport_unix_socket_all)
+netsnmp_feature_child_of(transport_unix_socket_all, transport_all);
+netsnmp_feature_child_of(unix_socket_paths, transport_unix_socket_all);
 
 #ifndef NETSNMP_STREAM_QUEUE_LEN
 #define NETSNMP_STREAM_QUEUE_LEN  5
@@ -524,7 +520,6 @@ netsnmp_unix_ctor(void)
     unixDomain.prefix = (const char**)calloc(2, sizeof(char *));
     unixDomain.prefix[0] = "unix";
 
-    unixDomain.f_create_from_tstring     = NULL;
     unixDomain.f_create_from_tstring_new = netsnmp_unix_create_tstring;
     unixDomain.f_create_from_ostring     = netsnmp_unix_create_ostring;
 
diff -urpN net-snmp-5.8/snmplib/ucd-snmp-includes.h net-snmp-5.9.1/snmplib/ucd-snmp-includes.h
--- net-snmp-5.8/snmplib/ucd-snmp-includes.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/ucd-snmp-includes.h	2021-05-26 05:19:35.000000000 +0700
@@ -4,13 +4,6 @@
 #include <netinet/in.h>
 #include <sys/time.h>
 
-/*
- * uncomment if you don't have in_addr_t in netinet/in.h 
- */
-/*
- * typedef u_int in_addr_t; 
- */
-
 #include <ucd-snmp/asn1.h>
 #include <ucd-snmp/snmp_api.h>
 #include <ucd-snmp/snmp_impl.h>
diff -urpN net-snmp-5.8/snmplib/ucd_compat.c net-snmp-5.9.1/snmplib/ucd_compat.c
--- net-snmp-5.8/snmplib/ucd_compat.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/ucd_compat.c	2021-05-26 05:19:35.000000000 +0700
@@ -16,7 +16,7 @@
 
 #include <ucd-snmp/default_store.h>
 
-netsnmp_feature_child_of(ucd_compatibility, libnetsnmp)
+netsnmp_feature_child_of(ucd_compatibility, libnetsnmp);
 
 #ifndef NETSNMP_FEATURE_REMOVE_UCD_COMPATIBILITY
 /*
diff -urpN net-snmp-5.8/snmplib/vacm.c net-snmp-5.9.1/snmplib/vacm.c
--- net-snmp-5.8/snmplib/vacm.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/vacm.c	2021-05-26 05:19:35.000000000 +0700
@@ -50,10 +50,6 @@
 #include <netinet/in.h>
 #endif
 
-#if HAVE_DMALLOC_H
-#include <dmalloc.h>
-#endif
-
 #include <ctype.h>
 
 #include <net-snmp/types.h>
diff -urpN net-snmp-5.8/snmplib/winpipe.c net-snmp-5.9.1/snmplib/winpipe.c
--- net-snmp-5.8/snmplib/winpipe.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/winpipe.c	2021-05-26 05:19:35.000000000 +0700
@@ -130,7 +130,7 @@ int create_winpipe_transport(int *pipefd
 	SOCKET socketpair[2];
 	struct sockaddr_in socketaddress[2];
 
-	struct timeval waittime = {0, 200000};
+	NETSNMP_SELECT_TIMEVAL waittime = {0, 200000};
 	fd_set readset;
 
 	if (InitUPDSocket(&socketpair[0], &socketaddress[0]))
diff -urpN net-snmp-5.8/snmplib/winservice.c net-snmp-5.9.1/snmplib/winservice.c
--- net-snmp-5.8/snmplib/winservice.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/snmplib/winservice.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,29 +1,25 @@
-/*
- * Windows Service related function definitions
- * By Raju Krishnappa(raju_krishnappa@yahoo.com)
- *
- */
+/* Windows Service related function definitions. */
 
 #ifdef WIN32
 
 #include <net-snmp/net-snmp-config.h>
+#include <net-snmp/library/system.h>
 
+#include <stdlib.h>             /* calloc() */
+#include <stdio.h>              /* sprintf() */
 #include <windows.h>
-#include <tchar.h>
-
-#include <stdio.h>		/* sprintf */
-#include <process.h>		/* beginthreadex  */
+#include <process.h>            /* _beginthreadex() */
 
 #include <net-snmp/library/winservice.h>
 
-#ifdef mingw32 /* MinGW doesn't fully support exception handling. */
+#ifdef mingw32                  /* MinGW doesn't fully support exception handling. */
 
 #define TRY if(1)
 #define LEAVE goto labelFIN
-#define FINALLY do { \
-labelFIN: \
-	; \
-} while(0); if(1)
+#define FINALLY do {                            \
+labelFIN:                                       \
+	;                                       \
+    } while(0); if(1)
 
 #else
 
@@ -31,10 +27,7 @@ labelFIN: \
 #define LEAVE __leave
 #define FINALLY __finally
 
-#endif /* mingw32 */
-
-
-#define CountOf(arr) ( sizeof(arr) / sizeof(arr[0]) )
+#endif                          /* mingw32 */
 
 
 #if defined(WIN32) && defined(HAVE_WIN32_PLATFORM_SDK) && !defined(mingw32)
@@ -47,1065 +40,1110 @@ labelFIN: \
 #endif
 #endif
 
- 
-    /*
-     * External global variables used here
-     */
-
-    /*
-     * Application Name 
-     * This should be declared by the application, which wants to register as
-     * windows service
-     */
-extern LPTSTR app_name_long;
+/*
+ * Error levels returned when registering or unregistering the service
+ */
+enum service_status {
+    SERVICE_ERROR_NONE = 0,
+    SERVICE_ERROR_SCM_OPEN = 1, /* Can not open SCM */
+    SERVICE_ERROR_CREATE_SERVICE = 2,   /* Can not create service */
+    SERVICE_ERROR_CREATE_REGISTRY_ENTRIES = 3,  /* Can not create registry entries */
+    SERVICE_ERROR_OPEN_SERVICE = 4,     /* Can not open service (service does not exist) */
+};
 
-    /*
-     * Declare global variable
-     */
+/*
+ * Define Message catalog ID
+ * MessageId: DISPLAY_MSG
+ * MessageText:  %1.
+ */
+enum { DISPLAY_MSG = 0x00000064L };
 
-    /*
-     * Flag to indicate whether process is running as Service 
-     */
-BOOL g_fRunningAsService = FALSE;
+/*
+ * Hint Value to SCM to wait before sending successive commands to service
+ */
+enum { SCM_WAIT_INTERVAL = 7000 };
 
-    /*
-     * Variable to maintain Current Service status 
-     */
-static SERVICE_STATUS ServiceStatus;
 
-    /*
-     * Service Handle 
-     */
-static SERVICE_STATUS_HANDLE hServiceStatus = 0L;
+static void WINAPI ServiceMain(DWORD argc, char *argv[]);
+static void WINAPI ControlHandler(DWORD dwControl);
+static void     ProcessServiceStop(void);
+static void     ProcessServicePause(void);
+static void     ProcessServiceContinue(void);
+static void     ProcessServiceInterrogate(void);
+static BOOL     SetSimpleSecurityAttributes(SECURITY_ATTRIBUTES
+                                            *pSecurityAttr);
+static void     FreeSecurityAttributes(SECURITY_ATTRIBUTES *pSecurityAttr);
+static unsigned WINAPI ThreadFunction(void *lpParam);
 
-    /*
-     * Service Table Entry 
-     */
-SERVICE_TABLE_ENTRY ServiceTableEntry[] = {
-  {NULL, ServiceMain},		/* Service Main function */
-  {NULL, NULL}
-};
 
-    /*
-     * Handle to Thread, to implement Pause, Resume and Stop functions
-     */
-static HANDLE hServiceThread = NULL;	/* Thread Handle */
+/*
+ * External global variables used here
+ */
 
-    /*
-     * Holds calling partys Function Entry point, that should start
-     * when entering service mode
-     */
-static INT (*ServiceEntryPoint) (INT Argc, LPTSTR Argv[]) = 0L;
+/*
+ * Application Name
+ * This should be declared by the application, which wants to register as
+ * windows service
+ */
+extern char    *app_name_long;
 
-    /*
-     * To hold Stop Function address, to be called when STOP request
-     * received from the SCM
-     */
-static VOID (*StopFunction) (VOID) = 0L;
+/*
+ * Declare global variable
+ */
 
+/*
+ * Flag to indicate whether process is running as Service
+ */
+static BOOL     g_fRunningAsService;
 
-    /*
-     * To update windows service status to SCM 
-     */
-static BOOL UpdateServiceStatus (DWORD dwStatus, DWORD dwErrorCode,
-				 DWORD dwWaitHint);
+/*
+ * Variable to maintain Current Service status
+ */
+static SERVICE_STATUS ServiceStatus;
 
-    /*
-     * To Report current service status to SCM 
-     */
-static BOOL ReportCurrentServiceStatus (VOID);
+/*
+ * Service Handle
+ */
+static SERVICE_STATUS_HANDLE hServiceStatus;
 
-VOID
-ProcessError (WORD eventLogType, LPCTSTR pszMessage, int useGetLastError, int quiet);
+/*
+ * Service Table Entry
+ */
+SERVICE_TABLE_ENTRY ServiceTableEntry[] = {
+    {NULL, ServiceMain},        /* Service Main function */
+    {NULL, NULL}
+};
 
-    /*
-     * To register as Windows Service with SCM(Service Control Manager)
-     * Input - Service Name, Service Display Name,Service Description and
-     * Service startup arguments
-     */
-int
-RegisterService (LPCTSTR lpszServiceName, LPCTSTR lpszServiceDisplayName,
-		 LPCTSTR lpszServiceDescription,
-		 InputParams * StartUpArg, int quiet) /* Startup argument to the service */
-{
-  TCHAR szServicePath[MAX_PATH];	/* To hold module File name */
-  TCHAR MsgErrorString[MAX_STR_SIZE];	/* Message or Error string */
-  TCHAR szServiceCommand[MAX_PATH + 9];	/* Command to execute */
-  SC_HANDLE hSCManager = NULL;
-  SC_HANDLE hService = NULL;
-  TCHAR szRegAppLogKey[] =
-    _T("SYSTEM\\CurrentControlSet\\Services\\EventLog\\Application\\");
-  TCHAR szRegKey[512];
-  HKEY hKey = NULL;		/* Key to registry entry */
-  HKEY hParamKey = NULL;	/* To store startup parameters */
-  DWORD dwData;			/* Type of logging supported */
-  DWORD i, j;			/* Loop variables */
-  int exitStatus = 0;
-  GetModuleFileName (NULL, szServicePath, MAX_PATH);
-  TRY
-  {
+/*
+ * Handle to Thread, to implement Pause, Resume and Stop functions
+ */
+static HANDLE   hServiceThread = NULL;  /* Thread Handle */
 
-    /*
-     * Open Service Control Manager handle 
-     */
-    hSCManager = OpenSCManager (NULL, NULL, SC_MANAGER_CREATE_SERVICE);
-    if (hSCManager == NULL)
-      {
-        ProcessError (EVENTLOG_ERROR_TYPE, _T ("Can't open SCM (Service Control Manager)"), 1, quiet);
-        exitStatus = SERVICE_ERROR_SCM_OPEN;
-	LEAVE;
-      }
+/*
+ * Holds calling partys Function Entry point, that should start
+ * when entering service mode
+ */
+static int      (*ServiceEntryPoint)(int Argc, char *Argv[]);
 
-    /*
-     * Generate the command to be executed by the SCM 
-     */
-    _sntprintf(szServiceCommand, CountOf(szServiceCommand), _T("\"%s\" %s"),
-               szServicePath, _T("-service"));
+/*
+ * To hold Stop Function address, to be called when STOP request
+ * received from the SCM
+ */
+static void     (*StopFunction)(void);
 
-    /*
-     * Create the desired service 
-     */
-    hService = CreateService (hSCManager, lpszServiceName, lpszServiceDisplayName,
-			SERVICE_ALL_ACCESS, SERVICE_WIN32_OWN_PROCESS,
-			SERVICE_AUTO_START, SERVICE_ERROR_NORMAL, szServiceCommand,
-			      NULL,	/* load-order group */
-			      NULL,	/* group member tag */
-			      NULL,	/* dependencies */
-			      NULL,	/* account */
-			      NULL);	/* password */
-    if (hService == NULL)
-      {
-	_sntprintf (MsgErrorString, CountOf(MsgErrorString), _T("%s %s"),
-		   _T ("Can't create service"), lpszServiceDisplayName);
-        ProcessError (EVENTLOG_ERROR_TYPE, MsgErrorString, 1, quiet);
-
-        exitStatus = SERVICE_ERROR_CREATE_SERVICE;
-	LEAVE;
-      }
 
-    /*
-     * Create registry entries for the event log 
-     */
-    /*
-     * Create registry Application event log key 
-     */
-    _tcscpy (szRegKey, szRegAppLogKey);
-    _tcscat (szRegKey, lpszServiceName);
+/*
+ * To update windows service status to SCM
+ */
+static BOOL     UpdateServiceStatus(DWORD dwStatus, DWORD dwErrorCode,
+                                    DWORD dwWaitHint);
 
-    /*
-     * Create registry key 
-     */
-    if (RegCreateKey (HKEY_LOCAL_MACHINE, szRegKey, &hKey) != ERROR_SUCCESS)
-      {
-	_sntprintf (MsgErrorString, CountOf(MsgErrorString), _T("%s %s"),
-		   _T ("is unable to create registry entries"), lpszServiceDisplayName);
-        ProcessError (EVENTLOG_ERROR_TYPE, MsgErrorString, 1, quiet);
-        exitStatus = SERVICE_ERROR_CREATE_REGISTRY_ENTRIES;
-	LEAVE;
-      }
+/*
+ * To Report current service status to SCM
+ */
+static BOOL     ReportCurrentServiceStatus(void);
 
-    /*
-     * Add Event ID message file name to the 'EventMessageFile' subkey 
-     */
-    RegSetValueEx (hKey, _T("EventMessageFile"), 0, REG_EXPAND_SZ,
-		   (CONST BYTE *) szServicePath,
-		   _tcslen (szServicePath) + sizeof (TCHAR));
+void            ProcessError(WORD eventLogType, const char *pszMessage,
+                             int useGetLastError, int quiet);
 
-    /*
-     * Set the supported types flags. 
-     */
-    dwData = EVENTLOG_ERROR_TYPE | EVENTLOG_WARNING_TYPE | EVENTLOG_INFORMATION_TYPE;
-    RegSetValueEx (hKey, _T("TypesSupported"), 0, REG_DWORD,
-		   (CONST BYTE *) & dwData, sizeof (DWORD));
+#ifndef HAVE__BEGINTHREADEX
+static uintptr_t
+_beginthreadex(void *security, unsigned stack_size,
+               unsigned (__stdcall *start_address) (void *), void *arglist,
+               unsigned initflag, unsigned *thrdaddr)
+{
+    return (uintptr_t) CreateThread(security, stack_size,
+                                    (LPTHREAD_START_ROUTINE)start_address,
+                                    arglist, initflag, (LPDWORD)thrdaddr);
+}
 
-    /*
-     * Close Registry key 
-     */
-    RegCloseKey (hKey);
+#if 0
+static void
+_endthreadex(unsigned retval)
+{
+    ExitThread(retval);
+}
+#endif
+#endif
 
-    /*
-     * Set Service Description String  and save startup parameters if present
-     */
-    if (lpszServiceDescription != NULL || StartUpArg->Argc > 2)
-      {
-	/*
-	 * Create Registry Key path 
-	 */
-	_tcscpy (szRegKey, _T ("SYSTEM\\CurrentControlSet\\Services\\"));
-	_tcscat (szRegKey, app_name_long);
-	hKey = NULL;
-
-	/*
-	 * Open Registry key using Create and Set access. 
-	 */
-	if (RegOpenKeyEx (HKEY_LOCAL_MACHINE, szRegKey, 0, KEY_WRITE,
-			  &hKey) != ERROR_SUCCESS)
-	  {
-	    _sntprintf (MsgErrorString, CountOf(MsgErrorString), _T("%s %s"),
-		       _T ("is unable to create registry entries"),
-		       lpszServiceDisplayName);
-            ProcessError (EVENTLOG_ERROR_TYPE, MsgErrorString, 1, quiet);
+/*
+ * To register as Windows Service with SCM(Service Control Manager)
+ * Input - Service Name, Service Display Name,Service Description and
+ * Service startup arguments
+ */
+int
+RegisterService(const char *lpszServiceName,
+                const char *lpszServiceDisplayName,
+                const char *lpszServiceDescription,
+                InputParams *StartUpArg, int quiet)
+{                               /* Startup argument to the service */
+    char            szServicePath[MAX_PATH];    /* To hold module File name */
+    char            MsgErrorString[1024];       /* Message or Error string */
+    char            szServiceCommand[MAX_PATH + 9];     /* Command to execute */
+    SC_HANDLE       hSCManager = NULL;
+    SC_HANDLE       hService = NULL;
+    static const char szRegAppLogKey[] =
+        "SYSTEM\\CurrentControlSet\\Services\\EventLog\\Application\\";
+    char            szRegKey[512];
+    HKEY            hKey = NULL;        /* Key to registry entry */
+    HKEY            hParamKey = NULL;   /* To store startup parameters */
+    DWORD           dwData;     /* Type of logging supported */
+    int             i, j;       /* Loop variables */
+    int             exitStatus = 0;
+    GetModuleFileName(NULL, szServicePath, MAX_PATH);
+    TRY {
+
+        /*
+         * Open Service Control Manager handle
+         */
+        hSCManager = OpenSCManager(NULL, NULL, SC_MANAGER_CREATE_SERVICE);
+        if (hSCManager == NULL) {
+            ProcessError(EVENTLOG_ERROR_TYPE,
+                         "Can't open SCM (Service Control Manager)", 1,
+                         quiet);
+            exitStatus = SERVICE_ERROR_SCM_OPEN;
+            LEAVE;
+        }
+
+        /*
+         * Generate the command to be executed by the SCM
+         */
+        snprintf(szServiceCommand, sizeof(szServiceCommand),
+                 "\"%s\" %s", szServicePath, "-service");
+
+        /*
+         * Create the desired service
+         */
+        hService = CreateService(hSCManager, lpszServiceName, lpszServiceDisplayName, SERVICE_ALL_ACCESS, SERVICE_WIN32_OWN_PROCESS, SERVICE_AUTO_START, SERVICE_ERROR_NORMAL, szServiceCommand, NULL,  /* load-order group */
+                                 NULL,  /* group member tag */
+                                 NULL,  /* dependencies */
+                                 NULL,  /* account */
+                                 NULL); /* password */
+        if (hService == NULL) {
+            snprintf(MsgErrorString, sizeof(MsgErrorString),
+                     "%s %s", "Can't create service",
+                     lpszServiceDisplayName);
+            ProcessError(EVENTLOG_ERROR_TYPE, MsgErrorString, 1, quiet);
+
+            exitStatus = SERVICE_ERROR_CREATE_SERVICE;
+            LEAVE;
+        }
+
+        /*
+         * Create registry entries for the event log
+         */
+        /*
+         * Create registry Application event log key
+         */
+        snprintf(szRegKey, sizeof(szRegKey), "%s%s", szRegAppLogKey,
+                 lpszServiceName);
+
+        /*
+         * Create registry key
+         */
+        if (RegCreateKey(HKEY_LOCAL_MACHINE, szRegKey, &hKey) !=
+            ERROR_SUCCESS) {
+            snprintf(MsgErrorString, sizeof(MsgErrorString),
+                     "%s %s",
+                     "is unable to create registry entries",
+                     lpszServiceDisplayName);
+            ProcessError(EVENTLOG_ERROR_TYPE, MsgErrorString, 1, quiet);
             exitStatus = SERVICE_ERROR_CREATE_REGISTRY_ENTRIES;
-	    LEAVE;
-	  }
+            LEAVE;
+        }
 
-	/*
-	 * Create description subkey and the set value 
-	 */
-	if (lpszServiceDescription != NULL)
-	  {
-	    if (RegSetValueEx (hKey, _T("Description"), 0, REG_SZ,
-			       (CONST BYTE *) lpszServiceDescription,
-			       _tcslen (lpszServiceDescription) +
-			       sizeof (TCHAR)) != ERROR_SUCCESS)
-	      {
-		_sntprintf (MsgErrorString, CountOf(MsgErrorString), _T("%s %s"),
-			   _T ("is unable to create registry entries"),
-			   lpszServiceDisplayName);
-                ProcessError (EVENTLOG_ERROR_TYPE, MsgErrorString, 1, quiet);
-                exitStatus = SERVICE_ERROR_CREATE_REGISTRY_ENTRIES;
-		LEAVE;
-	      };
-	  }
-
-	/*
-	 * Save startup arguments if they are present 
-	 */
-	if (StartUpArg->Argc > 2)
-	  {
-	    /*
-	     * Create Subkey parameters 
-	     */
-	    if (RegCreateKeyEx
-		(hKey, _T("Parameters"), 0, NULL,
-		 REG_OPTION_NON_VOLATILE, KEY_WRITE, NULL,
-		 &hParamKey, NULL) != ERROR_SUCCESS)
-	      {
-		_sntprintf (MsgErrorString, CountOf(MsgErrorString), _T("%s %s"),
-			   _T ("is unable to create registry entries"),
-			   lpszServiceDisplayName);
-                ProcessError (EVENTLOG_ERROR_TYPE, MsgErrorString, 1, quiet);
+        /*
+         * Add Event ID message file name to the 'EventMessageFile' subkey
+         */
+        RegSetValueEx(hKey, "EventMessageFile", 0, REG_EXPAND_SZ,
+                      (const void *) szServicePath,
+                      strlen(szServicePath) + sizeof(char));
+
+        /*
+         * Set the supported types flags.
+         */
+        dwData =
+            EVENTLOG_ERROR_TYPE | EVENTLOG_WARNING_TYPE |
+            EVENTLOG_INFORMATION_TYPE;
+        RegSetValueEx(hKey, "TypesSupported", 0, REG_DWORD,
+                      (const void *) &dwData, sizeof(dwData));
+
+        /*
+         * Close Registry key
+         */
+        RegCloseKey(hKey);
+
+        /*
+         * Set Service Description String  and save startup parameters if present
+         */
+        if (lpszServiceDescription != NULL || StartUpArg->Argc > 2) {
+            /*
+             * Create Registry Key path
+             */
+            snprintf(szRegKey, sizeof(szRegKey),
+                     "SYSTEM\\CurrentControlSet\\Services\\%s",
+                     app_name_long);
+            hKey = NULL;
+
+            /*
+             * Open Registry key using Create and Set access.
+             */
+            if (RegOpenKeyEx(HKEY_LOCAL_MACHINE, szRegKey, 0, KEY_WRITE,
+                             &hKey) != ERROR_SUCCESS) {
+                snprintf(MsgErrorString, sizeof(MsgErrorString),
+                         "%s %s",
+                         "is unable to create registry entries",
+                         lpszServiceDisplayName);
+                ProcessError(EVENTLOG_ERROR_TYPE, MsgErrorString, 1,
+                             quiet);
                 exitStatus = SERVICE_ERROR_CREATE_REGISTRY_ENTRIES;
                 LEAVE;
-	      }
+            }
 
-	    /*
-	     * Save parameters 
-	     */
-
-	    /*
-	     * Loop through arguments 
-	     */
-            if (quiet) /* Make sure we don't store -quiet arg */
-              i = 3;
-            else
-              i = 2;
-
-	    for (j = 1; i < StartUpArg->Argc; i++, j++)
-	      {
-		_sntprintf (szRegKey, CountOf(szRegKey), _T("%s%d"), _T ("Param"), j);
-
-		/*
-		 * Create registry key 
-		 */
-		if (RegSetValueEx
-		    (hParamKey, szRegKey, 0, REG_SZ,
-		     (CONST BYTE *) StartUpArg->Argv[i],
-		     _tcslen (StartUpArg->Argv[i]) +
-		     sizeof (TCHAR)) != ERROR_SUCCESS)
-		  {
-		    _sntprintf (MsgErrorString, CountOf(MsgErrorString), _T("%s %s"),
-			       _T ("is unable to create registry entries"),
-			       lpszServiceDisplayName);
-                    ProcessError (EVENTLOG_ERROR_TYPE, MsgErrorString, 1, quiet);
+            /*
+             * Create description subkey and the set value
+             */
+            if (lpszServiceDescription != NULL) {
+                if (RegSetValueEx(hKey, "Description", 0, REG_SZ,
+                                  (const void *) lpszServiceDescription,
+                                  strlen(lpszServiceDescription) +
+                                  sizeof(char)) != ERROR_SUCCESS) {
+                    snprintf(MsgErrorString, sizeof(MsgErrorString),
+                             "%s %s",
+                             "is unable to create registry entries",
+                             lpszServiceDisplayName);
+                    ProcessError(EVENTLOG_ERROR_TYPE, MsgErrorString, 1,
+                                 quiet);
+                    exitStatus = SERVICE_ERROR_CREATE_REGISTRY_ENTRIES;
+                    LEAVE;
+                };
+            }
+
+            /*
+             * Save startup arguments if they are present
+             */
+            if (StartUpArg->Argc > 2) {
+                /*
+                 * Create Subkey parameters
+                 */
+                if (RegCreateKeyEx
+                    (hKey, "Parameters", 0, NULL,
+                     REG_OPTION_NON_VOLATILE, KEY_WRITE, NULL,
+                     &hParamKey, NULL) != ERROR_SUCCESS) {
+                    snprintf(MsgErrorString, sizeof(MsgErrorString),
+                             "%s %s",
+                             "is unable to create registry entries",
+                             lpszServiceDisplayName);
+                    ProcessError(EVENTLOG_ERROR_TYPE, MsgErrorString, 1,
+                                 quiet);
                     exitStatus = SERVICE_ERROR_CREATE_REGISTRY_ENTRIES;
-		    LEAVE;
-		  };
-	      }
-	  }
-
-	/*
-	 * Everything is set, delete hKey 
-	 */
-	RegCloseKey (hParamKey);
-	RegCloseKey (hKey);
-      }
+                    LEAVE;
+                }
 
-    /*
-     * Ready to log messages 
-     */
+                /*
+                 * Save parameters
+                 */
+
+                /*
+                 * Loop through arguments
+                 */
+                if (quiet)      /* Make sure we don't store -quiet arg */
+                    i = 3;
+                else
+                    i = 2;
+
+                for (j = 1; i < StartUpArg->Argc; i++, j++) {
+                    snprintf(szRegKey, sizeof(szRegKey), "%s%d", "Param",
+                             j);
+
+                    /*
+                     * Create registry key
+                     */
+                    if (RegSetValueEx
+                        (hParamKey, szRegKey, 0, REG_SZ,
+                         (const void *) StartUpArg->Argv[i],
+                         strlen(StartUpArg->Argv[i]) +
+                         sizeof(char)) != ERROR_SUCCESS) {
+                        snprintf(MsgErrorString, sizeof(MsgErrorString),
+                                 "%s %s",
+                                 "is unable to create registry entries",
+                                 lpszServiceDisplayName);
+                        ProcessError(EVENTLOG_ERROR_TYPE, MsgErrorString,
+                                     1, quiet);
+                        exitStatus = SERVICE_ERROR_CREATE_REGISTRY_ENTRIES;
+                        LEAVE;
+                    };
+                }
+            }
 
-    /*
-     * Successfully registered as service 
-     */
-    _sntprintf (MsgErrorString, CountOf(MsgErrorString), _T("%s %s"), lpszServiceName,
-	       _T ("successfully registered as a service"));
+            /*
+             * Everything is set, delete hKey
+             */
+            RegCloseKey(hParamKey);
+            RegCloseKey(hKey);
+        }
+
+        /*
+         * Ready to log messages
+         */
+
+        /*
+         * Successfully registered as service
+         */
+        snprintf(MsgErrorString, sizeof(MsgErrorString), "%s %s",
+                 lpszServiceName, "successfully registered as a service");
+
+        /*
+         * Log message to eventlog
+         */
+        ProcessError(EVENTLOG_INFORMATION_TYPE, MsgErrorString, 0, quiet);
+    }
+
+    FINALLY {
+        if (hSCManager)
+            CloseServiceHandle(hSCManager);
+        if (hService)
+            CloseServiceHandle(hService);
+        if (hKey)
+            RegCloseKey(hKey);
+        if (hParamKey)
+            RegCloseKey(hParamKey);
+    }
+    return (exitStatus);
+}
 
-    /*
-     * Log message to eventlog 
-     */
-    ProcessError (EVENTLOG_INFORMATION_TYPE, MsgErrorString, 0, quiet);
-  }
+/*
+ * Unregister the service with the  Windows SCM
+ * Input - ServiceName
+ */
+int
+UnregisterService(const char *lpszServiceName, int quiet)
+{
+    char            MsgErrorString[1024];       /* Message or Error string */
+    SC_HANDLE       hSCManager = NULL;  /* SCM handle */
+    SC_HANDLE       hService = NULL;    /* Service Handle */
+    SERVICE_STATUS  sStatus;
+    static const char szRegAppLogKey[] =
+        "SYSTEM\\CurrentControlSet\\Services\\EventLog\\Application\\";
+    char            szRegKey[512];
+    int             exitStatus = 0;
+    /*
+     * HKEY hKey = NULL;            ?* Key to registry entry
+     */
+    TRY {
+        /*
+         * Open Service Control Manager
+         */
+        hSCManager = OpenSCManager(NULL, NULL, SC_MANAGER_CREATE_SERVICE);
+        if (hSCManager == NULL) {
+            ProcessError(EVENTLOG_ERROR_TYPE,
+                         "Can't open SCM (Service Control Manager)", 1,
+                         quiet);
+            exitStatus = SERVICE_ERROR_SCM_OPEN;
+            LEAVE;
+        }
+
+        /*
+         * Open registered service
+         */
+        hService =
+            OpenService(hSCManager, lpszServiceName, SERVICE_ALL_ACCESS);
+        if (hService == NULL) {
+            snprintf(MsgErrorString, sizeof(MsgErrorString),
+                     "%s %s", "Can't open service", lpszServiceName);
+            ProcessError(EVENTLOG_ERROR_TYPE, MsgErrorString, 1, quiet);
+            exitStatus = SERVICE_ERROR_OPEN_SERVICE;
+            LEAVE;
+        }
+
+        /*
+         * Query service status
+         * If running stop before deleting
+         */
+        if (QueryServiceStatus(hService, &sStatus)) {
+            if (sStatus.dwCurrentState == SERVICE_RUNNING
+                || sStatus.dwCurrentState == SERVICE_PAUSED) {
+                ControlService(hService, SERVICE_CONTROL_STOP, &sStatus);
+            }
+        };
+
+        /*
+         * Delete the service
+         */
+        if (DeleteService(hService) == FALSE) {
+            snprintf(MsgErrorString, sizeof(MsgErrorString),
+                     "%s %s", "Can't delete service", lpszServiceName);
+
+            /*
+             * Log message to eventlog
+             */
+            ProcessError(EVENTLOG_ERROR_TYPE, MsgErrorString, 0, quiet);
+            LEAVE;
+        }
+
+        /*
+         * Log "Service deleted successfully " message to eventlog
+         */
+        snprintf(MsgErrorString, sizeof(MsgErrorString), "%s %s",
+                 lpszServiceName, "service deleted");
+        ProcessError(EVENTLOG_INFORMATION_TYPE, MsgErrorString, 0, quiet);
+
+        /*
+         * Delete registry entries for EventLog
+         */
+        snprintf(szRegKey, sizeof(szRegKey), "%s%s", szRegAppLogKey,
+                 lpszServiceName);
+        RegDeleteKey(HKEY_LOCAL_MACHINE, szRegKey);
+    }
+
+    /*
+     * Delete the handles
+     */
+    FINALLY {
+        if (hService)
+            CloseServiceHandle(hService);
+        if (hSCManager)
+            CloseServiceHandle(hSCManager);
+    }
+    return (exitStatus);
+}
 
-  FINALLY
-  {
-    if (hSCManager)
-      CloseServiceHandle (hSCManager);
-    if (hService)
-      CloseServiceHandle (hService);
-    if (hKey)
-      RegCloseKey (hKey);
-    if (hParamKey)
-      RegCloseKey (hParamKey);
-  }
-  return (exitStatus);
+/*
+ * Write a message to the Windows event log.
+ */
+static void
+WriteToEventLog(WORD wType, const char *pszFormat, ...)
+{
+    char            szMessage[512];
+    const char     *LogStr[1];
+    va_list         ArgList;
+    HANDLE          hEventSource = NULL;
+
+    va_start(ArgList, pszFormat);
+    vsnprintf(szMessage, sizeof(szMessage), pszFormat, ArgList);
+    va_end(ArgList);
+    LogStr[0] = szMessage;
+    hEventSource = RegisterEventSource(NULL, app_name_long);
+    if (hEventSource == NULL)
+        return;
+    ReportEvent(hEventSource, wType, 0,
+                DISPLAY_MSG, NULL, 1, 0, LogStr, NULL);
+    DeregisterEventSource(hEventSource);
 }
 
-    /*
-     * Unregister the service with the  Windows SCM 
-     * Input - ServiceName
-     */
-int
-UnregisterService (LPCTSTR lpszServiceName, int quiet)
+/*
+ * Pre-process the second command-line argument from the user.
+ *     Service related options are:
+ *     -register       - registers the service
+ *     -unregister     - unregisters the service
+ *     -service        - run as service
+ *     other command-line arguments are ignored here.
+ *
+ * Return: Type indicating the option specified
+ */
+enum net_snmp_cmd_line_action
+ParseCmdLineForServiceOption(int argc, char *argv[], int *quiet)
 {
-  TCHAR MsgErrorString[MAX_STR_SIZE];	/* Message or Error string */
-  SC_HANDLE hSCManager = NULL;	/* SCM handle */
-  SC_HANDLE hService = NULL;	/* Service Handle */
-  SERVICE_STATUS sStatus;
-  TCHAR szRegAppLogKey[] =
-    _T("SYSTEM\\CurrentControlSet\\Services\\EventLog\\Application\\");
-  TCHAR szRegKey[512];
-  int exitStatus = 0;
-/*  HKEY hKey = NULL;		?* Key to registry entry */
-  TRY
-  {
-    /*
-     * Open Service Control Manager 
-     */
-    hSCManager = OpenSCManager (NULL, NULL, SC_MANAGER_CREATE_SERVICE);
-    if (hSCManager == NULL)
-      {
-        ProcessError (EVENTLOG_ERROR_TYPE, _T ("Can't open SCM (Service Control Manager)"), 1, quiet);
-        exitStatus = SERVICE_ERROR_SCM_OPEN;       
-	LEAVE;
-      }
+    enum net_snmp_cmd_line_action nReturn = RUN_AS_CONSOLE;     /* default is to run as a console application */
 
-    /*
-     * Open registered service 
-     */
-    hService = OpenService (hSCManager, lpszServiceName, SERVICE_ALL_ACCESS);
-    if (hService == NULL)
-      {
-	_sntprintf (MsgErrorString, CountOf(MsgErrorString), _T("%s %s"), _T ("Can't open service"),
-		   lpszServiceName);
-        ProcessError (EVENTLOG_ERROR_TYPE, MsgErrorString, 1, quiet);
-        exitStatus = SERVICE_ERROR_OPEN_SERVICE;       
-	LEAVE;
-      }
+    if (argc >= 2) {
 
-    /*
-     * Query service status 
-     * If running stop before deleting 
-     */
-    if (QueryServiceStatus (hService, &sStatus))
-      {
-	if (sStatus.dwCurrentState == SERVICE_RUNNING
-	    || sStatus.dwCurrentState == SERVICE_PAUSED)
-	  {
-	    ControlService (hService, SERVICE_CONTROL_STOP, &sStatus);
-	  }
-      };
+        /*
+         * second argument present
+         */
+        if (strcasecmp("-register", argv[1]) == 0) {
+            nReturn = REGISTER_SERVICE;
+        }
 
-    /*
-     * Delete the service  
-     */
-    if (DeleteService (hService) == FALSE)
-      {
-	_sntprintf (MsgErrorString, CountOf(MsgErrorString), _T("%s %s"), _T ("Can't delete service"),
-		   lpszServiceName);
-
-	/*
-	 * Log message to eventlog 
-	 */
-        ProcessError (EVENTLOG_ERROR_TYPE, MsgErrorString, 0, quiet);
-	LEAVE;
-      }
+        else if (strcasecmp("-unregister", argv[1]) == 0) {
+            nReturn = UN_REGISTER_SERVICE;
+        }
 
-    /*
-     * Log "Service deleted successfully " message to eventlog
-     */
-    _sntprintf (MsgErrorString, CountOf(MsgErrorString), _T("%s %s"), lpszServiceName, _T ("service deleted"));
-    ProcessError (EVENTLOG_INFORMATION_TYPE, MsgErrorString, 0, quiet);
+        else if (strcasecmp("-service", argv[1]) == 0) {
+            nReturn = RUN_AS_SERVICE;
+        }
+    }
 
-    /*
-     * Delete registry entries for EventLog 
-     */
-    _tcscpy (szRegKey, szRegAppLogKey);
-    _tcscat (szRegKey, lpszServiceName);
-    RegDeleteKey (HKEY_LOCAL_MACHINE, szRegKey);
-  }
-
-  /*
-   * Delete the handles 
-   */
-  FINALLY
-  {
-    if (hService)
-      CloseServiceHandle (hService);
-    if (hSCManager)
-      CloseServiceHandle (hSCManager);
-  }
-  return (exitStatus);
-}
+    if (argc >= 3) {
+        /*
+         * third argument present
+         */
+        if (strcasecmp("-quiet", argv[2]) == 0) {
+            *quiet = 1;
+        }
+    }
 
-    /*
-     * Write a message to the Windows event log.
-     */
-VOID
-WriteToEventLog (WORD wType, LPCTSTR pszFormat, ...)
-{
-  TCHAR szMessage[512];
-  LPCTSTR LogStr[1];
-  va_list ArgList;
-  HANDLE hEventSource = NULL;
-
-  va_start (ArgList, pszFormat);
-  _vsntprintf (szMessage, CountOf(szMessage), pszFormat, ArgList);
-  va_end (ArgList);
-  LogStr[0] = szMessage;
-  hEventSource = RegisterEventSource (NULL, app_name_long);
-  if (hEventSource == NULL)
-    return;
-  ReportEvent (hEventSource, wType, 0,
-	       DISPLAY_MSG,
-	       NULL, 1, 0, LogStr, NULL);
-  DeregisterEventSource (hEventSource);
+    return nReturn;
 }
 
-    /*
-     * Pre-process the second command-line argument from the user. 
-     *     Service related options are:
-     *     -register       - registers the service
-     *     -unregister     - unregisters the service
-     *     -service        - run as service
-     *     other command-line arguments are ignored here.
-     *
-     * Return: Type indicating the option specified
-     */
-INT
-ParseCmdLineForServiceOption (int argc, TCHAR * argv[], int *quiet)
+/*
+ * Write error message to event log, console or pop-up window.
+ *
+ * If useGetLastError is 1, the last error returned from GetLastError()
+ * is appended to pszMessage, separated by a ": ".
+ *
+ * eventLogType:                 MessageBox equivalent:
+ *
+ * EVENTLOG_INFORMATION_TYPE     MB_ICONASTERISK
+ * EVENTLOG_WARNING_TYPE         MB_ICONEXCLAMATION
+ * EVENTLOG_ERROR_TYPE           MB_ICONSTOP
+ *
+ */
+void
+ProcessError(WORD eventLogType, const char *pszMessage,
+             int useGetLastError, int quiet)
 {
-  int nReturn = RUN_AS_CONSOLE;	/* default is to run as a console application */
-
-  if (argc >= 2)
-    {
-
-      /*
-       * second argument present 
-       */
-      if (lstrcmpi (_T ("-register"), argv[1]) == 0)
-	{
-	  nReturn = REGISTER_SERVICE;
-	}
-
-      else if (lstrcmpi (_T ("-unregister"), argv[1]) == 0)
-	{
-	  nReturn = UN_REGISTER_SERVICE;
-	}
-
-      else if (lstrcmpi (_T ("-service"), argv[1]) == 0)
-	{
-	  nReturn = RUN_AS_SERVICE;
-	}
-    }
+    HANDLE          hEventSource = NULL;
+    char            pszMessageFull[1024];       /* Combined pszMessage and GetLastError */
 
-  if (argc >= 3)
-  {
     /*
-     * third argument present 
+     * If useGetLastError enabled, generate text from GetLastError() and append to
+     * pszMessageFull
      */
-    if (lstrcmpi (_T ("-quiet"), argv[2]) == 0)
-    {
-      *quiet = 1;	
-    }
-  }
-  
-  return nReturn;
+    if (useGetLastError) {
+        char           *pErrorMsgTemp = NULL;
+        FormatMessage(FORMAT_MESSAGE_ALLOCATE_BUFFER |
+                      FORMAT_MESSAGE_FROM_SYSTEM, NULL, GetLastError(),
+                      MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),
+                      (LPTSTR) &pErrorMsgTemp, 0, NULL);
+
+        snprintf(pszMessageFull, sizeof(pszMessageFull), "%s: %s",
+                 pszMessage, pErrorMsgTemp);
+        if (pErrorMsgTemp) {
+            LocalFree(pErrorMsgTemp);
+            pErrorMsgTemp = NULL;
+        }
+    } else {
+        snprintf(pszMessageFull, sizeof(pszMessageFull), "%s", pszMessage);
+    }
+
+    hEventSource = RegisterEventSource(NULL, app_name_long);
+    if (hEventSource != NULL) {
+        const char     *LogStr[1];
+        LogStr[0] = pszMessageFull;
+
+        if (ReportEvent(hEventSource, eventLogType, 0, DISPLAY_MSG,     /* just output the text to the event log */
+                        NULL, 1, 0, LogStr, NULL)) {
+        } else {
+            char           *pErrorMsgTemp = NULL;
+            FormatMessage(FORMAT_MESSAGE_ALLOCATE_BUFFER |
+                          FORMAT_MESSAGE_FROM_SYSTEM, NULL, GetLastError(),
+                          MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),
+                          (LPTSTR) &pErrorMsgTemp, 0, NULL);
+            fprintf(stderr,
+                    "Could NOT lot to Event Log.  Error returned from ReportEvent(): %s\n",
+                    pErrorMsgTemp);
+            if (pErrorMsgTemp) {
+                LocalFree(pErrorMsgTemp);
+                pErrorMsgTemp = NULL;
+            }
+        }
+        DeregisterEventSource(hEventSource);
+    }
+
+    if (quiet) {
+        fprintf(stderr, "%s\n", pszMessageFull);
+    } else {
+        switch (eventLogType) {
+        case EVENTLOG_INFORMATION_TYPE:
+            MessageBox(NULL, pszMessageFull, app_name_long,
+                       MB_ICONASTERISK);
+            break;
+        case EVENTLOG_WARNING_TYPE:
+            MessageBox(NULL, pszMessageFull, app_name_long,
+                       MB_ICONEXCLAMATION);
+            break;
+        case EVENTLOG_ERROR_TYPE:
+            MessageBox(NULL, pszMessageFull, app_name_long, MB_ICONSTOP);
+            break;
+        default:
+            MessageBox(NULL, pszMessageFull, app_name_long,
+                       EVENTLOG_WARNING_TYPE);
+            break;
+        }
+    }
 }
 
-    /*
-     * Write error message to event log, console or pop-up window.
-     *
-     * If useGetLastError is 1, the last error returned from GetLastError()
-     * is appended to pszMessage, separated by a ": ".
-     *
-     * eventLogType:                 MessageBox equivalent:
-     * 
-     * EVENTLOG_INFORMATION_TYPE     MB_ICONASTERISK
-     * EVENTLOG_WARNING_TYPE         MB_ICONEXCLAMATION
-     * EVENTLOG_ERROR_TYPE           MB_ICONSTOP
-     * 
-     */
-VOID
-ProcessError (WORD eventLogType, LPCTSTR pszMessage, int useGetLastError, int quiet)
+/*
+ * Update current service status.
+ * Sends the current service status to the SCM. Also updates
+ * the global service status structure.
+ */
+static BOOL
+UpdateServiceStatus(DWORD dwStatus, DWORD dwErrorCode, DWORD dwWaitHint)
 {
-  HANDLE hEventSource = NULL;
-  TCHAR pszMessageFull[MAX_STR_SIZE]; /* Combined pszMessage and GetLastError */
-
-  /*
-   * If useGetLastError enabled, generate text from GetLastError() and append to
-   * pszMessageFull
-   */
-  if (useGetLastError) {
-  LPTSTR pErrorMsgTemp = NULL;
-  FormatMessage (FORMAT_MESSAGE_ALLOCATE_BUFFER |
-		 FORMAT_MESSAGE_FROM_SYSTEM, NULL, GetLastError (),
-		 MAKELANGID (LANG_NEUTRAL, SUBLANG_DEFAULT),
-        (LPTSTR) & pErrorMsgTemp, 0, NULL);
-
-    _sntprintf (pszMessageFull, CountOf(pszMessageFull), _T("%s: %s"), pszMessage, pErrorMsgTemp);
-    if (pErrorMsgTemp) {
-      LocalFree (pErrorMsgTemp);
-      pErrorMsgTemp = NULL;
-    }
-  }
-  else {
-    _sntprintf (pszMessageFull, CountOf(pszMessageFull), _T("%s"), pszMessage);
-  }
-  
-  hEventSource = RegisterEventSource (NULL, app_name_long);
-  if (hEventSource != NULL) {
-    LPCTSTR LogStr[1];
-    LogStr[0] = pszMessageFull;
-    
-    if (ReportEvent (hEventSource, 
-          eventLogType, 
-          0,
-          DISPLAY_MSG,	/* just output the text to the event log */
-          NULL, 
-          1, 
-          0, 
-          LogStr, 
-          NULL)) {
+    static DWORD    dwCheckpoint = 1;
+    DWORD           dwControls =
+        SERVICE_ACCEPT_STOP | SERVICE_ACCEPT_PAUSE_CONTINUE;
+    if (g_fRunningAsService == FALSE)
+        return FALSE;
+    ZeroMemory(&ServiceStatus, sizeof(ServiceStatus));
+    ServiceStatus.dwServiceType = SERVICE_WIN32;
+    ServiceStatus.dwCurrentState = dwStatus;
+    ServiceStatus.dwWaitHint = dwWaitHint;
+    if (dwErrorCode) {
+        ServiceStatus.dwWin32ExitCode = ERROR_SERVICE_SPECIFIC_ERROR;
+        ServiceStatus.dwServiceSpecificExitCode = dwErrorCode;
     }
-    else {
-      LPTSTR pErrorMsgTemp = NULL;
-      FormatMessage (FORMAT_MESSAGE_ALLOCATE_BUFFER |
-          FORMAT_MESSAGE_FROM_SYSTEM, NULL, GetLastError (),
-          MAKELANGID (LANG_NEUTRAL, SUBLANG_DEFAULT),
-          (LPTSTR) & pErrorMsgTemp, 0, NULL);
-      _ftprintf(stderr,_T("Could NOT lot to Event Log.  Error returned from ReportEvent(): %s\n"),pErrorMsgTemp);
-      if (pErrorMsgTemp) {
-        LocalFree (pErrorMsgTemp);
-        pErrorMsgTemp = NULL;
-      }
-    }
-    DeregisterEventSource (hEventSource);
-    }
-
-      if (quiet) {
-    _ftprintf(stderr,_T("%s\n"),pszMessageFull);
-      }
-      else {
-    switch (eventLogType) {
-      case EVENTLOG_INFORMATION_TYPE:
-        MessageBox (NULL, pszMessageFull, app_name_long, MB_ICONASTERISK);
-        break;
-      case EVENTLOG_WARNING_TYPE:
-        MessageBox (NULL, pszMessageFull, app_name_long, MB_ICONEXCLAMATION);
-        break;
-      case EVENTLOG_ERROR_TYPE:
-        MessageBox (NULL, pszMessageFull, app_name_long, MB_ICONSTOP);
-        break;
-      default:
-        MessageBox (NULL, pszMessageFull, app_name_long, EVENTLOG_WARNING_TYPE);
-        break;
-      }
-    }
-}
 
     /*
-     * Update current service status.
-     * Sends the current service status to the SCM. Also updates
-     * the global service status structure.
+     * special cases that depend on the new state
      */
-static BOOL
-UpdateServiceStatus (DWORD dwStatus, DWORD dwErrorCode, DWORD dwWaitHint)
-{
-  static DWORD dwCheckpoint = 1;
-  DWORD dwControls = SERVICE_ACCEPT_STOP | SERVICE_ACCEPT_PAUSE_CONTINUE;
-  if (g_fRunningAsService == FALSE)
-    return FALSE;
-  ZeroMemory (&ServiceStatus, sizeof (ServiceStatus));
-  ServiceStatus.dwServiceType = SERVICE_WIN32;
-  ServiceStatus.dwCurrentState = dwStatus;
-  ServiceStatus.dwWaitHint = dwWaitHint;
-  if (dwErrorCode)
-    {
-      ServiceStatus.dwWin32ExitCode = ERROR_SERVICE_SPECIFIC_ERROR;
-      ServiceStatus.dwServiceSpecificExitCode = dwErrorCode;
-    }
-
-  /*
-   * special cases that depend on the new state 
-   */
-  switch (dwStatus)
-    {
+    switch (dwStatus) {
     case SERVICE_START_PENDING:
-      dwControls = 0;
-      break;
+        dwControls = 0;
+        break;
     case SERVICE_RUNNING:
     case SERVICE_STOPPED:
-      dwCheckpoint = 0;
-      break;
+        dwCheckpoint = 0;
+        break;
     }
-  ServiceStatus.dwCheckPoint = dwCheckpoint++;
-  ServiceStatus.dwControlsAccepted = dwControls;
-  return ReportCurrentServiceStatus ();
+    ServiceStatus.dwCheckPoint = dwCheckpoint++;
+    ServiceStatus.dwControlsAccepted = dwControls;
+    return ReportCurrentServiceStatus();
 }
 
-    /*
-     * Reports current service status to SCM
-     */
+/*
+ * Reports current service status to SCM
+ */
 static BOOL
-ReportCurrentServiceStatus ()
+ReportCurrentServiceStatus()
 {
-  return SetServiceStatus (hServiceStatus, &ServiceStatus);
+    return SetServiceStatus(hServiceStatus, &ServiceStatus);
 }
 
+/*
+ * ServiceMain function.
+ */
+static void WINAPI
+ServiceMain(DWORD argc, char *argv[])
+{
+    SECURITY_ATTRIBUTES SecurityAttributes;
+    unsigned        threadId;
+
     /*
-     * ServiceMain function.
+     * Input arguments
      */
-VOID WINAPI
-ServiceMain (DWORD argc, LPTSTR argv[])
-{
-  SECURITY_ATTRIBUTES SecurityAttributes;
-  unsigned threadId;
+    DWORD           ArgCount = 0;
+    char          **ArgArray = NULL;
+    char            szRegKey[512];
+    HKEY            hParamKey = NULL;
+    DWORD           TotalParams = 0;
+    int             i;
+    InputParams     ThreadInputParams;
+
+    /*
+     * Build the Input parameters to pass to worker thread
+     */
+
+    /*
+     * SCM sends Service Name as first arg, increment to point
+     * arguments user specified while starting control agent
+     */
+
+    /*
+     * Read registry parameter
+     */
+    ArgCount = 1;
+
+    /*
+     * Create registry key path
+     */
+    snprintf(szRegKey, sizeof(szRegKey), "%s%s\\%s",
+             "SYSTEM\\CurrentControlSet\\Services\\", app_name_long,
+             "Parameters");
+    if (RegOpenKeyEx
+        (HKEY_LOCAL_MACHINE, szRegKey, 0, KEY_ALL_ACCESS,
+         &hParamKey) == ERROR_SUCCESS) {
+
+        /*
+         * Read startup configuration information
+         */
+        /*
+         * Find number of subkeys inside parameters
+         */
+        if (RegQueryInfoKey(hParamKey, NULL, NULL, 0,
+                            NULL, NULL, NULL, &TotalParams,
+                            NULL, NULL, NULL, NULL) == ERROR_SUCCESS) {
+            if (TotalParams != 0) {
+                ArgCount += TotalParams;
 
-  /*
-   * Input arguments
-   */
-  DWORD ArgCount = 0;
-  LPTSTR *ArgArray = NULL;
-  TCHAR szRegKey[512];
-  HKEY hParamKey = NULL;
-  DWORD TotalParams = 0;
-  DWORD i;
-  InputParams ThreadInputParams;
-
-  /*
-   * Build the Input parameters to pass to worker thread 
-   */
-
-  /*
-   * SCM sends Service Name as first arg, increment to point
-   * arguments user specified while starting control agent
-   */
-
-  /*
-   * Read registry parameter 
-   */
-  ArgCount = 1;
-
-  /*
-   * Create registry key path 
-   */
-  _sntprintf (szRegKey, CountOf(szRegKey), _T("%s%s\\%s"),
-	     _T ("SYSTEM\\CurrentControlSet\\Services\\"), app_name_long,
-	     _T("Parameters"));
-  if (RegOpenKeyEx
-      (HKEY_LOCAL_MACHINE, szRegKey, 0, KEY_ALL_ACCESS, &hParamKey) == ERROR_SUCCESS)
-    {
-
-      /*
-       * Read startup configuration information 
-       */
-      /*
-       * Find number of subkeys inside parameters 
-       */
-      if (RegQueryInfoKey (hParamKey, NULL, NULL, 0,
-	   NULL, NULL, NULL, &TotalParams,
-	   NULL, NULL, NULL, NULL) == ERROR_SUCCESS)
-	{
-	  if (TotalParams != 0)
-	    {
-	      ArgCount += TotalParams;
-
-	      /*
-	       * Allocate memory to hold strings 
-	       */
-	      ArgArray = calloc(ArgCount, sizeof(ArgArray[0]));
-              if (ArgArray == 0)
-                {
-                  WriteToEventLog (EVENTLOG_ERROR_TYPE,
-		       _T ("Resource failure"));
-                  return;
+                /*
+                 * Allocate memory to hold strings
+                 */
+                ArgArray = calloc(ArgCount, sizeof(ArgArray[0]));
+                if (ArgArray == 0) {
+                    WriteToEventLog(EVENTLOG_ERROR_TYPE,
+                                    "Resource failure");
+                    return;
                 }
 
-	      /*
-	       * Copy first argument 
-	       */
-	      ArgArray[0] = _tcsdup (argv[0]);
-	      for (i = 1; i <= TotalParams; i++)
-		{
-                  DWORD dwErrorcode;
-                  DWORD nSize;
-                  DWORD nRegkeyType;
-                  TCHAR *szValue;
-
-		  /*
-		   * Create Subkey value name 
-		   */
-		  _sntprintf (szRegKey, CountOf(szRegKey), _T("%s%d"), _T("Param"), i);
-
-		  /*
-		   * Query subkey.
-		   */
-		  nSize = 0;
-		  dwErrorcode = RegQueryValueEx(hParamKey, szRegKey, NULL,
-                                                &nRegkeyType, NULL, &nSize);
-                  if (dwErrorcode == ERROR_SUCCESS) {
-                    if (nRegkeyType == REG_SZ || nRegkeyType == REG_EXPAND_SZ) {
-                      szValue = malloc(nSize + sizeof(szValue[0]));
-                      if (szValue) {
-		        dwErrorcode = RegQueryValueEx(hParamKey, szRegKey, NULL,
-                                                      &nRegkeyType, (LPBYTE)szValue, &nSize);
-                        if (dwErrorcode == ERROR_SUCCESS) {
-                          szValue[nSize] = 0;
-                          ArgArray[i] = szValue;
-                        } else {
-                          free(szValue);
-                          WriteToEventLog(EVENTLOG_ERROR_TYPE, _T("Querying registry key %s failed: error code %ld"), szRegKey, dwErrorcode);
-                        }
-                      } else
-                        WriteToEventLog(EVENTLOG_ERROR_TYPE, _T("Querying registry key %s failed: out of memory"), szRegKey);
+                /*
+                 * Copy first argument
+                 */
+                ArgArray[0] = strdup(argv[0]);
+                for (i = 1; i <= TotalParams; i++) {
+                    DWORD           dwErrorcode;
+                    DWORD           nSize;
+                    DWORD           nRegkeyType;
+                    char           *szValue;
+
+                    /*
+                     * Create Subkey value name
+                     */
+                    snprintf(szRegKey, sizeof(szRegKey), "%s%d", "Param",
+                             i);
+
+                    /*
+                     * Query subkey.
+                     */
+                    nSize = 0;
+                    dwErrorcode =
+                        RegQueryValueEx(hParamKey, szRegKey, NULL,
+                                        &nRegkeyType, NULL, &nSize);
+                    if (dwErrorcode == ERROR_SUCCESS) {
+                        if (nRegkeyType == REG_SZ
+                            || nRegkeyType == REG_EXPAND_SZ) {
+                            szValue = malloc(nSize + sizeof(szValue[0]));
+                            if (szValue) {
+                                dwErrorcode =
+                                    RegQueryValueEx(hParamKey, szRegKey,
+                                                    NULL, &nRegkeyType,
+                                                    (void *) szValue,
+                                                    &nSize);
+                                if (dwErrorcode == ERROR_SUCCESS) {
+                                    szValue[nSize] = 0;
+                                    ArgArray[i] = szValue;
+                                } else {
+                                    free(szValue);
+                                    WriteToEventLog(EVENTLOG_ERROR_TYPE,
+                                                    "Querying registry key %s failed: error code %ld",
+                                                    szRegKey, dwErrorcode);
+                                }
+                            } else
+                                WriteToEventLog(EVENTLOG_ERROR_TYPE,
+                                                "Querying registry key %s failed: out of memory",
+                                                szRegKey);
+                        } else
+                            WriteToEventLog(EVENTLOG_ERROR_TYPE,
+                                            "Type %ld of registry key %s is incorrect",
+                                            nRegkeyType, szRegKey);
                     } else
-                      WriteToEventLog(EVENTLOG_ERROR_TYPE, _T("Type %ld of registry key %s is incorrect"), nRegkeyType, szRegKey);
-                  } else
-                    WriteToEventLog(EVENTLOG_ERROR_TYPE, _T("Querying registry key %s failed: error code %ld"), szRegKey, dwErrorcode);
-
-                  if (!ArgArray[i]) {
-                    TotalParams = ArgCount = i;
-                    break;
-                  }
-		}
-	    }
-	}
-      RegCloseKey (hParamKey);
-    }
-  if (ArgCount == 1)
-    {
-
-      /*
-       * No startup args are given 
-       */
-      ThreadInputParams.Argc = argc;
-      ThreadInputParams.Argv = argv;
-    }
-
-  else
-    {
-      ThreadInputParams.Argc = ArgCount;
-      ThreadInputParams.Argv = ArgArray;
-    }
-
-  /*
-   * Register Service Control Handler 
-   */
-  hServiceStatus = RegisterServiceCtrlHandler (app_name_long, ControlHandler);
-  if (hServiceStatus == 0)
-    {
-      WriteToEventLog (EVENTLOG_ERROR_TYPE,
-		       _T ("RegisterServiceCtrlHandler failed"));
-      return;
-    }
-
-  /*
-   * Update the service status to START_PENDING.
-   */
-  UpdateServiceStatus (SERVICE_START_PENDING, NO_ERROR, SCM_WAIT_INTERVAL);
-
-  /*
-   * Start the worker thread, which does the majority of the work .
-   */
-  TRY
-  {
-    if (SetSimpleSecurityAttributes (&SecurityAttributes) == FALSE)
-      {
-	WriteToEventLog (EVENTLOG_ERROR_TYPE,
-			 _T ("Couldn't init security attributes"));
-	LEAVE;
-      }
-    hServiceThread =
-      (void *) _beginthreadex (&SecurityAttributes, 0,
-			       ThreadFunction,
-			       (void *) &ThreadInputParams, 0, &threadId);
-    if (hServiceThread == NULL)
-      {
-	WriteToEventLog (EVENTLOG_ERROR_TYPE, _T ("Couldn't start worker thread"));
-	LEAVE;
-      }
+                        WriteToEventLog(EVENTLOG_ERROR_TYPE,
+                                        "Querying registry key %s failed: error code %ld",
+                                        szRegKey, dwErrorcode);
+
+                    if (!ArgArray[i]) {
+                        TotalParams = ArgCount = i;
+                        break;
+                    }
+                }
+            }
+        }
+        RegCloseKey(hParamKey);
+    }
+    if (ArgCount == 1) {
+
+        /*
+         * No startup args are given
+         */
+        ThreadInputParams.Argc = argc;
+        ThreadInputParams.Argv = argv;
+    }
+
+    else {
+        ThreadInputParams.Argc = ArgCount;
+        ThreadInputParams.Argv = ArgArray;
+    }
 
     /*
-     * Set service status to SERVICE_RUNNING.
+     * Register Service Control Handler
      */
-    UpdateServiceStatus (SERVICE_RUNNING, NO_ERROR, SCM_WAIT_INTERVAL);
+    hServiceStatus =
+        RegisterServiceCtrlHandler(app_name_long, ControlHandler);
+    if (hServiceStatus == 0) {
+        WriteToEventLog(EVENTLOG_ERROR_TYPE,
+                        "RegisterServiceCtrlHandler failed");
+        return;
+    }
+
+    /*
+     * Update the service status to START_PENDING.
+     */
+    UpdateServiceStatus(SERVICE_START_PENDING, NO_ERROR,
+                        SCM_WAIT_INTERVAL);
+
+    /*
+     * Start the worker thread, which does the majority of the work .
+     */
+    TRY {
+        if (SetSimpleSecurityAttributes(&SecurityAttributes) == FALSE) {
+            WriteToEventLog(EVENTLOG_ERROR_TYPE,
+                            "Couldn't init security attributes");
+            LEAVE;
+        }
+        hServiceThread =
+            (void *) _beginthreadex(&SecurityAttributes, 0,
+                                    ThreadFunction,
+                                    (void *) &ThreadInputParams, 0,
+                                    &threadId);
+        if (hServiceThread == NULL) {
+            WriteToEventLog(EVENTLOG_ERROR_TYPE,
+                            "Couldn't start worker thread");
+            LEAVE;
+        }
+
+        /*
+         * Set service status to SERVICE_RUNNING.
+         */
+        UpdateServiceStatus(SERVICE_RUNNING, NO_ERROR, SCM_WAIT_INTERVAL);
+
+        /*
+         * Wait until the worker thread finishes.
+         */
+        WaitForSingleObject(hServiceThread, INFINITE);
+    }
+    FINALLY {
+        /*
+         * Release resources
+         */
+        UpdateServiceStatus(SERVICE_STOPPED, NO_ERROR, SCM_WAIT_INTERVAL);
+        if (hServiceThread)
+            CloseHandle(hServiceThread);
+        FreeSecurityAttributes(&SecurityAttributes);
+
+        /*
+         * Free allocated argument list
+         */
+        if (ArgCount > 1 && ArgArray != NULL) {
+            /*
+             * Free all strings
+             */
+            for (i = 0; i < ArgCount; i++) {
+                free(ArgArray[i]);
+            }
+            free(ArgArray);
+        }
+    }
+}
+
+/*
+ * Function to start as Windows service
+ * The calling party should specify their entry point as input parameter
+ * Returns TRUE if the Service is started successfully
+ */
+BOOL
+RunAsService(int (*ServiceFunction)(int, char **))
+{
 
     /*
-     * Wait until the worker thread finishes.
+     * Set the ServiceEntryPoint
      */
-    WaitForSingleObject (hServiceThread, INFINITE);
-  }
-  FINALLY
-  {
+    ServiceEntryPoint = ServiceFunction;
+
     /*
-     * Release resources 
+     * By default, mark as Running as a service
      */
-    UpdateServiceStatus (SERVICE_STOPPED, NO_ERROR, SCM_WAIT_INTERVAL);
-    if (hServiceThread)
-      CloseHandle (hServiceThread);
-    FreeSecurityAttributes (&SecurityAttributes);
+    g_fRunningAsService = TRUE;
 
     /*
-     * Free allocated argument list 
+     * Initialize ServiceTableEntry table
      */
-    if (ArgCount > 1 && ArgArray != NULL)
-      {
-	/*
-	 * Free all strings 
-	 */
-	for (i = 0; i < ArgCount; i++)
-	  {
-	    free (ArgArray[i]);
-	  }
-	free (ArgArray);
-      }
-  }
-}
+    ServiceTableEntry[0].lpServiceName = app_name_long; /* Application Name */
 
     /*
-     * Function to start as Windows service
-     * The calling party should specify their entry point as input parameter
-     * Returns TRUE if the Service is started successfully
+     * Call SCM via StartServiceCtrlDispatcher to run as Service
+     * * If the function returns TRUE we are running as Service,
      */
-BOOL
-RunAsService (INT (*ServiceFunction) (INT, LPTSTR *))
-{
+    if (StartServiceCtrlDispatcher(ServiceTableEntry) == FALSE) {
+        g_fRunningAsService = FALSE;
 
-  /*
-   * Set the ServiceEntryPoint 
-   */
-  ServiceEntryPoint = ServiceFunction;
-
-  /*
-   * By default, mark as Running as a service 
-   */
-  g_fRunningAsService = TRUE;
-
-  /*
-   * Initialize ServiceTableEntry table 
-   */
-  ServiceTableEntry[0].lpServiceName = app_name_long;	/* Application Name */
-
-  /*
-   * Call SCM via StartServiceCtrlDispatcher to run as Service 
-   * * If the function returns TRUE we are running as Service, 
-   */
-  if (StartServiceCtrlDispatcher (ServiceTableEntry) == FALSE)
-    {
-      g_fRunningAsService = FALSE;
-
-      /*
-       * Some other error has occurred. 
-       */
-      WriteToEventLog (EVENTLOG_ERROR_TYPE,
-		       _T ("Couldn't start service - %s"), app_name_long);
+        /*
+         * Some other error has occurred.
+         */
+        WriteToEventLog(EVENTLOG_ERROR_TYPE,
+                        "Couldn't start service - %s", app_name_long);
     }
-  return g_fRunningAsService;
+    return g_fRunningAsService;
 }
 
-    /*
-     * Service control handler function
-     * Responds to SCM commands/requests
-     * This service handles 4 commands
-     * - interrogate, pause, continue and stop.
-     */
-VOID WINAPI
-ControlHandler (DWORD dwControl)
+/*
+ * Service control handler function
+ * Responds to SCM commands/requests
+ * This service handles 4 commands
+ * - interrogate, pause, continue and stop.
+ */
+void WINAPI
+ControlHandler(DWORD dwControl)
 {
-  switch (dwControl)
-    {
+    switch (dwControl) {
     case SERVICE_CONTROL_INTERROGATE:
-      ProcessServiceInterrogate ();
-      break;
+        ProcessServiceInterrogate();
+        break;
 
     case SERVICE_CONTROL_PAUSE:
-      ProcessServicePause ();
-      break;
+        ProcessServicePause();
+        break;
 
     case SERVICE_CONTROL_CONTINUE:
-      ProcessServiceContinue ();
-      break;
+        ProcessServiceContinue();
+        break;
 
     case SERVICE_CONTROL_STOP:
-      ProcessServiceStop ();
-      break;
+        ProcessServiceStop();
+        break;
     }
 }
 
-    /*
-     * To stop the service.
-     * If a stop function was registered, invoke it,
-     * otherwise terminate the worker thread.
-     * After stopping, Service status is set to STOP in 
-     * main loop
-     */
-VOID
-ProcessServiceStop (VOID)
+/*
+ * To stop the service.
+ * If a stop function was registered, invoke it,
+ * otherwise terminate the worker thread.
+ * After stopping, Service status is set to STOP in
+ * main loop
+ */
+void
+ProcessServiceStop(void)
 {
-  UpdateServiceStatus (SERVICE_STOP_PENDING, NO_ERROR, SCM_WAIT_INTERVAL);
+    UpdateServiceStatus(SERVICE_STOP_PENDING, NO_ERROR, SCM_WAIT_INTERVAL);
 
-  if (StopFunction != NULL)
-    {
-      (*StopFunction) ();
+    if (StopFunction != NULL) {
+        (*StopFunction) ();
     }
 
-  else
-    {
-      TerminateThread (hServiceThread, 0);
+    else {
+        TerminateThread(hServiceThread, 0);
     }
 }
 
-    /*
-     * Returns the current state of the service to the SCM.
-     */
-VOID
-ProcessServiceInterrogate (VOID)
+/*
+ * Returns the current state of the service to the SCM.
+ */
+void
+ProcessServiceInterrogate(void)
 {
-  ReportCurrentServiceStatus ();
+    ReportCurrentServiceStatus();
 }
 
-    /*
-     * To Create a security descriptor with a NULL ACL, which
-     * allows unlimited access. Returns a SECURITY_ATTRIBUTES
-     * structure that contains the security descriptor.
-     * The structure contains a dynamically allocated security
-     * descriptor that must be freed either manually, or by
-     * calling FreeSecurityAttributes 
-     */
+/*
+ * To Create a security descriptor with a NULL ACL, which
+ * allows unlimited access. Returns a SECURITY_ATTRIBUTES
+ * structure that contains the security descriptor.
+ * The structure contains a dynamically allocated security
+ * descriptor that must be freed either manually, or by
+ * calling FreeSecurityAttributes
+ */
 BOOL
-SetSimpleSecurityAttributes (SECURITY_ATTRIBUTES * pSecurityAttr)
+SetSimpleSecurityAttributes(SECURITY_ATTRIBUTES *pSecurityAttr)
 {
-  BOOL fReturn = FALSE;
-  SECURITY_DESCRIPTOR *pSecurityDesc = NULL;
+    BOOL            fReturn = FALSE;
+    SECURITY_DESCRIPTOR *pSecurityDesc = NULL;
+
+    /*
+     * If an invalid address is passed as a parameter, return
+     * FALSE right away.
+     */
+    if (!pSecurityAttr)
+        return FALSE;
+    pSecurityDesc =
+        (SECURITY_DESCRIPTOR *) LocalAlloc(LPTR,
+                                           SECURITY_DESCRIPTOR_MIN_LENGTH);
+    if (!pSecurityDesc)
+        return FALSE;
+    fReturn =
+        InitializeSecurityDescriptor(pSecurityDesc,
+                                     SECURITY_DESCRIPTOR_REVISION);
+    if (fReturn != FALSE) {
+        fReturn =
+            SetSecurityDescriptorDacl(pSecurityDesc, TRUE, NULL, FALSE);
+    }
+    if (fReturn != FALSE) {
+        pSecurityAttr->nLength = sizeof(SECURITY_ATTRIBUTES);
+        pSecurityAttr->lpSecurityDescriptor = pSecurityDesc;
+        pSecurityAttr->bInheritHandle = TRUE;
+    }
 
-  /*
-   * If an invalid address is passed as a parameter, return
-   * FALSE right away. 
-   */
-  if (!pSecurityAttr)
-    return FALSE;
-  pSecurityDesc =
-    (SECURITY_DESCRIPTOR *) LocalAlloc (LPTR, SECURITY_DESCRIPTOR_MIN_LENGTH);
-  if (!pSecurityDesc)
-    return FALSE;
-  fReturn =
-    InitializeSecurityDescriptor (pSecurityDesc, SECURITY_DESCRIPTOR_REVISION);
-  if (fReturn != FALSE)
-    {
-      fReturn = SetSecurityDescriptorDacl (pSecurityDesc, TRUE, NULL, FALSE);
-    }
-  if (fReturn != FALSE)
-    {
-      pSecurityAttr->nLength = sizeof (SECURITY_ATTRIBUTES);
-      pSecurityAttr->lpSecurityDescriptor = pSecurityDesc;
-      pSecurityAttr->bInheritHandle = TRUE;
-    }
-
-  else
-    {
-      /*
-       * Couldn't initialize or set security descriptor. 
-       */
-      LocalFree (pSecurityDesc);
+    else {
+        /*
+         * Couldn't initialize or set security descriptor.
+         */
+        LocalFree(pSecurityDesc);
     }
-  return fReturn;
+    return fReturn;
 }
 
-    /*
-     * This function Frees the security descriptor, if any was created.
-     */
-VOID
-FreeSecurityAttributes (SECURITY_ATTRIBUTES * pSecurityAttr)
+/*
+ * This function Frees the security descriptor, if any was created.
+ */
+void
+FreeSecurityAttributes(SECURITY_ATTRIBUTES *pSecurityAttr)
 {
-  if (pSecurityAttr && pSecurityAttr->lpSecurityDescriptor)
-    LocalFree (pSecurityAttr->lpSecurityDescriptor);
+    if (pSecurityAttr && pSecurityAttr->lpSecurityDescriptor)
+        LocalFree(pSecurityAttr->lpSecurityDescriptor);
 }
 
-    /*
-     * This function runs in the worker thread
-     * until an exit is forced, or until the SCM issues the STOP command.
-     * Invokes registered service function
-     * Returns when called registered function returns
-     *
-     * Input:
-     *   lpParam contains argc and argv, pass to service main function 
-     */
+/*
+ * This function runs in the worker thread
+ * until an exit is forced, or until the SCM issues the STOP command.
+ * Invokes registered service function
+ * Returns when called registered function returns
+ *
+ * Input:
+ *   lpParam contains argc and argv, pass to service main function
+ */
 unsigned WINAPI
-ThreadFunction (LPVOID lpParam)
+ThreadFunction(void *lpParam)
 {
-  InputParams * pInputArg = (InputParams *) lpParam;
-  return (*ServiceEntryPoint) (pInputArg->Argc, pInputArg->Argv);
+    InputParams    *pInputArg = (InputParams *) lpParam;
+    return (*ServiceEntryPoint) (pInputArg->Argc, pInputArg->Argv);
 }
 
-    /*
-     * This function is called to register an application-specific function
-     *   which is invoked when the SCM stops the worker thread.
-     */
-VOID
-RegisterStopFunction (VOID (*StopFunc) (VOID))
+/*
+ * This function is called to register an application-specific function
+ *   which is invoked when the SCM stops the worker thread.
+ */
+void
+RegisterStopFunction(void (*StopFunc)(void))
 {
-  StopFunction = StopFunc;
+    StopFunction = StopFunc;
 }
 
-    /*
-     * SCM pause command invokes this function
-     * If the service is not running, this function does nothing.
-     * Otherwise, suspend the worker thread and update the status.
-     */
-VOID
-ProcessServicePause (VOID)
+/*
+ * SCM pause command invokes this function
+ * If the service is not running, this function does nothing.
+ * Otherwise, suspend the worker thread and update the status.
+ */
+void
+ProcessServicePause(void)
 {
-  if (ServiceStatus.dwCurrentState == SERVICE_RUNNING)
-    {
-      UpdateServiceStatus (SERVICE_PAUSE_PENDING, NO_ERROR, SCM_WAIT_INTERVAL);
-
-      if (SuspendThread (hServiceThread) != -1)
-	{
-	  UpdateServiceStatus (SERVICE_PAUSED, NO_ERROR, SCM_WAIT_INTERVAL);
-	}
+    if (ServiceStatus.dwCurrentState == SERVICE_RUNNING) {
+        UpdateServiceStatus(SERVICE_PAUSE_PENDING, NO_ERROR,
+                            SCM_WAIT_INTERVAL);
+
+        if (SuspendThread(hServiceThread) != -1) {
+            UpdateServiceStatus(SERVICE_PAUSED, NO_ERROR,
+                                SCM_WAIT_INTERVAL);
+        }
     }
 }
 
-    /*
-     * SCM resume command invokes this function
-     * If the service is not paused, this function does nothing.
-     * Otherwise, resume the worker thread and update the status.
-     */
-VOID
-ProcessServiceContinue (VOID)
+/*
+ * SCM resume command invokes this function
+ * If the service is not paused, this function does nothing.
+ * Otherwise, resume the worker thread and update the status.
+ */
+void
+ProcessServiceContinue(void)
 {
-  if (ServiceStatus.dwCurrentState == SERVICE_PAUSED)
-    {
-      UpdateServiceStatus (SERVICE_CONTINUE_PENDING, NO_ERROR, SCM_WAIT_INTERVAL);
-
-      if (ResumeThread (hServiceThread) != -1)
-	{
-	  UpdateServiceStatus (SERVICE_RUNNING, NO_ERROR, SCM_WAIT_INTERVAL);
-	}
+    if (ServiceStatus.dwCurrentState == SERVICE_PAUSED) {
+        UpdateServiceStatus(SERVICE_CONTINUE_PENDING, NO_ERROR,
+                            SCM_WAIT_INTERVAL);
+
+        if (ResumeThread(hServiceThread) != -1) {
+            UpdateServiceStatus(SERVICE_RUNNING, NO_ERROR,
+                                SCM_WAIT_INTERVAL);
+        }
     }
 }
 
-#endif /* WIN32 */
-
-
+#endif                          /* WIN32 */
diff -urpN net-snmp-5.8/testing/RUNFULLTESTS net-snmp-5.9.1/testing/RUNFULLTESTS
--- net-snmp-5.8/testing/RUNFULLTESTS	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/RUNFULLTESTS	2021-05-26 05:19:35.000000000 +0700
@@ -1,11 +1,12 @@
 #!/usr/bin/env perl
 
+use strict;
+use warnings;
 use Getopt::Long;
 #use Data::Dumper;
 use File::Basename;
 use File::Spec;
 use Cwd qw(abs_path);
-use strict;
 
 ########################################
 # Globals and Command Line options
@@ -24,6 +25,7 @@ GetOptions(\%opts,
            "quiet|q",
            "groups|g=s",
            "r=s",
+           "exclude|e=s",
            "debug",
            "srcdir|D=s",
            "builddir|d=s",
@@ -71,7 +73,7 @@ if (!$ENV{'MIBDIRS'}) {
 }
 
 my $cfp_path = File::Spec->catfile(dirname(abs_path($0)), "check_for_pskill");
-my $rc = `$cfp_path`;
+my $rc = system($cfp_path);
 if ($rc != 0) {
     die "$cfp_path failed with error code $rc\n";
 }
@@ -125,7 +127,7 @@ if ($opts{'f'}) {
 	push @tests, build_test($_);
     }
 } else {
-    @tests = gather_tests($opts{'groups'}, $opts{'r'});
+    @tests = gather_tests($opts{'groups'}, $opts{'r'}, $opts{'exclude'});
 }
 
 ########################################
@@ -138,6 +140,13 @@ if ($opts{'f'}) {
 DEBUG("Running tests:\n"); 
 DEBUG("-" x 78, "\n");
 
+$ENV{'PATH'}="$opts{'builddir'}/agent/.libs:$opts{'builddir'}/apps/.libs:$opts{'builddir'}:$ENV{'PATH'}";
+$ENV{'LD_LIBRARY_PATH'}=`find $opts{'builddir'} -name '*.so' | grep -v NetSNMP/agent/default_store | sed 's,/[^/]*\$,,' | sort -u | tr '\n' :`;
+$ENV{'PERL5LIB'}="$opts{'srcdir'}/perl:$opts{'srcdir'}/perl/SNMP:$opts{'srcdir'}/perl/blib/lib:$opts{'srcdir'}/testing/fulltests/perl:$opts{'srcdir'}/testing/fulltests/support";
+DEBUG("PATH: $ENV{'PATH'}\n");
+DEBUG("LD_LIBRARY_PATH: $ENV{'LD_LIBRARY_PATH'}\n");
+DEBUG("PERL5LIB: $ENV{'PERL5LIB'}\n");
+
 my $results;
 if ($harness) {
     $results = $harness->runtests(@tests);
@@ -177,6 +186,9 @@ sub decide_exec {
     # 1) Parse the $testfile argument.
     my ($dirname, $groupname, $basename, $app_extension, $file_extension) = 
       ($testfile =~ /([^\/]+)\/([^\/]+)\/([^\/]+)_([^\/_]+)\.*([^\/\.]*)$/);
+    if (!defined($app_extension)) {
+	return undef;
+    }
     $app_extension =~ s/$opts{'exeext'}\$//;
 
     # 2) we have a RUN_TYPE file in the same directory
@@ -193,8 +205,24 @@ sub decide_exec {
     return undef;
 }
 
+sub configured_with {
+    my ($opt) = @_;
+    my $cfglog = "$opts{'srcdir'}/config.log";
+
+    if (open my $fh, $cfglog) {
+	while (my $line = <$fh>) {
+	    if ($line =~ $opt) {
+		return 1;
+	    }
+	}
+    } else {
+	print "Failed to open $cfglog\n"
+    }
+    return 0;
+}
+
 sub gather_tests {
-    my ( $groups, $regexp ) = @_;
+    my ( $groups, $incl_regexp, $excl_regexp ) = @_;
     my @groups;
 
     # figure out the list of groups we need to search through
@@ -223,19 +251,27 @@ sub gather_tests {
 	    next;
 	}
 
+	if (($group eq 'perl' && !configured_with("PERLTARGS='perlmodules'")) ||
+	    ($group eq 'python' && !configured_with('with-python-modules'))) {
+	    DEBUG("Skipping group $group\n");
+	    next;
+	}
+
 	# push on all files that start with T[NUM]*
-	push_or_skip(\@tests, $regexp, glob("$opts{'srcdir'}/testing/$opts{'master-directory'}/$group/T[0-9]*"));
+	push_or_skip(\@tests, $incl_regexp, $excl_regexp,
+		     glob("$opts{'srcdir'}/testing/$opts{'master-directory'}/$group/T[0-9]*"));
     }
 
     return @tests;
 }
 
 sub push_or_skip {
-    my ($array, $regexp, @files) = @_;
+    my ($array, $incl_regexp, $excl_regexp, @files) = @_;
     foreach my $file (@files) {
 	next if ($file =~ /.(bak|old|orig|rej)$/);
 	next if ($file =~ /~$/);
-	next if (defined($regexp) && $file !~ /$regexp/i);
+	next if (defined($excl_regexp) && $file =~ /$excl_regexp/i);
+	next if (defined($incl_regexp) && $file !~ /$incl_regexp/i);
 	DEBUG("  Adding file $file\n");
 	push @$array, build_test($file);
     }
@@ -453,6 +489,7 @@ sub usage {
     print "    --group GROUP\n";
     print "\t\t\t(use 'all' to run all tests)\n";
     print "  -r REGEXP\t\tOnly run test files matching this regexp\n";
+    print "  -e REGEXP\t\tExclude test files matching this regexp\n";
     print "  -f\t\t\tRun only the failed tests from the last run\n";
     print "  -F\t\t\tDon't create the failed_tests file\n";
     print "  --failed-file FILE\tThe location of the failed state file\n";
diff -urpN net-snmp-5.8/testing/check_for_pskill net-snmp-5.9.1/testing/check_for_pskill
--- net-snmp-5.8/testing/check_for_pskill	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/check_for_pskill	2021-05-26 05:19:35.000000000 +0700
@@ -1,8 +1,9 @@
 #!/bin/sh
 
-# Make sure MinGW / MSYS users have the pskill.exe program to stop the agent and
+# Make sure MinGW32 users have the pskill.exe program to stop the agent and
 # snmptrapd
-if [ "x$OSTYPE" = "xmsys" ]; then
+case $(uname) in
+MINGW32*)
     for e in pskill.exe pslist.exe; do
 	if [ "x`type $e 2>/dev/null`" = "x" ]; then
 	    echo "Could not find $e. Aborting tests."
@@ -12,4 +13,5 @@ if [ "x$OSTYPE" = "xmsys" ]; then
 	    exit 1
 	fi
     done
-fi
+    ;;
+esac
diff -urpN net-snmp-5.8/testing/fulltests/default/S180trapaddrinfra net-snmp-5.9.1/testing/fulltests/default/S180trapaddrinfra
--- net-snmp-5.8/testing/fulltests/default/S180trapaddrinfra	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/S180trapaddrinfra	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,68 @@
+#
+# The T18* tests have a great deal of commonality.
+# We factor that out into this file.
+#
+# Usage:
+# HEADER ...
+# INITV4 or INITV6
+# CONFIGAGENT ...
+# RUNTEST
+#
+
+INIT() {
+    # We need to set $SNMP_TEST_DEST to a real IP address; we have a helper script
+    # to determine this
+    MYIP=`perl ../support/myip $1`
+    if [ $? -ne 0 ]
+    then
+        SKIP "can not determine my IP"
+    fi
+
+    if [ "$1" = "ipv6" ]
+    then
+        SNMP_TEST_DEST="[${MYIP}]":
+    else
+        SNMP_TEST_DEST=${MYIP}:
+    fi
+
+    # Standard V2c configuration
+    . ./Sv2cconfig
+
+    CONFIGTRAPD authcommunity log public
+    CONFIGTRAPD agentxsocket /dev/null
+
+    # Tracing that helps understand what is being done
+    AGENT_FLAGS="$AGENT_FLAGS -Dtdomain,netsnmp_sockaddr,netsnmp_udp"
+}
+
+INITV4() {
+    localhost=127.0.0.1
+    snmptrapd_log_regex="UDP: \[${localhost}\]:[0-9]*->\["
+    INIT
+}
+
+INITV6() {
+    localhost=::1
+    snmptrapd_log_regex="\[UDP/IPv6: \[${localhost}\]:[0-9]*\]"
+    SNMP_TRANSPORT_SPEC=udp6
+    INIT ipv6
+}
+
+RUNTEST() {
+    STARTTRAPD
+
+    STARTAGENT
+
+    # We just rely on the coldstart trap, so there is no active test here.
+
+    STOPAGENT
+
+    STOPTRAPD
+
+    # Check that the coldstart trap packet was sourced from localhost
+    # (IPv4 uses <addr>-><addr>; IPv6 uses just [UDP/IPv6: <addr>],
+    #  so match either "-" or "]" after the port.)
+    CHECKTRAPDCOUNT atleastone "${snmptrapd_log_regex}"
+
+    FINISHED
+}
diff -urpN net-snmp-5.8/testing/fulltests/default/T0221snmpbulkget_large_simple net-snmp-5.9.1/testing/fulltests/default/T0221snmpbulkget_large_simple
--- net-snmp-5.8/testing/fulltests/default/T0221snmpbulkget_large_simple	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/T0221snmpbulkget_large_simple	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,28 @@
+#!/bin/sh
+
+. ../support/simple_eval_tools.sh
+
+HEADER large SNMPv3 bulkget
+
+SKIPIFNOT USING_MIBII_SYSTEM_MIB_MODULE
+
+#
+# Begin test
+#
+
+# standard V3 configuration: 
+. ./Sv3config
+
+AGENT_FLAGS="$AGENT_FLAGS -Dsnmp_api,recv,send,snmp_build,dumpx_send,dumpv_send,dumph_send,snmp_sess,sess_async_send,snmpv3_parse:msgMaxSize"
+SNMP_FLAGS="$SNMP_FLAGS -Dsnmp_api,recv,send,snmp_build,dumpx_send,dumpv_send,dumph_send,snmp_sess,sess_async_send,snmpv3_parse:msgMaxSize"
+
+STARTAGENT
+
+CAPTURE "snmpbulkget $SNMP_FLAGS -On -Cn5 -Cr50 $NOAUTHTESTARGS $SNMP_TRANSPORT_SPEC:$SNMP_TEST_DEST$SNMP_SNMPD_PORT sysUpTime sysUpTime sysUpTime sysUpTime sysUpTime .1"
+
+STOPAGENT
+
+CHECKCOUNT atleastone "^\.1\.3\.6\.1\.2\.1\.1\.3\.0 = Timeticks: "
+CHECKCOUNT 55 "^\.1\."
+
+FINISHED
diff -urpN net-snmp-5.8/testing/fulltests/default/T0222snmpv3bulkget_simple net-snmp-5.9.1/testing/fulltests/default/T0222snmpv3bulkget_simple
--- net-snmp-5.8/testing/fulltests/default/T0222snmpv3bulkget_simple	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/T0222snmpv3bulkget_simple	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,24 @@
+#!/bin/sh
+
+. ../support/simple_eval_tools.sh
+
+HEADER SNMPv3 bulkget of sysServices
+
+SKIPIFNOT USING_MIBII_SYSTEM_MIB_MODULE
+
+#
+# Begin test
+#
+
+# standard V3 configuration:
+. ./Sv3config
+
+STARTAGENT
+
+CAPTURE "snmpbulkget $SNMP_FLAGS -On -Cn1 -Cr1472 $AUTHTESTARGS $SNMP_TRANSPORT_SPEC:$SNMP_TEST_DEST$SNMP_SNMPD_PORT .1.3.6.1.2.1.1.5 .1.3.6.1.2.1.1.7"
+
+STOPAGENT
+
+CHECKORDIE ".1.3.6.1.2.1.1.5.0 = STRING:"
+
+FINISHED
diff -urpN net-snmp-5.8/testing/fulltests/default/T053trapforwardloop_simple net-snmp-5.9.1/testing/fulltests/default/T053trapforwardloop_simple
--- net-snmp-5.8/testing/fulltests/default/T053trapforwardloop_simple	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/T053trapforwardloop_simple	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,37 @@
+#!/bin/sh
+
+. ../support/simple_eval_tools.sh
+
+HEADER trap forwarding loops are detected by snmptrapd
+
+SKIPIFNOT USING_EXAMPLES_EXAMPLE_MODULE
+SKIPIFNOT HAVE_SIGHUP
+
+#
+# Begin test
+#
+
+# standard V1 configuration: testcomunnity
+. ./Sv3config
+CONFIGAGENT trapsink ${SNMP_TRANSPORT_SPEC}:${SNMP_TEST_DEST}${SNMP_SNMPTRAPD_PORT} public
+
+CONFIGTRAPD authcommunity log,execute,net public
+CONFIGTRAPD agentxsocket /dev/null
+CONFIGTRAPD forward default 127.0.0.1:${SNMP_SNMPTRAPD_PORT}
+CONFIGTRAPD addForwarderInfo yes
+
+STARTTRAPD
+
+AGENT_FLAGS="$AGENT_FLAGS -Dexample,header_generic,add_trap"
+STARTAGENT
+
+CAPTURE "snmpset -On $SNMP_FLAGS $AUTHTESTARGS $SNMP_TRANSPORT_SPEC:$SNMP_TEST_DEST$SNMP_SNMPD_PORT .1.3.6.1.4.1.2021.254.7.0 i 1"
+
+STOPAGENT
+
+STOPTRAPD
+
+CHECKAGENT "write_exampletrap trap sent"
+CHECKTRAPDCOUNT 3 "Forwarding loop detected,.*already has.*IP address=127.0.0.1, not forwarding this trap"
+
+FINISHED
diff -urpN net-snmp-5.8/testing/fulltests/default/T055agentv1mintrap_simple net-snmp-5.9.1/testing/fulltests/default/T055agentv1mintrap_simple
--- net-snmp-5.8/testing/fulltests/default/T055agentv1mintrap_simple	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/T055agentv1mintrap_simple	2021-05-26 05:19:35.000000000 +0700
@@ -5,6 +5,8 @@
 HEADER snmpv1 traps are sent by snmpd without notification mib support
 
 SKIPIFNOT USING_EXAMPLES_EXAMPLE_MODULE
+# To do: figure out why this test fails with Xcode 12.
+[ "${TRAVIS_OS_NAME}" = "osx" ] && SKIP "Skipping T055 on OS/X"
 
 #
 # Begin test
diff -urpN net-snmp-5.8/testing/fulltests/default/T056agentv2cmintrap_simple net-snmp-5.9.1/testing/fulltests/default/T056agentv2cmintrap_simple
--- net-snmp-5.8/testing/fulltests/default/T056agentv2cmintrap_simple	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/T056agentv2cmintrap_simple	2021-05-26 05:19:35.000000000 +0700
@@ -5,6 +5,8 @@
 HEADER snmpv2c traps are sent by snmpd without notification mib support
 
 SKIPIFNOT USING_EXAMPLES_EXAMPLE_MODULE
+# To do: figure out why this test fails with Xcode 12.
+[ "${TRAVIS_OS_NAME}" = "osx" ] && SKIP "Skipping T056 on OS/X"
 
 #
 # Begin test
diff -urpN net-snmp-5.8/testing/fulltests/default/T065agentextend_oid_simple net-snmp-5.9.1/testing/fulltests/default/T065agentextend_oid_simple
--- net-snmp-5.8/testing/fulltests/default/T065agentextend_oid_simple	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/T065agentextend_oid_simple	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,33 @@
+#!/bin/sh
+
+. ../support/simple_eval_tools.sh
+
+HEADER "extending agent functionality with extend OID"
+
+SKIPIF NETSNMP_DISABLE_SNMPV2C
+SKIPIFNOT USING_AGENT_EXTEND_MODULE
+SKIPIFNOT USING_UTILITIES_EXECUTE_MODULE
+
+# make sure snmpwalk can be executed
+SNMPWALK="${SNMP_UPDIR}/apps/snmpwalk"
+[ -x "$SNMPWALK" ] || SKIP snmpwalk not compiled
+
+snmp_version=v2c
+TESTCOMMUNITY=testcommunity
+. ./Sv2cconfig
+
+#
+# Begin test
+#
+
+oid=.1.3.6.1.4.1.2021.8
+
+CONFIGAGENT extend "${oid}" mpstat /usr/bin/mpstat -P ALL
+
+STARTAGENT
+
+# NET-SNMP-EXTEND-MIB::nsExtendOutput1Line."hello" = STRING: "hello_world"
+CAPTURE "$SNMPWALK $SNMP_FLAGS -$snmp_version -c $TESTCOMMUNITY $SNMP_TRANSPORT_SPEC:$SNMP_TEST_DEST$SNMP_SNMPD_PORT ${oid}"
+
+STOPAGENT
+FINISHED
diff -urpN net-snmp-5.8/testing/fulltests/default/T070com2sec_simple net-snmp-5.9.1/testing/fulltests/default/T070com2sec_simple
--- net-snmp-5.8/testing/fulltests/default/T070com2sec_simple	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/T070com2sec_simple	2021-05-26 05:19:35.000000000 +0700
@@ -134,26 +134,34 @@ SAVECHECKAGENT '<"c406a", 255.255.255.25
 SAVECHECKAGENT 'line 30: Error:' # msg from h_strerror so it varies
 SAVECHECKAGENT 'line 31: Error:' # msg from h_strerror so it varies
 
-CHECKAGENT '<"c408a"'
-if [ "$snmp_last_test_result" -eq 0 ] ; then
-  CHECKAGENT 'line 32: Error:'
-  if [ "$snmp_last_test_result" -ne 1 ] ; then
+if false; then
+  # The two tests below have been disabled because these rely on resolving a
+  # domain name into a local IP address. Such DNS replies are filtered out by
+  # many security devices because to avoid DNS rebinding attacks. See also
+  # https://en.wikipedia.org/wiki/DNS_rebinding.
+
+  CHECKAGENT '<"c408a"'
+  if [ "$snmp_last_test_result" -eq 0 ] ; then
+    CHECKAGENT 'line 32: Error:'
+    if [ "$snmp_last_test_result" -ne 1 ] ; then
+      return_value=1
+      FINISHED
+    fi
+  elif [ "$snmp_last_test_result" -ne 1 ] ; then
     return_value=1
     FINISHED
   fi
-elif [ "$snmp_last_test_result" -ne 1 ] ; then
-  return_value=1
-  FINISHED
-fi
 
-CHECKAGENT '<"c408b"'
-if [ "$snmp_last_test_result" -eq 0 ] ; then
-  CHECKAGENT 'line 33: Error:'
-  if [ "$snmp_last_test_result" -ne 1 ] ; then
+  CHECKAGENT '<"c408b"'
+  if [ "$snmp_last_test_result" -eq 0 ] ; then
+    CHECKAGENT 'line 33: Error:'
+    if [ "$snmp_last_test_result" -ne 1 ] ; then
+      return_value=1
+    fi
+  elif [ "$snmp_last_test_result" -ne 1 ] ; then
     return_value=1
   fi
-elif [ "$snmp_last_test_result" -ne 1 ] ; then
-  return_value=1
+
 fi
 
 FINISHED
diff -urpN net-snmp-5.8/testing/fulltests/default/T071com2sec6_simple net-snmp-5.9.1/testing/fulltests/default/T071com2sec6_simple
--- net-snmp-5.8/testing/fulltests/default/T071com2sec6_simple	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/T071com2sec6_simple	2021-05-26 05:19:35.000000000 +0700
@@ -132,23 +132,30 @@ SAVECHECKAGENT '<"c606a", ffff:ffff:ffff
 SAVECHECKAGENT 'line 27: Error:'
 SAVECHECKAGENT 'line 28: Error:'
 
-# 608
-CHECKAGENT '<"c608a"'
-if [ "$snmp_last_test_result" -eq 0 ] ; then
-  CHECKAGENT 'line 29: Error:'
-  errnum=`expr $errnum - 1`
-  if [ "$snmp_last_test_result" -ne 1 ] ; then
+if false; then
+  # The two tests below have been disabled because these rely on resolving a
+  # domain name into a local IP address. Such DNS replies are filtered out by
+  # many security devices because to avoid DNS rebinding attacks. See also
+  # https://en.wikipedia.org/wiki/DNS_rebinding.
+
+  # 608
+  CHECKAGENT '<"c608a"'
+  if [ "$snmp_last_test_result" -eq 0 ] ; then
+    CHECKAGENT 'line 29: Error:'
+    errnum=`expr $errnum - 1`
+    if [ "$snmp_last_test_result" -ne 1 ] ; then
+      FINISHED
+    fi
+  elif [ "$snmp_last_test_result" -ne 1 ] ; then
     FINISHED
   fi
-elif [ "$snmp_last_test_result" -ne 1 ] ; then
-  FINISHED
-fi
 
-CHECKAGENTCOUNT atleastone '<"c608b"'
-if [ "$snmp_last_test_result" -eq 0 ] ; then
-  CHECKAGENT 'line 30: Error:'
-  if [ "$snmp_last_test_result" -eq 1 ] ; then
-    errnum=`expr $errnum - 1`
+  CHECKAGENTCOUNT atleastone '<"c608b"'
+  if [ "$snmp_last_test_result" -eq 0 ] ; then
+    CHECKAGENT 'line 30: Error:'
+    if [ "$snmp_last_test_result" -eq 1 ] ; then
+      errnum=`expr $errnum - 1`
+    fi
   fi
 fi
 
diff -urpN net-snmp-5.8/testing/fulltests/default/T180trap2sinkclientaddr_simple net-snmp-5.9.1/testing/fulltests/default/T180trap2sinkclientaddr_simple
--- net-snmp-5.8/testing/fulltests/default/T180trap2sinkclientaddr_simple	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/T180trap2sinkclientaddr_simple	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,16 @@
+#!/bin/sh
+
+. ../support/simple_eval_tools.sh
+
+HEADER Agent uses clientaddr for trapsink source
+
+SKIPIF NETSNMP_DISABLE_SNMPV2C
+
+. ./S180trapaddrinfra
+
+INITV4
+
+CONFIGAGENT "[snmp] clientaddr ${localhost}"
+CONFIGAGENT trap2sink ${SNMP_TRANSPORT_SPEC}:${SNMP_TEST_DEST}${SNMP_SNMPTRAPD_PORT} public
+
+RUNTEST
diff -urpN net-snmp-5.8/testing/fulltests/default/T181trap2sinkclientaddr6_simple net-snmp-5.9.1/testing/fulltests/default/T181trap2sinkclientaddr6_simple
--- net-snmp-5.8/testing/fulltests/default/T181trap2sinkclientaddr6_simple	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/T181trap2sinkclientaddr6_simple	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,16 @@
+#!/bin/sh
+
+. ../support/simple_eval_tools.sh
+
+HEADER Agent uses clientaddr for v6 trapsink source
+
+SKIPIF NETSNMP_DISABLE_SNMPV2C
+
+. ./S180trapaddrinfra
+
+INITV6
+
+CONFIGAGENT "[snmp] clientaddr ${localhost}"
+CONFIGAGENT trap2sink ${SNMP_TRANSPORT_SPEC}:${SNMP_TEST_DEST}${SNMP_SNMPTRAPD_PORT} public
+
+RUNTEST
diff -urpN net-snmp-5.8/testing/fulltests/default/T182trapsessclientaddr_simple net-snmp-5.9.1/testing/fulltests/default/T182trapsessclientaddr_simple
--- net-snmp-5.8/testing/fulltests/default/T182trapsessclientaddr_simple	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/T182trapsessclientaddr_simple	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,16 @@
+#!/bin/sh
+
+. ../support/simple_eval_tools.sh
+
+HEADER Agent uses clientaddr for trapsess source
+
+SKIPIF NETSNMP_DISABLE_SNMPV2C
+
+. ./S180trapaddrinfra
+
+INITV4
+
+CONFIGAGENT "[snmp] clientaddr ${localhost}"
+CONFIGAGENT trapsess -v 2c -c public ${SNMP_TRANSPORT_SPEC}:${SNMP_TEST_DEST}${SNMP_SNMPTRAPD_PORT}
+
+RUNTEST
diff -urpN net-snmp-5.8/testing/fulltests/default/T183trapsessclientaddr6_simple net-snmp-5.9.1/testing/fulltests/default/T183trapsessclientaddr6_simple
--- net-snmp-5.8/testing/fulltests/default/T183trapsessclientaddr6_simple	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/T183trapsessclientaddr6_simple	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,16 @@
+#!/bin/sh
+
+. ../support/simple_eval_tools.sh
+
+HEADER Agent uses clientaddr for v6 trapsess source
+
+SKIPIF NETSNMP_DISABLE_SNMPV2C
+
+. ./S180trapaddrinfra
+
+INITV6
+
+CONFIGAGENT "[snmp] clientaddr ${localhost}"
+CONFIGAGENT trapsess -v 2c -c public ${SNMP_TRANSPORT_SPEC}:${SNMP_TEST_DEST}${SNMP_SNMPTRAPD_PORT}
+
+RUNTEST
diff -urpN net-snmp-5.8/testing/fulltests/default/T184trapsesssource_simple net-snmp-5.9.1/testing/fulltests/default/T184trapsesssource_simple
--- net-snmp-5.8/testing/fulltests/default/T184trapsesssource_simple	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/T184trapsesssource_simple	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,16 @@
+#!/bin/sh
+
+. ../support/simple_eval_tools.sh
+
+HEADER Agent uses -s argument for trapsess source
+
+SKIPIF NETSNMP_DISABLE_SNMPV2C
+
+. ./S180trapaddrinfra
+
+INITV4
+
+CONFIGAGENT trapsess -s ${localhost} -v 2c -c public ${SNMP_TRANSPORT_SPEC}:${SNMP_TEST_DEST}${SNMP_SNMPTRAPD_PORT}
+
+RUNTEST
+
diff -urpN net-snmp-5.8/testing/fulltests/default/T185trapsesssource6_simple net-snmp-5.9.1/testing/fulltests/default/T185trapsesssource6_simple
--- net-snmp-5.8/testing/fulltests/default/T185trapsesssource6_simple	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/default/T185trapsesssource6_simple	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,15 @@
+#!/bin/sh
+
+. ../support/simple_eval_tools.sh
+
+HEADER Agent uses -s argument for v6 trapsess source
+
+SKIPIF NETSNMP_DISABLE_SNMPV2C
+
+. ./S180trapaddrinfra
+
+INITV6
+
+CONFIGAGENT trapsess -s ${localhost} -v 2c -c public ${SNMP_TRANSPORT_SPEC}:${SNMP_TEST_DEST}${SNMP_SNMPTRAPD_PORT}
+
+RUNTEST
diff -urpN net-snmp-5.8/testing/fulltests/perl/NetSNMPTestTransport.pm net-snmp-5.9.1/testing/fulltests/perl/NetSNMPTestTransport.pm
--- net-snmp-5.8/testing/fulltests/perl/NetSNMPTestTransport.pm	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/perl/NetSNMPTestTransport.pm	2021-05-26 05:19:35.000000000 +0700
@@ -1,15 +1,7 @@
-BEGIN {
-    if (exists($ENV{'srcdir'})) {
-	push @INC, "$ENV{'srcdir'}/testing/fulltests/support";
-    } elsif (-d "fulltests/support") {
-	push @INC, "fulltests/support";
-    } elsif (-d "../support") {
-	push @INC, "../support";
-    }
-}
-
 package NetSNMPTestTransport;
 
+use strict;
+use warnings;
 use NetSNMPTest;
 use Test;
 use SNMP;
@@ -41,7 +33,7 @@ sub run_tests {
     ######################################################################
     # GET test
     if (ref($session) eq 'SNMP::Session') {
-	$value = $session->get('sysContact.0');
+	my $value = $session->get('sysContact.0');
 	ok($value, 'itworked');
     }
 
diff -urpN net-snmp-5.8/testing/fulltests/perl/T001basic.t net-snmp-5.9.1/testing/fulltests/perl/T001basic.t
--- net-snmp-5.8/testing/fulltests/perl/T001basic.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/perl/T001basic.t	2021-05-26 05:19:35.000000000 +0700
@@ -2,16 +2,8 @@
 
 # HEADER Basic perl functionality to a UDP agent
 
-BEGIN {
-    if (exists($ENV{'srcdir'})) {
-	push @INC, "$ENV{'srcdir'}/testing/fulltests/support";
-    } elsif (-d "fulltests/support") {
-	push @INC, "fulltests/support";
-    } elsif (-d "../support") {
-	push @INC, "../support";
-    }
-}
-
+use strict;
+use warnings;
 use NetSNMPTest;
 use Test;
 use SNMP;
@@ -70,7 +62,7 @@ $value = $session->set($varbind);
 
 ok(($value == 0), 1, 'return value from set was a success');
 
-my $value = $session->get('sysLocation.0');
+$value = $session->get('sysLocation.0');
 
 ok($value, 'yep');
 
diff -urpN net-snmp-5.8/testing/fulltests/perl/T101udp.t net-snmp-5.9.1/testing/fulltests/perl/T101udp.t
--- net-snmp-5.8/testing/fulltests/perl/T101udp.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/perl/T101udp.t	2021-05-26 05:19:35.000000000 +0700
@@ -2,15 +2,8 @@
 
 # HEADER Perl UDP IPv4 Test
 
-BEGIN {
-    if (exists($ENV{'srcdir'})) {
-	push @INC, "$ENV{'srcdir'}/testing/fulltests/perl";
-    } elsif (-d "fulltests/perl") {
-	push @INC, "fulltests/perl";
-    } elsif (-d "../perl") {
-	push @INC, "../perl";
-    }
-}
+use strict;
+use warnings;
 use NetSNMPTestTransport;
 
 my $test = new NetSNMPTestTransport(agentaddress => "udp:localhost:9875");
diff -urpN net-snmp-5.8/testing/fulltests/perl/T102tcp.t net-snmp-5.9.1/testing/fulltests/perl/T102tcp.t
--- net-snmp-5.8/testing/fulltests/perl/T102tcp.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/perl/T102tcp.t	2021-05-26 05:19:35.000000000 +0700
@@ -2,15 +2,8 @@
 
 # HEADER Perl TCP IPv4 Test
 
-BEGIN {
-    if (exists($ENV{'srcdir'})) {
-	push @INC, "$ENV{'srcdir'}/testing/fulltests/perl";
-    } elsif (-d "fulltests/perl") {
-	push @INC, "fulltests/perl";
-    } elsif (-d "../perl") {
-	push @INC, "../perl";
-    }
-}
+use strict;
+use warnings;
 use NetSNMPTestTransport;
 
 my $test = new NetSNMPTestTransport(agentaddress => "tcp:localhost:9875");
diff -urpN net-snmp-5.8/testing/fulltests/perl/T103udp6.t net-snmp-5.9.1/testing/fulltests/perl/T103udp6.t
--- net-snmp-5.8/testing/fulltests/perl/T103udp6.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/perl/T103udp6.t	2021-05-26 05:19:35.000000000 +0700
@@ -2,15 +2,8 @@
 
 # HEADER Perl UDP IPv6 Test
 
-BEGIN {
-    if (exists($ENV{'srcdir'})) {
-	push @INC, "$ENV{'srcdir'}/testing/fulltests/perl";
-    } elsif (-d "fulltests/perl") {
-	push @INC, "fulltests/perl";
-    } elsif (-d "../perl") {
-	push @INC, "../perl";
-    }
-}
+use strict;
+use warnings;
 use NetSNMPTestTransport;
 
 my $test = new NetSNMPTestTransport(agentaddress => "udp6:[::1]:9875");
diff -urpN net-snmp-5.8/testing/fulltests/perl/T104tcp6.t net-snmp-5.9.1/testing/fulltests/perl/T104tcp6.t
--- net-snmp-5.8/testing/fulltests/perl/T104tcp6.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/perl/T104tcp6.t	2021-05-26 05:19:35.000000000 +0700
@@ -2,15 +2,8 @@
 
 # HEADER Perl TCP IPv6 Test
 
-BEGIN {
-    if (exists($ENV{'srcdir'})) {
-	push @INC, "$ENV{'srcdir'}/testing/fulltests/perl";
-    } elsif (-d "fulltests/perl") {
-	push @INC, "fulltests/perl";
-    } elsif (-d "../perl") {
-	push @INC, "../perl";
-    }
-}
+use strict;
+use warnings;
 use NetSNMPTestTransport;
 
 my $test = new NetSNMPTestTransport(agentaddress => "tcp6:[::1]:9875");
diff -urpN net-snmp-5.8/testing/fulltests/perl/T105unix.t net-snmp-5.9.1/testing/fulltests/perl/T105unix.t
--- net-snmp-5.8/testing/fulltests/perl/T105unix.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/perl/T105unix.t	2021-05-26 05:19:35.000000000 +0700
@@ -2,15 +2,8 @@
 
 # HEADER Perl Unix Domain Socket Test
 
-BEGIN {
-    if (exists($ENV{'srcdir'})) {
-	push @INC, "$ENV{'srcdir'}/testing/fulltests/perl";
-    } elsif (-d "fulltests/perl") {
-	push @INC, "fulltests/perl";
-    } elsif (-d "../perl") {
-	push @INC, "../perl";
-    }
-}
+use strict;
+use warnings;
 use NetSNMPTestTransport;
 
 my $test = new NetSNMPTestTransport(agentaddress => "bogus");
diff -urpN net-snmp-5.8/testing/fulltests/snmpv3/T010scapitest_capp.c net-snmp-5.9.1/testing/fulltests/snmpv3/T010scapitest_capp.c
--- net-snmp-5.8/testing/fulltests/snmpv3/T010scapitest_capp.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/snmpv3/T010scapitest_capp.c	2021-05-26 05:19:35.000000000 +0700
@@ -29,6 +29,7 @@
 #ifdef HAVE_NETINET_IN_H
 #include <netinet/in.h>
 #endif
+#include <sys/types.h>
 
 #include <net-snmp/library/asn1.h>
 #include <net-snmp/library/snmp_api.h>
@@ -42,6 +43,9 @@
 #include <net-snmp/library/getopt.h>
 
 #include <stdlib.h>
+#if HAVE_UNISTD_H
+#include <unistd.h>
+#endif
 
 
 /*
@@ -83,21 +87,18 @@ output(const char *format, ...)
     return 0;
 }
 
-#define SUCCESS(s)					\
-{							\
-    printf("# Done with %s\n", s);			\
-}
+#define TEST_SUCCEEDED(s) do { printf("# Done with %s\n", (s)); } while (0)
 
-#define FAILED(e, f)                                                    \
-{                                                                       \
-    if (e != SNMPERR_SUCCESS) {                                         \
-                printf("not ok: %d - %s\n", ++testcount, f);            \
-		failcount += 1;                                         \
-	} else {                                                        \
-                printf("ok: %d - %s\n", ++testcount, f);                \
-        }                                                               \
-    fflush(stdout); \
-}
+#define TEST_FAILED(e, f)                                               \
+do {                                                                    \
+    if ((e) != SNMPERR_SUCCESS) {                                       \
+        printf("not ok: %d - %s\n", ++testcount, (f));                  \
+        failcount += 1;                                                 \
+    } else {                                                            \
+        printf("ok: %d - %s\n", ++testcount, (f));                      \
+    }                                                                   \
+    fflush(stdout);                                                     \
+} while (0)
 
 #define BIGSTRING							\
     (const u_char *)                                                    \
@@ -200,7 +201,7 @@ main(int argc, char **argv)
      * Test stuff.
      */
     rval = sc_init();
-    FAILED(rval, "sc_init() return code");
+    TEST_FAILED(rval, "sc_init() return code");
 
 
     if (docrypt || doalltests) {
@@ -243,16 +244,16 @@ test_dorandom(void)
     output("Random test -- large request:");
 
     rval = sc_random(buf, &nbytes);
-    FAILED(rval, "sc_random() return code");
+    TEST_FAILED(rval, "sc_random() return code");
 
     if (nbytes != origrequest) {
-        FAILED(SNMPERR_GENERR,
-               "sc_random() returned different than requested.");
+        TEST_FAILED(SNMPERR_GENERR,
+                    "sc_random() returned different than requested.");
     }
 
     dump_chunk("scapitest", NULL, buf, nbytes);
 
-    SUCCESS("Random test -- large request.");
+    TEST_SUCCEEDED("Random test -- large request.");
 
 
     output("Random test -- short requests:");
@@ -261,17 +262,17 @@ test_dorandom(void)
     for (i = 0; i < shortcount; i++) {
         nbytes = origrequest_short;
         rval = sc_random(buf, &nbytes);
-        FAILED(rval, "sc_random() return code");
+        TEST_FAILED(rval, "sc_random() return code");
 
         if (nbytes != origrequest_short) {
-            FAILED(SNMPERR_GENERR,
-                   "sc_random() returned different " "than requested.");
+            TEST_FAILED(SNMPERR_GENERR,
+                        "sc_random() returned different " "than requested.");
         }
 
         dump_chunk("scapitest", NULL, buf, nbytes);
     }                           /* endfor */
 
-    SUCCESS("Random test -- short requests.");
+    TEST_SUCCEEDED("Random test -- short requests.");
 
 
     return failcount;
@@ -303,7 +304,7 @@ test_dokeyedhash(void)
         auth_idx = 0,
         mlcount = 0;        /* MAC Length count.   */
     size_t          hblen;      /* Hash Buffer length. */
-    netsnmp_auth_alg_info *ai;
+    const netsnmp_auth_alg_info *ai;
     u_int           hashbuf_len[] = {
         LOCAL_MAXBUF,
         USM_MD5_AND_SHA_AUTH_LEN,
@@ -344,14 +345,14 @@ test_dokeyedhash(void)
                                secret_len, BIGSTRING,
                                bigstring_len,
                                hashbuf, &hblen);
-    FAILED(rval, "sc_generate_keyed_hash() return code");
+    TEST_FAILED(rval, "sc_generate_keyed_hash() return code");
 
     if (hashbuf_len[mlcount] > ai->proper_length) {
         if (hblen != ai->proper_length) {
-            FAILED(SNMPERR_GENERR, "Wrong hash length returned.  (1)");
+            TEST_FAILED(SNMPERR_GENERR, "Wrong hash length returned.  (1)");
         }
     } else if (hblen != hashbuf_len[mlcount]) {
-        FAILED(SNMPERR_GENERR, "Wrong hash length returned.  (2)");
+        TEST_FAILED(SNMPERR_GENERR, "Wrong hash length returned.  (2)");
     }
     if (hblen > ai->mac_length) {
         printf("# TRUNCATING %d length hash to %s mac length %d\n", (int)hblen,
@@ -363,7 +364,7 @@ test_dokeyedhash(void)
         sc_check_keyed_hash(ai->alg_oid, ai->oid_len, BIGSECRET,
                             secret_len, BIGSTRING, bigstring_len, hashbuf,
                             hblen);
-    FAILED(rval, "sc_check_keyed_hash() return code");
+    TEST_FAILED(rval, "sc_check_keyed_hash() return code");
 
     binary_to_hex(hashbuf, hblen, &s);
     printf("# hash buffer (len=%" NETSNMP_PRIz "u, request=%d):   %s\n",
@@ -399,7 +400,7 @@ test_docrypt(void)
 {
     int             rval, index = 0, secret_len, iv_len,
         bigstring_len = strlen((const char *) BIGSTRING);
-    netsnmp_priv_alg_info *pi;
+    const netsnmp_priv_alg_info *pi;
     size_t          buf_len, cryptbuf_len;
 
     u_char            buf[LOCAL_MAXBUF],
@@ -427,25 +428,25 @@ test_docrypt(void)
                           secret, secret_len,
                           iv, iv_len,
                           BIGSTRING, bigstring_len, cryptbuf, &cryptbuf_len);
-        FAILED(rval, "sc_encrypt() return code.");
+        TEST_FAILED(rval, "sc_encrypt() return code.");
 
         rval = sc_decrypt(pi->alg_oid, pi->oid_len,
                           secret, secret_len,
                           iv, iv_len, cryptbuf, cryptbuf_len, buf, &buf_len);
-        FAILED(rval, "sc_decrypt() return code.");
+        TEST_FAILED(rval, "sc_decrypt() return code.");
 
         if (pi->pad_size > 0) {
             /* ignore the pad */
             buf_len -= buf[buf_len-1];
         }
 
-        FAILED((buf_len != bigstring_len),
-               "Decrypted buffer is the right length.");
+        TEST_FAILED(buf_len != bigstring_len,
+                    "Decrypted buffer is the right length.");
         printf("# original length: %d\n", bigstring_len);
         printf("# output   length: %" NETSNMP_PRIz "u\n", buf_len);
 
-        FAILED((memcmp(buf, BIGSTRING, bigstring_len) != 0),
-               "Decrypted buffer is the same as the original plaintext.");
+        TEST_FAILED((memcmp(buf, BIGSTRING, bigstring_len) != 0),
+                    "Decrypted buffer is the same as the original plaintext.");
 
     } /* while(1) */
 
diff -urpN net-snmp-5.8/testing/fulltests/snmpv3/T040keymanagetest_capp.c net-snmp-5.9.1/testing/fulltests/snmpv3/T040keymanagetest_capp.c
--- net-snmp-5.8/testing/fulltests/snmpv3/T040keymanagetest_capp.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/snmpv3/T040keymanagetest_capp.c	2021-05-26 05:19:35.000000000 +0700
@@ -31,7 +31,9 @@
 #include <netinet/in.h>
 #endif
 
+#if HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 #include <ctype.h>
 
 #include <net-snmp/library/asn1.h>
@@ -66,21 +68,18 @@ int             doalltests = 0, dogenKu
 #define OUTPUTALWAYS(o)	fprintf(stdout, "# %s\n", o);
 #define OUTPUT(o)	if (!bequiet) { OUTPUTALWAYS(o); }
 
-#define SUCCESS(s)					\
-{							\
-    fprintf(stdout, "# Done with %s\n", s);             \
-}
+#define TEST_SUCCEEDED(s) do { printf("# Done with %s\n", (s)); } while (0)
 
-#define FAILED(e, f)                                                    \
-{                                                                       \
+#define TEST_FAILED(e, f)                                               \
+do {                                                                    \
     if ((e) != SNMPERR_SUCCESS) {                                       \
-                fprintf(stdout, "not ok: %d - %s\n", ++testcount, f);	\
-		failcount += 1;                                         \
-	} else {                                                        \
-                fprintf(stdout, "ok: %d - %s\n", ++testcount, f);	\
-        }                                                               \
-    fflush(stdout); \
-}
+        fprintf(stdout, "not ok: %d - %s\n", ++testcount, (f));         \
+        failcount += 1;                                                 \
+    } else {                                                            \
+        fprintf(stdout, "ok: %d - %s\n", ++testcount, (f));             \
+    }                                                                   \
+    fflush(stdout);                                                     \
+} while (0)
 
 #define DETAILINT(s, i) \
     fprintf(stdout, "# %s: %d\n", s, i);
@@ -180,7 +179,7 @@ main(int argc, char **argv)
      * Test stuff.
      */
     rval = sc_init();
-    FAILED(rval, "sc_init().");
+    TEST_FAILED(rval, "sc_init().");
 
     if (dogenKu || doalltests) {
         failcount += test_genKu();
@@ -300,10 +299,10 @@ test_genKu(void)
     rval = generate_Ku(hashtype, USM_LENGTH_OID_TRANSFORM,
                        (const u_char *) passphrase, strlen(passphrase),
                        Ku, &kulen);
-    FAILED(rval, "generate_Ku().");
+    TEST_FAILED(rval, "generate_Ku().");
 
-    FAILED((kulen != properlength),
-           "Ku length is the right length for this hashtype.");
+    TEST_FAILED(kulen != properlength,
+                "Ku length is the right length for this hashtype.");
 
     binary_to_hex(Ku, kulen, &s);
     if (!bequiet)
@@ -384,8 +383,8 @@ test_genkul(void)
     if (tolower(*(engineID + 1)) == 'x') {
         engineID_len =
             hex_to_binary2(engineID + 2, engineID_len - 2, &s);
-        FAILED((engineID_len < 0),
-               "Could not resolve hex engineID.");
+        TEST_FAILED(engineID_len < 0,
+                    "Could not resolve hex engineID.");
         engineID = (u_char *) s;
         binary_to_hex(engineID, engineID_len, &s);
     }
@@ -411,7 +410,7 @@ test_genkul(void)
 
     rval = generate_Ku(hashtype_Ku, USM_LENGTH_OID_TRANSFORM,
                        (u_char *) passphrase, strlen(passphrase), Ku, &kulen);
-    FAILED(rval, "generate_Ku().");
+    TEST_FAILED(rval, "generate_Ku().");
 
     binary_to_hex(Ku, kulen, &s);
     if (!bequiet)
@@ -429,14 +428,14 @@ test_genkul(void)
 
     if ((hashtype_Ku == usmHMACMD5AuthProtocol)
         && (hashtype_kul == usmHMACSHA1AuthProtocol)) {
-        FAILED((rval == SNMPERR_SUCCESS),
-               "generate_kul SHOULD fail when Ku length is "
-               "less than hash transform length.");
+        TEST_FAILED(rval == SNMPERR_SUCCESS,
+                    "generate_kul SHOULD fail when Ku length is "
+                    "less than hash transform length.");
     } else {
-        FAILED(rval, "generate_kul().");
+        TEST_FAILED(rval, "generate_kul().");
 
-        FAILED(kul_len != properlength,
-               "checking if kul length is right for the given hashtype.");
+        TEST_FAILED(kul_len != properlength,
+                    "checking if kul length is right for the given hashtype.");
 
         binary_to_hex(kul, kul_len, &s);
         fprintf(stdout, "# kul (%s) (len=%" NETSNMP_PRIz "u):  %s\n",
@@ -456,7 +455,7 @@ test_genkul(void)
         goto test_genkul_again_local;
     }
 
-    SUCCESS(testname);
+    TEST_SUCCEEDED(testname);
 
 
     /*
@@ -522,8 +521,7 @@ test_keychange(void)
     if (tolower(*(newkey + 1)) == 'x') {
         newkey_len = hex_to_binary2((const u_char *) newkey + 2,
                                     newkey_len - 2, &s);
-        FAILED(newkey_len < 0,
-               "Could not resolve hex newkey.");
+        TEST_FAILED(newkey_len < 0, "Could not resolve hex newkey.");
         newkey = (const u_char *) s;
         binary_to_hex((const u_char *) newkey, newkey_len, &s);
     }
@@ -537,8 +535,7 @@ test_keychange(void)
     if (tolower(*(oldkey + 1)) == 'x') {
         oldkey_len = hex_to_binary2((const u_char *) oldkey + 2,
                                     oldkey_len - 2, &s);
-        FAILED(oldkey_len < 0,
-               "Could not resolve hex oldkey.");
+        TEST_FAILED(oldkey_len < 0, "Could not resolve hex oldkey.");
         oldkey = (const u_char *) s;
         binary_to_hex(oldkey, oldkey_len, &s);
     }
@@ -571,11 +568,11 @@ test_keychange(void)
                             oldkey_buf, properlength,
                             newkey_buf, properlength,
                             keychange_buf, &keychange_len);
-    FAILED(rval, "encode_keychange().");
+    TEST_FAILED(rval, "encode_keychange().");
 
-    FAILED(keychange_len != (properlength * 2),
-           "KeyChange string (encoded) is not proper length "
-           "for this hash transform.");
+    TEST_FAILED(keychange_len != properlength * 2,
+                "KeyChange string (encoded) is not proper length "
+                "for this hash transform.");
 
     binary_to_hex(keychange_buf, keychange_len, &s);
     fprintf(stdout, "# (%s) KeyChange string:  %s\n",
@@ -587,22 +584,21 @@ test_keychange(void)
                             oldkey_buf, properlength,
                             keychange_buf, properlength * 2,
                             temp_buf, &temp_len);
-    FAILED(rval, "decode_keychange().");
+    TEST_FAILED(rval, "decode_keychange().");
 
-    FAILED(temp_len != properlength,
-           "decoded newkey is not proper length for "
-           "this hash transform.");
+    TEST_FAILED(temp_len != properlength,
+                "decoded newkey is not proper length for this hash transform.");
 
     binary_to_hex(temp_buf, temp_len, &s);
     fprintf(stdout, "# decoded newkey:  %s\n", s);
     SNMP_FREE(s);
 
 
-    FAILED(memcmp(newkey_buf, temp_buf, temp_len),
-           "newkey did not decode properly.");
+    TEST_FAILED(memcmp(newkey_buf, temp_buf, temp_len),
+                "newkey did not decode properly.");
 
 
-    SUCCESS(hashname);
+    TEST_SUCCEEDED(hashname);
 
 
     /*
diff -urpN net-snmp-5.8/testing/fulltests/snmpv3/T050etimetest_capp.c net-snmp-5.9.1/testing/fulltests/snmpv3/T050etimetest_capp.c
--- net-snmp-5.8/testing/fulltests/snmpv3/T050etimetest_capp.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/snmpv3/T050etimetest_capp.c	2021-05-26 05:19:35.000000000 +0700
@@ -29,7 +29,9 @@
 #include <netinet/in.h>
 #endif
 
+#if HAVE_UNISTD_H
 #include <unistd.h>
+#endif
 
 #include <net-snmp/library/asn1.h>
 #include <net-snmp/library/snmp_api.h>
@@ -63,21 +65,18 @@ int             doalltests = 0, dohashin
 
 #define OUTPUT(o)	fprintf(stdout, "# %s\n", o);
 
-#define SUCCESS(s)					\
-{							\
-    fprintf(stdout, "# Done with %s\n", s);             \
-}
+#define TEST_SUCCEEDED(s) do { printf("# Done with %s\n", (s)); } while (0)
 
-#define FAILED(e, f)                                                    \
-{                                                                       \
+#define TEST_FAILED(e, f)                                               \
+do {                                                                    \
     if (e != SNMPERR_SUCCESS) {                                         \
-                fprintf(stdout, "not ok: %d - %s\n", ++testcount, f);	\
-		failcount += 1;                                         \
-	} else {                                                        \
-                fprintf(stdout, "ok: %d - %s\n", ++testcount, f);	\
-        }                                                               \
-    fflush(stdout); \
-}
+        fprintf(stdout, "not ok: %d - %s\n", ++testcount, (f));         \
+        failcount += 1;                                                 \
+    } else {                                                            \
+        fprintf(stdout, "ok: %d - %s\n", ++testcount, (f));             \
+    }                                                                   \
+    fflush(stdout);                                                     \
+} while (0)
 
 #define DETAILINT(s, i) \
     fprintf(stdout, "# %s: %d\n", s, i);
@@ -155,7 +154,7 @@ main(int argc, char **argv)
      * test stuff.
      */
     rval = sc_init();
-    FAILED(rval, "sc_init()");
+    TEST_FAILED(rval, "sc_init()");
 
 
     if (dohashindex || doalltests) {
@@ -290,19 +289,19 @@ test_etime(void)
 
     rval = ISENGINEKNOWN((const u_char *) "A", 1);
     if (rval == TRUE) {
-        FAILED(SNMPERR_GENERR, "Query of empty list returned TRUE.")
+        TEST_FAILED(SNMPERR_GENERR, "Query of empty list returned TRUE.");
     }
 
 
     rval = set_enginetime((const u_char *) "BB", 2, 2, 20, TRUE);
-    FAILED(rval, "set_enginetime()");
+    TEST_FAILED(rval, "set_enginetime()");
 
 
     rval = set_enginetime((const u_char *) "CCC", 3, 31, 90127, TRUE);
-    FAILED(rval, "set_enginetime()");
+    TEST_FAILED(rval, "set_enginetime()");
 
 
-    SUCCESS("Check of empty list, and two additions.");
+    TEST_SUCCEEDED("Check of empty list, and two additions.");
 
 
 
@@ -313,23 +312,23 @@ test_etime(void)
 
 
     rval = ENSURE_ENGINE_RECORD((const u_char *) "DDDD", 4);
-    FAILED(rval, "ENSURE_ENGINE_RECORD()");
+    TEST_FAILED(rval, "ENSURE_ENGINE_RECORD()");
 
 
     rval = MAKENEW_ENGINE_RECORD((const u_char *) "EEEEE", 5);
     if (rval == SNMPERR_SUCCESS) {
-        FAILED(rval,
-               "MAKENEW_ENGINE_RECORD returned success for "
-               "missing record.");
+        TEST_FAILED(rval,
+                    "MAKENEW_ENGINE_RECORD returned success for "
+                    "missing record.");
     }
 
 
     rval = MAKENEW_ENGINE_RECORD((const u_char *) "BB", 2);
-    FAILED(rval, "MAKENEW_ENGINE_RECORD().");
+    TEST_FAILED(rval, "MAKENEW_ENGINE_RECORD().");
 
 
-    SUCCESS
-        ("Added entries with macros, tested for existence with macros.");
+    TEST_SUCCEEDED("Added entries with macros, tested for existence with"
+                   " macros.");
 
 
 
@@ -357,33 +356,33 @@ test_etime(void)
 
 
     rval = get_enginetime((const u_char *) "BB", 2, &eboot, &etime, TRUE);
-    FAILED(rval, "get_enginetime().");
+    TEST_FAILED(rval, "get_enginetime().");
 
     fprintf(stdout, "# BB = <%d,%d>\n", eboot, etime);
     if ((etime < 20) || (eboot < 2)) {
-        FAILED(SNMPERR_GENERR,
-               "get_enginetime() returned bad values.  (1)");
+        TEST_FAILED(SNMPERR_GENERR,
+                    "get_enginetime() returned bad values.  (1)");
     }
 
     rval = get_enginetime((const u_char *) "DDDD", 4, &eboot, &etime, FALSE);
-    FAILED(rval, "get_enginetime().");
+    TEST_FAILED(rval, "get_enginetime().");
 
     fprintf(stdout, "# DDDD = <%d,%d>\n", eboot, etime);
     if ((etime < sleeptime) || (eboot != 0)) {
-        FAILED(SNMPERR_GENERR,
-               "get_enginetime() returned bad values.  (2)");
+        TEST_FAILED(SNMPERR_GENERR,
+                    "get_enginetime() returned bad values.  (2)");
     }
 
 
     rval = set_enginetime((const u_char *) "CCC", 3, 234, 10000, TRUE);
-    FAILED(rval, "set_enginetime().");
+    TEST_FAILED(rval, "set_enginetime().");
 
 
     rval = set_enginetime((const u_char *) "EEEEE", 5, 9876, 55555, TRUE);
-    FAILED(rval, "set_enginetime().");
+    TEST_FAILED(rval, "set_enginetime().");
 
 
-    SUCCESS("Retrieval and updates.");
+    TEST_SUCCEEDED("Retrieval and updates.");
 
 
 
diff -urpN net-snmp-5.8/testing/fulltests/support/cagentlib_build net-snmp-5.9.1/testing/fulltests/support/cagentlib_build
--- net-snmp-5.8/testing/fulltests/support/cagentlib_build	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/support/cagentlib_build	2021-05-26 05:19:35.000000000 +0700
@@ -8,6 +8,7 @@ cat >>"$2.c" <<EOF
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <agentx/protocol.h>
 
 /* testing specific header */
 #include <net-snmp/library/testing.h>
@@ -42,5 +43,5 @@ cat >>"$2.c" <<EOF
 EOF
 
 # ... and compile it.
-${builddir}/libtool --mode=link `${builddir}/net-snmp-config --build-command` -I$builddir/include -I$srcdir/include -o $2 $2.c ${builddir}/snmplib/libnetsnmp.la ${builddir}/agent/libnetsnmpagent.la `${builddir}/net-snmp-config --external-libs`
+${builddir}/libtool --mode=link `${builddir}/net-snmp-config --build-command` -I$builddir/include -I$srcdir/include -I$srcdir/agent/mibgroup -o $2 $2.c ${builddir}/snmplib/libnetsnmp.la ${builddir}/agent/libnetsnmpagent.la `${builddir}/net-snmp-config --external-libs`
 echo $2
diff -urpN net-snmp-5.8/testing/fulltests/support/clib_build net-snmp-5.9.1/testing/fulltests/support/clib_build
--- net-snmp-5.8/testing/fulltests/support/clib_build	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/support/clib_build	2021-05-26 05:19:35.000000000 +0700
@@ -15,13 +15,21 @@ cat >>"$2.c" <<EOF
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-includes.h>
 #include <net-snmp/library/large_fd_set.h>
+#include <net-snmp/library/snmpIPBaseDomain.h>
+#include <utilities/execute.h>
 
 /* testing specific header */
 #include <net-snmp/library/testing.h>
 
 /* standard headers */
 #include <errno.h>
+#ifdef HAVE_INTTYPES_H
+#include <inttypes.h>
+#endif
 #include <stdio.h>
+#if HAVE_UNISTD_H
+#include <unistd.h>
+#endif
 #include <sys/types.h>
 #ifdef HAVE_LIMITS_H
 #include <limits.h>
@@ -70,5 +78,5 @@ cat >>"$2.c" <<EOF
 EOF
 
 # ... and compile it.
-${builddir}/libtool --mode=link `${builddir}/net-snmp-config --build-command` -I$builddir/include -I$srcdir -I$srcdir/include -o $2 $2.c ${builddir}/snmplib/libnetsnmp.la `${builddir}/net-snmp-config --external-libs`
+${builddir}/libtool --mode=link `${builddir}/net-snmp-config --build-command` -I$builddir/include -I$srcdir -I$srcdir/include -I$srcdir/agent/mibgroup -o $2 $2.c ${builddir}/snmplib/libnetsnmp.la ${builddir}/agent/libnetsnmpmibs.la `${builddir}/net-snmp-config --external-libs`
 echo $2
diff -urpN net-snmp-5.8/testing/fulltests/support/myip net-snmp-5.9.1/testing/fulltests/support/myip
--- net-snmp-5.8/testing/fulltests/support/myip	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/support/myip	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,53 @@
+#!/usr/bin/env perl
+#
+# Use the "connect" trick to find out my IP address.
+# Note that the destination address here does not
+# actually matter, we will never send any data to it.
+# We use Google's public DNS server, since, it doesn't
+# matter.
+
+use strict;
+use warnings;
+import IO::Socket::INET6;
+if (eval "Socket6->import(qw(AF_INET6 inet_ntop inet_pton pack_sockaddr_in6
+                             sockaddr_in6))") {
+    use Socket qw(AF_INET SOCK_DGRAM pack_sockaddr_in sockaddr_in);
+} else {
+    use Socket qw(AF_INET AF_INET6 SOCK_DGRAM inet_ntop inet_pton
+		  pack_sockaddr_in pack_sockaddr_in6 sockaddr_in sockaddr_in6);
+}
+
+
+my $v6 = defined($ARGV[0]) && $ARGV[0] eq "ipv6";
+my ($af, $dest, $noaddr);
+if ($v6) {
+    $af = AF_INET6;
+    $dest = '2001:4860:4860::8888';
+    $noaddr = '::';
+ } else {
+    $af = AF_INET;
+    $dest = '8.8.8.8';
+    $noaddr = '0.0.0.0';
+}
+socket(my $sock, $af, SOCK_DGRAM, 0) or die "socket creation failed: $!";
+my $myip;
+if ($v6) {
+    connect($sock, pack_sockaddr_in6(53, inet_pton($af, $dest)));
+    my ($port, $ip6_address) = sockaddr_in6(getsockname($sock));
+    socket(my $sock2, $af, SOCK_DGRAM, 0);
+    my $i = 1;
+    while (1) {
+	bind($sock2, sockaddr_in6(0, $ip6_address, $i)) && last;
+	$i++;
+    }
+    $myip = inet_ntop($af, $ip6_address);
+    exit 1 if $myip eq $noaddr;
+    $myip = $myip . '%' . $i;
+} else {
+    connect($sock, pack_sockaddr_in(53, inet_pton($af, $dest)));
+    my ($port, $myaddr) = sockaddr_in(getsockname($sock));
+    $myip = inet_ntop($af, $myaddr);
+    exit 1 if $myip eq $noaddr;
+}
+print $myip, "\n";
+exit 0;
diff -urpN net-snmp-5.8/testing/fulltests/support/simple_TESTCONF.sh net-snmp-5.9.1/testing/fulltests/support/simple_TESTCONF.sh
--- net-snmp-5.8/testing/fulltests/support/simple_TESTCONF.sh	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/support/simple_TESTCONF.sh	2021-05-26 05:19:35.000000000 +0700
@@ -199,6 +199,9 @@ elif test -x /c/Windows/System32/netstat
 elif test -x /usr/sbin/ss ; then
     # Fedora24, RHEL7 does not install netstat as standard
     NETSTAT=/usr/sbin/ss
+elif test -x /usr/bin/ss ; then
+    # Debian 10 (buster) put ss in /usr/bin/ss
+    NETSTAT=/usr/bin/ss
 else
     NETSTAT=""
 fi
@@ -214,7 +217,7 @@ fi
 
 PROBE_FOR_PORT() {
     BASE_PORT=$1
-    MAX_RETRIES=10
+    MAX_RETRIES=30
     if test -x "$NETSTAT" ; then
         if test -z "$RANDOM"; then
             RANDOM=2
diff -urpN net-snmp-5.8/testing/fulltests/support/simple_eval_tools.sh net-snmp-5.9.1/testing/fulltests/support/simple_eval_tools.sh
--- net-snmp-5.8/testing/fulltests/support/simple_eval_tools.sh	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/support/simple_eval_tools.sh	2021-05-26 05:19:35.000000000 +0700
@@ -1,3 +1,4 @@
+#!/bin/sh
 #
 # eval_tools.sh
 #
@@ -685,6 +686,24 @@ FINISHED() {
 	    rm -f core
 	fi
 	echo "$headerStr...FAIL" >> $SNMP_TMPDIR/invoked
+	if [ -n "${TRAVIS_OS_NAME}" ] || [ -n "$APPVEYOR" ] ||
+	   [ -n "$CIRRUS_CI" ]; then
+	    {
+		find "$SNMP_TMPDIR" -type f |
+		    while read -r f; do
+			local lines
+			echo "==== $f"
+			lines=$(wc -l "$f" | { read -r a b; echo "$a"; })
+			if [ "$lines" -gt 512 ]; then
+			    head -n 256 "$f"
+			    echo "..."
+			    tail -n 256 "$f"
+			else
+			    cat "$f"
+			fi
+		    done;
+	    } 1>&2
+	fi
 	exit 1
     fi
 
diff -urpN net-snmp-5.8/testing/fulltests/support/simple_run net-snmp-5.9.1/testing/fulltests/support/simple_run
--- net-snmp-5.8/testing/fulltests/support/simple_run	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/support/simple_run	2021-05-26 05:19:35.000000000 +0700
@@ -6,9 +6,9 @@ if [ $# = 0 ]; then
 fi
 
 if [ "x$builddir" = "x" ]; then
-    cd ..
     builddir=`pwd`
-    if cd testing 2>/dev/null; then
+    builddir=`dirname "$builddir"`
+    if [ -d "${builddir}/testing" ]; then
        :
     else
        echo "Error: $0 must be started from inside the testing directory in the source tree."
@@ -18,11 +18,11 @@ if [ "x$builddir" = "x" ]; then
 fi
 
 if [ "x$srcdir" = "x" ]; then
-    srcdir=`dirname $0`
-    srcdir=`cd $srcdir; cd ../..; pwd`
-    srcdir=`dirname $srcdir`
-    cd $srcdir
-    if cd testing 2>/dev/null; then
+    srcdir=`dirname "$0"`
+    srcdir=`dirname "$srcdir"`
+    srcdir=`dirname "$srcdir"`
+    srcdir=`dirname "$srcdir"`
+    if [ -d "${srcdir}/testing" ]; then
        :
     else
        echo "Error: $0 must be started from inside the testing directory in the source tree."
@@ -32,11 +32,14 @@ if [ "x$srcdir" = "x" ]; then
 fi
 
 testscript=$1
-if [ `echo $testscript | cut -c 1-1` != '/' ]; then
+if [ `echo "$testscript" | cut -c 1-1` != '/' ]; then
     testscript="`pwd`/$1"
 fi
 
-SNMP_BASEDIR=`dirname $0`
+SNMP_BASEDIR=`dirname "$0"`
+if [ `echo "$SNMP_BASEDIR" | cut -c 1-1` != '/' ]; then
+    SNMP_BASEDIR="`pwd`/$SNMP_BASEDIR"
+fi
 
 ## prefer MIB files found in source hierarchy
 SNMP_PREFER_NEAR_MIBS=1
@@ -45,10 +48,6 @@ export SNMP_PREFER_NEAR_MIBS
 SNMP_TEST_PREFIX=${SNMP_TEST_PREFIX:=T}
 export SNMP_TEST_PREFIX
 
-SNMP_ORIGDIR=`pwd`	        ## this script may be invoked with relative path
-export SNMP_ORIGDIR
-
-SNMP_UPDIR=${builddir}          ## build directory
 if [ "x$DYNAMIC_ANALYZER" = "x" ]; then
     SNMP_SLEEP_DEFAULT=1
 else
@@ -60,15 +59,14 @@ export SNMP_SLEEP
 # Find executables in source first, then build, then existing PATH.
 ## Add to PATH if a binary is found.
 
-cd $SNMP_UPDIR
-SNMP_UPDIR=`pwd`
+SNMP_UPDIR=${builddir}          ## build directory
 bf=snmpget
-if [ -x "$bf" ] ; then
+if [ -x "$SNMP_UPDIR/$bf" ] ; then
    PATH=$SNMP_UPDIR:$PATH
 else
   for dd in apps bin ; do
    bf=$dd/snmpget
-   if [ -x "$bf" ] ; then
+   if [ -x "$SNMP_UPDIR/$bf" ] ; then
       PATH=$SNMP_UPDIR/$dd:$PATH
       break
    fi
@@ -76,7 +74,7 @@ else
 fi
 for dd in agent bin sbin ; do
    bf=$dd/snmpd
-   if [ -x "$bf" ] ; then
+   if [ -x "$SNMP_UPDIR/$bf" ] ; then
       PATH=$SNMP_UPDIR/$dd:$PATH
       break
    fi
@@ -89,8 +87,7 @@ fi
 unset bf
 
 # Run from the test scripts directory.
-cd $SNMP_ORIGDIR ; cd ${SNMP_BASEDIR}
-SNMP_BASEDIR=`pwd`
+cd "${SNMP_BASEDIR}" || return $?
 export SNMP_BASEDIR
 
 PATH=${SNMP_BASEDIR}:$PATH
@@ -110,10 +107,10 @@ testnum="`basename $testscript`"
 
 . simple_eval_tools.sh
 
-cd `dirname $testscript`
+cd `dirname "$testscript"` || return $?
 PATH=`pwd`:$PATH
 export PATH
 
-. `basename $testscript`
+. `basename "$testscript"`
 
 FINISHED
diff -urpN net-snmp-5.8/testing/fulltests/tls/S300tlsperl.pl net-snmp-5.9.1/testing/fulltests/tls/S300tlsperl.pl
--- net-snmp-5.8/testing/fulltests/tls/S300tlsperl.pl	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/tls/S300tlsperl.pl	2021-05-26 05:19:35.000000000 +0700
@@ -1,14 +1,5 @@
 #!/usr/bin/perl
 
-BEGIN {
-    if (exists($ENV{'srcdir'})) {
-	push @INC, "$ENV{'srcdir'}/testing/fulltests/support";
-    } elsif (-d "fulltests/support") {
-	push @INC, "fulltests/support";
-    } elsif (-d "../support") {
-	push @INC, "../support";
-    }
-}
 use NetSNMPTest;
 use Test;
 use SNMP;
diff -urpN net-snmp-5.8/testing/fulltests/tls/STlsAgentTrap net-snmp-5.9.1/testing/fulltests/tls/STlsAgentTrap
--- net-snmp-5.8/testing/fulltests/tls/STlsAgentTrap	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/tls/STlsAgentTrap	2021-05-26 05:19:35.000000000 +0700
@@ -9,15 +9,14 @@ SKIPIFNOT USING_EXAMPLES_EXAMPLE_MODULE
 #
 
 # produce the certificates to use
+HOSTNAME=`hostname`
 
 # snmptrapd
-HOSTNAME=`hostname`
 CAPTURE $NSCERT gencert -t snmptrapd   --cn $HOSTNAME $NSCERTARGS
 TRAPDFP=`$NSCERT showcerts --fingerprint --brief snmptrapd  $NSCERTARGS`
 CHECKVALUEISNT "$TRAPDFP" "" "generated fingerprint for snmptrapd certificate"
 
 # snmpd
-HOSTNAME=`hostname`
 CAPTURE $NSCERT gencert -t snmpd   --cn $HOSTNAME $NSCERTARGS
 SERVERFP=`$NSCERT showcerts --fingerprint --brief snmpd  $NSCERTARGS`
 CHECKVALUEISNT "$SERVERFP" "" "generated fingerprint for snmpd certificate"
@@ -31,7 +30,8 @@ CHECKVALUEISNT "$TESTUSERFP" "" "generat
 # Configuration
 
 # snmpd
-CONFIGAGENT trapsess -Ci -T our_identity=$TESTUSERFP -T their_identity=$TRAPDFP  ${SNMP_TRANSPORT_SPEC}:${SNMP_TEST_DEST}${SNMP_SNMPTRAPD_PORT}
+CONFIGAGENT trapsess     -T localCert=$TESTUSERFP -T peerCert=$TRAPDFP  ${SNMP_TRANSPORT_SPEC}:${SNMP_TEST_DEST}${SNMP_SNMPTRAPD_PORT}
+CONFIGAGENT trapsess -Ci -T localCert=$TESTUSERFP -T peerCert=$TRAPDFP  ${SNMP_TRANSPORT_SPEC}:${SNMP_TEST_DEST}${SNMP_SNMPTRAPD_PORT}
 CONFIGAGENT '[snmp]' localCert $SERVERFP
 CONFIGAGENT 	     certSecName      9  $TESTUSERFP     --cn
 CONFIGAGENT          rwuser           -s tsm testuser
@@ -40,7 +40,6 @@ CONFIGAGENT          rwuser           -s
 CONFIGTRAPD '[snmp]' localCert $TRAPDFP
 CONFIGTRAPD 	     certSecName      9  $TESTUSERFP     --cn
 CONFIGTRAPD 	     authuser         log -s tsm testuser authpriv
-CONFIGTRAPD          agentxsocket     /dev/null
 
 # general
 
@@ -50,17 +49,15 @@ CONFIGTRAPD          agentxsocket     /d
 
 STARTTRAPD
 
-# initialize only the example mib, and not the notification mib stuff
 AGENT_FLAGS="$AGENT_FLAGS -Dexample,header_generic"
 STARTAGENT
 
-#DELAY
-CAPTURE "snmpset -v3 -T their_identity=snmpd -T our_identity=snmpapp -On -t 3 -r 0 $SNMP_FLAGS $SNMP_TRANSPORT_SPEC:$SNMP_TEST_DEST$SNMP_SNMPD_PORT .1.3.6.1.4.1.2021.254.8.0 i 1"
+CAPTURE "snmpset -v3 -T peerCert=snmpd -T localCert=snmpapp -On -t 3 -r 0 $SNMP_FLAGS $SNMP_TRANSPORT_SPEC:$SNMP_TEST_DEST$SNMP_SNMPD_PORT .1.3.6.1.4.1.2021.254.8.0 i 1"
 
 STOPAGENT
 
 STOPTRAPD
 
-CHECKTRAPD "life the universe and everything"
+CHECKTRAPDCOUNT 2 "life the universe and everything"
 
 FINISHED
diff -urpN net-snmp-5.8/testing/fulltests/tls/STlsVars net-snmp-5.9.1/testing/fulltests/tls/STlsVars
--- net-snmp-5.8/testing/fulltests/tls/STlsVars	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/tls/STlsVars	2021-05-26 05:19:35.000000000 +0700
@@ -40,7 +40,7 @@ DOTRAPTEST() {
 
   # IF-MIB::linkUp
   CAPTURE "snmptrap $args 0 .1.3.6.1.6.3.1.1.5.4 system.sysContact.0 s $value"
-
+  DELAY 1
   CHECKTRAPD "STRING: $value"
 }
 
@@ -50,7 +50,7 @@ DOFAILTRAPTEST() {
 
   # IF-MIB::linkUp
   CAPTURE "snmptrap $args 0 .1.3.6.1.6.3.1.1.5.4 system.sysContact.0 s $value"
-
+  DELAY 1
   CHECKTRAPDCOUNT 0 "$value"
 }
 
diff -urpN net-snmp-5.8/testing/fulltests/tls/STsmPrefix net-snmp-5.9.1/testing/fulltests/tls/STsmPrefix
--- net-snmp-5.8/testing/fulltests/tls/STsmPrefix	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/tls/STsmPrefix	2021-05-26 05:19:35.000000000 +0700
@@ -45,7 +45,7 @@ FLAGS="-v3 -r1 -On $SNMP_TRANSPORT_SPEC:
 #
 # Start the agent
 #
-AGENT_FLAGS="-Dtsm udp:9999"
+AGENT_FLAGS="-Dtsm"
 STARTAGENT
 
 CAPTURE "snmpget -Dssl $FLAGS .1.3.6.1.2.1.190.1.2.1.0"
@@ -80,8 +80,6 @@ CAPTURE "snmpget -Dssl $FLAGS .1.3.6.1.2
 CHECKCOUNT 0 ".1.3.6.1.2.1.1.3.0 = Timeticks:"
 CHECK "authorizationError"
 
-CAPTURE "snmpget -v 1 -c public 127.0.0.1:9999 .1.3.6.1.2.1.190.1.2.1.0"
-
 # cleanup
 STOPAGENT
 
diff -urpN net-snmp-5.8/testing/fulltests/tls/T111DtlsServer_simple net-snmp-5.9.1/testing/fulltests/tls/T111DtlsServer_simple
--- net-snmp-5.8/testing/fulltests/tls/T111DtlsServer_simple	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/tls/T111DtlsServer_simple	2021-05-26 05:19:35.000000000 +0700
@@ -4,7 +4,7 @@
 
 HEADER DTLS-UDP server certificate tests
 
-SKIPIFNOT NETSNMP_TRANSPORT_TLSTCP_DOMAIN
+SKIPIFNOT NETSNMP_TRANSPORT_DTLSUDP_DOMAIN
 
 #
 # Begin test
diff -urpN net-snmp-5.8/testing/fulltests/tls/T113DtlsSan_simple net-snmp-5.9.1/testing/fulltests/tls/T113DtlsSan_simple
--- net-snmp-5.8/testing/fulltests/tls/T113DtlsSan_simple	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/tls/T113DtlsSan_simple	2021-05-26 05:19:35.000000000 +0700
@@ -4,7 +4,7 @@
 
 HEADER DTLS-UDP server SAN tests
 
-SKIPIFNOT NETSNMP_TRANSPORT_TLSTCP_DOMAIN
+SKIPIFNOT NETSNMP_TRANSPORT_DTLSUDP_DOMAIN
 
 #
 # Begin test
diff -urpN net-snmp-5.8/testing/fulltests/tls/T200TlsIpv6_simple net-snmp-5.9.1/testing/fulltests/tls/T200TlsIpv6_simple
--- net-snmp-5.8/testing/fulltests/tls/T200TlsIpv6_simple	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/tls/T200TlsIpv6_simple	2021-05-26 05:19:35.000000000 +0700
@@ -6,6 +6,14 @@ HEADER TLS-TCP over IPV6
 
 SKIPIFNOT NETSNMP_TRANSPORT_TLSTCP_DOMAIN
 
+openssl_version=$(openssl version | cut -d ' ' -f2)
+major=$(echo $openssl_version | cut -c1)
+minor=$(echo $openssl_version | cut -c3)
+
+if [ $major -lt 1 ] || { [ $major -eq 1 ] && [ $minor -eq 0 ]; }; then
+    SKIP "openssl version $openssl_version does not support IPv6"
+fi
+
 #
 # Begin test
 #
diff -urpN net-snmp-5.8/testing/fulltests/tls/T300TlsPerl.t net-snmp-5.9.1/testing/fulltests/tls/T300TlsPerl.t
--- net-snmp-5.8/testing/fulltests/tls/T300TlsPerl.t	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/tls/T300TlsPerl.t	2021-05-26 05:19:35.000000000 +0700
@@ -5,4 +5,11 @@
 $agentaddress = "tlstcp:localhost:9875";
 $feature = "NETSNMP_TRANSPORT_TLSTCP_DOMAIN";
 
-do "$ENV{'srcdir'}/testing/fulltests/tls/S300tlsperl.pl";
+if (!defined($ENV{'TRAVIS_OS_NAME'})) {
+    do "$ENV{'srcdir'}/testing/fulltests/tls/S300tlsperl.pl";
+} else {
+    # Skip this test on Travis CI
+    use Test;
+    plan(tests => 1);
+    ok(1);
+}
diff -urpN net-snmp-5.8/testing/fulltests/unit-tests/T004snmp_enum_clib.c net-snmp-5.9.1/testing/fulltests/unit-tests/T004snmp_enum_clib.c
--- net-snmp-5.8/testing/fulltests/unit-tests/T004snmp_enum_clib.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/unit-tests/T004snmp_enum_clib.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,5 +1,7 @@
 /* HEADER Testing snmp_enum */
 
+#ifndef NETSNMP_FEATURE_REMOVE_SNMP_ENUM_STORE_LIST
+
 #define CONFIG_TYPE "snmp-enum-unit-test"
 #define STRING1 "life, and everything"
 #define STRING2 "restaurant at the end of the universe"
@@ -30,7 +32,7 @@
 char tmp_persist_file[256];
 char *se_find_result;
 
-sprintf(tmp_persist_file, "/tmp/snmp-enum-unit-test-%d", getpid());
+sprintf(tmp_persist_file, "/tmp/snmp-enum-unit-test-%ld", (long)getpid());
 netsnmp_setenv("SNMP_PERSISTENT_FILE", tmp_persist_file, 1);
 
 init_snmp_enum("snmp");
@@ -101,3 +103,5 @@ OK(se_find_result && strcmp(se_find_resu
 
 clear_snmp_enum();
 unregister_all_config_handlers();
+
+#endif
diff -urpN net-snmp-5.8/testing/fulltests/unit-tests/T008asn1_clib.c net-snmp-5.9.1/testing/fulltests/unit-tests/T008asn1_clib.c
--- net-snmp-5.8/testing/fulltests/unit-tests/T008asn1_clib.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/unit-tests/T008asn1_clib.c	2021-05-26 05:19:35.000000000 +0700
@@ -8,19 +8,23 @@ debug_register_tokens("dumpv_recv,dumpv_
 #endif
 
 {
-    const long intval[] = {
-        -0x80000000L,
-        -0x7fffffffL,
-        -0xffffL,
-        -3,
-        -1,
-        0,
-        1,
-        3,
-        0xffff,
-        0x7fffffff,
+    static struct {
+        unsigned char encoded[8];
+        unsigned encoded_len;
+        unsigned long decoded;
+    } data[] = {
+        { { ASN_INTEGER, 4, 0x80, 0x00, 0x00, 0x00 }, 6, -0x80000000L },
+        { { ASN_INTEGER, 4, 0x80, 0x00, 0x00, 0x01 }, 6, -0x7fffffffL },
+        { { ASN_INTEGER, 3, 0xff, 0x00, 0x01       }, 5, -0xffffL },
+        { { ASN_INTEGER, 1, 0xfd                   }, 3, -3 },
+        { { ASN_INTEGER, 1, 0xff                   }, 3, -1 },
+        { { ASN_INTEGER, 1, 0x00                   }, 3, 0 },
+        { { ASN_INTEGER, 1, 0x01                   }, 3, 1 },
+        { { ASN_INTEGER, 1, 0x03                   }, 3, 3 },
+        { { ASN_INTEGER, 3, 0x00, 0xff, 0xff,      }, 5, 0xffff },
+        { { ASN_INTEGER, 4, 0x7f, 0xff, 0xff, 0xff }, 6, 0x7fffffff },
     };
-    for (i = 0; i < sizeof(intval)/sizeof(intval[0]); ++i) {
+    for (i = 0; i < sizeof(data)/sizeof(data[0]); ++i) {
 	u_char encoded[256];
 	size_t encoded_length;
 	u_char *build_result;
@@ -31,31 +35,37 @@ debug_register_tokens("dumpv_recv,dumpv_
         u_char *rbuild_result = NULL;
         size_t rbuild_len = 0;
         size_t offset = 0;
+        const long input = data[i].decoded;
 
 	encoded_length = sizeof(encoded);
 	build_result = asn_build_int(encoded, &encoded_length, ASN_INTEGER,
-				     &intval[i], sizeof(intval[i]));
+				     &input, sizeof(input));
 	OKF(build_result + encoded_length == encoded + sizeof(encoded),
-	    ("asn_build_int(%ld)", intval[i]));
+	    ("asn_build_int(%ld)", input));
+        OKF(build_result - encoded == data[i].encoded_len,
+            ("input %ld: encoded len %" NETSNMP_PRIz "d <> %d\n",
+             input, build_result - encoded, data[i].encoded_len));
+        OKF(memcmp(encoded, data[i].encoded, data[i].encoded_len) == 0,
+            ("encoded data for input %ld\n", input));
 	decoded_length = sizeof(encoded) - encoded_length;
 	parse_result = asn_parse_int(encoded, &decoded_length, &decoded_type,
 				     &decoded_value, sizeof(decoded_value));
 	OKF(parse_result == build_result && decoded_type == ASN_INTEGER
-	    && decoded_value == intval[i],
+	    && decoded_value == input,
 	    ("asn_parse_int(asn_build_int(%ld)) %s; decoded type %d <> %d;"
 	     " decoded value %ld",
-	     intval[i], parse_result == build_result ? "succeeded" : "failed",
+	     input, parse_result == build_result ? "succeeded" : "failed",
 	     decoded_type, ASN_INTEGER, decoded_value));
 
         OKF(asn_realloc_rbuild_int(&rbuild_result, &rbuild_len, &offset, 1,
-                                   ASN_INTEGER, &intval[i], sizeof(intval[i])),
-            ("asn_realloc_rbuild_int(%ld)", intval[i]));
+                                   ASN_INTEGER, &input, sizeof(input)),
+            ("asn_realloc_rbuild_int(%ld)", input));
         OKF(sizeof(encoded) - encoded_length == offset &&
             memcmp(encoded, rbuild_result + rbuild_len - offset,
                    offset) == 0,
             ("asn_build_int(%ld) != asn_realloc_rbuild_int(%ld)",
-             intval[i], intval[i]));
-        free (rbuild_result);
+             input, input));
+        free(rbuild_result);
     }
 }
 
@@ -142,7 +152,7 @@ debug_register_tokens("dumpv_recv,dumpv_
 
 #ifdef NETSNMP_WITH_OPAQUE_SPECIAL_TYPES
 
-#define TOINT64(c) ((long long)(long)(c).high << 32 | (c).low)
+#define TOINT64(c) ((int64_t)(long)(c).high << 32 | (c).low)
 
 {
     const struct counter64 intval[] = {
@@ -180,15 +190,15 @@ debug_register_tokens("dumpv_recv,dumpv_
 					      ASN_OPAQUE_I64,
 					      &intval[i], sizeof(intval[i]));
 	OKF(build_result + encoded_length == encoded + sizeof(encoded),
-	    ("asn_build_signed_int64(%lld)", TOINT64(intval[i])));
+	    ("asn_build_signed_int64(%" PRIi64 ")", TOINT64(intval[i])));
 	decoded_length = sizeof(encoded) - encoded_length;
 	parse_result = asn_parse_signed_int64(encoded, &decoded_length,
 					      &decoded_type, &decoded_value,
 					      sizeof(decoded_value));
 	OKF(parse_result == build_result && decoded_type == ASN_OPAQUE_I64
 	    && memcmp(&decoded_value, &intval[i], sizeof(decoded_value)) == 0,
-	    ("asn_parse_signed_int64(asn_build_signed_int64(%lld)) %s;"
-	     " decoded type %d <> %d; decoded value %lld",
+	    ("asn_parse_signed_int64(asn_build_signed_int64(%" PRIi64 ")) %s;"
+	     " decoded type %d <> %d; decoded value %" PRIi64,
 	     TOINT64(intval[i]),
 	     parse_result == build_result ? "succeeded" : "failed",
 	     decoded_type, ASN_OPAQUE_I64, TOINT64(decoded_value)));
@@ -196,12 +206,12 @@ debug_register_tokens("dumpv_recv,dumpv_
         OKF(asn_realloc_rbuild_signed_int64(&rbuild_result, &rbuild_len,
                                             &offset, 1, ASN_OPAQUE_I64,
                                             &intval[i], sizeof(intval[i])),
-            ("asn_realloc_rbuild_signed_int64(%lld)", TOINT64(intval[i])));
+            ("asn_realloc_rbuild_signed_int64(%" PRIi64 ")", TOINT64(intval[i])));
         OKF(sizeof(encoded) - encoded_length == offset &&
             memcmp(encoded, rbuild_result + rbuild_len - offset,
                    offset) == 0,
-            ("asn_build_signed_int64(%lld) != "
-             "asn_realloc_rbuild_signed_int64(%lld)",
+            ("asn_build_signed_int64(%" PRIi64 ") != "
+             "asn_realloc_rbuild_signed_int64(%" PRIi64 ")",
              TOINT64(intval[i]), TOINT64(intval[i])));
         free (rbuild_result);
     }
@@ -209,7 +219,7 @@ debug_register_tokens("dumpv_recv,dumpv_
 
 #endif
 
-#define TOUINT64(c) ((unsigned long long)(c).high << 32 | (c).low)
+#define TOUINT64(c) ((uint64_t)(c).high << 32 | (c).low)
 
 {
     const struct counter64 intval[] = {
@@ -246,15 +256,15 @@ debug_register_tokens("dumpv_recv,dumpv_
 						ASN_COUNTER64,
 						&intval[i], sizeof(intval[i]));
 	OKF(build_result + encoded_length == encoded + sizeof(encoded),
-	    ("asn_build_unsigned_int64(%llu)", TOUINT64(intval[i])));
+	    ("asn_build_unsigned_int64(%" PRIu64 ")", TOUINT64(intval[i])));
 	decoded_length = sizeof(encoded) - encoded_length;
 	parse_result = asn_parse_unsigned_int64(encoded, &decoded_length,
 						&decoded_type, &decoded_value,
 						sizeof(decoded_value));
 	OKF(parse_result && decoded_type == ASN_COUNTER64
 	    && memcmp(&decoded_value, &intval[i], sizeof(decoded_value)) == 0,
-	    ("asn_parse_unsigned_int64(asn_build_unsigned_int64(%llu)) %s;"
-	     " decoded type %d <> %d; decoded value %llu",
+	    ("asn_parse_unsigned_int64(asn_build_unsigned_int64(%" PRIu64 ")) %s;"
+	     " decoded type %d <> %d; decoded value %" PRIu64,
 	     TOUINT64(intval[i]),
 	     parse_result == build_result ? "succeeded" : "failed",
 	     decoded_type, ASN_COUNTER64, TOUINT64(decoded_value)));
@@ -262,12 +272,12 @@ debug_register_tokens("dumpv_recv,dumpv_
         OKF(asn_realloc_rbuild_unsigned_int64(&rbuild_result, &rbuild_len,
                                               &offset, 1, ASN_COUNTER64,
                                               &intval[i], sizeof(intval[i])),
-            ("asn_realloc_rbuild_unsigned_int64(%llud)", TOUINT64(intval[i])));
+            ("asn_realloc_rbuild_unsigned_int64(%" PRIu64 ")", TOUINT64(intval[i])));
         OKF(sizeof(encoded) - encoded_length == offset &&
             memcmp(encoded, rbuild_result + rbuild_len - offset,
                    offset) == 0,
-            ("asn_build_unsigned_int64(%lld) != "
-             "asn_realloc_rbuild_unsigned_int64(%lld)",
+            ("asn_build_unsigned_int64(%" PRIi64 ") != "
+             "asn_realloc_rbuild_unsigned_int64(%" PRIi64 ")",
              TOUINT64(intval[i]), TOUINT64(intval[i])));
         free (rbuild_result);
     }
@@ -291,15 +301,15 @@ debug_register_tokens("dumpv_recv,dumpv_
 						ASN_OPAQUE_COUNTER64,
 						&intval[i], sizeof(intval[i]));
 	OKF(build_result + encoded_length == encoded + sizeof(encoded),
-	    ("asn_build_unsigned_int64(%llu)", TOUINT64(intval[i])));
+	    ("asn_build_unsigned_int64(%" PRIu64 ")", TOUINT64(intval[i])));
 	decoded_length = sizeof(encoded) - encoded_length;
 	parse_result = asn_parse_unsigned_int64(encoded, &decoded_length,
 						&decoded_type, &decoded_value,
 						sizeof(decoded_value));
 	OKF(parse_result && decoded_type == ASN_OPAQUE_COUNTER64
 	    && memcmp(&decoded_value, &intval[i], sizeof(decoded_value)) == 0,
-	    ("asn_parse_unsigned_int64(asn_build_unsigned_int64(%llu)) %s;"
-	     " decoded type %d <> %d; decoded value %llu",
+	    ("asn_parse_unsigned_int64(asn_build_unsigned_int64(%" PRIu64 ")) %s;"
+	     " decoded type %d <> %d; decoded value %" PRIu64,
 	     TOUINT64(intval[i]),
 	     parse_result == build_result ? "succeeded" : "failed",
 	     decoded_type, ASN_OPAQUE_COUNTER64, TOUINT64(decoded_value)));
@@ -307,12 +317,12 @@ debug_register_tokens("dumpv_recv,dumpv_
         OKF(asn_realloc_rbuild_unsigned_int64(&rbuild_result, &rbuild_len,
                                               &offset, 1, ASN_OPAQUE_COUNTER64,
                                               &intval[i], sizeof(intval[i])),
-            ("asn_realloc_rbuild_unsigned_int64(%llud)", TOUINT64(intval[i])));
+            ("asn_realloc_rbuild_unsigned_int64(%" PRIu64 ")", TOUINT64(intval[i])));
         OKF(sizeof(encoded) - encoded_length == offset &&
             memcmp(encoded, rbuild_result + rbuild_len - offset,
                    offset) == 0,
-            ("asn_build_unsigned_int64(%lld) != "
-             "asn_realloc_rbuild_unsigned_int64(%lld)",
+            ("asn_build_unsigned_int64(%" PRIi64 ") != "
+             "asn_realloc_rbuild_unsigned_int64(%" PRIi64 ")",
              TOUINT64(intval[i]), TOUINT64(intval[i])));
         free (rbuild_result);
     }
@@ -334,15 +344,15 @@ debug_register_tokens("dumpv_recv,dumpv_
 						ASN_OPAQUE_U64,
 						&intval[i], sizeof(intval[i]));
 	OKF(build_result + encoded_length == encoded + sizeof(encoded),
-	    ("asn_build_unsigned_int64(%llu)", TOUINT64(intval[i])));
+	    ("asn_build_unsigned_int64(%" PRIu64 ")", TOUINT64(intval[i])));
 	decoded_length = sizeof(encoded) - encoded_length;
 	parse_result = asn_parse_unsigned_int64(encoded, &decoded_length,
 						&decoded_type, &decoded_value,
 						sizeof(decoded_value));
 	OKF(parse_result && decoded_type == ASN_OPAQUE_U64
 	    && memcmp(&decoded_value, &intval[i], sizeof(decoded_value)) == 0,
-	    ("asn_parse_unsigned_int64(asn_build_unsigned_int64(%llu)) %s;"
-	     " decoded type %d <> %d; decoded value %llu",
+	    ("asn_parse_unsigned_int64(asn_build_unsigned_int64(%" PRIu64 ")) %s;"
+	     " decoded type %d <> %d; decoded value %" PRIu64,
 	     TOUINT64(intval[i]),
 	     parse_result == build_result ? "succeeded" : "failed",
 	     decoded_type, ASN_OPAQUE_U64, TOUINT64(decoded_value)));
@@ -350,12 +360,12 @@ debug_register_tokens("dumpv_recv,dumpv_
         OKF(asn_realloc_rbuild_unsigned_int64(&rbuild_result, &rbuild_len,
                                               &offset, 1, ASN_OPAQUE_U64,
                                               &intval[i], sizeof(intval[i])),
-            ("asn_realloc_rbuild_unsigned_int64(%llud)", TOUINT64(intval[i])));
+            ("asn_realloc_rbuild_unsigned_int64(%" PRIu64 ")", TOUINT64(intval[i])));
         OKF(sizeof(encoded) - encoded_length == offset &&
             memcmp(encoded, rbuild_result + rbuild_len - offset,
                    offset) == 0,
-            ("asn_build_unsigned_int64(%lld) != "
-             "asn_realloc_rbuild_unsigned_int64(%lld)",
+            ("asn_build_unsigned_int64(%" PRIi64 ") != "
+             "asn_realloc_rbuild_unsigned_int64(%" PRIi64 ")",
              TOUINT64(intval[i]), TOUINT64(intval[i])));
         free (rbuild_result);
     }
diff -urpN net-snmp-5.8/testing/fulltests/unit-tests/T010netsnmp_string_time_to_secs_clib.c net-snmp-5.9.1/testing/fulltests/unit-tests/T010netsnmp_string_time_to_secs_clib.c
--- net-snmp-5.8/testing/fulltests/unit-tests/T010netsnmp_string_time_to_secs_clib.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/unit-tests/T010netsnmp_string_time_to_secs_clib.c	2021-05-26 05:19:35.000000000 +0700
@@ -1,4 +1,7 @@
 /* HEADER Testing the netsnmp_string_time_to_secs API */
+
+#ifndef NETSNMP_FEATURE_REMOVE_STRING_TIME_TO_SECS
+
 int secs;
 
 #define TESTIT(x,y) \
@@ -42,4 +45,4 @@ TESTIT("1234D", 1234 * 60 * 60 * 24);
 TESTIT("1234w", 1234 * 60 * 60 * 24 * 7);
 TESTIT("1234W", 1234 * 60 * 60 * 24 * 7);
 
-
+#endif
diff -urpN net-snmp-5.8/testing/fulltests/unit-tests/T014gethostbyaddr_clib.c net-snmp-5.9.1/testing/fulltests/unit-tests/T014gethostbyaddr_clib.c
--- net-snmp-5.8/testing/fulltests/unit-tests/T014gethostbyaddr_clib.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/unit-tests/T014gethostbyaddr_clib.c	2021-05-26 05:19:35.000000000 +0700
@@ -39,7 +39,7 @@ SOCK_STARTUP;
 
 {
     struct hostent *h;
-#ifdef cygwin
+#if defined(cygwin) || defined(solaris2)
     static const struct in6_addr v6loop = { { IN6ADDR_LOOPBACK_INIT } };
 #else
     static const struct in6_addr v6loop = IN6ADDR_LOOPBACK_INIT;
diff -urpN net-snmp-5.8/testing/fulltests/unit-tests/T016read_config_clib.c net-snmp-5.9.1/testing/fulltests/unit-tests/T016read_config_clib.c
--- net-snmp-5.8/testing/fulltests/unit-tests/T016read_config_clib.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/unit-tests/T016read_config_clib.c	2021-05-26 05:19:35.000000000 +0700
@@ -61,7 +61,7 @@ for (i = 0; i < sizeof(test_input) / siz
             ("test %d: expected length %" NETSNMP_PRIz "d, got length %"
              NETSNMP_PRIz "d", i, p->expected_len, len));
         if (len == p->expected_len) {
-            ok = len < 0 || !p->expected_output
+            ok = !p->expected_output
                 || memcmp(str, p->expected_output, len) == 0
                 || p->expected_output[len] != 0;
             OKF(ok, ("test %d: output buffer mismatch", i));
diff -urpN net-snmp-5.8/testing/fulltests/unit-tests/T018read_config_capp.c net-snmp-5.9.1/testing/fulltests/unit-tests/T018read_config_capp.c
--- net-snmp-5.8/testing/fulltests/unit-tests/T018read_config_capp.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/unit-tests/T018read_config_capp.c	2021-05-26 05:19:35.000000000 +0700
@@ -15,6 +15,8 @@
 #include <net-snmp/agent/net-snmp-agent-includes.h>
 #include <net-snmp/library/testing.h>
 
+#ifndef NETSNMP_FEATURE_REMOVE_UNREGISTER_APP_CONFIG_HANDLER
+
 /* #undef TEST_INTERNAL_API */
 #define TEST_INTERNAL_API 1
 
@@ -127,3 +129,13 @@ int test3(void) {
     return 0;
 #endif
 }
+
+#else
+int main(int argc, char *argv[])
+{
+    OK(1, "skipped test");
+    if (__did_plan == 0)
+       PLAN(__test_counter);
+    return 0;
+}
+#endif
diff -urpN net-snmp-5.8/testing/fulltests/unit-tests/T022netsnmp_parse_ep_str_clib.c net-snmp-5.9.1/testing/fulltests/unit-tests/T022netsnmp_parse_ep_str_clib.c
--- net-snmp-5.8/testing/fulltests/unit-tests/T022netsnmp_parse_ep_str_clib.c	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/unit-tests/T022netsnmp_parse_ep_str_clib.c	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,59 @@
+/*
+ * HEADER Testing netsnmp_parse_ep_str()
+ */
+
+struct one_test_data {
+    const char *in;
+    int res;
+    struct netsnmp_ep_str expected;
+};
+
+static struct one_test_data test_data[] = {
+    { "9999",              1, { "",         "",   "9999" } },
+    { ":777",              1, { "",         "",   "777"  } },
+    { "hostname:777",      1, { "hostname", "",   "777"  } },
+    { "hostname",          1, { "hostname", "",   ""     } },
+    { "1.2.3.4",           1, { "1.2.3.4",  "",   ""     } },
+    { "hostname@if",       1, { "hostname", "if", ""     } },
+    { "hostname@if:833",   1, { "hostname", "if", "833"  } },
+    { "[hostname]@if:833", 1, { "hostname", "if", "833"  } },
+    { "[hostname]?",       0, {                          } },
+    { "[hostname",         0, {                          } },
+    { "@if:844",           1, { "",         "if", "844"  } },
+    { "::1",               1, { "::1",      "",   ""     } },
+    { "::1@if",            1, { "::1",      "if", ""     } },
+    { "1::2",              1, { "1::2",     "",   ""     } },
+    { "[::1]",             1, { "::1",      "",   ""     } },
+    { "[::1]:0",           1, { "::1",      "",   "0"    } },
+    { "[::1]:2",           1, { "::1",      "",   "2"    } },
+    { "[::1]@if:2",        1, { "::1",      "if", "2"    } },
+    { "[::1]:2@if",        0, {                          } },
+};
+
+SOCK_STARTUP;
+
+{
+    int i;
+
+    for (i = 0; i < sizeof(test_data) / sizeof(test_data[0]); i++) {
+        const struct one_test_data *p = &test_data[i];
+        struct netsnmp_ep_str ep_str;
+        int res;
+
+        memset(&ep_str, 0, sizeof(ep_str));
+        res = netsnmp_parse_ep_str(&ep_str, p->in);
+        OKF(res == p->res, ("%s: return value %d <> %d", p->in, res, p->res));
+        if (res && p->res) {
+            OKF(strcmp(ep_str.addr,  p->expected.addr)  == 0,
+                ("%s: network address %s <> %s", p->in, ep_str.addr,
+                 p->expected.addr));
+            OKF(strcmp(ep_str.iface, p->expected.iface) == 0,
+                ("%s: network interface %s <> %s", p->in, ep_str.iface,
+                 p->expected.iface));
+            OKF(strcmp(ep_str.port, p->expected.port) == 0,
+                ("%s: port %s <> %s", p->in, ep_str.port, p->expected.port));
+        }
+    }
+}
+
+SOCK_CLEANUP;
diff -urpN net-snmp-5.8/testing/fulltests/unit-tests/T023varbind_set_var_value_int8_clib.c net-snmp-5.9.1/testing/fulltests/unit-tests/T023varbind_set_var_value_int8_clib.c
--- net-snmp-5.8/testing/fulltests/unit-tests/T023varbind_set_var_value_int8_clib.c	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/unit-tests/T023varbind_set_var_value_int8_clib.c	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,24 @@
+/* HEADER Testing snmp_set_var_value() */
+
+{
+    static const signed char values[] = { -128, -23, -1, 1, 42, 127, 0 };
+    int i;
+
+    for (i = 0; values[i]; i++) {
+        netsnmp_variable_list variable;
+        int ec;
+
+        memset(&variable, 0, sizeof(variable));
+        variable.next_variable = NULL;
+        variable.type = ASN_INTEGER;
+        variable.val.string = NULL;
+        variable.val.integer = NULL;
+        variable.val_len = 0;
+
+        ec = snmp_set_var_value( &variable, &values[i], 1);
+
+        OK(ec == 0, "snmp_set_var_value() should succeed");
+        OKF(*variable.val.integer == values[i],
+            ("%ld =?= %d", *variable.val.integer, values[i]));
+    }
+}
diff -urpN net-snmp-5.8/testing/fulltests/unit-tests/T024run_exec_command_clib.c net-snmp-5.9.1/testing/fulltests/unit-tests/T024run_exec_command_clib.c
--- net-snmp-5.8/testing/fulltests/unit-tests/T024run_exec_command_clib.c	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/unit-tests/T024run_exec_command_clib.c	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,48 @@
+/*
+ * HEADER Testing run_exec_command()
+ */
+
+struct test_data {
+    const char *command;
+    const char *input;
+    const char *expected_output;
+    int res;
+};
+
+static struct test_data test_data[] = {
+    { "/bin/sh -c 'echo a'", NULL, "a\n", 0 },
+    { "/bin/sh -c 'echo a  b'", NULL, "a b\n", 0 },
+    { "/bin/sh -c 'echo $*' . 0  1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99",
+      NULL,
+      "0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99\n",
+      0 },
+    { "/bin/cat", "b  c\n", "b  c\n", 0 },
+    { "/bin/sh -c 'false'", NULL, NULL, 1 },
+    { "/bin/sh -c 'exit 77'", NULL, NULL, 77 },
+};
+
+#if 0
+snmp_set_do_debugging(TRUE);
+debug_register_tokens("run:exec");
+#endif
+
+{
+    char output[512];
+    int output_len;
+    int i;
+
+    for (i = 0; i < sizeof(test_data) / sizeof(test_data[0]); i++) {
+        const struct test_data *p = &test_data[i];
+        int res;
+
+        output_len = sizeof(output);
+        res = run_exec_command(p->command, p->input, output, &output_len);
+        OKF(res == p->res, ("%s: return value %d <> %d", p->command, res,
+                            p->res));
+        if (res == p->res && p->expected_output) {
+            OKF(strcmp(output, p->expected_output) == 0,
+                ("%s: output %s <> %s", p->command, output,
+                 p->expected_output));
+        }
+    }
+}
diff -urpN net-snmp-5.8/testing/fulltests/unit-tests/T102pdu_build_clib.c net-snmp-5.9.1/testing/fulltests/unit-tests/T102pdu_build_clib.c
--- net-snmp-5.8/testing/fulltests/unit-tests/T102pdu_build_clib.c	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/unit-tests/T102pdu_build_clib.c	2021-05-26 05:19:35.000000000 +0700
@@ -10,7 +10,13 @@ int rc;
 
 init_snmp("testing");
 snmp_sess_init(&session);
+#if !defined(NETSNMP_DISABLE_SNMPV2C)
 session.version = SNMP_VERSION_2c;
+#elif !defined(NETSNMP_DISABLE_SNMPV1)
+session.version = SNMP_VERSION_1;
+#else
+#error This test does not (yet?) support SNMPv3
+#endif
 session.peername = strdup("udp:127.0.0.1"); /* we won't actually connect */
 session.community = (u_char *) strdup("bogus");
 session.community_len = strlen((char *) session.community);
diff -urpN net-snmp-5.8/testing/fulltests/unit-tests/T104agentx_parse_cagentlib.c net-snmp-5.9.1/testing/fulltests/unit-tests/T104agentx_parse_cagentlib.c
--- net-snmp-5.8/testing/fulltests/unit-tests/T104agentx_parse_cagentlib.c	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/unit-tests/T104agentx_parse_cagentlib.c	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,30 @@
+/* HEADER oss-fuzz bug 14502 */
+/*
+ * Verify whether agentx_parse() does not access any memory outside its
+ * bounds for a particular invalid AgentX input. See also
+ * https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=14502.
+ */
+
+netsnmp_session session;
+netsnmp_pdu pdu;
+int rc;
+static u_char data[] = {
+    0x20, 0x08, 0x20, 0x20, 0x20, 0x20, 0xff, 0x20,
+    0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20,
+    0x14, 0x00, 0x00, 0x00, 0x44, 0x00, 0x20, 0x20,
+    0x00, 0x20, 0x20, 0xff, 0xff, 0xff, 0xff, 0xff,
+    0xff, 0x20, 0x20, 0x20, 0x20, 0x20, 0xff, 0x20,
+};
+static const size_t data_length = sizeof(data);
+
+memset(&session, 0, sizeof(session));
+session.version = AGENTX_VERSION_1;
+
+memset(&pdu, 0, sizeof(pdu));
+
+rc = agentx_parse(&session, &pdu, data, data_length);
+
+fprintf(stderr, "rc = %d\n", rc);
+fflush(stderr);
+
+OKF(rc != 0, ("Parsing of AgentX data failed"));
diff -urpN net-snmp-5.8/testing/fulltests/unit-tests/T105trap_parse_clib.c net-snmp-5.9.1/testing/fulltests/unit-tests/T105trap_parse_clib.c
--- net-snmp-5.8/testing/fulltests/unit-tests/T105trap_parse_clib.c	1970-01-01 07:00:00.000000000 +0700
+++ net-snmp-5.9.1/testing/fulltests/unit-tests/T105trap_parse_clib.c	2021-05-26 05:19:35.000000000 +0700
@@ -0,0 +1,41 @@
+/* HEADER Parsing of an SNMP trap with no varbinds */
+netsnmp_pdu pdu;
+int rc;
+static u_char trap_pdu[] = {
+    /* Sequence with length of 0x2d = 45 bytes. */
+    [ 0] = 0x30, [ 1] = 0x82, [ 2] = 0x00, [ 3] = 0x2d,
+    /* version = INTEGER 0 */
+    [ 4] = 0x02, [ 5] = 0x01, [ 6] = 0x00,
+    /* community = public (OCTET STRING 0x70 0x75 0x62 0x6c 0x69 0x63) */
+    [ 7] = 0x04, [ 8] = 0x06, [ 9] = 0x70, [10] = 0x75,
+    [11] = 0x62, [12] = 0x6c, [13] = 0x69, [14] = 0x63,
+    /* SNMP_MSG_TRAP; 32 bytes. */
+    [15] = 0xa4, [16] = 0x20,
+    /* enterprise = OBJECT IDENTIFIER .1.3.6.1.6.3.1.1.5 = snmpTraps */
+    [17] = 0x06, [18] = 0x08,
+    [19] = 0x2b, [20] = 0x06, [21] = 0x01, [22] = 0x06,
+    [23] = 0x03, [24] = 0x01, [25] = 0x01, [26] = 0x05,
+    /* agent-addr = ASN_IPADDRESS 192.168.1.34 */
+    [27] = 0x40, [28] = 0x04, [29] = 0xc0, [30] = 0xa8,
+    [31] = 0x01, [32] = 0x22,
+    /* generic-trap = INTEGER 0 */
+    [33] = 0x02, [34] = 0x01, [35] = 0x00,
+    /* specific-trap = INTEGER 0 */
+    [36] = 0x02, [37] = 0x01, [38] = 0x00,
+    /* ASN_TIMETICKS 0x117f243a */
+    [39] = 0x43, [40] = 0x04, [41] = 0x11, [42] = 0x7f,
+    [43] = 0x24, [44] = 0x3a,
+    /* varbind list */
+    [45] = 0x30, [46] = 0x82, [47] = 0x00, [48] = 0x00,
+};
+static size_t trap_pdu_length = sizeof(trap_pdu);
+netsnmp_session session;
+
+snmp_set_do_debugging(TRUE);
+debug_register_tokens("dumpv_recv,dumpv_send,asn,recv");
+memset(&session, 0, sizeof(session));
+snmp_sess_init(&session);
+memset(&pdu, 0, sizeof(pdu));
+rc = snmp_parse(NULL, &session, &pdu, trap_pdu, trap_pdu_length);
+
+OKF((rc == 0), ("Parsing of a trap PDU"));
diff -urpN net-snmp-5.8/win32/Configure net-snmp-5.9.1/win32/Configure
--- net-snmp-5.8/win32/Configure	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/Configure	2021-05-26 05:19:35.000000000 +0700
@@ -4,14 +4,16 @@
 # Written by Alex Burger
 # March 5th, 2004
 #
-use Getopt::Long;
 use strict;
 use warnings;
+use ExtUtils::Embed;
+use Getopt::Long;
 
 my $version = "unknown";
 my $config;
 my $sdk = 0;
 my $linktype;
+my $blumenthal_aes;
 my $prefix;
 my $prefixdos;
 my $openssl = 0;
@@ -25,6 +27,7 @@ GetOptions      ('config=s' => \$config,
                  'with-sdk' => \$sdk,
                  'linktype=s' => \$linktype,
                  'destdir=s' => \$prefix,
+                 'enable-blumenthal-aes' => \$blumenthal_aes,
                  'prefix=s' => \$prefix,
                  'with-ssl' => \$openssl,
                  'with-sslincdir=s' => \$opensslincdir,
@@ -46,6 +49,7 @@ Options:
     --linktype=[static | dynamic]    Build static or dynamic (DLL)
     --prefix=\"path\"                  Set INSTALL_BASE path (install path)
     --destdir=\"path\"                 Same as --prefix
+    --enable-blumenthal-aes          Enable Blumenthal AES support
     --with-ssl                       Link against OpenSSL
     --with-sslincdir=\"path\"          OpenSSL include path
     --with-ssllibdir=\"path\"          OpenSSL library path
@@ -173,6 +177,21 @@ foreach my $app (@apps) {
     push @apps_clean, $app . "_clean";
 }
 
+my $perl_define =
+    "/D NETSNMP_REMOVE_U64 " .
+    "/D VC_EXTRALEAN " .
+    "/D WIN32 " .
+    "/D _CONSOLE " .
+    "/D _CRT_NONSTDC_NO_WARNINGS " .
+    "/D _CRT_SECURE_NO_WARNINGS " .
+    "/D _MBCS " .
+    "/D _WIN32_WINNT=0xffff " .
+    "/D _WINSOCK_DEPRECATED_NO_WARNINGS";
+
+my $perl_inc = $opensslincdir ? "/I $opensslincdir" : "";
+
+my $perl_cflags = ExtUtils::Embed::ccopts();
+
 my %makefile_subs = (
     "app" => [ "^APPS=",       "APPS=" . join(" ", @apps)	    ],
     "apc" => [ "^APPS_CLEAN=", "APPS_CLEAN=" . join(" ", @apps_clean)],
@@ -184,26 +203,22 @@ my %makefile_subs = (
     "dos" => [ "^PREFIX_DOS=", "PREFIX_DOS=$prefixdos"              ],
     "ssl" => [ "^OPENSSL=",    $openssl ? "OPENSSL=true" : "OPENSSL=false" ],
     "sdk" => [ "^SDK=",        $sdk == 1 ? "SDK=true" : "SDK=false" ],
-    "cfl" => [ "^CFLAGS=",     "CFLAGS=" .
-                               "/D WIN32 " .
-                               "/D _BIND_TO_CURRENT_VCLIBS_VERSION " .
-                               "/D _CONSOLE " .
-                               "/D _CRT_NONSTDC_NO_WARNINGS " .
-                               "/D _CRT_SECURE_NO_WARNINGS " .
-                               "/D _MBCS " .
-                               "/D _WINSOCK_DEPRECATED_NO_WARNINGS " .
+    "pin" => [ "^PERL_DEFINE=","PERL_DEFINE=$perl_define"           ],
+    "pdf" => [ "^PERL_INC=",   "PERL_INC=$perl_inc"                 ],
+    "pcf" => [ "^PERL_CFLAGS=","PERL_CFLAGS=$perl_cflags"           ],
+    "cfl" => [ "^CFLAGS=",     "CFLAGS=$perl_define " .
+                               "/D WIN32_LEAN_AND_MEAN " .
                                "/EHsc " .
                                "/FD " .
                                "/FR\$(INTDIR)\\ " .
                                "/Fd\$(INTDIR)\\\$(PROGNAME).pdb " .
                                "/Fo\$(INTDIR)\\ " .
-                               ($opensslincdir ? "/I $opensslincdir " : "") .
+                               "$perl_inc " .
+                               "$perl_cflags " .
                                "/c " .
                                "/W3 " .
                                "/Zi " .
                                "/nologo " .
-                               "/wd4244 " .
-                               "/wd4267 " .
                ($config eq "release" ?
                 "/MD  /D NDEBUG /O2 " :
                 "/MDd /D _DEBUG /Od /Gm ")
@@ -211,7 +226,8 @@ my %makefile_subs = (
     "lfl" => [ "^LDFLAGS=",    "LDFLAGS=" .
                                ($config eq "debug" ? "/debug " : "") .
                                ($openssllibdir ? "/libpath:$openssllibdir" :
-                                "")
+                                "") . " " .
+                               "/MANIFEST:EMBED"
              ],
     "rsc" => [ "^RSCFLAGS=",   "RSCFLAGS=/l 0x409 " .
                                ($config eq "release" ? "/d NDEBUG" :
@@ -259,6 +275,9 @@ if ($openssl == 1) {
 } else {
     $net_snmp_config_subs{"ssl"} = [ "^.*#undef NETSNMP_USE_INTERNAL_MD5.*", "#define NETSNMP_USE_INTERNAL_MD5 1" ];
 }
+if ($blumenthal_aes) {
+    $net_snmp_config_subs{"baes"} = [ "^.*#undef NETSNMP_DRAFT_BLUMENTHAL_AES_04.*", "#define NETSNMP_DRAFT_BLUMENTHAL_AES_04 1" ];
+}
 if ($b_ipv6 == 1) {
     $net_snmp_config_subs{"ipv6"} = [ "^.*#undef NETSNMP_ENABLE_IPV6.*", "#define NETSNMP_ENABLE_IPV6 1" ];
 }
@@ -286,6 +305,7 @@ print "  SDK:                        " .
 print "  Link type:                  $linktype\n";
 print "  Prefix / Destdir:           " . ($prefix ne "" ? $prefix : "(default)") . "\n";
 print "  OpenSSL:                    " . ($openssl == 1 ? "enabled" : "disabled") . "\n";
+print "  Blumenthal AES:             " . ($blumenthal_aes ? "enabled" : "disabled") . "\n";
 print "  IPv6 transport:             " . ($b_ipv6 == 1 ? "enabled" : "disabled") . "\n";
 print "  winExtDLL agent:            " . ($b_winextdll == 1 ? "enabled" : "disabled") . "\n";
 
diff -urpN net-snmp-5.8/win32/Makefile-apps.in net-snmp-5.9.1/win32/Makefile-apps.in
--- net-snmp-5.8/win32/Makefile-apps.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/Makefile-apps.in	2021-05-26 05:19:35.000000000 +0700
@@ -47,9 +47,6 @@ LINK32_OBJS= \
 "..\bin\$(OUTDIR)\$(PROGNAME).exe" : "..\bin\$(OUTDIR)" $(DEF_FILE) $(LINK32_OBJS)
 !IF "$(LINKTYPE)" == "static" || "$(ALLOW_DLL)" == "1"
     $(LINK32) $(LINK32_FLAGS) $(LINK32_OBJS)
-
- if exist "..\bin\$(OUTDIR)\$(PROGNAME).exe.manifest" \
-	    mt.exe -manifest "..\bin\$(OUTDIR)\$(PROGNAME).exe.manifest" -outputresource:"..\bin\$(OUTDIR)\$(PROGNAME).exe";1
 !ELSE	# Linktype check
 	-@echo .
 	-@echo Aborting build.  Applications can not be built using --linktype=dynamic
diff -urpN net-snmp-5.8/win32/Makefile.in net-snmp-5.9.1/win32/Makefile.in
--- net-snmp-5.8/win32/Makefile.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/Makefile.in	2021-05-26 05:19:35.000000000 +0700
@@ -3,11 +3,17 @@ LINKTYPE=
 CFG=
 PREFIX=
 PREFIX_DOS=
+PERL_DEFINE=
+PERL_INC=
+PERL_CFLAGS=
 PERL=
 NMAKE=nmake /nologo
 APPS=
 APPS_CLEAN=
 
+# To make it possible for the Perl tests to find netsnmp.dll.
+PATH=$(MAKEDIR)\bin\$(CFG);$(PATH)
+
 all : libs apps snmptrapd snmpd local
 
 clean : apps_clean libs_clean snmptrapd_clean snmpd_clean local_clean
@@ -61,10 +67,12 @@ perl :
 	-@echo .
 !ENDIF	# dynamic/static check
 	cd ..\perl
+	REM For MakefileSubs.pm
+	set PERL5LIB=$(MAKEDIR)\..\perl
 !IF "$(CFG)" == "release"
-	perl Makefile.PL CAPI=TRUE -NET-SNMP-IN-SOURCE=TRUE
+	perl Makefile.PL CAPI=TRUE -NET-SNMP-IN-SOURCE=TRUE -NET-SNMP-CONFIG=do-not-use-net-snmp-config -NET-SNMP-DEFINE="$(PERL_DEFINE)" -NET-SNMP-INC="$(PERL_INC)" -NET-SNMP-CFLAGS="$(PERL_CFLAGS)" -NET-SNMP-PATH="$(PREFIX)"
 !ELSE	# release/debug check
-	perl Makefile.PL CAPI=TRUE -NET-SNMP-IN-SOURCE=TRUE -NET-SNMP-DEBUG=TRUE
+	perl Makefile.PL CAPI=TRUE -NET-SNMP-IN-SOURCE=TRUE -NET-SNMP-CONFIG=do-not-use-net-snmp-config -NET-SNMP-DEFINE="$(PERL_DEFINE)" -NET-SNMP-INC="$(PERL_INC)" -NET-SNMP-CFLAGS="$(PERL_CFLAGS)" -NET-SNMP-PATH="$(PREFIX)" -NET-SNMP-DEBUG=TRUE
 !ENDIF	# release/debug check
 	$(NMAKE)
 	cd ..\win32
@@ -76,7 +84,9 @@ perl_test :
 	-@echo Perl modules must be build against dynamic (DLL) libraries
 	-@echo .
 !ELSE	# dynamic/static check
+	cpan Win32::Process <NUL
 	cd ..\perl
+	REM set PERL5LIB=$(MAKEDIR)\..\perl;$(MAKEDIR)\..\perl\SNMP
 	$(NMAKE) test
 	cd ..\win32
 !ENDIF	# dynamic/static check
diff -urpN net-snmp-5.8/win32/build.pl net-snmp-5.9.1/win32/build.pl
--- net-snmp-5.8/win32/build.pl	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/build.pl	2021-05-26 05:19:35.000000000 +0700
@@ -153,7 +153,7 @@ if ($perl && $perl_arch[1] ne $target_ar
 }
 
 my $linktype = $link_dynamic ? "dynamic" : "static";
-$configOpts = (($openssl ? "--with-ssl" : "")		. " " .
+$configOpts = (($openssl ? "--with-ssl --enable-blumenthal-aes" : "")	 . " " .
                ($opensslincdir ? "--with-sslincdir=$opensslincdir" : "") . " " .
                ($openssllibdir ? "--with-ssllibdir=$openssllibdir" : "") . " " .
                ($sdk ? "--with-sdk" : "")		. " " .
diff -urpN net-snmp-5.8/win32/config.h.borland net-snmp-5.9.1/win32/config.h.borland
--- net-snmp-5.8/win32/config.h.borland	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/config.h.borland	1970-01-01 07:00:00.000000000 +0700
@@ -1,772 +0,0 @@
-/* config.h:  a general config file */
-
-/* Define IN_UCD_SNMP_SOURCE if compiling inside the ucd-snmp source tree */
-#define IN_UCD_SNMP_SOURCE 1
-
-/* UC-Davis' IANA-assigned enterprise number is 2021 */
-#define ENTERPRISE_NUMBER 2021
-
-/* don't change these values! */
-#define NETSNMP_SNMPV1      0xAAAA       /* readable by anyone */
-#define NETSNMP_SNMPV2ANY   0xA000       /* V2 Any type (includes NoAuth) */
-#define NETSNMP_SNMPV2AUTH  0x8000       /* V2 Authenticated requests only */
-
-/* default list of mibs to load */
-#define NETSNMP_DEFAULT_MIBS "IP-MIB;IF-MIB;TCP-MIB;UDP-MIB;SNMPv2-MIB;RFC1213-MIB;UCD-SNMP-MIB;UCD-DEMO-MIB;SNMP-TARGET-MIB;SNMP-VIEW-BASED-ACM-MIB;SNMP-COMMUNITY-MIB;UCD-DLMOD-MIB;SNMP-FRAMEWORK-MIB;SNMP-MPD-MIB;SNMP-USER-BASED-SM-MIB;SNMP-NOTIFICATION-MIB;SNMPv2-TM"
-
-/* default location to look for mibs to load using the above tokens
-   and/or those in the MIBS envrionment variable*/
-
-#define NETSNMP_DEFAULT_MIBDIRS "/USR/MIBS"
-
-/* default mib files to load, specified by path. */
-
-#undef NETSNMP_DEFAULT_MIBFILES
-
-/* should we compile to use special opaque types: float, double,
-   counter64, i64, ui64, union? */
-#define NETSNMP_WITH_OPAQUE_SPECIAL_TYPES 1
-
-/* comment the next line if you are compiling with libsnmp.h
-   and are not using the UC-Davis SNMP library. */
-#define UCD_SNMP_LIBRARY 1
-
-/* define if you want to compile support for both authentication and
-   privacy support. */
-#define NETSNMP_ENABLE_SCAPI_AUTHPRIV 1
-
-/* define if you are using the internal MD5 code */
-#define NETSNMP_USE_INTERNAL_MD5 1
-
-/* add in recent CMU library extensions (not complete) */
-#define CMU_COMPATIBLE 1
-
-/* should "--" comments in mibs be a comment till the end of the line
-   or also until another "--", the latter being the technically
-   correct. */
-#undef MIB_COMMENT_IS_EOL_TERMINATED
-
-/* debugging stuff */
-#undef NETSNMP_NO_DEBUGGING           /* if defined, we optimize the code
-                                      to exclude all debugging calls. */
-#define NETSNMP_ALWAYS_DEBUG 0        /* Always print debugging information and
-                                      ignore the -D flag passed to the cmds */
-
-/* Define if using alloca.c.  */
-#undef C_ALLOCA
-
-/* Define to one of _getb67, GETB67, getb67 for Cray-2 and Cray-YMP systems.
-   This function is required for alloca.c support on those systems.  */
-#undef CRAY_STACKSEG_END
-
-/* Define if you have alloca, as a function or macro.  */
-#undef HAVE_ALLOCA
-
-/* Define if you have <alloca.h> and it should be used (not on Ultrix).  */
-#undef HAVE_ALLOCA_H
-
-/* Define if you have the getmntent function.  */
-#undef HAVE_GETMNTENT
-
-/* Define if you have <sys/wait.h> that is POSIX.1 compatible.  */
-#undef HAVE_SYS_WAIT_H
-
-/* Define to `long' if <sys/types.h> doesn't define.  */
-#undef off_t
-
-/* Define to `int' if <sys/types.h> doesn't define.  */
-#undef pid_t
-
-/* Define as the return type of signal handlers (int or void).  */
-#define RETSIGTYPE void
-
-/* Define if you have raise() instead of alarm() */
-
-#define HAVE_RAISE 1
-
-/* If using the C implementation of alloca, define if you know the
-   direction of stack growth for your system; otherwise it will be
-   automatically deduced at run-time.
- STACK_DIRECTION > 0 => grows toward higher addresses
- STACK_DIRECTION < 0 => grows toward lower addresses
- STACK_DIRECTION = 0 => direction of growth unknown
- */
-#undef STACK_DIRECTION
-
-/* Define if you have the ANSI C header files.  */
-#define STDC_HEADERS 1
-
-/* Define if you can safely include both <sys/time.h> and <time.h>.  */
-#define TIME_WITH_SYS_TIME 1
-
-/* Define if you have the gettimeofday function.  */
-#undef HAVE_GETTIMEOFDAY
-
-/* Define if you have the <sys/time.h> header file.  */
-#undef HAVE_SYS_TIME_H
-
-/* Define if your processor stores words with the most significant
-   byte first (like Motorola and SPARC, unlike Intel and VAX).  */
-#undef WORDS_BIGENDIAN
-
-#define SNMPDLMODPATH "/USR/LIB/DLMOD"
-#define SNMPLIBPATH "/USR/LIB"
-#define SNMPSHAREPATH "/USR/SHARE/SNMP"
-#define SNMPCONFPATH "/USR"
-
-/* SNMPPATH contains (more) important files */
-
-#undef SNMPPATH
-
-/* NETSNMP_LOGFILE:  If defined it closes stdout/err/in and opens this in out/err's
-   place.  (stdin is closed so that sh scripts won't wait for it) */
-
-#undef NETSNMP_LOGFILE
-
-/* NETSNMP_PERSISTENT_DIRECTORY: If defined, the library is capabile of saving
-   persisant information to this directory in the form of configuration
-   lines: NETSNMP_PERSISTENT_DIRECTORY/NAME.persistent.conf */
-#define NETSNMP_PERSISTENT_DIRECTORY "/USR/SNMP/PERSIST"
-
-#define NETSNMP_MAX_PERSISTENT_BACKUPS 10
-/* default system contact */
-#define NETSNMP_SYS_CONTACT "unknown"
-
-/* system location */
-#define NETSNMP_SYS_LOC "unknown"
-
-/* location of UNIX kernel */
-#define KERNEL_LOC "unknown"
-
-/* location of mount table list */
-#define ETC_MNTTAB "unknown"
-
-/* location of swap device (ok if not found) */
-#undef DMEM_LOC
-
-/* define rtentry to ortentry on SYSV machines (alphas) */
-#define RTENTRY rtentry;
-
-/* Use BSD 4.4 routing table entries? */
-#undef RTENTRY_4_4
-
-/* Does the rtentry structure have a rt_next node */
-#undef RTENTRY_RT_NEXT
-
-#define PSCMD "/bin/ps"
-
-/* Where is the uname command */
-#define UNAMEPROG "/bin/uname"
-
-/* testing code sections. */
-/* #undef NETSNMP_ENABLE_TESTING_CODE */
-
-/* If you don't have root access don't exit upon kmem errors */
-#undef NETSNMP_NO_ROOT_ACCESS
-
-/* Define if you have the gethostbyname function.  */
-#define HAVE_GETHOSTBYNAME 1
-
-/* Define if you have the gethostname function.  */
-#define HAVE_GETHOSTNAME 1
-
-/* Define if you have the getloadavg function.  */
-#undef HAVE_GETLOADAVG
-
-/* Define if you have the setenv function.  */
-#undef HAVE_SETENV
-
-/* Define if you have the strtoul function.  */
-#define HAVE_STRTOUL 1
-
-/* Define if you have the vsnprintf function.  */
-#define HAVE_VSNPRINTF 1
-
-/* Define if you have the kvm_openfiles function.  */
-#undef HAVE_KVM_OPENFILES
-
-/* Define if you have the lrand48 function.  */
-#undef HAVE_LRAND48
-
-/* Define if you have the rand function.  */
-#define HAVE_RAND 1
-
-/* Define if you have the random function.  */
-#undef HAVE_RANDOM
-
-/* Define if you have the select function.  */
-#undef HAVE_SELECT
-
-/* Define if you have the setmntent function.  */
-#undef HAVE_SETMNTENT
-
-/* Define if you have the sigblock function.  */
-#undef HAVE_SIGBLOCK
-
-/* Define if you have the sighold function.  */
-#undef HAVE_SIGHOLD
-
-/* Define if you have the signal function.  */
-#undef HAVE_SIGNAL
-
-/* Define if you have the sigset function.  */
-#undef HAVE_SIGSET
-
-/* Define if you have the socket function.  */
-#define HAVE_SOCKET 1
-
-/* Define if you have <winsock.h> header file. */
-#define HAVE_WINSOCK_H 1
-
-/* Define if you have the closesocket function.  */
-#define HAVE_CLOSESOCKET 1
-
-/* Define if you have the statfs function.  */
-#undef HAVE_STATFS
-
-/* Define if you have the statvfs function.  */
-#undef HAVE_STATVFS
-
-/* Define if you have the strcasecmp function */
-#define HAVE_STRCASECMP 1
-
-/* Define if you have the snprintf function */
-#define HAVE_SNPRINTF 1
-
-/* use win32 strdup */
-#define strdup _strdup
-
-/* Define if you have the strtol function.  */
-#define HAVE_STRTOL 1
-
-/* Define if you have the tcgetattr function.  */
-/* #define HAVE_TCGETATTR 1 */
-
-/* Define if you have the uname function.  */
-#undef HAVE_UNAME
-
-/* Define if you have <io.h> header file. */
-#define HAVE_IO_H 1
-
-/* Define if you have <process.h> header file. (Win32-getpid) */
-#define HAVE_PROCESS_H 1
-
-/* Define if you have the <arpa/inet.h> header file.  */
-#undef HAVE_ARPA_INET_H
-
-/* Define if you have the <dirent.h> header file.  */
-#undef HAVE_DIRENT_H
-
-/* Define if you have the <err.h> header file.  */
-#undef HAVE_ERR_H
-
-/* Define if you have the <fcntl.h> header file.  */
-#define HAVE_FCNTL_H 1
-
-/* Define if you have the <fstab.h> header file.  */
-#undef HAVE_FSTAB_H
-
-/* Define if you have the <inet/mib2.h> header file.  */
-#undef HAVE_INET_MIB2_H
-
-/* Define if you have the <kstat.h> header file.  */
-#undef HAVE_KSTAT_H
-
-/* Define if you have the <kvm.h> header file.  */
-#undef HAVE_KVM_H
-
-/* Define if you have the <limits.h> header file.  */
-#define HAVE_LIMITS_H 1
-
-/* Define if you have the <machine/param.h> header file.  */
-#undef HAVE_MACHINE_PARAM_H
-
-/* Define if you have the <machine/pte.h> header file.  */
-#undef HAVE_MACHINE_PTE_H
-
-/* Define if you have the <malloc.h> header file.  */
-#undef HAVE_MALLOC_H
-
-/* Define if you have the <mntent.h> header file.  */
-#undef HAVE_MNTENT_H
-
-/* Define if you have the <mtab.h> header file.  */
-#undef HAVE_MTAB_H
-
-/* Define if you have the <ndir.h> header file.  */
-#undef HAVE_NDIR_H
-
-/* Define if you have the <net/if_dl.h> header file.  */
-#undef HAVE_NET_IF_DL_H
-
-/* Define if you have the <net/if_types.h> header file.  */
-#undef HAVE_NET_IF_TYPES_H
-
-/* Define if you have the <netinet/icmp_var.h> header file.  */
-#undef HAVE_NETINET_ICMP_VAR_H
-
-/* Define if you have the <netinet/if_ether.h> header file.  */
-#undef HAVE_NETINET_IF_ETHER_H
-
-/* Define if you have the <netinet/in.h> header file.  */
-#undef HAVE_NETINET_IN_H
-
-/* Define if you have the <netinet/in_pcb.h> header file.  */
-#undef HAVE_NETINET_IN_PCB_H
-
-/* Define if you have the <netinet/in_var.h> header file.  */
-#undef HAVE_NETINET_IN_VAR_H
-
-/* Define if you have the <netinet/ip_var.h> header file.  */
-#undef HAVE_NETINET_IP_VAR_H
-
-/* Define if you have the <netinet/tcp_fsm.h> header file.  */
-#undef HAVE_NETINET_TCP_FSM_H
-
-/* Define if you have the <netinet/tcp_timer.h> header file.  */
-#undef HAVE_NETINET_TCP_TIMER_H
-
-/* Define if you have the <netinet/tcp_var.h> header file.  */
-#undef HAVE_NETINET_TCP_VAR_H
-
-/* Define if you have the <netinet/tcpip.h> header file.  */
-#undef HAVE_NETINET_TCPIP_H
-
-/* Define if you have the <netinet/udp_var.h> header file.  */
-#undef HAVE_NETINET_UDP_VAR_H
-
-/* Define if you have the <sgtty.h> header file.  */
-#undef HAVE_SGTTY_H
-
-/* Define if you have the <stdarg.h> header file.  */
-#define HAVE_STDARG_H 1
-
-/* Define if you have the <stdlib.h> header file.  */
-#define HAVE_STDLIB_H 1
-
-/* Define if you have the <string.h> header file.  */
-#define HAVE_STRING_H 1
-
-/* Define if you have the <sys/conf.h> header file.  */
-#undef HAVE_SYS_CONF_H
-
-/* Define if you have the <sys/dir.h> header file.  */
-#undef HAVE_SYS_DIR_H
-
-/* Define if you have the <sys/dmap.h> header file.  */
-#undef HAVE_SYS_DMAP_H
-
-/* Define if you have the <sys/file.h> header file.  */
-#undef HAVE_SYS_FILE_H
-
-/* Define if you have the <sys/filio.h> header file.  */
-#undef HAVE_SYS_FILIO_H
-
-/* Define if you have the <sys/fixpoint.h> header file.  */
-#undef HAVE_SYS_FIXPOINT_H
-
-/* Define if you have the <sys/fs.h> header file.  */
-#undef HAVE_SYS_FS_H
-
-/* Define if you have the <sys/stat.h> header file.  */
-#define HAVE_SYS_STAT_H 1
-
-/* Define if you have the <sys/hashing.h> header file.  */
-#undef HAVE_SYS_HASHING_H
-
-/* Define if you have the <sys/ioctl.h> header file.  */
-#undef HAVE_SYS_IOCTL_H
-
-/* Define if you have the <sys/mbuf.h> header file.  */
-#undef HAVE_SYS_MBUF_H
-
-/* Define if you have the <sys/mnttab.h> header file.  */
-#undef HAVE_SYS_MNTTAB_H
-
-/* Define if you have the <sys/mount.h> header file.  */
-#undef HAVE_SYS_MOUNT_H
-
-/* Define if you have the <sys/ndir.h> header file.  */
-#undef HAVE_SYS_NDIR_H
-
-/* Define if you have the <sys/param.h> header file.  */
-#undef HAVE_SYS_PARAM_H
-
-/* Define if you have the <sys/proc.h> header file.  */
-#undef HAVE_SYS_PROC_H
-
-/* Define if you have the <sys/protosw.h> header file.  */
-#undef HAVE_SYS_PROTOSW_H
-
-/* Define if you have the <sys/select.h> header file.  */
-#undef HAVE_SYS_SELECT_H
-
-/* Define if you have the <sys/sockio.h> header file.  */
-#undef HAVE_SYS_SOCKIO_H
-
-/* Define if you have the <sys/statvfs.h> header file.  */
-#undef HAVE_SYS_STATVFS_H
-
-/* Define if you have the <sys/swap.h> header file.  */
-#undef HAVE_SYS_SWAP_H
-
-/* Define if you have the <sys/sysctl.h> header file.  */
-#undef HAVE_SYS_SYSCTL_H
-
-/* Define if you have the <sys/tcpipstats.h> header file.  */
-#undef HAVE_SYS_TCPIPSTATS_H
-
-/* Define if you have the <sys/user.h> header file.  */
-#undef HAVE_SYS_USER_H
-
-/* Define if you have the <sys/utsname.h> header file.  */
-#undef HAVE_SYS_UTSNAME_H
-
-/* Define if you have the <sys/vfs.h> header file.  */
-#undef HAVE_SYS_VFS_H
-
-/* Define if you have the <sys/vm.h> header file.  */
-#undef HAVE_SYS_VM_H
-
-/* Define if you have the <sys/vmmac.h> header file.  */
-#undef HAVE_SYS_VMMAC_H
-
-/* Define if you have the <sys/vmmeter.h> header file.  */
-#undef HAVE_SYS_VMMETER_H
-
-/* Define if you have the <sys/vmparam.h> header file.  */
-#undef HAVE_SYS_VMPARAM_H
-
-/* Define if you have the <sys/vmsystm.h> header file.  */
-#undef HAVE_SYS_VMSYSTM_H
-
-/* Define if you have the <syslog.h> header file.  */
-#undef HAVE_SYSLOG_H
-
-/* Define if you have the <ufs/ffs/fs.h> header file.  */
-#undef HAVE_UFS_FFS_FS_H
-
-/* Define if you have the <ufs/fs.h> header file.  */
-#undef HAVE_UFS_FS_H
-
-/* Define if you have the <ufs/ufs/dinode.h> header file.  */
-#undef HAVE_UFS_UFS_DINODE_H
-
-/* Define if you have the <unistd.h> header file.  */
-#undef HAVE_UNISTD_H
-
-/* Define if you have the <utsname.h> header file.  */
-#undef HAVE_UTSNAME_H
-
-/* Define if you have the <vm/swap_pager.h> header file.  */
-#undef HAVE_VM_SWAP_PAGER_H
-
-/* Define if you have the <vm/vm.h> header file.  */
-#undef HAVE_VM_VM_H
-
-/* Define if you have the <xti.h> header file.  */
-#undef HAVE_XTI_H
-
-/* Define if you have the crypto library (-lcrypto).  */
-#undef HAVE_LIBCRYPTO
-
-/* Define if you have the elf library (-lelf).  */
-#undef HAVE_LIBELF
-
-/* Define if you have the kstat library (-lkstat).  */
-#undef HAVE_LIBKSTAT
-
-/* Define if you have the m library (-lm).  */
-#undef HAVE_LIBM
-
-/* Define if you have the mld library (-lmld).  */
-#undef HAVE_LIBMLD
-
-/* Define if you have the nsl library (-lnsl).  */
-#undef HAVE_LIBNSL
-
-/* Define if you have the socket library (-lsocket).  */
-#undef HAVE_LIBSOCKET
-
-/* ifnet structure tests */
-#undef STRUCT_IFNET_HAS_IF_BAUDRATE
-#undef STRUCT_IFNET_HAS_IF_TYPE
-#undef STRUCT_IFNET_HAS_IF_IMCASTS
-#undef STRUCT_IFNET_HAS_IF_IQDROPS
-#undef STRUCT_IFNET_HAS_IF_LASTCHANGE_TV_SEC
-#undef STRUCT_IFNET_HAS_IF_NOPROTO
-#undef STRUCT_IFNET_HAS_IF_OMCASTS
-#undef STRUCT_IFNET_HAS_IF_XNAME
-#undef STRUCT_IFNET_HAS_IF_OBYTES
-#undef STRUCT_IFNET_HAS_IF_IBYTES
-#undef STRUCT_IFNET_HAS_IF_ADDRLIST
-
-/* tcpstat.tcps_rcvmemdrop */
-#undef STRUCT_TCPSTAT_HAS_TCPS_RCVMEMDROP
-
-/* udpstat.udps_discard */
-#undef STRUCT_UDPSTAT_HAS_UDPS_DISCARD
-
-/* arphd.at_next */
-#undef STRUCT_ARPHD_HAS_AT_NEXT
-
-/* ifaddr.ifa_next */
-#undef STRUCT_IFADDR_HAS_IFA_NEXT
-
-/* ifnet.if_mtu */
-#undef STRUCT_IFNET_HAS_IF_MTU
-
-/* ifnet needs to have _KERNEL defined */
-#undef IFNET_NEEDS_KERNEL
-
-/* sysctl works to get boottime, etc... */
-#undef NETSNMP_CAN_USE_SYSCTL
-
-/* type check for in_addr_t */
-#define in_addr_t u_long
-
-/* mib pointer to the top of the extensible tree.  This has been
- assigned to UCDavis by the iana group.  Optionally, point this to the
- location in the tree your company/organization has been allocated. */
-
-/* location of the extensible mib tree */
-#define EXTENSIBLEMIB 1,3,6,1,4,1,2021
-/* location of the extensible mib tree */
-#define EXTENSIBLEDOTMIB 1.3.6.1.4.1.2021
-/* count the above numbers */
-#define EXTENSIBLENUM 7
-
-/* the ErrorFlag is V1 accessable because HP Openview does not support
-   V2.  You can make this list of pairs as long as you want, just make
-   sure to end it in -1.*/
-
-#define SECURITYEXCEPTIONS {100,NETSNMP_SNMPV1,-1} /* the ErrorFlag is V1 */
-
-/* Mib-2 tree Info */
-/* These are the system information variables. */
-
-#define NETSNMP_VERS_DESC   "unknown"             /* overridden at run time */
-#define NETSNMP_SYS_NAME    "unknown"             /* overridden at run time */
-
-/* comment out the second define to turn off functionality for any of
-   these: (See README for details) */
-
-/*   proc PROCESSNAME [MAX] [MIN] */
-#define NETSNMP_PROCMIBNUM 2
-#define USEPROCMIB
-
-/*   exec/shell NAME COMMAND      */
-#define NETSNMP_SHELLMIBNUM 8
-#define USESHELLMIB
-
-/*   swap MIN                     */
-#define NETSNMP_MEMMIBNUM 4
-#if defined(hpux9) || defined(bsdi2)
-#define USEMEMMIB
-#endif
-
-/*   disk DISK MINSIZE            */
-#define NETSNMP_DISKMIBNUM 9
-#if (HAVE_FSTAB_H || HAVE_SYS_STATVFS_H)
-#define USEDISKMIB
-#endif
-
-/*   load 1 5 15                  */
-#define NETSNMP_LOADAVEMIBNUM 10
-#define USELOADAVEMIB
-
-/*   pass MIBOID command */
-#define USEPASSMIB
-
-/* which version are you using? This mibloc will tell you */
-#define NETSNMP_VERSIONMIBNUM 100
-#define USEVERSIONMIB
-
-/* Reports errors the agent runs into */
-/* (typically its "can't fork, no mem" problems) */
-#define NETSNMP_ERRORMIBNUM 101
-#define USEERRORMIB
-
-/* The sub id of EXENSIBLEMIB returned to queries of
-   .iso.org.dod.internet.mgmt.mib-2.system.sysObjectID.0 */
-#define NETSNMP_AGENTID 250
-
-/* This ID is returned after the NETSNMP_AGENTID above.  IE, the resulting
-   value returned by a query to sysObjectID is
-   EXTENSIBLEMIB.NETSNMP_AGENTID.???, where ??? is defined below by OSTYPE */
-
-#define NETSNMP_HPUX9ID 1
-#define NETSNMP_SUNOS4ID 2
-#define NETSNMP_SOLARISID 3
-#define NETSNMP_OSFID 4
-#define NETSNMP_ULTRIXID 5
-#define NETSNMP_HPUX10ID 6
-#define NETSNMP_NETBSD1ID 7
-#define NETSNMP_FREEBSDID 8
-#define NETSNMP_IRIXID 9
-#define NETSNMP_LINUXID 10
-#define NETSNMP_BSDIID 11
-#define NETSNMP_OPENBSDID 12
-#define NETSNMP_WIN32ID 13
-#define NETSNMP_UNKNOWNID 255
-
-#ifdef hpux9
-#define OSTYPE NETSNMP_HPUX9ID
-#endif
-#ifdef hpux10
-#define OSTYPE NETSNMP_HPUX10ID
-#endif
-#ifdef sunos4
-#define OSTYPE NETSNMP_SUNOS4ID
-#endif
-#ifdef solaris2
-#define OSTYPE NETSNMP_SOLARISID
-#endif
-#if defined(osf3) || defined(osf4) || defined(osf5)
-#define OSTYPE NETSNMP_OSFID
-#endif
-#ifdef ultrix4
-#define OSTYPE NETSNMP_ULTRIXID
-#endif
-#ifdef netbsd1
-#define OSTYPE NETSNMP_NETBSD1ID
-#endif
-#ifdef freebsd2
-#define OSTYPE NETSNMP_FREEBSDID
-#endif
-#if defined(irix6) || defined(irix5)
-#define OSTYPE NETSNMP_IRIXID
-#endif
-#ifdef linux
-#define OSTYPE NETSNMP_LINUXID
-#endif
-#if defined(bsdi2) || defined(bsdi3)
-#define OSTYPE NETSNMP_BSDIID
-#endif
-#ifdef openbsd2
-#define OSTYPE NETSNMP_OPENBSDID
-#endif
-#define OSTYPE NETSNMP_WIN32ID
-/* unknown */
-#ifndef OSTYPE
-#define OSTYPE NETSNMP_UNKNOWNID
-#endif
-
-/* how long to wait (seconds) for error querys before reseting the error trap.*/
-#define NETSNMP_ERRORTIMELENGTH 600
-
-/* Exec command to fix PROC problems */
-/* %s will be replaced by the process name in error */
-
-#define NETSNMP_PROCFIXCMD "/usr/local/bin/perl /local/scripts/fixproc %s"
-
-/* Exec command to fix EXEC problems */
-/* %s will be replaced by the exec/script name in error */
-
-#define NETSNMP_EXECFIXCMD "/usr/local/bin/perl /local/scripts/fixproc %s"
-
-/* Should exec output Cashing be used (speeds up things greatly), and
-   if so, After how many seconds should the cache re-newed?  Note:
-   Don't define CASHETIME to disable cashing completely */
-
-#define NETSNMP_EXCACHETIME 30
-#define NETSNMP_CACHEFILE ".snmp-exec-cache"
-#define NETSNMP_MAXCACHESIZE (200*80)   /* roughly 200 lines max */
-
-#define MAXDISKS 10                      /* can't scan more than this number */
-
-/* misc defaults */
-
-/* default of 100 meg minimum if the minimum size is not specified in
-   the config file */
-#define NETSNMP_DEFDISKMINIMUMSPACE 100000
-
-#define NETSNMP_DEFMAXLOADAVE 12.0      /* default maximum load average before error */
-
-#define NETSNMP_MAXREADCOUNT 20   /* max times to loop reading output from
-                             execs.  Because of sleep(1)s, this will also
-                             be time to wait (in seconds) for exec to finish */
-
-#define NETSNMP_SNMPBLOCK 1       /* Set to 1 if you want snmpgets to block and never
-                             timeout.  Original CMU code had this
-                             hardcoded into the code as = 1 */
-
-#define NETSNMP_RESTARTSLEEP 5    /* How long to wait after a snmpset to
-                             EXTENSIBLEMIB.NETSNMP_VERSIONMIBNUM.VERRESTARTAGENT
-                             before restarting the agent.  This is
-                             necessary to finish the snmpset reply
-                             before restarting. */
-
-/* Number of community strings to store */
-#define NETSNMP_NUM_COMMUNITIES	5
-
-/* UNdefine to allow specifying zero-length community string */
-/* #define NETSNMP_NO_ZEROLENGTH_COMMUNITY 1 */
-
-#define NETSNMP_LASTFIELD -1      /* internal define */
-
-/* Define if you have the strdup function.  */
-#undef HAVE_STRDUP
-
-/* Define if you have the strerror function.  */
-#define HAVE_STRERROR 1
-
-/* define signal if DNE */
-
-#ifndef HAVE_SIGNAL
-#ifdef HAVE_SIGSET
-#define signal(a,b) sigset(a,b)
-#endif
-#endif
-
-/* Not-to-be-compiled macros for use by configure only */
-#define config_require(x)
-#define config_arch_require(x,y)
-#define config_parse_dot_conf(w,x,y,z)
-#define config_add_mib(x)
-
-#ifndef DONT_INC_STRUCTS
-/*#include "agent/mibgroup/struct.h" */
-#endif
-
-#ifndef linux
-#ifndef solaris2
-#define bsdlike
-#endif
-#endif
-
-/* detect Borland C++ WIN32 definition, add Visual C++ define */
-#ifdef __WIN32__
-#ifndef WIN32
-#define WIN32
-#endif /* WIN32 */
-#endif /* __WIN32__ */
-
-#ifdef WIN32
-
-#define HAVE_GETPID 1
-
-int strcasecmp(const char *s1, const char *s2);
-#define vsnprintf _vsnprintf
-
-#define EADDRINUSE	WSAEADDRINUSE
-
-#define ENV_SEPARATOR ";"
-#define ENV_SEPARATOR_CHAR ';'
-
-
-#else
-
-#define ENV_SEPARATOR ":"
-#define ENV_SEPARATOR_CHAR ':'
-
-#endif
-
-/* typedef unsigned short mode_t; */
-
-#define NETSNMP_AGENT_DIRECTORY_MODE 0700
-
-/* reverse encoding BER packets is both faster and more efficient in space. */
-#define NETSNMP_USE_REVERSE_ASNENCODING       1
-#define NETSNMP_DEFAULT_ASNENCODING_DIRECTION 1 /* 1 = reverse, 0 = forwards */
-
diff -urpN net-snmp-5.8/win32/libagent/Makefile.in net-snmp-5.9.1/win32/libagent/Makefile.in
--- net-snmp-5.8/win32/libagent/Makefile.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/libagent/Makefile.in	2021-05-26 05:19:35.000000000 +0700
@@ -29,6 +29,7 @@ LIB32_OBJS= \
 	"$(INTDIR)\cache_handler.obj" \
 	"$(INTDIR)\debug_handler.obj" \
 	"$(INTDIR)\instance.obj" \
+	"$(INTDIR)\kernel.obj" \
 	"$(INTDIR)\mode_end_call.obj" \
 	"$(INTDIR)\multiplexer.obj" \
 	"$(INTDIR)\null.obj" \
diff -urpN net-snmp-5.8/win32/libsnmp/Makefile.in net-snmp-5.9.1/win32/libsnmp/Makefile.in
--- net-snmp-5.8/win32/libsnmp/Makefile.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/libsnmp/Makefile.in	2021-05-26 05:19:35.000000000 +0700
@@ -55,6 +55,7 @@ LIB32_OBJS= \
 	"$(INTDIR)\snmp-tc.obj" \
 	"$(INTDIR)\snmp.obj" \
 	"$(INTDIR)\snmpCallbackDomain.obj" \
+	"$(INTDIR)\snmpIPBaseDomain.obj" \
 	"$(INTDIR)\snmpIPv4BaseDomain.obj" \
 	"$(INTDIR)\snmpSocketBaseDomain.obj" \
 	"$(INTDIR)\snmpTCPBaseDomain.obj" \
diff -urpN net-snmp-5.8/win32/libsnmp_dll/Makefile.in net-snmp-5.9.1/win32/libsnmp_dll/Makefile.in
--- net-snmp-5.8/win32/libsnmp_dll/Makefile.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/libsnmp_dll/Makefile.in	2021-05-26 05:19:35.000000000 +0700
@@ -55,6 +55,7 @@ LINK32_OBJS= \
 	"$(INTDIR)\snmp-tc.obj" \
 	"$(INTDIR)\snmp.obj" \
 	"$(INTDIR)\snmpCallbackDomain.obj" \
+	"$(INTDIR)\snmpIPBaseDomain.obj" \
 	"$(INTDIR)\snmpIPv4BaseDomain.obj" \
 	"$(INTDIR)\snmpSocketBaseDomain.obj" \
 	"$(INTDIR)\snmpTCPBaseDomain.obj" \
@@ -130,10 +131,6 @@ LINK32_FLAGS=advapi32.lib ws2_32.lib ker
 
 "..\bin\$(OUTDIR)\netsnmp.dll" : "..\bin\$(OUTDIR)" "..\lib\$(OUTDIR)" $(DEF_FILE) $(LINK32_OBJS)
     $(LINK32) $(LINK32_FLAGS) $(LINK32_OBJS)
- if exist "../bin/$(OUTDIR)/netsnmp.dll.manifest" \
-	    mt.exe -manifest "../bin/$(OUTDIR)/netsnmp.dll.manifest" -outputresource:"../bin/$(OUTDIR)/netsnmp.dll";2
-
-
 !IF "$(NO_EXTERNAL_DEPS)" != "1"
 !IF EXISTS("$(PROGNAME).dep")
 !INCLUDE "$(PROGNAME).dep"
diff -urpN net-snmp-5.8/win32/local/mib2c.bat net-snmp-5.9.1/win32/local/mib2c.bat
--- net-snmp-5.8/win32/local/mib2c.bat	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/local/mib2c.bat	2021-05-26 05:19:35.000000000 +0700
@@ -16,8 +16,8 @@ goto end
 :no_perl
 echo %MYPERLPROGRAM% requires Perl to run.
 echo .
-echo A version of Perl for Windows is available from
-echo http://www.activestate.com/Products/ActivePerl
+echo Perl source code and instructions for how to build Perl for Windows are
+echo available from https://www.cpan.org/src/.
 echo .
 echo Please install Perl and run this program again.
 echo .
diff -urpN net-snmp-5.8/win32/local/snmpconf.bat net-snmp-5.9.1/win32/local/snmpconf.bat
--- net-snmp-5.8/win32/local/snmpconf.bat	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/local/snmpconf.bat	2021-05-26 05:19:35.000000000 +0700
@@ -16,8 +16,8 @@ goto end
 :no_perl
 echo %MYPERLPROGRAM% requires Perl to run.
 echo .
-echo A version of Perl for Windows is available from
-echo http://www.activestate.com/Products/ActivePerl
+echo Perl source code and instructions for how to build Perl for Windows are
+echo available from https://www.cpan.org/src/.
 echo .
 echo Please install Perl and run this program again.
 echo .
diff -urpN net-snmp-5.8/win32/local/traptoemail.bat net-snmp-5.9.1/win32/local/traptoemail.bat
--- net-snmp-5.8/win32/local/traptoemail.bat	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/local/traptoemail.bat	2021-05-26 05:19:35.000000000 +0700
@@ -16,8 +16,8 @@ goto end
 :no_perl
 echo %MYPERLPROGRAM% requires Perl to run.
 echo .
-echo A version of Perl for Windows is available from
-echo http://www.activestate.com/Products/ActivePerl
+echo Perl source code and instructions for how to build Perl for Windows are
+echo available from https://www.cpan.org/src/.
 echo .
 echo Please install Perl and run this program again.
 echo .
diff -urpN net-snmp-5.8/win32/mib_module_inits.h net-snmp-5.9.1/win32/mib_module_inits.h
--- net-snmp-5.8/win32/mib_module_inits.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/mib_module_inits.h	2021-05-26 05:19:35.000000000 +0700
@@ -8,7 +8,13 @@
 
 #ifdef HAVE_WIN32_PLATFORM_SDK
   if (should_init("at")) init_at();
+#if 0
   if (should_init("interfaces")) init_interfaces();
+#else
+  if (should_init("ifTable")) init_ifTable();
+  if (should_init("ifXTable")) init_ifXTable();
+  if (should_init("interface")) init_interface();
+#endif
   if (should_init("tcp")) init_tcp();
   if (should_init("tcpTable")) init_tcpTable();
   if (should_init("icmp")) init_icmp();
diff -urpN net-snmp-5.8/win32/net-snmp/agent/mib_module_config.h net-snmp-5.9.1/win32/net-snmp/agent/mib_module_config.h
--- net-snmp-5.8/win32/net-snmp/agent/mib_module_config.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/net-snmp/agent/mib_module_config.h	2021-05-26 05:19:35.000000000 +0700
@@ -53,8 +53,43 @@
 /* Define if compiling with the mibII/at module files.  */
 #define USING_MIBII_AT_MODULE 1
  
+#if 0
 /* Define if compiling with the mibII/interfaces module files.  */
 #define USING_MIBII_INTERFACES_MODULE 1
+#else
+/* Define if compiling with the if-mib module files.  */
+#define USING_IF_MIB_MODULE 1
+
+/* Define if compiling with the if-mib/ifTable module files.  */
+#define USING_IF_MIB_IFTABLE_MODULE 1
+
+/* Define if compiling with the if-mib/ifXTable module files.  */
+#define USING_IF_MIB_IFXTABLE_MODULE 1
+
+/* Define if compiling with the if-mib/ifTable/ifTable module files.  */
+#define USING_IF_MIB_IFTABLE_IFTABLE_MODULE 1
+
+/* Define if compiling with the if-mib/ifXTable/ifXTable module files.  */
+#define USING_IF_MIB_IFXTABLE_IFXTABLE_MODULE 1
+
+/* Define if compiling with the if-mib/data_access/interface module files.  */
+#define USING_IF_MIB_DATA_ACCESS_INTERFACE_MODULE 1
+
+/* Define if compiling with the if-mib/ifTable/ifTable_interface module files.  */
+#define USING_IF_MIB_IFTABLE_IFTABLE_INTERFACE_MODULE 1
+
+/* Define if compiling with the if-mib/ifTable/ifTable_data_access module files.  */
+#define USING_IF_MIB_IFTABLE_IFTABLE_DATA_ACCESS_MODULE 1
+
+/* Define if compiling with the if-mib/ifXTable/ifXTable_interface module files.  */
+#define USING_IF_MIB_IFXTABLE_IFXTABLE_INTERFACE_MODULE 1
+
+/* Define if compiling with the if-mib/ifXTable/ifXTable_data_access module files.  */
+#define USING_IF_MIB_IFXTABLE_IFXTABLE_DATA_ACCESS_MODULE 1
+
+/* Define if compiling with the if-mib/data_access/interface_iphlpapi module files.  */
+#define USING_IF_MIB_DATA_ACCESS_INTERFACE_IPHLPAPI_MODULE 1
+#endif
  
 /* Define if compiling with the mibII/snmp_mib module files.  */
 #define USING_MIBII_SNMP_MIB_MODULE 1
diff -urpN net-snmp-5.8/win32/net-snmp/net-snmp-config.h net-snmp-5.9.1/win32/net-snmp/net-snmp-config.h
--- net-snmp-5.8/win32/net-snmp/net-snmp-config.h	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/net-snmp/net-snmp-config.h	2021-05-26 05:19:35.000000000 +0700
@@ -96,6 +96,9 @@
    variables */
 #define NETSNMP_ATTRIBUTE_DEPRECATED
 
+/* Used to suppress compiler warnings about unused functions and variables */
+#define NETSNMP_ATTRIBUTE_UNUSED
+
 /* add in recent CMU library extensions (not complete) */
 /* #undef CMU_COMPATIBLE */
 
@@ -164,8 +167,20 @@
 /* Use libwrap to handle allow/deny hosts? */
 /* #undef NETSNMP_USE_LIBWRAP */
 
-/* Use dmalloc to do malloc debugging? */
-/* #undef HAVE_DMALLOC_H */
+/* Define if _beginthreadex() is defined in <process.h> */
+#define HAVE__BEGINTHREADEX 1
+
+/* Define if _cputs() is defined in <conio.h> */
+#define HAVE__CPUTS 1
+
+/* Define if _getch() is defined in <conio.h> */
+#define HAVE__GETCH 1
+
+/* Define if _get_osfhandle() is defined in <io.h> */
+#define HAVE__GET_OSFHANDLE 1
+
+/* Define if _open_osfhandle() is defined in <io.h> */
+#define HAVE__OPEN_OSFHANDLE 1
 
 /* location of UNIX kernel */
 #define KERNEL_LOC "unknown"
@@ -195,6 +210,9 @@
 /* If we don't want to use kmem. */
 /* #undef NETSNMP_NO_KMEM_USAGE */
 
+/* Should evaluate to the name of the current function if defined */
+#define NETSNMP_FUNCTION __FUNCTION__
+
 /* If you don't want the agent to report on variables it doesn't have data for */
 #define NETSNMP_NO_DUMMY_VALUES 1
 
@@ -230,6 +248,9 @@
 /* Define if SNMPv2c code should not be included */
 /* #undef NETSNMP_DISABLE_SNMPV2C */
 
+/* Define if AES-192/AES-256 encryption should be supported */
+/* #undef NETSNMP_DRAFT_BLUMENTHAL_AES_04 */
+
 /* Define to 1 if you have the `AES_cfb128_encrypt' function. */
 /* #undef HAVE_AES_CFB128_ENCRYPT */
 
@@ -399,9 +420,6 @@
 /* Define to 1 if you have the `crypto' library (-lcrypto). */
 /* #undef HAVE_LIBCRYPTO */
 
-/* Define to 1 if you have the `efence' library (-lefence). */
-/* #undef HAVE_LIBEFENCE */
-
 /* Define to 1 if you have the `elf' library (-lelf). */
 /* #undef HAVE_LIBELF */
 
@@ -441,6 +459,9 @@
 /* Define to 1 if you have the <linux/tasks.h> header file. */
 /* #undef HAVE_LINUX_TASKS_H */
 
+/* Define to 1 if you have the <lm.h> header file. */
+#define HAVE_LM_H 1
+
 /* Define to 1 if you have the <locale.h> header file. */
 #define HAVE_LOCALE_H 1
 
@@ -691,7 +712,7 @@
 /* #undef HAVE_STATVFS */
 
 /* Define to 1 if you have the <stdint.h> header file. */
-#ifdef __MINGW32__
+#if defined(__MINGW32__) || (defined(_MSC_VER) && (_MSC_VER >= 1600))
 #define HAVE_STDINT_H 1
 #endif
 
@@ -940,6 +961,9 @@
 /* Define to 1 if you have the `vsnprintf' function. */
 #define HAVE_VSNPRINTF 1
 
+/* Define to 1 if you have the <windows.h> header file. */
+#define HAVE_WINDOWS_H 1
+
 /* Define to 1 if you have the <winsock.h> header file. */
 #define HAVE_WINSOCK_H 1
 
@@ -955,6 +979,12 @@
 /* Define to 1 if you have the <xti.h> header file. */
 /* #undef HAVE_XTI_H */
 
+/* Type of the fifth argument of select() */
+#define NETSNMP_SELECT_TIMEVAL struct timeval
+
+/* Type of the third argument of ioctlsocket() */
+#define NETSNMP_IOCTLSOCKET_ARG u_long
+
 /* Define to the address where bug reports for this package should be sent. */
 /* #undef PACKAGE_BUGREPORT */
 
@@ -1003,10 +1033,6 @@
 /* Define to 1 if you can safely include both <sys/time.h> and <time.h>. */
 /* #undef TIME_WITH_SYS_TIME */
 
-/* Define to 1 if your processor stores words with the most significant byte
-   first (like Motorola and SPARC, unlike Intel and VAX). */
-/* #undef WORDS_BIGENDIAN */
-
 /* Define to 1 if on AIX 3.
    System headers sometimes define this.
    We just want to avoid a redefinition error message.  */
@@ -1154,11 +1180,19 @@
 /* #undef NETSNMP_CAN_USE_SYSCTL */
 
 /* type check for in_addr_t */
-/* #undef in_addr_t */
+#define in_addr_t unsigned long
 
 /* define if SIOCGIFADDR exists in sys/ioctl.h */
 /* #undef SYS_IOCTL_H_HAS_SIOCGIFADDR */
 
+#if defined(_M_PPC) || defined(_M_MPPC)
+# define NETSNMP_BIGENDIAN 1
+#elif defined(_M_IX86) || defined(_M_X64)
+# define NETSNMP_BIGENDIAN 0
+#else
+#  error Unknown byte order
+#endif
+
 /* Mib-2 tree Info */
 /* These are the system information variables. */
 
@@ -1625,6 +1659,9 @@
 #include NETSNMP_MACHINE_INCLUDE_FILE
 #endif
 
+#include <winsock2.h>
+#include <ws2tcpip.h>
+
 #if NETSNMP_ENABLE_INLINE && !defined(NETSNMP_NO_INLINE)
 #   define NETSNMP_USE_INLINE 1
 #else
@@ -1692,9 +1729,6 @@ enum {
 /* Define if you have the closesocket function.  */
 #define HAVE_CLOSESOCKET 1
 
-/* Define if you have raise() instead of alarm() */
-#define HAVE_RAISE 1
-
 /* define to 1 if you do not want to set global snmp_errno */
 #define DONT_SHARE_ERROR_WITH_OTHER_THREADS 1
 
@@ -1731,11 +1765,11 @@ enum {
 #ifdef NETSNMP_USE_DLL
   #ifdef NETSNMP_DLL
     #if defined(_MSC_VER)
-      #define NETSNMP_IMPORT __declspec(dllexport)
+      #define NETSNMP_IMPORT extern __declspec(dllexport)
     #endif
   #else
     #if defined(_MSC_VER)
-      #define NETSNMP_IMPORT __declspec(dllimport)
+      #define NETSNMP_IMPORT extern __declspec(dllimport)
     #endif
   #endif   /* NETSNMP_DLL */
 #endif     /* NETSNMP_USE_DLL */
@@ -1822,10 +1856,6 @@ enum {
 /* define if agentx transport is to use domain sockets only */
 /* #undef NETSNMP_AGENTX_DOM_SOCK_ONLY */
 
-#ifndef LOG_DAEMON
-#define       LOG_DAEMON      (3<<3)  /* system daemons */
-#endif
-
 #ifdef UCD_COMPATIBLE
 /* old and in the way */
 #define EXTENSIBLEMIB NETSNMP_UCDAVIS_MIB
@@ -1912,9 +1942,6 @@ enum {
 #define HAVE_STRUCT_SOCKADDR_STORAGE_SS_FAMILY 1
 #endif
 
-/* Size prefix to use to printf a uint32_t */
-#define NETSNMP_PRI32 ""
-
 #ifdef _MSC_VER
 #ifdef _WIN64
 #define NETSNMP_PRIz "I64"
diff -urpN net-snmp-5.8/win32/net-snmp/net-snmp-config.h.in net-snmp-5.9.1/win32/net-snmp/net-snmp-config.h.in
--- net-snmp-5.8/win32/net-snmp/net-snmp-config.h.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/net-snmp/net-snmp-config.h.in	2021-05-26 05:19:35.000000000 +0700
@@ -96,6 +96,9 @@
    variables */
 #define NETSNMP_ATTRIBUTE_DEPRECATED
 
+/* Used to suppress compiler warnings about unused functions and variables */
+#define NETSNMP_ATTRIBUTE_UNUSED
+
 /* add in recent CMU library extensions (not complete) */
 /* #undef CMU_COMPATIBLE */
 
@@ -164,8 +167,20 @@
 /* Use libwrap to handle allow/deny hosts? */
 /* #undef NETSNMP_USE_LIBWRAP */
 
-/* Use dmalloc to do malloc debugging? */
-/* #undef HAVE_DMALLOC_H */
+/* Define if _beginthreadex() is defined in <process.h> */
+#define HAVE__BEGINTHREADEX 1
+
+/* Define if _cputs() is defined in <conio.h> */
+#define HAVE__CPUTS 1
+
+/* Define if _getch() is defined in <conio.h> */
+#define HAVE__GETCH 1
+
+/* Define if _get_osfhandle() is defined in <io.h> */
+#define HAVE__GET_OSFHANDLE 1
+
+/* Define if _open_osfhandle() is defined in <io.h> */
+#define HAVE__OPEN_OSFHANDLE 1
 
 /* location of UNIX kernel */
 #define KERNEL_LOC "unknown"
@@ -195,6 +210,9 @@
 /* If we don't want to use kmem. */
 /* #undef NETSNMP_NO_KMEM_USAGE */
 
+/* Should evaluate to the name of the current function if defined */
+#define NETSNMP_FUNCTION __FUNCTION__
+
 /* If you don't want the agent to report on variables it doesn't have data for */
 #define NETSNMP_NO_DUMMY_VALUES 1
 
@@ -230,6 +248,9 @@
 /* Define if SNMPv2c code should not be included */
 /* #undef NETSNMP_DISABLE_SNMPV2C */
 
+/* Define if AES-192/AES-256 encryption should be supported */
+/* #undef NETSNMP_DRAFT_BLUMENTHAL_AES_04 */
+
 /* Define to 1 if you have the `AES_cfb128_encrypt' function. */
 /* #undef HAVE_AES_CFB128_ENCRYPT */
 
@@ -399,9 +420,6 @@
 /* Define to 1 if you have the `crypto' library (-lcrypto). */
 /* #undef HAVE_LIBCRYPTO */
 
-/* Define to 1 if you have the `efence' library (-lefence). */
-/* #undef HAVE_LIBEFENCE */
-
 /* Define to 1 if you have the `elf' library (-lelf). */
 /* #undef HAVE_LIBELF */
 
@@ -441,6 +459,9 @@
 /* Define to 1 if you have the <linux/tasks.h> header file. */
 /* #undef HAVE_LINUX_TASKS_H */
 
+/* Define to 1 if you have the <lm.h> header file. */
+#define HAVE_LM_H 1
+
 /* Define to 1 if you have the <locale.h> header file. */
 #define HAVE_LOCALE_H 1
 
@@ -691,7 +712,7 @@
 /* #undef HAVE_STATVFS */
 
 /* Define to 1 if you have the <stdint.h> header file. */
-#ifdef __MINGW32__
+#if defined(__MINGW32__) || (defined(_MSC_VER) && (_MSC_VER >= 1600))
 #define HAVE_STDINT_H 1
 #endif
 
@@ -940,6 +961,9 @@
 /* Define to 1 if you have the `vsnprintf' function. */
 #define HAVE_VSNPRINTF 1
 
+/* Define to 1 if you have the <windows.h> header file. */
+#define HAVE_WINDOWS_H 1
+
 /* Define to 1 if you have the <winsock.h> header file. */
 #define HAVE_WINSOCK_H 1
 
@@ -955,6 +979,12 @@
 /* Define to 1 if you have the <xti.h> header file. */
 /* #undef HAVE_XTI_H */
 
+/* Type of the fifth argument of select() */
+#define NETSNMP_SELECT_TIMEVAL struct timeval
+
+/* Type of the third argument of ioctlsocket() */
+#define NETSNMP_IOCTLSOCKET_ARG u_long
+
 /* Define to the address where bug reports for this package should be sent. */
 /* #undef PACKAGE_BUGREPORT */
 
@@ -1003,10 +1033,6 @@
 /* Define to 1 if you can safely include both <sys/time.h> and <time.h>. */
 /* #undef TIME_WITH_SYS_TIME */
 
-/* Define to 1 if your processor stores words with the most significant byte
-   first (like Motorola and SPARC, unlike Intel and VAX). */
-/* #undef WORDS_BIGENDIAN */
-
 /* Define to 1 if on AIX 3.
    System headers sometimes define this.
    We just want to avoid a redefinition error message.  */
@@ -1154,11 +1180,19 @@
 /* #undef NETSNMP_CAN_USE_SYSCTL */
 
 /* type check for in_addr_t */
-/* #undef in_addr_t */
+#define in_addr_t unsigned long
 
 /* define if SIOCGIFADDR exists in sys/ioctl.h */
 /* #undef SYS_IOCTL_H_HAS_SIOCGIFADDR */
 
+#if defined(_M_PPC) || defined(_M_MPPC)
+# define NETSNMP_BIGENDIAN 1
+#elif defined(_M_IX86) || defined(_M_X64)
+# define NETSNMP_BIGENDIAN 0
+#else
+#  error Unknown byte order
+#endif
+
 /* Mib-2 tree Info */
 /* These are the system information variables. */
 
@@ -1625,6 +1659,9 @@
 #include NETSNMP_MACHINE_INCLUDE_FILE
 #endif
 
+#include <winsock2.h>
+#include <ws2tcpip.h>
+
 #if NETSNMP_ENABLE_INLINE && !defined(NETSNMP_NO_INLINE)
 #   define NETSNMP_USE_INLINE 1
 #else
@@ -1692,9 +1729,6 @@ enum {
 /* Define if you have the closesocket function.  */
 #define HAVE_CLOSESOCKET 1
 
-/* Define if you have raise() instead of alarm() */
-#define HAVE_RAISE 1
-
 /* define to 1 if you do not want to set global snmp_errno */
 #define DONT_SHARE_ERROR_WITH_OTHER_THREADS 1
 
@@ -1731,11 +1765,11 @@ enum {
 #ifdef NETSNMP_USE_DLL
   #ifdef NETSNMP_DLL
     #if defined(_MSC_VER)
-      #define NETSNMP_IMPORT __declspec(dllexport)
+      #define NETSNMP_IMPORT extern __declspec(dllexport)
     #endif
   #else
     #if defined(_MSC_VER)
-      #define NETSNMP_IMPORT __declspec(dllimport)
+      #define NETSNMP_IMPORT extern __declspec(dllimport)
     #endif
   #endif   /* NETSNMP_DLL */
 #endif     /* NETSNMP_USE_DLL */
@@ -1822,10 +1856,6 @@ enum {
 /* define if agentx transport is to use domain sockets only */
 /* #undef NETSNMP_AGENTX_DOM_SOCK_ONLY */
 
-#ifndef LOG_DAEMON
-#define       LOG_DAEMON      (3<<3)  /* system daemons */
-#endif
-
 #ifdef UCD_COMPATIBLE
 /* old and in the way */
 #define EXTENSIBLEMIB NETSNMP_UCDAVIS_MIB
@@ -1912,9 +1942,6 @@ enum {
 #define HAVE_STRUCT_SOCKADDR_STORAGE_SS_FAMILY 1
 #endif
 
-/* Size prefix to use to printf a uint32_t */
-#define NETSNMP_PRI32 ""
-
 #ifdef _MSC_VER
 #ifdef _WIN64
 #define NETSNMP_PRIz "I64"
diff -urpN net-snmp-5.8/win32/netsnmpmibs/Makefile.in net-snmp-5.9.1/win32/netsnmpmibs/Makefile.in
--- net-snmp-5.8/win32/netsnmpmibs/Makefile.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/netsnmpmibs/Makefile.in	2021-05-26 05:19:35.000000000 +0700
@@ -44,6 +44,18 @@ ALL : "..\lib\$(OUTDIR)\$(PROGNAME).lib"
 {..\..\agent\mibgroup\examples}.c{$(INTDIR)}.obj::
    $(CPP) $(CPP_PROJ) $<
 
+{..\..\agent\mibgroup\if-mib}.c{$(INTDIR)}.obj::
+   $(CPP) $(CPP_PROJ) $<
+
+{..\..\agent\mibgroup\if-mib\ifTable}.c{$(INTDIR)}.obj::
+   $(CPP) $(CPP_PROJ) $<
+
+{..\..\agent\mibgroup\if-mib\ifXTable}.c{$(INTDIR)}.obj::
+   $(CPP) $(CPP_PROJ) $<
+
+{..\..\agent\mibgroup\if-mib\data_access}.c{$(INTDIR)}.obj::
+   $(CPP) $(CPP_PROJ) $<
+
 {..\..\agent\mibgroup\mibII}.c{$(INTDIR)}.obj::
    $(CPP) $(CPP_PROJ) $<
 
@@ -169,7 +181,14 @@ LIB32_OBJS3= \
 	"$(INTDIR)\at.obj" \
 	"$(INTDIR)\at_iphlpapi.obj" \
 	"$(INTDIR)\icmp.obj" \
-	"$(INTDIR)\interfaces.obj" \
+	"$(INTDIR)\ifTable.obj" \
+	"$(INTDIR)\ifTable_data_access.obj" \
+	"$(INTDIR)\ifTable_interface.obj" \
+	"$(INTDIR)\ifXTable.obj" \
+	"$(INTDIR)\ifXTable_data_access.obj" \
+	"$(INTDIR)\ifXTable_interface.obj" \
+	"$(INTDIR)\interface.obj" \
+	"$(INTDIR)\interface_iphlpapi.obj" \
 	"$(INTDIR)\ip.obj" \
 	"$(INTDIR)\ipAddr.obj" \
 	"$(INTDIR)\notification_log.obj" \
diff -urpN net-snmp-5.8/win32/nmakeperl.bat net-snmp-5.9.1/win32/nmakeperl.bat
--- net-snmp-5.8/win32/nmakeperl.bat	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/nmakeperl.bat	2021-05-26 05:19:35.000000000 +0700
@@ -39,6 +39,7 @@ echo Remember to run this script from th
 cd perl
 
 REM choose the installed location...
+set PERL5LIB=$(MAKEDIR)\..\perl
 perl Makefile.PL CAPI=TRUE -NET-SNMP-PATH=%INSTALL_BASE%
 
 REM Or, if the libraries have been built, look back in the build directory.
diff -urpN net-snmp-5.8/win32/snmpd/Makefile.in net-snmp-5.9.1/win32/snmpd/Makefile.in
--- net-snmp-5.8/win32/snmpd/Makefile.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/snmpd/Makefile.in	2021-05-26 05:19:35.000000000 +0700
@@ -54,8 +54,6 @@ CLEAN :
 "..\bin\$(OUTDIR)\$(PROGNAME).exe" : "..\bin\$(OUTDIR)" $(DEF_FILE) $(LINK32_OBJS)
 !IF "$(LINKTYPE)" == "static" || "$(ALLOW_DLL)" == "1"
     $(LINK32) $(LINK32_FLAGS) $(LINK32_OBJS)
- if exist "..\bin\$(OUTDIR)\$(PROGNAME).exe.manifest" \
-	    mt.exe -manifest "..\bin\$(OUTDIR)\$(PROGNAME).exe.manifest" -outputresource:"..\bin\$(OUTDIR)\$(PROGNAME).exe";1
 !ELSE	# Linktype check
 	-@echo .
 	-@echo Aborting build.  Applications can not be built using --linktype=dynamic
diff -urpN net-snmp-5.8/win32/snmpnetstat/Makefile.in net-snmp-5.9.1/win32/snmpnetstat/Makefile.in
--- net-snmp-5.8/win32/snmpnetstat/Makefile.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/snmpnetstat/Makefile.in	2021-05-26 05:19:35.000000000 +0700
@@ -63,8 +63,6 @@ LINK32_OBJS= \
 "..\bin\$(OUTDIR)\$(PROGNAME).exe" : "..\bin\$(OUTDIR)" $(DEF_FILE) $(LINK32_OBJS)
 !IF "$(LINKTYPE)" == "static" || "$(ALLOW_DLL)" == "1"
     $(LINK32) $(LINK32_FLAGS) $(LINK32_OBJS)
- if exist "..\bin\$(OUTDIR)\$(PROGNAME).exe.manifest" \
-	    mt.exe -manifest "..\bin\$(OUTDIR)\$(PROGNAME).exe.manifest" -outputresource:"..\bin\$(OUTDIR)\$(PROGNAME).exe";1
 !ELSE	# Linktype check
 	-@echo .
 	-@echo Aborting build.  Applications can not be built using --linktype=dynamic
diff -urpN net-snmp-5.8/win32/snmptrapd/Makefile.in net-snmp-5.9.1/win32/snmptrapd/Makefile.in
--- net-snmp-5.8/win32/snmptrapd/Makefile.in	2018-07-16 21:33:40.000000000 +0700
+++ net-snmp-5.9.1/win32/snmptrapd/Makefile.in	2021-05-26 05:19:35.000000000 +0700
@@ -54,8 +54,6 @@ LINK32_OBJS= \
 "..\bin\$(OUTDIR)\$(PROGNAME).exe" : "..\bin\$(OUTDIR)" $(DEF_FILE) $(LINK32_OBJS)
 !IF "$(LINKTYPE)" == "static" || "$(ALLOW_DLL)" == "1"
     $(LINK32) $(LINK32_FLAGS) $(LINK32_OBJS)
- if exist "..\bin\$(OUTDIR)\$(PROGNAME).exe.manifest" \
-	    mt.exe -manifest "..\bin\$(OUTDIR)\$(PROGNAME).exe.manifest" -outputresource:"..\bin\$(OUTDIR)\$(PROGNAME).exe";1
 !ELSE	# Linktype check
 	-@echo .
 	-@echo Aborting build.  Applications can not be built using --linktype=dynamic
